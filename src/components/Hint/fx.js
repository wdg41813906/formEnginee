!function(t) {
    window.FX = window.FX || {},
        FX.API = FX.API || {},
        t.extend(FX.API, {
            sign: {
                get_email: "/auth/email/get",
                get_phone: "/auth/phone/get",
                sso_jdy_token: "/sso/jdy/token",
                captcha_valid: "/auth/captcha/valid",
                unbind: "/auth/:value/unbind",
                weixin_open_unbind: "/auth/weixin/open/unbind",
                password_forget: "/password/forget",
                password_reset: "/password/reset",
                register: "/register",
                signin: "/signin"
            },
            profile: {
                third_part_bind: "/profile/3rd_bind",
                search_corp: "/profile/search_corp",
                api: "/profile/get_api",
                apply: "/profile/affiliate/apply",
                apply_cash: "/profile/affiliate/apply_cash",
                get_income: "/profile/affiliate/get_income",
                list_apps: "/profile/affiliate/list_apps",
                list_asset: "/profile/affiliate/list_asset",
                list_joined_member: "/profile/affiliate/list_joined_member",
                list_paid_member: "/profile/affiliate/list_paid_member",
                user_verify: "/profile/affiliate/user_verify",
                user_verify_read: "/profile/affiliate/user_verify/read",
                user_verify_update: "/profile/affiliate/user_verify/update",
                reset_api_key: "/profile/api_key/reset",
                remove_api_key: "/profile/api_key/remove",
                get_api_key: "/profile/api_key/get",
                corp: "/profile/get_corp",
                get_coupon: "/profile/get_coupon",
                me: "/profile/get_me",
                check_unpaid: "/profile/order/check_unpaid",
                default_receipt: "/profile/order/default_receipt",
                order_list: "/profile/order/list",
                order_pricing: "/profile/order/pricing",
                order_receipt: "/profile/order/receipt",
                order_receipt_get: "/profile/order/get_receipt_info",
                order_receipt_list: "/profile/order/receipt/list",
                order_submit: "/profile/order/submit",
                order_cancel: "/profile/order/:orderId/cancel",
                pay_proof_submit: "/profile/order/:orderId/pay_proof/submit",
                order_remove: "/profile/order/:orderId/remove",
                get_persona: "/profile/get_persona",
                update_persona: "/profile/update_persona",
                persona_app_list: "/profile/persona/app_list",
                sms_log_list: "/profile/sms_log/list",
                start_trial: "/profile/start_trial",
                update: "/profile/update_me",
                update_corp: "/profile/update_corp",
                check_password: "/profile/check_password",
                vip_center: "/profile/vip_center",
                vip_item_usage: "/profile/vip_item_usage",
                packs: "/profile/packs",
                account_cancel: "/profile/account_cancel",
                set_locale: "/profile/set_locale",
                sms_pack_usage: "/profile/sms_pack_usage",
                message_receiver_create: "/profile/message/receiver/create",
                message_receiver_update: "/profile/message/receiver/:receiverId/update",
                message_receiver_remove: "/profile/message/receiver/:receiverId/remove",
                message_receiver_list: "/profile/message/receiver/list",
                message_webhook_get: "/profile/message_webhook",
                message_webhook_update: "/profile/message_webhook/update",
                message_webhook_logs: "/profile/message_webhook/logs",
                send_validation: "/profile/message/receiver/:receiverId/send_validation",
                record_register_info: "/profile/record_register_info",
                guide_complete: "/guide/complete"
            },
            dingtalk: {
                secret_install: "/dingtalk/corp/secret/install",
                update: "/dingtalk/corp/ssosecret/update",
                suite_install: "/dingtalk/corp/suite/install",
                login: "/dingtalk/corp/:corpId/login",
                market_qr: "/dingtalk/market_qr",
                shortcut_create: "/dingtalk/shortcut/create",
                shortcut_update: "/dingtalk/shortcut/update",
                shortcut_remove: "/dingtalk/shortcut/remove",
                shortcut_list: "/dingtalk/shortcut/list",
                shortcut_icons: "/dingtalk/shortcut/icons",
                shortcut_url: "/dingtalk/shortcut/manage_url"
            },
            corp_suite: {
                get_cron_sync: "/corp/suite/get_cron_sync",
                set_cron_sync: "/corp/suite/set_cron_sync",
                unbind: "/corp/suite/unbind",
                user_sync: "/corp/suite/user_sync",
                get_sync_logs: "/corp/suite/get_sync_logs",
                login_check: "/corp/:corpId/suite/login_check"
            },
            file: {
                get_qn_token: "/upload/get_qn_token",
                get_qn_data_token: "/_/data/upload_token/file",
                get_oss_token: "/upload/get_oss_token",
                get_member_signature: "/corp/member/signature",
                delete_member_signature: "/corp/member/signature/remove"
            },
            app: {
                get: "/_/app/:appId",
                create: "/dashboard/app/create",
                apps: "/dashboard/apps",
                flow_start: "/dashboard/flow_start",
                flow_query: "/dashboard/workflow/query_data",
                flow_todo_count: "/dashboard/workflow/todo_count",
                sort_app: "/dashboard/sort_app",
                switch_corp: "/dashboard/switch_corp",
                install: "/dashboard/template/install",
                list: "/dashboard/template/list",
                user_corps: "/dashboard/user_corps",
                accept: "/dashboard/app/:appId/accept",
                get_vip_pack: "/_/app/:appId/get_vip_pack",
                publish: "/dashboard/app/:appId/publish",
                publisher: "/dashboard/app/:appId/publisher",
                refuse: "/dashboard/app/:appId/refuse",
                report_list: "/dashboard/report_list",
                transform_report: "/dashboard/transform_report",
                transform_logs: "/dashboard/transform_logs",
                transform_logs_export: "/dashboard/transform_logs_export",
                search: "/dashboard/search"
            },
            flow: {
                batch_transfer: "/_/app/:appId/workflow/batch_transfer",
                batch_transfer_tasks: "/_/app/:appId/workflow/batch_transfer_tasks",
                batch_forward: "/_/app/:appId/workflow/batch_forward",
                distinct: "/_/app/:appId/workflow/distinct",
                get_node_fields: "/_/app/:appId/workflow/get_node_fields",
                query_data: "/_/app/:appId/workflow/query_data",
                query_data_count: "/_/app/:appId/workflow/query_data_count",
                query_menu: "/_/app/:appId/workflow/query_menu",
                query_node: "/_/app/:appId/workflow/query_node",
                stash_data_count: "/_/app/:appId/workflow/stash_data_count"
            },
            entry: {
                edit: "/dashboard/app/:appId/form/:formId/edit",
                query_content: "/_/app/:appId/form/:formId/query_content",
                qr_link: "/dashboard/app/:appId/form/:formId/data/:dataId/qr_link",
                f: "/f/:formId/password",
                q: "/q/:formId/password",
                r: "/r/:reportId/password",
                dash: "/dash/:dashId/password"
            },
            data: {
                allow_activate_nodes: "/_/data/allow_activate_nodes",
                allow_back_nodes: "/_/data/allow_back_nodes",
                allow_transfer_users: "/_/data/allow_transfer_users",
                batch_check_formula: "/_/data/batch_update/check_formula",
                batch_update: "/_/data/batch_update",
                batch_update_tasks: "/_/data/batch_update_tasks",
                chart_group: "/_/data/chart_group",
                combined_group: "/_/data/combined_group",
                comment_create: "/_/data/log/create_comment",
                comment_list: "/_/data/log/list_comments",
                log_list: "/_/data/log/list_changes",
                count: "/_/data/count",
                create: "/_/data/create",
                current_departments: "/_/data/member/current_departments",
                departments: "/_/data/member/departments",
                distinct: "/_/data/distinct",
                distinct_report: "/_/data/report/distinct",
                excel_export: "/_/data/combined_group/excel_export",
                excel_template: "/_/data/list/excel_template",
                filter_link: "/_/data/filter_link",
                find: "/_/data/find",
                find_excel_export: "/_/data/find/excel_export",
                flow_change: "/_/data/flow_change",
                flow_chargers: "/_/data/flow_chargers",
                flow_creators: "/_/data/flow_creators",
                flow_comment_list: "/_/data/log/flow/list_approval_comments",
                link: "/_/data/link",
                list: "/_/data/list",
                list_excel_export: "/_/data/list/excel_export",
                log_flow: "/_/data/log/flow/list_all",
                print: "/_/data/print",
                batch_print: "/_/data/batch_print",
                batch_print_task_list: "/_/data/batch_print/task/list",
                batch_print_task_remove: "/_/data/batch_print/task/remove",
                query: "/_/data/public_query",
                read: "/_/data/read",
                read_link: "/_/data/read_link",
                read_link_query: "/_/data/read_link_query",
                remove: "/_/data/remove",
                report_remove: "/_/data/report/remove",
                roles: "/_/data/member/roles",
                signature: "/_/data/signature/get_qr_link",
                transfer_list: "/_/data/log/flow/list_forwards",
                update: "/_/data/update",
                user_dept_role: "/_/data/member/dept_role_users",
                users: "/_/data/member/users",
                view: "/_/data/view",
                get_sms_code: "/_/data/phone/get_verify_code",
                check_sms_code: "/_/data/phone/check_verify_code",
                form_event_trigger: "/_/data/form_event_trigger"
            },
            formula: {
                aggregate: "/_/data/formula/aggregate",
                map: "/_/data/formula/map",
                recno: "/_/data/formula/recno"
            },
            manager: {
                create: "/manager/corp/create"
            },
            excel: {
                check_data: "/_/app/:appId/excel/check_data",
                get_sample: "/_/app/:appId/excel/get_sample",
                import: "/_/app/:appId/excel/import",
                match_head: "/_/app/:appId/excel/match_head",
                upload: "/_/app/:appId/excel/upload"
            },
            message: {
                list: "/manager/message/list",
                set_read: "/manager/message/set_read",
                unread: "/manager/message/unread",
                notice: "/manager/message/notice"
            },
            corp: {
                contact_create: "/corp/contact/create",
                contact_list: "/corp/contact/list",
                contact_remove: "/corp/contact/remove",
                contact_update: "/corp/contact/:contactId/update",
                channel_verify: "/corp/member/channel_verify",
                department_edit: "/corp/department/:departmentId/edit",
                department_list_member: "/corp/department/list_member",
                department_remove: "/corp/department/:departmentId/remove",
                department_create: "/corp/department/create",
                department_list: "/corp/department/list",
                widget_list_member: "/corp/widget/list_member",
                widget_list_dept: "/corp/widget/list_dept",
                widget_list_role: "/corp/widget/list_role",
                get_manager: "/corp/department/manager/get",
                set_manager: "/corp/department/manager/set",
                kms_enable: "/corp/enable/kms",
                list_dismission_member: "/corp/list_dismission_member",
                list_member_name: "/corp/list_member_name",
                group_remove: "/corp/manage/group/remove",
                group_update: "/corp/manage/group/update",
                group_list: "/corp/manage/group_list",
                get_config: "/corp/manage/group/:groupId/get_config",
                invite: "/corp/member/invite",
                corp_config_get: "/corp/config/get",
                corp_config_set: "/corp/config/set",
                invite_list: "/corp/member/invite_list",
                invite_cancel: "/corp/member/invite_cancel",
                reinvite: "/corp/member/reinvite",
                set_dept: "/corp/member/set_dept",
                member_list_department: "/corp/member/:memberId/list_department",
                role_list: "/corp/role/list",
                role_create: "/corp/role/create",
                role_update: "/corp/role/:roleId/update",
                role_list_member: "/corp/role/:roleId/list_member",
                role_remove: "/corp/role/:roleId/remove",
                role_group_add: "/corp/role_group/create",
                role_group_list: "/corp/role_group/list",
                role_group_remove: "/corp/role_group/:groupId/remove",
                role_group_sort: "/corp/role_group/sort",
                role_group_update: "/corp/role_group/:groupId/update",
                set_member: "/corp/role/:roleId/set_member",
                edit_member: "/corp/member/edit",
                remove_member: "/corp/member/remove",
                uniq_check: "/corp/member/uniq_check",
                join_corp: "/corp/member/join_corp",
                join_verify: "/corp/member/join_verify",
                modules_kms_disable: "/corp/:corpId/modules/kms_disable",
                modules_kms_enable: "/corp/:corpId/modules/kms_enable",
                wechat_member_bind: "/wechat/platform/:corpId/member_bind",
                wechat_grant_url: "/wechat/platform/:corpId/grant",
                wechat_bind_revoke: "/wechat/platform/:corpId/revoke"
            },
            bbs: {
                topics: "/bbs/topics",
                create: "/bbs/topic/create",
                reply_remove: "/bbs/topic/reply/:replyId/remove",
                topicId: "/bbs/topic/:topicId",
                remove: "/bbs/topic/:topicId/remove",
                reply_create: "/bbs/topic/:topicId/reply/create",
                update: "/bbs/topic/:topicId/update"
            },
            form: {
                get: "/_/app/:appId/form/:formId"
            },
            report: {
                get: "/_/app/:appId/report/:reportId"
            },
            etl: {
                execute: "/_/app/:appId/dash/:entryId/widget/:widgetId/etl_execute"
            },
            dash: {
                count: "/_/data/dash/count",
                get: "/_/app/:appId/dash/:entryId",
                combined_group: "/_/data/dash/combined_group",
                list: "/_/data/dash/list",
                excel_export: "/_/data/dash/combined_group/excel_export",
                list_excel_export: "/_/data/dash/list/excel_export",
                distinct: "/_/data/dash/distinct",
                check_formula: "/_/admin/app/:appid/dash/:dashid/check_formula",
                current_departments: "/_/data/member/current_departments",
                departments: "/_/data/member/departments",
                get_monthly_data: "/_/data/dash/calendar/get_monthly_data",
                get_weekly_data: "/_/data/dash/calendar/get_weekly_data",
                get_daily_data: "/_/data/dash/calendar/get_daily_data",
                manage_list: "/_/data/dash/manage_list"
            },
            web_hook: {
                test: "/webhook/test"
            },
            kms: {
                usage: "/kms/api/corp/usage",
                usage_spaces: "/kms/api/corp/usage/space"
            }
        }),
        FX._API = FX._API || {},
        t.extend(FX._API, {
            corp: {
                role_sort: "/_/admin/corp/role/sort",
                manage_sort: "/_/admin/corp/manage/group/sort",
                contact_sort: "/_/admin/corp/contact/sort",
                excel_upload: "/_/admin/corp/:corpId/excel_upload",
                import_member: "/_/admin/corp/member/excel_import",
                error_export: "/_/admin/corp/member/error_export"
            },
            app: {
                get: "/_/admin/app/:appId",
                update: "/_/admin/app/:appId/update",
                remove: "/_/admin/app/:appId/remove",
                copy: "/_/admin/app/:appId/copy",
                get_config: "/_/admin/app/:appId/get_config",
                set_app_public: "/_/admin/app/:appId/set_app_public",
                ref_apps: "/_/admin/app/:appId/ref_apps",
                ref_app_forms: "/_/admin/app/:appId/ref_app_forms",
                get_ref: "/_/admin/app/:appId/get_ref",
                set_ref: "/_/admin/app/:appId/set_ref",
                get_entry_auth: "/_/admin/app/:appId/entry_auth/get",
                set_entry_auth: "/_/admin/app/:appId/entry_auth/set",
                set_data_auth: "/_/admin/app/:appId/data_auth/set",
                get_data_auth: "/_/admin/app/:appId/member/:memberId/data_auth/get",
                list_entry: "/_/admin/app/:appId/list_entry",
                get_fields: "/_/admin/app/:appId/fields/get",
                get_form_fields: "/_/admin/app/:appId/get_form_fields",
                entry_move: "/_/admin/app/:appId/entry/move",
                data_source_dash: "/_/admin/app/:appId/dash/:dashId/data_source",
                data_source_etl: "/_/admin/app/:appId/etl/:etlId/data_source",
                remove_check: "/_/admin/app/:appId/remove_check",
                item_usage: "/_/admin/app/:appId/check_item_usage",
                trigger: {
                    list: "/_/admin/app/:appId/list_trigger",
                    form_list: "/_/admin/app/:appId/form/:formId/list_trigger",
                    get_config: "/_/admin/app/:appId/trigger/:triggerId/get_config",
                    create: "/_/admin/app/:appId/trigger/create",
                    update: "/_/admin/app/:appId/trigger/:triggerId/update",
                    remove: "/_/admin/app/:appId/trigger/:triggerId/remove",
                    check: "/_/admin/app/:appId/check_trigger",
                    logs: "/_/admin/app/:appId/trigger/:triggerId/logs",
                    operators: "/_/admin/app/:appId/trigger/:triggerId/log_operators"
                },
                log: "/_/admin/app/:appId/logs"
            },
            entry: {
                rename: "/_/admin/app/:appId/entry/:entryId/rename"
            },
            dash: {
                count: "/_/admin/data/dash/preview/count",
                manage_list: "/_/admin/data/dash/preview/manage_list",
                edit: "/_/admin/app/:appId/dash/:entryId/edit",
                create: "/_/admin/app/:appId/dash/create",
                update: "/_/admin/app/:appId/dash/:entryId/update",
                upsert: "/_/admin/app/:appId/dash/:entryId/notify/upsert",
                remove: "/_/admin/app/:appId/dash/:entryId/remove",
                copy: "/_/admin/app/:appId/dash/:entryId/copy",
                widget_create: "/_/admin/app/:appId/dash/:entryId/widget/create",
                widget_update: "/_/admin/app/:appId/dash/:entryId/widget/:widgetId/update",
                widget_remove: "/_/admin/app/:appId/dash/:entryId/widget/:widgetId/remove",
                preview_list: "/_/admin/data/dash/preview/list",
                preview_combined_group: "/_/admin/data/dash/preview/combined_group",
                get_monthly_data: "/_/admin/data/dash/preview/calendar/get_monthly_data",
                get_weekly_data: "/_/admin/data/dash/preview/calendar/get_weekly_data",
                get_daily_data: "/_/admin/data/dash/preview/calendar/get_daily_data",
                check_auth_group: "/_/admin/app/:appId/dash/:entryId/check_auth_group",
                switch_on: "/_/admin/app/:appId/dash/:entryId/switch_on",
                distinct: "/_/admin/data/dash/preview/distinct"
            },
            form: {
                create: "/_/admin/app/:appId/form/create",
                edit: "/_/admin/app/:appId/form/:entryId/edit",
                update: "/_/admin/app/:appId/form/:entryId/update",
                remove: "/_/admin/app/:appId/form/:entryId/remove",
                copy: "/_/admin/app/:appId/form/:entryId/copy",
                cross_app_copy: "/_/admin/app/:appId/form/:formid/cross_app_copy",
                remove_check: "/_/admin/app/:appId/form/:formId/remove_check",
                update_widget_alias: "/_/admin/app/:appId/form/:formId/update_widget_alias",
                auth_group_layout_set: "/_/admin/app/:appId/entry/:entryId/auth_group_layout/set",
                auth_group_layout_get: "/_/admin/app/:appId/entry/:entryId/auth_group_layout/get",
                ext_param: {
                    add: "/_/admin/app/:appId/form/:formId/ext_param/add",
                    remove: "/_/admin/app/:appId/form/:formId/ext_param/remove"
                },
                auth_group: {
                    list: "/_/admin/app/:appId/form/:formId/auth_group/list",
                    get_config: "/_/admin/app/:appId/form/:formId/auth_group/:groupId/get_config",
                    list_name: "/_/admin/app/:appId/form/:formId/auth_group/list_name",
                    create: "/_/admin/app/:appId/form/:formId/auth_group/create",
                    update: "/_/admin/app/:appId/form/:formId/auth_group/update",
                    remove: "/_/admin/app/:appId/form/:formId/auth_group/remove",
                    pt_update: "/_/admin/app/:appId/form/:formId/auth_group/pt_update"
                },
                workflow: {
                    get: "/_/admin/app/:appId/form/:formId/workflows",
                    update: "/_/admin/app/:appId/form/:formId/workflow/update",
                    remove: "/_/admin/app/:appId/form/:formId/workflow/remove",
                    create: "/_/admin/app/:appId/form/:formId/workflow/create",
                    config_version: "/_/admin/app/:appId/form/:formId/workflow/config_version"
                },
                print_tmp: {
                    list: "/_/admin/app/:appId/form/:formId/pt/list",
                    create: "/_/admin/app/:appId/form/:formId/pt/create",
                    fields: "/_/admin/app/:appId/form/:formId/pt/fields",
                    get: "/_/admin/app/:appId/form/:formId/pt/:printId/get",
                    copy: "/_/admin/app/:appId/form/:formId/pt/:printId/copy",
                    update: "/_/admin/app/:appId/form/:formId/pt/:printId/update",
                    remove: "/_/admin/app/:appId/form/:formId/pt/:printId/remove",
                    get_apply_node: "/_/admin/app/:appId/form/:formId/pt/:printId/get_apply_node",
                    set_apply_node: "/_/admin/app/:appId/form/:formId/pt/:printId/set_apply_node",
                    preview: "/_/admin/print/preview"
                },
                notify: {
                    create: "/_/admin/app/:appId/form/:formId/notify/create",
                    update: "/_/admin/app/:appId/form/:formId/notify/:notifyId/update",
                    remove: "/_/admin/app/:appId/form/:formId/notify/:notifyId/remove",
                    list: "/_/admin/app/:appId/form/:formId/notify/list"
                },
                web_hook: {
                    create: "/_/admin/app/:appId/entry/:entryId/webhook/create",
                    list: "/_/admin/app/:appId/entry/:entryId/webhook/list",
                    update: "/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/update",
                    remove: "/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/remove",
                    logs: "/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/logs",
                    discard_failures: "/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/discard_failures",
                    retry_failures: "/_/admin/app/:appId/entry/:entryId/webhook/:webhookId/retry_failures"
                },
                data_label: {
                    get: "/_/admin/app/:appId/entry/:entryId/get_data_label",
                    set: "/_/admin/app/:appId/entry/:entryId/set_data_label"
                },
                qr_print: {
                    get: "/_/admin/app/:appId/entry/:entryId/get_qr_style",
                    set: "/_/admin/app/:appId/entry/:entryId/set_qr_style"
                },
                file_task: {
                    remove: "/_/admin/app/:appId/filetask/:taskId/delete",
                    zip: "/_/admin/app/:appId/form/:formId/filetask/mkzip",
                    list: "/_/admin/app/:appId/form/:formId/filetask/list"
                },
                submit_prompt: {
                    get: "/_/admin/app/:appId/entry/:entryId/get_submit_prompt",
                    set: "/_/admin/app/:appId/entry/:entryId/set_submit_prompt"
                },
                data_comment: {
                    get: "/_/admin/app/:appId/entry/:entryId/comment/get",
                    set: "/_/admin/app/:appId/entry/:entryId/comment/set"
                },
                trash_field: {
                    list: "/_/admin/app/:appId/form/:formId/field_trash/list",
                    remove: "/_/admin/app/:appId/form/:formId/field_trash/remove"
                }
            },
            report: {
                create: "/_/admin/app/:appId/report/create",
                edit: "/_/admin/app/:appId/report/:entryId/edit",
                update: "/_/admin/app/:appId/report/:entryId/update",
                remove: "/_/admin/app/:appId/report/:entryId/remove",
                copy: "/_/admin/app/:appId/report/:entryId/copy",
                preview_list: "/_/admin/data/preview/list",
                preview_combined_group: "/_/admin/data/preview/combined_group",
                preview_chart_group: "/_/admin/data/preview/chart_group"
            },
            aggregate_table: {
                create: "/_/admin/app/:appId/aggregate_table/create",
                edit: "/_/admin/app/:appId/aggregate_table/:entryId/edit",
                update: "/_/admin/app/:appId/aggregate_table/:entryId/update",
                remove: "/_/admin/app/:appId/aggregate_table/:entryId/remove",
                list: "/_/admin/app/:appId/aggregate_table/list"
            },
            group: {
                create: "/_/admin/app/:appId/group/create",
                update: "/_/admin/app/:appId/group/:entryId/update",
                remove: "/_/admin/app/:appId/group/:entryId/remove"
            },
            data: {
                allow_activate_nodes: "/_/admin/data/allow_activate_nodes",
                batch_close: "/_/admin/data/flow_batch_close",
                batch_check_formula: "/_/admin/data/batch_update/check_formula",
                batch_qr: "/_/admin/data/batch_qr",
                batch_update: "/_/admin/data/batch_update",
                batch_update_tasks: "/_/admin/data/batch_update_tasks",
                comment_create: "/_/admin/data/log/create_comment",
                comment_list: "/_/admin/data/log/list_comments",
                log_list: "/_/admin/data/log/list_changes",
                count: "/_/admin/data/count",
                create: "/_/admin/data/create",
                current_departments: "/_/admin/data/member/current_departments",
                departments: "/_/admin/data/member/departments",
                distinct: "/_/admin/data/distinct",
                distinct_report: "/_/admin/data/report/distinct",
                excel_template: "/_/admin/data/list/excel_template",
                filter_link: "/_/admin/data/filter_link",
                find: "/_/admin/data/find",
                manage_list: "/_/admin/data/dash/preview/manage_list",
                find_excel_export: "/_/admin/data/find/excel_export",
                flow_chargers: "/_/admin/data/flow_chargers",
                flow_change: "/_/admin/data/flow_change",
                flow_comment_list: "/_/admin/data/log/flow/list_approval_comments",
                flow_creators: "/_/admin/data/flow_creators",
                hard_remove: "/_/admin/data/hard_remove",
                link: "/_/admin/data/link",
                log_flow: "/_/admin/data/log/flow/list_all",
                print: "/_/admin/data/print",
                batch_print: "/_/admin/data/batch_print",
                batch_print_task_list: "/_/admin/data/batch_print/task/list",
                batch_print_task_remove: "/_/admin/data/batch_print/task/remove",
                read: "/_/admin/data/read",
                read_link: "/_/admin/data/read_link",
                read_link_query: "/_/admin/data/read_link_query",
                recover: "/_/admin/data/recover",
                remove: "/_/admin/data/remove",
                roles: "/_/admin/data/member/roles",
                transfer_list: "/_/admin/data/log/flow/list_forwards",
                signature: "/_/admin/data/signature/get_qr_link",
                update: "/_/admin/data/update",
                user_dept_role: "/_/admin/data/member/dept_role_users",
                users: "/_/admin/data/member/users",
                view: "/_/admin/data/view",
                get_sms_code: "/_/admin/data/phone/get_verify_code",
                check_sms_code: "/_/admin/data/phone/check_verify_code",
                form_event_trigger: "/_/admin/data/form_event_trigger"
            },
            flow: {
                batch_transfer_tasks: "/_/admin/app/:appId/workflow/batch_transfer_tasks",
                batch_transfer: "/_/admin/app/:appId/workflow/batch_transfer",
                query_node: "/_/admin/app/:appId/workflow/query_node"
            },
            excel: {
                check_data: "/_/admin/app/:appId/excel/check_data",
                create_entry: "/_/admin/app/:appId/excel/create_entry",
                get_sample: "/_/admin/app/:appId/excel/get_sample",
                import: "/_/admin/app/:appId/excel/import",
                import_update: "/_/admin/app/:appId/entry/:entryId/excel/import_update",
                import_upsert: "/_/admin/app/:appId/entry/:entryId/excel/import_upsert",
                match_head: "/_/admin/app/:appId/excel/match_head",
                upload: "/_/admin/app/:appId/excel/upload"
            },
            etl: {
                create: "/_/admin/app/:appId/etl/create",
                formula: "/_/admin/app/:appId/etl/:entryId/check_formula",
                list: "/_/admin/app/:appId/list_etl",
                get_fields: "/_/admin/app/:appId/etl_table/:entryId/get_fields",
                remove: "/_/admin/app/:appId/etl/:entryId/remove",
                logs: "/_/admin/app/:appId/etl/:entryId/logs",
                execute: "/_/admin/app/:appId/etl/:entryId/execute",
                update: "/_/admin/app/:appId/etl/:entryId/update",
                edit: "/_/admin/app/:appId/etl/:entryId/edit",
                get_stage_fields: "/_/admin/app/:appId/etl/:entryId/get_stage_fields",
                preview: "/_/admin/data/etl/preview/list"
            },
            file: {
                get_qn_data_token: "/_/admin/data/upload_token/file"
            },
            formula: {
                aggregate: "/_/admin/data/formula/aggregate",
                map: "/_/admin/data/formula/map",
                recno: "/_/admin/data/formula/recno"
            },
            message: {
                config: "/_/admin/corp/:corpId/config/message",
                config_update: "/_/admin/corp/:corpId/config/message_update"
            }
        })
}(jQuery),
    function(s) {
        window.FX = window.FX || {};
        var a = {};
        s.shortcut = function(t, e) {
            if (null != a[t])
                throw "shortcut:[" + t + "] has been registered";
            a[t] = e,
                s.extend(e.prototype, {
                    xtype: t
                })
        }
            ,
            FX.createWidget = function(t) {
                if (t instanceof s)
                    return new FX.Widget({
                        renderEl: t
                    });
                var e = t.type.toLowerCase()
                    , i = a[e];
                if (!i)
                    throw e + " does not exist";
                return new i(t)
            }
            ,
            FX.extend = function(t, e, i) {
                "object" == typeof e && (i = e,
                        e = t,
                        t = function() {
                            e.apply(this, arguments)
                        }
                );
                function a() {}
                var n = e.prototype;
                return a.prototype = n,
                    t.prototype = new a,
                    t.superclass = n,
                    s.extend(t.prototype, i),
                    t
            }
            ,
            FX.STATIC = {
                _st: (new Date).getTime(),
                _ct: (new Date).getTime(),
                zIndex: 8e3,
                Language: "zh",
                num: 0,
                IDBase: +new Date,
                CSRF: s('meta[name="csrf-token"]').attr("content"),
                site: window.location.protocol + "//" + window.location.hostname
            }
    }(jQuery),
    function(s) {
        FX.Cookie = FX.Cookie || {},
            s.extend(FX.Cookie, {
                _encode: function(t) {
                    return this.raw ? t : encodeURIComponent(t)
                },
                _decode: function(t) {
                    return this.raw ? t : decodeURIComponent(t)
                },
                _stringifyCookieValue: function(t) {
                    return this._encode(this.json ? JSON.stringify(t) : String(t))
                },
                _parseCookieValue: function(t) {
                    0 === t.indexOf('"') && (t = t.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\"));
                    try {
                        return t = decodeURIComponent(t.replace(/\+/g, " ")),
                            this.json ? JSON.parse(t) : t
                    } catch (t) {}
                },
                _read: function(t, e) {
                    var i = this.raw ? t : this._parseCookieValue(t);
                    return s.isFunction(e) ? e(i) : i
                },
                set: function(t, e, i) {
                    var a, n;
                    if (1 < arguments.length && !s.isFunction(e))
                        return "number" == typeof (i = s.extend({
                            expires: new Date((new Date).getTime() + 1728e6),
                            domain: FX.CONFIG.COOKIE_DOMAIN
                        }, i)).expires && (a = i.expires,
                            (n = i.expires = new Date).setMilliseconds(n.getMilliseconds() + 864e5 * a)),
                            document.cookie = [this._encode(t), "=", this._stringifyCookieValue(e), i.expires ? "; expires=" + i.expires.toUTCString() : "", i.path ? "; path=" + i.path : "", i.domain ? "; domain=" + i.domain : "", i.secure ? "; secure" : ""].join("")
                },
                get: function(t, e) {
                    for (var i = t ? void 0 : {}, a = document.cookie ? document.cookie.split("; ") : [], n = 0, s = a.length; n < s; n++) {
                        var r = a[n].split("=")
                            , o = this._decode(r.shift())
                            , l = r.join("=");
                        if (t === o) {
                            i = this._read(l, e);
                            break
                        }
                        t || void 0 === (l = this._read(l)) || (i[o] = l)
                    }
                    return i
                },
                remove: function(t, e) {
                    return this.set(t, "", s.extend({}, e, {
                        expires: -1
                    })),
                        !this.set(t)
                }
            })
    }(jQuery),
    function() {
        var t = "zh_cn"
            , e = FX.Cookie.get("fx-lang")
            , i = {
            ns: ["transition", "fallback"],
            initImmediate: !1,
            lowerCaseLng: !0,
            fallbackLng: ["zh_cn", "zh_tw", "en_us"],
            fallbackNS: "fallback",
            keySeparator: "#",
            returnEmptyString: !1
        };
        e && (i.lng = e),
            i18next.use(i18nextBrowserLanguageDetector).init(i);
        var a = {
            "zh-cn": "zh_cn",
            "zh-tw": "zh_tw",
            zh_cn: "zh_cn",
            zh_tw: "zh_tw",
            "en-us": "en_us",
            en_us: "en_us"
        }[i18next.language] || t;
        i18next.addResourceBundle(a, "translation", window.JDY_Locale[a.toUpperCase()]),
            i18next.addResourceBundle(a, "fallback", window.JDY_Locale[t.toUpperCase()])
    }(),
    function(t) {
        var e = window._jdy_config || {};
        t.extend(FX, {
            CONFIG: {
                HOST: {
                    SITE_HOST: e.site,
                    SITE_SHORT_HOST: (e.site || "").replace("www.", ""),
                    IMAGE_HOST: "https://images.jiandaoyun.com",
                    VIDEO_HOST: "https://video.jiandaoyun.com",
                    OSS_IMAGE_HOST: "https://oss-image.jiandaoyun.com",
                    HELP_DOC_HOST: "https://hc.jiandaoyun.com/doc",
                    HELP_OPEN_DOC_HOST: "https://hc.jiandaoyun.com/open",
                    HELP_UPDATE_HOST: "https://hc.jiandaoyun.com/update",
                    HELP_VIDEO_HOST: "https://hc.jiandaoyun.com/video",
                    HELP_BLOG_HOST: "https://hc.jiandaoyun.com/blog",
                    HELP_SOLUTION_HOST: "https://hc.jiandaoyun.com/solution",
                    GUIDE_VIDEO_HOST: "https://blog-assets.jiandaoyun.com",
                    TRACK_HOST: e.track_log_host,
                    ASSETS_HOST: e.assets_site,
                    LINK_QUERY_HOST: e.link_site + "/q/",
                    LINK_REPORT_HOST: e.link_site + "/r/",
                    LINK_DASH_HOST: e.link_site + "/dash/",
                    GEOJSON_SITE: e.geojson_site,
                    API_SITE: e.api_site,
                    KMS_SITE: e.kms_site,
                    WEBSOCKET_SITE: e.websocket_site
                },
                COOKIE_DOMAIN: e.cookie_domain
            },
            ValueWidgets: {
                text: 1,
                number: 1,
                textarea: 1,
                datetime: 1,
                checkboxgroup: 1,
                radiogroup: 1,
                combo: 1,
                combocheck: 1,
                address: 1,
                image: 1,
                upload: 1,
                signature: 1,
                subform: 1,
                user: 1,
                usergroup: 1,
                dept: 1,
                deptgroup: 1,
                location: 1,
                linkdata: 1,
                sn: 1,
                phone: 1
            },
            ValueTypeMap: {
                text: "string",
                textarea: "string",
                combo: "string",
                radiogroup: "string",
                user: "id",
                combocheck: "array",
                checkboxgroup: "array",
                usergroup: "idarray",
                number: "number",
                datetime: "datetime",
                address: "address",
                location: "address",
                dept: "did",
                deptgroup: "didarray",
                upload: "upload",
                image: "upload",
                signature: "signature",
                sn: "string",
                phone: "phone"
            },
            USER_ID: {
                CurrentUser: "100000000000000000000001",
                SYS_ROBOT: "100000000000000000000002"
            },
            DATA_PREFIX: {
                Aggregate: "2"
            },
            WidgetValueOption: {
                CUSTOM: 0,
                ASYNC: 1,
                RELY: 2,
                FORMULA: 3
            },
            Keys: {
                ENTER: 13,
                BACKSPACE: 8,
                COMMA: 188,
                DELETE: 46,
                DOWN: 40,
                END: 35,
                ESCAPE: 27,
                HOME: 36,
                LEFT: 37,
                PAGE_DOWN: 34,
                PAGE_UP: 33,
                PERIOD: 190,
                RIGHT: 39,
                SPACE: 32,
                TAB: 9,
                UP: 38
            },
            States: {
                NORMAL: 0,
                SUCCESS: 1,
                ERROR: 2,
                WARNING: 3
            },
            EntryAttributes: {
                creator: 1,
                createTime: 1,
                updateTime: 1,
                ext: 1
            },
            Time: {
                excelDayOffset: 25569,
                millisecondsOfDay: 864e5
            },
            TimeZone: {
                defaultOffset: 288e5
            },
            Events: {
                RELY: "x-rely"
            },
            InvisibleSubmitRules: {
                KEEP: 1,
                NULL: 2,
                ALWAYS: 3
            },
            LimitFields: {
                dataManage: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "image", "upload", "signature", "subform", "linkdata", "sn", "phone", "wx_avatar", "wx_nickname", "wx_gender", "wx_open_id"],
                subform: ["text", "textarea", "number", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "address", "location", "image", "upload", "linkquery", "linkdata", "user", "usergroup", "dept", "deptgroup"],
                queryFilter: ["text", "radiogroup", "combo", "number", "datetime", "address", "user", "sn", "phone"],
                parameter: ["text", "radiogroup", "combo", "number", "datetime", "address", "user", "dept", "subform"],
                filter: ["text", "textarea", "radiogroup", "checkboxgroup", "combo", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "flowstate", "flownode", "image", "upload", "signature", "sn", "phone", "wx_avatar", "wx_nickname", "wx_gender", "wx_open_id"],
                reportFilter: ["text", "textarea", "radiogroup", "checkboxgroup", "combo", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "flowstate", "flownode", "image", "upload", "signature"],
                formulaValue: ["number", "text", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "user", "usergroup", "subform", "linkdata"],
                formulaName: ["number", "text", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "user", "usergroup"],
                reportDataAuth: ["text", "textarea", "radiogroup", "checkboxgroup", "combo", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "flowstate", "flownode"],
                list: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "image", "upload", "signature", "subform", "linkdata"],
                listJoin: ["text", "combo", "radiogroup", "number", "user", "dept"],
                group: ["text", "radiogroup", "combo", "number", "datetime", "address", "string", "subform", "user", "dept", "id", "location", "linkdata"],
                subGroup: ["text", "combo", "number", "datetime", "linkdata"],
                groupJoin: ["text", "combo", "radiogroup", "number", "user", "datetime", "address", "location", "subform", "linkdata", "dept"],
                subGroupJoin: ["text", "combo", "number", "datetime", "linkdata"],
                validate: ["number", "text", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "user", "usergroup", "linkdata", "dept", "deptgroup", "subform"],
                rely: ["combo", "combocheck", "text", "datetime", "number", "subform", "radiogroup", "checkboxgroup", "user", "linkdata", "dept"],
                link: ["combo", "combocheck", "text", "textarea", "datetime", "number", "radiogroup", "checkboxgroup", "address", "user", "usergroup", "linkdata", "dept", "deptgroup", "sn"],
                subLink: ["combo", "combocheck", "text", "textarea", "datetime", "number", "address", "location", "user", "usergroup", "dept", "deptgroup"],
                brief: ["text", "textarea", "combo", "radiogroup", "combocheck", "checkboxgroup", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "sn", "phone"],
                import: ["text", "textarea", "combo", "radiogroup", "combocheck", "checkboxgroup", "number", "datetime", "address", "subform", "user", "usergroup", "dept", "deptgroup", "phone"],
                combodata: ["combo", "combocheck", "text", "datetime", "number", "radiogroup", "checkboxgroup", "sn"],
                linkFilter: ["combo", "combocheck", "text", "textarea", "datetime", "number", "radiogroup", "checkboxgroup", "address", "user", "usergroup", "linkdata", "dept", "deptgroup"],
                linkFormFilter: ["combo", "combocheck", "text", "textarea", "datetime", "number", "radiogroup", "checkboxgroup", "address", "location", "user", "usergroup", "linkdata", "dept", "deptgroup", "sn"],
                linkData: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "upload", "image", "signature", "user", "usergroup", "dept", "deptgroup", "subform", "sn", "phone"],
                linkKey: ["text", "number", "datetime", "radiogroup", "combo", "sn"],
                subLinkData: ["text", "combo", "combocheck", "radiogroup", "checkboxgroup", "number", "datetime", "address", "location", "sn", "phone", "image", "upload"],
                aggregate: ["text", "radiogroup", "combo", "string", "subform", "linkdata"],
                batchEdit: ["number", "text", "textarea", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "address", "user", "usergroup", "dept", "deptgroup", "phone"],
                batchEditFormula: ["number", "text", "textarea", "datetime", "radiogroup", "combo", "phone"],
                batchEditFormulaField: ["number", "text", "datetime", "radiogroup", "combo"],
                fileExport: ["image", "upload"],
                fileExportName: ["text", "number", "radiogroup", "combo", "user"],
                itemLink: ["combo", "radiogroup"],
                unCopy: ["sn"],
                fieldQrcode: ["text", "sn"],
                printTemplate: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "linkdata", "flow", "image", "signature", "sn", "dataQr", "fieldQr", "phone", "sequence", "wx_avatar", "wx_nickname", "wx_gender", "wx_open_id"],
                excelExport: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "linkdata", "sn", "phone", "upload", "image", "signature", "wx_avatar", "wx_nickname", "wx_gender", "wx_open_id"],
                noCache: ["location", "separator", "linkquery", "sn"],
                dataLabel: ["text", "number", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "address", "location", "user", "usergroup", "dept", "deptgroup", "sn", "phone"],
                sort: ["text", "number", "radiogroup", "datetime", "combo", "linkdata", "sn"],
                dashSort: ["text", "number", "radiogroup", "datetime", "combo", "sn", "formula"],
                dashCustomSort: ["text", "radiogroup", "combo", "sn", "ext"],
                dashDimension: ["text", "radiogroup", "checkboxgroup", "combo", "combocheck", "datetime", "address", "subform", "user", "dept", "usergroup", "deptgroup", "location", "sn", "flowState"],
                dashQuota: ["text", "combo", "radiogroup", "datetime", "address", "location", "number", "user", "dept", "subform", "sn", "formula"],
                dashFilter: ["text", "radiogroup", "checkboxgroup", "combo", "combocheck", "datetime", "address", "user", "dept", "usergroup", "deptgroup", "location", "number", "sn", "flowState"],
                dashField: ["text", "number", "radiogroup", "checkboxgroup", "combo", "combocheck", "datetime", "address", "subform", "user", "dept", "usergroup", "deptgroup", "location", "linkdata", "sn", "flowState"],
                dashTableField: ["text", "textarea", "number", "radiogroup", "combo", "checkboxgroup", "combocheck", "datetime", "address", "subform", "user", "dept", "usergroup", "deptgroup", "usergroup", "deptgroup", "location", "linkdata", "formula", "image", "upload", "signature", "sn", "flowState", "phone"],
                multipleField: ["checkboxgroup", "combocheck", "usergroup", "deptgroup"],
                dashTableFilter: ["text", "textarea", "radiogroup", "checkboxgroup", "combo", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "image", "upload", "signature", "sn", "flowState", "phone"],
                dashTableFormula: ["number"],
                dashCompFilter: ["text_filter", "textarea_filter", "combocheck_filter", "user_filter", "usergroup_filter", "number_filter", "address_filter", "date_filter", "datetime_filter", "date_month_filter", "date_minute_filter", "dept_filter", "deptgroup_filter", "flowstate_filter", "phone_filter", "filelist_filter"],
                dashCompChart: ["metric_table", "data_table", "pivot_table", "line_chart", "column_chart", "bar_chart", "area_chart", "pie_chart", "radar_chart", "calendar_manage", "data_manage"],
                dashRowOrderChart: ["data_table", "pivot_table"],
                dashTopDataChart: ["metric_table", "data_table", "pivot_table", "column_chart", "bar_chart", "pie_chart", "multi_axes_chart"],
                dashCustomAxisLabelChart: ["line_chart", "column_chart", "area_chart", "multi_axes_chart"],
                dashCustomAxisRangeChart: ["line_chart", "column_chart", "bar_chart", "area_chart", "radar_chart", "multi_axes_chart"],
                dashAxisChart: ["line_chart", "column_chart", "bar_chart", "area_chart", "radar_chart", "multi_axes_chart"],
                etlInput: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "subform", "sn", "image", "upload", "signature"],
                etlMapFormula: ["number", "datetime"],
                etlDimension: ["text", "radiogroup", "checkboxgroup", "combo", "combocheck", "datetime", "address", "subform", "user", "dept", "usergroup", "deptgroup", "location", "sn", "flowState"],
                etlQuota: ["text", "combo", "radiogroup", "datetime", "address", "location", "number", "user", "dept", "subform", "sn", "formula", "flowState"],
                triggerCond: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "flowstate", "sn"],
                triggerQuery: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "user", "usergroup", "dept", "deptgroup", "flowstate", "sn"],
                triggerWrite: ["text", "textarea", "combo", "radiogroup", "checkboxgroup", "combocheck", "number", "datetime", "address", "location", "user", "usergroup", "dept", "deptgroup", "image", "upload"],
                disable: ["text", "textarea", "number", "datetime", "radiogroup", "checkboxgroup", "combo", "combocheck", "address", "location", "phone"],
                userDept: ["user", "usergroup", "dept", "deptgroup"],
                aliasReserve: ["creator", "updater", "createTime", "updateTime", "deleter", "deleteTime", "flowState", "formName", "ext", "operator", "chargers", "ccUsers", "transactors", "flowStack", "flowVer", "label", "appId", "entryId", "state", "expireTime", "ip", "userAgent", "schedule", "handlers"],
                noSaveValue: ["linkquery", "combo", "combocheck", "radiogroup", "checkboxgroup"],
                dashThresholds: ["metric_table", "pivot_table", "line_chart", "column_chart", "bar_chart", "multi_axes_chart"],
                dashGuideline: ["line_chart", "column_chart", "bar_chart", "area_chart", "multi_axes_chart"],
                dashColors: ["line_chart", "column_chart", "bar_chart", "area_chart", "pie_chart", "radar_chart", "multi_axes_chart", "map_chart"],
                dashChartLabel: ["line_chart", "column_chart", "bar_chart", "area_chart", "pie_chart", "radar_chart", "multi_axes_chart", "map_chart"],
                dashLegend: ["line_chart", "column_chart", "bar_chart", "area_chart", "pie_chart", "radar_chart", "multi_axes_chart"],
                dashChangedColors: ["line_chart", "column_chart", "bar_chart", "area_chart", "radar_chart", "multi_axes_chart", "pie_chart"],
                dashMobileLayout: ["metric_table", "data_table", "pivot_table", "line_chart", "column_chart", "bar_chart", "area_chart", "pie_chart", "radar_chart", "calendar_manage", "data_manage", "multi_axes_chart", "map_chart", "description"],
                systemFields: ["creator", "createTime", "updateTime", "flowState", "chargers", "ext"],
                wechatFields: ["wx_avatar", "wx_nickname", "wx_gender", "wx_open_id"]
            },
            Operators: {
                group: ["+", "-", "*", "/", "."],
                aggregate: ["+", "-", "."]
            },
            MOCK_RES_DATA: {
                sn: "00001",
                text: "",
                textarea: "",
                number: 10,
                datetime: "2018-01-01T10:10:10.000Z",
                radiogroup: "",
                checkboxgroup: ["1", "2"],
                combo: "",
                combocheck: ["1", "2"],
                address: {
                    province: "",
                    city: "",
                    district: "",
                    detail: "138"
                },
                location: {
                    province: "",
                    city: "",
                    district: "",
                    detail: "138",
                    lnglatXY: [120.31237, 31.49099]
                },
                image: [{
                    name: "image1.png",
                    size: 262144,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/cqbrmcwhxm"
                }, {
                    name: "image2.png",
                    size: 262100,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/cqbrywmwh"
                }],
                upload: [{
                    name: ".pdf",
                    size: 524288,
                    mime: "application/pdf",
                    url: "https://files.jiandaoyun.com/ojiwvfeyt"
                }, {
                    name: ".pdf",
                    size: 524288,
                    mime: "application/pdf",
                    url: "https://files.jiandaoyun.com/mst"
                }],
                linkdata: {
                    id: "5b237548b22ab14884086cc0",
                    key: ""
                },
                signature: {
                    name: "signature_1238921857.png",
                    size: 1024,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/ojiwsdf"
                },
                user: {
                    name: "",
                    username: "xiaojian"
                },
                usergroup: [{
                    name: "",
                    username: "xiaojian"
                }, {
                    name: "",
                    username: "xiaodao"
                }],
                dept: {
                    name: "",
                    dept_no: 1
                },
                deptgroup: [{
                    name: "",
                    dept_no: 1
                }, {
                    name: "",
                    dept_no: 2
                }],
                phone: {
                    phone: "15852540044",
                    verified: !1
                },
                appId: "5b237267b22ab14884086c49",
                entryId: "5b237267b22ab14884086cc9",
                _id: "5b237267b22ab14884086cc9",
                ext: "",
                flowState: 0
            },
            MOCK_CREATE_DATA: {
                sn: "00001",
                text: "",
                textarea: "",
                number: 10,
                datetime: "2018-01-01T10:10:10.000Z",
                radiogroup: "",
                checkboxgroup: ["1", "2"],
                combo: "",
                combocheck: ["1", "2"],
                address: {
                    province: "",
                    city: "",
                    district: "",
                    detail: "138"
                },
                location: {
                    province: "",
                    city: "",
                    district: "",
                    detail: "138",
                    lnglatXY: [120.31237, 31.49099]
                },
                image: [{
                    name: "image1.png",
                    size: 262144,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/cqbrmcwhxm"
                }, {
                    name: "image2.png",
                    size: 262100,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/cqbrywmwh"
                }],
                upload: [{
                    name: ".pdf",
                    size: 524288,
                    mime: "application/pdf",
                    url: "https://files.jiandaoyun.com/ojiwvfeyt"
                }, {
                    name: ".pdf",
                    size: 524288,
                    mime: "application/pdf",
                    url: "https://files.jiandaoyun.com/mst"
                }],
                linkdata: {
                    id: "5b237548b22ab14884086cc0",
                    key: ""
                },
                signature: {
                    name: "signature_1238921857.png",
                    size: 1024,
                    mime: "image/png",
                    url: "https://files.jiandaoyun.com/ojiwsdf"
                },
                user: "jian",
                usergroup: ["jian", "dao"],
                dept: 12,
                deptgroup: [12, 13],
                phone: {
                    phone: "15852540044"
                },
                appId: "5b237267b22ab14884086c49",
                entryId: "5b237267b22ab14884086cc9",
                _id: "5b237267b22ab14884086cc9",
                ext: "",
                flowState: 0
            },
            CONST: {
                LANG: {
                    CN: "",
                    TW: "",
                    EN: "English (beta)"
                },
                MAX_COUNT: 1e5,
                MAX_TODO_COUNT: 99,
                MAX_FORMULA_FIELD: 80,
                MAX_FORMULA_OPERATOR: 80,
                MAX_DASH_SORT_COUNT: 5,
                MAX_DASH_CUSTOM_SORT_COUNT: 5,
                MAX_DINGTALK_SHORTCUT_COUNT: 20,
                REPORT_REBUILD_WAIT: 500,
                DATA_COUNT_TIMEOUT: 3e3,
                MIN_RECEIPT_PRICE: 1e3,
                DASH_SORT_ERROR: {
                    MAX_COUNT: "max_count",
                    MAX_CUSTOM_SORT_COUNT: "max_custom_sort_count"
                },
                DATA_STATE: {
                    ACTIVE: 1,
                    DELETED: 3
                },
                WIDGET_LIST: {
                    text: {
                        name: i18next.t("widget.text"),
                        changeList: ["combo", "radiogroup"],
                        subChangeList: ["combo", "radiogroup"]
                    },
                    radiogroup: {
                        name: i18next.t("widget.radiogroup"),
                        changeList: ["combo", "text"],
                        subChangeList: ["combo", "text"]
                    },
                    combo: {
                        name: i18next.t("widget.combo"),
                        changeList: ["radiogroup", "text"],
                        subChangeList: ["text", "radiogroup"]
                    },
                    checkboxgroup: {
                        name: i18next.t("widget.checkboxgroup"),
                        changeList: ["combocheck"],
                        subChangeList: ["combocheck"]
                    },
                    combocheck: {
                        name: i18next.t("widget.combocheck"),
                        changeList: ["checkboxgroup"],
                        subChangeList: ["checkboxgroup"]
                    },
                    number: {
                        name: i18next.t("widget.number")
                    },
                    datetime: {
                        name: i18next.t("widget.datetime")
                    },
                    address: {
                        name: i18next.t("widget.address")
                    },
                    textarea: {
                        name: i18next.t("widget.textarea")
                    },
                    image: {
                        name: i18next.t("widget.image")
                    },
                    upload: {
                        name: i18next.t("widget.upload")
                    },
                    subform: {
                        name: i18next.t("widget.subform")
                    },
                    separator: {
                        name: i18next.t("widget.separator")
                    },
                    user: {
                        name: i18next.t("widget.user")
                    },
                    usergroup: {
                        name: i18next.t("widget.usergroup")
                    },
                    location: {
                        name: i18next.t("widget.location")
                    },
                    linkdata: {
                        name: i18next.t("widget.linkdata")
                    },
                    linkquery: {
                        name: i18next.t("widget.linkquery")
                    },
                    dept: {
                        name: i18next.t("widget.dept")
                    },
                    deptgroup: {
                        name: i18next.t("widget.deptgroup")
                    },
                    signature: {
                        name: i18next.t("widget.signature")
                    },
                    sn: {
                        name: i18next.t("widget.sn")
                    },
                    phone: {
                        name: i18next.t("widget.phone")
                    }
                },
                LIMIT_FORMULA: {
                    etl_map: ["ABS", "AVERAGE", "CEILING", "FLOOR", "INT", "MAX", "MIN", "MOD", "POWER", "ROUND", "SQRT", "AND", "FALSE", "IF", "IFS", "NOT", "OR", "TRUE", "XOR", "DATEDELTA", "DATEDIF", "DAY", "DAYS", "HOUR", "ISOWEEKNUM", "MINUTE", "MONTH", "SECOND", "YEAR"]
                },
                CHINA_CODE: "+86",
                AREA_CODE: [{
                    value: "+86",
                    text: i18next.t("china")
                }, {
                    value: "+886",
                    text: i18next.t("taiwan")
                }, {
                    value: "+852",
                    text: i18next.t("hongkong")
                }, {
                    value: "+853",
                    text: i18next.t("macao")
                }],
                API_VALUE_TYPE_MAP: {
                    sn: "string",
                    text: "string",
                    textarea: "string",
                    number: "number",
                    datetime: "string",
                    radiogroup: "string",
                    checkboxgroup: "array",
                    combo: "string",
                    combocheck: "array",
                    address: "json",
                    location: "json",
                    linkdata: "json",
                    user: "json",
                    usergroup: "array",
                    dept: "json",
                    deptgroup: "array",
                    image: "array",
                    upload: "array",
                    signature: "json",
                    flowState: "number",
                    subform: "array",
                    phone: "json"
                },
                APP_CATE_NAME: {
                    quick_start: i18next.t("app.category.quickStart"),
                    rank: i18next.t("app.category.rank"),
                    application: i18next.t("app.category.application"),
                    common: i18next.t("app.category.common"),
                    feature: i18next.t("app.category.feature"),
                    it: i18next.t("app.category.it"),
                    manufacturing: i18next.t("app.category.manufacturing"),
                    trade: i18next.t("app.category.trade"),
                    service: i18next.t("app.category.service"),
                    education: i18next.t("app.category.education"),
                    housing: i18next.t("app.category.housing"),
                    financial: i18next.t("app.category.financial"),
                    medicine: i18next.t("app.category.medicine"),
                    government: i18next.t("app.category.government"),
                    logistics: i18next.t("app.category.logistics"),
                    business_service: i18next.t("app.category.businessService"),
                    hr: i18next.t("app.category.hr"),
                    audit: i18next.t("app.category.audit"),
                    office: i18next.t("app.category.office"),
                    inventory: i18next.t("app.category.inventory"),
                    store: i18next.t("app.category.store"),
                    crm: i18next.t("app.category.crm"),
                    sales: i18next.t("app.category.sales"),
                    project: i18next.t("app.category.project"),
                    production: i18next.t("app.category.production"),
                    asset_equipment: i18next.t("app.category.assetEquipment"),
                    update: i18next.t("app.category.update"),
                    form: i18next.t("app.category.form"),
                    flow: i18next.t("app.category.flow"),
                    dashboard: i18next.t("app.category.dashboard"),
                    aggregate: i18next.t("app.category.aggregate"),
                    print: i18next.t("app.category.print"),
                    trigger: i18next.t("app.category.trigger"),
                    etl: i18next.t("app.category.etl")
                },
                APP_CATE_MAP: {
                    quick_start: ["quick_start"],
                    rank: ["rank"],
                    application: ["hr", "audit", "office", "inventory", "store", "crm", "sales", "project", "production", "asset_equipment"],
                    common: ["it", "manufacturing", "trade", "service", "education", "housing", "financial", "medicine", "government", "logistics", "business_service"],
                    feature: ["update", "form", "flow", "dashboard", "aggregate", "print", "trigger", "etl"]
                },
                FLOW_ACTION_NAME: {
                    forward: i18next.t("flow.action.forward"),
                    save: i18next.t("flow.action.save"),
                    print: i18next.t("flow.action.print"),
                    back: i18next.t("flow.action.back"),
                    transfer: i18next.t("flow.action.transfer"),
                    close: i18next.t("flow.action.close"),
                    revoke: i18next.t("flow.action.revoke"),
                    batchForward: i18next.t("flow.action.batchForward")
                },
                QN_BUCKET: {
                    PUBLIC_IMAGE: "media",
                    PRIVATE_FILE: "file"
                },
                OSS_BUCKET: {
                    PUBLIC_IMAGE: "oss_image"
                },
                UPLOAD_URL: {
                    oss: "https://jdy-image.oss-cn-hangzhou.aliyuncs.com",
                    qn: "https://upload.qiniup.com/"
                },
                WORKFLOW: {
                    NODE_DELIMITER: "@",
                    START_FLOW_ID: 0,
                    END_FLOW_ID: -1,
                    APPROVAL_ALL: 0,
                    APPROVAL_ANY: 1,
                    BACKRULE: {
                        DISALLOW: 0,
                        PARENT_NODE: 1,
                        RANGE_NODE: 2
                    },
                    FLOWSTATE: {
                        INPROCESS: 0,
                        COMPLETE: 1,
                        CLOSE: 2
                    },
                    FLOWSTATEINFO: {
                        INPROCESS: {
                            text: i18next.t("flow.state.inProcess"),
                            value: 0,
                            fontColor: "#248AF9",
                            bgColor: "#EBF5FF",
                            borderColor: "#2E8FF9"
                        },
                        COMPLETE: {
                            text: i18next.t("flow.state.complete"),
                            value: 1,
                            fontColor: "#0DB3A6",
                            bgColor: "#EBF8F7",
                            borderColor: "#0DB3A6"
                        },
                        CLOSE: {
                            text: i18next.t("flow.state.closed"),
                            value: 2,
                            fontColor: "#91A1B7",
                            bgColor: "#F5F5F7",
                            borderColor: "#91A1B7"
                        }
                    },
                    FLOWTYPE: {
                        NORMAL: "flow",
                        CC: "cc"
                    },
                    CREATOR_ID: "100000000000000000000000",
                    DEPT_MANAGER_ID: "110000000000000000000000",
                    CHARGER_ID: "111000000000000000000000",
                    CHARGER_DEPT_MANAGER_ID: "111100000000000000000000"
                },
                DEPT_ID: {
                    CURRENT: "110000000000000000000001"
                },
                PARAMETER: {
                    EMPTY: "fx_param_empty"
                },
                TEXT_TYPE_REGEXP: {
                    mobile: "^((\\(\\d{2,3}\\))|(\\d{3}\\-))?1\\d{10}$",
                    interMobile: "^\\+?(\\d{2,3}-)?\\d{7,}$",
                    tel: "^(0[0-9]{2,3}\\-)?([2-9][0-9]{6,7})+(\\-[0-9]{1,4})?$",
                    zip: "^\\d{6}$",
                    email: "^([a-zA-Z0-9_\\.\\-])+\\@(([a-zA-Z0-9\\-])+\\.)+([a-zA-Z0-9]{2,4})+$",
                    ID: "(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)",
                    URL: "(?:http(?:s)?:\\/\\/|www)[\\w.]+(?:[\\w\\-\\.,?=%:&/\\+#]*[\\w\\-\\?=%:&/\\+#])+"
                },
                PASSWORD_REG: {
                    STANDARD: /(^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/])[A-Za-z\d!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/]{3,}$)|(^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/])[A-Za-z!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/]{3,}$)|(^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{3,}$)/,
                    REQUIREMENT: /(^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/])[A-Za-z\d!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/]{8,}$)|(^(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/])[A-Za-z!@#$%^&*()_+\-={}|\[\]\\:";'<>?,.\/]{8,}$)|(^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$)/
                },
                COMMON_REG: {
                    VALIDATOR_FORMULA: /(\$[0-9a-zA-Z._]+#)/g,
                    FORM_FORMULA: /(\$[0-9a-zA-Z._#@]+)/g
                },
                TRIAL_TIME: {
                    MONTH: 30,
                    HALF_MONTH: 15,
                    WEEK: 7
                },
                VIP_ORDER: {
                    PACK: {
                        free: {
                            name: i18next.t("vip.pack.free")
                        },
                        lite: {
                            name: i18next.t("vip.pack.lite"),
                            service: "basic",
                            data: 2e5,
                            validAddons: ["data", "aggregate", "data_backup", "form_data"]
                        },
                        std: {
                            name: i18next.t("vip.pack.std"),
                            service: "silver",
                            data: 75e4,
                            validAddons: ["data", "aggregate", "file_upload", "managers", "data_backup", "form_data"]
                        },
                        user_std: {
                            name: i18next.t("vip.pack.std"),
                            service: "silver",
                            data: 75e4,
                            validAddons: ["data", "user", "aggregate", "file_upload", "managers", "data_backup", "form_data"]
                        },
                        user: {
                            name: i18next.t("vip.pack.user"),
                            service: "silver",
                            data: 25e3,
                            validAddons: []
                        },
                        pro: {
                            name: i18next.t("vip.pack.pro"),
                            service: "silver",
                            data: 2e6,
                            validAddons: ["data", "aggregate", "file_upload", "managers", "data_backup", "form_data"]
                        },
                        ent: {
                            name: i18next.t("vip.pack.ent"),
                            service: "silver",
                            data: 1e7,
                            validAddons: ["data", "aggregate", "file_upload", "managers", "data_backup", "form_data"]
                        },
                        logo: {
                            name: i18next.t("vip.pack.logo")
                        },
                        oem: {
                            name: i18next.t("vip.pack.oem"),
                            service: "silver",
                            data: 75e4,
                            validAddons: ["data", "aggregate", "file_upload", "managers", "data_api", "data_backup", "form_data"]
                        }
                    },
                    PACK_STATE: {
                        TRIAL: 0,
                        USING: 1,
                        EXPIRED: 2
                    },
                    SERVICE: {
                        basic: {
                            name: i18next.t("vip.service.basic.name"),
                            desc: i18next.t("order.given")
                        },
                        silver: {
                            name: i18next.t("vip.service.advanced.name"),
                            desc: i18next.t("vip.service.silver.description")
                        },
                        gold: {
                            name: i18next.t("vip.service.advanced.name"),
                            desc: ""
                        }
                    },
                    DATA_UNIT: 1e4,
                    DATA_ADD_UNIT: 1e5,
                    FORM_DATA_UNIT: 1e4,
                    USER_ADD_UNIT: 5,
                    UPLOAD_ADD_UNIT: 1073741824,
                    DATA_BACKUP_UNIT: 15
                },
                ORDER_STATE: {
                    CANCELED: -1,
                    UNPAID: 0,
                    PAID: 1
                },
                RECEIPT_STATE: {
                    UNRECEIPT: 0,
                    RECEIPTING: 1,
                    RECEIPTED: 2
                },
                RECEIPT_TYPE: {
                    ADVANCE: "advance",
                    NORMAL: "normal"
                },
                RECEIPT_TYPE_MAP: {
                    special: i18next.t("receipt.type.special"),
                    plain: i18next.t("receipt.type.plain"),
                    personal: i18next.t("receipt.type.personal"),
                    e_plain: i18next.t("receipt.type.plain.electric")
                },
                RECEIPT_CONTENT_TYPE: {
                    app_platform: {
                        value: "app_platform",
                        text: i18next.t("receipt.content.appPlatform"),
                        taxRate: i18next.t("receipt.tax", {
                            taxRate: "16%"
                        }),
                        tax: "16%"
                    },
                    tech_service: {
                        value: "tech_service",
                        text: i18next.t("receipt.content.techService"),
                        taxRate: i18next.t("receipt.tax", {
                            taxRate: "6%"
                        }),
                        tax: "6%"
                    }
                },
                SORT: {
                    ASC: 1,
                    DESC: -1,
                    DEFAULT: 0
                },
                FIELD_WIDTH: {
                    HALF: "half",
                    NORMAL: "normal",
                    TWICE: "twice"
                },
                FIELD_LINE_WIDTH: 12,
                FIELD: {
                    SUBFORM_DELIMITER: ".",
                    DELIMITER: "@",
                    ENTRY_DELIMITER: "#",
                    FORMULA_FIELD_DELIMITER: "$"
                },
                DEFAULT_AUTH_GROUP: 0,
                ADMIN_DATA_PERMS: {
                    flow_activate: !0,
                    flow_transfer: !0,
                    flow_close: !0,
                    create: !0,
                    copy: !0,
                    delete: !0,
                    import: !0,
                    export: !0,
                    update: !0,
                    flow_update: !0,
                    batch_print: !0,
                    flow_batch_print: !0
                },
                AUTH_GROUP: {
                    SUBMIT: -1,
                    VIEW_ALL: -2,
                    MANAGE_OWN: -3,
                    MANAGE_ALL: -4
                },
                AUTH_GROUP_CONTENT: [{
                    groupId: -1,
                    name: i18next.t("auth.group.submit.name"),
                    desc: i18next.t("auth.group.submit.description")
                }, {
                    groupId: -4,
                    name: i18next.t("auth.group.manage.name"),
                    desc: i18next.t("auth.group.manage.description")
                }, {
                    groupId: -2,
                    name: i18next.t("auth.group.review.name"),
                    desc: i18next.t("auth.group.review.description")
                }, {
                    groupId: -3,
                    name: i18next.t("auth.group.manageOwn.name"),
                    desc: i18next.t("auth.group.manageOwn.description")
                }],
                FLOW_AUTH_GROUP_CONTENT: [{
                    groupId: -1,
                    name: i18next.t("flow.launch"),
                    desc: i18next.t("flow.auth.group.submit.description")
                }, {
                    groupId: -2,
                    name: i18next.t("flow.auth.group.review.name"),
                    desc: i18next.t("flow.auth.group.review.description")
                }, {
                    groupId: -4,
                    name: i18next.t("flow.auth.group.manage.name"),
                    desc: i18next.t("flow.auth.group.manage.description")
                }],
                DEPT_MANAGERS: [{
                    id: 0,
                    text: i18next.t("dept.manager.grade.one")
                }, {
                    id: 1,
                    text: i18next.t("dept.manager.grade.two")
                }, {
                    id: 2,
                    text: i18next.t("dept.manager.grade.three")
                }, {
                    id: 3,
                    text: i18next.t("dept.manager.grade.four")
                }, {
                    id: 4,
                    text: i18next.t("dept.manager.grade.five")
                }],
                CORP_TYPE: {
                    INTERNAL: "internal",
                    DINGTALK: "dingtalk",
                    WECHAT: "wechat"
                },
                APP_STATE: {
                    private: 0,
                    review: 1,
                    onSale: 2
                },
                K12_APPROVE: {
                    NOTPASS: -1,
                    PASS: 1
                },
                VIP_MODULE: {
                    USERS: "users",
                    FORM_DATA: "form_data",
                    DATA: "data",
                    EXCEL_IMPORT: "excel_import",
                    FILE_UPLOAD: "file_upload",
                    AGGREGATE: "aggregate",
                    PRINT: "print",
                    TRIGGER: "trigger",
                    DATA_BACKUP: "data_backup",
                    SUBMIT_PROMPT: "submit_prompt",
                    FILE_ZIP: "file_zip",
                    LOGO: "logo",
                    USER_SYNC: "user_sync",
                    APP_BRIDGE: "app_bridge",
                    LEVEL: "level",
                    SIGNATURE: "signature",
                    CUSTOM_THEME: "custom_theme",
                    CUSTOM_LOGIN: "custom_login",
                    SSO: "sso",
                    THRESHOLD: "threshold"
                },
                VIP_COOKIE: {
                    TRIAL: {
                        SUFFIX_KEY: "#tr_time",
                        EXPIRES_DATE: new Date((new Date).getTime() + 1296e6)
                    },
                    TRIAL_END: {
                        SUFFIX_KEY: "#tr_end",
                        EXPIRES_DATE: new Date((new Date).getTime() + 864e5),
                        VALUE: !0
                    },
                    SYS_DATA: {
                        KEY: "exceed",
                        EXPIRES_DATE: new Date((new Date).getTime() + 864e5),
                        VALUE: !0
                    },
                    SERVICE_UPGRADE: {
                        SUFFIX_KEY: "#up_time",
                        EXPIRES_DATE: new Date((new Date).getTime() + 864e5),
                        VALUE: !0
                    }
                },
                COOKIE: {
                    NEED_REM: {
                        KEY: "needRem",
                        EXPIRES_DATE: new Date((new Date).getTime() + 31536e6)
                    },
                    PHONE: {
                        KEY: "bind_phone",
                        EXPIRES: new Date((new Date).getTime() + 864e5),
                        VALUE: !0
                    },
                    HELP_BTN_VISIBLE: {
                        KEY: "help_btn_visible",
                        EXPIRES: new Date((new Date).getTime() + 31536e6),
                        VALUE: !0
                    },
                    REPORT_MIGRATE_VISIBLE: {
                        KEY: "report_migrate_visible",
                        EXPIRES: new Date((new Date).getTime() + 31536e6)
                    },
                    ACTIVITY: {
                        KEY: "activity",
                        EXPIRES: new Date((new Date).getTime() + 31536e6),
                        VALUE: "1"
                    },
                    INVITE_MEMBER: {
                        SUFFIX_KEY: "#invite_member",
                        EXPIRES: new Date((new Date).getTime() + 2592e6),
                        VALUE: !0
                    },
                    PUBLISH_TIP: {
                        KEY: "publish_tip",
                        EXPIRES: new Date((new Date).getTime() + 31536e6),
                        VALUE: "1"
                    },
                    FX_LANG: {
                        KEY: "fx-lang",
                        EXPIRES: new Date((new Date).getTime() + 6048e5)
                    },
                    THRESHOLD_BROADCAST: {
                        KEY: "threshold_broadcast",
                        EXPIRES: new Date((new Date).getTime() + 31536e6),
                        VALUE: !0
                    },
                    DASHBOARD_GUIDE: {
                        SUFFIX_KEY: "#dashboard_guide",
                        EXPIRES: new Date((new Date).getTime() + 2592e6),
                        VALUE: {
                            INVITE: 8,
                            CREATE: 4,
                            EXPLORE: 2,
                            INTRO: 1
                        }
                    }
                },
                TRACKER: {
                    APP_CREATE: "app_create",
                    APP_FORK: "app_fork",
                    APP_EDIT: "app_edit",
                    APP_CONFIG: "app_config",
                    APP_REF: "app_ref",
                    APP_REF_SELECT: "app_ref_select",
                    APP_REF_ENTRY_SELECT: "app_ref_entry_select",
                    APP_REF_SAVE: "app_ref_save",
                    APP_VISIT: "app_visit",
                    APP_RENAME: "app_rename",
                    AUTH_GROUPS: "auth_groups",
                    AGGREGATE_TABLE_EDIT: "aggregate_table_edit",
                    FORM_CREATE: "form_create",
                    REPORT_CREATE: "report_create",
                    REPORT_RENAME: "report_rename",
                    REPORT_SHARE: "report_share",
                    REPORT_REF: "report_ref",
                    ORDER_LIST: "order_list",
                    VIP_CENTER: "vip_center",
                    WORKFLOW: "workflow",
                    VIP_CENTER_PACK: "vip_center_pack",
                    MEMBER_LIST: "member_list",
                    HELP_CUSTOM: "help_custom",
                    TEMP_SEARCH: "temp_search",
                    APP_VIEW: "app_view",
                    PRINT_SET: "print_set",
                    PRINT_CREATE: "print_create",
                    PRINT_EDIT: "print_edit",
                    PRINT_COPY: "print_copy",
                    PRINT_VIEW: "print_view",
                    PRINT_HIDE_ROWS: "print_hide_rows",
                    PRINT_HIDE_COLS: "print_hide_cols",
                    PRINT_INSERT_FLOAT_IMG: "print_insert_float_img",
                    FORM_SHARE: "form_share",
                    FORM_RENAME: "form_rename",
                    FORM_MULTI_TABS: "form_multi_tabs",
                    FLOW_FORM_RENAME: "flow_form_rename",
                    FORM_TYPE_CHANGE: "form_type_change",
                    FLOW_FORM_CREATE: "flow_form_create",
                    FORM_EVENT_CONFIG: "form_event_config",
                    FORM_EVENT_CREATE: "form_event_create",
                    FORM_EVENT_DELETE: "form_event_delete",
                    FORM_EVENT_DISABLE: "form_event_disable",
                    FORM_EVENT_ENABLE: "form_event_enable",
                    AUTH_GROUP_CREATE: "auth_group_create",
                    AUTH_GROUP_RENAME: "auth_group_rename",
                    AUTH_GROUP_SET: "auth_group_set",
                    AUTH_GROUP_FIELD: "auth_group_field",
                    AUTH_GROUP_DATA: "auth_group_data",
                    AUTH_GROUP_AND_SAVE: "auth_group_and_save",
                    AUTH_GROUP_OR_SAVE: "auth_group_or_save",
                    AUTH_GROUP_DEFAULT_VISIT: "auth_group_default_visit",
                    APP_INSTALL: "app_install",
                    FORM_REF: "form_ref",
                    TRIAL_NAV: "trial_nav",
                    TRIAL_VIP_CENTER: "trial_vip_center",
                    FORM_FIELD_ADD: "form_field_add",
                    FLOW_FORM_FIELD_ADD: "flow_form_field_add",
                    FORM_FIELD_RENAME: "form_field_rename",
                    FORM_FIELD_RECOVER: "form_field_recover",
                    FORM_FIELD_DELETE: "form_field_delete",
                    FORM_FIELD_RECYCLE_CLEAR: "form_field_recycle_clear",
                    FLOW_FORM_FIELD_RENAME: "flow_form_field_rename",
                    FORM_CREATE_FROM_EXCEL: "form_create_from_excel",
                    FLOW_FORM_CREATE_FROM_EXCEL: "flow_form_create_from_excel",
                    DASHBOARD_FLOW_LAUNCH: "dashboard_flow_launch",
                    DATA_SOURCE_PICK: "data_source_pick",
                    FORM_SHARE_TO_MEMBER: "form_share_to_member",
                    FLOW_FORM_SHARE_TO_MEMBER: "flow_form_share_to_member",
                    FORM_SUBMIT_HAS_SAVE_CONTENT: "form_submit_has_save_content",
                    VIP_LIMIT_ALERT: "vip_limit_alert",
                    SUBFORM_EXPAND: "subform_expand",
                    TRIAL_SECOND: "trial_second",
                    ETL_SAVE_SUCCESS: "etl_save_success",
                    DASH_VISIT: "dash_visit",
                    DASH_DESC_ADD: "dash_desc_add",
                    DATA_DELETE_ALL: "data_delete_all",
                    DATA_LABEL_SET: "data_label_set",
                    DATA_LABEL_ON: "data_label_on",
                    DATA_LABEL_FIELD_ADD: "data_label_field_add",
                    DATA_LABEL_SAVE: "data_label_save",
                    NOTIFY_SET: "notify_set",
                    NOTIFY_CREATE: "notify_create",
                    NOTIFY_TARGET_SET: "notify_target_set",
                    NOTIFY_SAVE: "notify_save",
                    PUBLIC_LINK: "public_link",
                    PUBLIC_LINK_ON: "public_link_on",
                    PUBLIC_LINK_PASS: "public_link_pass",
                    PUBLIC_LINK_QUERY: "public_link_query",
                    PUBLIC_LINK_QUERY_PASS: "public_link_query_pass",
                    PUBLIC_LINK_EXT: "public_link_ext",
                    SUBMIT_PROMPT: "submit_prompt",
                    SUBMIT_PROMPT_ON: "submit_prompt_on",
                    SUBMIT_PROMPT_SAVE: "submit_prompt_save",
                    SUBMIT_PROMPT_HAS_SAVE_CONTENT: "submit_prompt_has_save_content",
                    DASHBOARD_VIEW: "dashboard_view",
                    DASHBOARD_APP_CREATE: "dashboard_app_create",
                    CONTACTS_VIEW_FROM_DASHBOARD: "contacts_view_form_dashboard",
                    MEMBER_INVITE: "member_invite",
                    MEMBER_INVITE_LINK_CLICK: "member_invite_link_click",
                    MEMBER_INVITE_OF_PHONE_EMAIL: "member_invite_of_phone_email",
                    FORM_CREATE_BTN_CLICK: "form_create_btn_click",
                    FLOW_FORM_CREATE_BTN_CLICK: "flow_form_create_btn_click",
                    FLOW_FORM_INIT: "flow_form_init",
                    FLOW_NODE_ADD: "flow_node_add",
                    FLOW_PATH_ADD: "flow_path_add",
                    FLOW_CHARGER_ADD: "flow_charger_add",
                    FLOW_FIELD_AUTH_SET: "flow_field_auth_set",
                    FLOW_ENABLE: "flow_enable",
                    FLOW_EDIT_COND_OR: "flow_edit_cond_or",
                    DASH_CREATE: "dash_create",
                    DASH_COPY: "dash_copy",
                    DASH_EDIT_PAGE_VISIT: "dash_edit_page_visit",
                    DASH_RENAME: "dash_rename",
                    DASH_PREVIEW: "dash_preview",
                    DASH_PUBLISH: "dash_publish",
                    DASH_SHARE_TO_MEMBER: "dash_share_to_member",
                    DASH_REF: "dash_ref",
                    DASH_SAVE: "dash_save",
                    DASH_CHART_ADD: "dash_chart_add",
                    DASH_CHART_CREATE: "dash_chart_create",
                    DASH_DIMENSION_ADD: "dash_dimension_add",
                    DASH_QUOTA_ADD: "dash_quota_add",
                    DASH_METRIC_TABLE_SAVE: "dash_metric_table_save",
                    DASH_PIVOT_TABLE_SAVE: "dash_pivot_table_save",
                    DASH_BAR_CHART_SAVE: "dash_bar_chart_save",
                    DASH_COLUMN_CHART_SAVE: "dash_column_chart_save",
                    DASH_LINE_CHART_SAVE: "dash_line_chart_save",
                    DASH_AREA_CHART_SAVE: "dash_area_chart_save",
                    DASH_PIE_CHART_SAVE: "dash_pie_chart_save",
                    DASH_RADAR_CHART_SAVE: "dash_radar_chart_save",
                    DASH_MULTI_AXES_CHART_SAVE: "dash_multi_axes_chart_save",
                    DASH_MAP_CHART_SAVE: "dash_map_chart_save",
                    DASH_TABLE_ADD: "dash_table_add",
                    DASH_TABLE_CREATE: "dash_table_create",
                    DASH_FIELD_ADD: "dash_field_add",
                    DASH_FIELD_GROWTH_SET: "dash_field_growth_set",
                    DASH_TABLE_SAVE: "dash_table_save",
                    DASH_MANAGE_ADD: "dash_manage_add",
                    DASH_DATA_MANAGE_SELECT: "dash_data_manage_select",
                    DASH_CALENDAR_SELECT: "dash_calendar_select",
                    DASH_MANAGE_DATA_SOURCE_SELECT: "dash_manage_data_source_select",
                    DASH_CALENDAR_DATE_SELECT: "dash_calendar_date_select",
                    DASH_DATA_MANAGE_CREATE: "dash_data_manage_create",
                    DASH_CALENDAR_CREATE: "dash_calendar_create",
                    DASH_FILTER_ADD: "dash_filter_add",
                    DASH_FILTER_CHART_SELECT: "dash_filter_chart_select",
                    DASH_FILTER_FIELD_SELECT: "dash_filter_field_select",
                    DASH_FILTER_CREATE: "dash_filter_create",
                    DASH_FILTER_BTN_ADD: "dash_filter_btn_add",
                    DASH_COPY_WIDGET: "dash_copy_widget",
                    DASH_WIDGET_ADD: "dash_widget_add",
                    DASH_TOP_DATA_CHECKED: "dash_top_data_checked",
                    DASH_ROW_ORDER_CHECKED: "dash_row_order_checked",
                    DASH_LABEL_ROTATION_CHANGE: "dash_label_rotation_change",
                    DASH_SHOW_LABEL_CHECKED: "dash_show_label_checked",
                    DASH_NOTIFY_ENABLED: "dash_notify_enabled",
                    DASH_NOTIFY_SAVE: "dash_notify_save",
                    DASH_THRESHOLD_ADD: "dash_threshold_add",
                    DASH_THRESHOLD_SAVE: "dash_threshold_save",
                    DASH_THRESHOLD_ON: "dash_threshold_on",
                    DASH_THRESHOLD_OFF: "dash_threshold_off",
                    DASH_THRESHOLD_REMOVE: "dash_threshold_remove",
                    DASH_GUIDELINE_ADD: "dash_guideline_add",
                    DASH_GUIDELINE_SAVE: "dash_guideline_save",
                    DASH_COLOR_ADD: "dash_color_add",
                    DASH_COLOR_SAVE: "dash_color_save",
                    DASH_VALUE_SIZE_CHANGE: "dash_value_size_change",
                    DASH_CHART_LABEL_CANCELED: "dash_chart_label_canceled",
                    DASH_LEGEND_CANCELED: "dash_legend_canceled",
                    DASH_CUSTOM_SORT_CLICK: "dash_custom_sort_click",
                    DASH_CUSTOM_SORT_SAVE: "dash_custom_sort_save",
                    DATA_MANAGE_IMPORT: "data_manage_import",
                    DATA_MANAGE_IMPORT_FILE_SELECT: "data_manage_import_file_select",
                    DATA_MANAGE_IMPORT_NEXT_PREVIEW: "data_manage_import_next_preview",
                    DATA_MANAGE_IMPORT_NEXT_SET: "data_manage_import_next_set",
                    DATA_MANAGE_IMPORT_DONE: "data_manage_import_done",
                    DATA_MANAGE_EXPORT: "data_manage_export",
                    DATA_MANAGE_EXPORT_DONE: "data_manage_export_done",
                    DATA_MANAGE_EXPORT_SIGNATURE: "data_manage_export_signature",
                    DATA_MANAGE_BATCH_EDIT: "data_manage_batch_edit",
                    DATA_MANAGE_BATCH_EDIT_RANGE: "data_manage_batch_edit_range",
                    DATA_MANAGE_BATCH_EDIT_FIELD: "data_manage_batch_edit_field",
                    DATA_MANAGE_BATCH_EDIT_FIXED: "data_manage_batch_edit_fixed",
                    DATA_MANAGE_BATCH_EDIT_FORMULA: "data_manage_batch_edit_formula",
                    DATA_MANAGE_BATCH_EDIT_VALUE: "data_manage_batch_edit_value",
                    DATA_MANAGE_BATCH_EDIT_DONE: "data_manage_batch_edit_done",
                    DATA_MANAGE_BATCH_PRINT: "data_manage_batch_print",
                    DATA_MANAGE_BATCH_PRINT_SELECT: "data_manage_batch_print_select",
                    DATA_MANAGE_FILE_EXPORT: "data_manage_file_export",
                    DATA_MANAGE_FILE_LINK: "data_manage_file_link",
                    DATA_MANAGE_FILE_DOWNLOAD: "data_manage_file_download",
                    DATA_MANAGE_BATCH_QRCODE: "data_manage_batch_qrcode",
                    DATA_MANAGE_BATCH_QRCODE_RANGE: "data_manage_batch_qrcode_range",
                    DATA_MANAGE_BATCH_QRCODE_DONE: "data_manage_batch_qrcode_done",
                    DATA_MANAGE_TRANSFER: "data_manage_transfer",
                    DATA_MANAGE_TRANSFER_RANGE: "data_manage_transfer_range",
                    DATA_MANAGE_TRANSFER_CHARGER: "data_manage_transfer_charger",
                    DATA_MANAGE_TRANSFER_NEW_CHARGER: "data_manage_transfer_new_charger",
                    DATA_MANAGE_TRANSFER_DONE: "data_manage_transfer_done",
                    DATA_MANAGE_FLOW_CLOSE: "data_manage_flow_close",
                    DATA_MANAGE_FLOW_CLOSE_RANGE: "data_manage_flow_close_range",
                    DATA_MANAGE_FLOW_CLOSE_DONE: "data_manage_flow_close_done",
                    DATETIME_FORMAT_CHANGE: "datetime_format_change",
                    DATA_AUTH_MOBILE_LAYOUT: "data_auth_mobile_layout",
                    DATA_AUTH_MOBILE_CARD_COLUMNS: "data_auth_mobile_card_columns",
                    DATA_AUTH_TEAM_VISIT_LINK: "data_auth_team_visit_link",
                    DATA_AUTH_PRINT_SET: "data_auth_print_set",
                    DATA_AUTH_EDIT: "data_auth_edit",
                    DATA_AUTH_COPY: "data_auth_copy",
                    DATA_AUTH_REMOVE: "data_auth_remove",
                    DATA_AUTH_MEMBER_ADD: "data_auth_member_add",
                    DATA_AUTH_MEMBER_EDIT: "data_auth_member_edit",
                    DATA_COPY_ADMIN: "data_copy_admin",
                    DATA_COPY_VIEW: "data_copy_view",
                    DATA_COPY_SUBMIT: "data_copy_submit",
                    APP_ENTRY_PUBLISH_RANGE: "app_entry_publish_range",
                    APP_ENTRY_PUBLISH_SAVE: "app_entry_publish_save",
                    APP_ENTRY_DATA_AUTH: "app_entry_data_auth",
                    APP_ENTRY_DATA_AUTH_RANGE: "app_entry_data_auth_range",
                    APP_ENTRY_DATA_AUTH_SAVE: "app_entry_data_auth_save",
                    APP_AGGREGATE: "app_aggregate",
                    APP_AGGREGATE_CREATE: "app_aggregate_create",
                    APP_AGGREGATE_RENAME: "app_aggregate_rename",
                    APP_AGGREGATE_SOURCE_SET: "app_aggregate_source_set",
                    APP_AGGREGATE_ENTRY_SELECT: "app_aggregate_entry_select",
                    APP_AGGREGATE_SOURCE_SAVE: "app_aggregate_source_save",
                    APP_AGGREGATE_ROW: "app_aggregate_row",
                    APP_AGGREGATE_METRIC: "app_aggregate_metric",
                    APP_AGGREGATE_REMIND: "app_aggregate_remind",
                    APP_AGGREGATE_REMIND_TIP_SET: "app_aggregate_remind_tip_set",
                    APP_AGGREGATE_FORMULA: "app_aggregate_formula",
                    APP_AGGREGATE_REMIND_SAVE: "app_aggregate_remind_save",
                    APP_AGGREGATE_SAVE: "app_aggregate_save",
                    APP_TRIGGER: "app_trigger",
                    APP_TRIGGER_CREATE: "app_trigger_create",
                    APP_TRIGGER_RENAME: "app_trigger_rename",
                    APP_TRIGGER_FORM_SELECT: "app_trigger_form_select",
                    APP_TRIGGER_AFTER_DATE_CREATE: "app_trigger_after_data_create",
                    APP_TRIGGER_AFTER_DATE_UPDATE: "app_trigger_after_data_update",
                    APP_TRIGGER_AFTER_DATE_DELETE: "app_trigger_after_data_delete",
                    APP_TRIGGER_DO_ACTION: "app_trigger_do_action",
                    APP_TRIGGER_CONDITION_ADD: "app_trigger_condition_add",
                    APP_TRIGGER_ACTION: "app_trigger_action",
                    APP_TRIGGER_DATA_UPDATE: "app_trigger_data_update",
                    APP_TRIGGER_DATA_CREATE: "app_trigger_data_create",
                    APP_TRIGGER_DATA_DELETE: "app_trigger_data_delete",
                    APP_TRIGGER_DATA_UPSERT: "app_trigger_data_upsert",
                    APP_TRIGGER_EXECUTE: "app_trigger_execute",
                    APP_TRIGGER_SECOND_EXECUTE: "app_trigger_second_execute",
                    APP_TRIGGER_PREV_ACTION_SET: "app_trigger_prev_action_set",
                    APP_TRIGGER_TARGET_FORM_SELECT: "app_trigger_target_form_select",
                    APP_TRIGGER_FILTER_ADD: "app_trigger_filter_add",
                    APP_TRIGGER_FIELD_ADD: "app_trigger_field_add",
                    APP_TRIGGER_SAVE: "app_trigger_save",
                    APP_TRIGGER_HELP_DOC: "app_trigger_help_doc",
                    APP_DASH_EMPTY_ETL_CREATE: "app_dash_empty_etl_create",
                    APP_DASH_ETL_CREATE: "app_dash_etl_create",
                    APP_ETL: "app_etl",
                    APP_ETL_EDIT: "app_etl_edit",
                    APP_ETL_REMOVE: "app_etl_remove",
                    APP_ETL_OUTPUT_VIEW: "app_etl_output_view",
                    APP_ETL_LOG_VIEW: "app_etl_log_view",
                    APP_ETL_EXECUTE: "app_etl_execute",
                    APP_ETL_CREATE: "app_etl_create",
                    APP_ETL_RENAME: "app_etl_rename",
                    APP_ETL_INPUT_ADD: "app_etl_input_add",
                    APP_ETL_INPUT_SET: "app_etl_input_set",
                    APP_ETL_INPUT_SOURCE_CHANGE: "app_etl_input_source_change",
                    APP_ETL_NODE_ADD: "app_etl_node_add",
                    APP_ETL_HELP_VIEW: "app_etl_help_view",
                    APP_ETL_HELP_BTN_EMPTY: "app_etl_help_btn_empty",
                    APP_ETL_HELP_BTN: "app_etl_help_btn",
                    APP_ETL_HELP_BTN_EDIT: "app_etl_help_btn_edit",
                    APP_ETL_HELP_VIDEO_EDIT: "app_etl_help_video_edit",
                    APP_ETL_HELP_VIDEO: "app_etl_help_video",
                    APP_ETL_NODE_RENAME: "app_etl_node_rename",
                    APP_ETL_NODE_SOURCE_VIEW: "app_etl_node_source_view",
                    APP_ETL_PATH_ADD: "app_etl_path_add",
                    APP_ETL_OUTPUT_RENAME: "app_etl_output_rename",
                    APP_ETL_SAVE: "app_etl_save",
                    VIEW_DOCK_MENU: "view_dock_menu",
                    ENTER_KMS: "enter_kms",
                    ENABLE_KMS: "enable_kms",
                    OPTION_WIDGET_COLOR_ENABLE: "option_widget_color_enable",
                    OPTION_WIDGET_COLOR_CLOSE: "option_widget_color_close",
                    INFO_COLLECT_BEGIN: "info_collect_begin",
                    USAGE_MODE: "usage_mode",
                    INFO_COLLECT_END: "info_collect_end",
                    SIGNATURE_COPY: "signature_copy",
                    JDY_SEARCH: "jdy_search",
                    APP_SEARCH: "app_search",
                    FORM_COMMENT_CREATE: "form_comment_create",
                    FLOW_FORM_COMMENT_CREATE: "flow_form_comment_create",
                    FROM_SET_TRIGGER: "form_set_trigger",
                    FROM_SET_TRIGGER_ADD: "form_set_trigger_add",
                    FROM_SET_TRIGGER_WHAT: "form_set_trigger_what",
                    FROM_SET_TRIGGER_SCENE: "form_set_trigger_scene",
                    KMS_DISABLE: "kms_disable",
                    KMS_ENABLE: "kms_enable",
                    ETL_INTRO_DONE: "elt_intro_done",
                    ETL_LIST_TABLE_CREATE: "etl_list_table_create",
                    ETL_LIST_TABLE_TO_CREATE: "etl_list_table_to_create",
                    YEAR_SURVEY_SHOW: "year_survey_show",
                    YEAR_SURVEY_OPEN: "year_survey_open",
                    YEAR_SURVEY_CLOSE: "year_survey_close",
                    DASH_OPERATION_NOTIFY_SHOW: "dash_operation_notify_show",
                    DASH_OPERATION_NOTIFY_CLICK: "dash_operation_notify_click",
                    UPDATE_LOG_SHOW: "update_log_show",
                    UPDATE_LOG_OPEN: "update_log_open",
                    UPDATE_LOG_CLOSE: "update_log_close",
                    MEMBER_FLOW_IMPORT: "member_flow_import",
                    WECHAT_INTEGRATION_OPEN: "wechat_integration_open",
                    WECHAT_INTEGRATION_CLOSE: "wechat_integration_close",
                    WECHAT_INTEGRATION_UNBIND: "wechat_integration_unbind",
                    WECHAT_INTEGRATION_BIND: "wechat_integration_bind",
                    WECHAT_ENHANCE: "wx_enhance_data_create",
                    WECHAT_INTEGRATION_BIND_SUCCESS: "wechat_integration_bind_success",
                    DASH_RELY_FILTER_VISIT: "dash_rely_filter_visit",
                    FORM_NOT_REPEAT_CUSTOM: "form_not_repeat_custom",
                    FORM_DATA_EXPANSION: "form_data_expansion",
                    MEMBER_SELECT_ALL: "member_select_all",
                    MENU_CORP_MANAGEMENT: "menu_corp_management",
                    PROFILE_VERSION_INFO: "profile_version_info",
                    PROFILE_ORDER_INFO: "profile_order_info",
                    PROFILE_CORP_INFO: "profile_corp_info",
                    PROFILE_DATA_INTERFACE: "profile_data_interface",
                    PROFILE_CORP_LOG: "profile_corp_log",
                    PROFILE_USAGE_STATISTICS: "profile_usage_statistics",
                    PROFILE_LOGIN_LOG: "profile_login_log",
                    FORM_SUBFORM_STICKY_COLUMN: "form_subform_sticky_column"
                },
                KEY_CODE: {
                    LEFT: 37,
                    RIGHT: 39,
                    ENTER: 13,
                    BACKSPACE: 8,
                    DELETE: 46
                },
                ALLIANCE_APPLY_STATE: {
                    APPROVED: "approved",
                    WAITING: "waiting",
                    DENIED: "denied",
                    NOT_APPLIED: "not_applied",
                    BANNED: "banned"
                },
                CONTACT_ALL_GROUP: "1",
                DEPARTMENT_ROOT: 1,
                MANAGE_GROUP: {
                    SYS: {
                        ID: -1,
                        NAME: i18next.t("manage.group.system.name")
                    }
                },
                MEMBER_ASYNC_STATE: {
                    SUCCESS: 0,
                    FAILED: 1,
                    SYNCING: 2
                },
                MEMBER_ROLE_TYPE: {
                    INTERNAL: "internal",
                    SYNC: "sync"
                },
                MESSAGE_TYPE: {
                    SYSTEM_LOG: "system_log",
                    USAGE_NOTIFY: "usage_notify",
                    OPERATION_NOTIFY: "operation_notify",
                    TEAM_INVITE: "team_invite",
                    THRESHOLD: "dash_alert",
                    KMS_DOC: "kms_doc",
                    COMMENT_MENTION: "comment_mention",
                    DATA_NOTIFY: "data_notify",
                    KMS_DOC_MENTION: "kms_doc_mention"
                },
                MESSAGE_TYPE_TEXT: {
                    system_log: i18next.t("message.system.log"),
                    usage_notify: i18next.t("message.usage.notify"),
                    operation_notify: i18next.t("message.operation.notify"),
                    team_invite: i18next.t("message.team.invite"),
                    dash_alert: i18next.t("dash.thresholds"),
                    kms_doc: i18next.t("message.kms"),
                    comment_mention: i18next.t("message.comment.mention"),
                    data_notify: i18next.t("message.notify.data")
                },
                LOCAL_STORAGE: {},
                GUIDE: {
                    DASHBOARD: "dashboard",
                    FORM_EDIT: "form_edit",
                    FLOW_EDIT: "flow_edit",
                    FLOW_ENABLE: "flow_enable",
                    REPORT_EDIT: "report_edit",
                    DASH_EDIT: "dash_edit",
                    ETL_EDIT: "etl_edit",
                    APP_EDIT: "app_edit",
                    REPORT_MIGRATE: "report_migrate",
                    DEMAND_FEEDBACK: "demand_feedback",
                    MOBILE_TO_PC_BANNER: "mobile_to_pc_banner",
                    MOBILE_TO_PC_TIP: "mobile_to_pc_tip",
                    MOBILE_MULTI_MEDIA: "mobile_multi_media",
                    MOBILE_FULL_SCREEN: "mobile_full_screen",
                    FROM_SET_TRIGGER: "form_set_trigger",
                    ETL_INPUT_ADD: "etl_input_add",
                    ETL_FLOW_NODE_ADD: "etl_flow_node_add",
                    ETL_FLOW_PATH_ADD: "etl_flow_path_add",
                    ETL_FLOW_NODE_EDIT: "etl_flow_node_edit",
                    ETL_OUTPUT_CONNECT: "etl_output_connect",
                    ETL_SAVE: "etl_save",
                    ETL_GUIDE_DONE: "etl_guide_done",
                    KMS_ENABLE: "kms_enable"
                },
                WEBHOOK: {
                    API_TRIGGER: {
                        CREATE: "data_create",
                        UPDATE: "data_update",
                        REMOVE: "data_remove",
                        RECOVER: "data_recover",
                        FORM_UPDATE: "form_update"
                    },
                    SERVER_TYPE: {
                        FR: "fr",
                        CUSTOM: "custom"
                    }
                },
                PRINT_DPI: 96,
                UPLOAD_FILE_COUNT: {
                    SINGLE: 1,
                    MULTI: 10
                },
                SEP_LINE_STYLE: {
                    NONE: "none",
                    DASHED: "dashed",
                    THIN: "thin",
                    THICK: "thick"
                },
                INVALID_TYPE: {
                    INVALID: 1,
                    REGEX: 2,
                    BLANK: 3,
                    REPEAT: 4,
                    OUTSIDE: 5,
                    COUNTING: 6,
                    RANGE: 7,
                    SMS: 8,
                    PHONE_REGEX: 9,
                    PHONE_TIMEOUT: 10,
                    FILE_UPLOADING: 11
                },
                FORMULA_INVALID_TYPE: {
                    INVALID_FIELD: 1,
                    DEPRECATED_FIELD: 2
                },
                DATE_FORMATS: {
                    yyyy: "2015",
                    yyyyMM: "201501",
                    "yyyy-MM": "2015-01",
                    "yyyy/MM": "2015/01",
                    yyyyMMdd: "20150131",
                    "yyyy-MM-dd": "2015-01-31",
                    "yyyy/MM/dd": "2015/01/31",
                    MMdd: "0131",
                    "MM-dd": "01-31",
                    "MM/dd": "01/31"
                },
                DATE_VIEW_MODE: {
                    YM: 0,
                    YMD: 1,
                    HMS: 2,
                    YMD_HMS: 3,
                    HM: 4,
                    YMD_HM: 5
                },
                FILTER_METHOD: {
                    EQ: "eq",
                    NE: "ne",
                    ALL: "all",
                    IN: "in",
                    NIN: "nin",
                    LK: "like",
                    ULK: "unlike",
                    EP: "empty",
                    NEP: "not_empty",
                    GT: "gt",
                    GTE: "gte",
                    LT: "lt",
                    LTE: "lte",
                    RG: "range",
                    VF: "verified",
                    NVF: "unverified",
                    FM: "formula"
                },
                FILTER_RELATION: {
                    AND: "and",
                    OR: "or"
                },
                BATCH_EDIT_FUNC: ["ABS", "AVERAGE", "CEILING", "COUNT", "FLOOR", "INT", "LOG", "MAX", "MIN", "MOD", "POWER", "PRODUCT", "SQRT", "SUM", "AND", "FALSE", "IF", "IFS", "NOT", "OR", "TRUE", "DATEDIF", "DAY", "DAYS", "HOUR", "MINUTE", "MONTH", "NOW", "SECOND", "TIME", "TIMESTAMP", "TODAY", "YEAR", "CONCATENATE", "EXACT", "LEFT", "LEN", "LOWER", "REPLACE", "SEARCH", "RIGHT", "SPLIT", "UPPER", "MID", "UNION"],
                BATCH_EDIT_LIMIT: 5e4,
                DASH_AGGREGATE_FUNC: ["SUM", "AVERAGE", "MAX", "MIN", "COUNT"],
                DIMENSION_GROUP: {
                    ADDRESS: [{
                        text: i18next.t("province"),
                        value: "province"
                    }, {
                        text: i18next.t("province") + "-" + i18next.t("city"),
                        value: "province_city"
                    }, {
                        text: i18next.t("province") + "-" + i18next.t("city") + "-" + i18next.t("district"),
                        value: "province_city_district"
                    }],
                    DATE: [{
                        text: i18next.t("year"),
                        value: "year"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("quarter"),
                        value: "year_quarter"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("month"),
                        value: "year_month"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("week"),
                        value: "year_week"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("month") + "-" + i18next.t("day"),
                        value: "year_month_day"
                    }],
                    DATE_MONTH: [{
                        text: i18next.t("year"),
                        value: "year"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("quarter"),
                        value: "year_quarter"
                    }, {
                        text: i18next.t("year") + "-" + i18next.t("month"),
                        value: "year_month"
                    }]
                },
                DATA_LIMIT_TIP: {
                    LINK: i18next.t("dataLimitTip.link"),
                    ACCOUNT: i18next.t("dataLimitTip.account"),
                    ACCOUNT_ADMIN: i18next.t("dataLimitTip.account.admin")
                },
                FLOW_FAIL_CODE: {
                    FORWARD_CHARGER: 5008,
                    BACK: 5009,
                    FORWARD_COND: 5011,
                    DONE: 5003,
                    NO_FORWARD_PERM: 5024,
                    NO_BATCH_FORWARD_PERM: 5023,
                    TODO_TASK_INVALID: 5028
                },
                FLOW_FAIL_HINT: {
                    forward: i18next.t("flow.fail.hint.forward"),
                    batch_forward: i18next.t("flow.fail.hint.forward"),
                    back: i18next.t("flow.fail.hint.back"),
                    auto_approve: i18next.t("flow.fail.hint.autoForward"),
                    auto_forward: i18next.t("flow.fail.hint.autoForward"),
                    auto_back: i18next.t("flow.fail.hint.autoBack")
                },
                FLOW_FORWARD_RULE: {
                    OFF: 0,
                    PREVIOUS: 1,
                    PROCESSED: 2
                },
                FLOW_ACTION: {
                    FORWARD: "forward",
                    AUTO_FORWARD: "auto_forward",
                    AUTO_APPROVE: "auto_approve",
                    BATCH_FORWARD: "batch_forward"
                },
                SAVE_CONFIRM_PANE: {
                    BASIC_CONFIG: "basic-config",
                    FORM_DESIGN: "form-design",
                    EXT_CONFIG: "ext-config",
                    FLOW_DESIGN: "flow-design",
                    DATA_LABEL: "data-label",
                    PUBLIC_LINK: "public-link",
                    CUSTOM_SUBMIT: "custom-submit",
                    REPORT_DESIGN: "report-design",
                    AGGREGATE: "aggregate-design",
                    APP_SHARE: "app-share",
                    APP_DATA: "app-data",
                    APP_REF: "app-ref",
                    APP_SUMMARY: "app-summary"
                },
                TRIGGER: {
                    TRIGGERS: {
                        CREATE: "data_create",
                        UPDATE: "data_update",
                        REMOVE: "data_remove"
                    },
                    EXE: {
                        CREATE: "create_data",
                        UPDATE: "update_data",
                        REMOVE: "remove_data",
                        UPSERT: "upsert_data"
                    },
                    STEP: {
                        TRIG: 1,
                        EXE: 2
                    }
                },
                FlOW_SCHEDULE: {
                    TIME_LIMIT: {
                        CUSTOM: "custom",
                        WIDGET: "widget"
                    },
                    ACTION_OP: {
                        NOTIFY: "notify",
                        FORWARD: "forward",
                        BACK: "back"
                    },
                    DEFAULT_OFFSET: 1,
                    MIN_OFFSET: 1,
                    MAX_OFFSET: {
                        m: 43200,
                        h: 720,
                        d: 30
                    },
                    DEFAULT_DAY_TIME: "09:00",
                    MAX_ACTIONS_COUNT: 5
                },
                VIP_ERR_MSG_MAP: {
                    7104: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7104.msg"),
                        memMsg: i18next.t("vip.error.7104.memMsg"),
                        doc: "9117",
                        addon: "aggregate"
                    },
                    7105: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7105.msg"),
                        doc: "9117",
                        addon: "aggregate"
                    },
                    7106: {
                        addon: "aggregate"
                    },
                    7107: {
                        addon: "file_upload"
                    },
                    7108: {
                        addon: "data"
                    },
                    7109: {
                        addon: "form_data"
                    },
                    7110: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7110.msg"),
                        memMsg: i18next.t("vip.error.7110.memMsg"),
                        addon: "users"
                    },
                    7111: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7111.msg"),
                        memMsg: i18next.t("vip.error.7111.memMsg"),
                        addon: "users"
                    },
                    7112: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7112.msg"),
                        memMsg: i18next.t("vip.error.7112.memMsg"),
                        doc: "9140",
                        addon: "print"
                    },
                    7113: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7113.msg"),
                        memMsg: i18next.t("vip.error.7113.memMsg"),
                        doc: "9140",
                        addon: "print"
                    },
                    7114: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7114.msg"),
                        doc: "9140",
                        addon: "print"
                    },
                    7115: {
                        addon: "manager"
                    },
                    7116: {
                        addon: "manager"
                    },
                    7117: {
                        addon: "manager"
                    },
                    7118: {
                        addon: "manager"
                    },
                    7119: {
                        addon: "manager"
                    },
                    7120: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7120.msg"),
                        memMsg: i18next.t("vip.error.7120.memMsg"),
                        doc: "10732",
                        is_open_doc: !0,
                        addon: "data_api"
                    },
                    7121: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7121.msg"),
                        memMsg: i18next.t("vip.error.7120.memMsg"),
                        doc: "9136",
                        addon: "data_backup"
                    },
                    7122: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7122.msg"),
                        memMsg: i18next.t("vip.error.7122.memMsg"),
                        doc: "9145",
                        addon: "file_zip"
                    },
                    7123: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7123.msg"),
                        memMsg: i18next.t("vip.error.7123.memMsg"),
                        doc: "9139",
                        addon: "app_bridge"
                    },
                    7124: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7124.msg"),
                        doc: "9138",
                        addon: "user_sync"
                    },
                    7125: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7125.msg"),
                        memMsg: i18next.t("vip.error.7125.memMsg"),
                        doc: "10884",
                        addon: "submit_prompt"
                    },
                    7128: {
                        addon: "aggregate"
                    },
                    7130: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7130.msg"),
                        memMsg: i18next.t("vip.error.7130.memMsg"),
                        doc: "10947",
                        addon: "signature"
                    },
                    7132: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7132.msg"),
                        memMsg: i18next.t("vip.error.7132.memMsg"),
                        doc: "10982",
                        addon: "etl"
                    },
                    7133: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7133.msg"),
                        memMsg: i18next.t("vip.error.7133.memMsg"),
                        addon: "etl"
                    },
                    7134: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7134.msg"),
                        memMsg: i18next.t("vip.error.7134.memMsg"),
                        doc: "11021",
                        addon: "trigger"
                    },
                    7135: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7135.msg"),
                        memMsg: i18next.t("vip.error.7135.memMsg"),
                        doc: "11021",
                        addon: "trigger"
                    },
                    7136: {
                        title: i18next.t("vip.error.title.limit"),
                        msg: i18next.t("vip.error.7136.msg"),
                        memMsg: i18next.t("vip.error.7136.memMsg"),
                        addon: "trigger"
                    },
                    7139: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7139.msg"),
                        memMsg: i18next.t("vip.error.7139.memMsg"),
                        doc: "11279",
                        addon: "custom_theme"
                    },
                    7140: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7140.msg"),
                        doc: "11415",
                        addon: "custom_login"
                    },
                    7141: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7141.msg"),
                        doc: "11398",
                        is_open_doc: !0,
                        addon: "sso"
                    },
                    7142: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7142.msg"),
                        memMsg: i18next.t("vip.error.7142.memMsg"),
                        doc: "11438",
                        addon: "threshold"
                    },
                    7143: {
                        title: i18next.t("vip.error.title.upgrade"),
                        msg: i18next.t("vip.error.7143.msg"),
                        memMsg: i18next.t("vip.error.7143.memMsg"),
                        doc: "11701"
                    }
                },
                VIP_ERR_NAME_MAP: {
                    DATA_BACKUP: 7121,
                    FILE_ZIP: 7122,
                    SUBMIT_PROMPT: 7125,
                    DATA_API: 7120,
                    PRINT: 7112,
                    PRINT_LIMIT: 7113,
                    SIGNATURE: 7130,
                    TRIGGER_NO: 7134,
                    TRIGGER_LIMIT: 7135,
                    CUSTOM_THEME: 7139,
                    CUSTOM_LOGIN: 7140,
                    SSO: 7141,
                    THRESHOLD: 7142,
                    FIELD_RECYCLE: 7143
                },
                MAX_FILE_SIZE: 209715200,
                MAX_IMAGE_SIZE: 20971520,
                MAX_IMAGE_VIEW_SIZE: 20971520,
                MAX_IMPORT_SIZE: 5242880,
                FLOW_STATE_FIELD: {
                    type: "flowState",
                    name: "flowState",
                    text: i18next.t("field.flowState")
                },
                FILTER_FLOW_STATE_FIELD: {
                    type: "flowstate",
                    name: "flowState",
                    text: i18next.t("field.flowState")
                },
                MEMBER_INVITE_STATUS: {
                    JOINED: 1,
                    INVITING: 0
                },
                FILTER_VALUE_MODE: {
                    CUSTOM: "custom",
                    ITEM: "item"
                },
                DASH_CHART_THEME_TEXT_MAP: {
                    preset_1: i18next.t("dash.color.custom00"),
                    preset_2: i18next.t("dash.color.custom01"),
                    preset_3: i18next.t("dash.color.custom02"),
                    preset_4: i18next.t("dash.color.custom03"),
                    preset_5: i18next.t("dash.color.custom04"),
                    preset_6: i18next.t("dash.color.custom05"),
                    preset_7: i18next.t("dash.color.custom06"),
                    preset_8: i18next.t("dash.color.custom07"),
                    preset_9: i18next.t("dash.color.custom08"),
                    preset_10: i18next.t("dash.color.custom09"),
                    preset_map_1: i18next.t("dash.color.customMap01"),
                    preset_map_2: i18next.t("dash.color.customMap02"),
                    preset_map_3: i18next.t("dash.color.customMap03"),
                    preset_map_4: i18next.t("dash.color.customMap04"),
                    preset_map_5: i18next.t("dash.color.customMap05"),
                    preset_map_6: i18next.t("dash.color.customMap06"),
                    preset_map_7: i18next.t("dash.color.customMap07")
                },
                DASH_CHART_THEME: [{
                    value: "preset_1",
                    colors: ["#63B2EE", "#76DA91", "#F8CB7F", "#F89588", "#7CD6CF", "#9192AB", "#7898E1", "#EFA666", "#EDDD86", "#9987CE"]
                }, {
                    value: "preset_2",
                    colors: ["#B2BF59", "#F29D38", "#F2E6C2", "#6EA740", "#EBC582", "#A57051", "#75CD62", "#FCE29C", "#D4A082", "#AEECE1"]
                }, {
                    value: "preset_3",
                    colors: ["#5A8C8C", "#BCBFA4", "#F2E6C2", "#BFA288", "#A98A61", "#624C37", "#D6C289", "#32262E", "#366D73", "#012E40"]
                }, {
                    value: "preset_4",
                    colors: ["#FFAAAA", "#789BF2", "#73DDC3", "#FACB7C", "#FFD4D4", "#BBCDF8", "#B9EEE1", "#FCE5BD", "#FFE9E9", "#DDE6FB"]
                }, {
                    value: "preset_5",
                    colors: ["#366D73", "#FFC31E", "#A4BFBF", "#40BEB3", "#012E40", "#4084BE", "#198AF6", "#FFE7A4", "#365373", "#C2D6E7"]
                }, {
                    value: "preset_6",
                    colors: ["#FF9B88", "#FFD543", "#5BD4D6", "#74A1F7", "#CCD8E2", "#8E72C0", "#4081BE", "#A7E2E9", "#91B9FF", "#365373"]
                }, {
                    value: "preset_7",
                    colors: ["#4BB190", "#5A85AB", "#BFBFBF", "#9DD7C4", "#278466", "#C1DAF0", "#446078", "#E9E9E9", "#4A9B9B", "#95E0F0"]
                }, {
                    value: "preset_8",
                    colors: ["#00A6EF", "#005297", "#30DEC0", "#A7E2E9", "#4081BE", "#CCD8E2", "#365373", "#00C4AF", "#C1DAF0", "#259A8D"]
                }, {
                    value: "preset_9",
                    colors: ["#FF8400", "#FFE05A", "#2B76D4", "#00CCAD", "#FFA700", "#00B1CC", "#5E58D5", "#1AE685", "#F9CE3A", "#25756C"]
                }, {
                    value: "preset_10",
                    colors: ["#9DD973", "#5BD9D9", "#F2B05E", "#F2EDA2", "#F26B83", "#B2A7D9", "#F2E966", "#49BF9E", "#F2836B", "#85B6F2"]
                }],
                DASH_CHART_MAP_THEME: [{
                    value: "preset_map_1",
                    colors: ["#B5E9F5", "#0361E5"]
                }, {
                    value: "preset_map_2",
                    colors: ["#89C4E8", "#EC2F4B"]
                }, {
                    value: "preset_map_3",
                    colors: ["#A4EBB3", "#04BAF3"]
                }, {
                    value: "preset_map_4",
                    colors: ["#DFECC1", "#E9272B"]
                }, {
                    value: "preset_map_5",
                    colors: ["#88E1EB", "#5B25B8"]
                }, {
                    value: "preset_map_6",
                    colors: ["#F0EBB6", "#0CAB39"]
                }, {
                    value: "preset_map_7",
                    colors: ["#7FE7C6", "#0251A1"]
                }],
                OPTION_PRESET_COLORS: ["#FA5353", "#F5C13C", "#2FCD6E", "#3F8CFF", "#D144F4", "#656565", "#FF9D8D", "#A5C71C", "#00C7C7", "#7957FF", "#F24BAF", "#B3B3B3"],
                DASH_CHART_TITLE_DELIMITER: "/",
                ETL_STATUS: {
                    SUCCESS: "success",
                    FAILURE: "failure",
                    RUNNING: "running"
                },
                ETL_SIZE: {
                    DEFAULT: 1,
                    INPUT: 0,
                    JOIN: 2,
                    UNION: 10
                },
                SSO_URL: {
                    SAML: "/sso/saml/",
                    CUSTOM: "/sso/custom/"
                },
                FORM_EVENT_FIELDS: {
                    TRIGGER: ["text", "radiogroup", "combo", "number", "datetime", "checkboxgroup", "combocheck", "user", "usergroup", "dept", "deptgroup", "image"],
                    REQUEST: ["text", "number", "datetime", "user", "dept", "image"],
                    RESULT_SET: ["text", "textarea", "number", "datetime"],
                    RESULT_INSERT: ["text", "number", "radiogroup", "combo"]
                },
                FORM_EVENT_METHOD: {
                    POST: "post",
                    GET: "get"
                },
                FORMULA_ERROR: {
                    MAPX: "mapx"
                },
                TECHNICAL_SUPPORT_LINK: "/help/chat_online",
                BUSINESS_SUPPORT_LINK: "/help/chat_online?source=business",
                PERSONAL_SETTING: "/profile/me",
                CORP_MANAGEMENT: "/profile/corp",
                WECHAT_SIGNIN: "/wechat/platform/:corpId/member_bind",
                WECHAT_BIND: "/wechat/platform/:corpId/member_bind_handle",
                REPORT_LEGACY_STATUS: {
                    TRUE: 2,
                    ING: 1,
                    FALSE: 0
                },
                CALENDAR_VIEWMODE: {
                    month: 0,
                    week: 1
                },
                NOT_REPEAT_TIP_LENGTH: 50,
                WX_ENHANCE_LEVEL: {
                    OFF: 0,
                    SILENCE: 1,
                    POPUPS: 2
                },
                TEMPLATE_PRINT_MODE: {
                    PAGING: 1,
                    SERIES: 2
                }
            },
            WECHAT_LOGIN_SCRIPT: "https://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"
        })
    }(jQuery),
    function(f) {
        FX.Utils = FX.Utils || {},
            f.extend(FX.Utils, {
                isString: function(t) {
                    return "string" == typeof t
                },
                isNumber: function(t) {
                    return f.isNumeric(t)
                },
                isFunction: function(t) {
                    return f.isFunction(t)
                },
                isDate: function(t) {
                    return t instanceof Date
                },
                isArray: function(t) {
                    return f.isArray(t)
                },
                isEmpty: function(t) {
                    return "" === t || FX.Utils.isNull(t)
                },
                isBlank: function(t) {
                    return FX.Utils.isNull(t) || "" === t.trim()
                },
                isNull: function(t) {
                    return null == t
                },
                isObjectEmpty: function(t) {
                    if (null == t)
                        return !0;
                    if (0 < t.length)
                        return !1;
                    if (0 === t.length)
                        return !0;
                    for (var e in t)
                        if (hasOwnProperty.call(t, e))
                            return !1;
                    return isNaN(t)
                },
                remove: function(t, e) {
                    var i = [];
                    if (!FX.Utils.isArray(t) || !t.length)
                        return i;
                    for (var a = [], n = 0, s = t.length; n < s; n++) {
                        var r = t[n];
                        e.apply(t, [n, r, t]) && (i.push(r),
                            a.push(n))
                    }
                    for (var o = a.length, l = -1, c = o - 1; o--; ) {
                        var d = a[o];
                        o !== c && d === l || (l = d,
                            t.splice(d, 1))
                    }
                    return i
                },
                shuffleArray: function(t) {
                    var e = [];
                    if (!FX.Utils.isArray(t) || !t.length)
                        return e;
                    for (var i = (e = t.slice(0)).length, a = 0; a < i - 1; a++) {
                        var n = Math.floor(Math.random() * (i - a))
                            , s = e[n];
                        e[n] = e[i - a - 1],
                            e[i - a - 1] = s
                    }
                    return e
                },
                isValueWidget: function(t) {
                    return !!FX.ValueWidgets[t]
                },
                allowValueSubmit: function(t) {
                    return FX.ValueWidgets[t] && "sn" !== t
                },
                pick: function(i, t) {
                    var a = {};
                    return FX.Utils.isObjectEmpty(i) || FX.Utils.forEach(t, function(t, e) {
                        e in i && (a[e] = i[e])
                    }),
                        a
                },
                applyFunc: function(t, e, i, a) {
                    return FX.Utils.isFunction(e) ? e.apply(t, i || []) : a
                },
                forEach: function(t, e) {
                    if (Array.isArray(t) || t instanceof jQuery)
                        for (var i = 0, a = t.length; i < a && !1 !== e.apply(t[i], [i, t[i]]); i++)
                            ;
                    else if (t && "object" == typeof t)
                        for (var n in t)
                            if (t.hasOwnProperty(n) && !1 === e.apply(t[n], [n, t[n]]))
                                break
                },
                uniq: function(t) {
                    var i = {}
                        , a = [];
                    return FX.Utils.forEach(t, function(t, e) {
                        i.hasOwnProperty(e) || (i[e] = 1,
                            a.push(e))
                    }),
                        a
                },
                flatten: function(t, e, i) {
                    if (i = i || [],
                        t)
                        for (var a = 0, n = t.length; a < n; a++) {
                            var s = t[a];
                            Array.isArray(s) ? FX.Utils.flatten(s, e, i) : e && !e(s) || i.push(s)
                        }
                    return i
                },
                applyCss: function(t, e) {
                    FX.Utils.isEmpty(e) || (FX.Utils.isString(e) ? t.addClass(e) : t.css(e))
                },
                getServerDate: function(t) {
                    var e;
                    t && t.getResponseHeader && ((e = t.getResponseHeader("date")) && (FX.STATIC._st = new Date(e).getTime(),
                        FX.STATIC._ct = (new Date).getTime()))
                },
                getApi: function(t) {
                    if (!FX.Utils.isString(t))
                        return "";
                    var e = arguments;
                    if (e.length <= 1)
                        return t;
                    var i = 1;
                    return t.replace(/\/:[a-z]+/gi, function() {
                        return "/" + e[i++]
                    })
                },
                replaceURL: function(t) {
                    if (FX.Utils.isNull(t))
                        return "";
                    t += "";
                    var a = ""
                        , e = FX.CONST.TEXT_TYPE_REGEXP.URL
                        , i = t.split(new RegExp("(" + e + ")"));
                    return FX.Utils.forEach(i, function(t, e) {
                        var i;
                        t % 2 != 0 ? (i = e,
                        FX.Utils.startWith(e, "www") && (i = "http://" + e),
                            a += '<a class="nest-link" target="_blank" href="' + i + '">' + e + "</a>") : a += FX.Utils.escapeHtmlSpecialChar(e)
                    }),
                        a
                },
                ajax: function(t, a, n, s) {
                    var e = t.data || {};
                    return FX.Utils.isEmpty(FX.STATIC.FTOKEN) ? FX.Utils.isEmpty(FX.STATIC.QTOKEN) ? FX.Utils.isEmpty(FX.STATIC.RTOKEN) ? FX.Utils.isEmpty(FX.STATIC.ATOKEN) ? FX.Utils.isEmpty(FX.STATIC.DTOKEN) ? FX.Utils.isEmpty(FX.STATIC.DASH_TOKEN) || (e.fx_access_token = FX.STATIC.DASH_TOKEN,
                        e.fx_access_type = "dash_public") : (e.fx_access_token = FX.STATIC.DTOKEN,
                        e.fx_access_type = "form_data") : (e.fx_access_token = FX.STATIC.ATOKEN,
                        e.fx_access_type = "app_public") : (e.fx_access_token = FX.STATIC.RTOKEN,
                        e.fx_access_type = "report_public") : (e.fx_access_token = FX.STATIC.QTOKEN,
                        e.fx_access_type = "form_query") : (e.fx_access_token = FX.STATIC.FTOKEN,
                        e.fx_access_type = "form_public"),
                        f.ajax({
                            type: "POST",
                            beforeSend: function(t) {
                                t.setRequestHeader("X-CSRF-Token", FX.STATIC.CSRF),
                                    t.setRequestHeader("X-JDY-Ver", FX.STATIC._ver)
                            },
                            url: t.url,
                            async: !1 !== t.async,
                            data: JSON.stringify(e),
                            contentType: "application/json;charset=UTF-8",
                            timeout: t.timeout || 0,
                            xhrFields: t.xhrFields
                        }).done(function(t, e, i) {
                            FX.Utils.getServerDate(i),
                            a && a(t, e),
                            s && s(t, e)
                        }).fail(function(t, e, i) {
                            switch (t.status) {
                                case 400:
                                    var a;
                                    !1 === FX.Utils.applyFunc(this, n, [t, e], !1) && ((a = t.responseJSON || {}).code ? FX.Msg.toast({
                                        type: "warning",
                                        msg: FX.Utils.getErrMsg(a)
                                    }) : FX.Msg.toast({
                                        type: "error",
                                        msg: i18next.t("error.status.400")
                                    }));
                                    break;
                                case 401:
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.401")
                                    });
                                    break;
                                case 402:
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.402")
                                    });
                                    break;
                                case 403:
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.403")
                                    });
                                    break;
                                case 404:
                                    !1 === FX.Utils.applyFunc(this, n, [t, e], !1) && FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.404")
                                    });
                                    break;
                                case 409:
                                    FX.Msg.alert({
                                        title: i18next.t("error.status.corpSwitch"),
                                        msg: i18next.t("error.status.corpSwitch.tip"),
                                        text4Ok: i18next.t("iSee"),
                                        text4Cancel: null
                                    });
                                    break;
                                case 429:
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.429")
                                    });
                                    break;
                                case 0:
                                    break;
                                default:
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: i18next.t("error.status.fail")
                                    })
                            }
                            s && s(t, e)
                        })
                },
                ajaxUpload: function(e, t, i, a) {
                    f.ajax({
                        type: "POST",
                        url: e.url,
                        data: e.data,
                        cache: !1,
                        contentType: !1,
                        processData: !1,
                        beforeSend: function(t) {
                            t.setRequestHeader("X-CSRF-Token", FX.STATIC.CSRF)
                        },
                        xhr: function() {
                            var t = f.ajaxSettings.xhr();
                            return t.upload && e.onUpload && t.upload.addEventListener("progress", function(t) {
                                t.lengthComputable ? e.onUpload(t.loaded, t.total) : e.onUpload(3, 10)
                            }, !1),
                                t
                        }
                    }).done(function() {
                        t && t.apply(this, arguments),
                        a && a.apply(this, arguments)
                    }).fail(function() {
                        i && i.apply(this, arguments),
                        a && a.apply(this, arguments)
                    })
                },
                dataAjax: function(t, i, e, a) {
                    t.data = t.data || {};
                    var n = t.data;
                    return FX.Utils.isEmpty(FX.STATIC.APPID) || (n.appId = n.appId || FX.STATIC.APPID),
                    FX.Utils.isEmpty(FX.STATIC.ENTRYID) || (n.entryId = n.entryId || FX.STATIC.ENTRYID),
                    FX.Utils.isEmpty(FX.STATIC.DATAID) || (n.dataId = n.dataId || FX.STATIC.DATAID),
                    FX.STATIC.BACKUP && (n.isBackup = !0),
                        FX.Utils.ajax(t, function(t, e) {
                            i && i(t, e)
                        }, e, a)
                },
                getUrlParameter: function(t) {
                    for (var e = window.location.search.substring(1).split("&"), i = 0; i < e.length; i++) {
                        var a = e[i].split("=");
                        if (a[0] == t)
                            return a[1]
                    }
                    return null
                },
                escapeRegexp: function(t) {
                    if ("string" != typeof t)
                        return "";
                    return t.replace(/[|\\{}()[\]^$+*?.]/g, "\\$&")
                },
                validateEmail: function(t) {
                    return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.email).test(t)
                },
                validateMobile: function(t) {
                    return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.mobile).test(t)
                },
                validateInterMobile: function(t) {
                    return new RegExp(FX.CONST.TEXT_TYPE_REGEXP.interMobile).test(t)
                },
                formatInterMobile: function(i, a) {
                    if (FX.Utils.isString(i)) {
                        if (0 <= i.indexOf(a))
                            return i;
                        FX.Utils.startWith(i, "+") && FX.Utils.forEach(FX.CONST.AREA_CODE, function(t, e) {
                            i = i.replace(e.value, function(t) {
                                return t + a
                            })
                        })
                    }
                    return i
                },
                redirectTo: function(t) {
                    window.location.href = t
                },
                isCanvasSupported: function() {
                    var t = document.createElement("canvas");
                    return !(!t.getContext || !t.getContext("2d"))
                },
                isFormDataSupported: function() {
                    return void 0 !== window.FormData
                },
                getPublicImageUrl: function(t) {
                    if (FX.Utils.isObjectEmpty(t))
                        return "";
                    var e = "";
                    switch (t.bucket) {
                        case FX.CONST.QN_BUCKET.PUBLIC_IMAGE:
                            var i = "?attname=" + encodeURIComponent(t.name)
                                , a = t.thumb;
                            a && (i += "&imageView2/" + a.mode + "/w/" + a.width + "/h/" + a.height),
                                e = FX.CONFIG.HOST.IMAGE_HOST + "/" + t.qnKey + i;
                            break;
                        case FX.CONST.OSS_BUCKET.PUBLIC_IMAGE:
                            e = FX.CONFIG.HOST.OSS_IMAGE_HOST + "/" + t.ossKey
                    }
                    return e
                },
                getEntryAttribute: function(t, e) {
                    var i = ["creator", "createTime", "updateTime"];
                    return t && i.push("ext"),
                    e || i.push("flowState", "chargers"),
                        i
                },
                createEntryAttributeField: function(t, e, i) {
                    if (i && -1 < i.indexOf(t))
                        return null;
                    var a = {
                        id: e.entryId
                    };
                    switch (t) {
                        case "label":
                            f.extend(a, {
                                name: "label",
                                type: "text",
                                text: i18next.t("label")
                            });
                            break;
                        case "ext":
                            f.extend(a, {
                                name: "ext",
                                type: "text",
                                text: i18next.t("field.ext"),
                                items: e.extParams
                            });
                            break;
                        case "createTime":
                            f.extend(a, {
                                name: "createTime",
                                type: "datetime",
                                format: "yyyy-MM-dd HH:mm:ss",
                                text: i18next.t("field.createTime")
                            });
                            break;
                        case "updateTime":
                            f.extend(a, {
                                name: "updateTime",
                                type: "datetime",
                                format: "yyyy-MM-dd HH:mm:ss",
                                text: i18next.t("field.updateTime")
                            });
                            break;
                        case "creator":
                            f.extend(a, {
                                name: "creator",
                                type: "user",
                                text: i18next.t("field.creator")
                            });
                            break;
                        case "flowState":
                            f.extend(a, {
                                name: "flowState",
                                type: "flowState",
                                text: i18next.t("field.flowState")
                            });
                            break;
                        case "chargers":
                            f.extend(a, {
                                name: "chargers",
                                type: "chargers",
                                text: i18next.t("field.chargers")
                            });
                            break;
                        case "deleter":
                            f.extend(a, {
                                name: "deleter",
                                type: "user",
                                text: i18next.t("field.deleter")
                            });
                            break;
                        case "deleteTime":
                            f.extend(a, {
                                name: "deleteTime",
                                type: "datetime",
                                format: "yyyy-MM-dd HH:mm:ss",
                                text: i18next.t("field.deleteTime")
                            });
                            break;
                        case "wx_open_id":
                            f.extend(a, {
                                name: "wx_open_id",
                                type: "text",
                                text: i18next.t("field.wx.openId")
                            });
                            break;
                        case "wx_nickname":
                            f.extend(a, {
                                name: "wx_nickname",
                                type: "text",
                                text: i18next.t("field.wx.nickname")
                            });
                            break;
                        case "wx_gender":
                            f.extend(a, {
                                name: "wx_gender",
                                type: "text",
                                text: i18next.t("field.wx.gender")
                            });
                            break;
                        case "wx_avatar":
                            f.extend(a, {
                                name: "wx_avatar",
                                type: "image",
                                text: i18next.t("field.wx.avatar")
                            });
                            break;
                        default:
                            return null
                    }
                    return a
                },
                createWidgetName: function() {
                    return "_widget_" + FX.STATIC.IDBase++
                },
                formatFileSize: function(t) {
                    return FX.Utils.isNumber(t) ? 1073741824 <= t ? (t / 1073741824).toFixed(2) + " GB" : 1048576 <= t ? (t / 1048576).toFixed(2) + " MB" : (t / 1024).toFixed(2) + " KB" : i18next.t("unknown")
                },
                formatData: function(t, e) {
                    if (!t)
                        return e;
                    var i = t.cellFmt && t.cellFmt.data || t.format;
                    switch (t.type) {
                        case "datetime":
                            i = i || "yyyy-MM-dd",
                                e = FX.Utils.isNull(e) ? "" : FX.Utils.date2Str(new Date(e), i);
                            break;
                        case "address":
                            i = i || "pcda",
                                e = FX.Utils.address2Str(e, "", i);
                            break;
                        case "location":
                            i = i || "pcda";
                            var a = "";
                            t.lnglatVisible && (a = FX.Utils.getLnglatText(e)),
                                e = {
                                    address: FX.Utils.address2Str(e, "", i),
                                    lngLat: a
                                };
                            break;
                        case "number":
                        case "formula":
                            i = i || "",
                                e = FX.Utils.num2Str(e, i);
                            break;
                        case "text":
                            e = e || "",
                            "creator" !== t.name || FX.Utils.isString(e) || (e = e ? e.name : "");
                            break;
                        default:
                            e = FX.Utils.isNull(e) ? "" : e
                    }
                    return e
                },
                chunkArray: function(t, e) {
                    var i = [];
                    if (!e || !t.length)
                        return i;
                    for (var a = 0, n = t.length; a < n; a += e) {
                        var s = t.slice(a, a + e);
                        i.push(s)
                    }
                    return i
                },
                UUID: function(t) {
                    return t ? (t ^ 16 * Math.random() >> t / 4).toString(16) : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, this.UUID)
                },
                GCD: function(t, e) {
                    return e ? this.GCD(e, t % e) : t
                },
                LCM: function(t, e) {
                    return t * e / this.GCD(t, e)
                },
                str2num: function(t) {
                    if (FX.Utils.isEmpty(t))
                        return null;
                    var e = parseFloat(t);
                    return isNaN(e) ? null : e
                },
                fixDecimalPrecision: function(t, e) {
                    var i, a, n = "";
                    return e = e || 8,
                    this.isEmpty(t) || (i = parseFloat(t),
                    isNaN(i) || (n = (a = (i + "").split(".")[1]) && a.length > e ? parseFloat(FX.Utils.toFixed(i, e)) : i,
                    6 < e && Math.abs(n) < 1 && /e-/.test(n + "") && (n = parseFloat(FX.Utils.toFixed(i, 6))))),
                        n
                },
                toFixed: function(t, e) {
                    return new Big(t).toFixed(e).toString()
                },
                getSelectionText: function() {
                    return window.getSelection ? window.getSelection().toString() : document.selection && document.selection.createRange ? document.selection.createRange().text : ""
                },
                getCorpType: function(t) {
                    return t ? (t = t.toLowerCase(),
                        /^ding/.test(t) ? "dingtalk" : /^w/.test(t) ? "wechat" : "internal") : null
                },
                checkPassLength: function(t) {
                    return new RegExp("^.{8,}$").test(t)
                },
                checkPassStandard: function(t) {
                    return FX.CONST.PASSWORD_REG.STANDARD.test(t)
                },
                isFromWorkWechat: function(t) {
                    return !(!t || !t.username) && /^wxtmp-/.test(t.username)
                },
                isFromDingDing: function(t) {
                    return !(!t || !t.username) && /^dingtmp-/.test(t.username)
                },
                isCorpSuiteAdmin: function(t) {
                    var e = FX.Utils.getCorpType(t);
                    return e && ("dingtalk" === e || "wechat" === e)
                },
                parseNumber: function(t) {
                    var e = parseFloat(t);
                    return !isNaN(e) && isFinite(e) ? e : null
                },
                getWeekStartDate: function(t) {
                    var e = t.getDay();
                    return 0 === e && (e = 7),
                        new Date(t.getFullYear(),t.getMonth(),t.getDate() - (e - 1))
                },
                getWeekEndDate: function(t) {
                    var e = t.getDay();
                    return 0 === e && (e = 7),
                        new Date(t.getFullYear(),t.getMonth(),t.getDate() + (7 - e))
                },
                getMonthStartDate: function(t) {
                    return new Date(t.getFullYear(),t.getMonth(),1)
                },
                getMonthEndDate: function(t) {
                    return new Date(t.getFullYear(),t.getMonth() + 1,0)
                },
                setPageTitle: function(t) {
                    FX.Utils.isEmpty(t) || (document.title = t)
                },
                createMask: function(t, e) {
                    var i, a = f('<div class="x-window-mask"/>'), n = e || {};
                    return n.isModal && a.addClass("modal"),
                        n.isLight ? a.addClass("light") : n.isDark && a.addClass("dark"),
                    n.isCenter && a.addClass("center"),
                    n.hasLoader && (i = !n.isDark,
                        this.createLoadIcon(a, i)),
                    t && a.css({
                        "z-index": FX.STATIC.zIndex++
                    }).appendTo(t),
                        a
                },
                createSkeletonSpin: function(t, e) {
                    var i = f('<div class="x-skeleton-spin"/>');
                    t && i.appendTo(t);
                    var a = f.extend({
                        hasTitle: !1,
                        rowNum: -1
                    }, e);
                    a.hasTitle && f('<div class="skeleton-line title"/>').appendTo(i);
                    for (var n, s = 0, s = -1 === a.rowNum ? (n = i.height() - 15,
                    a.hasTitle && (n -= 30),
                        parseInt(n / 40)) : a.rowNum, r = 0; r < s; r++)
                        f('<div class="skeleton-line"/>').appendTo(i);
                    return i
                },
                createLoadIcon: function(t, e) {
                    var i = f('<div class="x-loader-icon"/>').appendTo(t);
                    return e && i.addClass("colorful"),
                        f("<div/>").appendTo(i),
                        i
                },
                createQrcode: function(t, e, i, a) {
                    var n = document.createElement("div");
                    new QRCode(n,{
                        text: t,
                        width: e,
                        height: i
                    });
                    var s = n.getElementsByTagName("img")[0];
                    s.onload = function() {
                        a(s.src)
                    }
                },
                createQrcodeBtn: function(e, t, i, a) {
                    var n;
                    t = t || "icon-qrcode";
                    var s = f("<a/>").attr("title", i18next.t("qrCode")).append(f("<i/>").addClass(t)).on("click", function() {
                        n ? FX.Utils.createQrcodeDropDown(s, e, i18next.t("msg.qrCode"), a, n) : FX.Utils.createQrcode(e, 128, 128, function(t) {
                            n = t,
                                FX.Utils.createQrcodeDropDown(s, e, i18next.t("msg.qrCode"), a, n)
                        }),
                        i && i()
                    });
                    return s
                },
                createQrcodeDropDown: function(t, e, i, a, n) {
                    var s, r;
                    a ? (s = f('<div class="qrcode-dropdown-download"/>'),
                        f('<div class="qrcode-desc" />').text(i).appendTo(s),
                        f("<img/>").attr("src", n).appendTo(s),
                        f('<span class="download-btn"><i class="download-icon icon-vip-center-excel-import" />' + i18next.t("download") + "</span>").appendTo(s).on("click", function() {
                            r ? FX.Utils.downloadQrcode(r, a) : FX.Utils.createQrcode(e, 1024, 1024, function(t) {
                                r = t,
                                    FX.Utils.downloadQrcode(r, a)
                            })
                        })) : (s = f('<div class="qrcode-dropdown"/>'),
                        f("<img/>").attr("src", n).appendTo(s),
                        f("<div/>").text(i).appendTo(s)),
                        FX.Msg.bubble({
                            anchor: t,
                            text4Ok: null,
                            minWidth: 150,
                            text4Cancel: null,
                            contentHTML: s,
                            edge: 200
                        })
                },
                downloadQrcode: function(t, e) {
                    var i;
                    t && e && (window.navigator.msSaveBlob ? window.navigator.msSaveBlob(FX.Utils.dataURLtoBlob(t), e.substring(0, 255) + ".png") : ((i = document.createElement("a")).download = e,
                        i.href = t,
                        i.style.display = "none",
                        document.body.appendChild(i),
                        i.click(),
                        document.body.removeChild(i)))
                },
                doPrint: function(t, e) {
                    f("body").children("div, svg").addClass("x-ui-notprint");
                    var i = f("#x-printer").removeClass().empty();
                    0 === i.length && (i = f('<div id="x-printer"/>').appendTo("body")),
                    t && i.append(t),
                        e = FX.Utils.isNull(e) ? 0 : e,
                        setTimeout(function() {
                            window.print()
                        }, e)
                },
                cancelPrint: function() {
                    f("body").children(".x-ui-notprint").removeClass("x-ui-notprint"),
                        f("#x-printer").remove()
                },
                parseMm2Pt: function(t) {
                    return parseFloat((t / 25.4 * FX.CONST.PRINT_DPI).toFixed(2))
                },
                parsePt2Mm: function(t) {
                    return parseFloat((t / FX.CONST.PRINT_DPI * 25.4).toFixed(2))
                },
                copyToClipboard: function(t, e) {
                    if (t && t.length) {
                        var i, a = document.createElement("textarea");
                        a.style.background = "transparent",
                            a.style.color = "transparent",
                            a.value = t,
                            document.body.appendChild(a),
                            a.select();
                        try {
                            i = document.execCommand("copy")
                        } catch (t) {
                            i = !1
                        }
                        document.body.removeChild(a),
                        i && FX.Utils.applyFunc(this, e, [], !1)
                    }
                },
                getTeamManageText: function() {
                    return i18next.t("contacts")
                },
                getColorNumber: function(t) {
                    return FX.Utils.isEmpty(t) ? 1 : parseInt(t.toString().substring(0, 8), 16) % 6 + 1
                },
                getShowFieldItems: function(t, e, n) {
                    var s = []
                        , r = {};
                    return FX.Utils.forEach(t, function(t, i) {
                        "subform" === i.type ? FX.Utils.forEach(i.items, function(t, e) {
                            r[[i.name, e.name].join(".")] = !0
                        }) : r[i.name] = !0
                    }),
                        FX.Utils.forEach(e, function(t, a) {
                            var e;
                            n && n.indexOf(a.type) < 0 || ((e = {
                                text: "chargers" === a.type ? i18next.t("field.chargers") : a.text,
                                value: a.name
                            }).selected = r[e.value],
                                "subform" === a.type ? FX.Utils.forEach(a.items, function(t, e) {
                                    var i;
                                    n && n.indexOf(e.type) < 0 || "linkquery" === e.type || ((i = {
                                        value: [a.name, e.name].join("."),
                                        text: [a.text, e.text].join(".")
                                    }).selected = r[i.value],
                                        s.push(i))
                                }) : s.push(e))
                        }),
                        s
                },
                getFlatLengthByFields: function(t) {
                    var i = 0;
                    return FX.Utils.forEach(t, function(t, e) {
                        "subform" === e.type ? i += e.items.length : i += 1
                    }),
                        i
                },
                getFieldAttr: function(a, n) {
                    var s = a.widget || a;
                    if (!FX.Utils.isValueWidget(s.type) && "linkquery" !== s.type)
                        return null;
                    if (n && n.indexOf(s.type) < 0)
                        return null;
                    var t = {
                        id: a.formId,
                        text: a.label,
                        name: s.widgetName,
                        type: s.type
                    };
                    switch (s && s.colorEnable && (t.colorEnable = s.colorEnable),
                    s && s.regex && (t.regex = s.regex),
                    s && s.pc_sticky_column && (t.pc_sticky_column = s.pc_sticky_column),
                        s.type) {
                        case "subform":
                            var r = [];
                            FX.Utils.forEach(s.items, function(t, e) {
                                f.extend(e, {
                                    formId: a.formId
                                });
                                var i = FX.Utils.getFieldAttr(e, n);
                                i && (f.extend(i, {
                                    subform: s.widgetName
                                }),
                                    r.push(i))
                            }),
                                f.extend(t, {
                                    items: r
                                });
                            break;
                        case "linkdata":
                            f.extend(t, {
                                linkForm: s.linkForm,
                                linkFields: s.linkFields,
                                linkType: s.linkType,
                                linkKey: s.linkKey,
                                refAppId: s.refAppId,
                                allowAdd: s.allowAdd
                            });
                            break;
                        case "linkquery":
                            f.extend(t, {
                                linkForm: s.linkForm,
                                linkFields: s.linkFields,
                                refAppId: s.refAppId,
                                multi: s.multi,
                                allowAdd: s.allowAdd
                            });
                            break;
                        case "combo":
                        case "combocheck":
                        case "radiogroup":
                        case "checkboxgroup":
                            f.extend(t, {
                                async: s.async,
                                items: s.items
                            });
                            break;
                        case "datetime":
                            f.extend(t, {
                                format: s.format
                            });
                            break;
                        case "address":
                            f.extend(t, {
                                needDetail: s.needDetail
                            });
                            break;
                        case "location":
                            f.extend(t, {
                                lnglatVisible: s.lnglatVisible
                            })
                    }
                    return t
                },
                getFieldsIntersection: function(t, e) {
                    var n = [];
                    if (!t || !e)
                        return n;
                    var s = {};
                    return FX.Utils.forEach(t, function(t, e) {
                        var i = FX.Utils.getFieldName(e);
                        i && (s[i] = e)
                    }),
                        FX.Utils.forEach(e, function(t, e) {
                            var i = FX.Utils.getFieldName(e)
                                , a = s[i];
                            a && ("subform" === e.type && (a.items = FX.Utils.getFieldsIntersection(a.items, e.items)),
                                n.push(f.extend({}, a, {
                                    text: e.text
                                })))
                        }),
                        n
                },
                getFieldName: function(t) {
                    return t ? t.name || t.widget && t.widget.widgetName : ""
                },
                leftPad: function(t, e, i) {
                    var a = String(t);
                    for (i = i || " "; a.length < e; )
                        a = i + a;
                    return a.toString()
                },
                startWith: function(t, e) {
                    var i = t.length;
                    return !(null == e || "" == e || 0 === i || e.length > i) && t.substr(0, e.length) == e
                },
                getFieldInfoByFormula: function(t) {
                    var i = {}
                        , e = (t + "").match(/(\$[0-9a-zA-Z\._]+)(#[0-9a-f]+)?(@[0-9a-f]+)?/)
                        , a = ["", "field", "entryId", "appId"];
                    return FX.Utils.forEach(e, function(t, e) {
                        0 !== t && e && (i[a[t]] = e.substr(1))
                    }),
                        i
                },
                getFieldInfoById: function(t) {
                    var i = {}
                        , e = (t = "#" + t).match(/(#[0-9a-f]+)(@[0-9a-f]+)?/)
                        , a = ["", "entryId", "appId"];
                    return FX.Utils.forEach(e, function(t, e) {
                        0 !== t && e && (i[a[t]] = e.substr(1))
                    }),
                        i
                },
                fieldAuthValue2Json: function(t) {
                    return {
                        visible: !!(1 & t),
                        enable: !!(2 & t),
                        brief: !!(4 & t),
                        subform_create: !!(16 & t),
                        subform_edit: !!(32 & t),
                        subform_delete: !!(64 & t)
                    }
                },
                fieldAuthJson2Value: function(t) {
                    return (+t.visible << 0) + (+t.enable << 1) + (+t.brief << 2) + (+t.subform_create << 4) + (+t.subform_edit << 5) + (+t.subform_delete << 6)
                },
                isFieldAuthVisible: function(t) {
                    return 1 & t
                },
                isFieldValid: function(t) {
                    return /^_widget_/.test(t)
                },
                getSubformRowIdx: function(t) {
                    return f(t.element).closest(".subform-row").data("row-idx")
                },
                getSubformWidgetWidth: function(t) {
                    var e = 150;
                    switch (t.type) {
                        case "datetime":
                            e = 180;
                            break;
                        case "combo":
                        case "combocheck":
                        case "checkboxgroup":
                        case "user":
                        case "usergroup":
                        case "dept":
                        case "deptgroup":
                            e = 200;
                            break;
                        case "address":
                        case "textarea":
                        case "location":
                            e = 250;
                            break;
                        case "image":
                        case "upload":
                            e = 160
                    }
                    switch (t.fieldWidth) {
                        case FX.CONST.FIELD_WIDTH.HALF:
                            "datetime" === t.type ? e = 2 * e / 3 : e /= 2;
                            break;
                        case FX.CONST.FIELD_WIDTH.TWICE:
                            e *= 2
                    }
                    return e
                },
                setLayoutSize: function(t, e, i) {
                    switch (e) {
                        case "normal":
                            f.extend(t, FX.Utils.getNormalLayoutSize(i));
                            break;
                        case "grid-2":
                            f.extend(t, FX.Utils.getGrid2LayoutSize(i));
                            break;
                        case "full-line":
                            f.extend(t, FX.Utils.getFullLineLayoutSize(i))
                    }
                    "linkquery" !== t.type && "linkdata" !== t.type || f.extend(t, {
                        layout: e
                    })
                },
                getNormalLayoutSize: function(t) {
                    switch (t) {
                        case "location":
                            return {
                                width: 330,
                                btnWidth: 330
                            };
                        case "image":
                        case "upload":
                            return {
                                width: 330,
                                thumbWidth: 65,
                                thumbHeight: 65
                            };
                        case "subform":
                            return {
                                tipWidth: 330
                            };
                        case "linkdata":
                        case "linkquery":
                            return {
                                width: 330,
                                btnWidth: 330
                            };
                        case "text":
                        case "number":
                        case "datetime":
                        case "combo":
                        case "combocheck":
                            return {
                                width: 330,
                                height: 30
                            };
                        case "user":
                        case "dept":
                            return {
                                width: 330,
                                height: 40
                            };
                        case "checkboxgroup":
                            return {
                                width: 720
                            };
                        case "usergroup":
                        case "deptgroup":
                            return {
                                width: 720,
                                height: 80
                            };
                        case "textarea":
                            return {
                                width: 720,
                                height: 140
                            };
                        case "radiogroup":
                            return {
                                width: 720,
                                otherInputWidth: 274
                            };
                        case "address":
                            return {
                                width: 720,
                                width4province: 310,
                                width4city: 200,
                                width4district: 200,
                                height4detail: 46
                            };
                        case "signature":
                            return {
                                width: null,
                                height: null
                            };
                        case "phone":
                            return {
                                width: 330
                            };
                        default:
                            return {}
                    }
                },
                getGrid2LayoutSize: function(t) {
                    switch (t) {
                        case "location":
                            return {
                                width: 330,
                                btnWidth: 330
                            };
                        case "image":
                        case "upload":
                            return {
                                width: 330,
                                thumbWidth: 65,
                                thumbHeight: 65
                            };
                        case "subform":
                            return {
                                tipWidth: 330
                            };
                        case "linkdata":
                        case "linkquery":
                            return {
                                width: 330,
                                btnWidth: 330
                            };
                        case "text":
                        case "number":
                        case "datetime":
                        case "combo":
                        case "combocheck":
                            return {
                                width: 330,
                                height: 30
                            };
                        case "user":
                        case "dept":
                            return {
                                width: 330,
                                height: 40
                            };
                        case "checkboxgroup":
                            return {
                                width: 330
                            };
                        case "usergroup":
                        case "deptgroup":
                            return {
                                width: 330,
                                height: 80
                            };
                        case "textarea":
                            return {
                                width: 330,
                                height: 140
                            };
                        case "radiogroup":
                            return {
                                width: 330,
                                otherInputWidth: 274
                            };
                        case "address":
                            return {
                                width: 330,
                                width4province: 150,
                                width4city: 85,
                                width4district: 85,
                                height4detail: 65
                            };
                        case "signature":
                            return {
                                width: null,
                                height: null
                            };
                        case "phone":
                            return {
                                width: 330
                            };
                        default:
                            return {}
                    }
                },
                getFullLineLayoutSize: function(t) {
                    switch (t) {
                        case "location":
                            return {
                                width: 720,
                                btnWidth: 330
                            };
                        case "image":
                        case "upload":
                            return {
                                width: 720,
                                thumbWidth: 65,
                                thumbHeight: 65
                            };
                        case "subform":
                            return {
                                tipWidth: 330
                            };
                        case "linkdata":
                        case "linkquery":
                            return {
                                width: 720,
                                btnWidth: 720
                            };
                        case "text":
                        case "number":
                        case "datetime":
                        case "combo":
                        case "combocheck":
                            return {
                                width: 720,
                                height: 30
                            };
                        case "user":
                        case "dept":
                            return {
                                width: 720,
                                height: 40
                            };
                        case "checkboxgroup":
                            return {
                                width: 720
                            };
                        case "usergroup":
                        case "deptgroup":
                            return {
                                width: 720,
                                height: 80
                            };
                        case "textarea":
                            return {
                                width: 720,
                                height: 140
                            };
                        case "radiogroup":
                            return {
                                width: 720,
                                otherInputWidth: 664
                            };
                        case "address":
                            return {
                                width: 720,
                                width4province: 310,
                                width4city: 200,
                                width4district: 200,
                                height4detail: 46
                            };
                        case "signature":
                            return {
                                width: null,
                                height: null
                            };
                        case "phone":
                            return {
                                width: 330
                            };
                        default:
                            return {}
                    }
                },
                fileDownload: function(t) {
                    FX.Utils.redirectTo(t)
                },
                isSupportPdf: function() {
                    return void 0 !== navigator.mimeTypes["application/pdf"]
                },
                isExternalLink: function() {
                    return FX.STATIC.FTOKEN || FX.STATIC.RTOKEN || FX.STATIC.ATOKEN || FX.STATIC.DTOKEN
                },
                isMembersEmpty: function(t) {
                    return !!FX.Utils.isObjectEmpty(t) || !t.creator && !t.charger && !t.hasCurrentUser && !t.hasCurrentDept && FX.Utils.isObjectEmpty(t.deptManager) && FX.Utils.isObjectEmpty(t.widgets) && FX.Utils.isObjectEmpty(t.departs) && FX.Utils.isObjectEmpty(t.users) && FX.Utils.isObjectEmpty(t.deptWidgets) && FX.Utils.isObjectEmpty(t.contacts) && FX.Utils.isObjectEmpty(t.roles)
                },
                dt: function(t, e) {
                    var i;
                    t && (FXTracker.configured() || FXTracker.config({
                        host: FX.CONFIG.HOST.TRACK_HOST,
                        defaultParam: {
                            u: FX.CorpUser.getUsername(),
                            c: FX.CorpUser.getCurrentCorpId()
                        }
                    }),
                        i = {},
                    e && (i.ext = e),
                    FX.STATIC.APPID && (i.app_id = FX.STATIC.APPID),
                    FX.STATIC.ENTRYID && (i.entry_id = FX.STATIC.ENTRYID),
                        FXTracker.dt(t, i))
                },
                createSvgEl: function(t, e) {
                    return f(document.createElementNS("http://www.w3.org/2000/svg", t)).attr(e || {})
                },
                getTargetUrl: function(t, e) {
                    var i = "/dashboard";
                    switch (t) {
                        case "aggregateList":
                            i += "#/app/" + e.appId + "/set/app-aggregate";
                            break;
                        case "printList":
                            i += "/app/" + e.appId + "/form/" + e.entryId + "/edit?action=print#/set";
                            break;
                        case "formData":
                            i += "/app/" + e.appId + "/form/" + e.entryId + "/edit#/data";
                            break;
                        case "etl":
                            i += "#/app/" + e.appId + "/set/app-etl";
                            break;
                        case "trigger":
                            i += "#/app/" + e.appId + "/set/app-trigger"
                    }
                    return i
                },
                formatOrderProduct: function(t) {
                    var e = "";
                    switch (t.type) {
                        case "level":
                            e = FX.CONST.VIP_ORDER.PACK[t.value].name;
                            break;
                        case "service":
                            e = FX.CONST.VIP_ORDER.SERVICE[t.value].name;
                            break;
                        case "user":
                            e = i18next.t("order.user", {
                                value: t.value
                            });
                            break;
                        case "data_addon":
                            e = i18next.t("order.add.data", {
                                value: t.value / FX.CONST.VIP_ORDER.DATA_ADD_UNIT
                            });
                            break;
                        case "form_data_addon":
                            e = i18next.t("order.add.data.form", {
                                value: t.value / FX.CONST.VIP_ORDER.FORM_DATA_UNIT
                            });
                            break;
                        case "data_api_addon":
                            e = i18next.t("order.add.api");
                            break;
                        case "upload_addon":
                            e = i18next.t("order.add.upload", {
                                value: t.value / FX.CONST.VIP_ORDER.UPLOAD_ADD_UNIT
                            });
                            break;
                        case "aggregate_addon":
                            e = i18next.t("order.add.aggregate", {
                                value: t.value
                            });
                            break;
                        case "data_backup_addon":
                            e = i18next.t("order.add.backup", {
                                value: t.value
                            });
                            break;
                        case "managers_addon":
                            e = i18next.t("order.add.manager", {
                                value: t.value
                            });
                            break;
                        case "etl_addon":
                            e = i18next.t("order.add.etl", {
                                value: t.value
                            });
                            break;
                        case "trigger_addon":
                            e = i18next.t("order.add.trigger", {
                                value: t.value
                            });
                            break;
                        case "sms_pack":
                            e = i18next.t("order.add.sms", {
                                value: t.count
                            });
                            break;
                        case "sso_addon":
                            e = i18next.t("order.add.sso");
                            break;
                        case "custom_login_addon":
                            e = i18next.t("order.add.customLogin")
                    }
                    return e
                },
                addClsToSystemField: function(t, a) {
                    return FX.Utils.forEach(t, function(t, e) {
                        var i = e.value;
                        /^_widget_/.test(i) || f.extend(e, {
                            cls: a
                        })
                    }),
                        t
                },
                parseMembers2Ids: function(t) {
                    var i = {};
                    return FX.Utils.forEach(t, function(t, e) {
                        switch (t) {
                            case "users":
                            case "departs":
                            case "roles":
                            case "contacts":
                                i[t] = e.map(function(t) {
                                    return t._id
                                });
                                break;
                            default:
                                i[t] = e
                        }
                    }),
                        i
                },
                format2ThumbDate: function(t) {
                    if (FX.Utils.isNull(t))
                        return null;
                    var e, i = new Date(t), a = new Date, n = a.getTime() - i.getTime(), s = +a.setHours(0, 0, 0, 0), r = +a.setHours(23, 59, 59, 999);
                    return 0 <= n && n < 36e5 ? (e = parseInt(n / 6e4, 10)) ? i18next.t("date.ago.minute", {
                        value: e
                    }) : i18next.t("date.just") : s < +i && +i <= r ? i18next.t("date.today.time", {
                        hour: FX.Utils.leftPad(i.getHours() + "", 2, "0"),
                        minute: FX.Utils.leftPad(i.getMinutes() + "", 2, "0")
                    }) : FX.Utils.date2Str(i, "yyyy-MM-dd HH:mm")
                },
                format2DateInfo: function(t, e) {
                    var i = new Date(t).getTime()
                        , a = new Date(e).getTime();
                    if (i === a)
                        return "";
                    var n = Math.floor(a / 1e3) - Math.floor(i / 1e3)
                        , s = Math.floor(n / 86400)
                        , r = Math.floor(n % 86400 / 3600)
                        , o = Math.floor(n % 3600 / 60)
                        , l = n % 60
                        , c = {};
                    return 0 < s && (c.day = s),
                    0 < r && (c.hour = r),
                    0 < o && (c.minute = o),
                    0 < l && (c.second = l),
                        c
                },
                getDateInfoFromNow: function(t) {
                    if (FX.Utils.isNull(t))
                        return null;
                    var e = {
                        isLater: !0
                    }
                        , i = new Date(t)
                        , a = (new Date).getTime() - i.getTime();
                    0 < a && (e.isLater = !1);
                    var n = 36e5
                        , s = 864e5;
                    return s <= (a = Math.abs(a)) ? (e.day = parseInt(a / s, 10),
                        e.hour = parseInt(a % s / n, 10),
                        e.minute = parseInt(a % s % n / 6e4, 10)) : n <= a ? (e.hour = parseInt(a / n, 10),
                        e.minute = parseInt(a % n / 6e4, 10)) : 6e4 <= a ? e.minute = parseInt(a / 6e4, 10) : e.isJustNow = !0,
                        e
                },
                formatUserThumb: function(t) {
                    if (!FX.Utils.isEmpty(t))
                        return {
                            color: t.charCodeAt(0) % 6,
                            name: t.substr(0, 1).toUpperCase()
                        }
                },
                isPdfExt: function(t) {
                    return /^pdf$/i.test(t)
                },
                isOfficeExt: function(t) {
                    return /^(doc|docx|ppt|pptx|xls|xlsx)$/i.test(t)
                },
                isImageExt: function(t) {
                    return /^(png|jpg|jpeg|gif)$/i.test(t)
                },
                isVideoExt: function(t) {
                    return /^(mp4|m4v|webm|mov)$/i.test(t)
                },
                isAudioExt: function(t) {
                    return /^(ogg|mp3|wav)$/i.test(t)
                },
                getArrayFromRange: function(t, e, i) {
                    var a = [];
                    switch (e) {
                        case "number":
                            a.push(FX.Utils.isNull(t.min) ? null : t.min),
                                a.push(FX.Utils.isNull(t.max) ? null : t.max);
                            break;
                        case "address":
                            a.push(t.province || null),
                                a.push(t.city || null),
                                a.push(t.district || null);
                            break;
                        case "datetime":
                            i = i || "yyyy-MM-dd",
                                a.push(t.min ? FX.Utils.date2Str(new Date(t.min), i) : null),
                                a.push(t.max ? FX.Utils.date2Str(new Date(t.max), i) : null)
                    }
                    return a
                },
                createFileThumb: function(t, e) {
                    e = e || "normal";
                    var i = "other";
                    return FX.Utils.isVideoExt(t) ? i = "video" : FX.Utils.isAudioExt(t) ? i = "audio" : FX.Utils.isImageExt(t) ? i = "image" : /^(pptx?|docx?|xlsx?|zip|rar|csv|txt|pdf)$/i.test(t) && (i = t.toLowerCase()),
                        f('<div class="fui_file_thumb ' + i + " size-" + e + '"/>')
                },
                getRandomCode: function(t, e) {
                    for (var i = e || "1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz", a = ""; 0 < t; ) {
                        a += i[Math.floor(Math.random() * i.length)],
                            t--
                    }
                    return a
                },
                resolveUsername: function(t, e) {
                    return e = e || "nickname",
                        FX.Utils.isObjectEmpty(t) ? "" : FX.Utils.isString(t) ? t : t._id === FX.USER_ID.SYS_ROBOT ? i18next.t("robot") : t[e] || ""
                },
                limitText: function(t, e) {
                    if (FX.Utils.isEmpty(t))
                        return "";
                    var i = e || 10;
                    return t.length > i && (t = t.slice(0, i) + "..."),
                        t
                },
                getShowFieldsByNames: function(t, n) {
                    var e = [];
                    return n ? FX.Utils.forEach(t, function(t, i) {
                        var a;
                        "subform" === i.type ? (a = [],
                            FX.Utils.forEach(i.items, function(t, e) {
                                -1 < n.indexOf([i.name, e.name].join(".")) && a.push(e)
                            }),
                        FX.Utils.isObjectEmpty(a) || e.push(f.extend({}, i, {
                            items: a
                        }))) : -1 < n.indexOf(i.name) && e.push(i)
                    }) : e = t,
                        e
                },
                formatSubformName: function(t, e, i) {
                    if (FX.Utils.isObjectEmpty(t))
                        return null;
                    if (e = e || "name",
                        i = i || "name",
                    t.subform && t[i] && t[i].indexOf(".") < 0) {
                        var a = {};
                        return a[i] = t.subform + "." + t[e],
                            f.extend(!0, {}, t, a)
                    }
                    return t
                },
                getFieldsByLimits: function(t, a, e) {
                    var n = [];
                    return FX.Utils.forEach(t, function(t, i) {
                        -1 < a.indexOf(i.type) ? "wx_avatar" !== i.name && n.push(i) : "subform" === i.type && e && FX.Utils.forEach(i.items, function(t, e) {
                            -1 < a.indexOf(e.type) && n.push(f.extend({}, e, {
                                name: [i.name, e.name].join("."),
                                text: [i.text, e.text].join(".")
                            }))
                        })
                    }),
                        n
                },
                showTemplate: function(a, t) {
                    var n, i, e, s, r, o, l, c, d, u, h;
                    a && (FX.Utils.dt(FX.CONST.TRACKER.APP_VIEW),
                        n = f.extend({
                            judgeState: !1,
                            channel: null
                        }, t),
                        i = FX.CONFIG.HOST.SITE_HOST + "/template/" + a._id,
                        e = "/dashboard/app/" + a._id + "?__hideHeader=true",
                        s = f('<div class="iframe-container"/>'),
                        r = f('<div class="container-header"/>').appendTo(s),
                        o = f('<div class="header-thumb">'),
                        new FX.AppIcon({
                            renderEl: f("<div/>").appendTo(o),
                            app: a,
                            size: "huge"
                        }),
                        o.appendTo(r),
                        l = f('<div class="title-wrapper"/>').appendTo(r),
                        f('<div class="header-title" />').text(a.name).appendTo(l),
                    (!n.judgeState || n.judgeState && a.state === FX.CONST.APP_STATE.onSale) && (c = f('<div class="header-btn-group"/>').appendTo(l),
                    FX.Utils.isEmpty(a.usecase) || f('<a class="btn-item" target="fx_help" href="' + decodeURIComponent(a.usecase) + '"><div class="item-text"><i class="text-icon icon-usage"/><span>' + i18next.t("template.case") + "</span></div></a>").appendTo(c),
                        f('<div class="btn-item"><div class="item-text"><i class="text-icon icon-share"></i><span>' + i18next.t("share") + "</span></div></div>").on("click", function() {
                            new FX.Dialog({
                                title: i18next.t("share"),
                                width: 600,
                                customCls: "fx_template_dialog",
                                onContentCreate: function(t) {
                                    var e = f('<div class="template-body"/>').appendTo(t);
                                    f('<div class="line-label">' + i18next.t("template.share") + "</div>").appendTo(e),
                                        new FX.ShareUrlPane({
                                            renderEl: f("<div/>").appendTo(e),
                                            url: i,
                                            qrcodeName: a.name + "_" + i18next.t("share")
                                        })
                                }
                            }).show()
                        }).appendTo(c),
                        d = f('<div class="btn-item install-btn"/>').appendTo(c),
                        new FX.Button({
                            renderEl: d,
                            height: 32,
                            iconCls: "icon-angledown align-right",
                            text: i18next.t("template.install"),
                            style: "green",
                            onClick: function() {
                                var t = f('<ul class="fx-template-install-dropdown"><li class="list-item has-data">' + i18next.t("template.install.withData") + '<span class="tip">' + i18next.t("template.install.withData.tip") + '</span></li><li class="list-item">' + i18next.t("template.install.withoutData") + "</li></ul>").on("click", ".list-item", function(t) {
                                    FX.STATIC.APPID = a._id;
                                    var e = {
                                        forkId: FX.STATIC.APPID,
                                        corpId: FX.CorpUser.getCurrentCorpId(),
                                        hasData: !1
                                    };
                                    n.channel && (e.channel = n.channel),
                                    f(t.currentTarget).hasClass("has-data") && (e.hasData = !0),
                                    i && i.close(),
                                        FX.Utils.ajax({
                                            url: FX.Utils.getApi(FX.API.app.install),
                                            data: e
                                        }, function(t) {
                                            FX.Utils.dt(FX.CONST.TRACKER.APP_FORK),
                                                h.close(),
                                            n.onClose && n.onClose(),
                                                FX.Utils.redirectTo("/dashboard#/app/" + t.app._id + "/edit"),
                                            t.hasReportConverted && FX.Msg.toast({
                                                type: "success",
                                                msg: i18next.t("app.install.report.convert")
                                            })
                                        }, function(t) {
                                            var e = t.responseJSON || {};
                                            FX.Utils.getTemplateTrial(e)
                                        })
                                })
                                    , i = new FX.Msg.bubble({
                                    anchor: d,
                                    contentHTML: t,
                                    minWidth: 160,
                                    hAdjust: 66,
                                    dockPosition: "right",
                                    contentPadding: 0,
                                    text4Cancel: null,
                                    text4Ok: null
                                })
                            }
                        })),
                        f('<div class="header-desc"/>').text(a.description).appendTo(r),
                        u = f('<iframe id="template-iframe" width="100%" height="100%" frameborder="0" src="' + e + '"/>'),
                        f('<div class="container-body" />').append(u).appendTo(s),
                        u.load(function() {
                            f(this).contents() && f(this).contents().on("mousedown", function() {
                                (f(window.parent.document) || f(document)).trigger("mousedown.bubble")
                            })
                        }),
                        (h = new FX.Slider({
                            title: a.name,
                            content: s
                        })).show())
                },
                hasDashAggregateFunc: function(t) {
                    return new RegExp(FX.CONST.DASH_AGGREGATE_FUNC.join("|")).test(t)
                },
                getVipTrial: function(e) {
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.profile.start_trial)
                    }, function(t) {
                        t.app && e && "active" === e.source ? new FX.VipTemplateDialog(f.extend({
                            app: t.app
                        }, e)).show() : FX.Msg.alert(f.extend({
                            type: "success",
                            title: i18next.t("vip.trial.success"),
                            msg: i18next.t("vip.trial.time", {
                                day: FX.CONST.TRIAL_TIME.HALF_MONTH
                            }),
                            text4Ok: i18next.t("vip.use.start"),
                            text4Cancel: null,
                            onOk: function() {
                                var t;
                                FX.CorpUser.isUserExist() && ((t = FX.Cookie.get(FX.CorpUser.getUsername() + FX.CONST.VIP_COOKIE.TRIAL.SUFFIX_KEY)) && 1 === (t = t.split(",")).length && (t.push(+new Date),
                                    FX.Cookie.set(FX.CorpUser.getUsername() + FX.CONST.VIP_COOKIE.TRIAL.SUFFIX_KEY, t.join(","), {
                                        expires: FX.CONST.VIP_COOKIE.TRIAL.EXPIRES_DATE
                                    })),
                                    window.location.reload())
                            }
                        }, e))
                    }, function(t) {
                        new FX.VipTemplateDialog(f.extend({
                            app: t.app
                        }, e)).show()
                    })
                },
                getTemplateTrial: function(t, e) {
                    var i;
                    if (t)
                        switch (t.code) {
                            case 7126:
                                i = FX.Msg.alert({
                                    title: i18next.t("template.trial"),
                                    msg: i18next.t("template.trial.time", {
                                        day: FX.CONST.TRIAL_TIME.HALF_MONTH
                                    }),
                                    type: "query",
                                    text4Ok: i18next.t("vip.trial.start"),
                                    text4Cancel: i18next.t("vip.trial.no"),
                                    onOk: function() {
                                        i.close(),
                                            e || FX.CorpUser.isCorpOwner() ? FX.Utils.getVipTrial({
                                                title: i18next.t("vip.trial.success"),
                                                msg: i18next.t("vip.trial.install", {
                                                    day: FX.CONST.TRIAL_TIME.HALF_MONTH
                                                }),
                                                text4Ok: null,
                                                text4Cancel: i18next.t("iSee")
                                            }) : FX.UI.showGetTrialAlert()
                                    }
                                });
                                break;
                            case 7127:
                                i = FX.Msg.alert({
                                    title: i18next.t("template.trial"),
                                    msg: i18next.t("template.trial.time", {
                                        day: FX.CONST.TRIAL_TIME.WEEK
                                    }),
                                    type: "query",
                                    text4Ok: i18next.t("vip.trial.start"),
                                    text4Cancel: i18next.t("vip.trial.no"),
                                    onOk: function() {
                                        i.close(),
                                            FX.Utils.dt(FX.CONST.TRACKER.TRIAL_SECOND),
                                            e || FX.CorpUser.isCorpOwner() ? FX.Utils.getVipTrial({
                                                title: i18next.t("vip.trial.success"),
                                                msg: i18next.t("vip.trial.install", {
                                                    day: FX.CONST.TRIAL_TIME.WEEK
                                                }),
                                                text4Ok: null,
                                                text4Cancel: i18next.t("iSee")
                                            }) : FX.UI.showGetTrialAlert()
                                    }
                                });
                                break;
                            case 2014:
                                FX.Msg.alert({
                                    title: i18next.t("template.install.fail"),
                                    msg: FX.Utils.getErrMsg(t),
                                    type: "warning",
                                    text4Ok: null,
                                    text4Cancel: i18next.t("iSee")
                                });
                                break;
                            default:
                                FX.Msg.alert({
                                    title: i18next.t("template.install.fail"),
                                    msg: i18next.t("template.upgrade"),
                                    type: "warning",
                                    text4Ok: i18next.t("vip.upgrade.yes"),
                                    text4Cancel: i18next.t("vip.upgrade.no"),
                                    onOk: function() {
                                        FX.Utils.redirectTo(FX.Utils.getApi(FX.API.profile.packs))
                                    }
                                })
                        }
                },
                skipEmptyStringify: function(t) {
                    return JSON.stringify(t, function(t, e) {
                        if (!FX.Utils.isObjectEmpty(e))
                            return e
                    }) || ""
                },
                filterFieldsByLimit: function(t, a) {
                    if (!a)
                        return t;
                    var n = [];
                    return FX.Utils.forEach(t, function(t, e) {
                        var i;
                        -1 < a.indexOf(e.type) && ("subform" === e.type ? (i = [],
                            FX.Utils.forEach(e.items, function(t, e) {
                                -1 < a.indexOf(e.type) && i.push(e)
                            }),
                            n.push(f.extend({}, e, {
                                items: i
                            }))) : n.push(e))
                    }),
                        n
                },
                iterateFields: function(t, a) {
                    var n = this;
                    FX.Utils.forEach(t, function(t, i) {
                        return "subform" !== i.type ? !FX.Utils.applyFunc(n, a, [i], null) : void FX.Utils.forEach(i.items, function(t, e) {
                            return FX.Utils.applyFunc(n, a, [e, i], null)
                        })
                    })
                },
                escapeHtmlSpecialChar: function(t) {
                    return FX.Utils.isEmpty(t) ? "" : t.replace(/[<>"&]/g, function(t, e, i) {
                        switch (t) {
                            case "<":
                                return "&lt;";
                            case ">":
                                return "&gt;";
                            case "&":
                                return "&amp;";
                            case '"':
                                return "&quot;"
                        }
                    })
                },
                loadScript: function(t, e) {
                    var i;
                    f("script[src^='" + t + "']").length <= 0 ? ((i = document.createElement("script")).type = "text/javascript",
                        i.src = t,
                        document.body.appendChild(i),
                        i.addEventListener("load", e)) : e && e()
                },
                uploadFile: function(t, e, i, a, n) {
                    var s, r, o = f.extend({
                        uploadSite: "qn",
                        uploadUrl: "https://upload.qiniup.com",
                        uploadToMedia: !1,
                        uploadToForm: !1,
                        appId: FX.STATIC.APPID,
                        entryId: FX.STATIC.ENTRYID,
                        uploadToken: "",
                        widgetName: "",
                        uploader: FX.CorpUser.getMemberId() || ""
                    }, t), l = new FormData;
                    "qn" === o.uploadSite ? (l.append("file", e),
                        l.append("token", o.uploadToken),
                        l.append("x:bucketType", o.uploadToMedia ? FX.CONST.QN_BUCKET.PUBLIC_IMAGE : FX.CONST.QN_BUCKET.PRIVATE_FILE),
                        l.append("x:uploader", o.uploader),
                    o.uploadToForm && (l.append("x:appId", o.appId),
                        l.append("x:entryId", o.entryId),
                        l.append("x:field", o.widgetName))) : ("oss" === o.uploadSite && (s = FX.Utils.UUID(),
                        r = o.uploadToken.split(":"),
                        l.append("Signature", r[2]),
                        l.append("OSSAccessKeyId", r[0]),
                        l.append("policy", r[1]),
                        l.append("callback", r[3]),
                        l.append("x:file_name", e.name),
                        l.append("x:bucket_type", FX.CONST.OSS_BUCKET.PUBLIC_IMAGE),
                        l.append("x:uploader", o.uploader),
                        l.append("key", s)),
                        l.append("file", e)),
                        FX.Utils.ajaxUpload({
                            url: o.uploadUrl,
                            data: l,
                            onUpload: i
                        }, function(t) {
                            return t.file ? void ("qn" === o.uploadSite || "oss" === o.uploadSite ? a(t, o.sequence) : a && a.apply(this, arguments)) : n()
                        }, n)
                },
                debounce: function(e, i, a) {
                    i = i || 0;
                    var n = null;
                    return function() {
                        n && clearTimeout(n);
                        var t = arguments;
                        n = setTimeout(function() {
                            FX.Utils.applyFunc(a, e, t, !1)
                        }, i)
                    }
                },
                getLnglatText: function(t) {
                    if (FX.Utils.isObjectEmpty(t) || FX.Utils.isObjectEmpty(t.lnglatXY))
                        return "";
                    var e = FX.Utils.fixDecimalPrecision(t.lnglatXY[1], 6)
                        , i = FX.Utils.fixDecimalPrecision(t.lnglatXY[0], 6);
                    return i18next.t("latLng", {
                        latitude: e,
                        longitude: i
                    })
                },
                getOwnerInfo: function(t) {
                    var e = "";
                    return t && (e = t.nickname,
                        t.phone ? e += "" + t.phone + "" : t.email && (e += "" + t.email + "")),
                        e
                },
                formatTransform: function(e) {
                    var i = {};
                    return ["-webkit-transform", "-moz-transform", "-ms-transform", "-o-transform", "transform"].map(function(t) {
                        i[t] = e
                    }),
                        i
                },
                fixFormMultiTab: function(e, i) {
                    var a, n;
                    e && 0 !== e.length && (e.off("scroll.multiTab"),
                        e.on("scroll.multiTab", function() {
                            n = f(".tab-list-wrapper:not(.clone-multi-tab-header)", e);
                            var t = a ? a.offset().top : n.offset().top;
                            if (0 < n.length)
                                if (t <= f(this).offset().top) {
                                    if (a)
                                        return;
                                    a = n.clone().addClass("clone-multi-tab-header"),
                                        n.after(a),
                                        n.addClass("fixed-multi-tab-header").css({
                                            top: f(this).offset().top,
                                            width: i.width()
                                        })
                                } else
                                    a && a.remove(),
                                        a = null,
                                        n.removeClass("fixed-multi-tab-header").css({
                                            top: "auto",
                                            width: "100%"
                                        })
                        }))
                },
                multiTabScrollTop: function(t, e) {
                    var i, a = t.find(".fixed-multi-tab-header"), n = t.find(".tab-list-wrapper:not(.fixed-multi-tab-header)");
                    0 !== a.length && 0 !== n.length && (i = e.scrollTop() - (a.offset().top - n.offset().top),
                        e.scrollTop(i))
                },
                getDropDownPos: function(t, e) {
                    var i = {
                        "z-Index": FX.STATIC.zIndex++
                    }
                        , a = t.offset()
                        , n = document.body.clientWidth - a.left;
                    n < e.width ? (i.right = n - this.element.outerWidth(),
                        i.left = "auto") : (i.right = "auto",
                        i.left = a.left);
                    var s = document.body.clientHeight + document.body.scrollTop - a.top - t.height()
                        , r = f("body").offset().top;
                    return s < e.height ? (i.top = "auto",
                        i.bottom = document.body.clientHeight - a.top + r) : (i.top = a.top + t.height() - r,
                        i.bottom = "auto"),
                        i
                },
                getFormLayout: function(t, e) {
                    var i = null;
                    return "grid-2" === t && (i = {},
                        FX.Utils.forEach(e, function(t, e) {
                            i[e.widget.widgetName] = e.lineWidth
                        })),
                        i
                },
                getErrMsg: function(t) {
                    return FX.Utils.isObjectEmpty(t) || FX.Utils.isEmpty(t.code) ? "" : i18next.t(["error." + t.code, "error.1"])
                },
                dealServerErrMsg: function(t) {
                    if (FX.Utils.isObjectEmpty(t) || FX.Utils.isEmpty(t.code))
                        return "";
                    return -1 < [4402].indexOf(t.code) ? t.msg || "" : FX.Utils.getErrMsg(t)
                },
                getSysTime: function() {
                    var t = FX.STATIC._st
                        , e = (new Date).getTime() - FX.STATIC._ct;
                    return 0 < e && (t += e),
                        new Date(t)
                },
                parseTimeOffset: function(t) {
                    if (!FX.Utils.isString(t))
                        return null;
                    var e = {}
                        , i = t.match(/([+-]?)(\d+)([mhd]?)/);
                    return i && (e.sign = i[1],
                        e.num = i[2],
                        e.unit = i[3]),
                        e
                },
                getEditableFormItems: function(t) {
                    var s = [];
                    return FX.Utils.forEach(t, function(t, e) {
                        var i, a, n = e.widget;
                        n && n.visible && e.widget.enable && ("subform" === (i = f.extend(!0, {}, e)).widget.type && (a = [],
                            FX.Utils.forEach(i.widget.items, function(t, e) {
                                e.widget.visible && e.widget.enable && a.push(e)
                            }),
                            i.widget.items = a),
                            s.push(i))
                    }),
                        s
                },
                removeBodyPopup: function() {
                    f("body").children(".x-msg-dot-guide,.x-window-mask").remove()
                },
                getDashSortFields: function(t) {
                    var i = []
                        , a = ["checkboxgroup", "combocheck"].concat(FX.LimitFields.dashSort);
                    return FX.Utils.forEach(t, function(t, e) {
                        -1 < a.indexOf(e.type) && i.push(e)
                    }),
                        i
                },
                getDashQuotaSortFields: function(t) {
                    var i = [];
                    return FX.Utils.forEach(t, function(t, e) {
                        FX.Utils.isEmpty(e.growth) && i.push(e)
                    }),
                        i
                },
                showNotification: function(e, i) {
                    var a;
                    "Notification"in window && (a = FX.Utils.getAssetUrl("/resources/images/logo.png"),
                        "granted" === Notification.permission ? new Notification(e,{
                            icon: a,
                            body: i
                        }) : "denied" !== Notification.permission && Notification.requestPermission(function(t) {
                            "granted" === t && new Notification(e,{
                                icon: a,
                                body: i
                            })
                        }))
                },
                isPageVisible: function() {
                    var t;
                    return void 0 !== document.hidden ? t = "hidden" : void 0 !== document.msHidden ? t = "msHidden" : void 0 !== document.webkitHidden && (t = "webkitHidden"),
                    !!FX.Utils.isNull(t) || !document[t]
                },
                parseMessage2Html: function(t) {
                    var s = "<p>";
                    return FX.Utils.forEach(t, function(t, e) {
                        switch (e.type) {
                            case "paragraph":
                                s += FX.Utils.parseMessage2Html(e.content);
                                break;
                            case "text":
                                s += FX.Utils.escapeHtmlSpecialChar(e.content);
                                break;
                            case "link":
                                var i = "https://link.jiandaoyun.com/f/5ced3beadd3d944a92578b21" === e.href
                                    , a = e.href + (i && FX.CorpUser.isUserExist() ? "?ext=" + FX.CorpUser.getUserId() : "");
                                s += '<a class="link-btn" target="_blank" href="' + a + '">' + e.content + "</a>";
                                break;
                            case "tag":
                                s += '<a class="x-c-key">' + e.content + "</a>";
                                break;
                            case "modal":
                                var n = FX.Utils.getApi(FX.API.entry.qr_link, e.appId, e.entryId, e.dataId);
                                s += '<a class="modal-btn ' + e.action + '" href="' + n + '" target="qr_link">' + e.content + "</a>";
                                break;
                            default:
                                s += FX.Utils.escapeHtmlSpecialChar(e.content)
                        }
                    }),
                        s += "</p>"
                },
                getDomOffset: function(t, e) {
                    if (t = f(t),
                        e = f(e),
                    !t.length || !e.length)
                        return null;
                    var i = t.offset()
                        , a = e.offset();
                    return {
                        top: i.top - a.top,
                        left: i.left - a.left
                    }
                },
                getIconByEntry: function(t) {
                    var e = t.type || "form"
                        , i = "";
                    return t.hasOwnProperty("icon") && 0 < t.icon ? i = "icon-form-" + t.icon : "form" === e ? i = !t.hasOwnProperty("hasCoop") || t.hasCoop ? "icon-form-1" : "icon-form-3" : "dash" === e && (i = "icon-form-4"),
                        "form" === e ? t.hasOwnProperty("hasCoop") ? t.hasCoop ? "icon-form " + i : "icon-form-flow " + i : i : "report" === e ? "icon-report" : "dash" === e ? "icon-dash " + i : i
                },
                doEntryView: function(t, e) {
                    var i;
                    new FX.Slider({
                        customCls: "fui_preview_custom_slider",
                        onHeaderCreate: function(t) {
                            f('<div class="switch-btn"><i class="icon-computer selected" role="pc"></i><i class="icon-widget-phone" role="mobile"></i></div>').on("click", function(t) {
                                var e = f(t.target).closest("i");
                                if (i && e && e.length && !e.hasClass("selected"))
                                    switch (e.addClass("selected").siblings().removeClass("selected"),
                                        i.empty(),
                                        e.attr("role")) {
                                        case "pc":
                                            a();
                                            break;
                                        case "mobile":
                                            n()
                                    }
                            }).appendTo(t)
                        },
                        onShow: function(t, e) {
                            i = e,
                                a()
                        }
                    }).show();
                    var a = function() {
                        t && t(i)
                    }
                        , n = function() {
                        f('<div class="mobile-preview"><div class="preview-main"><iframe frameborder="0" src="' + e + '"/></div></div>').appendTo(i)
                    }
                },
                getDashDefaultFilterMethod: function(t) {
                    var e = FX.CONST.FILTER_METHOD;
                    switch (t) {
                        case "text":
                        case "radiogroup":
                        case "combo":
                        case "sn":
                        case "user":
                        case "dept":
                            return e.IN;
                        case "textarea":
                        case "phone":
                            return e.LK;
                        case "checkboxgroup":
                        case "combocheck":
                        case "usergroup":
                        case "deptgroup":
                        case "address":
                        case "location":
                            return e.ALL;
                        case "datetime":
                        case "number":
                            return e.RG;
                        case "flowstate":
                            return e.EQ;
                        case "upload":
                        case "image":
                            return e.NEP
                    }
                },
                getDashFilterTypeByFieldType: function(t, e) {
                    switch (t) {
                        case "text_filter":
                            switch (e) {
                                case "text":
                                case "radiogroup":
                                case "combo":
                                case "sn":
                                    return "text_filter";
                                case "textarea":
                                    return "textarea_filter";
                                case "checkboxgroup":
                                case "combocheck":
                                    return "combocheck_filter";
                                case "user":
                                    return "user_filter";
                                case "usergroup":
                                    return "usergroup_filter";
                                default:
                                    return "text_filter"
                            }
                        case "dept_filter":
                            switch (e) {
                                case "dept":
                                    return "dept_filter";
                                case "deptgroup":
                                    return "deptgroup_filter";
                                default:
                                    return "dept_filter"
                            }
                        default:
                            return t
                    }
                },
                asyncAuto: function(n, s) {
                    var i = []
                        , r = []
                        , o = {}
                        , l = {}
                        , c = !1
                        , d = 0
                        , u = {}
                        , t = Object.keys(n)
                        , a = t.length;
                    function h(t, e) {
                        i.push(function() {
                            !function(a, t) {
                                if (c)
                                    return;
                                function e(t, e) {
                                    if (o[a] = e,
                                        t)
                                        return c = !0,
                                            s(t, o);
                                    var i = l[a];
                                    i && i.forEach(function(t) {
                                        t.apply(null, [])
                                    }),
                                        d++,
                                        p()
                                }
                                var i = t[t.length - 1];
                                1 < t.length ? i.apply(null, [o, e]) : i.apply(null, [e])
                            }(t, e)
                        })
                    }
                    function p() {
                        if (d === a)
                            return s(null, o);
                        for (; i.length; ) {
                            i.shift()()
                        }
                    }
                    t.forEach(function(e) {
                        var i = n[e];
                        if (!Array.isArray(i))
                            return h(e, [i]),
                                void r.push(e);
                        var t = i.slice(0, i.length - 1)
                            , a = t.length;
                        if (0 === a)
                            return h(e, i),
                                void r.push(e);
                        u[e] = a,
                            t.forEach(function(t) {
                                !function(t, e) {
                                    if (!n[t])
                                        throw new Error("non-existent dependency:" + t);
                                    var i = l[t];
                                    i = i || (l[t] = []);
                                    i.push(e)
                                }(t, function() {
                                    0 == --a && h(e, i)
                                })
                            })
                    }),
                        function() {
                            var t, e = 0;
                            for (; r.length; ) {
                                t = r.pop(),
                                    e++,
                                    function(i) {
                                        var a = [];
                                        return Object.keys(n).forEach(function(t) {
                                            var e = n[t];
                                            Array.isArray(e) && -1 < e.indexOf(i) && a.push(t)
                                        }),
                                            a
                                    }(t).forEach(function(t) {
                                        0 == --u[t] && r.push(t)
                                    })
                            }
                            if (e !== a)
                                throw new Error("auto cannot execute tasks due to a recursive dependency")
                        }(),
                        p()
                },
                getAssetUrl: function(t) {
                    return FX.Utils.startWith(t, FX.CONFIG.HOST.ASSETS_HOST) ? t : (FX.Utils.startWith(t, "/") || (t = "/" + t),
                    FX.CONFIG.HOST.ASSETS_HOST + t)
                },
                isBetaTestNew: function() {
                    var t = FX.CorpUser.getCurrentCorpId();
                    return !!t && parseInt(t.substr(-1), 16) % 2 == 0
                },
                isDingtalkPCAgent: function() {
                    return /nw/.test(window.navigator.userAgent) && /DingTalk/i.test(window.navigator.userAgent)
                },
                isWechatAgent: function() {
                    return /MicroMessenger/i.test(window.navigator.userAgent) && !FX.Utils.isWeworkAgent()
                },
                isWeworkAgent: function() {
                    return /wxwork/i.test(window.navigator.userAgent)
                },
                openLink: function(t, e, i, a) {
                    var n = FX.CONFIG.HOST.SITE_HOST + "/sso/jdy/redirect?token=" + e + "&redirect_uri=" + encodeURIComponent(t);
                    window.DingTalkPC ? window.DingTalkPC.biz.util.openLink({
                        url: n,
                        onSuccess: function() {
                            i && i()
                        },
                        onFail: function(t) {
                            a && a(t)
                        }
                    }) : window.wx && window.wx.invoke("openDefaultBrowser", {
                        url: n
                    }, function(t) {
                        "openDefaultBrowser:ok" != t.err_msg ? a && a() : i && i()
                    })
                },
                appendUserDeptLabel: function(t, e, i) {
                    var a = FX.Utils.isArray(i) ? i.splice(-3) : []
                        , n = FX.Utils.isObjectEmpty(a) ? "" : "" + a.join("/") + "";
                    t.append(f('<span class="item-label"/>').text(n).attr("title", n))
                },
                addLinkFormMask: function() {
                    if (FX.STATIC.LINK_FORM_INDEX || (FX.STATIC.LINK_FORM_INDEX = 0),
                        !(5 <= FX.STATIC.LINK_FORM_INDEX))
                        return FX.STATIC.LINK_FORM_INDEX++,
                            f('<div class="x-window-mask modal light scrollable fadeout"/>').css({
                                "z-index": FX.STATIC.zIndex++
                            }).addClass("offset-" + FX.STATIC.LINK_FORM_INDEX).appendTo("body");
                    FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("stack.overflow")
                    })
                },
                removeLinkFormMask: function(t) {
                    t.remove(),
                        FX.STATIC.LINK_FORM_INDEX--
                },
                excelExport: function(t, e, i) {
                    var a = FX.Utils.UUID();
                    f.extend(t.data, {
                        taskId: a
                    }),
                        FX.Utils.dataAjax(t, function(t) {
                            FX.Socket.setExcelExport(a),
                            e && e()
                        }, function(t) {
                            var e = t.responseJSON || {};
                            i && i(e),
                                4318 !== e.code ? FX.Msg.toast({
                                    type: "warning",
                                    msg: FX.Utils.getErrMsg(e) || i18next.t("export.failTip")
                                }) : FX.Msg.alert({
                                    title: i18next.t("export.excel.fileFail.title"),
                                    msg: FX.Utils.getErrMsg(e),
                                    tip: f('<a target="jdy_doc"/>').text(i18next.t("view.detail")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9084")
                                })
                        })
                },
                createETLStatusInfo: function(a, t, n, e, i) {
                    var s, r = FX.CONST.ETL_STATUS, o = "icon-info-o", l = i18next.t("etl.update.success"), c = !0, d = !1, u = "success";
                    if (FX.Utils.isObjectEmpty(a))
                        return null;
                    switch (a.last_status) {
                        case r.RUNNING:
                            u = "warn",
                                o = "icon-loader loader",
                                l = i18next.t("etl.update.running.tip");
                            break;
                        case r.SUCCESS:
                            a.has_delay_task && (u = "warn",
                                s = parseInt((new Date(a.delay_task_time) - new Date) / 1e3 / 60),
                                l = i18next.t("etl.update.nextRun.tip", {
                                    minutes: s
                                }),
                                d = FX.Utils.isEmpty(FX.STATIC.ATOKEN) && FX.Utils.isEmpty(FX.STATIC.DASH_TOKEN));
                            break;
                        case r.FAILURE:
                            u = "error",
                                l = i18next.t("etl.update.fail.tip");
                            break;
                        default:
                            c = !1
                    }
                    if (!c)
                        return null;
                    function h(t, e) {
                        return f("<div/>").append('<div class="line-text">' + i18next.t("etl.lastUpdate", {
                            time: FX.Utils.date2Str(new Date(a.last_run_time), "yyyy-MM-dd HH:mm")
                        }) + '</div><div class="line-text ' + t + '">' + e + "</div>")
                    }
                    var p = f('<div class="' + t + '"><i class="' + o + " " + u + '"/></div>');
                    return new FX.Tooltip({
                        renderEl: p,
                        hasIcon: !1,
                        position: "bottomLeft",
                        popCustomCls: "fui_dash_block_popover",
                        onPopContentCreate: function(t) {
                            var e, i = h(u, l).appendTo(t);
                            d && (e = f('<div class="line-btn"/>').appendTo(i),
                                new FX.Button({
                                    renderEl: e,
                                    text: i18next.t("update.now"),
                                    style: "green",
                                    width: 78,
                                    height: 24,
                                    onClick: function() {
                                        FX.Utils.applyFunc(this, n, [], !1),
                                        !1 !== a.supportUpdate && (t.empty().append(h(u, i18next.t("etl.update.running.tip"))),
                                            t.parent().css("left", t.parent().offset().left + 15))
                                    }
                                }))
                        },
                        onPopMouseenter: e,
                        onPopMouseleave: i,
                        anchor: p,
                        tipWidth: "auto"
                    }),
                        p
                },
                getDashWidgetMobileSize: function(t) {
                    if (!t)
                        return null;
                    if (!(FX.LimitFields.dashMobileLayout.indexOf(t.type) < 0)) {
                        var e = {
                            defaultSize: [6, 4],
                            minSize: [6, 4],
                            maxSize: [6, 10]
                        };
                        switch (t.type) {
                            case "metric_table":
                                t.xFields.length || 1 !== t.metrics.length || f.extend(e, {
                                    defaultSize: [6, 2],
                                    minSize: [2, 2],
                                    maxSize: [6, 4]
                                });
                                break;
                            case "description":
                                f.extend(e, {
                                    defaultSize: [6],
                                    minSize: [6],
                                    maxSize: [6, 4]
                                });
                                break;
                            case "data_table":
                            case "pivot_table":
                            case "calendar_manage":
                            case "data_manage":
                                f.extend(e, {
                                    defaultSize: [6, 6]
                                })
                        }
                        return e
                    }
                },
                dataURLtoBlob: function(t) {
                    for (var e = t.split(","), i = e[0].match(/:(.*?);/)[1], a = atob(e[1]), n = a.length, s = new Uint8Array(n); n--; )
                        s[n] = a.charCodeAt(n);
                    return new Blob([s],{
                        type: i
                    })
                },
                getPageSupportBtn: function(t) {
                    return f('<a class="x-page-support-btn" target="_blank"><i class="support-icon icon-sms"></i></a>').attr("href", t ? FX.CONST.BUSINESS_SUPPORT_LINK : FX.CONST.TECHNICAL_SUPPORT_LINK)
                },
                isEmbedMode: function() {
                    return "true" === FX.Utils.getUrlParameter("embed")
                },
                getSubmitFormDataKey: function(t, e) {
                    return FX.Store.getKey("submitFormData", {
                        appId: t,
                        entryId: e
                    })
                },
                getSaveContentCheckKey: function(t, e) {
                    return FX.Store.getKey("saveContentCheck", {
                        appId: t,
                        entryId: e
                    })
                },
                getCopyValue: function(t, e, i) {
                    var a, n = null, s = void 0 === FX.Store.get(i) || FX.Store.get(i);
                    return t && s && (FX.CorpUser.isUserExist() && FX.Store.forEach(function(t) {
                        /submitFormData[0-9a-f]{72}/.test(t) && !new RegExp(FX.CorpUser.getUserId()).test(t) && FX.Store.remove(t)
                    }),
                        a = FX.Store.get(e),
                        n = FX.Utils.isObjectEmpty(a) ? null : a.data),
                        n
                },
                dealSubmitFormData: function(t, e, i) {
                    t ? (FX.Store.set(e, {
                        data: i
                    }),
                        FX.Utils.dt(FX.CONST.TRACKER.FORM_SUBMIT_HAS_SAVE_CONTENT)) : FX.Store.remove(e)
                },
                find: function(t, i) {
                    var a = null;
                    return FX.Utils.isArray(t) && FX.Utils.isFunction(i) && FX.Utils.forEach(t, function(t, e) {
                        if (i(e))
                            return a = e,
                                !1
                    }),
                        a
                },
                getColorTagList: function(s) {
                    if (!s || !s.field || FX.Utils.isEmpty(s.values))
                        return "";
                    var r = s.field.items
                        , o = f("<div />");
                    return o.addClass(s.className || ""),
                        FX.Utils.forEach(s.values, function(t, e) {
                            if (!e)
                                return !0;
                            var i = FX.Utils.find(r, function(t) {
                                return t.text === e
                            })
                                , a = i ? i.color : ""
                                , n = new FX.TextTag({
                                text: e,
                                bgColor: a,
                                multiLine: s.multiLine
                            });
                            o.append(n.element.css(s.tagCss))
                        }),
                        o
                },
                getCouponTip: function(t) {
                    var i, e = [];
                    return t.discount < 1 && (i = [],
                        FX.Utils.forEach(t.levels, function(t, e) {
                            FX.CONST.VIP_ORDER.PACK[e] && i.push(FX.CONST.VIP_ORDER.PACK[e].name)
                        }),
                        e.push(i18next.t("order.coupon.limit", {
                            value: i.join(i18next.t("or"))
                        }))),
                        e.join("")
                }
            })
    }(jQuery),
    function() {
        var t = FX.Utils.getAssetUrl("/resources/images/theme/form/");
        FX.THEME = {
            DEFAULT_SYSTEM_THEME: "theme_0",
            DEFAULT_FORM_THEME: {
                title: {
                    "text-align": "left",
                    "font-size": 20,
                    "font-style": "normal",
                    "font-weight": "bold",
                    "text-decoration": []
                }
            },
            EXTERNAL_FORM_THEME: {
                theme_0: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "color",
                        color: "#0DB3A6"
                    },
                    title: {
                        color: "#1F2D3D"
                    },
                    submit_btn: {
                        "background-color": "#0DB3A6"
                    }
                },
                theme_1: {
                    background: {
                        mode: "color",
                        color: "#EBF8F7"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_1.jpg"
                    },
                    title: {
                        color: "#006F61"
                    },
                    submit_btn: {
                        "background-color": "#02AC96"
                    }
                },
                theme_2: {
                    background: {
                        mode: "color",
                        color: "#E4F5FA"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_2.jpg"
                    },
                    title: {
                        color: "#20CEE0"
                    },
                    submit_btn: {
                        "background-color": "#20CEE0"
                    }
                },
                theme_3: {
                    background: {
                        mode: "color",
                        color: "#FEF5E7"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_3.jpg"
                    },
                    title: {
                        color: "#F3B628"
                    },
                    submit_btn: {
                        "background-color": "#F3B628"
                    }
                },
                theme_4: {
                    background: {
                        mode: "image",
                        image: t + "bg_4.png"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_4.jpg"
                    },
                    title: {
                        color: "#2E428A"
                    },
                    submit_btn: {
                        "background-color": "#2E428A"
                    }
                },
                theme_5: {
                    background: {
                        mode: "color",
                        color: "#EDF6E7"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_5.jpg"
                    },
                    title: {
                        color: "#658F40"
                    },
                    submit_btn: {
                        "background-color": "#658F40"
                    }
                },
                theme_6: {
                    background: {
                        mode: "color",
                        color: "#EDF6E7"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_6.jpg"
                    },
                    title: {
                        color: "#408F45"
                    },
                    submit_btn: {
                        "background-color": "#408F45"
                    }
                },
                theme_7: {
                    background: {
                        mode: "color",
                        color: "#F7F4F4"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_7.jpg"
                    },
                    title: {
                        color: "#9455AC"
                    },
                    submit_btn: {
                        "background-color": "#9455AC"
                    }
                },
                theme_8: {
                    background: {
                        mode: "color",
                        color: "#EDF1F6"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_8.jpg"
                    },
                    title: {
                        color: "#1F74C7"
                    },
                    submit_btn: {
                        "background-color": "#1F74C7"
                    }
                },
                theme_9: {
                    background: {
                        mode: "color",
                        color: "#FEF1D2"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_9.jpg"
                    },
                    title: {
                        color: "#CA4021"
                    },
                    submit_btn: {
                        "background-color": "#CA4021"
                    }
                },
                theme_10: {
                    background: {
                        mode: "color",
                        color: "#FEF1D2"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_10.jpg"
                    },
                    title: {
                        color: "#A94F3A"
                    },
                    submit_btn: {
                        "background-color": "#CA4021"
                    }
                },
                theme_11: {
                    background: {
                        mode: "color",
                        color: "#FFFDFA"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_11.jpg"
                    },
                    title: {
                        color: "#BA821D"
                    },
                    submit_btn: {
                        "background-color": "#F6AD38"
                    }
                },
                theme_12: {
                    background: {
                        mode: "color",
                        color: "#FCFCFF"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_12.jpg"
                    },
                    title: {
                        color: "#2A62D0"
                    },
                    submit_btn: {
                        "background-color": "#3D79ED"
                    }
                },
                theme_13: {
                    background: {
                        mode: "color",
                        color: "#F7F4F4"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_13.jpg"
                    },
                    title: {
                        color: "#5B6B80"
                    },
                    submit_btn: {
                        "background-color": "#5B6B80"
                    }
                },
                theme_14: {
                    background: {
                        mode: "color",
                        color: "#FEE9BB"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_14.jpg"
                    },
                    title: {
                        color: "#DE773A"
                    },
                    submit_btn: {
                        "background-color": "#DE773A"
                    }
                },
                theme_15: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_15.jpg"
                    },
                    title: {
                        color: "#2D3B53"
                    },
                    submit_btn: {
                        "background-color": "#2D3B53"
                    }
                },
                theme_16: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_16.jpg"
                    },
                    title: {
                        color: "#2D3B53"
                    },
                    submit_btn: {
                        "background-color": "#2D3B53"
                    }
                },
                theme_17: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_17.jpg"
                    },
                    title: {
                        color: "#21BFE2"
                    },
                    submit_btn: {
                        "background-color": "#19C3E8"
                    }
                },
                theme_18: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_18.jpg"
                    },
                    title: {
                        color: "#313131"
                    },
                    submit_btn: {
                        "background-color": "#313131"
                    }
                },
                theme_19: {
                    background: {
                        mode: "color",
                        color: "#F4F9F9"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_19.jpg"
                    },
                    title: {
                        color: "#3F4057"
                    },
                    submit_btn: {
                        "background-color": "#3F4057"
                    }
                },
                theme_20: {
                    background: {
                        mode: "color",
                        color: "#F7F4F4"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_20.jpg"
                    },
                    title: {
                        color: "#FDABBC"
                    },
                    submit_btn: {
                        "background-color": "#FDABBC"
                    }
                },
                theme_21: {
                    background: {
                        mode: "color",
                        color: "#EDF6E7"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_21.jpg"
                    },
                    title: {
                        color: "#A19982"
                    },
                    submit_btn: {
                        "background-color": "#9B937C"
                    }
                },
                theme_22: {
                    background: {
                        mode: "color",
                        color: "#FFF6E4"
                    },
                    banner: {
                        mode: "image",
                        image: t + "bn_22.jpg"
                    },
                    title: {
                        color: "#E36A31"
                    },
                    submit_btn: {
                        "background-color": "#FF9E71"
                    }
                }
            }
        }
    }(),
    function(s) {
        FX.FormUtils = FX.FormUtils || {},
            s.extend(FX.FormUtils, {
                getWidgetDefaultConfig: function(t) {
                    var e = {
                        type: t,
                        enable: !0,
                        visible: !0,
                        allowBlank: !0
                    };
                    switch (t) {
                        case "datetime":
                            s.extend(e, {
                                format: "yyyy-MM-dd"
                            });
                            break;
                        case "checkboxgroup":
                        case "radiogroup":
                            s.extend(e, {
                                layout: "vertical",
                                colorEnable: !1,
                                items: [{
                                    value: i18next.t("field.options", {
                                        num: 1
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 1
                                    })
                                }, {
                                    value: i18next.t("field.options", {
                                        num: 2
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 2
                                    })
                                }, {
                                    value: i18next.t("field.options", {
                                        num: 3
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 3
                                    })
                                }]
                            });
                            break;
                        case "combo":
                        case "combocheck":
                            s.extend(e, {
                                colorEnable: !1,
                                items: [{
                                    value: i18next.t("field.options", {
                                        num: 1
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 1
                                    })
                                }, {
                                    value: i18next.t("field.options", {
                                        num: 2
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 2
                                    })
                                }, {
                                    value: i18next.t("field.options", {
                                        num: 3
                                    }),
                                    text: i18next.t("field.options", {
                                        num: 3
                                    })
                                }]
                            });
                            break;
                        case "address":
                            s.extend(e, {
                                needDetail: !0
                            });
                            break;
                        case "image":
                            s.extend(e, {
                                maxFileCount: FX.CONST.UPLOAD_FILE_COUNT.MULTI,
                                compressed: !1,
                                onlyCamera: !1,
                                watermark: !1
                            });
                            break;
                        case "upload":
                            s.extend(e, {
                                maxFileCount: FX.CONST.UPLOAD_FILE_COUNT.MULTI
                            });
                            break;
                        case "number":
                            s.extend(e, {
                                allowDecimals: !0,
                                maxNumber: null,
                                minNumber: null
                            });
                            break;
                        case "subform":
                            s.extend(e, {
                                subform_create: !0,
                                subform_edit: !0,
                                subform_sort: !1,
                                subform_delete: !0,
                                items: []
                            });
                            break;
                        case "dept":
                        case "deptgroup":
                            s.extend(e, {
                                valueOption: FX.WidgetValueOption.CUSTOM
                            });
                            break;
                        case "separator":
                            s.extend(e, {
                                lineStyle: "thin"
                            });
                            break;
                        case "sn":
                            s.extend(e, {
                                enable: !1,
                                rules: [{
                                    type: "incNumber",
                                    digitsNum: 5,
                                    resetDuration: "none",
                                    startValue: 1,
                                    fixedLength: !0
                                }]
                            });
                            break;
                        case "phone":
                            s.extend(e, {
                                hasSmsVerify: !1,
                                region: ["CN"]
                            })
                    }
                    return e
                },
                convertWidget2Front: function(t, e) {
                    var i, a, n = s.extend({}, t);
                    return -1 < ["combo", "combocheck"].indexOf(t.type) && n.async && s.extend(n.async, {
                        url: e.data.distinct,
                        data: FX.Utils.pick(n.async.data, ["field", "formId", "refAppId"])
                    }),
                    -1 < ["combo", "radiogroup"].indexOf(t.type) && n.items && (FX.Utils.forEach(t.items, function(t, e) {
                        if (e.selected)
                            return i = e.value,
                                !1
                    }),
                    i && s.extend(n, {
                        value: i
                    })),
                    -1 < ["combocheck", "checkboxgroup"].indexOf(t.type) && n.items && (a = [],
                        FX.Utils.forEach(t.items, function(t, e) {
                            e.selected && a.push(e.value)
                        }),
                    a.length && s.extend(n, {
                        value: a
                    })),
                        n
                },
                getNoEmptyTabs: function(t, e) {
                    var i = {};
                    FX.Utils.forEach(t, function(t, e) {
                        !e.tab || e.hidden || i[e.tab] || (i[e.tab] = !0)
                    });
                    var a = [];
                    return FX.Utils.forEach(e, function(t, e) {
                        i[e.name] && a.push(e)
                    }),
                        a
                },
                optionsWidgetConfig2ColorMap: function(t) {
                    if (!t)
                        return null;
                    var r = t.widgetName || t.name;
                    if (r) {
                        var e, o = {};
                        return "subform" === t.type ? FX.Utils.forEach(t.items, function(t, e) {
                            var i, a, n = e.widget || e, s = l(n);
                            s && (i = n.widgetName || n.name,
                                a = [r, i].join("."),
                                o[a] = s)
                        }) : (e = l(t)) && (o[r] = e),
                            FX.Utils.isObjectEmpty(o) ? null : o
                    }
                    function l(t) {
                        if (!t.colorEnable)
                            return null;
                        var i = {};
                        return FX.Utils.forEach(t.items, function(t, e) {
                            e.isOther || i[e.value] || (i[e.value] = e.color)
                        }),
                            i
                    }
                }
            })
    }(jQuery),
    $.extend(FX.Utils, {
        getFlowStateTag: function(t) {
            var e = FX.CONST.WORKFLOW.FLOWSTATE
                , i = {};
            switch (t) {
                case e.INPROCESS:
                case FX.Utils.getFlowStateText(e.INPROCESS):
                    i = FX.CONST.WORKFLOW.FLOWSTATEINFO.INPROCESS;
                    break;
                case e.COMPLETE:
                case FX.Utils.getFlowStateText(e.COMPLETE):
                    i = FX.CONST.WORKFLOW.FLOWSTATEINFO.COMPLETE;
                    break;
                case e.CLOSE:
                case FX.Utils.getFlowStateText(e.CLOSE):
                    i = FX.CONST.WORKFLOW.FLOWSTATEINFO.CLOSE
            }
            return i.text ? new FX.TextTag({
                bgColor: i.bgColor,
                fontColor: i.fontColor,
                borderColor: i.borderColor,
                text: i.text
            }).element : null
        },
        getFlowStateItems: function() {
            var t = FX.CONST.WORKFLOW.FLOWSTATEINFO.INPROCESS
                , e = FX.CONST.WORKFLOW.FLOWSTATEINFO.COMPLETE
                , i = FX.CONST.WORKFLOW.FLOWSTATEINFO.CLOSE;
            return [$.extend({}, t, {
                color: t.bgColor
            }), $.extend({}, e, {
                color: e.bgColor
            }), $.extend({}, i, {
                color: i.bgColor
            })]
        },
        getFlowStateText: function(t) {
            var i = {};
            i[FX.CONST.WORKFLOW.FLOWSTATE.INPROCESS] = i18next.t("flow.state.inProcess"),
                i[FX.CONST.WORKFLOW.FLOWSTATE.COMPLETE] = i18next.t("flow.state.complete"),
                i[FX.CONST.WORKFLOW.FLOWSTATE.CLOSE] = i18next.t("flow.state.closed");
            var a = [];
            return "object" == typeof t ? (FX.Utils.forEach(t, function(t, e) {
                i[e] && a.push(i[e])
            }),
                a.join("")) : i[t] || ""
        },
        getFlowActionText: function(t, e) {
            e = e || {};
            var i = ""
                , a = FX.CONST.FLOW_ACTION_NAME[t];
            switch (t) {
                case "forward":
                    i = e.submit_text || a;
                    break;
                case "save":
                    i = e.save_text || a;
                    break;
                case "print":
                    i = e.print_text || a;
                    break;
                case "back":
                    i = e.back_text || a;
                    break;
                case "transfer":
                    i = e.transfer_text || a;
                    break;
                case "close":
                    i = e.close_text || a;
                    break;
                default:
                    i = a
            }
            return i
        },
        getFlowOption: function(t, e) {
            var i = {
                btn: {}
            }
                , a = i.btn;
            switch (t.hasPrint && (a.print = {
                text: i18next.t("print")
            }),
                e) {
                case "stash":
                case "todo":
                    t.isEditable && t.currentFlowId !== FX.CONST.WORKFLOW.END_FLOW_ID && (a.forward = {
                        text: FX.Utils.getFlowActionText("forward", t)
                    },
                    t.allowSave && (a.save = {
                        text: FX.Utils.getFlowActionText("save", t)
                    }),
                    t.allowBack && (a.back = {
                        text: FX.Utils.getFlowActionText("back", t)
                    }),
                    t.allowClose && (a.close = {
                        text: FX.Utils.getFlowActionText("close", t)
                    }),
                    t.hasPrint && (a.print = {
                        text: FX.Utils.getFlowActionText("print", t)
                    }),
                    t.allowTransfer && (a.transfer = {
                        text: FX.Utils.getFlowActionText("transfer", t)
                    }),
                        i.comment = t.comment,
                        i.signature = t.signature,
                        i.isEditable = !0);
                    break;
                case "create":
                    t.allowRevoke && (a.revoke = {
                        text: FX.Utils.getFlowActionText("revoke")
                    })
            }
            i.flowState = t.data.flowState,
                i.version = t.data.flowVer,
                i.hasLogView = t.hasLogView,
                i.chargers = t.data.chargers,
                i.dataId = t.data._id;
            var n = [];
            return FX.Utils.isArray(t.flowNodes) && 0 < t.flowNodes.length && (n = t.flowNodes.filter(function(t) {
                return "todo" === e ? "charger" === t.type : "part" === e ? "transactor" === t.type : void 0
            })),
                i.flowId = t.currentFlowId,
                i.printId = t.printId,
                i.flowNodes = n,
                i.backNodes = t.backNodes,
                i
        },
        getFlowScheduleTimeText: function(t, e) {
            var i = FX.Utils.parseTimeOffset(t);
            if (!i || !e)
                return "";
            var a = "";
            "m" === i.unit ? a = i18next.t("date.minutes") : "h" === i.unit ? a = i18next.t("date.hours") : "d" === i.unit && (a = i18next.t("date.days"));
            var n = "";
            "+" === i.sign ? n += i18next.t("after") + i.num + a : "-" === i.sign ? n += i18next.t("before") + i.num + a : n = i18next.t("data.notify.currentTime");
            var s = ""
                , r = FX.CONST.FlOW_SCHEDULE.ACTION_OP;
            return e === r.NOTIFY ? s = i18next.t("flow.schedule.notify") : e === r.BACK ? s = i18next.t("flow.schedule.back") : e === r.FORWARD && (s = i18next.t("flow.schedule.forward")),
                i18next.t("flow.schedule.timeLimit", {
                    time: n,
                    op: s
                })
        },
        getFlowScheduleBackRuleText: function(t) {
            return t === FX.CONST.WORKFLOW.BACKRULE.PARENT_NODE ? i18next.t("flow.back.parent") : t === FX.CONST.WORKFLOW.BACKRULE.RANGE_NODE ? i18next.t("flow.node.start") : ""
        },
        isFlowScheduleEnable: function(t) {
            return !FX.Utils.isObjectEmpty(t) && !FX.Utils.isObjectEmpty(t.actions) && t.enable
        }
    }),
    jQuery.extend(FX.Utils, {
        needUserGuide: function(t) {
            return !!FX.CorpUser.getUserGuide()[t]
        },
        completeGuide: function(t, e) {
            var i = {};
            i[t] = !0,
                FX.Utils.ajax({
                    url: FX.Utils.getApi(FX.API.profile.guide_complete),
                    data: i
                }, function(t) {
                    FX.CorpUser.updateConfig({
                        guide: t
                    }),
                    e && e()
                })
        },
        getTimeById: function(t) {
            var e = t.toString().substr(0, 8);
            return new Date(1e3 * parseInt(e, 16))
        },
        handleInviteGuide: function(e, i) {
            var a = FX.CorpUser.getUserId() + FX.CONST.COOKIE.INVITE_MEMBER.SUFFIX_KEY
                , n = FX.Cookie.get(a);
            FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.corp.department_list_member),
                data: {
                    corpId: FX.CorpUser.getCurrentCorpId(),
                    limit: 1
                }
            }, function(t) {
                1 < t.count ? (n || FX.Cookie.set(a, FX.CONST.COOKIE.INVITE_MEMBER.VALUE, {
                    expires: FX.CONST.COOKIE.INVITE_MEMBER.EXPIRES,
                    path: "/"
                }),
                e && e()) : (n && FX.Cookie.remove(a, {
                    path: "/"
                }),
                    "internal" === FX.CorpUser.getUserCorpType() && FX.CorpUser.isCorpOwner() ? i && i() : e && e())
            })
        },
        needInviteGuide: function() {
            return "internal" === FX.CorpUser.getUserCorpType() && FX.CorpUser.isCorpOwner() && !FX.Cookie.get(FX.CorpUser.getUserId() + FX.CONST.COOKIE.INVITE_MEMBER.SUFFIX_KEY)
        },
        renderFlowDesignGuide: function() {
            new FX.GuideDialog({
                title: i18next.t("flow.guide.title"),
                text4Ok: i18next.t("flow.guide.done"),
                sectionLists: [{
                    info: i18next.t("flow.guide.step1"),
                    videoSrc: "guide_design_base.mp4"
                }, {
                    info: i18next.t("flow.guide.step2"),
                    videoSrc: "guide_set_flow_auth.mp4"
                }, {
                    info: i18next.t("flow.guide.step3"),
                    videoSrc: "guide_save_enable_flow.mp4"
                }, {
                    info: i18next.t("flow.guide.step4"),
                    videoSrc: "guide_add_flow_version.mp4"
                }, {
                    info: i18next.t("flow.guide.step5"),
                    videoSrc: "guide_flow_help.mp4"
                }],
                total: 5,
                onOk: function() {
                    this.close()
                }
            }).show(),
                FX.Utils.completeGuide(FX.CONST.GUIDE.FLOW_ENABLE)
        }
    }),
    function(n) {
        n.extend(FX.Utils, {
            getLinkFilter: function(t, e) {
                var i = {
                    type: t.type
                };
                switch (n.extend(i, FX.Utils.dealFilterFieldName(t)),
                    t.type) {
                    case "datetime":
                        i.method = FX.CONST.FILTER_METHOD.RG,
                            i.value = e;
                        break;
                    case "address":
                    case "location":
                        i.type = "address",
                            i.method = FX.CONST.FILTER_METHOD.ALL,
                            i.value = e;
                        break;
                    case "user":
                    case "id":
                        i.type = "user",
                            i.method = FX.CONST.FILTER_METHOD.IN,
                            i.value = n.makeArray(e);
                        break;
                    case "dept":
                    case "did":
                        i.type = "dept",
                            i.method = FX.CONST.FILTER_METHOD.IN,
                            i.value = n.makeArray(e);
                        break;
                    case "number":
                        i.method = FX.CONST.FILTER_METHOD.EQ,
                            i.value = n.makeArray(e);
                        break;
                    case "linkdata":
                        "number" === t.linkType ? (i.keyType = "number",
                            i.method = FX.CONST.FILTER_METHOD.EQ) : (i.keyType = "text",
                            i.method = FX.CONST.FILTER_METHOD.IN),
                            i.value = n.makeArray(e);
                        break;
                    case "flowState":
                        i.type = "flowstate",
                            i.method = FX.CONST.FILTER_METHOD.IN,
                            i.value = n.makeArray(e);
                        break;
                    default:
                        "creator" === t.name ? i.type = "user" : i.type = "text",
                            i.method = FX.CONST.FILTER_METHOD.IN,
                            i.value = n.makeArray(e)
                }
                return i
            },
            dealFilterFieldName: function(t) {
                var e, i = {};
                return /\./.test(t.name) ? (e = t.name.split("."),
                    i.subform = e[0],
                    i.subField = e[1]) : i.field = t.name,
                    i
            },
            dealFilterInfoByField: function(t) {
                var e = FX.Utils.getFieldInfoById(t.id)
                    , i = FX.Utils.dealFilterFieldName(t);
                return n.extend({}, e, i)
            },
            dealFormFilterCond: function(t) {
                var i;
                return t && t.cond && (i = [],
                    FX.Utils.forEach(t.cond, function(t, e) {
                        e.entryId = void 0,
                            i.push(e)
                    }),
                    t.cond = i),
                    t
            },
            pretreatFormFilterCond: function(t) {
                var e = [];
                return t && (FX.Utils.forEach(t, function(t, e) {
                    e.entryId = void 0
                }),
                    e = t),
                    e
            },
            getDateRange: function(t) {
                var e, i, a, n = "yyyy-MM-dd", s = new Date, r = [];
                return FX.Utils.isNull(t.day) ? (FX.Utils.isNull(t.week) ? FX.Utils.isNull(t.month) ? FX.Utils.isNull(t.quarter) ? (s.setFullYear(t.year, 0, 1),
                    r.push(FX.Utils.date2Str(s, n)),
                    s.setFullYear(t.year + 1, 0, 1)) : (s.setFullYear(t.year, 3 * (t.quarter - 1), 1),
                    r.push(FX.Utils.date2Str(s, n)),
                    s.setFullYear(t.year, 3 * t.quarter, 1)) : (s.setFullYear(t.year, t.month - 1, 1),
                    r.push(FX.Utils.date2Str(s, n)),
                    s.setFullYear(t.year, t.month, 1)) : (s.setFullYear(t.year, 0, 1),
                    i = (e = s.getDay() || 7) <= 4 ? 1 - e : 7 - e + 1,
                    s.setTime(s.getTime() + 864e5 * (i + 7 * (t.week - 1))),
                    r.push(FX.Utils.date2Str(s, n)),
                    s.setTime(s.getTime() + 6048e5)),
                    s.setHours(0, 0, 0, 0),
                    r.push(FX.Utils.date2Str(new Date(s.getTime() - 1), n))) : (s.setFullYear(t.year, t.month - 1, t.day),
                    r = [a = FX.Utils.date2Str(s, n), a]),
                    r
            },
            formatDataFilter: function(e, a, n) {
                var s = ""
                    , n = n || "text"
                    , r = e.type;
                switch ("linkdata" === r && (r = e.linkType),
                    r) {
                    case "textarea":
                    case "text":
                    case "phone":
                    case "linkdata":
                        s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, e.type) + " " + FX.Utils.formatFilterWidgetText(e);
                        break;
                    case "address":
                        s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, e.type) + " " + FX.Utils.formatFilterWidgetText(e, !1);
                        break;
                    case "combocheck":
                        s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, e.type, !0) + " " + FX.Utils.formatFilterWidgetText(e);
                        break;
                    case "formula":
                    case "number":
                        s = e[n] + " ";
                        var t = ""
                            , i = "";
                        e.value && e.value.length && (t = FX.Utils.isNull(e.value[0]) ? "" : e.value[0],
                            i = FX.Utils.isNull(e.value[1]) ? "" : e.value[1]),
                            e.method === FX.CONST.FILTER_METHOD.RG ? s += i18next.t("between", {
                                begin: t,
                                end: i
                            }) : s += FX.Utils.getFilterMethodInfo(e.method) + " " + t;
                        break;
                    case "datetime":
                        var o, l, c, d, s = e[n] + " ";
                        e.method === FX.CONST.FILTER_METHOD.RG ? e.value && e.value.length && (s += i18next.t("between", {
                            begin: e.value[0] || "",
                            end: e.value[1] || ""
                        })) : e.method === FX.CONST.FILTER_METHOD.EQ ? (s += i18next.t("equal") + " ",
                        e.value && e.value.length && (s += e.value[0])) : e.method === FX.CONST.FILTER_METHOD.FM ? e.value && e.value.length && (o = {
                            today: i18next.t("today"),
                            yesterday: i18next.t("date.yesterday"),
                            tomorrow: i18next.t("date.tomorrow"),
                            thisWeek: i18next.t("date.thisWeek"),
                            lastWeek: i18next.t("date.lastWeek"),
                            nextWeek: i18next.t("date.nextWeek"),
                            thisMonth: i18next.t("date.thisMonth"),
                            lastMonth: i18next.t("date.lastMonth"),
                            nextMonth: i18next.t("date.nextMonth")
                        },
                            "custom" === (l = e.value[0]).mode ? (c = l.formula[0] && FX.Utils.getDataFilterText(FX.Utils.setDataFormatValue(l.formula[0])),
                                d = l.formula[1] && FX.Utils.getDataFilterText(FX.Utils.setDataFormatValue(l.formula[1])),
                                c && d ? s += i18next.t("between", {
                                    begin: " " + c + " ",
                                    end: " " + d + " "
                                }) : c && !d ? s += i18next.t("filter.method.gte") + " " + c : !c && d && (s += i18next.t("filter.method.lte") + " " + d)) : s += i18next.t("equal") + " " + o[l.formula]) : (s += FX.Utils.getFilterMethodInfo(e.method),
                        e.value && e.value.length && (s += " " + e.value[0]));
                        break;
                    case "usergroup":
                    case "user":
                        FX.Utils.getUserOrDeptName("user", e.value, function(t) {
                            var i = [];
                            e.hasEmpty && i.push(i18next.t("unfilled")),
                            e.hasCurrentUser && i.push(i18next.t("widget.user.current")),
                                FX.Utils.forEach(t.users, function(t, e) {
                                    i.push(e.nickname)
                                }),
                                s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, r, "usergroup" === r) + " " + i.join(""),
                            a && a(s)
                        });
                        break;
                    case "deptgroup":
                    case "dept":
                        FX.Utils.getUserOrDeptName("dept", e.value, function(t) {
                            var i = [];
                            e.hasEmpty && i.push(i18next.t("unfilled")),
                            e.hasCurrentDept && i.push(i18next.t("dept.current")),
                                FX.Utils.forEach(t.departments, function(t, e) {
                                    i.push(e.name)
                                }),
                                s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, r, "deptgroup" === r) + " " + i.join(""),
                            a && a(s)
                        });
                        break;
                    case "file_list":
                    case "signature":
                        s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method);
                        break;
                    case "flowstate":
                        s = e[n] + " " + FX.Utils.getFilterMethodInfo(e.method, e.type) + " " + FX.Utils.getFlowStateText(e.value)
                }
                return s.trim()
            },
            getFilterType: function(t) {
                var e;
                switch (t) {
                    case "text":
                    case "radiogroup":
                    case "combo":
                    case "sn":
                        e = "text";
                        break;
                    case "combocheck":
                    case "checkboxgroup":
                        e = "combocheck";
                        break;
                    case "address":
                    case "location":
                        e = "address";
                        break;
                    case "upload":
                    case "image":
                        e = "file_list";
                        break;
                    default:
                        e = t
                }
                return e
            },
            getFilterMethodInfo: function(t, e, i) {
                var a = {};
                return a[FX.CONST.FILTER_METHOD.EQ] = {
                    name: i18next.t("filter.method.eq")
                },
                    a[FX.CONST.FILTER_METHOD.NE] = {
                        name: i18next.t("filter.method.ne")
                    },
                    a[FX.CONST.FILTER_METHOD.ALL] = {
                        name: "address" !== e ? i18next.t("filter.method.all") : i18next.t("filter.method.all.address")
                    },
                    a[FX.CONST.FILTER_METHOD.IN] = {
                        name: i ? i18next.t("filter.method.in.many") : i18next.t("filter.method.in.one")
                    },
                    a[FX.CONST.FILTER_METHOD.NIN] = {
                        name: "address" !== e ? i18next.t("filter.method.nin") : i18next.t("filter.method.nin.address")
                    },
                    a[FX.CONST.FILTER_METHOD.LK] = {
                        name: i18next.t("filter.method.lk")
                    },
                    a[FX.CONST.FILTER_METHOD.ULK] = {
                        name: i18next.t("filter.method.ulk")
                    },
                    a[FX.CONST.FILTER_METHOD.EP] = {
                        name: i18next.t("filter.method.ep")
                    },
                    a[FX.CONST.FILTER_METHOD.NEP] = {
                        name: i18next.t("filter.method.nep")
                    },
                    a[FX.CONST.FILTER_METHOD.GT] = {
                        name: i18next.t("filter.method.gt")
                    },
                    a[FX.CONST.FILTER_METHOD.GTE] = {
                        name: i18next.t("filter.method.gte")
                    },
                    a[FX.CONST.FILTER_METHOD.LT] = {
                        name: i18next.t("filter.method.lt")
                    },
                    a[FX.CONST.FILTER_METHOD.LTE] = {
                        name: i18next.t("filter.method.lte")
                    },
                    a[FX.CONST.FILTER_METHOD.RG] = {
                        name: i18next.t("filter.method.rg")
                    },
                    a[FX.CONST.FILTER_METHOD.VF] = {
                        name: i18next.t("filter.method.vf")
                    },
                    a[FX.CONST.FILTER_METHOD.NVF] = {
                        name: i18next.t("filter.method.nvf")
                    },
                a[t] && a[t].name || ""
            },
            formatFilterWidgetText: function(t, e) {
                if (e = !1 !== e,
                t && t.value) {
                    var i = [];
                    return t.hasEmpty && i.push(i18next.t("unfilled")),
                        FX.Utils.forEach(t.value, function(t, e) {
                            FX.Utils.isString(e) && i.push(e)
                        }),
                        i.join(e ? "" : "")
                }
                return ""
            },
            getUserOrDeptName: function(t, e, i) {
                var a = {
                    members: e
                };
                "user" === t ? n.extend(a, {
                    isUserOnly: !0
                }) : n.extend(a, {
                    isDepartmentOnly: !0
                }),
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.corp.list_member_name),
                        data: a
                    }, function(t) {
                        FX.Utils.applyFunc(this, i, [t], !1)
                    })
            },
            getValidFilters: function(t) {
                var i = [];
                return FX.Utils.forEach(t.cond, function(t, e) {
                    FX.Utils.checkFilterValid(e) && i.push(e)
                }),
                    {
                        cond: i,
                        rel: t.rel
                    }
            },
            checkFilterValid: function(t) {
                var e = FX.CONST.FILTER_METHOD;
                switch (t.type) {
                    case "address":
                        switch (t.method) {
                            case e.ALL:
                            case e.NIN:
                                return !FX.Utils.isObjectEmpty(t.value);
                            default:
                                return !0
                        }
                    case "dept":
                    case "user":
                        switch (t.method) {
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value) || t.hasEmpty || t.hasCurrentUser || t.hasCurrentDept
                        }
                    case "deptgroup":
                    case "usergroup":
                        switch (t.method) {
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value) || t.hasCurrentDept || t.hasCurrentUser
                        }
                    case "combocheck":
                        switch (t.method) {
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value)
                        }
                    case "date":
                    case "number":
                        switch (t.method) {
                            case e.RG:
                                return !FX.Utils.isObjectEmpty(t.value);
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value)
                        }
                    case "textarea":
                        switch (t.method) {
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value)
                        }
                    case "phone":
                        switch (t.method) {
                            case e.EP:
                            case e.NEP:
                            case e.VF:
                            case e.NVF:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value)
                        }
                    default:
                        switch (t.method) {
                            case e.IN:
                            case e.NIN:
                                return !FX.Utils.isObjectEmpty(t.value) || t.hasEmpty;
                            case e.EP:
                            case e.NEP:
                                return !0;
                            default:
                                return !FX.Utils.isObjectEmpty(t.value)
                        }
                }
            },
            getFilterKey: function(t) {
                return t.subField ? [t.subform, t.subField].join(".") : t.field
            },
            getSelectFilterConfig: function(t) {
                var i = {}
                    , e = FX.Utils.getFieldInfoById(t.id);
                return "ext" === t.name ? (i.items = [],
                    FX.Utils.forEach(t.items, function(t, e) {
                        i.items.push({
                            text: e,
                            value: e
                        })
                    })) : t.async ? (i.async = {
                    url: FX.Utils.getApi(FX._API.data.distinct),
                    data: n.extend({
                        refAppId: e.appId
                    }, t.async.data, {
                        appId: FX.STATIC.APPID,
                        entryId: FX.STATIC.ENTRYID
                    })
                },
                    i.hasLimit = !0) : FX.Utils.isObjectEmpty(t.items) ? (i.async = {
                    url: FX.Utils.getApi(FX._API.data.distinct),
                    data: {
                        refAppId: e.appId,
                        formId: e.entryId,
                        field: t.name,
                        type: t.type
                    }
                },
                    i.hasLimit = !0) : (i.items = [],
                    FX.Utils.forEach(t.items, function(t, e) {
                        e.isOther || i.items.push(e)
                    })),
                    i
            },
            setDataFormatValue: function(t) {
                if (FX.Utils.isEmpty(t))
                    return {
                        time: null,
                        num: null,
                        unit: null
                    };
                var e = {
                    "+": "future",
                    "-": "past",
                    w: "week",
                    d: "day",
                    M: "month"
                }
                    , i = (t = t.split("")).shift()
                    , a = t.pop();
                return e[i] ? {
                    time: e[i],
                    num: t.join(""),
                    unit: e[a]
                } : (t.unshift(i),
                    {
                        time: "present",
                        num: t.join(""),
                        unit: e[a]
                    })
            },
            getDataFilterText: function(t) {
                var e = {
                    present: i18next.t("current"),
                    past: i18next.t("past"),
                    future: i18next.t("future")
                }
                    , i = {
                    day: i18next.t("days"),
                    week: i18next.t("week"),
                    month: i18next.t("month")
                };
                return t.time && t.num && t.unit ? e[t.time] + t.num + i[t.unit] : ""
            },
            getColorMapByItem: function(t) {
                if (t && t.colorEnable && !(["radiogroup", "checkboxgroup", "combo", "combocheck"].indexOf(t.type) < 0)) {
                    var i = {};
                    return FX.Utils.forEach(t.items, function(t, e) {
                        e.isOther || i[e.text] || (i[e.text] = e.color)
                    }),
                        i
                }
            }
        })
    }(jQuery),
    jQuery.extend(FX.Utils, {
        isMultipleField: function(t) {
            return -1 < FX.LimitFields.multipleField.indexOf(t)
        }
    }),
    $.extend(FX.Utils, {
        getPeriodWithLimit: function(t, e, i) {
            if (t = Math.round(t),
                !i)
                return t;
            var a = 1;
            switch (e) {
                case "d":
                    a = 86400;
                    break;
                case "h":
                    a = 3600;
                    break;
                case "m":
                    a = 60
            }
            var n = Math.round(Math.max(i[0] / a, 1))
                , s = Math.round(Math.max(i[1] / a, 1));
            return t < n && (t = n),
            s < t && (t = s),
                t
        },
        date2GroupStr: function(a, t) {
            var e = ""
                , i = t.split("_")
                , n = {};
            switch (FX.Utils.forEach(i, function(t, e) {
                var i = 0 !== t;
                n[e] = FX.Utils._compileDateGroupRule(a[e], e, i)
            }),
                t) {
                case "year":
                    e = i18next.t("date.year", {
                        year: n.year
                    });
                    break;
                case "year_quarter":
                    e = i18next.t("date.year_quarter", {
                        year: n.year,
                        quarter: n.quarter
                    });
                    break;
                case "year_month":
                    e = i18next.t("date.year_month", {
                        year: n.year,
                        month: n.month
                    });
                    break;
                case "year_week":
                    e = i18next.t("date.year_week", {
                        year: n.year,
                        week: n.week
                    });
                    break;
                case "year_month_day":
                    e = i18next.t("date.year_month_day", {
                        year: n.year,
                        month: n.month,
                        day: n.day
                    })
            }
            return e
        },
        _compileDateGroupRule: function(t, e, i) {
            var a;
            switch (e) {
                case "year":
                case "quarter":
                    a = t;
                    break;
                case "month":
                case "week":
                case "day":
                    a = i ? FX.Utils.leftPad(t, 2, "0") : t;
                    break;
                default:
                    a = ""
            }
            return a
        },
        parseDate: function(t) {
            if (FX.Utils.isNull(t))
                return null;
            if (FX.Utils.isNumber(t))
                return new Date(t);
            if (FX.Utils.isString(t)) {
                if (t.match(/^[\d-]+T[\d:.]+Z$/))
                    return new Date(t);
                var e = t.trim().split(" ");
                if (e) {
                    var i = e[0] && e[0].split("-")
                        , a = i[0];
                    if (!FX.Utils.isNumber(a))
                        return null;
                    var n = FX.Utils.isNumber(i[1]) ? i[1] - 1 : 0
                        , s = FX.Utils.isNumber(i[2]) ? i[2] : 1;
                    if (e[1]) {
                        var r = e[1].split(":")
                            , o = FX.Utils.isNumber(r[0]) ? r[0] : 0
                            , l = FX.Utils.isNumber(r[1]) ? r[1] : 0
                            , c = FX.Utils.isNumber(r[2]) ? r[2] : 0;
                        return new Date(a,n,s,o,l,c)
                    }
                    return new Date(a,n,s)
                }
                return null
            }
            return new Date(t)
        },
        getWeekOfDate: function(t) {
            var e = new Date(t.getFullYear(),t.getMonth(),t.getDate());
            e.setDate(e.getDate() + 4 - (e.getDay() || 7));
            var i = new Date(e.getFullYear(),0,1)
                , a = Math.ceil(((e - i) / 864e5 + 1) / 7);
            return e.getFullYear() < t.getFullYear() && (a *= -1),
                a
        },
        getMonthDays: function(t, e) {
            FX.Utils.isNull(t) && (t = (new Date).getFullYear()),
            FX.Utils.isNull(e) && (e = (new Date).getMonth());
            return (0 == t % 4 && 0 != t % 100 || 0 == t % 400) && 1 === e ? 29 : [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][e]
        },
        getDateDN: function() {
            return [i18next.t("date.sunday"), i18next.t("date.monday"), i18next.t("date.tuesday"), i18next.t("date.wednesday"), i18next.t("date.thursday"), i18next.t("date.friday"), i18next.t("date.saturday")]
        },
        getDateSDN: function() {
            return [i18next.t("date.sunday.short"), i18next.t("date.monday.short"), i18next.t("date.tuesday.short"), i18next.t("date.wednesday.short"), i18next.t("date.thursday.short"), i18next.t("date.friday.short"), i18next.t("date.saturday.short")]
        },
        getCustomDateSDN: function() {
            return [i18next.t("date.monday.custom"), i18next.t("date.tuesday.custom"), i18next.t("date.wednesday.custom"), i18next.t("date.thursday.custom"), i18next.t("date.friday.custom"), i18next.t("date.saturday.custom"), i18next.t("date.sunday.custom")]
        },
        getDateMN: function() {
            return [i18next.t("date.january"), i18next.t("date.february"), i18next.t("date.march"), i18next.t("date.april"), i18next.t("date.may"), i18next.t("date.june"), i18next.t("date.july"), i18next.t("date.august"), i18next.t("date.september"), i18next.t("date.october"), i18next.t("date.november"), i18next.t("date.december")]
        },
        getDateMNShort: function() {
            return [i18next.t("date.january.short"), i18next.t("date.february.short"), i18next.t("date.march.short"), i18next.t("date.april.short"), i18next.t("date.may.short"), i18next.t("date.june.short"), i18next.t("date.july.short"), i18next.t("date.august.short"), i18next.t("date.september.short"), i18next.t("date.october.short"), i18next.t("date.november.short"), i18next.t("date.december.short")]
        },
        isWeekEnd: function(t) {
            if (!FX.Utils.isDate(t))
                return !1;
            var e = t.getDay();
            return 0 === e || 6 === e
        },
        isWorkDay: function(i, t) {
            if (i = FX.Utils.parseDate(i),
                FX.Utils.isNull(i))
                return !1;
            var a = !0;
            return FX.Utils.isWeekEnd(i) && (a = !1),
            a && FX.Utils.forEach(t, function(t, e) {
                if (FX.Utils.isSameDate(i, e))
                    return a = !1
            }),
                a
        },
        isSameDate: function(t, e) {
            return !(!FX.Utils.isDate(t) || !FX.Utils.isDate(e)) && (t.getFullYear() === e.getFullYear() && t.getMonth() === e.getMonth() && t.getDate() === e.getDate())
        },
        isBeforeDate: function(t, e) {
            return !(!FX.Utils.isDate(t) || !FX.Utils.isDate(e) || FX.Utils.isSameDate(t, e)) && t.getTime() < e.getTime()
        },
        isDuringDate: function(t, e) {
            var i = new Date
                , a = new Date(t)
                , n = new Date(e);
            return a <= i && i <= n
        },
        getDateInfo: function(t) {
            var e = FX.Utils.parseDate(t) || new Date;
            return {
                year: e.getFullYear(),
                month: e.getMonth(),
                day: e.getDate(),
                hour: e.getHours(),
                minute: e.getMinutes(),
                second: e.getSeconds()
            }
        },
        getDateByMonthOffset: function(t, e) {
            var i = FX.Utils.getDateInfo(t)
                , a = i.year
                , n = i.month;
            a += parseInt(e / 12 + "", 10),
                (n += e % 12) < 0 ? (--a,
                    n += 12) : 11 < n && (a += 1,
                    n -= 12);
            var s = FX.Utils.getMonthDays(a, n)
                , r = Math.min(s, i.day);
            return new Date(a,n,r,i.hour,i.minute,i.second)
        },
        getDateByYearOffset: function(t, e) {
            var i = FX.Utils.getDateInfo(t)
                , a = i.year + e
                , n = FX.Utils.getMonthDays(a, i.month)
                , s = Math.min(n, i.day);
            return new Date(a,i.month,s,i.hour,i.minute,i.second)
        },
        getDateDecadeRange: function(t) {
            var e = FX.Utils.getDateInfo(t)
                , i = e.year - e.year % 10;
            return [i, 9 + i]
        },
        getDateTimeViewMode: function(t) {
            var e = FX.CONST.DATE_VIEW_MODE
                , i = e.YMD;
            return (t = t || "yyyy-MM-dd").match(/[YyMDd]/) ? t.match(/[Dd]/) ? t.match(/[Hhm]/) && (i = t.match(/[s]/) ? e.YMD_HMS : e.YMD_HM) : i = e.YM : i = t.match(/s/) ? e.HMS : e.HM,
                i
        }
    }),
    function(o) {
        FX.DashUtils = FX.DashUtils || {},
            o.extend(FX.DashUtils, {
                CONST: {
                    METRIC_COMPARE: {
                        year: [{
                            value: "YoYv",
                            text: i18next.t("dash.field.growthValue.yoy")
                        }, {
                            value: "YoYr",
                            text: i18next.t("dash.field.growthRate.yoy")
                        }],
                        year_quarter: [{
                            value: "QoQv",
                            text: i18next.t("dash.field.growthValue.qoq")
                        }, {
                            value: "QoQr",
                            text: i18next.t("dash.field.growthRate.qoq")
                        }, {
                            value: "YoYv",
                            text: i18next.t("dash.field.growthValue.yoy2")
                        }, {
                            value: "YoYr",
                            text: i18next.t("dash.field.growthRate.yoy2")
                        }],
                        year_month: [{
                            value: "MoMv",
                            text: i18next.t("dash.field.growthValue.mom")
                        }, {
                            value: "MoMr",
                            text: i18next.t("dash.field.growthRate.mom")
                        }, {
                            value: "YoYv",
                            text: i18next.t("dash.field.growthValue.yoy2")
                        }, {
                            value: "YoYr",
                            text: i18next.t("dash.field.growthRate.yoy2")
                        }],
                        year_week: [{
                            value: "WoWv",
                            text: i18next.t("dash.field.growthValue.wow")
                        }, {
                            value: "WoWr",
                            text: i18next.t("dash.field.growthRate.wow")
                        }, {
                            value: "YoYv",
                            text: i18next.t("dash.field.growthValue.yoy2")
                        }, {
                            value: "YoYr",
                            text: i18next.t("dash.field.growthRate.yoy2")
                        }],
                        year_month_day: [{
                            value: "DoDv",
                            text: i18next.t("dash.field.growthValue.dod")
                        }, {
                            value: "DoDr",
                            text: i18next.t("dash.field.growthRate.dod")
                        }, {
                            value: "WoWv",
                            text: i18next.t("dash.field.growthValue.wow2")
                        }, {
                            value: "WoWr",
                            text: i18next.t("dash.field.growthRate.wow2")
                        }, {
                            value: "MoMv",
                            text: i18next.t("dash.field.growthValue.mom2")
                        }, {
                            value: "MoMr",
                            text: i18next.t("dash.field.growthRate.mom2")
                        }, {
                            value: "YoYv",
                            text: i18next.t("dash.field.growthValue.yoy2")
                        }, {
                            value: "YoYr",
                            text: i18next.t("dash.field.growthRate.yoy2")
                        }]
                    },
                    METRIC_RATIO_COMPARE: ["YoYr", "QoQr", "MoMr", "WoWr", "DoDr"],
                    DATE_FILTER_FORMAT: {
                        date_filter: "yyyy-MM-dd",
                        datetime_filter: "yyyy-MM-dd HH:mm:ss",
                        date_month_filter: "yyyy-MM",
                        date_minute_filter: "yyyy-MM-dd HH:mm"
                    }
                },
                isRatioMeasure: function(t, e) {
                    var i = e ? !0 : !1;
                    return t && -1 < this.CONST.METRIC_RATIO_COMPARE.indexOf(t) && (i = !0),
                        i
                },
                getDataFormat: function(t, e) {
                    return this.isRatioMeasure(t, e) ? {
                        format: "0.00%",
                        formatType: "preset"
                    } : {
                        format: "0.",
                        formatType: "preset"
                    }
                },
                isCustomSort: function(t) {
                    return FX.Utils.isArray(t)
                },
                checkThresholdAlert: function(n, s, t) {
                    var r = !1;
                    return !FX.Utils.isObjectEmpty(s) && FX.Utils.isNumber(n) && FX.Utils.forEach(t, function(t, e) {
                        if (e.enable) {
                            var i = e.cond
                                , a = i.value && i.value[0];
                            if (i.field === s.tag)
                                switch (i.method) {
                                    case "lt":
                                        if (n < a)
                                            return !(r = !0);
                                        break;
                                    case "lte":
                                        if (n <= a)
                                            return !(r = !0);
                                        break;
                                    case "eq":
                                        if (n === a)
                                            return !(r = !0);
                                        break;
                                    case "gt":
                                        if (a < n)
                                            return !(r = !0);
                                        break;
                                    case "gte":
                                        if (a <= n)
                                            return !(r = !0)
                                }
                        }
                    }),
                        r
                },
                dateFormat2FilterType: function(i) {
                    var a = "date_filter";
                    return FX.Utils.forEach(this.CONST.DATE_FILTER_FORMAT, function(t, e) {
                        if (e === i)
                            return a = t,
                                !1
                    }),
                        a
                },
                dateFilterType2Format: function(t) {
                    return this.CONST.DATE_FILTER_FORMAT[t]
                },
                getFilterByComponent: function(t, e, i) {
                    if (!e)
                        return null;
                    var a = e.fields[0]
                        , n = {};
                    switch (n.method = e.method || FX.Utils.getDashDefaultFilterMethod(a && a.type),
                        n.fields = e.fields,
                        n.triggers = e.triggers,
                        n.title = e.title,
                        n.rely = e.rely,
                    a && a.type) {
                        case "text":
                        case "radiogroup":
                        case "combo":
                        case "sn":
                            o.extend(n, this._getComboCheckFilter("text", i));
                            break;
                        case "phone":
                            n.type = "phone";
                            var s = FX.Utils.isObjectEmpty(i) ? null : i.phone;
                            n.value = s ? o.makeArray(s) : [];
                            break;
                        case "textarea":
                            n.type = "textarea";
                            s = i && i.items ? i.items[0] : i && i.value;
                            n.value = s ? o.makeArray(s) : [];
                            break;
                        case "combocheck":
                        case "checkboxgroup":
                            o.extend(n, this._getComboCheckFilter("combocheck", i));
                            break;
                        case "number":
                            n.type = "number",
                            i && (n.value = FX.Utils.isEmpty(i.value) ? [i.min, i.max] : [i.value]);
                            break;
                        case "datetime":
                            n.type = "datetime";
                            var r = FX.DashUtils.dateFilterType2Format(e.type);
                            i && i.value ? n.value = [FX.Utils.date2Str(new Date(i.value), r)] : i && i.mode ? n.value = [i] : n.value = [i && i.min ? FX.Utils.date2Str(new Date(i.min), r) : null, i && i.max ? FX.Utils.date2Str(new Date(i.max), r) : null];
                            break;
                        case "address":
                        case "location":
                            n.type = "address",
                                n.value = i ? [i.province, i.city, i.district] : [];
                            break;
                        case "user":
                        case "usergroup":
                        case "dept":
                        case "deptgroup":
                            o.extend(n, this._getComboCheckFilter(a.type, i));
                            break;
                        case "flowstate":
                            n.type = "flowstate",
                                n.value = o.makeArray(i && i.items ? i.items[0] : i && i.value);
                            break;
                        case "upload":
                        case "image":
                            n.type = "file_list";
                            break;
                        case "signature":
                            n.type = "signature"
                    }
                    return n
                },
                _getComboCheckFilter: function(t, e) {
                    var i = e && e.items || e && e.value;
                    return {
                        type: t,
                        hasEmpty: !(!e || !e.hasEmpty),
                        value: i ? o.makeArray(i) : []
                    }
                },
                getFilterByWidgetName: function(i, t, s) {
                    var r = [];
                    return FX.Utils.forEach(t, function(t, n) {
                        n.triggers && n.method && FX.Utils.forEach(n.triggers, function(t, e) {
                            if (e === i) {
                                var a = s[i].form;
                                return FX.Utils.forEach(n.fields, function(t, e) {
                                    if (e.form === a) {
                                        var i = o.extend({}, n, {
                                            entryId: e.form,
                                            field: e.field
                                        });
                                        return e.subform ? (o.extend(i, {
                                            subform: e.subform,
                                            subField: e.subField
                                        }),
                                            i.field = void 0) : (i.subform = void 0,
                                            i.subField = void 0),
                                            r.push(i),
                                            !1
                                    }
                                }),
                                    !1
                            }
                        })
                    }),
                        FX.Utils.getValidFilters({
                            cond: r
                        }).cond
                },
                isSubsetCharts: function(i, t) {
                    if (!i.length || !t.length)
                        return !1;
                    if (t.length > i.length)
                        return !1;
                    var a = !0;
                    return FX.Utils.forEach(t, function(t, e) {
                        if (i.indexOf(e) < 0)
                            return a = !1
                    }),
                        a
                },
                getFilterRelyFilter: function(n, t) {
                    var s = []
                        , e = t[n]
                        , r = !FX.Utils.isObjectEmpty(e && e.fields) && e.fields[0].form;
                    return FX.Utils.forEach(t, function(t, e) {
                        var i, a;
                        e && e.rely && -1 < e.rely.indexOf(n) && (FX.Utils.forEach(e.fields, function(t, e) {
                            if (e.form === r)
                                return i = e,
                                    !1
                        }),
                        i && (a = o.extend({}, e, {
                            entryId: i.form,
                            field: i.field
                        }),
                            i.subform ? (o.extend(a, {
                                subform: i.subform,
                                subField: i.subField
                            }),
                                a.field = void 0) : (a.subform = void 0,
                                a.subField = void 0),
                            s.push(a)))
                    }),
                        FX.Utils.getValidFilters({
                            cond: s,
                            rel: FX.CONST.FILTER_RELATION.AND
                        })
                }
            })
    }(jQuery),
    $.extend(FX.Utils, {
        isDarkColor: function(t, e, i) {
            return .299 * t + .578 * e + .114 * i < 192
        },
        hexToRgbJson: function(t) {
            if (!/^#[0-9a-fA-F]{6}$/.test(t))
                return {};
            for (var e = [], i = 1; i < 7; i += 2)
                e.push(parseInt("0x" + t.slice(i, i + 2)));
            return {
                r: e[0],
                g: e[1],
                b: e[2]
            }
        }
    }),
    function() {
        $.extend(FX.Utils, {
            evalExpression: function(op, left, right) {
                var calcOps = ["+", "-", "*", "/"], result;
                if ("!" === op)
                    return eval(op + "left");
                if (-1 < calcOps.indexOf(op) && FX.Utils.isValidNumber(left) && FX.Utils.isValidNumber(right)) {
                    switch (op) {
                        case "+":
                            result = new Big(left).plus(right);
                            break;
                        case "-":
                            result = new Big(left).minus(right);
                            break;
                        case "*":
                            result = new Big(left).times(right);
                            break;
                        case "/":
                            result = 0 === right ? "" : new Big(left).div(right)
                    }
                    return "" === result ? null : Number(result.toString())
                }
                return eval("left" + op + "right")
            },
            isValidNumber: function(t) {
                return "number" == typeof t && !isNaN(t) && isFinite(t)
            }
        })
    }(),
    function(t) {
        FX.Utils = FX.Utils || {},
            t.extend(FX.Utils, {
                address2Str: function(t, e, i) {
                    var a;
                    return i && t && (a = !(e = ""),
                    /p/.test(i) && t.province && (e += t.province,
                    t.province === t.city && (a = !1)),
                    /c/.test(i) && t.city && a && (e += t.city),
                    /d/.test(i) && t.district && (e += t.district),
                    /a/.test(i) && t.detail && (e += t.detail)),
                        e
                },
                num2Str: function(t, e) {
                    if (FX.Utils.isEmpty(t))
                        return "";
                    var i = t + "";
                    if (FX.Utils.isEmpty(e))
                        return i;
                    var a = /\[Num0\]/;
                    if (a.test(e))
                        return e.replace(a, i);
                    if ((a = /\[Num1\]/).test(e))
                        return e.replace(a, FX.Utils._num2CN(i, !1));
                    if ((a = /\[Num2\]/).test(e))
                        return e.replace(a, FX.Utils._num2CN(i, !0));
                    a = /[#0]+,?[#0]*\.?[#0]*%?/;
                    var n = e.match(a);
                    if (n && 0 < n.length) {
                        var s = n[0]
                            , i = FX.Utils._numberFormat(t, s);
                        return e.replace(a, i)
                    }
                    return e
                },
                _numberFormat: function(t, e) {
                    var i, a, n = "", s = t + "";
                    /%$/.test(e) && (n = "%",
                        t *= 100,
                        e = e.replace("%", ""),
                    -1 < (i = s.indexOf(".")) && (a = (a = s.length - 3 - i) < 0 ? 0 : 8 < a ? 8 : a,
                        t = parseFloat(t.toFixed(a))),
                        s = t + "");
                    var r = e.split(".")
                        , o = r[0]
                        , l = r[1];
                    if ("" !== l) {
                        for (var c = l ? l.length : 0, d = (s = FX.Utils.toFixed(parseFloat(t), c)).split(""), u = c; 0 < u && "#" === l.charAt(u - 1); u--) {
                            var h = d.pop();
                            if ("0" !== h) {
                                d.push(h);
                                break
                            }
                        }
                        var p = d.pop();
                        "." === p && (p = ""),
                            s = d.join("") + p
                    }
                    var f, m = s.split("."), g = m[0];
                    return /,/.test(o) ? m[0] = g.replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, "$1,") : (f = o.match(/[0]+[0#]*$/)) && 0 < f.length && (m[0] = FX.Utils.leftPad(g, f[0].length, "0")),
                    m.join(".") + n
                },
                _num2CN: function(t, e) {
                    var i = ""
                        , a = "";
                    e && (i = "",
                        a = "");
                    var n = Math.floor(Math.abs(t))
                        , s = Math.abs(t).toString()
                        , r = s.replace(/\..*$/, "")
                        , o = s.split(".")
                        , l = i
                        , c = a
                        , d = l[0]
                        , u = new RegExp(l[0] + "*$")
                        , h = new RegExp(l[0] + "+","g")
                        , p = ""
                        , f = t < 0 ? "-."[0] : "";
                    if (2 <= o.length) {
                        var m = o[1];
                        if (m) {
                            p = "-."[1];
                            for (var g = 0; g < m.length; g++)
                                p += l[+m[g]]
                        }
                    }
                    if (1 == r.length)
                        return f + l[n] + p;
                    if (r.length <= 5) {
                        for (var _ = "", v = 0, n = r.length; n--; ) {
                            var F = +r[v];
                            _ += this._num2CN(r[v], e) + (F && n ? c[n] : ""),
                                v++
                        }
                        return f + (_ = (_ = _.replace(h, d)).replace(u, "")) + p
                    }
                    for (var y, b = r.length / 4 >> 0, T = r.length % 4, _ = ""; 0 == T || !c[3 + b]; )
                        T += 4,
                            b--;
                    return +r.substr(0, T) ? (_ = this._num2CN(r.substr(0, T), e) + c[3 + b],
                    "0" === (y = r.substr(T))[0] && (_ += l[0]),
                        _ += this._num2CN(y, e)) : _ = this._num2CN(r.substr(0, T), e) + this._num2CN(r.substr(T), e),
                    f + (_ = (_ = _.replace(h, d)).replace(u, "")) + p
                },
                date2Str: function(t, e) {
                    if (!t)
                        return "";
                    var i = (e = e || "yyyy-MM-dd").length
                        , a = "";
                    if (0 < i) {
                        for (var n = e.charAt(0), s = 0, r = n, o = 1; o < i; o++) {
                            var l = e.charAt(o);
                            n !== l ? (a += FX.Utils._compileDateFormat({
                                char: n,
                                str: r,
                                len: o - s
                            }, t),
                                s = o,
                                r = n = l) : r += l
                        }
                        a += FX.Utils._compileDateFormat({
                            char: n,
                            str: r,
                            len: i - s
                        }, t)
                    }
                    return a
                },
                _compileDateFormat: function(t, e) {
                    var i = t.str
                        , a = t.len;
                    switch (t.char) {
                        case "E":
                            i = 2 < a ? FX.Utils.getDateDN()[e.getDay()] : 1 < a ? FX.Utils.getDateSDN()[e.getDay()] : e.getDay() + "";
                            break;
                        case "y":
                            i = a <= 3 ? (e.getFullYear() + "").slice(2, 4) : e.getFullYear();
                            break;
                        case "M":
                            i = 2 < a ? FX.Utils.getDateMN()[e.getMonth()] : a < 2 ? e.getMonth() + 1 : FX.Utils.leftPad(e.getMonth() + 1 + "", 2, "0");
                            break;
                        case "d":
                            i = 1 < a ? FX.Utils.leftPad(e.getDate() + "", 2, "0") : e.getDate();
                            break;
                        case "h":
                            var n = e.getHours() % 12;
                            0 === n && (n = 12),
                                i = 1 < a ? FX.Utils.leftPad(n + "", 2, "0") : n;
                            break;
                        case "H":
                            i = 1 < a ? FX.Utils.leftPad(e.getHours() + "", 2, "0") : e.getHours();
                            break;
                        case "m":
                            i = 1 < a ? FX.Utils.leftPad(e.getMinutes() + "", 2, "0") : e.getMinutes();
                            break;
                        case "s":
                            i = 1 < a ? FX.Utils.leftPad(e.getSeconds() + "", 2, "0") : e.getSeconds();
                            break;
                        case "a":
                            i = e.getHours() < 12 ? "am" : "pm";
                            break;
                        default:
                            i = t.str
                    }
                    return i
                },
                getPercentFormat: function(t) {
                    return /%$/.test(t = t || "0.") || (t += "%"),
                        t
                }
            })
    }(jQuery),
    function($) {
        FX.Formula = {
            AND: function() {
                for (var t = FX.Utils.flatten(arguments), e = 0, i = t.length; e < i; e++)
                    if (!t[e])
                        return !1;
                return !0
            },
            OR: function() {
                for (var t = FX.Utils.flatten(arguments), e = 0, i = t.length; e < i; e++)
                    if (t[e])
                        return !0;
                return !1
            },
            FALSE: function() {
                return !1
            },
            TRUE: function() {
                return !0
            },
            IF: function(t, e, i) {
                return t ? e : i
            },
            NOT: function(t) {
                return !t
            },
            XOR: function() {
                for (var t = 0, e = FX.Utils.flatten(arguments), i = 0, a = e.length; i < a; i++)
                    e[i] && t++;
                return !!(1 & Math.floor(Math.abs(t)))
            },
            CHAR: function(t) {
                return 9 === t || 10 === t || 34 === t || 39 === t || 92 === t ? String.fromCharCode(t) : ""
            },
            CONCATENATE: function() {
                for (var t = FX.Utils.flatten(arguments), e = 0; -1 < (e = t.indexOf(!0)); )
                    t[e] = "TRUE";
                for (var i = 0; -1 < (i = t.indexOf(!1)); )
                    t[i] = "FALSE";
                return t.join("")
            },
            EXACT: function(t, e) {
                return t === e
            },
            LEFT: function(t, e) {
                return e = FX.Utils.isEmpty(e) ? 1 : e,
                    t ? t.substring(0, e) : ""
            },
            LEN: function(t) {
                return FX.Utils.isString(t) ? t ? t.length : 0 : t && t.length ? t.length : 0
            },
            LOWER: function(t) {
                return FX.Utils.isString(t) ? t ? t.toLowerCase() : t : ""
            },
            REPLACE: function(t, e, i, a) {
                return FX.Utils.isNumber(e) && FX.Utils.isNumber(i) ? (a = a || "",
                (t = t || "").substr(0, e - 1) + a + t.substr(e - 1 + i)) : t
            },
            REPT: function(t, e) {
                return e = e || 0,
                    new Array(e + 1).join(t)
            },
            RIGHT: function(t, e) {
                return e = void 0 === e ? 1 : e,
                    t ? t.substring(t.length - e) : ""
            },
            SEARCH: function(t, e, i) {
                return FX.Utils.isString(t) && FX.Utils.isString(e) ? (i = FX.Utils.isNull(i) ? 0 : i,
                e.toLowerCase().indexOf(t.toLowerCase(), i - 1) + 1) : 0
            },
            SPLIT: function(t, e) {
                return FX.Utils.isString(t) ? t.split(e) : []
            },
            TRIM: function(t) {
                return FX.Utils.isString(t) ? t.replace(/ +/g, " ").trim() : ""
            },
            UPPER: function(t) {
                return FX.Utils.isString(t) ? t.toUpperCase() : ""
            },
            MID: function(t, e, i) {
                return t = t || "",
                    FX.Utils.isNumber(e) && FX.Utils.isNumber(i) ? t.substr(e - 1, i) : t
            },
            AVERAGE: function() {
                for (var t = FX.Utils.flatten(arguments, function(t) {
                    return FX.Utils.isNumber(t)
                }), e = t.length, i = 0, a = 0, n = 0; n < e; n++)
                    i += FX.Utils.parseNumber(t[n]),
                        a += 1;
                return i / a
            },
            COUNT: function() {
                return FX.Utils.flatten(arguments).length
            },
            COUNTIF: function() {
                var len = arguments.length
                    , criteria = arguments[len - 1];
                /[<>=!]/.test(criteria) || (criteria = '=="' + criteria + '"');
                for (var args = FX.Utils.flatten(Array.prototype.slice.call(arguments, 0, len - 1)), matches = 0, i = 0; i < args.length; i++)
                    "string" != typeof args[i] ? eval(args[i] + criteria) && matches++ : eval('"' + args[i] + '"' + criteria) && matches++;
                return matches
            },
            LARGE: function(t, e) {
                var i = (t = FX.Utils.flatten(t, function(t) {
                    return FX.Utils.isNumber(t)
                })).sort(function(t, e) {
                    return e - t
                })[e - 1];
                return FX.Utils.parseNumber(i)
            },
            MAX: function() {
                var t = FX.Utils.flatten(arguments, function(t) {
                    return FX.Utils.isNumber(t)
                });
                return 0 === t.length ? 0 : Math.max.apply(Math, t)
            },
            MIN: function() {
                var t = FX.Utils.flatten(arguments, function(t) {
                    return FX.Utils.isNumber(t)
                });
                return 0 === t.length ? 0 : Math.min.apply(Math, t)
            },
            SMALL: function(t, e) {
                var i = (t = FX.Utils.flatten(t, function(t) {
                    return FX.Utils.isNumber(t)
                })).sort(function(t, e) {
                    return t - e
                })[e - 1];
                return FX.Utils.parseNumber(i)
            },
            ABS: function(t) {
                return FX.Utils.isNumber(t) ? Math.abs(t) : 0
            },
            ROUND: function(t, e) {
                if (t = FX.Utils.parseNumber(t),
                    e = FX.Utils.parseNumber(e),
                FX.Utils.isNull(t) || FX.Utils.isNull(e))
                    return null;
                var i = FX.Utils.evalExpression("*", t, Math.pow(10, e));
                return Number(new Big(i).round(0).toString()) / Math.pow(10, e)
            },
            CEILING: function(t, e) {
                if (t = FX.Utils.parseNumber(t),
                    e = FX.Utils.parseNumber(e),
                FX.Utils.isNull(t) || FX.Utils.isNull(e))
                    return null;
                if (0 === e)
                    return 0;
                var i = e < 0 ? -1 : 0;
                e = Math.abs(e);
                var a = FX.Utils.evalExpression("-", e, Math.floor(e))
                    , n = 0;
                return 0 < a && (n = -Math.floor(FX.Utils.evalExpression("/", Math.log(a), Math.log(10)))),
                    0 <= t ? FX.Formula.ROUND.apply(this, [FX.Utils.evalExpression("*", Math.ceil(FX.Utils.evalExpression("/", t, e)), e), n]) : 0 == i ? -FX.Formula.ROUND.apply(this, [FX.Utils.evalExpression("*", Math.floor(FX.Utils.evalExpression("/", Math.abs(t), e)), e), n]) : -FX.Formula.ROUND.apply(this, [FX.Utils.evalExpression("*", Math.ceil(FX.Utils.evalExpression("/", Math.abs(t), e)), e), n])
            },
            FLOOR: function(t, e) {
                if (t = FX.Utils.parseNumber(t),
                    e = FX.Utils.parseNumber(e),
                FX.Utils.isNull(t) || FX.Utils.isNull(e))
                    return null;
                if (0 === e)
                    return 0;
                if (!(0 < t && 0 < e || t < 0 && e < 0))
                    return 0;
                e = Math.abs(e);
                var i = FX.Utils.evalExpression("-", e, Math.floor(e))
                    , a = 0;
                return 0 < i && (a = -Math.floor(FX.Utils.evalExpression("/", Math.log(i), Math.log(10)))),
                    0 <= t ? FX.Formula.ROUND.apply(this, [FX.Utils.evalExpression("*", Math.floor(FX.Utils.evalExpression("/", t, e)), e), a]) : -FX.Formula.ROUND.apply(this, [FX.Utils.evalExpression("*", Math.floor(FX.Utils.evalExpression("/", Math.abs(t), e)), e), a])
            },
            INT: function(t) {
                return FX.Utils.isNumber(t) ? Math.floor(t) : 0
            },
            LOG: function(t, e) {
                return e = void 0 === e ? 10 : e,
                    FX.Utils.isNumber(e) ? Math.log(t) / Math.log(e) : 0
            },
            MOD: function(t, e) {
                if (0 === e)
                    return 0;
                var i = Math.abs(t % e);
                return 0 < e ? i : -i
            },
            POWER: function(t, e) {
                var i = Math.pow(t, e);
                return isNaN(i) ? 0 : i
            },
            PRODUCT: function() {
                var t = FX.Utils.flatten(arguments, function(t) {
                    return FX.Utils.isNumber(t)
                })
                    , e = 1;
                if (t.length)
                    for (var i = 0; i < t.length; i++)
                        e = FX.Utils.evalExpression("*", e, t[i]);
                else
                    e = 0;
                return e
            },
            SQRT: function(t) {
                return t < 0 ? 0 : Math.sqrt(t)
            },
            SUM: function() {
                for (var t = 0, e = FX.Utils.flatten(arguments, function(t) {
                    return FX.Utils.isNumber(t)
                }), i = 0, a = e.length; i < a; ++i)
                    t = FX.Utils.evalExpression("+", t, FX.Utils.parseNumber(e[i]));
                return t
            },
            SUMPRODUCT: function() {
                for (var t, e, i, a = 0, n = [], s = -1, r = 0; r < arguments.length; r++)
                    arguments[r]instanceof Array && (s = s < 0 ? arguments[r].length : Math.min(arguments[r].length, s),
                        n.push(arguments[r]));
                for (var o = 0; o < s; o++) {
                    for (t = 1,
                             e = 0; e < n.length; e++)
                        i = parseFloat(n[e][o]),
                        isNaN(i) && (i = 0),
                            t = FX.Utils.evalExpression("*", t, i);
                    a = FX.Utils.evalExpression("+", a, t)
                }
                return a
            },
            FIXED: function(t, e) {
                return t = FX.Utils.parseNumber(t),
                    FX.Utils.isNull(t) ? null : (e = FX.Utils.parseNumber(e) || 0,
                        FX.Utils.isNumber(e) && 0 <= e ? FX.Utils.toFixed(t, e) : "")
            },
            RAND: function() {
                return FX.Utils.fixDecimalPrecision(Math.random(), 6)
            },
            DATE: function() {
                return 6 === arguments.length ? new Date(parseInt(arguments[0], 10),parseInt(arguments[1], 10) - 1,parseInt(arguments[2], 10),parseInt(arguments[3], 10),parseInt(arguments[4], 10),parseInt(arguments[5], 10)) : 3 === arguments.length ? new Date(parseInt(arguments[0], 10),parseInt(arguments[1], 10) - 1,parseInt(arguments[2], 10)) : 0 === arguments.length ? new Date : new Date(arguments[0])
            },
            TIME: function(t, e, i) {
                return (3600 * t + 60 * e + i) / 86400
            },
            TIMESTAMP: function(t) {
                return FX.Utils.isDate(t) ? t.getTime() : 0
            },
            TODAY: function() {
                return new Date
            },
            NOW: function() {
                return new Date
            },
            SYSTIME: function() {
                return FX.Utils.getSysTime()
            },
            IP: function() {
                return FX.STATIC.ip || ""
            },
            DAY: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getDate()
            },
            MONTH: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getMonth() + 1
            },
            YEAR: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getFullYear()
            },
            HOUR: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getHours()
            },
            MINUTE: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getMinutes()
            },
            SECOND: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return t.getSeconds()
            },
            DAYS: function(t, e) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t)) {
                    e = FX.Utils.parseDate(e);
                    if (!FX.Utils.isNull(e))
                        return (new Date(t.getFullYear(),t.getMonth(),t.getDate()) - new Date(e.getFullYear(),e.getMonth(),e.getDate())) / 864e5
                }
            },
            DAYS360: function(t, e, i) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t)) {
                    e = FX.Utils.parseDate(e);
                    if (!FX.Utils.isNull(e)) {
                        var a, n = e.getMonth(), s = t.getMonth(), r = i ? (a = 31 === e.getDate() ? 30 : e.getDate(),
                            31 === t.getDate() ? 30 : t.getDate()) : (a = 31 === e.getDate() ? 30 : e.getDate(),
                            31 === t.getDate() ? a < 30 ? (s++,
                                1) : 30 : t.getDate());
                        return 360 * (t.getFullYear() - e.getFullYear()) + 30 * (s - n) + (r - a)
                    }
                }
            },
            DATEDELTA: function(t, e) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t))
                    return FX.Utils.isNumber(e) || (e = 0),
                        new Date(t.getTime() + 864e5 * e)
            },
            DATEDIF: function(t, e, i) {
                var a = FX.Utils.parseDate(e);
                if (!FX.Utils.isNull(a)) {
                    var n, s = FX.Utils.parseDate(t);
                    if (!(FX.Utils.isNull(s) || e < t)) {
                        switch (i) {
                            case "y":
                                n = (e - t) / 31536e6;
                                break;
                            case "M":
                                n = (e - t) / 2592e6;
                                break;
                            case "d":
                                n = (e - t) / 864e5;
                                break;
                            case "h":
                                n = (e - t) / 36e5;
                                break;
                            case "m":
                                n = (e - t) / 6e4;
                                break;
                            case "s":
                                n = (e - t) / 1e3;
                                break;
                            default:
                                n = (e - t) / 864e5
                        }
                        return FX.Utils.fixDecimalPrecision(n)
                    }
                }
            },
            ISOWEEKNUM: function(t) {
                t = FX.Utils.parseDate(t);
                if (!FX.Utils.isNull(t)) {
                    t.setHours(0, 0, 0),
                        t.setDate(t.getDate() + 4 - (t.getDay() || 7));
                    var e = new Date(t.getFullYear(),0,1);
                    return Math.ceil(((t - e) / 864e5 + 1) / 7)
                }
            },
            WEEKNUM: function(t, e) {
                if (t = FX.Utils.parseDate(t),
                    !FX.Utils.isNull(t)) {
                    var i = {
                        1: 0,
                        2: 1,
                        11: 1,
                        12: 2,
                        13: 3,
                        14: 4,
                        15: 5,
                        16: 6,
                        17: 0
                    }
                        , a = FX.Utils.isNull(i[e]) ? 0 : i[e]
                        , n = new Date(t.getFullYear(),0,1)
                        , s = (a + 7 - n.getDay()) % 7
                        , r = 0 < s ? 1 : 0
                        , o = n.getTime() + 24 * s * 60 * 60 * 1e3;
                    return Math.floor((t.getTime() - o) / 864e5 / 7 + 1) + r
                }
            },
            TEXT: function(t, e) {
                return FX.Utils.isNull(t) ? "" : FX.Utils.isDate(t) && !FX.Utils.isEmpty(e) ? FX.Utils.date2Str(t, e) : FX.Utils.num2Str(t, e)
            },
            VALUE: function(t) {
                return FX.Utils.isEmpty(t) || isNaN(t) ? 0 : parseFloat(t)
            },
            UUID: function() {
                return FX.Utils.UUID()
            },
            RECNO: function() {
                var e = this;
                return FX.Utils.isNull(this.context.EntryRecNo) ? this.context.APPID && this.context.ENTRYID ? (FX.Utils.dataAjax({
                    url: FX.Utils.getApi(this.context.API.recno),
                    async: !1,
                    data: {
                        appId: this.context.APPID,
                        entryId: this.context.ENTRYID,
                        dataId: this.context.DATAID,
                        formId: this.context.ENTRYID,
                        hasIncLock: this.context.RecnoLock
                    }
                }, function(t) {
                    e.context.EntryRecNo = t.incId
                }),
                    this.context.EntryRecNo) : "" : this.context.EntryRecNo
            },
            ISEMPTY: function(t) {
                return FX.Utils.isObjectEmpty(t)
            },
            MAPX: function(t, e, i, a) {
                var n = null;
                if (FX.Utils.isEmpty(t) || FX.Utils.isObjectEmpty(e))
                    return n;
                t = t.toLowerCase();
                var s, r, o = FX.Utils.getFieldInfoByFormula(i), l = FX.Utils.getFieldInfoByFormula(a);
                return /^sum|avg|max|min|count|first|last$/.test(t) && o.entryId && o.entryId === l.entryId && (r = (s = FX.Utils.isDate(e)) ? e.getTime() : e,
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(this.context.API.aggregate),
                        async: !1,
                        data: {
                            op: t,
                            appId: this.context.APPID,
                            entryId: this.context.ENTRYID,
                            dataId: this.context.DATAID,
                            formId: o.entryId,
                            lookup_value: r,
                            lookup_field: o.field,
                            result_field: l.field,
                            date_type: s,
                            refAppId: o.appId
                        }
                    }, function(t) {
                        t.result && t.result[0] && !FX.Utils.isNull(t.result[0].result) && (n = t.result[0].result)
                    }, function() {
                        throw FX.CONST.FORMULA_ERROR.MAPX
                    })),
                    n
            },
            MAP: function(t, e, i) {
                var a = [];
                if (FX.Utils.isObjectEmpty(t))
                    return a;
                var n = FX.Utils.getFieldInfoByFormula(e)
                    , s = FX.Utils.getFieldInfoByFormula(i);
                return n.entryId && n.entryId === s.entryId && FX.Utils.dataAjax({
                    url: FX.Utils.getApi(this.context.API.map),
                    async: !1,
                    data: {
                        appId: this.context.APPID,
                        entryId: this.context.ENTRYID,
                        dataId: this.context.DATAID,
                        formId: n.entryId,
                        lookup_value: t,
                        lookup_field: n.field,
                        result_field: s.field,
                        refAppId: n.appId
                    }
                }, function(t) {
                    FX.Utils.forEach(t.result, function(t, e) {
                        a.push(e[s.field])
                    })
                }, function() {}),
                    a
            },
            GETUSERNAME: function() {
                return FX.CorpUser.getMemberNickname() || ""
            },
            UNION: function() {
                var i = {}
                    , t = FX.Utils.flatten(arguments, function(t) {
                    var e = (FX.Utils.isString(t) || FX.Utils.isNumber(t)) && !FX.Utils.isObjectEmpty(t);
                    return e && (i[t += ""] ? e = !1 : i[t] = !0),
                        e
                })
                    , a = [];
                return FX.Utils.forEach(t, function(t, e) {
                    a.push(e + "")
                }),
                    a
            },
            IFS: function() {
                for (var t = null, e = 0; e < arguments.length; e += 2)
                    if (arguments[e]) {
                        var i = arguments[e + 1]
                            , t = FX.Utils.isNull(i) ? null : i;
                        break
                    }
                return t
            },
            WORKDAY: function(t, e, i) {
                if (t = FX.Utils.parseDate(t),
                    FX.Utils.isNull(t))
                    return null;
                if (!(e = FX.Utils.parseNumber(e)))
                    return t;
                var a = t.getTime()
                    , n = 864e5;
                for (0 < e || (n = -n),
                         e = Math.abs(e); 0 < e; )
                    a += n,
                    FX.Utils.isWorkDay(a, i) && e--;
                return FX.Utils.parseDate(a)
            },
            NETWORKDAYS: function(t, e, i) {
                if (t = FX.Utils.parseDate(t),
                    e = FX.Utils.parseDate(e),
                FX.Utils.isNull(t) || FX.Utils.isNull(e))
                    return null;
                var a, n = !1;
                FX.Utils.isBeforeDate(e, t) && (n = !0,
                    a = t,
                    t = e,
                    e = a);
                for (var s = FX.Utils.isWorkDay(t) ? 1 : 0, r = t; FX.Utils.isBeforeDate(r, e); )
                    r = new Date(r.getTime() + 864e5),
                    FX.Utils.isWorkDay(r, i) && (s += 1);
                return n && (s = FX.Utils.parseNumber(-s)),
                    s
            },
            TEXTUSER: function(t, e) {
                var i;
                try {
                    i = JSON.parse(t)
                } catch (t) {
                    return ""
                }
                if (!FX.Utils.isString(e) || FX.Utils.isObjectEmpty(i))
                    return "";
                var a = "";
                switch (e = e.toLowerCase()) {
                    case "name":
                        a = i.name;
                        break;
                    case "username":
                        a = i.username
                }
                return a
            }
        }
    }(jQuery),
    function(i) {
        FX.FormulaCalc = function() {
            this.tokenMap = this._getTokenMap(),
                this.allTokens = this._getAllTokens(),
                this.lexer = this._getLexer(),
                this.parser = this._getParser(),
                this.interpreter = this._getInterpreter()
        }
            ,
            i.extend(FX.FormulaCalc.prototype, {
                constructor: FX.FormulaCalc,
                _concatTokens: function() {
                    var i = [];
                    return FX.Utils.forEach(arguments, function(t, e) {
                        e && (i = i.concat(e))
                    }),
                        i
                },
                _sortTokensByPosition: function(t) {
                    return [].concat(t).sort(function(t, e) {
                        return t.startOffset - e.startOffset
                    })
                },
                _consumeBinaryToken: function(t, e, i) {
                    var a, n, s, r, o, l = t.slice(), c = e.slice(), d = t.map(function(t) {
                        return t.image
                    }).indexOf(i.image), u = this.tokenMap;
                    return -1 < d && (n = (a = c.slice().splice(d, 2))[0],
                        s = a[1],
                        o = null,
                        (r = chevrotain.tokenMatcher)(i, u.Addition) || r(i, u.Multiplication) ? o = FX.Utils.evalExpression(i.image, n, s) : r(i, u.Compare) ? o = r(i, u.LessOrEqual) ? n <= s : r(i, u.GreaterOrEqual) ? s <= n : r(i, u.Less) ? n < s : s < n : r(i, u.Equal) ? o = r(i, u.EqualStrict) ? n === s : r(i, u.NotEqualStrict) ? n !== s : r(i, u.EqualLoose) ? n == s : n != s : r(i, u.BitAnd) ? o = n & s : r(i, u.BitOr) ? o = n | s : r(i, u.LogicAnd) ? o = n && s : r(i, u.LogicOr) && (o = n || s),
                        l.splice(d, 1),
                        c.splice(d, 2, o)),
                        {
                            resultTokens: l,
                            resultOperands: c
                        }
                },
                _getTokenMap: function() {
                    var t = chevrotain.createToken
                        , e = chevrotain.Lexer
                        , i = t({
                        name: "Unary",
                        pattern: e.NA
                    })
                        , a = t({
                        name: "Addition",
                        pattern: e.NA
                    })
                        , n = t({
                        name: "Multiplication",
                        pattern: e.NA
                    })
                        , s = t({
                        name: "Equal",
                        pattern: e.NA
                    })
                        , r = t({
                        name: "Compare",
                        pattern: e.NA
                    });
                    return {
                        WhiteSpace: t({
                            name: "WhiteSpace",
                            pattern: /\s+/,
                            group: e.SKIPPED
                        }),
                        String: t({
                            name: "String",
                            pattern: /("(\\\\|\\"|[^"])*"|'(\\\\|\\'|[^'])*')/
                        }),
                        Number: t({
                            name: "Number",
                            pattern: /[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?/
                        }),
                        Boolean: t({
                            name: "Boolean",
                            pattern: /(true|false)/
                        }),
                        Empty: t({
                            name: "Empty",
                            pattern: /(null|undefined)/
                        }),
                        NaN: t({
                            name: "NaN",
                            pattern: /NaN/
                        }),
                        Comma: t({
                            name: "Comma",
                            pattern: /,/
                        }),
                        Func: t({
                            name: "Func",
                            pattern: /[A-Z0-9]+/
                        }),
                        LParen: t({
                            name: "LParen",
                            pattern: /\(/
                        }),
                        RParen: t({
                            name: "RParen",
                            pattern: /\)/
                        }),
                        LSquare: t({
                            name: "LSquare",
                            pattern: /\[/
                        }),
                        RSquare: t({
                            name: "RSquare",
                            pattern: /]/
                        }),
                        Plus: t({
                            name: "Plus",
                            pattern: /\+(?!\+)/,
                            categories: [i, a]
                        }),
                        Minus: t({
                            name: "Minus",
                            pattern: /-(?!-)/,
                            categories: [i, a]
                        }),
                        Unary: i,
                        Addition: a,
                        Multi: t({
                            name: "Multi",
                            pattern: /\*/,
                            categories: [n]
                        }),
                        Div: t({
                            name: "Div",
                            pattern: /\//,
                            categories: [n]
                        }),
                        Multiplication: n,
                        LessOrEqual: t({
                            name: "LessOrEqual",
                            pattern: /<=/,
                            categories: [r]
                        }),
                        GreaterOrEqual: t({
                            name: "GreaterOrEqual",
                            pattern: />=/,
                            categories: [r]
                        }),
                        Less: t({
                            name: "Less",
                            pattern: /</,
                            categories: [r]
                        }),
                        Greater: t({
                            name: "Greater",
                            pattern: />/,
                            categories: [r]
                        }),
                        Compare: r,
                        EqualStrict: t({
                            name: "EqualStrict",
                            pattern: /===/,
                            categories: [s]
                        }),
                        NotEqualStrict: t({
                            name: "NotEqualStrict",
                            pattern: /!==/,
                            categories: [s]
                        }),
                        EqualLoose: t({
                            name: "EqualLoose",
                            pattern: /==/,
                            categories: [s]
                        }),
                        NotEqualLoose: t({
                            name: "NotEqualLoose",
                            pattern: /!=/,
                            categories: [s]
                        }),
                        Equal: s,
                        LogicNot: t({
                            name: "LogicNot",
                            pattern: /!/,
                            categories: [i]
                        }),
                        LogicAnd: t({
                            name: "LogicAnd",
                            pattern: /&&/
                        }),
                        LogicOr: t({
                            name: "LogicOr",
                            pattern: /\|\|/
                        }),
                        BitAnd: t({
                            name: "BitAnd",
                            pattern: /&/
                        }),
                        BitOr: t({
                            name: "BitOr",
                            pattern: /\|/
                        })
                    }
                },
                _getAllTokens: function() {
                    var t = this.tokenMap;
                    return [t.WhiteSpace, t.String, t.Number, t.NaN, t.Boolean, t.Empty, t.Func, t.LParen, t.RParen, t.LSquare, t.RSquare, t.Plus, t.Minus, t.Addition, t.Unary, t.Multi, t.Div, t.Multiplication, t.LessOrEqual, t.GreaterOrEqual, t.Less, t.Greater, t.Compare, t.EqualStrict, t.NotEqualStrict, t.EqualLoose, t.NotEqualLoose, t.Equal, t.LogicNot, t.LogicAnd, t.LogicOr, t.BitAnd, t.BitOr, t.Comma]
                },
                _getLexer: function() {
                    return new chevrotain.Lexer(this.allTokens,{
                        ensureOptimizations: !0
                    })
                },
                _getParser: function() {
                    var i = this
                        , a = chevrotain.Parser;
                    function t() {
                        a.call(this, i.allTokens);
                        var t = this
                            , e = i.tokenMap;
                        t.RULE("expr", function() {
                            t.SUBRULE(t.commaExpression)
                        }),
                            t.RULE("commaExpression", function() {
                                t.SUBRULE(t.binaryExpression),
                                    t.MANY(function() {
                                        t.CONSUME(e.Comma),
                                            t.SUBRULE2(t.binaryExpression)
                                    })
                            }),
                            t.RULE("binaryExpression", function() {
                                t.SUBRULE(t.unaryExpression),
                                    t.MANY(function() {
                                        t.OR(t.c1 || (t.c1 = [{
                                            ALT: function() {
                                                t.CONSUME(e.LogicOr)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.LogicAnd)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.BitOr)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.BitAnd)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.Equal)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.Compare)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.Addition)
                                            }
                                        }, {
                                            ALT: function() {
                                                t.CONSUME(e.Multiplication)
                                            }
                                        }])),
                                            t.SUBRULE2(t.unaryExpression)
                                    })
                            }),
                            t.RULE("unaryExpression", function() {
                                t.MANY(function() {
                                    t.CONSUME(e.Unary)
                                }),
                                    t.SUBRULE(t.atomicExpression)
                            }),
                            t.RULE("atomicExpression", function() {
                                t.OR(t.c2 || (t.c2 = [{
                                    ALT: function() {
                                        t.SUBRULE(t.array)
                                    }
                                }, {
                                    ALT: function() {
                                        t.SUBRULE(t.func)
                                    }
                                }, {
                                    ALT: function() {
                                        t.SUBRULE(t.group)
                                    }
                                }, {
                                    ALT: function() {
                                        t.SUBRULE(t.base)
                                    }
                                }])),
                                    t.MANY(function() {
                                        t.CONSUME(e.LSquare),
                                            t.SUBRULE(t.expr),
                                            t.CONSUME(e.RSquare)
                                    })
                            }),
                            t.RULE("array", function() {
                                t.CONSUME(e.LSquare),
                                    t.MANY_SEP({
                                        SEP: e.Comma,
                                        DEF: function() {
                                            t.SUBRULE(t.binaryExpression)
                                        }
                                    }),
                                    t.CONSUME(e.RSquare)
                            }),
                            t.RULE("func", function() {
                                t.CONSUME(e.Func),
                                    t.CONSUME(e.LParen),
                                    t.OPTION(function() {
                                        t.SUBRULE(t.binaryExpression),
                                            t.MANY(function() {
                                                t.CONSUME(e.Comma),
                                                    t.SUBRULE2(t.binaryExpression)
                                            }),
                                            t.OPTION2(function() {
                                                t.CONSUME2(e.Comma)
                                            })
                                    }),
                                    t.CONSUME(e.RParen)
                            }),
                            t.RULE("group", function() {
                                t.CONSUME(e.LParen),
                                    t.AT_LEAST_ONE_SEP({
                                        SEP: e.Comma,
                                        DEF: function() {
                                            t.SUBRULE(t.expr)
                                        }
                                    }),
                                    t.CONSUME(e.RParen)
                            }),
                            t.RULE("base", function() {
                                t.OR(t.c3 || (t.c3 = [{
                                    ALT: function() {
                                        t.CONSUME(e.String)
                                    }
                                }, {
                                    ALT: function() {
                                        t.CONSUME(e.Number)
                                    }
                                }, {
                                    ALT: function() {
                                        t.CONSUME(e.Boolean)
                                    }
                                }, {
                                    ALT: function() {
                                        t.CONSUME(e.Empty)
                                    }
                                }, {
                                    ALT: function() {
                                        t.CONSUME(e.NaN)
                                    }
                                }]))
                            }),
                            this.performSelfAnalysis()
                    }
                    return new ((t.prototype = Object.create(a.prototype)).constructor = t)([])
                },
                _getInterpreter: function() {
                    var s = this
                        , t = this.parser.getBaseCstVisitorConstructor();
                    function e() {
                        t.apply(this, arguments),
                            this.validateVisitor()
                    }
                    (e.prototype = Object.create(t.prototype)).constructor = e;
                    var a = chevrotain.tokenMatcher
                        , n = this.tokenMap;
                    return i.extend(e.prototype, {
                        expr: function(t) {
                            return this.visit(t.commaExpression)
                        },
                        commaExpression: function(t) {
                            var e = t.binaryExpression.slice(-1)[0];
                            return this.visit(e)
                        },
                        binaryExpression: function(t) {
                            var i = this
                                , e = s._concatTokens(t.Multiplication, t.Addition, t.Compare, t.Equal, t.BitAnd, t.BitOr, t.LogicAnd, t.LogicOr)
                                , a = s._sortTokensByPosition(e)
                                , n = [];
                            return FX.Utils.forEach(t.unaryExpression, function(t, e) {
                                n.push(i.visit(e))
                            }),
                                FX.Utils.forEach(e, function(t, e) {
                                    var i = s._consumeBinaryToken(a, n, e);
                                    a = i.resultTokens,
                                        n = i.resultOperands
                                }),
                                n[0]
                        },
                        unaryExpression: function(t) {
                            var i = this.visit(t.atomicExpression);
                            if (!t.Unary)
                                return i;
                            var e = t.Unary.slice().reverse();
                            return FX.Utils.forEach(e, function(t, e) {
                                i = a(e, n.Minus) ? -i : a(e, n.Plus) ? +i : !i
                            }),
                                i
                        },
                        atomicExpression: function(t) {
                            var a = null
                                , n = this;
                            return t.base ? a = this.visit(t.base) : t.group ? a = this.visit(t.group) : t.array ? a = this.visit(t.array) : t.func && (a = this.visit(t.func)),
                                FX.Utils.forEach(t.expr, function(t, e) {
                                    var i = n.visit(e);
                                    a = a[i]
                                }),
                                a
                        },
                        array: function(t) {
                            var i = []
                                , a = this;
                            return FX.Utils.forEach(t.binaryExpression, function(t, e) {
                                i.push(a.visit(e))
                            }),
                                i
                        },
                        func: function(t) {
                            var i = this
                                , e = t.Func[0].image
                                , a = [];
                            return FX.Utils.forEach(t.binaryExpression, function(t, e) {
                                a.push(i.visit(e))
                            }),
                                s.calcParser.applyFunc(e, a)
                        },
                        group: function(t) {
                            return this.visit(t.expr)
                        },
                        base: function(t) {
                            if (t.String) {
                                var e = t.String[0].image;
                                return e.substring(1, e.length - 1)
                            }
                            return t.Number ? Number(t.Number[0].image) : t.Boolean ? "true" === t.Boolean[0].image : t.Empty ? null : t.NaN ? NaN : void 0
                        }
                    }),
                        new e
                },
                parse: function(t, e) {
                    this.calcParser = e;
                    var i = this.lexer.tokenize(t);
                    if (0 < i.errors.length)
                        return console.log("Lexer Errors:", i.errors),
                            null;
                    this.parser.input = i.tokens;
                    var a = this.parser.expr();
                    if (0 < this.parser.errors.length)
                        return console.log("Parser Errors:", this.parser.errors),
                            null;
                    try {
                        return this.interpreter.visit(a)
                    } catch (t) {
                        throw console.log("Visit Error:", t),
                            t
                    }
                }
            })
    }(jQuery),
    function(t) {
        var e = new FX.FormulaCalc;
        FX.FormulaCalcParser = function(t) {
            this.context = t
        }
            ,
            t.extend(FX.FormulaCalcParser.prototype, {
                applyFunc: function(t, e) {
                    if (FX.Formula[t])
                        return FX.Formula[t].apply(this, e)
                },
                parse: function(t) {
                    return e.parse(t, this)
                }
            })
    }(jQuery),
    FX.OB = function(t) {
        this.options = $.extend(this._defaultConfig(), t),
            this._beforeInit(),
            this._init(),
            this._afterInit()
    }
    ,
    $.extend(FX.OB.prototype, {
        _defaultConfig: function() {
            return {
                onBeforeInit: null,
                onAfterInit: null
            }
        },
        _init: function() {},
        _beforeInit: function() {
            FX.Utils.applyFunc(this, this.options.onBeforeInit, [], !1)
        },
        _afterInit: function() {
            FX.Utils.applyFunc(this, this.options.onAfterInit, [], !1)
        }
    }),
    FX.Widget = FX.extend(FX.OB, {
        _defaultConfig: function() {
            return $.extend(FX.Widget.superclass._defaultConfig.apply(this, arguments), {
                widgetName: "",
                baseCls: "",
                customCls: null,
                enable: !0,
                visible: !0,
                invalidateType: FX.CONST.INVALID_TYPE.BLANK
            })
        },
        _init: function() {
            FX.Widget.superclass._init.apply(this, arguments),
                this._initRoot(),
                this._initNameEffects()
        },
        _afterInit: function() {
            this._initElementSize(),
                this._initVisualEffects(),
                this._initDefaultValue(),
                FX.Widget.superclass._afterInit.apply(this, arguments)
        },
        _initRoot: function() {
            var t = this.options;
            this.xtype && (t.type = this.xtype),
                null != t.renderEl ? this.element = $(t.renderEl) : this.element = this._defaultRoot(),
            t.baseCls && this.element.addClass(t.baseCls),
            t.customCls && this.element.addClass(t.customCls)
        },
        _initNameEffects: function() {
            var t = this.options;
            t.widgetName || (t.widgetName = "_widget_" + FX.STATIC.IDBase++),
                this.element.attr({
                    widgetName: t.widgetName
                })
        },
        _initElementSize: function() {
            this.doResize()
        },
        _initVisualEffects: function() {
            this.setEnable(this.options.enable),
                this.setVisible(this.options.visible)
        },
        _initDefaultValue: function() {
            var t = this.options;
            null != t.value ? this.setValue(t.value) : null != t.text && this.setText(t.text)
        },
        _defaultRoot: function() {
            return $("<div/>")
        },
        getWidgetByName: function(t) {
            return this.options.resultWidgets ? this.options.resultWidgets[t] : null
        },
        getWidgetName: function() {
            return this.options.widgetName
        },
        getWidgetType: function() {
            return this.options.type
        },
        getText: function() {
            return this.options.text
        },
        setText: function(t) {
            this.options.text = t
        },
        getValue: function() {
            return this.options.value
        },
        setValue: function(t) {
            this.options.value = t
        },
        isEnabled: function() {
            return this.options.enable
        },
        setEnable: function(t) {
            this.options.enable = !!t,
                !0 === this.options.enable ? this.element.removeClass("x-ui-disable") : this.element.addClass("x-ui-disable")
        },
        isVisible: function() {
            return this.options.visible
        },
        setVisible: function(t) {
            this.options.visible = !!t,
                !0 === this.options.visible ? this.element.removeClass("x-ui-hidden") : this.element.addClass("x-ui-hidden")
        },
        reset: function() {
            this.setValue(null)
        },
        doResize: function(t) {
            var e = this.options;
            t && (e.width = t.width,
                e.height = t.height),
            FX.Utils.isEmpty(e.width) || this.element.css({
                width: e.width
            }),
            FX.Utils.isEmpty(e.height) || this.element.css({
                height: e.height
            })
        },
        destroy: function() {
            this.element.remove()
        },
        rebuild: function() {
            this.options.renderEl = this.element,
                this.element.empty(),
                this._beforeInit(),
                this._init(),
                this._afterInit()
        },
        checkValidate: function() {
            return !0
        },
        fireEvent: function(t, e) {
            this.element.trigger(t, e)
        },
        getOptions: function(t) {
            var e = this.options;
            return {
                type: e.type,
                widgetName: e.widgetName,
                height: e.height,
                width: e.width,
                value: e.value,
                enable: e.enable,
                visible: e.visible,
                allowBlank: e.allowBlank,
                rely: e.rely
            }
        },
        getInvalidateType: function() {
            return this.options.invalidateType
        },
        setInvalidateType: function(t) {
            this.options.invalidateType = t
        },
        getNullValue: function() {
            return null
        },
        getLinkValue: function() {
            return this.getValue()
        },
        getLinkType: function() {
            return this.getWidgetType()
        },
        getCacheValue: function() {
            return this.getValue()
        },
        setCacheValue: function(t) {
            this.setValue(t)
        },
        bindWidgetEvent: function(t, e) {
            this.options[t] = e
        },
        unbindWidgetEvent: function(t) {
            this.options[t] = null
        }
    }),
    function(d) {
        FX.RelyProcessor = function(t) {
            this.options = {
                defaultVersion: 0,
                version: 0,
                versionMap: {},
                stateMap: {},
                asyncMap: {},
                asyncLimit: 3,
                defaults: [],
                relyMap: {},
                linkMap: {}
            },
                this._init(t)
        }
            ,
            d.extend(FX.RelyProcessor.prototype, {
                RELY_END: -1,
                DEFAULT_RELY_VERSION: 1,
                _init: function(t) {
                    var e = this.options;
                    e.relyMap = this._getRelyWidgetsMap(t),
                        e.linkMap = this._getLinkMap(e.relyMap),
                        e.errorMap = {},
                    0 < e.asyncLimit && (e.asyncConcurrentQue = [],
                        e.asyncTodoQue = [])
                },
                _getLinkMap: function(t) {
                    var a = this
                        , n = {};
                    return FX.Utils.forEach(t, function(i, t) {
                        FX.Utils.forEach(t, function(t, e) {
                            a._add2LinkMap(n, e, i)
                        })
                    }),
                        n
                },
                _add2LinkMap: function(t, e, i) {
                    var a;
                    return t[e] || (t[e] = []),
                        t[e].push(i),
                    /\./.test(e) && !/\./.test(i) && (a = e.split(".")[0],
                        this._add2LinkMap(t, a, i)),
                        t
                },
                _getRelyWidgetsMap: function(t) {
                    var s = this
                        , r = {};
                    return FX.Utils.forEach(t, function(t, e) {
                        var i, a, n = e.widget;
                        n && "linkdata" !== n.type && ("subform" === n.type && (i = s._getRelyWidgetsMap(n.items),
                            FX.Utils.forEach(i, function(t, e) {
                                var i = [n.widgetName, t].join(".");
                                n.rely && n.rely.widgets && e.push(n.widgetName),
                                    r[i] = FX.Utils.uniq(e)
                            })),
                        (a = n.rely) && a.widgets && (r[n.widgetName] = [].concat(a.widgets)))
                    }),
                        r
                },
                _isSubformWidget: function(t) {
                    return /\./.test(t)
                },
                _getVersion: function(t, e) {
                    var i = this.options
                        , a = i.versionMap[t] || i.defaultVersion;
                    return -1 < e && this._isSubformWidget(t) && (a = Math.max(a, i.versionMap[t + e] || i.defaultVersion)),
                        a
                },
                _getState: function(t, e) {
                    var i = this.options
                        , a = i.stateMap[t] || i.defaultVersion;
                    return -1 < e && this._isSubformWidget(t) && (a = Math.max(a, i.stateMap[t + e] || i.defaultVersion)),
                        a
                },
                _getAsync: function(t, e) {
                    var i = this.options;
                    return -1 < e && this._isSubformWidget(t) ? i.asyncMap[t] && i.asyncMap[t][e] : i.asyncMap[t]
                },
                _fireNextRely: function(a, n, s, r) {
                    var o = this
                        , t = this.options;
                    this.setAsyncMap(s, a, r);
                    var e = t.linkMap[s];
                    FX.Utils.forEach(e, function(t, e) {
                        var i;
                        a < o._getState(e, r) || o._checkRely(n, a, e, r) && ((i = n.getWidgetByName(e, r)) ? (o.setAsyncMap(e, !1, r),
                            o.startRely(n, s, i, a, [])) : o._fireNextRely(a, n, e, r))
                    })
                },
                getRelyVersion: function(i, a, n, s, r) {
                    var o = this
                        , l = FX.Utils.isNull(r);
                    return r = r || {},
                    this._isSubformWidget(a) || (n = -1),
                        FX.Utils.forEach(i[a], function(t, e) {
                            r[e] || r[e + n] || l && o._isSubformWidget(e) && e.split(".")[0] === a || (-1 < n && o._isSubformWidget(e) ? r[e + n] = s : r[e] = s,
                                o.getRelyVersion(i, e, n, s, r))
                        }),
                        r
                },
                checkAsyncState: function(a) {
                    var e = this
                        , n = this.options
                        , s = !0
                        , r = [];
                    return FX.Utils.forEach(n.asyncMap, function(i) {
                        var t = n.asyncMap[i];
                        if (e._isSubformWidget(i) ? FX.Utils.forEach(t, function(t, e) {
                            if (a.getWidgetByName(i, t) && !1 === e)
                                return s = !1,
                                    r.push(t),
                                    !1
                        }) : s = !1 !== t,
                            !s)
                            return !1
                    }),
                    s || (n.asyncConcurrentQue.length >= n.asyncLimit ? r.unshift(1) : r.unshift(0),
                        n.asyncTodoQue.length ? r.unshift(1) : r.unshift(0),
                        console.log("error: " + r.join(""))),
                        s
                },
                setStateMap: function(t, e, i) {
                    var a = this.options;
                    -1 < i && this._isSubformWidget(t) ? a.stateMap[t + i] = e : a.stateMap[t] = e
                },
                setErrorMap: function(t, e, i) {
                    var a = this.options;
                    a.errorMap.hasOwnProperty(e) && t && delete a.errorMap[e],
                    t || (a.errorMap[e] = i)
                },
                getErrorMap: function() {
                    return this.options.errorMap
                },
                setAsyncMap: function(t, e, i) {
                    var a = this.options;
                    -1 < i && this._isSubformWidget(t) ? (a.asyncMap[t] = a.asyncMap[t] || {},
                        a.asyncMap[t][i] = e) : a.asyncMap[t] = e
                },
                addDefaultRely: function(t, e) {
                    !e && FX.Utils.isObjectEmpty(t.getOptionValue()) || this.options.defaults.push(t)
                },
                getDefaultRely: function() {
                    return this.options.defaults
                },
                _checkRely: function(s, r, o, l) {
                    var c = this
                        , d = this.options
                        , u = !0;
                    return FX.Utils.forEach(d.relyMap[o], function(t, e) {
                        if (c._isSubformWidget(e) && !c._isSubformWidget(o)) {
                            var i = e.split(".")[0];
                            r === c._getVersion(i) && (u = c._getAsync(i) === r);
                            var a = null
                                , n = 0;
                            do {
                                if (a = s.getWidgetByName(e, n))
                                    if (r === c._getVersion(e, n)) {
                                        if (c._getAsync(e, n) !== r) {
                                            u = !1;
                                            break
                                        }
                                    } else if (c._getVersion(e, n)) {
                                        if (!(c._getState(e, n) === d.defaultVersion || c._getAsync(e, n) >= c._getVersion(e, n))) {
                                            u = !1;
                                            break
                                        }
                                        u = !0
                                    }
                                n++
                            } while (a)
                        } else
                            !1 === c._getAsync(e, l) ? u = !1 : r === c._getVersion(e, l) ? u = c._getAsync(e, l) === r : c._getVersion(e, l) && (u = c._getAsync(e, l) >= c._getVersion(e, l));
                        if (!u)
                            return !1
                    }),
                    u && (this._getState(o, l) === r ? u = !1 : this.setStateMap(o, r, l)),
                        u
                },
                fireDefaultRely: function(i, t, a) {
                    var n = this.options
                        , s = this;
                    n.version++;
                    var r = n.version;
                    FX.Utils.forEach(t, function(t, e) {
                        var i = e.getWidgetName();
                        e.isSubformWidget() && (i = [e.getSubformName(), i].join(".")),
                            d.extend(n.versionMap, s.getRelyVersion(n.linkMap, i, a, r))
                    }),
                        FX.Utils.forEach(t, function(t, e) {
                            s.fireRely(e, r, i)
                        })
                },
                fireRely: function(t, n, s) {
                    var e = this.options
                        , r = this
                        , o = -1
                        , i = t.getWidgetName();
                    t.isSubformWidget() && (i = [t.getSubformName(), i].join("."),
                        o = FX.Utils.getSubformRowIdx(t));
                    var a, l, c = e.linkMap[i];
                    switch (n ? (this.finishRely(t, i, o),
                        n = Math.max(n, this._getVersion(i, o))) : (e.version++,
                        n = e.version,
                        d.extend(e.versionMap, this.getRelyVersion(e.linkMap, i, o, n)),
                        this.setStateMap(i, n, o),
                        this.checkAsyncQue(n),
                    "subform" === t.getWidgetType() && (a = [],
                        FX.Utils.forEach(c, function(t, e) {
                            r._isSubformWidget(e) && e.split(".")[0] === i || a.push(e)
                        }),
                        c = a)),
                        this.setAsyncMap(i, n, o),
                        t.getWidgetType()) {
                        case "user":
                        case "usergroup":
                            l = t.getValue();
                            break;
                        default:
                            l = t.getLinkValue()
                    }
                    FX.Utils.forEach(c, function(t, e) {
                        var i;
                        if (!(n < r._getState(e, o)))
                            if (r._isSubformWidget(e) && o < 0) {
                                var a = 0;
                                do {
                                    if (!r._checkRely(s, n, e, a))
                                        return;
                                    (i = s.getWidgetByName(e, a)) ? (r.setAsyncMap(e, !1, a),
                                        r.startRely(s, e, i, n, l, a)) : 0 === a && r._fireNextRely(n, s, e, a),
                                        a++
                                } while (i)
                            } else {
                                if (!r._checkRely(s, n, e, o))
                                    return;
                                if (!(i = s.getWidgetByName(e, o)))
                                    return void r._fireNextRely(n, s, e, o);
                                r.setAsyncMap(e, !1, o),
                                    r.startRely(s, e, i, n, l, o)
                            }
                    })
                },
                checkAsyncQue: function(i) {
                    var a = this
                        , t = this.options
                        , n = [];
                    FX.Utils.forEach(t.asyncConcurrentQue, function(t, e) {
                        a._getVersion(e.widgetName, e.row) !== i && n.push(e)
                    }),
                        t.asyncConcurrentQue = n;
                    var s = [];
                    FX.Utils.forEach(t.asyncTodoQue, function(t, e) {
                        e.version < a._getVersion(e.widgetName, e.row) || s.push(e)
                    }),
                        t.asyncTodoQue = s
                },
                finishRely: function(t, i, a) {
                    var e, n, s, r = this.options;
                    t && t.getRely && ((e = t.getRely()) && e.ref && e.data && (a = -1 < a ? a : -1,
                        n = -1,
                        FX.Utils.forEach(r.asyncConcurrentQue, function(t, e) {
                            if (e.widgetName === i && e.row === a)
                                return n = t,
                                    !1
                        }),
                    -1 < n && (r.asyncConcurrentQue.splice(n, 1),
                    (s = r.asyncTodoQue.shift()) && this.startRely(s.form, s.widgetName, s.widget, s.version, s.linkValue, s.row))))
                },
                releaseAsyncQue: function(t) {
                    var e = -1
                        , i = t.getWidgetName();
                    t.isSubformWidget() && (i = [t.getSubformName(), i].join("."),
                        e = FX.Utils.getSubformRowIdx(t)),
                        this.finishRely(t, i, e)
                },
                startRely: function(t, e, i, a, n, s) {
                    var r, o = this.options;
                    i && i.getRely && ((r = i.getRely()) && r.ref && r.data ? o.asyncConcurrentQue.length < o.asyncLimit ? (o.asyncConcurrentQue.push({
                        widgetName: e,
                        row: -1 < s ? s : -1
                    }),
                        t.dealRely(e, i, a, n)) : o.asyncTodoQue.push({
                        form: t,
                        widgetName: e,
                        widget: i,
                        version: a,
                        linkValue: n,
                        row: s
                    }) : t.dealRely(e, i, a, n))
                },
                checkAsyncVersion: function(t, e) {
                    var i = -1
                        , a = t.getWidgetName();
                    return t.isSubformWidget() && (a = [t.getSubformName(), a].join("."),
                        i = FX.Utils.getSubformRowIdx(t)),
                    this._getState(a, i) <= e
                }
            })
    }(jQuery),
    FX.FormEvent = function(t) {
        this.eventMap = {},
            this.versionMap = {},
            this.errorMap = {},
            this.asyncMap = {},
            this.version = 0,
            this.API = t.API,
            this.ajaxData = {
                appId: t.appId,
                entryId: t.entryId,
                formId: t.formId,
                dataId: t.dataId
            },
            this._init(t.events)
    }
    ,
    $.extend(FX.FormEvent.prototype, {
        _init: function(t) {
            var i = this;
            FX.Utils.forEach(t, function(t, e) {
                e.enabled && (i.eventMap[e.trigger] ? i.eventMap[e.trigger].push(e) : i.eventMap[e.trigger] = [e])
            })
        },
        triggerEvent: function(t, a, n) {
            var s, r = this, e = this.eventMap[t];
            e && (this.version++,
                s = this.version,
                FX.Utils.forEach(e, function(t, e) {
                    var i = a([].concat(e.request_rely, e.action_rely));
                    r.versionMap[e.id] = s,
                        r.setAsyncMap(e.id, !1),
                        FX.Utils.ajax({
                            url: FX.Utils.getApi(r.API.data.form_event_trigger),
                            data: $.extend({
                                form_event: {
                                    id: e.id,
                                    rely: i
                                }
                            }, r.ajaxData)
                        }, function(t) {
                            r.setAsyncMap(e.id, s),
                            s === r.versionMap[e.id] && (n(t, s),
                            r.errorMap[e.id] && delete r.errorMap[e.id])
                        }, function(t) {
                            r.errorMap[e.id] = t
                        })
                }))
        },
        checkCondition: function(t, i) {
            var a = !0;
            return FX.Utils.forEach(t, function(t, e) {
                if (i([e.field])[e.field] !== e.value)
                    return a = !1
            }),
                a
        },
        checkError: function() {
            return FX.Utils.isObjectEmpty(this.errorMap)
        },
        setAsyncMap: function(t, e) {
            this.asyncMap[t] = e
        },
        checkAsyncState: function() {
            var i = !0;
            return FX.Utils.forEach(this.asyncMap, function(t, e) {
                if (!1 === e && (i = !1),
                    !i)
                    return !1
            }),
                i
        }
    }),
    FX.AssociationProcessor = function(t) {
        this.associationMap = {},
            this.relyMap = {},
            this._init(t)
    }
    ,
    $.extend(FX.AssociationProcessor.prototype, {
        VISIBLE: 1,
        INVISIBLE: 0,
        _init: function(t) {
            this.associationMap = this._getAssociationMap(t),
                this.relyMap = this._getRelyWidgetsMap(this.associationMap)
        },
        _getAssociationMap: function(t) {
            var a = this
                , n = {};
            return FX.Utils.forEach(t, function(t, e) {
                var i;
                e.widget && a._hasContactWidgets(e.widget) && (i = a._getAssociateWidgets(e.widget),
                FX.Utils.isObjectEmpty(i) || (n[e.widget.widgetName] = i))
            }),
                n
        },
        _getAssociateWidgets: function(t) {
            var a = this
                , n = {};
            return FX.Utils.forEach(t.items, function(t, i) {
                i.widgetsMap && FX.Utils.forEach(i.widgetsMap, function(t, e) {
                    i.selected ? n[e] = a.VISIBLE : n[e] = n[e] || a.INVISIBLE
                })
            }),
                n
        },
        _hasContactWidgets: function(t) {
            return t && ("combo" === t.type || "radiogroup" === t.type) && !t.async
        },
        _getRelyWidgetsMap: function(t) {
            var a = {};
            return FX.Utils.forEach(t, function(i, t) {
                FX.Utils.forEach(t, function(t, e) {
                    a[t] = a[t] || {},
                        a[t][i] = e
                })
            }),
                a
        },
        getVisibleMap: function() {
            var a = {};
            return FX.Utils.forEach(this.relyMap, function(i, t) {
                a[i] = !1,
                    FX.Utils.forEach(t, function(t, e) {
                        if (e)
                            return !(a[i] = !0)
                    })
            }),
                a
        },
        dealAssociation: function(e, i) {
            var a = this;
            FX.Utils.forEach(this.associationMap[e], function(t) {
                a.associationMap[e][t] = -1 < i.indexOf(t) ? a.VISIBLE : a.INVISIBLE
            }),
                this.relyMap = this._getRelyWidgetsMap(this.associationMap);
            var n = {};
            return FX.Utils.forEach(this.associationMap[e], function(i) {
                n[i] = !1,
                    FX.Utils.forEach(a.relyMap[i], function(t, e) {
                        if (e)
                            return !(n[i] = !0)
                    })
            }),
                n
        }
    }),
    function() {
        FX.Store = FX.Store || {},
            $.extend(FX.Store, {
                expireTime: 864e5,
                set: function(t, e) {},
                get: function(t, e) {},
                has: function(t) {
                    return void 0 !== this.get(t)
                },
                remove: function(t) {},
                clear: function() {},
                transact: function(t, e, i) {
                    null == i && (i = e,
                        e = null),
                    null == e && (e = {});
                    var a = this.get(t, e);
                    i(a),
                        this.set(t, a)
                },
                getAll: function() {
                    var i = {};
                    return this.forEach(function(t, e) {
                        i[t] = e
                    }),
                        i
                },
                forEach: function() {},
                serialize: function(t) {
                    return JSON.stringify(t)
                },
                deserialize: function(e) {
                    if ("string" == typeof e)
                        try {
                            return JSON.parse(e)
                        } catch (t) {
                            return e || void 0
                        }
                },
                getKey: function(t, e) {
                    var i = "";
                    switch (t) {
                        case "paramFields":
                        case "showFields":
                        case "metaFields":
                        case "formDataShowFields":
                            i = [t, e.appId, e.entryId, e.groupId].join("");
                            break;
                        case "dashShowFields":
                            i = [t, e.appId, e.entryId, e.widgetId].join("");
                            break;
                        case "qrStyle":
                        case "authGroup":
                        case "printPreviewPermission":
                            i = [t, e.appId, e.entryId].join("");
                            break;
                        case "formData":
                        case "submitFormData":
                        case "saveContentCheck":
                            i = FX.CorpUser.isUserExist() && !FX.STATIC.FTOKEN ? [t, e.appId, e.entryId, FX.CorpUser.getUserId()].join("") : [t, e.appId, e.entryId].join("");
                            break;
                        case "filterValue":
                        case "itemsPerPage":
                            i = [t, e.appId, e.entryId, e.groupId, e.ext].join("");
                            break;
                        case "triggerExpand":
                            i = [t, e.appId, e.triggerId].join("");
                            break;
                        case "filterSticky":
                        case "formTheme":
                            i = t;
                            break;
                        case "colSizeMap":
                            i = [t, e.appId, e.entryId, e.widgetId].join("");
                            break;
                        case "formDesign":
                        case "dashEdit":
                            i = [t, e.appId, e.entryId].join("");
                            break;
                        case "dashColors":
                        case "optionCustomColors":
                            i = [t, e.userId].join("")
                    }
                    return i
                }
            });
        var t = "undefined" != typeof window ? window : global
            , e = "localStorage";
        !function() {
            try {
                return e in t && t[e]
            } catch (t) {
                return
            }
        }() || $.extend(FX.Store, {
            storage: t[e],
            set: function(t, e, i) {
                if (void 0 === e)
                    return this.remove(t);
                i && (e = {
                    data: e,
                    expire: +new Date + this.expireTime * i
                });
                try {
                    this.storage.setItem(t, this.serialize(e))
                } catch (t) {
                    return void this.clear(!0)
                }
                return e
            },
            get: function(t, e) {
                var i = this.deserialize(this.storage.getItem(t));
                return i && i.expire && (i = i.data),
                    void 0 === i ? e : i
            },
            remove: function(t) {
                this.storage.removeItem(t)
            },
            clear: function(t) {
                var i, a = this;
                t ? (i = +new Date,
                    this.forEach(function(t, e) {
                        e && e.expire && i > e.expire && a.remove(t)
                    })) : this.storage.clear()
            },
            forEach: function(t) {
                for (var e = 0; e < this.storage.length; e++) {
                    var i = this.storage.key(e);
                    t(i, this.deserialize(this.storage.getItem(i)))
                }
            }
        })
    }(),
    function(o) {
        FX.UI = {
            showPopover: function(t) {
                var e = o('<div class="x-ui-popover"/>').appendTo("body")
                    , i = o.extend({
                    anchor: null,
                    position: "top",
                    content: null,
                    maxWidth: null,
                    animation: !0,
                    delay: null,
                    type: "light",
                    edge: 8,
                    customCls: null
                }, t);
                i.customCls && e.addClass(i.customCls),
                i.maxWidth && e.css({
                    "max-width": i.maxWidth
                }),
                i.type && e.addClass(i.type),
                i.animation && e.addClass("animation"),
                i.content && i.content.appendTo(e);
                var a = i.anchor
                    , n = a.offset()
                    , s = {
                    "z-Index": FX.STATIC.zIndex++
                }
                    , r = n.top - o("body").offset().top;
                switch (i.position) {
                    case "topLeft":
                        e.addClass("top top-left"),
                            s.left = Math.max(n.left + a.outerWidth() / 2 - 30, i.edge / 2),
                            s.bottom = document.body.clientHeight - r + i.edge;
                        break;
                    case "top":
                        e.addClass("top"),
                            s.left = Math.max(n.left + a.outerWidth() / 2 - e.outerWidth() / 2, i.edge / 2),
                            s.bottom = document.body.clientHeight - r + i.edge;
                        break;
                    case "topRight":
                        e.addClass("top top-right"),
                            s.right = Math.max(document.body.clientWidth - n.left - a.outerWidth() / 2 - 30, i.edge / 2),
                            s.bottom = document.body.clientHeight - r + i.edge;
                        break;
                    case "bottomLeft":
                        e.addClass("bottom"),
                            s.left = Math.max(n.left + a.outerWidth() / 2 - e.outerWidth() / 2, i.edge / 2),
                            s.top = r + a.height() + i.edge;
                        break;
                    case "bottomRight":
                        e.addClass("bottom"),
                            s.right = Math.max(document.body.clientWidth - n.left - a.outerWidth() / 2 - e.outerWidth() / 2, i.edge / 2),
                            s.top = r + a.height() + i.edge;
                        break;
                    case "rightTop":
                        e.addClass("right"),
                            s.right = Math.max(document.body.clientWidth - n.left - a.width() - e.outerWidth() - i.edge, i.edge / 2),
                            s.bottom = Math.max(document.body.clientHeight - r - a.height() / 2 - e.outerHeight() / 2, i.edge / 2);
                        break;
                    case "rightTopBaseline":
                        e.addClass("right baseline-right"),
                            s.right = Math.max(document.body.clientWidth - n.left - a.width() - e.outerWidth() - i.edge, i.edge / 2),
                            s.bottom = Math.max(document.body.clientHeight - r - e.outerHeight(), i.edge / 2);
                        break;
                    case "rightBottom":
                        e.addClass("right"),
                            s.right = Math.max(document.body.clientWidth - n.left - a.width() - e.outerWidth() - i.edge, i.edge / 2),
                            s.top = Math.max(r + a.height() / 2 - e.outerHeight() / 2, i.edge / 2);
                        break;
                    case "leftTop":
                        e.addClass("left"),
                            s.left = Math.max(n.left - e.outerWidth() - i.edge, i.edge / 2),
                            s.bottom = Math.max(document.body.clientHeight - r - a.height() / 2 - e.outerHeight() / 2, i.edge / 2);
                        break;
                    case "leftBottom":
                        e.addClass("left"),
                            s.left = Math.max(n.left - e.outerWidth() - i.edge, i.edge / 2),
                            s.top = Math.max(r + a.height() / 2 - e.outerHeight() / 2, i.edge / 2)
                }
                return e.css(s),
                    i.delay ? setTimeout(function() {
                        e.addClass("fadein")
                    }, 1e3 * i.delay) : e.addClass("fadein"),
                    e
            },
            closePopover: function() {
                var t = o(".x-ui-popover");
                0 < t.length && (t.remove(),
                    t = null)
            },
            shareUrl: function(t) {
                var e = o.extend({
                    url: "",
                    title: "",
                    subTitle: "",
                    hasCopy: !0,
                    hasOpen: !0,
                    hasQrcode: !0
                }, t)
                    , i = o('<div class="share-link-content"/>');
                new FX.ShareUrlPane({
                    renderEl: o("<div/>").appendTo(i),
                    url: e.url,
                    hasCopy: e.hasCopy,
                    hasOpen: e.hasOpen,
                    hasQrcode: e.hasQrcode,
                    qrcodeName: e.qrcodeName
                }),
                    new FX.Dialog({
                        title: e.title,
                        subTitle: e.subTitle,
                        customCls: "share-link-dialog",
                        width: 600,
                        contentWidget: {
                            rowSize: [90],
                            colSize: [600],
                            items: [[i]]
                        }
                    }).show()
            },
            showSaveConfirm: function(t) {
                var e = this
                    , i = o.extend({
                    key: "",
                    onSave: null,
                    onCancel: null,
                    onBack: null
                }, t)
                    , a = i18next.t("saveInfo.saveTitle", {
                    key: i.key
                })
                    , n = i18next.t("saveInfo.saveMsg", {
                    key: i.key
                })
                    , s = o("<a/>").text(i18next.t("backTo") + i.key).click(function() {
                    FX.Utils.applyFunc(e, i.onBack, [], !1),
                        r.close()
                })
                    , r = FX.Msg.alert({
                    title: a,
                    msg: n,
                    tip: s,
                    type: "query",
                    text4Ok: i18next.t("saveInfo.save"),
                    text4Cancel: i18next.t("saveInfo.cancel"),
                    onOk: function() {
                        r.close(),
                            FX.Utils.applyFunc(e, i.onSave, [], !1)
                    },
                    onCancel: function() {
                        r.close(),
                            FX.Utils.applyFunc(e, i.onCancel, [], !1)
                    }
                })
            },
            showConfigErrConfirm: function(t) {
                var e = this
                    , i = o.extend({
                    key: "",
                    onSave: null,
                    onCancel: null,
                    onBack: null
                }, t)
                    , a = i18next.t("errInfo.saveTitle")
                    , n = i18next.t("errInfo.saveMsg")
                    , s = FX.Msg.alert({
                    title: a,
                    msg: n,
                    type: "query",
                    text4Ok: i18next.t(i18next.t("backTo") + i.key),
                    text4Cancel: i18next.t("errInfo.ignore"),
                    onOk: function() {
                        s.close(),
                            FX.Utils.applyFunc(e, i.onSave, [], !1)
                    },
                    onCancel: function() {
                        s.close(),
                            FX.Utils.applyFunc(e, i.onCancel, [], !1)
                    }
                })
            },
            inviteGuide: function(t) {
                var e = new FX.Dialog({
                    width: 487,
                    height: 200,
                    title: "",
                    style4Header: "white",
                    customCls: "invite-guide-dialog",
                    contentWidget: {
                        type: "inviteguidepane",
                        msgType: t,
                        onClose: function() {
                            e.close()
                        }
                    }
                });
                e.show()
            },
            showGetTrialAlert: function() {
                var t = "";
                switch (FX.Utils.getCorpType(FX.CorpUser.getCurrentCorpId())) {
                    case "wechat":
                        t = i18next.t("vip.trial.wechatTip");
                        break;
                    case "dingtalk":
                        t = i18next.t("vip.trial.dingtalkTip");
                        break;
                    default:
                        t = i18next.t("vip.trial.tip")
                }
                FX.Msg.alert({
                    type: "warning",
                    title: i18next.t("vip.trial.error.title"),
                    msg: t,
                    text4Ok: null,
                    text4Cancel: i18next.t("iSee")
                })
            },
            showTestWebhookServerDialog: function(t, e, a) {
                var i = o.extend({
                    webhook: {}
                }, t)
                    , n = new FX.Dialog({
                    height: 214,
                    width: 478,
                    style4Header: "white",
                    customCls: "fui-server-test-dialog",
                    onContentCreate: function(t) {
                        t.append('<div class="test-state"><div class="state-icon pending"><i class="icon-server"/></div><div class="state-text">' + i18next.t("data.api.server.connecting") + "</div></div>")
                    }
                });
                n.show(),
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.web_hook.test),
                        data: {
                            webhook: i.webhook
                        }
                    }, function(i) {
                        "success" === i.status ? (n.rebuildContent({
                            onContentCreate: function(t) {
                                t.append('<div class="test-state"><div class="state-icon success"><i class="icon-select"/></div><div class="state-text">' + i18next.t("data.api.server.connectSuccess") + "</div></div>")
                            }
                        }),
                        e && e()) : (n.element.addClass("test-fail-dialog"),
                            n.rebuildHeader({
                                title: i18next.t("data.api.fail"),
                                style4Header: "align-left"
                            }),
                            n.rebuildContent({
                                width: 600,
                                height: 500,
                                onContentCreate: function(t) {
                                    var e = FX.Utils.date2Str(new Date(1e3 * i.timestamp), "yyyy-MM-dd HH:mm:ss");
                                    t.append('<div class="webhook-error-detail"><div class="title">' + i18next.t("data.api.code") + '</div><div class="content error">' + (i.statusCode || "") + '</div><div class="title">' + i18next.t("data.api.logTime") + '</div><div class="content">' + e + '</div><div class="title">' + i18next.t("fail.detail") + '</div><div class="content"><pre><code>' + (i.failInfo || "") + "</code></pre></div></div>")
                                }
                            }),
                        a && a())
                    })
            }
        }
    }(jQuery),
    function(a) {
        FX.CorpUserInfo = function(t, e, i) {
            this.initConfig(t, e, i)
        }
            ,
            a.extend(FX.CorpUserInfo.prototype, {
                isUserExist: function() {
                    return !FX.Utils.isObjectEmpty(this.user)
                },
                isMemberExist: function() {
                    return !FX.Utils.isObjectEmpty(this.member)
                },
                isCurrentCorpExist: function() {
                    return !FX.Utils.isObjectEmpty(this.corp)
                },
                isUserLoginfromSSO: function() {
                    return "sso" === this.getUserLoginType()
                },
                getUserGuide: function() {
                    return this.user.guide || {}
                },
                getUserLoginType: function() {
                    return this.user.login_type
                },
                getUserId: function() {
                    return this.user._id
                },
                getUsername: function() {
                    return this.user.username
                },
                getUserNickname: function() {
                    return this.user.nickname
                },
                getUserCorpId: function() {
                    return this.user.corp_id
                },
                getUserCorpType: function() {
                    return this.user.corp_type
                },
                getUserVip: function() {
                    return this.user.vip
                },
                getUserVipService: function() {
                    return this.user.vip_service
                },
                getCorpVipService: function() {
                    return this.corp.vip_service
                },
                getCorpVip: function() {
                    return this.corp.vip
                },
                getUserLocale: function() {
                    return this.user.locale
                },
                getUserRegTime: function() {
                    return this.user.reg_time
                },
                getMemberId: function() {
                    return this.member.member_id
                },
                getMemberUsername: function() {
                    return this.member.username
                },
                getMemberNickname: function() {
                    return this.member.nickname
                },
                getMemberAvatar: function() {
                    return this.member.avatar
                },
                isSyncMember: function() {
                    return this.member.is_sync_user
                },
                isSysAdmin: function() {
                    return this.member.is_admin
                },
                isCorpManager: function() {
                    return this.member.is_corp_manager
                },
                isAdmin: function() {
                    return this.member.is_corp_manager || this.member.is_admin
                },
                isCorpOwner: function() {
                    return this.member.is_owner
                },
                isIntegratedCorpType: function() {
                    return "internal" !== this.corp.corp_type
                },
                hasTeamPermission: function() {
                    return this.member.has_team_permission
                },
                getCurrentCorpId: function() {
                    return this.corp.corp_id
                },
                getCurrentCorpName: function() {
                    return this.corp.name
                },
                getCurrentCorpOwner: function() {
                    return this.corp.owner
                },
                getCurrentCorpType: function() {
                    return this.corp.corp_type
                },
                allowMemberModifyName: function() {
                    return this.corp.has_name_modify
                },
                getCorpOwnerId: function() {
                    return this.corp.owner_id
                },
                hasKMS: function() {
                    return this.corp.beta_functions && this.corp.beta_functions.has_kms
                },
                isMarkedMobileUser: function() {
                    return this.user.isMarkedMobileUser
                },
                isKMSEnabled: function() {
                    return this.corp.modules && this.corp.modules.kms
                },
                setKMSEnable: function() {
                    var t = this;
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.corp.modules_kms_enable, FX.CorpUser.getCurrentCorpId())
                    }, function() {
                        t.corp.beta_functions = t.corp.beta_functions || {},
                            a.extend(t.corp.beta_functions, {
                                enable_kms: !0
                            }),
                            a.extend(t.corp.modules, {
                                kms: !0
                            })
                    })
                },
                setKMSDisable: function() {
                    var t = this;
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.corp.modules_kms_disable, FX.CorpUser.getCurrentCorpId())
                    }, function() {
                        t.corp.beta_functions = t.corp.beta_functions || {},
                            a.extend(t.corp.beta_functions, {
                                enable_kms: !1
                            }),
                            a.extend(t.corp.modules, {
                                kms: !1
                            })
                    })
                },
                hasKMSEnableEntry: function() {
                    return !!this.isSysAdmin() && this.hasKMS()
                },
                getUser: function() {
                    return this.user
                },
                getMember: function() {
                    return this.member
                },
                getCurrentCorp: function() {
                    return this.corp
                },
                initConfig: function(t, e, i) {
                    this.user = a.extend({}, t),
                        this.corp = a.extend({}, e),
                        this.member = a.extend({}, i)
                },
                updateConfig: function(t, e, i) {
                    a.extend(this.user, t),
                        a.extend(this.corp, e),
                        a.extend(this.member, i)
                },
                createCorp: function(e) {
                    var i = this
                        , a = FX.Msg.prompt({
                        title: i18next.t("corp.create"),
                        waterMark: i18next.t("corp.name.placeholder"),
                        input: i18next.t("corp.name", {
                            user: FX.CorpUser.getUserNickname()
                        }),
                        onOk: function(t) {
                            return 0 === t.length ? (a.setState(FX.States.ERROR),
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: i18next.t("corp.name.notEmpty")
                                })) : 50 < t.length ? (a.setState(FX.States.ERROR),
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: i18next.t("corp.name.tooLong", {
                                        length: "50"
                                    })
                                })) : FX.Utils.ajax({
                                url: FX.Utils.getApi(FX.API.manager.create),
                                data: {
                                    name: t
                                }
                            }, function(t) {
                                a.close(),
                                    i.initConfig(t.userInfo, t.corpInfo, t.memberInfo),
                                    FX.Utils.applyFunc(i, e, [], !1)
                            }),
                                !1
                        }
                    })
                },
                switchCorp: function(t, e) {
                    var i = this;
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.app.switch_corp),
                        data: {
                            target: t
                        }
                    }, function(t) {
                        i.initConfig(i.getUser(), t.corpInfo, t.memberInfo),
                            FX.Utils.applyFunc(i, e, [], !1)
                    })
                },
                getReportLegacyStatus: function() {
                    return this.corp.legacy_report_status
                }
            })
    }(jQuery),
    function(i) {
        FX.Vip = {
            _getVip: function() {
                if (!FX.STATIC.VIP_PACK) {
                    if (!FX.STATIC.APPID)
                        return {};
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(FX.API.app.get_vip_pack, FX.STATIC.APPID),
                        async: !1
                    }, function(t) {
                        FX.STATIC.VIP_PACK = i.extend({}, t)
                    }, function() {
                        FX.STATIC.VIP_PACK = {}
                    })
                }
                return FX.STATIC.VIP_PACK
            },
            _getPack: function() {
                var t = this._getVip();
                return t && t.vipPack || {}
            },
            _isAppInTrial: function() {
                var t = this._getVip();
                return t && t.isAppInTrial
            },
            clear: function() {
                FX.STATIC.VIP_PACK = null
            },
            _getUpgradeActionConfig: function(t) {
                var e, i, a = {
                    onOk: function() {
                        return FX.Utils.redirectTo(FX.Utils.getApi(FX.API.profile.packs)),
                            !1
                    },
                    onCancel: null,
                    text4Ok: i18next.t("vip.upgrade.yes"),
                    text4Cancel: i18next.t("vip.upgrade.no")
                };
                return FX.Utils.isArray(t.bufferItems) && (1 < (e = t.bufferItems.slice(0)).length ? (a.onCancel = function() {
                    FX.Utils.redirectTo("/profile#/vip")
                }
                    ,
                    a.text4Cancel = i18next.t("view.detail")) : 1 === e.length && (a.text4Cancel = i18next.t("view.detail"),
                        i = e[0],
                        a.onCancel = function() {
                            switch (i) {
                                case "form_data":
                                case "print":
                                case "aggregate":
                                case "trigger":
                                case "etl":
                                    new FX.VipUsageDialog({
                                        usageType: i
                                    }).show();
                                    break;
                                default:
                                    FX.Utils.redirectTo("/profile#/vip")
                            }
                        }
                )),
                    a
            },
            _getBufferExpireMsg: function(t) {
                return t.expireDays && t.expireDays < 8 ? i18next.t("vip.systemLimitTip", {
                    day: t.expireDays
                }) : ""
            },
            _getUpgradeBufferMsg: function(t) {
                return FX.Utils.getErrMsg(t) || t.message
            },
            _getUpgradeMsg: function(t, e) {
                e = e || !1;
                var i = this._getUpgradeBufferMsg(t)
                    , a = FX.CONST.VIP_ERR_MSG_MAP[t.code] || {};
                return e ? (a.memMsg || i) + this._getBufferExpireMsg(t) : FX.Utils.isObjectEmpty(a) ? "" : (a.msg || i) + this._getBufferExpireMsg(t)
            },
            _getUpgradeTitle: function(t) {
                var e = FX.CONST.VIP_ERR_MSG_MAP[t.code] || {};
                return FX.Utils.isObjectEmpty(e) ? this._getUpgradeBufferMsg(t) + this._getBufferExpireMsg(t) : e.title
            },
            _getUpgradeTip: function(t) {
                var e = FX.CONST.VIP_ERR_MSG_MAP[t.code] || {};
                return e.doc ? i('<a target="jdy_doc"/>').text(i18next.t("vip.advancedFeatures")).attr("href", (e.is_open_doc ? FX.CONFIG.HOST.HELP_OPEN_DOC_HOST : FX.CONFIG.HOST.HELP_DOC_HOST) + "/" + e.doc) : ""
            },
            showUpgradeTip: function(t, e) {
                e = e || !1,
                FX.Utils.isObjectEmpty(t) || e && FX.CorpUser.isUserExist() && FX.Cookie.get(FX.CorpUser.getUsername() + FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.SUFFIX_KEY) || (e && FX.CorpUser.isUserExist() && FX.Cookie.set(FX.CorpUser.getUsername() + FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.SUFFIX_KEY, FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.VALUE, {
                    expires: FX.CONST.VIP_COOKIE.SERVICE_UPGRADE.EXPIRES_DATE
                }),
                    FX.CorpUser.isCorpOwner() ? (FX.Msg.alert(i.extend({
                        msg: this._getUpgradeMsg(t),
                        title: this._getUpgradeTitle(t),
                        tip: this._getUpgradeTip(t)
                    }, this._getUpgradeActionConfig(t))),
                        FX.Utils.dt(FX.CONST.TRACKER.VIP_LIMIT_ALERT, t.code)) : FX.Msg.alert({
                        title: this._getUpgradeMsg(t, !0),
                        text4Ok: i18next.t("iSee"),
                        text4Cancel: ""
                    }))
            },
            getSmsPack: function() {
                var t = this._getVip();
                return t.amountAddon && t.amountAddon.sms_pack
            },
            getIntegrationTrialInfo: function() {
                var t = this._getVip();
                return {
                    isDingTalkTrial: t.isDingTalkTrial,
                    isWechatCorpTrial: t.isWechatCorpTrial,
                    vipTrialDays: t.vipTrialDays
                }
            },
            getExcelMFS: function() {
                return this._getPack()[FX.CONST.VIP_MODULE.EXCEL_IMPORT] || 2097152
            },
            hasAppBridge: function() {
                return 0 < this._getPack()[FX.CONST.VIP_MODULE.APP_BRIDGE]
            },
            hasDataBackup: function() {
                return 0 < this._getPack()[FX.CONST.VIP_MODULE.DATA_BACKUP]
            },
            hasSubmitPrompt: function() {
                var t = this._getPack();
                return this._isAppInTrial() || 0 < t[FX.CONST.VIP_MODULE.SUBMIT_PROMPT]
            },
            hasFileExport: function() {
                return 0 < this._getPack()[FX.CONST.VIP_MODULE.FILE_ZIP]
            },
            hasSignature: function() {
                var t = this._getPack();
                return this._isAppInTrial() || 0 < t[FX.CONST.VIP_MODULE.SIGNATURE]
            },
            hasCustomTheme: function() {
                return 0 < this._getPack()[FX.CONST.VIP_MODULE.CUSTOM_THEME]
            },
            hasThreshold: function() {
                var t = this._getPack();
                return this._isAppInTrial() || 0 < t[FX.CONST.VIP_MODULE.THRESHOLD]
            },
            getPTSize: function() {
                var t = this._getPack();
                return this._isAppInTrial() ? -1 : t[FX.CONST.VIP_MODULE.PRINT]
            },
            getTriggerCount: function() {
                return this._getPack()[FX.CONST.VIP_MODULE.TRIGGER]
            },
            getVipLimit: function() {
                var t = this._getVip();
                return t && t.vipLimit || {}
            },
            getDataBackup: function() {
                return this._getPack()[FX.CONST.VIP_MODULE.DATA_BACKUP]
            },
            hasMessageWebhook: function() {
                return !!this._getVip().hasMessageWebhook
            },
            isDataCreateLimit: function() {
                return this.getVipLimit().data_create
            },
            showDataLimitTip: function(t) {
                this.isDataCreateLimit() && new FX.Tip(i.extend({
                    msg: FX.CONST.DATA_LIMIT_TIP.LINK,
                    height: 45
                }, t))
            },
            getRegSource: function() {
                return this._getVip().regSource
            },
            getVipLevel: function() {
                return this._getVip().vipPack.level
            }
        }
    }(jQuery),
    function(s) {
        FX.Socket = FX.Socket || {},
            s.extend(FX.Socket, {
                CONFIG: {
                    NOTIFICATION: {
                        path: "/socket",
                        transports: ["websocket"],
                        query: {
                            type: "notification"
                        }
                    },
                    SIGNATURE: {
                        path: "/socket",
                        transports: ["websocket"],
                        query: {
                            type: "signature"
                        }
                    }
                },
                PATH: {
                    SIGNATURE: "signature",
                    MESSAGE: "site_message",
                    EXCEL_EXPORT: "excel_export",
                    ERROR: "error"
                },
                initSocket: function(t) {
                    var e = io(FX.CONFIG.HOST.WEBSOCKET_SITE, t);
                    return e.on(this.PATH.ERROR, function(t) {
                        console.log(t)
                    }),
                        e
                },
                onSignature: function(t, e) {
                    var i = this;
                    this.signatureSocket || (this.signatureSocket = this.initSocket(this.CONFIG.SIGNATURE)),
                        this.signatureSocket.on(t, function(t) {
                            FX.Utils.applyFunc(i, e, [t], !1)
                        })
                },
                onNotification: function(t, e) {
                    var i = this;
                    this.notificationSocket || (this.notificationSocket = this.initSocket(this.CONFIG.NOTIFICATION)),
                        this.notificationSocket.on(t, function(t) {
                            FX.Utils.applyFunc(i, e, [t], !1)
                        })
                },
                initSiteMsg: function() {
                    FX.CorpUser.isUserExist() && (this.asyncTaskMap = this.asyncTaskMap || {},
                        this.onNotification(this.PATH.EXCEL_EXPORT, function(t) {
                            var e, i;
                            t && (e = t.taskId,
                                this.asyncTaskMap.excelExport = this.asyncTaskMap.excelExport || {},
                                this.asyncTaskMap.excelExport[e] ? (i = this.asyncTaskMap.excelExport[e].notice) && i.close() : this.asyncTaskMap.excelExport[e] = {})
                        }),
                        this.onNotification(this.PATH.MESSAGE, function(t) {
                            if (t) {
                                var e = FX.Utils.parseMessage2Html(t.content);
                                t.link && t.linkText && (e += '<div style="text-align:right"><a href="' + t.link + '" target="_blank">' + t.linkText + "</a></div>");
                                var i, a = {
                                    title: t.subject,
                                    duration: 4e3,
                                    content: s(e)
                                };
                                switch (t.type) {
                                    case "batch_start_workflow_begin":
                                    case "batch_start_workflow_done":
                                        s.extend(a, this._getImportNoticeCfg(t));
                                        break;
                                    case "file_export_complete":
                                    case "file_export_limit_failed":
                                    case "file_export_data_limit":
                                    case "file_export_failed":
                                        s.extend(a, this._getExportNoticeCfg(t));
                                        break;
                                    case "corp_sync":
                                        s.extend(a, this._getMemberAsyncNoticeCfg(t));
                                        break;
                                    case "webhook_retry_result":
                                        a = {};
                                        break;
                                    case "etl_run_complete":
                                        a = {},
                                            this._triggerETLComplete(t);
                                        break;
                                    case "batch_remove_data_begin":
                                        s.extend(a, {
                                            title: i18next.t("data.delete.async.title"),
                                            content: i18next.t("data.delete.async.msg"),
                                            type: "async"
                                        });
                                        break;
                                    case "batch_remove_data_done":
                                        s.extend(a, {
                                            title: i18next.t("data.delete.done"),
                                            content: i18next.t("data.delete.count", {
                                                count: t.count
                                            }),
                                            type: "success"
                                        });
                                        break;
                                    case "batch_remove_empty_warning":
                                        a = {},
                                            FX.Msg.toast({
                                                type: "warning",
                                                msg: i18next.t("data.delete.empty")
                                            });
                                        break;
                                    case "batch_remove_data_error":
                                        if (FX.Utils.isObjectEmpty(t.code))
                                            a = {};
                                        else {
                                            switch (t.code) {
                                                case 4402:
                                                    i = t.message;
                                                    break;
                                                default:
                                                    i = FX.Utils.getErrMsg(t)
                                            }
                                            s.extend(a, {
                                                title: i18next.t("delete.failWithoutMark"),
                                                content: i,
                                                type: "error"
                                            })
                                        }
                                }
                                FX.Utils.isObjectEmpty(a) || new FX.Msg.notice(a)
                            }
                        }))
                },
                setExcelExport: function(t) {
                    t && (this.asyncTaskMap = this.asyncTaskMap || {},
                        this.asyncTaskMap.excelExport = this.asyncTaskMap.excelExport || {},
                        this.asyncTaskMap.excelExport[t] = this.asyncTaskMap.excelExport[t] || {
                            notice: new FX.Msg.notice({
                                title: i18next.t("export.excel.notice.title"),
                                type: "async",
                                duration: 0,
                                content: i18next.t("export.excel.notice.content")
                            })
                        })
                },
                onBatchRemoveDataDone: function(t) {
                    var e = this;
                    this.asyncTaskMap = this.asyncTaskMap || {},
                        this.asyncTaskMap.batchRemoveData = this.asyncTaskMap.batchRemoveData || {},
                    this.asyncTaskMap.batchRemoveData.init || (this.asyncTaskMap.batchRemoveData.init = !0,
                        FX.Socket.onNotification(FX.Socket.PATH.MESSAGE, function(t) {
                            "batch_remove_data_done" === t.type && FX.Utils.applyFunc(e, e.asyncTaskMap.batchRemoveData.task, [t], !1)
                        })),
                        this.asyncTaskMap.batchRemoveData.task = t
                },
                onETLUpdateComplete: function(t, e) {
                    this.asyncTaskMap = this.asyncTaskMap || {},
                        this.asyncTaskMap.etlUpdateComplete = this.asyncTaskMap.etlUpdateComplete || {},
                    this.asyncTaskMap.etlUpdateComplete[t] || (this.asyncTaskMap.etlUpdateComplete[t] = e)
                },
                clearETLUpdateComplete: function() {
                    FX.Utils.isObjectEmpty(this.asyncTaskMap) || FX.Utils.isObjectEmpty(this.asyncTaskMap.etlUpdateComplete) || (this.asyncTaskMap.etlUpdateComplete = {})
                },
                _triggerETLComplete: function(i) {
                    var a = this
                        , t = this.asyncTaskMap.etlUpdateComplete
                        , n = i.etlTable;
                    FX.Utils.forEach(t, function(t, e) {
                        t === n.entryId && (FX.Utils.applyFunc(a, e, [n.entryId, i], !1),
                            a.asyncTaskMap.etlUpdateComplete[t] = void 0)
                    })
                },
                _getExportNoticeCfg: function(t) {
                    var e = {
                        duration: 0,
                        type: "success"
                    };
                    switch (t.type) {
                        case "file_export_failed":
                        case "file_export_data_limit":
                        case "file_export_limit_failed":
                            e.type = "error"
                    }
                    return e
                },
                _getImportNoticeCfg: function(e) {
                    var t = {};
                    switch (e.type) {
                        case "batch_start_workflow_begin":
                            s.extend(t, {
                                title: i18next.t("import.excel.flowAsync"),
                                type: "async",
                                duration: 4e3,
                                content: null
                            });
                            break;
                        case "batch_start_workflow_done":
                            var i = e.failure
                                , a = e.success
                                , n = 0 === i ? "import.excel.flowAsync.success" : "import.excel.flowAsync.fail";
                            s.extend(t, {
                                onTitleCreate: function(t) {
                                    t.append(s('<div class="excel-import-notice-title"/>').html(i18next.t("import.excel.flowAsync.title", {
                                        count: '<span class="success">' + e.dataCount + "</span>",
                                        name: e.formName
                                    })))
                                },
                                type: "success",
                                duration: 0,
                                content: s('<div class="excel-import-notice-content"/>').html(i18next.t(n, {
                                    success: '<span class="success">' + a + "</span>",
                                    fail: '<span class="fail">' + i + "</span>"
                                }))
                            })
                    }
                    return t
                },
                _getMemberAsyncNoticeCfg: function(t) {
                    var e = {
                        type: "success"
                    };
                    return t.code && (e.type = "error",
                        e.title = i18next.t("member.async.error"),
                        7111 === t.code ? (e.duration = 5e3,
                            e.content = FX.Utils.getErrMsg({
                                code: t.code
                            })) : e.content = i18next.t("member.async.error.tip")),
                        e
                }
            })
    }(jQuery),
    function(c) {
        FX.Hotkeys = {
            specialKeys: {
                8: "backspace",
                9: "tab",
                13: "return",
                16: "shift",
                17: "ctrl",
                18: "alt",
                19: "pause",
                20: "capslock",
                27: "esc",
                32: "space",
                33: "pageup",
                34: "pagedown",
                35: "end",
                36: "home",
                37: "left",
                38: "up",
                39: "right",
                40: "down",
                45: "insert",
                46: "del",
                96: "0",
                97: "1",
                98: "2",
                99: "3",
                100: "4",
                101: "5",
                102: "6",
                103: "7",
                104: "8",
                105: "9",
                106: "*",
                107: "+",
                109: "-",
                110: ".",
                111: "/",
                112: "f1",
                113: "f2",
                114: "f3",
                115: "f4",
                116: "f5",
                117: "f6",
                118: "f7",
                119: "f8",
                120: "f9",
                121: "f10",
                122: "f11",
                123: "f12",
                144: "numlock",
                145: "scroll",
                188: ",",
                190: ".",
                191: "/",
                224: "meta"
            },
            shiftNums: {
                "`": "~",
                1: "!",
                2: "@",
                3: "#",
                4: "$",
                5: "%",
                6: "^",
                7: "&",
                8: "*",
                9: "(",
                0: ")",
                "-": "_",
                "=": "+",
                ";": ": ",
                "'": '"',
                ",": "<",
                ".": ">",
                "/": "?",
                "\\": "|"
            },
            keyHandler: function(t) {
                var o = t.handler
                    , l = (t.namespace || "").toLowerCase().split(" ");
                (1 !== (l = c.map(l, function(t) {
                    return t.split(".")
                })).length || "" !== l[0] && "autocomplete" !== l[0].substring(0, 12) && "accordion" !== l[0].substring(0, 9) && "tabs" !== l[0].substring(0, 4) && "menu" !== l[0].substring(0, 4)) && (t.handler = function(t) {
                        if (this === t.target || !/textarea|select/i.test(t.target.nodeName) && "text" !== t.target.type && "true" != c(t.target).prop("contenteditable")) {
                            var e = "keypress" !== t.type && FX.Hotkeys.specialKeys[t.which]
                                , i = String.fromCharCode(t.which).toLowerCase()
                                , a = ""
                                , n = {};
                            t.altKey && "alt" !== e && (a += "alt_"),
                            t.ctrlKey && "ctrl" !== e && (a += "ctrl_"),
                            t.metaKey && !t.ctrlKey && "meta" !== e && (a += "meta_"),
                            t.shiftKey && "shift" !== e && (a += "shift_"),
                                e ? n[a + e] = !0 : (n[a + i] = !0,
                                    n[a + FX.Hotkeys.shiftNums[i]] = !0,
                                "shift_" === a && (n[FX.Hotkeys.shiftNums[i]] = !0));
                            for (var s = 0, r = l.length; s < r; s++)
                                if (n[l[s]])
                                    return o.apply(this, arguments)
                        }
                    }
                )
            }
        },
            FX.Utils.forEach(["keydown", "keyup", "keypress"], function(t, e) {
                c.event.special[e] = {
                    add: FX.Hotkeys.keyHandler
                }
            })
    }(jQuery),
    FX.AddressData = {
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": [""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": [""],
            "": [""],
            "": [""],
            "": [""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": [""],
            "": [""],
            "": [""],
            "": ["", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", ""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", ""],
            "": [""],
            "": ["", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", "", "", ""],
            "": ["", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", ""],
            "": ["", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", ""],
            "": ["", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""],
            "": [""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", ""],
            "": ["", "", ""],
            "": ["", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", "", "", ""],
            "": ["", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        },
        "": {
            "": ["", "", "", "", "", "", "", ""]
        },
        "": {
            "": [""]
        }
    },
    $.extend(Array.prototype, {
        remove: function(t) {
            var e = this.indexOf(t);
            return -1 != e && this.splice(e, 1),
                this
        },
        unique: function() {
            for (var t = {}, e = this.length, i = [], a = 0; a < e; a++) {
                var n = this[a];
                t.hasOwnProperty(n) || (t[n] = 1,
                    i.push(n))
            }
            return i
        }
    }),
    $.extend($.Event.prototype, {
        stopEvent: function() {
            this.stopPropagation(),
                this.preventDefault()
        }
    }),
    function(n) {
        FX.Container = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return n.extend(FX.Container.superclass._defaultConfig.apply(), {
                    baseCls: "fui_container",
                    resultWidgets: {}
                })
            },
            _addWidget: function(t) {
                var e = this.options
                    , i = FX.createWidget(t)
                    , a = (e.resultWidgets[i.options.widgetName] = i).options.resultWidgets;
                return a && n.extend(e.resultWidgets, a),
                    i
            }
        })
    }(jQuery),
    function(s) {
        FX.List = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return s.extend(FX.List.superclass._defaultConfig.apply(), {
                    baseCls: "x-list",
                    items: [],
                    value: null,
                    onItemCreate: null,
                    onItemSelect: null
                })
            },
            _init: function() {
                FX.List.superclass._init.apply(this, arguments),
                    this._createList(),
                    this._bindEvent()
            },
            _createList: function() {
                var i = this
                    , t = this.options;
                this.$list = s('<div class="x-list-pane"/>').appendTo(this.element),
                    FX.Utils.forEach(t.items, function(t, e) {
                        i.$list.append(i._createItem(e))
                    })
            },
            _createItem: function(t) {
                var e = this.options
                    , i = "x-list-item";
                t.selected && (i += " select");
                var a = s('<div class="' + i + '"/>');
                return t.icon && a.append('<i class="item-icon ' + t.icon + '"/>'),
                    a.append(s('<span class="item-title"/>').text(t.title)).attr({
                        "data-name": t.name,
                        title: t.title
                    }).data({
                        item: t
                    }),
                    FX.Utils.applyFunc(this, e.onItemCreate, [t, a], !1),
                    a
            },
            _bindEvent: function() {
                var a = this
                    , n = this.options;
                this.$list.on("click", ".x-list-item", function(t) {
                    var e = s(t.currentTarget)
                        , i = e.data("item");
                    FX.Utils.applyFunc(a, n.onItemSelect, [i, e], !1)
                })
            },
            reload: function(t) {
                var i = this;
                this.$list.empty(),
                    FX.Utils.forEach(t, function(t, e) {
                        i.$list.append(i._createItem(e))
                    })
            }
        }),
            s.shortcut("list", FX.List)
    }(jQuery),
    jQuery,
    FX.Menu = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.Menu.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-menu",
                items: [],
                selectedItem: "",
                onSelect: null
            })
        },
        _init: function() {
            FX.Menu.superclass._init.apply(this, arguments);
            var i = this
                , a = this.options;
            FX.Utils.forEach(a.items, function(t, e) {
                $('<div class="menu-item"/>').attr("data-key", e.key).append($("<i />").addClass(e.icon)).append($("<span />").text(e.text)).toggleClass("selected", e.key === a.selectedItem).toggleClass("has-separator", !!e.hasSeparator).addClass(e.customCls).appendTo(i.element)
            }),
                this._bindEvent()
        },
        _bindEvent: function() {
            var a = this
                , n = this.options;
            this.element.on("click", ".menu-item", function(t) {
                var e, i = $(t.currentTarget);
                i.hasClass("selected") || (i.addClass("selected").siblings().removeClass("selected"),
                    e = i.attr("data-key"),
                    FX.Utils.applyFunc(a, n.onSelect, [e], null))
            })
        },
        setItemHasNew: function(t, e) {
            this.element.find('.menu-item[data-key="' + t + '"]').toggleClass("has-new", !!e)
        }
    }),
    jQuery,
    FX.CheckList = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.CheckList.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_checklist",
                hasSelectAll: !0,
                textField: "text",
                valueField: "value",
                async: null,
                asyncResultKey: "items",
                value: [],
                customItem: null,
                items: [{
                    value: "1",
                    text: "1"
                }, {
                    value: "2",
                    text: "2"
                }, {
                    value: "3",
                    text: "3"
                }],
                allowEmptyTextField: !1,
                searchable: !0,
                onStopEdit: null,
                height: 30,
                width: 240,
                limit: 100,
                hasLimit: !1,
                onAfterItemSelect: null,
                onAfterSelectAll: null,
                searchKey: "keyword"
            })
        },
        _init: function() {
            FX.CheckList.superclass._init.apply(this, arguments);
            var t, e = this, i = this.options;
            this.value = i.value,
            i.searchable && (t = $('<div class="search"/>').appendTo(this.element),
                $('<input class="search-input" placeholder="' + i18next.t("search") + '"/>').on("input propertychange", function(t) {
                    e._doSearch($(t.currentTarget).val().trim())
                }).appendTo(t));
            var a = $('<div class="list-wrapper"/>').appendTo(this.element);
            this._createMetaList().appendTo(a),
                this.$checkList = $('<ul class="check-list"/>').on("click", ".check-item", function(t) {
                    e._handleClick($(t.currentTarget))
                }).appendTo(a),
                this._loadItems()
        },
        _createMetaList: function() {
            var t, a = this, e = this.options, i = $('<ul class="meta-list"/>').on("click", ".check-item", function(t) {
                var e, i = $(t.currentTarget);
                i.hasClass("select-all") && (i.toggleClass("select"),
                    e = i.hasClass("select"),
                    a._handleSelectAll(e)),
                i.hasClass("custom-item") && a._handleClick(i)
            });
            return e.hasSelectAll && ((t = {})[e.textField] = i18next.t("selectAll"),
                this.$selectAll = this._createCheckItem(t).addClass("select-all").appendTo(i)),
            FX.Utils.isObjectEmpty(e.customItem) || (this.$customItem = this._createCheckItem(e.customItem).addClass("custom-item").appendTo(i)),
                i
        },
        _handleSelectAll: function(i) {
            var a = this
                , t = this.options;
            FX.Utils.isObjectEmpty(t.customItem) || a._handleItemSelectAll(i, this.$customItem);
            var e = this.$checkList.children(".check-item");
            FX.Utils.forEach(e, function(t, e) {
                a._handleItemSelectAll(i, $(e))
            }),
                FX.Utils.applyFunc(this, t.onAfterSelectAll, [i], !1),
                FX.Utils.applyFunc(this, t.onStopEdit, [], !1)
        },
        _handleItemSelectAll: function(t, e) {
            var i, a;
            e.hasClass("x-ui-hidden") || (i = e.data("option"),
                a = this.value.indexOf(i),
                t ? (e.addClass("select"),
                a < 0 && this.value.push(i)) : (e.removeClass("select"),
                -1 < a && this.value.splice(a, 1)))
        },
        _loadItems: function() {
            var e = this
                , i = this.options;
            if (i.async && i.async.url) {
                if (this.isLoading)
                    return;
                this.isLoading = !0;
                var t = $("<li />").text(i18next.t("loading")).appendTo(this.$checkList)
                    , a = {
                    hasLimit: i.hasLimit,
                    limit: i.limit
                };
                FX.Utils.isEmpty(this.searchValue) || (a[i.searchKey] = this.searchValue),
                    FX.Utils.dataAjax({
                        url: i.async.url,
                        data: $.extend({}, i.async.data, a)
                    }, function(t) {
                        e.items = t[i.asyncResultKey],
                            e.itemMap = $.extend(e.itemMap, e._getItemMap(e.items)),
                            e._createItems()
                    }, null, function() {
                        t.remove(),
                            e.isLoading = !1
                    })
            } else
                this.items = i.items,
                    e.itemMap = $.extend(e.itemMap, e._getItemMap(e.items)),
                    e._createItems()
        },
        _getItemValue: function(t) {
            var e = this.options;
            return FX.Utils.isEmpty(t[e.valueField]) ? t : t[e.valueField]
        },
        _getItemText: function(t) {
            var e = this.options
                , i = FX.Utils.isEmpty(t[e.textField]) ? t : t[e.textField];
            return e.allowEmptyTextField && (i = FX.Utils.isNull(t[e.textField]) ? "" : t[e.textField]),
                i
        },
        _getItemMap: function(t) {
            var a = this
                , n = {};
            return FX.Utils.forEach(t, function(t, e) {
                var i = a._getItemValue(e);
                n[i] = e
            }),
                n
        },
        _createItems: function() {
            var a = this
                , i = this.options
                , n = {}
                , s = []
                , r = [];
            FX.Utils.forEach(this.items, function(t, e) {
                var i = a._getItemValue(e);
                n[i] = !0,
                    a.value.indexOf(i) < 0 ? r.push(a.itemMap[i]) : s.push(a.itemMap[i] || i)
            }),
            FX.Utils.isEmpty(this.searchValue) && FX.Utils.forEach(this.value, function(t, e) {
                if (!FX.Utils.isObjectEmpty(i.customItem) && e === a._getItemValue(i.customItem))
                    return;
                n[e] || s.push(a.itemMap[e] || e)
            });
            var t = s.concat(r);
            FX.Utils.forEach(t, function(t, e) {
                a._createCheckItem(e).appendTo(a.$checkList)
            }),
                this._checkSelectAll()
        },
        _createCheckItem: function(t) {
            var e = this._getItemValue(t)
                , i = this._getItemText(t)
                , a = $('<li class="check-item x-check"/>').data("option", e).attr("title", i).data("item", t).append($('<i class="icon-blank"/>')).append($("<span />").text(i));
            return -1 < this.value.indexOf(e) && a.addClass("select"),
                a
        },
        _handleClick: function(t) {
            var e, i = this.options, a = t.data("option");
            t.toggleClass("select"),
                t.hasClass("select") ? this.value.push(a) : -1 < (e = this.value.indexOf(a)) && this.value.splice(e, 1),
                this._checkSelectAll(),
                FX.Utils.applyFunc(this, i.onAfterItemSelect, [t, t.data("item"), t.hasClass("select")], !1),
                FX.Utils.applyFunc(this, i.onStopEdit, [], !1)
        },
        _checkSelectAll: function() {
            var t, e, i = this.options;
            i.hasSelectAll && (t = !1,
                e = this.$checkList.children(".check-item").not(".x-ui-hidden"),
            this.$checkList.children(".check-item.select").not("x-ui-hidden").length === e.length && (t = !(!FX.Utils.isObjectEmpty(i.customItem) && !this.$customItem.hasClass("x-ui-hidden")) || this.$customItem.hasClass("select")),
                this.$selectAll.toggleClass("select", t))
        },
        _doSearch: function(t) {
            var e, n = this, i = this.options;
            this.searchValue = t,
            this.searchInterval && clearTimeout(this.searchInterval),
                i.async && i.hasLimit ? this.searchInterval = setTimeout(function() {
                    n.items = [],
                        n.$checkList.empty(),
                        n._loadItems(),
                        n._afterSearch()
                }, 500) : (e = $("li.check-item", this.$checkList),
                    this.searchInterval = setTimeout(function() {
                        FX.Utils.forEach(e, function(t, e) {
                            var i = $(e)
                                , a = new RegExp(FX.Utils.escapeRegexp(n.searchValue),"i").test(i.text());
                            i.toggleClass("x-ui-hidden", !a)
                        }),
                            n._afterSearch()
                    }, 500))
        },
        _afterSearch: function() {
            var t = this.options;
            this.searchValue ? (this.$selectAll && this.$selectAll.find("span").text(i18next.t("selectAllSearchResult")),
            FX.Utils.isObjectEmpty(t.customItem) || this.$customItem.addClass("x-ui-hidden")) : (this.$selectAll && this.$selectAll.find("span").text(i18next.t("selectAll")),
            FX.Utils.isObjectEmpty(t.customItem) || this.$customItem.removeClass("x-ui-hidden"))
        },
        doFilterRely: function(t) {
            this.options.async.data.filter = t,
            this.$checkList && this.$checkList.empty(),
                this._loadItems()
        },
        setValue: function(t) {
            var e, i = this.options;
            this.value = t,
                this.$checkList.empty(),
            FX.Utils.isObjectEmpty(this.items) || this._createItems(),
            FX.Utils.isObjectEmpty(i.customItem) || (e = i.customItem[i.valueField],
                this.$customItem.toggleClass("select", -1 < t.indexOf(e)))
        },
        getValue: function() {
            return this.value
        }
    }),
    $.shortcut("checklist", FX.CheckList),
    jQuery,
    FX.RadioList = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.RadioList.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_radiolist",
                textField: "text",
                valueField: "value",
                async: null,
                asyncResultKey: "items",
                value: null,
                customItem: null,
                items: [{
                    value: "1",
                    text: "1"
                }, {
                    value: "2",
                    text: "2"
                }, {
                    value: "3",
                    text: "3"
                }],
                allowEmptyTextField: !1,
                searchable: !0,
                onStopEdit: null,
                height: 30,
                width: 240,
                limit: 100,
                hasLimit: !1,
                onAfterItemSelect: null,
                onAfterSelectAll: null,
                searchKey: "keyword"
            })
        },
        _init: function() {
            FX.RadioList.superclass._init.apply(this, arguments);
            var t, e = this, i = this.options;
            this.value = i.value,
            i.searchable && (t = $('<div class="search"/>').appendTo(this.element),
                $('<input class="search-input" placeholder="' + i18next.t("search") + '"/>').on("input propertychange", function(t) {
                    e._doSearch($(t.currentTarget).val().trim())
                }).appendTo(t));
            var a = $('<div class="list-wrapper"/>').appendTo(this.element);
            this._createMetaList().appendTo(a),
                this.$radioList = $('<ul class="radio-list x-group"/>').on("click", ".group_item", function(t) {
                    e._handleClick($(t.currentTarget))
                }).appendTo(a),
                this._loadItems()
        },
        _createMetaList: function() {
            var i = this
                , t = this.options
                , e = $('<ul class="meta-list"/>').on("click", ".group_item", function(t) {
                var e = $(t.currentTarget);
                e.hasClass("custom-item") && i._handleClick(e)
            });
            return FX.Utils.isObjectEmpty(t.customItem) || (this.$customItem = this._createRadioItem(t.customItem).addClass("custom-item").appendTo(e)),
                e
        },
        _loadItems: function() {
            var e = this
                , i = this.options;
            if (i.async && i.async.url) {
                if (this.isLoading)
                    return;
                this.isLoading = !0;
                var t = $("<li />").text(i18next.t("loading")).appendTo(this.$radioList)
                    , a = {
                    hasLimit: i.hasLimit,
                    limit: i.limit
                };
                FX.Utils.isEmpty(this.searchValue) || (a[i.searchKey] = this.searchValue),
                    FX.Utils.dataAjax({
                        url: i.async.url,
                        data: $.extend({}, i.async.data, a)
                    }, function(t) {
                        e.items = t[i.asyncResultKey],
                            e.itemMap = $.extend(e.itemMap, e._getItemMap(e.items)),
                            e._createItems()
                    }, null, function() {
                        t.remove(),
                            e.isLoading = !1
                    })
            } else
                this.items = i.items,
                    e.itemMap = $.extend(e.itemMap, e._getItemMap(e.item)),
                    e._createItems()
        },
        _getItemValue: function(t) {
            var e = this.options;
            return FX.Utils.isEmpty(t[e.valueField]) ? t : t[e.valueField]
        },
        _getItemText: function(t) {
            var e = this.options
                , i = FX.Utils.isEmpty(t[e.textField]) ? t : t[e.textField];
            return e.allowEmptyTextField && (i = FX.Utils.isNull(t[e.textField]) ? "" : t[e.textField]),
                i
        },
        _getItemMap: function(t) {
            var a = this
                , n = {};
            return FX.Utils.forEach(t, function(t, e) {
                var i = a._getItemValue(e);
                n[i] = e
            }),
                n
        },
        _createItems: function() {
            var t, a = this, n = {};
            FX.Utils.forEach(this.items, function(t, e) {
                var i = a._getItemValue(e);
                n[i] = !0,
                    i === a.value ? a._createRadioItem(e).prependTo(a.$radioList) : a._createRadioItem(e).appendTo(a.$radioList)
            }),
            FX.Utils.isEmpty(this.searchValue) && this.value && !n[this.value] && (t = this.itemMap[this.value] || this.value,
                this._createRadioItem(t).prependTo(this.$radioList))
        },
        _createRadioItem: function(t) {
            var e = this._getItemValue(t)
                , i = this._getItemText(t)
                , a = $('<li class="group_item x-radio"/>').data("option", e).attr("title", i).data("item", t).append($('<i class="icon-blank"/>')).append($("<span />").text(i));
            return this.value === e && a.addClass("select"),
                a
        },
        _handleClick: function(t) {
            var e = this.options
                , i = t.data("option");
            t.addClass("select").siblings().removeClass("select"),
                this.value = i,
                FX.Utils.applyFunc(this, e.onAfterItemSelect, [t, t.data("item"), t.hasClass("select")], !1),
                FX.Utils.applyFunc(this, e.onStopEdit, [], !1)
        },
        _doSearch: function(t) {
            var e, n = this, i = this.options;
            this.searchValue = t,
            this.searchInterval && clearTimeout(this.searchInterval),
                i.async && i.hasLimit ? this.searchInterval = setTimeout(function() {
                    n.items = [],
                        n.$radioList.empty(),
                        n._loadItems(),
                        n._afterSearch()
                }, 500) : (e = $("li.group_item", this.$radioList),
                    this.searchInterval = setTimeout(function() {
                        FX.Utils.forEach(e, function(t, e) {
                            var i = $(e)
                                , a = new RegExp(FX.Utils.escapeRegexp(n.searchValue),"i").test(i.text());
                            i.toggleClass("x-ui-hidden", !a)
                        }),
                            n._afterSearch()
                    }, 500))
        },
        _afterSearch: function() {
            var t = this.options;
            this.searchValue ? FX.Utils.isObjectEmpty(t.customItem) || this.$customItem.addClass("x-ui-hidden") : FX.Utils.isObjectEmpty(t.customItem) || this.$customItem.removeClass("x-ui-hidden")
        },
        doFilterRely: function(t) {
            this.options.async.data.filter = t,
            this.$radioList && this.$radioList.empty(),
                this._loadItems()
        },
        setValue: function(t) {
            var e, i = this.options;
            this.value = t,
                this.$radioList.empty(),
            FX.Utils.isObjectEmpty(this.items) || this._createItems(),
            FX.Utils.isObjectEmpty(i.customItem) || (e = i.customItem[i.valueField],
                this.$customItem.toggleClass("select", t === e))
        },
        getValue: function() {
            return this.value
        }
    }),
    $.shortcut("radiolist", FX.RadioList),
    jQuery,
    FX.Avatar = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.Avatar.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-avatar",
                avatar: "",
                name: "",
                size: "normal",
                sizeNumber: 0
            })
        },
        _init: function() {
            FX.Avatar.superclass._init.apply(this, arguments);
            var t, e = this.options, i = this._getSizeClass();
            this.element.addClass(i),
            e.sizeNumber && this.element.css({
                width: e.sizeNumber + "px",
                height: e.sizeNumber + "px"
            }),
                e.avatar ? (this.element.addClass("avatar-image"),
                    this.avatarImage = $('<img class="avatar-image" src="' + e.avatar + '" />').appendTo(this.element)) : e.name && (t = FX.Utils.formatUserThumb(e.name),
                    this.element.addClass("color-" + t.color).text(t.name))
        },
        _getSizeClass: function() {
            var t = "";
            return "small" === this.options.size && (t = "small-avatar"),
                t
        },
        changeAvatar: function(t) {
            t && (this.avatarImage ? this.avatarImage.attr("src", t) : this.element.empty().append($('<img class="avatar-image" src="' + t + '" />')))
        }
    }),
    $.shortcut("avatar", FX.Avatar),
    function(t) {
        FX.FormItemUtils = FX.FormItemUtils || {},
            t.extend(FX.FormItemUtils, {
                formatDateTimeValue: function(t, e) {
                    if (FX.Utils.isNull(t))
                        return null;
                    var i = null
                        , i = "today" === t ? new Date : FX.Utils.parseDate(t) || new Date(t)
                        , a = (i = FX.FormItemUtils.fixDateByViewMode(i, e)).getTime();
                    return isNaN(a) ? null : a
                },
                fixDateByViewMode: function(t, e) {
                    var i = FX.Utils.parseDate(t);
                    if (!i)
                        return null;
                    var a = FX.CONST.DATE_VIEW_MODE
                        , n = FX.Utils.getDateInfo(new Date);
                    switch (e) {
                        case a.YM:
                            i.setDate(1),
                                i.setHours(0, 0, 0);
                            break;
                        case a.YMD:
                            i.setHours(0, 0, 0);
                            break;
                        case a.YMD_HM:
                            i.setSeconds(0);
                            break;
                        case a.HM:
                            i.setFullYear(n.year, n.month, n.day),
                                i.setSeconds(0);
                            break;
                        case a.HMS:
                            i.setFullYear(n.year, n.month, n.day)
                    }
                    return i.setMilliseconds(0),
                        i
                },
                dealCurrentUser: function(t, e) {
                    if (!t)
                        return null;
                    var i = t;
                    return "select" === (e = e || "select") && t._id === FX.USER_ID.CurrentUser && (i = FX.CorpUser.isMemberExist() ? {
                        _id: FX.CorpUser.getMemberId(),
                        username: FX.CorpUser.getMemberUsername(),
                        nickname: FX.CorpUser.getMemberNickname(),
                        avatar: FX.CorpUser.getMemberAvatar()
                    } : null),
                        i
                },
                parseUserDeptDefaultValue: function(t) {
                    var e = t;
                    return t && t._id && (e = t._id),
                        e
                },
                parseUserDeptListDefaultValue: function(t) {
                    var i = [];
                    return FX.Utils.forEach(t, function(t, e) {
                        e && e._id ? i.push(e._id) : i.push(e)
                    }),
                        i
                },
                dealCurrentDept: function(t, e, i, a, n) {
                    if (!e)
                        return i && i(e);
                    var s;
                    "select" === (a = a || "select") && e._id === FX.CONST.DEPT_ID.CURRENT ? (n && n.length && (s = FX.Utils.createMask(n, {
                        isLight: !0,
                        hasLoader: !0
                    })),
                        FX.Utils.dataAjax({
                            url: t.url,
                            data: t.data,
                            async: !1
                        }, function(t) {
                            e && e._id === FX.CONST.DEPT_ID.CURRENT && (e = FX.Utils.isObjectEmpty(t.departmentList) ? null : t.departmentList[0]),
                            i && i(e)
                        }, function() {
                            i && i(null)
                        }, function() {
                            s && s.remove()
                        })) : i && i(e)
                },
                dealCurrentDeptList: function(t, e, i, a, n) {
                    if (!e || !e.length)
                        return i && i([]);
                    var s, r = -1;
                    FX.Utils.forEach(e, function(t, e) {
                        if (e && e._id === FX.CONST.DEPT_ID.CURRENT)
                            return r = t,
                                !1
                    }),
                        "select" === (a = a || "select") && -1 < r ? (n && n.length && (s = FX.Utils.createMask(n, {
                            isLight: !0,
                            hasLoader: !0
                        })),
                            FX.Utils.dataAjax({
                                url: t.url,
                                data: t.data,
                                async: !1
                            }, function(t) {
                                e[r] && e[r]._id === FX.CONST.DEPT_ID.CURRENT && (e.splice(r, 1),
                                    e = e.concat(t.departmentList)),
                                i && i(e)
                            }, function() {
                                e[r] && e[r]._id === FX.CONST.DEPT_ID.CURRENT && e.splice(r, 1),
                                i && i(e)
                            }, function() {
                                s && s.remove()
                            })) : i && i(e)
                }
            })
    }(jQuery),
    FX.FormItem = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.FormItem.superclass._defaultConfig.apply(), {
                API: FX.API,
                appId: null,
                entryId: null,
                formId: null,
                dataId: null,
                description: "",
                label: "",
                layout: {},
                widget: {},
                mode: "new",
                colorMap: null,
                ignoreValidate: !1,
                onAddSubWidget: null,
                onAssociate: null,
                onCalFormula: null,
                onGetFilter: null,
                onGetLinkFilter: null,
                onGetLinkValue: null,
                onRowEdit: null,
                onStopEdit: null,
                onValueChange: null,
                onRowChange: null,
                onStateChange: null
            })
        },
        _init: function() {
            FX.FormItem.superclass._init.apply(this, arguments);
            var t = this.options;
            this.widget = FX.FormUtils.convertWidget2Front(t.widget, t.API),
                this._render()
        },
        _afterInit: function() {},
        _render: function() {
            var t = this.options
                , e = $('<div class="fl-label"/>').appendTo(this.element).append($('<span class="label-title"/>').text(t.label));
            !1 === this.widget.allowBlank && $('<span class="label-notnull"/>').text("*").appendTo(e),
            FX.Utils.isEmpty(t.description) || "<br>" === t.description || $('<div class="fl-description x-subhtml"/>').append(t.description).appendTo(this.element),
                this._renderField(),
            this.isVisible() || this.element.addClass("x-ui-hidden")
        },
        _renderField: function() {
            var i = this.options
                , a = this;
            this.widget.enable || FX.LimitFields.disable.indexOf(this.widget.type) < 0 ? this.field = FX.createWidget($.extend({
                label: i.label,
                API: i.API,
                renderEl: $("<div/>").appendTo($('<div class="fl-widget"/>').appendTo(this.element))
            }, this._getFieldConfig(this.widget.type, this), this.widget, i.layout)) : this.field = new FX.FormItemDisable($.extend({
                renderEl: $("<div/>").appendTo($('<div class="fl-widget"/>').appendTo(this.element)),
                API: i.API,
                appId: i.appId,
                entryId: i.entryId,
                dataId: i.dataId,
                colorMap: FX.FormUtils.optionsWidgetConfig2ColorMap(this.widget) || i.colorMap,
                onBeforeInit: function() {
                    var t, e;
                    "edit" === i.mode || (e = (t = this.options).rely) && e.formula && FX.Utils.isObjectEmpty(e.widgets) && (t.value = FX.Utils.applyFunc(a, i.onCalFormula, [e.formula.formula], null),
                        a.widget.value = t.value)
                },
                widgetType: this.widget.type
            }, this.widget, i.layout))
        },
        _getFieldConfig: function(t, i) {
            var a = this.options
                , n = this
                , e = {
                onStopEdit: function() {
                    FX.Utils.applyFunc(i, a.onStopEdit, [], !1)
                },
                onStateChange: function() {
                    FX.Utils.applyFunc(i, a.onStateChange, [], !1)
                },
                onBeforeInit: function() {
                    var t, e;
                    "edit" === a.mode || (e = (t = this.options).rely) && e.formula && FX.Utils.isObjectEmpty(e.widgets) && (t.value = FX.Utils.applyFunc(i, a.onCalFormula, [e.formula.formula], null),
                        n.widget.value = t.value)
                },
                onGetAjaxData: function() {
                    return {
                        appId: a.appId,
                        entryId: a.entryId,
                        dataId: a.dataId
                    }
                }
            };
            switch (t) {
                case "combo":
                    $.extend(e, {
                        onLinkErr: function(t) {
                            n.dealLinkErr(t, a.label)
                        }
                    });
                case "combocheck":
                    $.extend(e, {
                        onBeforeAsync: function() {
                            return {
                                cond: FX.Utils.applyFunc(i, a.onGetFilter, [], []),
                                rel: FX.CONST.FILTER_RELATION.AND
                            }
                        },
                        onAfterItemSelect: function(t, e) {
                            n.effectItemLinkWidgets(e && e.isOther)
                        },
                        onLinkErr: function(t) {
                            n.dealLinkErr(t, a.label)
                        }
                    });
                    break;
                case "linkquery":
                    $.extend(e, {
                        linkEnable: "preview" !== a.mode && !FX.STATIC.ISADMIN && !FX.Utils.isExternalLink(),
                        onLinkErr: function(t) {
                            n.dealLinkErr(t, a.label)
                        }
                    });
                    break;
                case "linkdata":
                    $.extend(e, {
                        linkEnable: "preview" !== a.mode && !FX.STATIC.ISADMIN && !FX.Utils.isExternalLink(),
                        onBeforeLinkData: function(t) {
                            var e = this.options.linkForm;
                            e && this.reload({
                                cond: FX.Utils.applyFunc(i, a.onGetLinkFilter, [t, e], []),
                                rel: FX.CONST.FILTER_RELATION.AND
                            })
                        },
                        onLinkErr: function(t) {
                            n.dealLinkErr(t, a.label)
                        }
                    });
                    break;
                case "subform":
                    $.extend(e, {
                        onBeforeWidgetCreate: function(t, e) {
                            $.extend(t, n._getFieldConfig(t.type, this), {
                                onBeforeInit: function() {
                                    var t = this.options
                                        , e = t.rely;
                                    e && e.formula && FX.Utils.isObjectEmpty(e.widgets) && (t.value = FX.Utils.applyFunc(i, a.onCalFormula, [e.formula.formula], null))
                                }
                            })
                        },
                        onAfterWidgetCreate: function(t) {
                            FX.Utils.applyFunc(i, a.onAddSubWidget, [t], !1)
                        },
                        onBeforeRowEdit: function(t) {
                            return FX.Utils.applyFunc(i, a.onRowEdit, [t], !1)
                        },
                        onRowChange: function(t, e) {
                            return FX.Utils.applyFunc(i, a.onRowChange, [t, e], !1)
                        },
                        onLinkErr: function(t) {
                            n.dealLinkErr(t, a.label)
                        }
                    });
                    break;
                case "user":
                case "usergroup":
                    $.extend(e, {
                        onBeforeEdit: function() {
                            var t = this.options;
                            if (t.limitWidget) {
                                var e = FX.Utils.applyFunc(i, a.onGetLinkValue, [t.limitWidget], null);
                                return FX.Utils.isObjectEmpty(e) ? t.limit = {} : t.limit = {
                                    departs: $.makeArray(e)
                                },
                                    !1
                            }
                        }
                    });
                    break;
                case "dept":
                case "deptgroup":
                    $.extend(e, {
                        onBeforeEdit: function(t) {
                            var e = this.options;
                            return !(!e.rely || !e.rely.data || e.valueOption !== FX.WidgetValueOption.CUSTOM) && (!!FX.Utils.isObjectEmpty(e.limit) && void FX.Utils.dataAjax({
                                url: FX.Utils.getApi(a.API.data.distinct),
                                data: $.extend({
                                    appId: a.appId,
                                    entryId: a.entryId,
                                    dataId: a.dataId,
                                    filter: {
                                        cond: FX.Utils.applyFunc(i, a.onGetFilter, [], []),
                                        rel: FX.CONST.FILTER_RELATION.AND
                                    }
                                }, e.rely.data)
                            }, function(t) {
                                FX.Utils.isObjectEmpty(t.items) ? e.limit = {} : e.limit = {
                                    departs: t.items
                                }
                            }, null, function() {
                                t && t()
                            }))
                        }
                    });
                    break;
                case "image":
                    $.extend(e, {
                        uploadTokenURL: FX.Utils.getApi(a.API.file.get_qn_data_token),
                        maxFileSize: FX.CONST.MAX_IMAGE_SIZE,
                        maxLimitTip: i18next.t("form.item.image.limit", {
                            num: FX.CONST.MAX_IMAGE_SIZE / 1024 / 1024
                        }),
                        onUploadSuccess: function() {
                            FX.Utils.applyFunc(i, a.onValueChange, [], !1)
                        }
                    }),
                    i.widget.enable || $.extend(e, {
                        mode: "preview",
                        noFileTip: i18next.t("content.empty"),
                        disableMode: "form"
                    });
                    break;
                case "upload":
                    $.extend(e, {
                        uploadTokenURL: FX.Utils.getApi(a.API.file.get_qn_data_token),
                        uploadTokenType: "file",
                        maxFileSize: FX.CONST.MAX_FILE_SIZE,
                        maxLimitTip: i18next.t("form.item.file.limit", {
                            num: FX.CONST.MAX_FILE_SIZE / 1024 / 1024
                        }),
                        onUploadSuccess: function() {
                            FX.Utils.applyFunc(i, a.onValueChange, [], !1)
                        }
                    }),
                    i.widget.enable || $.extend(e, {
                        mode: "preview",
                        noFileTip: i18next.t("content.empty"),
                        disableMode: "form"
                    });
                    break;
                case "signature":
                    $.extend(e, {
                        allowSign: FX.Vip.hasSignature(),
                        disableMode: "form"
                    });
                    break;
                case "radiogroup":
                    $.extend(e, {
                        onAfterItemSelect: function(t, e) {
                            n.effectItemLinkWidgets(e && e.isOther)
                        }
                    });
                    break;
                case "phone":
                    $.extend(e, {
                        entryId: a.entryId,
                        formId: a.formId || a.entryId,
                        ignoreSmsVerify: a.ignoreValidate,
                        isPreviewMode: "preview" === a.mode
                    });
                    break;
                case "sn":
                    $.extend(e, {
                        waterMark: "edit" === a.mode ? i18next.t("content.empty") : i18next.t("widget.sn.placeholder")
                    })
            }
            return e
        },
        _hasContactWidgets: function(t) {
            return ("combo" === t.type || "radiogroup" === t.type) && !t.async
        },
        dealLinkErr: function(t, e) {
            var i = this.options;
            switch (t) {
                case 3e3:
                case 2010:
                    if ("subform" === i.widget.type)
                        return void FX.Msg.toast({
                            msg: i18next.t("field.config.msg.fail.in", {
                                name: FX.Utils.limitText(e, 12)
                            }),
                            type: "warning"
                        });
                    FX.Msg.toast({
                        msg: i18next.t("field.config.msg.fail", {
                            name: FX.Utils.limitText(e, 12)
                        }),
                        type: "warning"
                    })
            }
        },
        isVisible: function() {
            return this.widget.visible
        },
        isEnable: function() {
            return this.widget.enable
        },
        isSubformWidget: function() {
            return !1
        },
        getSubformName: function() {
            return ""
        },
        getOptionValue: function() {
            return this.widget.value
        },
        getLinkForm: function() {
            return this.widget.linkForm
        },
        getLinkFilter: function() {
            return this.widget.linkFilter
        },
        getRely: function() {
            return this.widget.rely
        },
        getFormat: function() {
            return this.widget.format
        },
        getAsync: function() {
            return this.widget.async
        },
        getValueOption: function() {
            return this.widget.valueOption
        },
        getWidgetName: function() {
            return this.widget.widgetName
        },
        getWidgetType: function() {
            return this.widget.type
        },
        getLinkType: function() {
            return "linkdata" === this.widget.type ? this.widget.linkType : this.widget.type
        },
        getWidgetByName: function(t, e) {
            return this.field.getWidgetByName(t, e)
        },
        getInvalidateType: function() {
            return this.field.getInvalidateType()
        },
        setInvalidateType: function(t) {
            this.field.setInvalidateType(t)
        },
        setErrorState: function(t, e) {
            this.element.addClass("error").children(".error-info").remove();
            var i = this.widget
                , a = i18next.t("item.required");
            switch (t && (a = t),
                this.getInvalidateType()) {
                case FX.CONST.INVALID_TYPE.BLANK:
                    a = i18next.t("item.required"),
                    "subform" === i.type && (a = i18next.t("widget.subform.allowBlank"));
                    break;
                case FX.CONST.INVALID_TYPE.REGEX:
                    if (a = i18next.t("form.item.error.format"),
                    "subform" === i.type) {
                        var n = this.getSubItemError();
                        switch (n.type) {
                            case FX.CONST.INVALID_TYPE.BLANK:
                                a = i18next.t("item.required");
                                break;
                            case FX.CONST.INVALID_TYPE.REGEX:
                                if (n.regex) {
                                    var s = FX.CONST.TEXT_TYPE_REGEXP;
                                    switch (n.regex) {
                                        case s.email:
                                            a = i18next.t("required.email");
                                            break;
                                        case s.interMobile:
                                        case s.mobile:
                                            a = i18next.t("phone.invalid.warning");
                                            break;
                                        case s.tel:
                                            a = i18next.t("required.tel");
                                            break;
                                        case s.zip:
                                            a = i18next.t("required.zip");
                                            break;
                                        case s.ID:
                                            a = i18next.t("required.ID")
                                    }
                                }
                                "number" !== n.widget.getWidgetType() || n.widget.widget.allowDecimals || (a = i18next.t("field.number.integer.input"));
                                break;
                            case FX.CONST.INVALID_TYPE.RANGE:
                                i = n.widget.widget;
                                FX.Utils.isNull(i.minNumber) || FX.Utils.isNull(i.maxNumber) ? FX.Utils.isNull(i.minNumber) ? FX.Utils.isNull(i.maxNumber) || (a = i18next.t("field.number.range.lte", {
                                    max: i.maxNumber
                                })) : a = i18next.t("field.number.range.gte", {
                                    min: i.minNumber
                                }) : a = i18next.t("field.number.range.btw", {
                                    min: i.minNumber,
                                    max: i.maxNumber
                                });
                                break;
                            case FX.CONST.INVALID_TYPE.OUTSIDE:
                                a = i18next.t("item.outside")
                        }
                    }
                    if ("number" !== i.type || i.allowDecimals || (a = i18next.t("field.number.integer.input")),
                        i.regex) {
                        s = FX.CONST.TEXT_TYPE_REGEXP;
                        switch (i.regex) {
                            case s.email:
                                a = i18next.t("required.email");
                                break;
                            case s.interMobile:
                            case s.mobile:
                                a = i18next.t("phone.invalid.warning");
                                break;
                            case s.tel:
                                a = i18next.t("required.tel");
                                break;
                            case s.zip:
                                a = i18next.t("required.zip");
                                break;
                            case s.ID:
                                a = i18next.t("required.ID")
                        }
                    }
                    break;
                case FX.CONST.INVALID_TYPE.REPEAT:
                    a = i.repeatRemind || i18next.t("field.noRepeat.exist"),
                    "subform" === i.type && (this.field.setErrorState(e),
                        a = this.field.getFirstNoRepeatRemind(e));
                    break;
                case FX.CONST.INVALID_TYPE.OUTSIDE:
                    a = i18next.t("item.outside");
                    break;
                case FX.CONST.INVALID_TYPE.RANGE:
                    FX.Utils.isNull(i.minNumber) || FX.Utils.isNull(i.maxNumber) ? FX.Utils.isNull(i.minNumber) ? FX.Utils.isNull(i.maxNumber) || (a = i18next.t("field.number.range.lte", {
                        max: i.maxNumber
                    })) : a = i18next.t("field.number.range.gte", {
                        min: i.minNumber
                    }) : a = i18next.t("field.number.range.btw", {
                        min: i.minNumber,
                        max: i.maxNumber
                    });
                    break;
                case FX.CONST.INVALID_TYPE.SMS:
                    a = i18next.t("widget.phone.sms.error");
                    break;
                case FX.CONST.INVALID_TYPE.PHONE_REGEX:
                    a = i18next.t("phone.invalid.warning");
                    break;
                case FX.CONST.INVALID_TYPE.PHONE_TIMEOUT:
                    a = i18next.t("widget.phone.sms.error"),
                    "phone" === this.field.getWidgetType() && this.field.resetGetSmsCode();
                    break;
                case FX.CONST.INVALID_TYPE.FILE_UPLOADING:
                    a = i18next.t("widget.file.uploading.wait.until")
            }
            this.element.append($('<div class="error-info"/>').text(a))
        },
        getErrorMsg: function() {
            var t = this.widget
                , e = i18next.t("item.required");
            switch (this.getInvalidateType()) {
                case FX.CONST.INVALID_TYPE.BLANK:
                    e = i18next.t("item.required.toast", {
                        name: this.options.label
                    });
                    break;
                case FX.CONST.INVALID_TYPE.REGEX:
                case FX.CONST.INVALID_TYPE.RANGE:
                case FX.CONST.INVALID_TYPE.PHONE_REGEX:
                    if (e = i18next.t("item.correct.toast", {
                        name: this.options.label
                    }),
                    "subform" === t.type) {
                        var i = this.getSubItemError();
                        switch (i.type) {
                            case FX.CONST.INVALID_TYPE.BLANK:
                                e = i18next.t("item.required.toast", {
                                    name: i.label
                                });
                                break;
                            case FX.CONST.INVALID_TYPE.OUTSIDE:
                                e = i18next.t("item.outside.toast", {
                                    name: i.label
                                });
                                break;
                            default:
                                e = i18next.t("item.correct.toast", {
                                    name: i.label
                                })
                        }
                    }
                    break;
                case FX.CONST.INVALID_TYPE.REPEAT:
                    e = t.repeatRemind || i18next.t("field.noRepeat.exist");
                    break;
                case FX.CONST.INVALID_TYPE.OUTSIDE:
                    e = i18next.t("item.outside.toast", {
                        name: this.options.label
                    });
                    break;
                case FX.CONST.INVALID_TYPE.SMS:
                    e = i18next.t("item.sms.toast", {
                        name: this.options.label
                    });
                    break;
                case FX.CONST.INVALID_TYPE.PHONE_TIMEOUT:
                    e = i18next.t("widget.phone.sms.error"),
                    "phone" === this.field.getWidgetType() && this.field.resetGetSmsCode();
                    break;
                case FX.CONST.INVALID_TYPE.FILE_UPLOADING:
                    e = i18next.t("widget.file.uploading.wait.until");
                    break;
                default:
                    e = i18next.t("item.required.toast", {
                        name: this.options.label
                    })
            }
            return e
        },
        getSubItemError: function() {
            var r = 0
                , o = ""
                , l = ""
                , c = null;
            return this.element.find(".subform-content").find(".subform-row").each(function(t, e) {
                0 === r && $(e).find(".subform-cell").each(function(t, e) {
                    var i, a, n = !1, s = $(e).data("widget");
                    s && s.isVisible() && (i = s.checkValidate(),
                    (a = s.getInvalidateType()) === FX.CONST.INVALID_TYPE.FILE_UPLOADING && (n = !0),
                    i || n || 0 !== r || (r = a,
                        o = s.options.label,
                        l = s.widget.regex,
                        c = s))
                })
            }),
                {
                    type: r,
                    label: o,
                    regex: l,
                    widget: c
                }
        },
        clearErrorState: function() {
            this.setInvalidateType(),
                this.element.removeClass("error").children(".error-info").remove(),
            this.field.clearErrorState && this.field.clearErrorState()
        },
        supportLayout: function() {
            var t = this.widget
                , i = !0;
            return "linkdata" !== t.type && "linkquery" !== t.type || FX.Utils.forEach(t.linkFields, function(t, e) {
                if ("subform" === e.type)
                    return i = !1
            }),
                i
        },
        clearLimit: function() {
            this.widget.limit = {},
            this.field.clearLimit && this.field.clearLimit()
        },
        scrollInvalidWidgetToView: function() {
            this.field.scrollInvalidWidgetToView && this.field.scrollInvalidWidgetToView()
        },
        setValue: function(t) {
            this.field.setValue(t)
        },
        getValue: function() {
            return this.field.getValue()
        },
        setText: function(t) {
            this.field.setText(t)
        },
        getText: function() {
            return this.field.getText()
        },
        getNullValue: function() {
            return this.field.getNullValue()
        },
        getLinkValue: function() {
            return this.field.getLinkValue ? this.field.getLinkValue() : this.field.getValue()
        },
        setCacheValue: function(t) {
            this.field.setCacheValue(t)
        },
        setUploadingStatus: function(t) {
            this.field.setUploadingStatus(t)
        },
        getCacheValue: function() {
            return this.field.getCacheValue()
        },
        getRepeatRemind: function() {
            return this.widget.repeatRemind
        },
        rebuild: function() {
            -1 < ["combo", "combocheck"].indexOf(this.widget.type) && this.getAsync() && (this.field.items = null),
                this.field.rebuild()
        },
        reload: function(t) {
            this.field.reload(t)
        },
        clearValue: function() {
            this.field.clearValue && this.field.clearValue()
        },
        effectItemLinkWidgets: function(i) {
            var a, n, t = this.options, e = this.widget;
            this._hasContactWidgets(e) && (a = [],
                n = this.getValue(),
                FX.Utils.forEach(e.items, function(t, e) {
                    return e.value === n ? (a = e.widgetsMap || [],
                        !1) : void (!e.isOther || FX.Utils.isEmpty(n) && !i || (a = e.widgetsMap || []))
                }),
                FX.Utils.applyFunc(this, t.onAssociate, [e.widgetName, a], !1))
        },
        effectStopEdit: function() {
            FX.Utils.applyFunc(this.field, this.field.options.onStopEdit, [], !1)
        },
        effectBeforeAsync: function() {
            return FX.Utils.applyFunc(this.field, this.field.options.onBeforeAsync, [], !1)
        },
        checkValidate: function() {
            return this.field.checkValidate()
        },
        getOptions: function() {
            return this.field.getOptions()
        },
        setOptions: function(t) {
            $.extend(this.field.options, t)
        },
        select: function() {
            this.field.select && this.field.select()
        },
        setLinkDataId: function(t) {
            this.field.setLinkDataId(t)
        }
    }),
    function(o) {
        FX.FormItemDisable = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return o.extend(FX.FormItemDisable.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_form_item_disable",
                    API: FX.API,
                    shouldResize: !1,
                    oriType: null,
                    widgetType: null,
                    colorMap: null,
                    waterMark: i18next.t("content.empty")
                })
            },
            _init: function() {
                FX.FormItemDisable.superclass._init.apply(this, arguments);
                var t = this.options;
                switch (this.colorMap = t.colorMap,
                    this.widgetType = t.oriType || t.widgetType,
                    this.widgetType) {
                    case "number":
                        var e = "[-]?[\\d]{0,}";
                        t.allowDecimals && (e = "[-]?[\\d]{0,}[\\.]?[\\d]{0,}"),
                            t.regex = "^" + e + "$";
                        break;
                    case "radiogroup":
                    case "combo":
                        var i = "";
                        FX.Utils.forEach(t.items, function(t, e) {
                            if (e.selected && !e.isOther)
                                return i = e.value,
                                    !1
                        }),
                            this.setValue(i);
                        break;
                    case "checkboxgroup":
                    case "combocheck":
                        i = [];
                        FX.Utils.forEach(t.items, function(t, e) {
                            e.selected && i.push(e.value)
                        }),
                            this.setValue(i)
                }
                this.element.attr("data-watermark", t.waterMark)
            },
            doResize: function(t) {
                var e = this.options;
                t && (e.width = t.width,
                    e.height = t.height),
                e.shouldResize && (FX.Utils.isEmpty(e.width) || this.element.css({
                    width: e.width
                }),
                FX.Utils.isEmpty(e.height) || this.element.css({
                    height: e.height
                }))
            },
            setColorMap: function(t) {
                this.colorMap = t
            },
            _getWidgetColorMap: function() {
                var t = this.options
                    , e = t.widgetName;
                return t.subform && (e = [t.subform, e].join(".")),
                this.colorMap && this.colorMap[e]
            },
            _isColorEnable: function() {
                return !!this._getWidgetColorMap()
            },
            _getColor: function(t) {
                var e = this._getWidgetColorMap();
                return e && e[t]
            },
            setValue: function(t) {
                var e, i, a, n = this, s = this.options;
                switch (this.widgetType) {
                    case "number":
                        t = FX.Utils.fixDecimalPrecision(t),
                            this.value = t,
                            this.cacheValue = t,
                            this.setText(t);
                        break;
                    case "datetime":
                        var r = FX.Utils.getDateTimeViewMode(s.format);
                        this.value = FX.FormItemUtils.formatDateTimeValue(t, r),
                            this.setText(this.value ? FX.Utils.date2Str(new Date(this.value), s.format) : null);
                        break;
                    case "checkboxgroup":
                    case "combocheck":
                        this.value = t,
                            this.cacheValue = t,
                            this.element.empty(),
                            this._isColorEnable() ? FX.Utils.forEach(t, function(t, e) {
                                new FX.TextTag({
                                    renderEl: o("<div/>").appendTo(n.element),
                                    bgColor: n._getColor(e),
                                    html: FX.Utils.replaceURL(e),
                                    multiLine: !0
                                })
                            }) : this.setText(o.makeArray(t).join(","));
                        break;
                    case "address":
                        this.value = t,
                            FX.Utils.isObjectEmpty(t) ? this.setText("") : (e = s.needDetail ? "pcda" : "pcd",
                                i = FX.Utils.address2Str(t, "", e),
                                this.setText(i));
                        break;
                    case "location":
                        this.value = t,
                            FX.Utils.isObjectEmpty(t) ? this.setText("") : (i = FX.Utils.address2Str(t, "", "pcda"),
                                this.setText(i),
                            s.lnglatVisible && (a = FX.Utils.getLnglatText(t),
                                s.subform ? (i += "(" + a + ")",
                                    this.setText(i)) : o('<div class="disable-info"/>').text(a).appendTo(this.element)));
                        break;
                    case "text":
                    case "textarea":
                        t = FX.Utils.isEmpty(t) ? "" : t + "",
                            this.value = t,
                            this.cacheValue = t,
                            this.setText(t);
                        break;
                    case "radiogroup":
                    case "combo":
                        t = FX.Utils.isEmpty(t) ? "" : t + "",
                            this.value = t,
                            this.cacheValue = t,
                            this.element.empty(),
                            this._isColorEnable() ? new FX.TextTag({
                                renderEl: o("<div/>").appendTo(this.element),
                                bgColor: this._getColor(t),
                                html: FX.Utils.replaceURL(t),
                                multiLine: !0
                            }) : this.setText(t);
                        break;
                    case "phone":
                        this.value = t,
                            this.cacheValue = t,
                            FX.Utils.isObjectEmpty(this.value) ? this.element.empty() : (this.setText(this.value.phone),
                            this.value.verified && o('<div class="phone-verified-tag"/>').text(i18next.t("widget.phone.validate.success")).appendTo(this.element))
                }
                this.element.toggleClass("tag-mode", this._isColorEnable())
            },
            getValue: function() {
                switch (this.widgetType) {
                    case "number":
                        return FX.Utils.str2num(this.value);
                    case "text":
                    case "textarea":
                        return this.value && this.value.trim();
                    default:
                        return this.value
                }
            },
            setText: function(t) {
                var e = this.options
                    , i = FX.Utils.replaceURL(t && t.toString());
                this.element.empty(),
                e.subform && this.element.attr("title", i),
                    this.element.html(i)
            },
            getText: function() {
                return this.element.text()
            },
            getNullValue: function() {
                switch (this.widgetType) {
                    case "checkboxgroup":
                    case "combocheck":
                        return [];
                    case "address":
                    case "location":
                        return {};
                    case "text":
                    case "textarea":
                        return "";
                    default:
                        return null
                }
            },
            checkValidate: function() {
                var t = this.options
                    , e = !0
                    , i = this.getValue();
                switch (this.widgetType) {
                    case "datetime":
                        !t.allowBlank && FX.Utils.isEmpty(i) && (e = !1),
                        t.startDate && this.value < t.startDate && (e = !1),
                        t.endDate && this.value > t.endDate && (e = !1);
                        break;
                    case "checkboxgroup":
                    case "combocheck":
                        !t.allowBlank && i && 0 === i.length && (e = !1);
                        break;
                    case "number":
                        if (FX.Utils.isEmpty(i))
                            e = t.allowBlank;
                        else {
                            if (!FX.Utils.isEmpty(t.regex)) {
                                try {
                                    e = new RegExp(t.regex).test(i)
                                } catch (t) {
                                    e = !1
                                }
                                e || this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX)
                            }
                            e && (!FX.Utils.isNull(t.maxNumber) && i > t.maxNumber || !FX.Utils.isNull(t.minNumber) && i < t.minNumber) && (e = !1,
                                this.setInvalidateType(FX.CONST.INVALID_TYPE.RANGE))
                        }
                        break;
                    default:
                        if (FX.Utils.isObjectEmpty(i))
                            e = t.allowBlank;
                        else if (!FX.Utils.isEmpty(t.regex)) {
                            try {
                                e = new RegExp(t.regex).test(i)
                            } catch (t) {
                                e = !1
                            }
                            e || this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX)
                        }
                }
                return e
            },
            rebuild: function(t) {
                o.extend(this.options, t),
                    FX.FormItemDisable.superclass.rebuild.apply(this, arguments),
                    this.cacheValue = ""
            },
            setCacheValue: function(t) {
                this.setValue(t)
            },
            getCacheValue: function() {
                var t;
                switch (this.widgetType) {
                    case "number":
                        t = FX.Utils.str2num(this.cacheValue);
                        break;
                    case "address":
                    case "location":
                    case "datetime":
                        t = this.getValue();
                        break;
                    default:
                        t = this.cacheValue
                }
                return t
            },
            getLinkValue: function() {
                switch (this.widgetType) {
                    case "combo":
                        var t = this.getValue();
                        return t && t.toString();
                    default:
                        return this.getValue()
                }
            }
        }),
            o.shortcut("formitemdisable", FX.FormItemDisable)
    }(jQuery),
    function(l) {
        FX.FormMultiTab = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return l.extend(FX.FormMultiTab.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fx-form-multi-tab",
                    tabs: [],
                    activeTabName: "",
                    themeColor: "#0DB3A6",
                    items: [],
                    onCreateTabItem: null,
                    viewWidth: null,
                    canSort: !1,
                    onTabClick: null
                })
            },
            _init: function() {
                FX.FormMultiTab.superclass._init.apply(this, arguments);
                var t = this.options;
                this.activeTabName = t.activeTabName,
                    this.listPosLeft = 0,
                    this._initContent()
            },
            _initContent: function() {
                var t = this.options;
                this.activeTabName || (this.activeTabName = t.tabs[0] ? t.tabs[0].name : ""),
                    this._createWrapper(),
                    this._createTabs();
                var e = l('<div class="tab-content"><div class="invisible-list-before"/><ul class="multi-tab-widget-list" data-empty-tip="' + i18next.t("form.fields.add") + '"/><div class="invisible-list-after"/></div>').appendTo(this.element);
                this.$tabContent = l(".multi-tab-widget-list", e),
                t.canSort && this.$tabContent.sortable({
                    group: "no-drop"
                }),
                    this._initTabContent(),
                    this._dealMultiTabVisible()
            },
            _createWrapper: function() {
                var s = this
                    , r = this.options;
                this.$wrapper = l('<div class="tab-list-wrapper"/>').on("click", function(t) {
                    var e, i = l(t.target), a = i.closest(".tab-item"), n = i.closest(".arrow");
                    a.length ? (s.activeTabName = a.data("tab").name,
                        a.addClass("active").siblings().removeClass("active"),
                        s._adjustTabListPos(a),
                        s._adjustTabItemsVisible(l(".widget-view", s.element)),
                        s.setActiveTabColor(r.themeColor),
                        FX.Utils.applyFunc(s, r.onTabClick, [], !1)) : n.length && !n.hasClass("disable") && (e = n.data("direction"),
                        s._slideTabList(e))
                }).prependTo(this.element)
            },
            _createTabs: function() {
                var t, e, i = this.options, a = this, n = l('<div class="inner-wrapper"/>').appendTo(this.$wrapper), s = l('<div class="tab-list"/>').appendTo(n);
                FX.Utils.forEach(i.tabs, function(t, e) {
                    var i = e.name === a.activeTabName ? "active" : "";
                    l('<div class="tab-item ' + i + '"/>').text(e.title).append('<div class="bar"/>').data("tab", e).appendTo(s)
                }),
                this._showSwitchArrows() && (t = this._isLeftArrowEnable() ? "" : "disable",
                    e = this._isRightArrowEnable() ? "" : "disable",
                    l('<div class="arrow left ' + t + '" data-direction="left"><i class="icon-arrow-left"/></div>').prependTo(this.$wrapper),
                    l('<div class="arrow right ' + e + '" data-direction="right"><i class="icon-arrow-right"/></div>').appendTo(this.$wrapper)),
                    this._applyTabListPosStyle(!0),
                    this.setActiveTabColor(i.themeColor)
            },
            _initTabContent: function() {
                var s = this.options
                    , r = this;
                FX.Utils.forEach(s.items, function(t, e) {
                    var i, a, n = FX.Utils.applyFunc(r, s.onCreateTabItem, [e], !1);
                    n && (e.tab === r.activeTabName ? n.appendTo(r.$tabContent) : s.canSort ? (i = l(".invisible-list-before", r.element),
                        a = l(".invisible-list-after", r.element),
                        r._isAfterActiveTab(e.tab) ? n.appendTo(a) : n.appendTo(i)) : n.addClass("hide").appendTo(r.$tabContent))
                })
            },
            _dealMultiTabVisible: function() {
                var t = this.options;
                this.element.toggleClass("invisible", FX.Utils.isObjectEmpty(t.tabs))
            },
            _showSwitchArrows: function() {
                return this._getTabListTotalWidth() > this._getTabListViewWidth()
            },
            _getTabListViewWidth: function() {
                var t = this.options
                    , e = l(".inner-wrapper", this.element).width();
                return FX.Utils.isNumber(t.viewWidth) ? Math.min(t.viewWidth, e) : e
            },
            _getTabListTotalWidth: function() {
                var i = 0;
                return FX.Utils.forEach(l(".tab-item", this.$wrapper), function(t, e) {
                    i += l(e).outerWidth()
                }),
                    i
            },
            _isLeftArrowEnable: function() {
                return this.listPosLeft < 0
            },
            _isRightArrowEnable: function() {
                var t = this._getTabListTotalWidth() - this._getTabListViewWidth();
                return -this.listPosLeft < t
            },
            _slideTabList: function(t) {
                var e = this._getTabListTotalWidth()
                    , i = this._getTabListViewWidth();
                "right" === t ? e - -this.listPosLeft - i > i ? this.listPosLeft -= i : this.listPosLeft = -(e - i) : "left" === t && (-this.listPosLeft > i ? this.listPosLeft += i : this.listPosLeft = 0),
                    this._applyTabListPosStyle(),
                    this._adjustTabListArrowEnable()
            },
            _adjustTabListPos: function(t) {
                var e, i, a, n, s, r;
                t && (e = t.outerWidth(),
                    i = this._getTabListViewWidth(),
                    a = l(".inner-wrapper", this.element),
                    s = (n = FX.Utils.getDomOffset(t, a).left) + e,
                    r = !1,
                    n < 0 ? (r = !0,
                        this.listPosLeft += -n) : i < s && (r = !0,
                        this.listPosLeft -= s - i),
                r && (this._applyTabListPosStyle(),
                    this._adjustTabListArrowEnable()))
            },
            _applyTabListPosStyle: function(t) {
                var e = l(".tab-list", this.element);
                e.toggleClass("no-animation", !!t),
                    e.css(FX.Utils.formatTransform("translateX(" + this.listPosLeft + "px)"))
            },
            _adjustTabListArrowEnable: function() {
                l(".arrow.left", this.element).toggleClass("disable", !this._isLeftArrowEnable()),
                    l(".arrow.right", this.element).toggleClass("disable", !this._isRightArrowEnable())
            },
            _deleteTabListTailPadding: function() {
                var t = this.options.tabs.length
                    , e = l(".inner-wrapper", this.element)
                    , i = l(l(".tab-item", this.element)[t - 1])
                    , a = i.outerWidth()
                    , n = this._getTabListViewWidth()
                    , s = FX.Utils.getDomOffset(i, e);
                s.left + a < n && (this.listPosLeft += n - s.left - a),
                    this._applyTabListPosStyle(!1)
            },
            _adjustTabItemsVisible: function(t) {
                var n = this
                    , e = this.options
                    , s = l(".invisible-list-before", this.element)
                    , r = l(".multi-tab-widget-list", this.element)
                    , o = l(".invisible-list-after", this.element);
                e.canSort ? FX.Utils.forEach(t, function(t, e) {
                    var i = l(e)
                        , a = i.data("tabName");
                    a === n.activeTabName ? i.appendTo(r) : n._isAfterActiveTab(a) ? i.appendTo(o) : i.appendTo(s)
                }) : FX.Utils.forEach(t, function(t, e) {
                    var i = l(e);
                    i.data("tabName") === n.activeTabName ? i.removeClass("hide") : i.addClass("hide")
                })
            },
            _isAfterActiveTab: function(t) {
                var e = this.options
                    , i = [];
                return FX.Utils.forEach(e.tabs, function(t, e) {
                    i.push(e.name)
                }),
                i.indexOf(this.activeTabName) < i.indexOf(t)
            },
            reOrderTabItems: function(t) {
                var i = this
                    , a = [];
                FX.Utils.forEach(t, function(t, e) {
                    a = a.concat(i.getTabItems(e.name))
                }),
                    this._adjustTabItemsVisible(a)
            },
            updateConfig: function(t) {
                l.extend(this.options, t)
            },
            setActiveTabName: function(t) {
                this.activeTabName = t,
                    this._adjustTabItemsVisible(l(".widget-view", this.element))
            },
            setActiveTabColor: function(t) {
                t && (this.options.themeColor = t,
                    l(".tab-item", this.element).css({
                        color: "inherit"
                    }),
                    l(".tab-item.active", this.element).css({
                        color: t
                    }),
                    l(".tab-item.active .bar", this.element).css({
                        background: t
                    }))
            },
            getActiveTabName: function() {
                return this.activeTabName
            },
            getTabItems: function(a) {
                var n = [];
                return FX.Utils.forEach(l(".widget-view", this.element), function(t, e) {
                    var i = l(e);
                    i.data("tabName") === a && n.push(i)
                }),
                    n
            },
            getAllTabItems: function() {
                return l(".widget-view", this.element)
            },
            rebuildTabList: function() {
                this.$wrapper.empty(),
                    this.$wrapper.css({
                        width: this.element.width()
                    }),
                    this._createTabs(),
                    this._showSwitchArrows() ? (this._adjustTabListArrowEnable(),
                        this._deleteTabListTailPadding()) : (this.listPosLeft = 0,
                        this._applyTabListPosStyle(!0))
            },
            refreshWithConfig: function(t) {
                var e = this.options;
                l.extend(e, t),
                    this.rebuildTabList(),
                    this._adjustTabItemsVisible(l(".widget-view", this.element)),
                    this._dealMultiTabVisible()
            }
        })
    }(jQuery),
    function(e) {
        FX.TextEditor = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return e.extend(FX.TextEditor.superclass._defaultConfig.apply(), {
                    baseCls: "fui_text",
                    inputCls: "x-input",
                    inputType: "text",
                    width: 240,
                    height: 30,
                    allowBlank: !0,
                    noRepeat: !1,
                    onValidateSuccess: null,
                    onValidateFail: null,
                    onAfterValidate: null,
                    onBeforeEdit: null,
                    onAfterEdit: null,
                    onKeyPress: null,
                    onStopEdit: null,
                    onStateChange: null
                })
            },
            _init: function() {
                FX.TextEditor.superclass._init.apply(this, arguments);
                var i = this.options
                    , a = this;
                this.editComp = this._createEditComp(),
                    this.editComp.addClass(i.inputCls).appendTo(this.element),
                i.waterMark && this.editComp.attr("placeholder", i.waterMark),
                    this.editComp.focus(function(t) {
                        a.$err && a.$err.hide(),
                        a.isEnabled() && a._isScanEditable() && (a.editComp.addClass(i.inputCls + "-focus"),
                            FX.Utils.applyFunc(a, i.onBeforeEdit, [t], !1))
                    }).blur(function(t) {
                        var e;
                        a.isEnabled() && a._isScanEditable() && (a.editComp.removeClass(i.inputCls + "-focus"),
                        (e = a.checkValidate()) && (a.cacheValue = a.getValue(),
                            FX.Utils.applyFunc(a, i.onStopEdit, [e, t], !1)),
                            FX.Utils.applyFunc(a, i.onStateChange, [], !1))
                    }).on("input", function(t) {
                        a.isEnabled() && a._isScanEditable() && FX.Utils.applyFunc(a, i.onAfterEdit, [t], !1)
                    }).keypress(function(t) {
                        FX.Utils.applyFunc(a, i.onKeyPress, [t], !1)
                    })
            },
            _createEditComp: function() {
                return e("<input type='" + this.options.inputType + "'/>")
            },
            checkValidate: function() {
                var t = this.options
                    , e = this.editComp.val().trim()
                    , i = !0;
                if (FX.Utils.isEmpty(e))
                    (i = t.allowBlank) || this.setInvalidateType(FX.CONST.INVALID_TYPE.BLANK);
                else if (!FX.Utils.isEmpty(t.regex)) {
                    try {
                        i = new RegExp(t.regex).test(e)
                    } catch (t) {
                        i = !1
                    }
                    i || this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX)
                }
                return i ? !1 === FX.Utils.applyFunc(this, t.onValidateSuccess, [e], !1) && this.setState(FX.States.NORMAL) : !1 === FX.Utils.applyFunc(this, t.onValidateFail, [e], !1) && this.setState(FX.States.ERROR),
                    FX.Utils.applyFunc(this, t.onAfterValidate, [e, i], !1),
                    i
            },
            showErrorMsg: function(t) {
                FX.Utils.isEmpty(t) || (this.$err || (this.$err = e('<span class="invalid-info"/>').appendTo(this.element)),
                    this.$err.text(t).show())
            },
            select: function() {
                this.editComp && (this.editComp.select(),
                    this.editComp.focus())
            },
            _isScanEditable: function() {
                var t = this.options;
                return !t.scan || t.scan.editable
            },
            setEnable: function(t) {
                FX.TextEditor.superclass.setEnable.apply(this, [t]),
                    t && this._isScanEditable() ? this.editComp.removeAttr("readOnly") : this.editComp.attr("readOnly", "readOnly")
            },
            setText: function(t) {
                this.setValue(t)
            },
            setValue: function(t) {
                this.editComp.val(t),
                    this.cacheValue = t
            },
            getText: function() {
                return this.getValue()
            },
            getValue: function() {
                return this.editComp.val().trim()
            },
            getCacheValue: function() {
                return this.cacheValue
            },
            rebuild: function() {
                FX.TextEditor.superclass.rebuild.apply(this, arguments),
                    this.cacheValue = ""
            },
            reset: function() {
                this.setValue("")
            },
            setState: function(t) {
                var e = this.options
                    , i = e.inputCls + "-error " + e.inputCls + "-success " + e.inputCls + "-warning";
                switch (e.state = t) {
                    case FX.States.SUCCESS:
                        this.editComp.removeClass(i).addClass(e.inputCls + "-success");
                        break;
                    case FX.States.ERROR:
                        this.editComp.removeClass(i).addClass(e.inputCls + "-error");
                        break;
                    case FX.States.WARNING:
                        this.editComp.removeClass(i).addClass(e.inputCls + "-warning");
                        break;
                    default:
                        this.editComp.removeClass(i)
                }
            },
            getState: function() {
                return this.options.state ? 0 : this.options.state
            },
            getOptions: function() {
                var t = this.options;
                return e.extend(FX.TextEditor.superclass.getOptions.apply(this, arguments), {
                    regex: t.regex,
                    noRepeat: t.noRepeat,
                    scan: t.scan
                })
            },
            getNullValue: function() {
                return ""
            }
        }),
            e.shortcut("text", FX.TextEditor)
    }(jQuery),
    function(t) {
        FX.TextArea = FX.extend(FX.TextEditor, {
            _defaultConfig: function() {
                return t.extend(FX.TextArea.superclass._defaultConfig.apply(), {
                    baseCls: "fui_textarea",
                    inputCls: "x-textarea",
                    width: 420,
                    height: 140
                })
            },
            _createEditComp: function() {
                return t("<textarea/>")
            }
        }),
            t.shortcut("textarea", FX.TextArea)
    }(jQuery),
    function(e) {
        FX.Number = FX.extend(FX.TextEditor, {
            _defaultConfig: function() {
                return e.extend(FX.Number.superclass._defaultConfig.apply(), {
                    allowDecimals: !1,
                    allowNegative: !0,
                    maxNumber: null,
                    minNumber: null
                })
            },
            _init: function() {
                FX.Number.superclass._init.apply(this, arguments);
                var t = this.options
                    , e = "[\\d]{0,}";
                t.allowDecimals && (e = "[\\d]{0,}[\\.]?[\\d]{0,}"),
                t.allowNegative && (e = "[-]?" + e),
                    t.regex = "^" + e + "$"
            },
            _createEditComp: function() {
                return e("<input/>")
            },
            getOptions: function() {
                var t = this.options;
                return e.extend(FX.Number.superclass.getOptions.apply(this, arguments), {
                    allowDecimals: t.allowDecimals,
                    allowNegative: t.allowNegative
                })
            },
            setValue: function(t) {
                t = FX.Utils.fixDecimalPrecision(t),
                    this.editComp.val(t),
                    this.cacheValue = t
            },
            getValue: function() {
                var t = this.editComp.val();
                return FX.Utils.str2num(t)
            },
            getCacheValue: function() {
                var t = this.cacheValue;
                return FX.Utils.str2num(t)
            },
            getNullValue: function() {
                return null
            },
            getText: function() {
                return this.editComp.val()
            },
            checkValidate: function() {
                var t = this.options
                    , e = this.editComp.val().trim()
                    , i = !0;
                if (FX.Utils.isEmpty(e))
                    (i = t.allowBlank) || this.setInvalidateType(FX.CONST.INVALID_TYPE.BLANK);
                else {
                    if (!FX.Utils.isEmpty(t.regex)) {
                        try {
                            i = new RegExp(t.regex).test(e)
                        } catch (t) {
                            i = !1
                        }
                        i || this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX)
                    }
                    i && (!FX.Utils.isNull(t.maxNumber) && e > t.maxNumber || !FX.Utils.isNull(t.minNumber) && e < t.minNumber) && (i = !1,
                        this.setInvalidateType(FX.CONST.INVALID_TYPE.RANGE))
                }
                return i ? !1 === FX.Utils.applyFunc(this, t.onValidateSuccess, [e], !1) && this.setState(FX.States.NORMAL) : !1 === FX.Utils.applyFunc(this, t.onValidateFail, [e], !1) && this.setState(FX.States.ERROR),
                    FX.Utils.applyFunc(this, t.onAfterValidate, [e, i], !1),
                    i
            }
        }),
            e.shortcut("number", FX.Number)
    }(jQuery),
    function(n) {
        FX.Password = FX.extend(FX.TextEditor, {
            _defaultConfig: function() {
                return n.extend(FX.Password.superclass._defaultConfig.apply(), {
                    hasPopPane: !1,
                    hasMaxWidth: !1
                })
            },
            _init: function() {
                FX.Password.superclass._init.apply(this, arguments);
                this.options.hasPopPane && this._createPopPane()
            },
            _createEditComp: function() {
                return n('<input type="password"/>')
            },
            _createPopPane: function() {
                var e = this.options
                    , i = this
                    , a = n('<div class="pop-pane"><div class="limit-wrapper"><div class="icon-wrapper"><i class="password-limit-icon icon-select"></i></div><div class="limit-content">' + i18next.t("account.password.limit") + '</div></div><div class="standard-wrapper"><div class="icon-wrapper"><i class="password-standard-icon icon-select"></i></div><div class="standard-content">' + i18next.t("account.password.standard") + "</div></div></div>");
                this.editComp.focus(function(t) {
                    FX.UI.showPopover({
                        anchor: i.editComp,
                        position: "top",
                        content: a,
                        maxWidth: e.hasMaxWidth ? i.element.width() : null,
                        delay: 0,
                        customCls: "password-pop-pane"
                    }),
                        i._checkPasswordStrength(a, i.getValue())
                }).blur(function() {
                    FX.UI.closePopover()
                }).on("input", function(t) {
                    i._checkPasswordStrength(a, i.getValue())
                })
            },
            _checkPasswordStrength: function(t, e) {
                var i = n("i.password-limit-icon", t)
                    , a = n("i.password-standard-icon", t);
                FX.Utils.checkPassLength(e) ? i.addClass("validate-passed") : i.removeClass("validate-passed"),
                    FX.Utils.checkPassStandard(e) ? a.addClass("validate-passed") : a.removeClass("validate-passed")
            }
        }),
            n.shortcut("password", FX.Password)
    }(jQuery),
    function(r) {
        FX.Trigger = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return r.extend(FX.Trigger.superclass._defaultConfig.apply(), {
                    baseCls: "fui_trigger",
                    width: 240,
                    height: 30,
                    btnWidth: 30,
                    waterMark: null,
                    onElementCreate: null,
                    triggerIcon: "",
                    hAdjust: 0,
                    edge: {
                        width: 240,
                        height: 200
                    }
                })
            },
            _init: function() {
                FX.Trigger.superclass._init.apply(this, arguments);
                var t = this.options;
                !1 === FX.Utils.applyFunc(this, t.onElementCreate, [], !1) && (this.editComp = this._createEditComp(),
                t.waterMark && this.editComp.attr("placeholder", t.waterMark),
                    this.triggerBtn = this._createTriggerBtn()),
                    this._bindEvts()
            },
            _createEditComp: function() {
                return r('<input class="fui_trigger-input" onfocus="this.blur();"/>').attr("readOnly", "readOnly").attr("UNSELECTABLE", "on").appendTo(this.element)
            },
            _createTriggerBtn: function() {
                return r('<i class="fui_trigger-btn"/>').addClass(this.options.triggerIcon).appendTo(this.element)
            },
            _bindEvts: function() {
                var e = this;
                this.element.unbind("click.trigger"),
                    this.element.bind("click.trigger", function(t) {
                        e._onTriggerClick()
                    })
            },
            _onTriggerClick: function(t) {},
            _getEdgeOption: function() {
                return this.options.edge
            },
            _getTriggerView: function() {
                var t = r(".x-dropdown-wrapper");
                return 0 === t.length && (t = r('<div class="x-dropdown-wrapper"/>').appendTo("body")),
                    t
            },
            _calTriggerViewPos: function() {
                var t = this.options
                    , e = {
                    "z-Index": FX.STATIC.zIndex++
                }
                    , i = this.element.offset()
                    , a = this._getEdgeOption()
                    , n = document.body.clientWidth - i.left
                    , s = i.top - r("body").offset().top;
                return n < a.width ? (e.right = n - this.element.outerWidth() + t.hAdjust,
                    e.left = "auto") : (e.right = "auto",
                    e.left = i.left + t.hAdjust),
                    document.body.clientHeight + document.body.scrollTop - s - this.element.outerHeight() < a.height ? (e.top = "auto",
                        e.bottom = document.body.clientHeight - s) : (e.top = s + this.element.outerHeight(),
                        e.bottom = "auto"),
                    e
            },
            setValue: function(t) {
                this.setText(t)
            },
            setText: function(t) {
                this.editComp.val(t)
            },
            getValue: function() {
                return this.getText()
            },
            getText: function() {
                return this.editComp.val()
            },
            doResize: function(t) {
                FX.Trigger.superclass.doResize.apply(this, arguments);
                var e = this.options.height;
                this.element.css({
                    "line-height": e - 2 + "px"
                })
            }
        })
    }(jQuery),
    function(a) {
        FX.DateTime = FX.extend(FX.Trigger, {
            _defaultConfig: function() {
                return a.extend(FX.DateTime.superclass._defaultConfig.apply(), {
                    baseCls: "fui_datetime",
                    triggerIcon: "icon-widget-datetime",
                    startDate: null,
                    endDate: null,
                    allowBlank: !0,
                    format: "yyyy-MM-dd",
                    onAfterEdit: null,
                    defaultPickDate: null,
                    onStopEdit: null,
                    onStateChange: null,
                    edge: {
                        width: 460,
                        height: 315
                    }
                })
            },
            _init: function() {
                FX.DateTime.superclass._init.apply(this, arguments);
                var t = this.options;
                this.viewMode = FX.Utils.getDateTimeViewMode(t.format),
                    this.std = this._initStartDate(t.startDate, this.viewMode),
                    this.edd = this._initEndDate(t.endDate, this.viewMode)
            },
            _onTriggerClick: function() {
                var i;
                this.isEnabled() && ((i = this)._showDatePicker(),
                    a(document).bind("mousedown.datepicker", function(t) {
                        var e = t.target;
                        0 === a(e).closest(i.datepicker.element).length && i._hideDatePicker()
                    }))
            },
            _initStartDate: function(t, e) {
                if (!t)
                    return null;
                var i = FX.Utils.parseDate(t) || new Date(t);
                switch (e) {
                    case 0:
                        return new Date(i.getFullYear(),i.getMonth(),1,0,0,0);
                    case 1:
                        return new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);
                    case 2:
                        var a = new Date;
                        return a.setHours(0),
                            a.setMinutes(0),
                            a.setSeconds(0),
                            a;
                    case 3:
                        return new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0);
                    default:
                        return i
                }
            },
            _initEndDate: function(t, e) {
                if (!t)
                    return null;
                var i = FX.Utils.parseDate(t) || new Date(t)
                    , a = i.getFullYear()
                    , n = i.getMonth();
                switch (e) {
                    case 0:
                        return new Date(a,n,FX.Utils.getMonthDays(a, n),23,59,59);
                    case 1:
                        return new Date(a,n,i.getDate(),23,59,59);
                    case 2:
                        var s = new Date;
                        return s.setHours(23),
                            s.setMinutes(59),
                            s.setSeconds(59),
                            s;
                    case 3:
                        return new Date(a,n,i.getDate(),23,59,59);
                    default:
                        return i
                }
            },
            _createEditComp: function() {
                return a('<input class="fui_trigger-input" onfocus="this.blur();"/>').attr("UNSELECTABLE", "on").appendTo(this.element)
            },
            _showDatePicker: function() {
                var e = this
                    , i = this.options
                    , t = null
                    , t = this.value ? new Date(this.value) : i.defaultPickDate ? new Date(i.defaultPickDate) : new Date
                    , a = {
                    viewMode: this.viewMode,
                    startDate: this.std,
                    endDate: this.edd,
                    customCls: "x-dropdown",
                    date: t,
                    onDateUpdate: function() {
                        var t = this.getValue();
                        t ? e.setValue(t.getTime()) : e.setValue(null),
                            FX.Utils.applyFunc(e, i.onAfterEdit, arguments, !1)
                    },
                    onClear: function() {
                        e._hideDatePicker()
                    },
                    onOk: function() {
                        e._hideDatePicker()
                    },
                    onClose: function() {
                        e._hideDatePicker()
                    }
                };
                this.datepicker = new FX.DatetimePicker(a),
                    this.datepicker.element.appendTo("body").css(this._calTriggerViewPos()).show()
            },
            _hideDatePicker: function() {
                this.datepicker && (a(document).unbind("mousedown.datepicker"),
                    this.datepicker.element.remove(),
                    FX.Utils.applyFunc(this, this.options.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, this.options.onStateChange, [], !1))
            },
            checkValidate: function() {
                var t = this.options;
                return !(!t.allowBlank && FX.Utils.isEmpty(this.getValue())) && (!(t.startDate && this.value < t.startDate) && !(t.endDate && this.value > t.endDate))
            },
            getOptions: function() {
                var t = this.options;
                return a.extend(FX.DateTime.superclass.getOptions.apply(this, arguments), {
                    format: t.format
                })
            },
            rebuild: function(t) {
                t && a.extend(this.options, t),
                    FX.DateTime.superclass.rebuild.apply(this, arguments),
                this.datepicker && (this.datepicker.element.remove(),
                    this.datepicker = null)
            },
            setValue: function(t) {
                var e = this.options;
                this.value = FX.FormItemUtils.formatDateTimeValue(t, this.viewMode),
                    this.setText(this.value ? FX.Utils.date2Str(new Date(this.value), e.format) : null)
            },
            setText: function(t) {
                this.editComp.val(t)
            },
            getValue: function() {
                return this.value
            },
            getText: function() {
                return this.editComp.val()
            }
        }),
            a.shortcut("datetime", FX.DateTime)
    }(jQuery),
    function(F) {
        FX.DatetimePicker = FX.extend(FX.Widget, {
            CONST: {
                MIN_YEAR: 1900,
                MAX_YEAR: 2999,
                NAV: {
                    DATE_TITLE: {
                        PREV_YEAR: "d-prev-year",
                        PREV_MONTH: "d-prev-month",
                        YEAR: "d-year",
                        MONTH: "d-month",
                        NEXT_MONTH: "d-next-month",
                        NEXT_YEAR: "d-next-year"
                    },
                    MONTH_TITLE: {
                        PREV_YEAR: "m-prev-year",
                        YEAR: "m-year",
                        NEXT_YEAR: "m-next-year"
                    },
                    YEAR_TITLE: {
                        PREV_DECADE: "y-prev-decade",
                        NEXT_DECADE: "y-next-decade"
                    },
                    DATE_FOOTER: {
                        TODAY: "d-today",
                        CLEAR: "d-clear"
                    },
                    MONTH_FOOTER: {
                        CURRENT_MONTH: "m-current-month",
                        CLEAR: "m-clear"
                    },
                    TIME_FOOTER: {
                        CLEAR: "t-clear",
                        OK: "t-ok"
                    },
                    DATE_TIME_FOOTER: {
                        CURRENT_TIME: "dt-current-time",
                        CLEAR: "dt-clear",
                        OK: "dt-ok"
                    },
                    BODY: {
                        YEAR: "b-year",
                        MONTH: "b-month",
                        DAY: "b-day",
                        HOUR: "b-hour",
                        MINUTE: "b-minute",
                        SECOND: "b-second"
                    }
                },
                PANE: {
                    DATE: "date",
                    MONTH: "month",
                    YEAR: "year"
                },
                CLS: {
                    NAV_BTN: "nav-btn",
                    DISABLE: "disabled",
                    SELECT: "select",
                    FLOAT_PANE: "float-pane",
                    MODE: {
                        0: "mode-ym",
                        1: "mode-ymd",
                        2: "mode-hms",
                        3: "mode-ymd-hms",
                        4: "mode-hm",
                        5: "mode-ymd-hm"
                    }
                }
            },
            _defaultConfig: function() {
                return F.extend(FX.DatetimePicker.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui-datetime-picker",
                    viewMode: FX.CONST.DATE_VIEW_MODE.YMD,
                    startDate: null,
                    endDate: null,
                    date: null,
                    hasFooterBtn: !0,
                    isWidthStretch: !1,
                    onDateUpdate: null,
                    onClear: null,
                    onOk: null,
                    onClose: null
                })
            },
            _init: function() {
                FX.DatetimePicker.superclass._init.apply(this, arguments);
                var t = this.options;
                this.startDate = t.startDate || new Date(this.CONST.MIN_YEAR,0,1,0,0,0),
                    this.endDate = t.endDate || new Date(this.CONST.MAX_YEAR,11,31,23,59,59),
                    this.date = this._getInRangeDate(t.date),
                    this.$datePaneWrapper = F('<div class="date-pane-wrapper"/>').appendTo(this.element),
                    this._initContent(),
                    this._bindEvent(),
                    this.element.addClass(this.CONST.CLS.MODE[t.viewMode]),
                t.isWidthStretch && this.element.addClass("width-stretch")
            },
            _getInRangeDate: function(t) {
                var e = FX.Utils.parseDate(t) || new Date;
                return e < this.startDate ? new Date(this.startDate) : e > this.endDate ? new Date(this.endDate) : t
            },
            _initContent: function() {
                var t = this.options
                    , e = FX.CONST.DATE_VIEW_MODE;
                switch (t.viewMode) {
                    case e.YM:
                        this._initMonthPane();
                        break;
                    case e.YMD:
                        this._initDatePane();
                        break;
                    case e.YMD_HM:
                    case e.YMD_HMS:
                        this._initDatePane(),
                            this._initTimePane();
                        break;
                    case e.HM:
                    case e.HMS:
                        this._initTimePane()
                }
                this._initFooter()
            },
            _bindEvent: function() {
                var o = this
                    , l = this.options
                    , c = this.CONST.NAV
                    , d = this.CONST.CLS
                    , u = this.CONST.PANE
                    , h = FX.CONST.DATE_VIEW_MODE;
                this.element.on("click", function(t) {
                    var e = F(t.target).closest("." + d.NAV_BTN);
                    if (e && !e.hasClass(d.DISABLE)) {
                        var i, a, n = e.data("value"), s = FX.Utils.getDateInfo(o.date), r = FX.Utils.getDateInfo(new Date);
                        switch (e.attr("role")) {
                            case c.DATE_TITLE.PREV_YEAR:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, -1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.DATE_TITLE.PREV_MONTH:
                                o.date = o._getInRangeDate(FX.Utils.getDateByMonthOffset(o.date, -1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.DATE_TITLE.YEAR:
                                o._initYearPane();
                                break;
                            case c.DATE_TITLE.MONTH:
                                o._initMonthPane(),
                                    o.$monthPane.addClass(d.FLOAT_PANE);
                                break;
                            case c.DATE_TITLE.NEXT_MONTH:
                                o.date = o._getInRangeDate(FX.Utils.getDateByMonthOffset(o.date, 1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.DATE_TITLE.NEXT_YEAR:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, 1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.MONTH_TITLE.PREV_YEAR:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, -1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.MONTH_TITLE.YEAR:
                                o._initYearPane();
                                break;
                            case c.MONTH_TITLE.NEXT_YEAR:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, 1)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.YEAR_TITLE.PREV_DECADE:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, -10)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.YEAR_TITLE.NEXT_DECADE:
                                o.date = o._getInRangeDate(FX.Utils.getDateByYearOffset(o.date, 10)),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.MONTH_FOOTER.CURRENT_MONTH:
                                i = Math.min(FX.Utils.getMonthDays(r.year, r.month), s.day),
                                    a = new Date(r.year,r.month,i,s.hour,s.minute,s.second),
                                    o.date = o._getInRangeDate(a),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    FX.Utils.applyFunc(o, l.onClose, [], !1);
                                break;
                            case c.DATE_FOOTER.TODAY:
                                a = new Date(r.year,r.month,r.day,s.hour,s.minute,s.second),
                                    o.date = o._getInRangeDate(a),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    FX.Utils.applyFunc(o, l.onClose, [], !1);
                                break;
                            case c.DATE_TIME_FOOTER.CURRENT_TIME:
                                o.date = o._getInRangeDate(new Date),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    FX.Utils.applyFunc(o, l.onClose, [], !1);
                                break;
                            case c.DATE_TIME_FOOTER.CLEAR:
                            case c.MONTH_FOOTER.CLEAR:
                            case c.DATE_FOOTER.CLEAR:
                            case c.TIME_FOOTER.CLEAR:
                                o.date = null,
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    FX.Utils.applyFunc(o, l.onClear, [], !1);
                                break;
                            case c.TIME_FOOTER.OK:
                            case c.DATE_TIME_FOOTER.OK:
                                FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    FX.Utils.applyFunc(o, l.onOk, [], !1);
                                break;
                            case c.BODY.YEAR:
                                i = Math.min(FX.Utils.getMonthDays(n, s.month), s.day),
                                    a = new Date(n,s.month,i,s.hour,s.minute,s.second),
                                    o.date = o._getInRangeDate(a),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                o._isFloatPane(o.$yearPane) && o._hideFloatPane(u.YEAR);
                                break;
                            case c.BODY.MONTH:
                                i = Math.min(FX.Utils.getMonthDays(s.year, n), s.day),
                                    a = new Date(s.year,n,i,s.hour,s.minute,s.second),
                                    o.date = o._getInRangeDate(a),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                    o._isFloatPane(o.$monthPane) ? o._hideFloatPane(u.MONTH) : FX.Utils.applyFunc(o, l.onClose, [], !1);
                                break;
                            case c.BODY.DAY:
                                a = new Date(s.year,s.month,n,s.hour,s.minute,s.second),
                                    o.date = o._getInRangeDate(a),
                                    o._loadValue(),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1),
                                l.viewMode === h.YMD && FX.Utils.applyFunc(o, l.onClose, [], !1);
                                break;
                            case c.BODY.HOUR:
                                o.date = new Date(s.year,s.month,s.day,n,s.minute,s.second),
                                    o._loadValue2TimePane(!0),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.BODY.MINUTE:
                                o.date = new Date(s.year,s.month,s.day,s.hour,n,s.second),
                                    o._loadValue2TimePane(!0),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1);
                                break;
                            case c.BODY.SECOND:
                                o.date = new Date(s.year,s.month,s.day,s.hour,s.minute,n),
                                    o._loadValue2TimePane(!0),
                                    FX.Utils.applyFunc(o, l.onDateUpdate, [], !1)
                        }
                    }
                })
            },
            _createTitleNav: function(t) {
                var e = this.CONST.PANE
                    , i = this.CONST.NAV
                    , a = this.CONST.CLS
                    , n = F('<div class="title-nav"><div class="left"/><div class="center"/><div class="right"/></div>')
                    , s = F(".left", n)
                    , r = F(".center", n)
                    , o = F(".right", n)
                    , l = F('<i class="' + a.NAV_BTN + ' title-btn-first icon-firstpage"/>')
                    , c = F('<i class="' + a.NAV_BTN + ' title-btn-prev icon-angleleft"/>')
                    , d = F('<i class="' + a.NAV_BTN + ' title-btn-next icon-angleright"/>')
                    , u = F('<i class="' + a.NAV_BTN + ' title-btn-last icon-lastpage"/>')
                    , h = F('<div class="' + a.NAV_BTN + ' title-btn-year"/>')
                    , p = F('<div class="' + a.NAV_BTN + ' title-btn-month"/>')
                    , f = F('<div class="title-decade"/>');
                switch (t) {
                    case e.DATE:
                        l.attr("role", i.DATE_TITLE.PREV_YEAR).appendTo(s),
                            c.attr("role", i.DATE_TITLE.PREV_MONTH).appendTo(s),
                            h.attr("role", i.DATE_TITLE.YEAR).appendTo(r),
                            p.attr("role", i.DATE_TITLE.MONTH).appendTo(r),
                            d.attr("role", i.DATE_TITLE.NEXT_MONTH).appendTo(o),
                            u.attr("role", i.DATE_TITLE.NEXT_YEAR).appendTo(o);
                        break;
                    case e.MONTH:
                        l.attr("role", i.MONTH_TITLE.PREV_YEAR).appendTo(s),
                            h.attr("role", i.MONTH_TITLE.YEAR).appendTo(r),
                            u.attr("role", i.MONTH_TITLE.NEXT_YEAR).appendTo(o);
                        break;
                    case e.YEAR:
                        l.attr("role", i.YEAR_TITLE.PREV_DECADE).appendTo(s),
                            f.appendTo(r),
                            u.attr("role", i.YEAR_TITLE.NEXT_DECADE).appendTo(o)
                }
                return n
            },
            _createDateSelect: function() {
                for (var t = this.CONST.NAV, e = this.CONST.CLS, i = F('<table class="date-select-table"/>'), a = F("<thead/>").appendTo(i), n = F("<tbody/>").appendTo(i), s = F("<tr/>").appendTo(a), r = 0; r < 7; r++)
                    F("<td>" + FX.Utils.getDateSDN()[r] + "</td>").appendTo(s);
                for (var o = 0; o < 6; o++)
                    for (var l = F("<tr/>").appendTo(n), c = 0; c < 7; c++)
                        F('<td><div class="' + e.NAV_BTN + ' td-text" role="' + t.BODY.DAY + '"/></td>').appendTo(l);
                return i
            },
            _createMonthSelect: function() {
                for (var t = this.CONST.NAV, e = this.CONST.CLS, i = F('<div class="select-grid"/>'), a = 0; a < 12; a++)
                    i.append(F('<div class="grid-item"><div class="' + e.NAV_BTN + ' grid-text" role="' + t.BODY.MONTH + '">' + FX.Utils.getDateMN()[a] + "</div></div>"));
                return i
            },
            _createYearSelect: function() {
                for (var t = this.CONST.NAV, e = this.CONST.CLS, i = F('<div class="select-grid"/>'), a = 0; a < 12; a++)
                    i.append(F('<div class="grid-item"><div class="' + e.NAV_BTN + ' grid-text" role="' + t.BODY.YEAR + '">' + a + "</div></div>"));
                return i
            },
            _createTimeCol: function(t, e, i) {
                for (var a = this.CONST.CLS, n = F('<div class="time-col"><div class="label">' + e + "</div></div>"), s = F('<div class="col-list"/>').appendTo(n), r = 0; r < i; r++)
                    F('<div class="' + a.NAV_BTN + ' col-item" role="' + t + '" data-value="' + r + '">' + FX.Utils.leftPad(String(r), 2, "0") + "</div>").appendTo(s);
                return n
            },
            _scrollTimeCol: function(t, e, i) {
                var a = F(".col-list", t);
                i ? a.animate({
                    scrollTop: 30 * e
                }, "fast") : a.scrollTop(30 * e)
            },
            _selectTimeCol: function(t, e, i) {
                var a = this.CONST.CLS;
                F(".col-item", t).removeClass(a.SELECT).eq(e).addClass(a.SELECT),
                    this._scrollTimeCol(t, e, i)
            },
            _getNavDisableInfo: function() {
                var t = FX.Utils.getDateInfo(this.date)
                    , e = FX.Utils.getDateInfo(this.startDate)
                    , i = FX.Utils.getDateInfo(this.endDate)
                    , a = t.year === e.year
                    , n = a && t.month <= e.month
                    , s = t.year === i.year
                    , r = s && t.month >= i.month
                    , o = FX.Utils.getDateDecadeRange(this.date);
                return {
                    prevDecadeDisable: e.year >= o[0],
                    prevYearDisable: a,
                    prevMonthDisable: n,
                    nextMonthDisable: r,
                    nextYearDisable: s,
                    nextDecadeDisable: i.year <= o[1]
                }
            },
            _loadValue: function() {
                this._loadValue2DatePane(),
                    this._loadValue2MonthPane(),
                    this._loadValue2YearPane(),
                    this._loadValue2TimePane()
            },
            _loadValue2DatePane: function() {
                if (this.$datePane) {
                    var t = FX.Utils.getDateInfo(this.date)
                        , e = F(".title-nav", this.$datePane);
                    F(".title-btn-year", e).text(t.year + i18next.t("year")),
                        F(".title-btn-month", e).text(FX.Utils.getDateMN()[t.month]);
                    var i = this._getNavDisableInfo()
                        , s = this.CONST.CLS;
                    F(".title-btn-first", e).toggleClass(s.DISABLE, i.prevYearDisable),
                        F(".title-btn-prev", e).toggleClass(s.DISABLE, i.prevMonthDisable),
                        F(".title-btn-next", e).toggleClass(s.DISABLE, i.nextMonthDisable),
                        F(".title-btn-last", e).toggleClass(s.DISABLE, i.nextYearDisable);
                    for (var a = FX.Utils.getDateInfo(FX.Utils.getDateByMonthOffset(this.date, -1)), n = FX.Utils.getMonthDays(a.year, a.month), r = FX.Utils.getMonthDays(t.year, t.month), o = new Date(t.year,t.month,1).getDay(), l = [], c = 0; c < o; c++)
                        l.push({
                            enable: !1,
                            n: n--
                        });
                    l.reverse();
                    for (var d = FX.Utils.getDateInfo(new Date), u = FX.Utils.getDateInfo(this.startDate), h = FX.Utils.getDateInfo(this.endDate), p = 0; p < r; p++) {
                        var f = !0
                            , m = p + 1;
                        u.year === t.year && u.month === t.month && (f = m >= u.day),
                        f && h.year === t.year && h.month === t.month && (f = m <= h.day),
                            l.push({
                                enable: f,
                                n: m,
                                today: m === d.day && t.month === d.month && t.year === d.year,
                                select: m === t.day && !FX.Utils.isEmpty(this.date)
                            })
                    }
                    for (var g = 42 - l.length, _ = 0; _ < g; _++)
                        l.push({
                            enable: !1,
                            n: _ + 1
                        });
                    var v = F("tbody", this.$datePane);
                    FX.Utils.forEach(F("tr", v), function(n, t) {
                        var e = F(t);
                        FX.Utils.forEach(F("td", e), function(t, e) {
                            var i = F(".td-text", F(e))
                                , a = l[7 * n + t];
                            i.text(a.n).data("value", a.n).toggleClass(s.DISABLE, !a.enable).toggleClass("today", !!a.today).toggleClass(s.SELECT, !!a.select)
                        })
                    })
                }
            },
            _loadValue2MonthPane: function() {
                if (this.$monthPane) {
                    var t = this.CONST.CLS
                        , e = FX.Utils.getDateInfo(this.date)
                        , i = F(".title-nav", this.$monthPane);
                    F(".title-btn-year", i).text(e.year);
                    var a = this._getNavDisableInfo();
                    F(".title-btn-first", i).toggleClass(t.DISABLE, a.prevYearDisable),
                        F(".title-btn-last", i).toggleClass(t.DISABLE, a.nextYearDisable);
                    for (var n = FX.Utils.getDateInfo(this.startDate), s = FX.Utils.getDateInfo(this.endDate), r = F(".grid-text", this.$monthPane), o = 0; o < 12; o++) {
                        var l = !0
                            , c = !1;
                        n.year === e.year && (l = o >= n.month),
                        l && s.year === e.year && (l = o <= s.month),
                        o !== e.month || FX.Utils.isEmpty(this.date) || (c = !0),
                            r.eq(o).data("value", o).toggleClass(t.DISABLE, !l).toggleClass(t.SELECT, c)
                    }
                }
            },
            _loadValue2TimePane: function(t) {
                var e, i, a, n, s;
                this.$timePane && (e = F(".time-label", this.$timePane),
                    i = this._showSecondCol() ? "HH:mm:ss" : "HH:mm",
                    a = this.date || new Date,
                    e.text(FX.Utils.date2Str(a, i)),
                    n = FX.Utils.getDateInfo(a),
                    s = F(".time-col", this.$timePane),
                    this._selectTimeCol(s.eq(0), n.hour, t),
                    this._selectTimeCol(s.eq(1), n.minute, t),
                this._showSecondCol() && this._selectTimeCol(s.eq(2), n.second, t))
            },
            _loadValue2YearPane: function() {
                if (this.$yearPane) {
                    var t = this.CONST.CLS
                        , e = F(".title-nav", this.$yearPane)
                        , i = F(".title-decade", e)
                        , a = FX.Utils.getDateDecadeRange(this.date)
                        , n = a.join("~");
                    i.text(n);
                    var s = this._getNavDisableInfo();
                    F(".title-btn-first", e).toggleClass(t.DISABLE, s.prevDecadeDisable),
                        F(".title-btn-last", e).toggleClass(t.DISABLE, s.nextDecadeDisable);
                    for (var r = FX.Utils.getDateInfo(this.date), o = FX.Utils.getDateInfo(this.startDate), l = FX.Utils.getDateInfo(this.endDate), c = F(".grid-text", this.$yearPane), d = 0; d < 12; d++) {
                        var u = !0
                            , h = !1
                            , p = a[0] + d - 1;
                        0 === d || 11 === d ? u = !1 : (o.year > p && (u = !1),
                        u && l.year < p && (u = !1),
                        p !== r.year || FX.Utils.isEmpty(this.date) || (h = !0)),
                            c.eq(d).text(p).data("value", p).toggleClass(t.DISABLE, !u).toggleClass(t.SELECT, h)
                    }
                }
            },
            _initDatePane: function() {
                this.$datePane || (this.$datePane = F('<div class="date-pane"/>').appendTo(this.$datePaneWrapper),
                    this._createTitleNav(this.CONST.PANE.DATE).appendTo(this.$datePane),
                    this._createDateSelect().appendTo(this.$datePane)),
                    this._loadValue2DatePane()
            },
            _initMonthPane: function() {
                this.$monthPane || (this.$monthPane = F('<div class="month-pane"/>').appendTo(this.$datePaneWrapper),
                    this._createTitleNav(this.CONST.PANE.MONTH).appendTo(this.$monthPane),
                    this._createMonthSelect().appendTo(this.$monthPane)),
                    this._loadValue2MonthPane()
            },
            _initTimePane: function() {
                var t, e = this, i = this.CONST.NAV;
                this.$timePane ? this._loadValue2TimePane() : (this.$timePane = F('<div class="time-pane in-visible"><div class="time-label"/></div>').appendTo(this.element),
                    t = F('<div class="time-col-wrapper"/>').appendTo(this.$timePane),
                    this._createTimeCol(i.BODY.HOUR, i18next.t("hour"), 24).appendTo(t),
                    this._createTimeCol(i.BODY.MINUTE, i18next.t("minute"), 60).appendTo(t),
                this._showSecondCol() && this._createTimeCol(i.BODY.SECOND, i18next.t("second"), 60).appendTo(t),
                    setTimeout(function() {
                        e._loadValue2TimePane(),
                            e.$timePane.removeClass("in-visible")
                    }))
            },
            _initYearPane: function() {
                var t;
                this.$yearPane || (t = this.CONST.CLS,
                    this.$yearPane = F('<div class="year-pane ' + t.FLOAT_PANE + '"/>').appendTo(this.$datePaneWrapper),
                    this._createTitleNav(this.CONST.PANE.YEAR).appendTo(this.$yearPane),
                    this._createYearSelect().appendTo(this.$yearPane)),
                    this._loadValue2YearPane()
            },
            _showSecondCol: function() {
                var t = this.options
                    , e = FX.CONST.DATE_VIEW_MODE;
                return -1 < [e.HMS, e.YMD_HMS].indexOf(t.viewMode)
            },
            _isFloatPane: function(t) {
                return t && t.hasClass(this.CONST.CLS.FLOAT_PANE)
            },
            _hideFloatPane: function(t) {
                var e = this.CONST.PANE;
                switch (t) {
                    case e.YEAR:
                        this.$yearPane.remove(),
                            this.$yearPane = null;
                        break;
                    case e.MONTH:
                        this.$monthPane.remove(),
                            this.$monthPane = null
                }
            },
            _initFooter: function() {
                var t = this.options;
                if (t.hasFooterBtn) {
                    var e = FX.CONST.DATE_VIEW_MODE
                        , i = this.CONST.NAV
                        , a = this.CONST.CLS
                        , n = F('<div class="footer-pane"><div class="left"/><div class="right"/></div>')
                        , s = F(".left", n)
                        , r = F(".right", n);
                    switch (t.viewMode) {
                        case e.YM:
                            F('<div class="' + a.NAV_BTN + ' green">' + i18next.t("date.thisMonth") + "</div>").attr("role", i.MONTH_FOOTER.CURRENT_MONTH).appendTo(s),
                                F('<div class="' + a.NAV_BTN + ' normal">' + i18next.t("clear") + "</div>").attr("role", i.MONTH_FOOTER.CLEAR).appendTo(r),
                                n.appendTo(this.$datePaneWrapper);
                            break;
                        case e.YMD:
                            F('<div class="' + a.NAV_BTN + ' green">' + i18next.t("today") + "</div>").attr("role", i.DATE_FOOTER.TODAY).appendTo(s),
                                F('<div class="' + a.NAV_BTN + ' normal">' + i18next.t("clear") + "</div>").attr("role", i.DATE_FOOTER.CLEAR).appendTo(r),
                                n.appendTo(this.$datePaneWrapper);
                            break;
                        case e.YMD_HM:
                        case e.YMD_HMS:
                            F('<div class="' + a.NAV_BTN + ' green">' + i18next.t("now") + "</div>").attr("role", i.DATE_TIME_FOOTER.CURRENT_TIME).appendTo(s),
                                F('<div class="' + a.NAV_BTN + ' normal">' + i18next.t("clear") + "</div>").attr("role", i.DATE_TIME_FOOTER.CLEAR).appendTo(r),
                                F('<div class="' + a.NAV_BTN + ' primary">' + i18next.t("ok") + "</div>").attr("role", i.DATE_TIME_FOOTER.OK).appendTo(r),
                                n.appendTo(this.element);
                            break;
                        case e.HM:
                        case e.HMS:
                            F('<div class="' + a.NAV_BTN + ' normal">' + i18next.t("clear") + "</div>").attr("role", i.TIME_FOOTER.CLEAR).appendTo(s),
                                F('<div class="' + a.NAV_BTN + ' primary">' + i18next.t("ok") + "</div>").attr("role", i.TIME_FOOTER.OK).appendTo(r),
                                n.appendTo(this.element)
                    }
                }
            },
            getValue: function() {
                if (FX.Utils.isEmpty(this.date))
                    return null;
                var t = FX.Utils.getDateInfo(this.date)
                    , e = this.options
                    , i = FX.CONST.DATE_VIEW_MODE;
                switch (e.viewMode) {
                    case i.YM:
                        return new Date(t.year,t.month,1,0,0,0);
                    case i.YMD:
                        return new Date(t.year,t.month,t.day,0,0,0);
                    case i.HM:
                    case i.YMD_HM:
                        return new Date(t.year,t.month,t.day,t.hour,t.minute,0);
                    case i.HMS:
                    case i.YMD_HMS:
                    default:
                        return new Date(this.date)
                }
            },
            setValue: function(t) {
                this.date = FX.Utils.parseDate(t) || new Date
            },
            rebuild: function() {
                this.$datePaneWrapper = null,
                    this.$datePane = null,
                    this.$monthPane = null,
                    this.$yearPane = null,
                    this.$timePane = null,
                    this.element.off("click"),
                    this.options.date = this.date,
                    FX.DatetimePicker.superclass.rebuild.apply(this, arguments)
            }
        })
    }(jQuery),
    function(u) {
        FX.DateRange = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return u.extend(FX.DateRange.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_date_range",
                    format: "yyyy-MM-dd",
                    onStopEdit: null
                })
            },
            _init: function() {
                FX.DateRange.superclass._init.apply(this, arguments),
                    this.viewMode = this._initViewMode(),
                    this.value = {
                        min: null,
                        max: null
                    };
                var t = u('<div class="range-content"/>').appendTo(this.element);
                this._createMenu(t),
                    this._createMain(t)
            },
            _initViewMode: function() {
                var t = this.options;
                return FX.Utils.getDateTimeViewMode(t.format)
            },
            _createMenu: function(a) {
                var n = this
                    , s = this.options
                    , t = u('<div class="content-menu"/>').on("click", function(t) {
                    var e = u(t.target).closest(".icon-close-circle");
                    if (e && e.length)
                        return e.closest(".menu-item").hasClass("start") ? n._setSingleValue("start", null) : n._setSingleValue("end", null),
                            t.preventDefault(),
                            FX.Utils.applyFunc(n, s.onStopEdit, [], !1),
                            !1;
                    var i = u(t.target).closest(".menu-item");
                    i && i.length && !i.hasClass("select") && (i.addClass("select").siblings().removeClass("select"),
                        a.toggleClass("for-right"))
                }).appendTo(a);
                this.$start = u('<div class="menu-item start select"/>').appendTo(t),
                    u('<div class="watermark"/>').text(i18next.t("timeBegin")).appendTo(this.$start),
                    u('<i class="icon-close-circle"/>').appendTo(this.$start),
                    this.$end = u('<div class="menu-item"/>').appendTo(t),
                    u('<div class="watermark"/>').text(i18next.t("timeEnd")).appendTo(this.$end),
                    u('<i class="icon-close-circle"/>').appendTo(this.$end),
                    u('<div class="menu-line"/>').appendTo(t)
            },
            _createMain: function(t) {
                var e = this
                    , i = this.value.min
                    , a = this.value.max
                    , n = this.options
                    , s = u('<div class="content-main"/>').appendTo(t)
                    , r = u('<div class="main-wrapper"/>').appendTo(s)
                    , o = this.options.width
                    , l = i || (new Date).setHours(0, 0, 0, 0)
                    , c = a || (new Date).setHours(0, 0, 0, 0);
                this.startDate = new FX.DatetimePicker({
                    renderEl: u("<div/>").appendTo(r),
                    customCls: "range-picker",
                    viewMode: this.viewMode,
                    date: new Date(l),
                    hasFooterBtn: !1,
                    isWidthStretch: !0,
                    width: o,
                    onDateUpdate: function() {
                        var t = this.getValue();
                        t ? e._setSingleValue("start", t.getTime()) : e._setSingleValue("start", null),
                            FX.Utils.applyFunc(e, n.onStopEdit, [], !1)
                    }
                });
                var d = u('<div class="main-wrapper"/>').appendTo(s);
                this.endDate = new FX.DatetimePicker({
                    renderEl: u("<div/>").appendTo(d),
                    customCls: "range-picker",
                    viewMode: this.viewMode,
                    date: new Date(c),
                    hasFooterBtn: !1,
                    isWidthStretch: !0,
                    width: o,
                    onDateUpdate: function() {
                        var t = this.getValue();
                        t ? e._setSingleValue("end", t.getTime()) : e._setSingleValue("end", null),
                            FX.Utils.applyFunc(e, n.onStopEdit, [], !1)
                    }
                })
            },
            _setSingleValue: function(t, e) {
                "start" === t ? (this.value.min = e,
                    this._setItemText(e, this.$start),
                    this.endDate.options.startDate = e ? new Date(e) : null,
                    this.endDate.rebuild()) : (this.value.max = e,
                    this._setItemText(e, this.$end),
                    this.startDate.options.endDate = e ? new Date(e) : null,
                    this.startDate.rebuild())
            },
            _setItemText: function(t, e) {
                var i, a, n, s = this.options;
                u(".item-text,.item-sub", e).remove(),
                t && (i = FX.Utils.isDate(t) ? t : new Date(t),
                    a = FX.Utils.date2Str(i, s.format),
                    n = FX.CONST.DATE_VIEW_MODE,
                    this.viewMode === n.YMD_HM || this.viewMode === n.YMD_HMS ? (u('<div class="item-sub"/>').text(a.split(" ")[1]).prependTo(e),
                        u('<div class="item-text sub"/>').text(a.split(" ")[0]).prependTo(e)) : u('<div class="item-text"/>').text(a.split(" ")[0]).prependTo(e))
            },
            doResize: function(t) {
                FX.DateRange.superclass.doResize.apply(this, arguments);
                var e = t && t.width;
                FX.Utils.isEmpty(e) || (this.startDate.doResize({
                    width: e
                }),
                    this.endDate.doResize({
                        width: e
                    }))
            },
            setValue: function(t) {
                var e, i = FX.Utils.isObjectEmpty(t) ? e = null : (e = t.min,
                    t.max);
                this.startDate.setValue(new Date(e || (new Date).setHours(0, 0, 0, 0))),
                    this.endDate.setValue(new Date(i || (new Date).setHours(0, 0, 0, 0))),
                    this._setSingleValue("start", e),
                    this._setSingleValue("end", i)
            },
            getValue: function() {
                return this.value
            }
        }),
            u.shortcut("daterange", FX.DateRange)
    }(jQuery),
    function(c) {
        FX.ComboBox = FX.extend(FX.Trigger, {
            _defaultConfig: function() {
                return c.extend(FX.ComboBox.superclass._defaultConfig.apply(), {
                    baseCls: "fui_combo",
                    triggerIcon: "icon-caret-down",
                    triggerList: "combo-list",
                    textField: "text",
                    valueField: "value",
                    allowBlank: !0,
                    async: null,
                    asyncResultKey: "items",
                    colorEnable: !1,
                    items: [{
                        value: "1",
                        text: "1"
                    }, {
                        value: "2",
                        text: "2"
                    }, {
                        value: "3",
                        text: "3"
                    }],
                    text4InvalidValue: "",
                    cls4InvalidValue: "error-invalid-value",
                    searchable: !0,
                    onItemCreate: null,
                    onAfterItemSelect: null,
                    onAfterInitDefaultValue: null,
                    onAfterTriggerHide: null,
                    onStateChange: null,
                    limitData: 300,
                    emptyTip: null,
                    minWidth4Trigger: 160
                })
            },
            _init: function() {
                FX.ComboBox.superclass._init.apply(this, arguments),
                    this._initStoreValue(),
                this.options.async && !this._hasDefaultValue() || this._createTriggerView()
            },
            _createEditComp: function() {
                var t = this.options
                    , e = c('<div class="combo-value-wrapper"/>').appendTo(this.element);
                return t.colorEnable || e.addClass("text-mode"),
                    e
            },
            _initStoreValue: function() {
                var i = this
                    , a = this.options;
                this.text = null,
                    this.value = null,
                    this.selectedItem = null,
                    FX.Utils.forEach(a.items, function(t, e) {
                        e.selected && (i.value = e[a.valueField],
                            i.text = e[a.textField],
                            i.selectedItem = e)
                    })
            },
            _hasDefaultValue: function() {
                return !FX.Utils.isEmpty(this.options.value)
            },
            _onTriggerClick: function(t) {
                var i;
                this.isEnabled() && (this._showTriggerView(),
                    i = this,
                    c(document).bind("mousedown.trigger", function(t) {
                        var e = t.target;
                        0 === c(e).closest(i.triggerView).length && i._hideTriggerView()
                    }))
            },
            _hideTriggerView: function() {
                var t = this.options;
                if (this.triggerView) {
                    if (c(document).unbind("mousedown.trigger"),
                        this.triggerView.detach(),
                        FX.Utils.applyFunc(this, t.onAfterTriggerHide, [], !1),
                        !this.changed)
                        return;
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1),
                        FX.Utils.applyFunc(this, t.onStateChange, [], !1)
                }
            },
            _showTriggerView: function() {
                var t = this.options;
                null == this.triggerView && this._createTriggerView(),
                    this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.options.searchable && this.triggerView.find("input").focus(),
                    this.$listView.css({
                        maxWidth: Math.max(240, this.element.width()),
                        minWidth: t.minWidth4Trigger
                    }),
                    this.changed = !1
            },
            _getEdgeOption: function() {
                var t = this.options;
                return t.searchable ? {
                    width: t.edge.width,
                    height: t.edge.height + c(".fui_combo-search", this.triggerView).outerHeight()
                } : t.edge
            },
            _createTriggerView: function() {
                var i, t;
                this.triggerView = c('<div class="x-dropdown"/>'),
                    this.valueMap = {},
                this.options.searchable && (i = this,
                    t = c('<div class="fui_combo-search"/>').appendTo(this.triggerView),
                    c("<input/>").bind("input propertychange", function(t) {
                        var e;
                        i.searchValue !== this.value && (i.searchinterval && clearTimeout(i.searchinterval),
                            i.searchValue = this.value,
                            i.$listView.empty(),
                            e = i._createLoadingIcon(i18next.t("searching")),
                            i.searchinterval = setTimeout(function() {
                                e.remove(),
                                    i.startIndex = 0,
                                    i._onBeforeItemsLoaded(),
                                    i._createItemList(i.searchValue)
                            }, 500))
                    }).appendTo(t),
                    t.append(c('<i class="icon-search search-icon"/>'))),
                    this.$listView = c('<div class="x-dropdown-list"/>').addClass(this.options.triggerList).appendTo(this.triggerView),
                    this._onLoadItems(),
                    this._bindViewEvts()
            },
            _hideItems: function(a) {
                var t = this.$listView.children(".x-dropdown-item");
                FX.Utils.forEach(t, function(t, e) {
                    var i = c(e);
                    i.text().indexOf(a) < 0 && i.addClass("hide")
                })
            },
            _onLoadItems: function(i) {
                var t, a, n = this.options, s = this;
                if (n.async && n.async.url)
                    this.items ? (s._onBeforeItemsLoaded(),
                        FX.Utils.forEach(this.items, function(t, e) {
                            s._onItemCreate(e, t, i)
                        })) : (t = FX.Utils.applyFunc(this, n.onBeforeAsync, [], !1),
                    n.async.data && (n.async.data.filter = t),
                        a = this._createLoadingIcon(i18next.t("loading")),
                        FX.Utils.dataAjax({
                            url: n.async.url,
                            data: c.extend(FX.Utils.applyFunc(this, n.onGetAjaxData, [], {}), n.async.data)
                        }, function(t, e) {
                            a.remove(),
                                s._onBeforeItemsLoaded(),
                                s.items = FX.Utils.applyFunc(s, n.onAsyncSuccess, [t], !1),
                                !1 === s.items ? (s.items = [],
                                    s.startIndex = 0,
                                    FX.Utils.forEach(t[n.asyncResultKey], function(t, e) {
                                        var i = {};
                                        FX.Utils.isEmpty(e) || (i[n.textField] = e[n.textField] || e,
                                            i[n.valueField] = e[n.valueField] || e,
                                            s.items.push(i))
                                    }),
                                    s.items = s._sortItems(s.items),
                                    s._createItemList(i)) : FX.Utils.forEach(s.items, function(t, e) {
                                    s._onItemCreate(e, t, i)
                                }),
                                s._onAfterItemsLoaded()
                        }, function(t) {
                            var e = t.responseJSON;
                            e && e.code && FX.Utils.applyFunc(this, n.onLinkErr, [e.code], !1),
                                a.remove()
                        }));
                else if (n.items) {
                    if (s._onBeforeItemsLoaded(),
                        FX.Utils.isArray(n.items))
                        this.items = n.items,
                            FX.Utils.forEach(n.items, function(t, e) {
                                s._onItemCreate(e, t, i)
                            });
                    else {
                        this.items = [];
                        var e = 0;
                        for (var r in n.items) {
                            var o = {};
                            o[n.valueField] = r,
                                o[n.textField] = n.items[r],
                                s.items.push(o),
                                s._onItemCreate(o, e, i),
                                e++
                        }
                    }
                    s._onAfterItemsLoaded()
                }
            },
            _sortItems: function(t) {
                var n = this.options;
                return t.sort(function(t, e) {
                    var i = t[n.valueField] || t[n.textField] || t
                        , a = e[n.valueField] || e[n.textField] || e;
                    return +(a < i) || (i === a) - 1
                })
            },
            _createItemList: function(t) {
                var e = this.options;
                this.items || (this.items = []),
                    this.startIndex = this.startIndex || 0;
                for (var i = 0, a = !0; i < e.limitData; ) {
                    if (this.startIndex >= this.items.length) {
                        a = !1;
                        break
                    }
                    var n = this.items[this.startIndex];
                    this.startIndex++,
                    !1 !== this._onItemCreate(n, i, t) && i++
                }
                a && this._bindLoadMore(t)
            },
            _bindLoadMore: function(t) {
                var e = this;
                this.$listView.bind("scroll.loadMore", function() {
                    e.$listView.scrollTop() + e.$listView.outerHeight() + 100 >= e.$listView.prop("scrollHeight") && (e.$listView.unbind("scroll.loadMore"),
                        e._createItemList(t))
                })
            },
            _createLoadingIcon: function(t) {
                var e = this.$listView.children(".loading-text");
                return 0 === e.length && (e = c('<div class="loading-text"/>').appendTo(this.$listView),
                    c("<span/>").text(t).appendTo(e)),
                    e
            },
            _onAfterItemsLoaded: function() {
                var t = this.options
                    , e = this.$listView.children(c(".x-dropdown-item"))
                    , i = t.allowBlank ? 1 : 0;
                t.emptyTip && e.length <= i && this.$listView.empty().append(c('<div class="empty-tip"/>').text(t.emptyTip))
            },
            _onBeforeItemsLoaded: function() {
                this.options.allowBlank && c('<a class="x-dropdown-item"/>').text(i18next.t("select")).appendTo(this.$listView)
            },
            _onItemCreate: function(t, e, i) {
                var a = this.options
                    , n = this;
                if (!1 === FX.Utils.applyFunc(this, a.onItemCreate, [t, e], !1)) {
                    var s = t[a.textField]
                        , r = t[a.valueField];
                    if (this.valueMap[r] = {
                        text: s,
                        value: r,
                        color: t.color,
                        fontColor: t.fontColor,
                        borderColor: t.borderColor
                    },
                    !FX.Utils.isEmpty(i) && !new RegExp(FX.Utils.escapeRegexp(i),"i").test(s + ""))
                        return !1;
                    var o, l = c('<a class="x-dropdown-item"/>').data("item", t).attr("option", r).attr("title", s).appendTo(this.$listView);
                    a.colorEnable ? (l.addClass("color-item"),
                        new FX.TextTag({
                            renderEl: c("<span/>").appendTo(l),
                            text: s,
                            multiLine: !1,
                            bgColor: t.color,
                            fontColor: t.fontColor,
                            borderColor: t.borderColor
                        })) : l.text(s),
                    t.disable && l.addClass("disable"),
                    !FX.Utils.isEmpty(r) && this._isSelected(r) && (c(".select", this.triggerView).removeClass("select"),
                        l.addClass("select"),
                        this._setEditCompText(s, t)),
                    t.isOther && (l.addClass("item-other"),
                        this.textOther ? this.textOther.setVisible(this._isSelected(r)) : (o = c('<div class="fui-text-other"/>'),
                        a.subform && o.addClass("subform-other"),
                            this.element.after(o),
                            this.textOther = FX.createWidget({
                                renderEl: o,
                                width: a.width ? a.width : 240,
                                type: "text",
                                visible: !!t.selected,
                                allowBlank: a.allowBlank,
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(n, a.onStopEdit, [], !1)
                                },
                                onStateChange: function() {
                                    FX.Utils.applyFunc(n, a.onStateChange, [], !1)
                                }
                            })))
                }
            },
            _isSelected: function(t) {
                return this.value == t
            },
            _bindViewEvts: function() {
                var a = this
                    , n = !1;
                this.triggerView.bind("click", function(t) {
                    var e, i;
                    n ? n = !1 : 0 < (e = c(t.target).closest("a")).length && (i = e.data("item"),
                        a._onItemClick(e, i),
                        t.stopEvent())
                })
            },
            _onItemClick: function(t, e) {
                var i;
                e && e.disable || (i = this.options,
                    c(".select", this.triggerView).removeClass("select"),
                    e ? (t.addClass("select"),
                        this.value = e[i.valueField],
                        this.text = e[i.textField],
                        this.selectedItem = e) : (this.value = null,
                        this.text = null,
                        this.selectedItem = null),
                    this._setEditCompText(this.text, this.selectedItem),
                    t.hasClass("item-other") ? this.setOtherItemSelect() : this.setOtherItemRemove(),
                    FX.Utils.applyFunc(this, i.onAfterItemSelect, [t, e], !1),
                    FX.Utils.applyFunc(this, i.onAfterEdit, [t, e], !1),
                    this.changed = !0,
                    this._hideTriggerView(),
                    this._clearInvalidValueError())
            },
            _clearInvalidValueError: function() {
                var t = this.options;
                this.element.removeClass(t.cls4InvalidValue)
            },
            effectItemLinkWidgets: function() {
                var t, e = this.options;
                !e.async && this.triggerView && (t = c(".select", this.triggerView),
                    FX.Utils.applyFunc(this, e.onAfterItemSelect, [t, t.data("item")], !1))
            },
            _initDefaultValue: function() {
                var t = this.options;
                FX.ComboBox.superclass._initDefaultValue.apply(this, arguments),
                    FX.Utils.applyFunc(this, t.onAfterInitDefaultValue, [t.value], !1)
            },
            checkValidate: function() {
                return !(!this.options.allowBlank && FX.Utils.isEmpty(this.getValue()))
            },
            setEnable: function(t) {
                FX.ComboBox.superclass.setEnable.apply(this, [t]),
                this.textOther && this.textOther.setEnable(t)
            },
            setValue: function(a) {
                var n = this.options;
                if (this.value = a,
                    this.valueMap && !FX.Utils.isNull(this.valueMap[a]) ? (this.text = this.valueMap[a].text,
                        this.selectedItem = this.valueMap[a]) : !FX.Utils.isEmpty(a) && n.text4InvalidValue ? (this.text = n.text4InvalidValue,
                        this.selectedItem = null,
                    n.cls4InvalidValue && this.element.addClass(n.cls4InvalidValue)) : (this.text = a,
                        this.selectedItem = null),
                    this.triggerView)
                    if (c(".select", this.triggerView).removeClass("select"),
                        FX.Utils.isEmpty(a))
                        this.setOtherItemRemove();
                    else {
                        var s = [];
                        if (c("a.x-dropdown-item", this.$listView).each(function(t, e) {
                            var i = c(e).data("item");
                            i && (i[n.valueField] != a || i.isOther || (s = c(e).addClass("select")))
                        }),
                            this.textOther) {
                            if (0 === s.length)
                                return void this.setOtherItemSelect(a);
                            this.setOtherItemRemove()
                        }
                    }
                this._setEditCompText(this.text, this.selectedItem)
            },
            _setEditCompText: function(t, e) {
                var i = this.options;
                this.editComp && (this.editComp.empty(),
                    i.colorEnable ? (e = e || {},
                        new FX.TextTag({
                            renderEl: c("<span/>").appendTo(this.editComp),
                            text: t,
                            bgColor: e.color,
                            fontColor: e.fontColor,
                            borderColor: e.borderColor
                        })) : this.editComp.text(t))
            },
            setOtherItemSelect: function(t) {
                var e = this.options;
                this.$listView.children(".item-other").addClass("select"),
                    this._setEditCompText(i18next.t("other"));
                var i = e.width;
                this.options.subform && (this.textOther && this.textOther.doResize({
                    width: .48 * e.width
                }),
                    this.doResize({
                        width: .5 * e.width
                    })),
                    e.width = i,
                this.textOther && (this.textOther.setVisible(!0),
                    this.textOther.setValue(t))
            },
            setOtherItemRemove: function() {
                var t = this.options;
                this.options.subform && this.doResize({
                    width: t.width
                }),
                this.textOther && this.textOther.setVisible(!1)
            },
            setText: function(t) {
                this.text = t,
                    this._setEditCompText(t, this.selectedItem)
            },
            getValue: function() {
                return this.textOther && this.textOther.isVisible() ? this.textOther.getValue() : this.value
            },
            getLinkValue: function() {
                var t = this.getValue();
                return t && t.toString()
            },
            getText: function() {
                return this.textOther && this.textOther.isVisible() ? this.textOther.getValue() : this.text
            },
            rebuild: function() {
                this.triggerView && (this.triggerView.remove(),
                    this.triggerView = null,
                    this.$listView = null,
                this.textOther && (this.textOther.destroy(),
                    this.textOther = null)),
                    FX.ComboBox.superclass.rebuild.apply(this, arguments)
            },
            resizeTextOther: function() {
                var t = this.options
                    , e = t.width;
                t.subform && this.textOther && this.textOther.isVisible() && (this.textOther.doResize({
                    width: .48 * t.width
                }),
                    this.doResize({
                        width: .5 * t.width
                    })),
                    t.width = e
            },
            getOptions: function() {
                var t = this.options
                    , e = {
                    noRepeat: t.noRepeat,
                    colorEnable: t.colorEnable
                };
                return t.async && t.async.url ? e.async = t.async : e.items = t.items,
                    c.extend(FX.ComboBox.superclass.getOptions.apply(this, arguments), e)
            }
        }),
            c.shortcut("combo", FX.ComboBox)
    }(jQuery),
    function(o) {
        FX.ComboCheckBox = FX.extend(FX.ComboBox, {
            _defaultConfig: function() {
                return o.extend(FX.ComboCheckBox.superclass._defaultConfig.apply(), {
                    baseCls: "fui_combocheck",
                    triggerList: "combocheck-list",
                    limitData: 300,
                    hasSelectAll: !0,
                    onAfterItemCreate: null
                })
            },
            _initStoreValue: function() {
                var i = this
                    , a = this.options;
                this.value = [],
                    this.text = [],
                    FX.Utils.forEach(a.items, function(t, e) {
                        e.selected && (i.value.push(e[a.valueField]),
                            i.text.push(e[a.textField]))
                    })
            },
            _hasDefaultValue: function() {
                var t = this.options.value;
                return !FX.Utils.isNull(t) && 0 < t.length
            },
            _onBeforeItemsLoaded: function() {
                var t;
                this.options.hasSelectAll && ((t = {
                    selectAll: !0
                })[this.options.textField] = i18next.t("selectAll"),
                    this._onItemCreate(t))
            },
            _onAfterItemsLoaded: function() {
                FX.ComboCheckBox.superclass._onAfterItemsLoaded.apply(this, arguments),
                    this._setEditCompText()
            },
            _createItemList: function(t) {
                FX.ComboCheckBox.superclass._createItemList.apply(this, arguments);
                var e = this.options;
                this._checkSelectAll(),
                e.hasSelectAll && (FX.Utils.isEmpty(t) ? this.$selectAllItem.find("span").text(i18next.t("selectAll")) : this.$selectAllItem.find("span").text(i18next.t("selectAllSearchResult")))
            },
            _onItemCreate: function(t, e, i) {
                var a = this.options
                    , n = t[a.valueField]
                    , s = t[a.textField];
                if (!FX.Utils.isEmpty(i) && !new RegExp(FX.Utils.escapeRegexp(i),"i").test(s + ""))
                    return !1;
                var r = o('<a class="x-dropdown-item x-check"/>').data("item", t).attr("option", n).attr("title", s).appendTo(this.$listView);
                o('<i class="icon-blank"/>').appendTo(r),
                    a.colorEnable && !t.selectAll ? (r.addClass("color-item"),
                        new FX.TextTag({
                            renderEl: o("<span/>").appendTo(r),
                            text: s,
                            multiLine: !1,
                            bgColor: t.color
                        })) : o("<span/>").text(s).appendTo(r),
                -1 < this._getValueIndex(n) && r.addClass("select"),
                    t.selectAll ? (r.addClass("select-all field-meta"),
                        this.$selectAllItem = r) : this.valueMap[n] || (this.valueMap[n] = {
                        text: s,
                        value: n,
                        color: t.color
                    }),
                    FX.Utils.applyFunc(this, a.onAfterItemCreate, [t, e, r], !1)
            },
            _getValueIndex: function(i) {
                var a = -1;
                return FX.Utils.forEach(this.value, function(t, e) {
                    if (e == i)
                        return a = t,
                            !1
                }),
                    a
            },
            _onItemClick: function(t, e) {
                var i, a = this, n = this.options, s = t.hasClass("select");
                e.selectAll ? (i = o(".x-dropdown-item", this.triggerView),
                    s ? (FX.Utils.isEmpty(this.searchValue) ? (this.value = [],
                        this.text = []) : FX.Utils.forEach(i, function(t, e) {
                        var i = o(e).data("item");
                        a._removeItem(i)
                    }),
                        i.removeClass("select")) : (FX.Utils.forEach(i, function(t, e) {
                        var i = o(e).data("item");
                        a._addItem(i)
                    }),
                        i.addClass("select"))) : s ? (t.removeClass("select"),
                    this._removeItem(t.data("item")),
                this.$selectAllItem && this.$selectAllItem.removeClass("select")) : (t.addClass("select"),
                    this._addItem(t.data("item")),
                    this._checkSelectAll()),
                    this._setEditCompText(),
                    FX.Utils.applyFunc(this, n.onAfterItemSelect, [this.value, this.text], !1),
                    FX.Utils.applyFunc(this, n.onAfterEdit, [this.value, this.text], !1),
                    this.changed = !0
            },
            _addItem: function(t) {
                var e, i, a = this.options;
                t.selectAll || (e = t[a.valueField],
                    i = t[a.textField],
                -1 < this._getValueIndex(e) || (this.value.push(e),
                    this.text.push(i)))
            },
            _removeItem: function(t) {
                var e, i = this.options;
                t.selectAll || ((e = this._getValueIndex(t[i.valueField])) < 0 || (this.value.splice(e, 1),
                    this.text.splice(e, 1)))
            },
            _checkSelectAll: function() {
                this.$listView && this.$selectAllItem && (this.$selectAllItem.hasClass("select") ? 1 <= this.$listView.children().not(".select").length && this.$selectAllItem.removeClass("select") : this.$listView.children().not(".select").length <= 1 && this.$selectAllItem.addClass("select"))
            },
            _setEditCompText: function() {
                var t = this.options
                    , s = this;
                this.editComp && (this.editComp.empty(),
                    t.colorEnable ? this.valueMap && FX.Utils.forEach(this.value, function(t, e) {
                        var i = s.valueMap[e]
                            , a = i ? i.text : e
                            , n = i && i.color;
                        new FX.TextTag({
                            renderEl: o("<span/>").appendTo(s.editComp),
                            text: a,
                            bgColor: n,
                            multiLine: !1
                        })
                    }) : this.editComp.text(this.text.join(",")))
            },
            effectItemLinkWidgets: function() {},
            checkValidate: function() {
                return !(!this.options.allowBlank && 0 === this.value.length)
            },
            showErrorMsg: function(t) {
                FX.Utils.isEmpty(t) || (this.$err || (this.$err = o('<span class="invalid-info"/>').appendTo(this.element)),
                    this.$err.text(t).show())
            },
            removeErrorMsg: function() {
                this.$err && this.$err.remove(),
                    this.$err = null
            },
            setValue: function(t) {
                var a = this
                    , e = o.makeArray(t);
                this.text = [],
                    this.value = e,
                    this.valueMap ? (o(".select", a.triggerView).removeClass("select"),
                        FX.Utils.forEach(e, function(t, i) {
                            var e = a.valueMap[i];
                            !e || FX.Utils.isNull(e.text) ? a.text.push(i) : a.text.push(e.text),
                            a.triggerView && o("a.x-dropdown-item", a.$listView).each(function(t, e) {
                                o(e).attr("option") == i && o(e).addClass("select")
                            })
                        })) : this.text = e.slice(0),
                    this._setEditCompText()
            },
            setText: function(t) {
                this.text = o.makeArray(t),
                    this._setEditCompText()
            },
            getValue: function() {
                return this.value
            },
            getLinkValue: function() {
                return this.getValue()
            },
            getNullValue: function() {
                return []
            },
            getText: function() {
                return this.text
            }
        }),
            o.shortcut("combocheck", FX.ComboCheckBox)
    }(jQuery),
    function(l) {
        FX.XComboCheckBox = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return l.extend(FX.XComboCheckBox.superclass._defaultConfig.apply(), {
                    baseCls: "fui_combocheck",
                    waterMark: null,
                    hasSelectAll: !0,
                    hasSelectEmpty: !0,
                    emptySelectText: i18next.t("unfilled"),
                    textField: "text",
                    valueField: "value",
                    async: null,
                    asyncResultKey: "items",
                    searchable: !0,
                    onStopEdit: null,
                    height: 30,
                    width: 240,
                    edge: {
                        width: 240,
                        height: 200
                    },
                    scrollEdge: 100,
                    limit: 100,
                    hasLimit: !1,
                    searchKey: "keyword",
                    hasScrollLoad: !1,
                    colorEnable: !1,
                    colorMap: null
                })
            },
            _init: function() {
                FX.XComboCheckBox.superclass._init.apply(this, arguments);
                var t = this.options;
                this.values = [],
                    this.texts = [],
                    this.valueMap = {},
                t.hasSelectEmpty && (this.valueMap[FX.CONST.PARAMETER.EMPTY] = t.emptySelectText),
                    this._createEditComp(),
                    this._bindEvents()
            },
            _createEditComp: function() {
                var t = this.options;
                this.editComp = l('<div class="combo-value-wrapper"/>').attr("placeholder", t.waterMark).appendTo(this.element),
                    l('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),
                t.colorEnable || this.editComp.addClass("text-mode")
            },
            _bindEvents: function() {
                var i = this;
                this.element.unbind("click.trigger"),
                    this.element.bind("click.trigger", function(t) {
                        var e = l(t.target);
                        (0 < e.closest(".combo-value-wrapper").length || 0 < e.closest(".fui_trigger-btn").length) && i._onTriggerClick()
                    })
            },
            _onTriggerClick: function() {
                var i = this;
                this._showTriggerView(),
                    l(document).bind("mousedown.trigger", function(t) {
                        var e = t.target;
                        0 === l(e).closest(i.$triggerView).length && i._hideTriggerView()
                    })
            },
            _showTriggerView: function() {
                var t = this.options;
                this.$triggerView ? t.hasLimit && !FX.Utils.isObjectEmpty(this.values) && (this._clearItems(),
                    this._createItems(this.items)) : this._createTriggerView(),
                    this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.options.searchable && this.$triggerView.find("input").focus()
            },
            _hideTriggerView: function() {
                var t = this.options;
                this.$triggerView && (l(document).unbind("mousedown.trigger"),
                    this.$triggerView.detach(),
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1))
            },
            _calTriggerViewPos: function() {
                var t = {
                    "z-Index": FX.STATIC.zIndex++
                }
                    , e = this.element.offset()
                    , i = this.options.edge
                    , a = document.body.clientWidth - e.left;
                return a < i.width ? (t.right = a - this.element.outerWidth(),
                    t.left = "auto") : (t.right = "auto",
                    t.left = e.left),
                    document.body.clientHeight + document.body.scrollTop - e.top - this.element.outerHeight() < i.height ? (t.top = "auto",
                        t.bottom = document.body.clientHeight - e.top) : (t.top = e.top + this.element.outerHeight(),
                        t.bottom = "auto"),
                    t
            },
            _createTriggerView: function() {
                var t, e = this, i = this.options;
                this.$triggerView = l('<div class="x-dropdown" />'),
                i.searchable && (t = l('<div class="fui_combo-search"/>').appendTo(this.$triggerView),
                    l("<input />").bind("input propertychange", function() {
                        e.searchValue !== this.value && e._doSearch(this.value)
                    }).appendTo(t),
                    t.append(l('<i class="icon-search search-icon"/>'))),
                    this.$listView = l('<div class="x-dropdown-list combocheck-list"/>').appendTo(this.$triggerView),
                    this.$listView.on("click", ".x-dropdown-item", function(t) {
                        e._onItemClick(l(t.currentTarget))
                    }),
                    this.itemsMap = {},
                    this._loadItems()
            },
            _loadItems: function(i) {
                var t, e, a = this, n = this.options;
                i = i || 0,
                    this.items = this.items || [],
                    n.async && n.async.url ? (this.ajaxObj && this.ajaxObj.abort && this.ajaxObj.abort(),
                        t = l('<div class="loading-text" />').append(l("<span />").text(i18next.t("loading"))).appendTo(a.$listView),
                        e = {
                            hasLimit: n.hasLimit,
                            skip: i,
                            limit: n.limit
                        },
                    FX.Utils.isEmpty(this.searchValue) || (e[n.searchKey] = this.searchValue,
                        e.hasCurrentUser = !1),
                        this.ajaxObj = FX.Utils.dataAjax({
                            url: n.async.url,
                            data: l.extend({}, n.async.data, e)
                        }, function(t) {
                            var e = t[n.asyncResultKey];
                            a.items = a.items.concat(e),
                                a._createItems(e),
                            n.hasScrollLoad && e.length >= n.limit && a._bindLoadMore(i + n.limit)
                        }, null, function() {
                            t.remove(),
                                a.ajaxObj = null
                        })) : n.items && (this.items = n.items,
                        a._createItems(this.items))
            },
            _createItems: function(t) {
                var n = this
                    , s = this.options
                    , r = []
                    , o = [];
                this._beforeCreateItems(),
                    FX.Utils.forEach(t, function(t, e) {
                        var i = {};
                        i[s.textField] = FX.Utils.isEmpty(e[s.textField]) ? e : e[s.textField],
                            i[s.valueField] = FX.Utils.isEmpty(e[s.valueField]) ? e : e[s.valueField];
                        var a = n._createItem(i);
                        a.hasClass("select") ? r.push(a) : o.push(a)
                    }),
                FX.Utils.isEmpty(this.searchValue) && FX.Utils.forEach(this.values, function(t, e) {
                    var i;
                    n.itemsMap[e] || ((i = {})[s.valueField] = e,
                        i[s.textField] = n.valueMap[e] || e,
                        r.push(n._createItem(i)))
                }),
                    FX.Utils.forEach(r, function(t, e) {
                        n.$listView.append(e)
                    }),
                    FX.Utils.forEach(o, function(t, e) {
                        n.$listView.append(e)
                    }),
                    this.$selectAllItem = l(".select-all", this.$listView),
                FX.Utils.isEmpty(this.searchValue) || (this.$selectAllItem.find("span").text(i18next.t("selectAllSearchResult")),
                    this.$listView.children("a.select-empty").addClass("hide")),
                    n._checkSelectAll()
            },
            _clearItems: function() {
                this.$listView.empty(),
                    this.$selectAllItem = null,
                    this.itemsMap = {}
            },
            _bindLoadMore: function(t) {
                var e = this
                    , i = this.options;
                this.$listView.on("scroll.loadMore", function() {
                    e.$listView.scrollTop() + e.$listView.outerHeight() + i.scrollEdge >= e.$listView.prop("scrollHeight") && (e.$listView.unbind("scroll.loadMore"),
                        e._loadItems(t))
                })
            },
            _doSearch: function(t) {
                var e = this
                    , i = this.options;
                e.searchValue = t,
                    e.$listView.children().addClass("hide");
                var a = e._createLoadingIcon(i18next.t("searching"));
                e.searchinterval && clearTimeout(e.searchinterval),
                    i.async && i.hasLimit ? e.searchinterval = setTimeout(function() {
                        a.remove(),
                            e.items = null,
                            e._clearItems(),
                            e._loadItems()
                    }, 600) : (e.searchinterval = setTimeout(function() {
                        a.remove(),
                            e.$listView.children().removeClass("hide"),
                        FX.Utils.isEmpty(e.searchValue) || e._hideItems(e.searchValue)
                    }, 500),
                        FX.Utils.isEmpty(t) ? this.$selectAllItem.find("span").text(i18next.t("selectAll")) : (this.$selectAllItem.find("span").text(i18next.t("selectAllSearchResult")),
                            this.$listView.children("a.select-empty").addClass("hide")))
            },
            _createLoadingIcon: function(t) {
                var e = this.$listView.children(".loading-text");
                return 0 === e.length && (e = l('<div class="loading-text"/>').appendTo(this.$listView),
                    l("<span/>").text(t).appendTo(e)),
                    e
            },
            _createItem: function(t) {
                var e = this.options
                    , i = t[e.valueField]
                    , a = t[e.textField];
                FX.Utils.isNull(i) || (this.valueMap[i] = a),
                    this.itemsMap[i] = !0;
                var n = l('<a class="x-dropdown-item x-check"/>').data("option", i).attr("title", a).append(l('<i class="icon-blank"/>'));
                return e.colorEnable && !t.selectAll ? (n.addClass("color-item"),
                    new FX.TextTag({
                        renderEl: l("<span/>").appendTo(n),
                        customCls: t.selectEmpty ? "select-empty-tag" : "",
                        text: a,
                        multiLine: !1,
                        bgColor: e.colorMap && e.colorMap[a]
                    })) : n.append(l("<span/>").text(a)),
                -1 < this.values.indexOf(i) && n.addClass("select"),
                    t.selectAll ? n.addClass("select-all field-meta") : t.selectEmpty && n.addClass("select-empty field-meta"),
                    n
            },
            _beforeCreateItems: function() {
                var t, e, i = this.options;
                this.$selectAllItem || (i.hasSelectAll && ((t = {
                    selectAll: !0
                })[i.textField] = i18next.t("selectAll"),
                    this.$listView.append(this._createItem(t))),
                i.hasSelectEmpty && ((e = {
                    selectEmpty: !0
                })[i.valueField] = FX.CONST.PARAMETER.EMPTY,
                    e[i.textField] = this.valueMap[FX.CONST.PARAMETER.EMPTY],
                    this.$listView.append(this._createItem(e))))
            },
            _hideItems: function(a) {
                var t = this.$listView.children("a").not(".select-all").not(".select-empty");
                FX.Utils.forEach(t, function(t, e) {
                    var i = l(e);
                    new RegExp(FX.Utils.escapeRegexp(a),"i").test(i.text()) || i.addClass("hide")
                })
            },
            _onItemClick: function(t) {
                var e, i = this, a = t.hasClass("select");
                t.hasClass("select-all") ? (e = this.$listView.children("a").not(".hide").not(".select-all"),
                    a ? (t.removeClass("select"),
                    FX.Utils.isEmpty(this.searchValue) && (this.values = [])) : t.addClass("select"),
                    FX.Utils.forEach(e, function(t, e) {
                        i._handleItemClick(l(e), a)
                    })) : this._handleItemClick(t, a),
                    this._refreshData()
            },
            _refreshData: function() {
                var a = this;
                this.valueMap && (a.texts = [],
                    FX.Utils.forEach(this.values, function(t, e) {
                        var i = a.valueMap[e];
                        FX.Utils.isNull(i) || a.texts.push(i)
                    })),
                    this._setEditCompTexts(this.texts)
            },
            _handleItemClick: function(t, e) {
                this.options;
                var i, a = t.data("option");
                e ? (t.removeClass("select"),
                -1 < (i = this.values.indexOf(a)) && this.values.splice(i, 1),
                this.$selectAllItem && this.$selectAllItem.removeClass("select")) : (t.addClass("select"),
                this.values.indexOf(a) < 0 && this.values.push(a),
                    this._checkSelectAll())
            },
            _checkSelectAll: function() {
                var t = this.$listView.children("a").not(".hide").not(".select-all")
                    , e = this.$listView.children("a.select").not(".hide").not(".select-all");
                t.length === e.length && this.$selectAllItem && this.$selectAllItem.addClass("select")
            },
            _setEditCompTexts: function(t) {
                var a = this.options
                    , n = this;
                if (this.editComp) {
                    if (this.editComp.empty(),
                        !t)
                        return;
                    a.colorEnable ? FX.Utils.forEach(t, function(t, e) {
                        var i = n.values[t] === FX.CONST.PARAMETER.EMPTY;
                        new FX.TextTag({
                            renderEl: l("<span/>").appendTo(n.editComp),
                            customCls: i ? "select-empty-tag" : "",
                            text: e,
                            multiLine: !1,
                            bgColor: a.colorMap && a.colorMap[e]
                        })
                    }) : this.editComp.text(t.join(","))
                }
            },
            doFilterRely: function(t) {
                this.options.async.data.filter = t,
                this.$triggerView && (this.$triggerView.remove(),
                    this.$triggerView = null,
                    this.items = null,
                    this._clearItems())
            },
            doResize: function() {
                FX.XComboCheckBox.superclass.doResize.apply(this, arguments);
                var t = this.options.height;
                this.element.css({
                    "line-height": t - 2 + "px"
                })
            },
            setValue: function(t) {
                var a = this
                    , i = this.options;
                t = t || [];
                var e = [];
                FX.Utils.isArray(t) ? e = t : (e = e.concat(t.items || []),
                t.hasEmpty && e.indexOf(FX.CONST.PARAMETER.EMPTY) < 0 && e.unshift(FX.CONST.PARAMETER.EMPTY)),
                    a.values = [],
                    a.texts = [];
                var n = {};
                FX.Utils.forEach(i.items, function(t, e) {
                    n[e[i.valueField]] = e[i.textField]
                }),
                    FX.Utils.forEach(e, function(t, e) {
                        var i = a.valueMap[e] || n[e];
                        FX.Utils.isNull(i) ? a.texts.push(e) : a.texts.push(i),
                            a.values.push(e)
                    }),
                    this._setEditCompTexts(this.texts)
            },
            getValue: function() {
                if (FX.Utils.isObjectEmpty(this.values))
                    return {};
                var t = [].concat(this.values)
                    , e = !1
                    , i = t.indexOf(FX.CONST.PARAMETER.EMPTY);
                return -1 < i && (e = !0,
                    t.splice(i, 1)),
                    {
                        hasEmpty: e,
                        items: t
                    }
            }
        }),
            l.shortcut("xcombocheck", FX.XComboCheckBox)
    }(jQuery),
    function(s) {
        FX.XComboBox = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return s.extend(FX.XComboBox.superclass._defaultConfig.apply(), {
                    baseCls: "fui_combo",
                    waterMark: null,
                    textField: "text",
                    valueField: "value",
                    async: null,
                    asyncResultKey: "items",
                    allowBlank: !0,
                    searchable: !0,
                    onStopEdit: null,
                    height: 30,
                    width: 240,
                    edge: {
                        width: 240,
                        height: 200
                    },
                    scrollEdge: 100,
                    limit: 100,
                    hasLimit: !1,
                    searchKey: "keyword",
                    hasScrollLoad: !1,
                    onAsyncSuccess: null,
                    colorEnable: !1,
                    colorMap: null
                })
            },
            _init: function() {
                FX.XComboBox.superclass._init.apply(this, arguments),
                    this.valueMap = {},
                    this._createEditComp(),
                    this._bindEvents()
            },
            _createEditComp: function() {
                var t = this.options;
                this.editComp = s('<div class="combo-value-wrapper"/>').attr("placeholder", t.waterMark).appendTo(this.element),
                    s('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),
                t.colorEnable || this.editComp.addClass("text-mode")
            },
            _bindEvents: function() {
                var i = this;
                this.element.unbind("click.trigger"),
                    this.element.bind("click.trigger", function(t) {
                        var e = s(t.target);
                        (0 < e.closest(".combo-value-wrapper").length || 0 < e.closest(".fui_trigger-btn").length) && i._onTriggerClick()
                    })
            },
            _onTriggerClick: function() {
                var i = this;
                this._showTriggerView(),
                    s(document).bind("mousedown.trigger", function(t) {
                        var e = t.target;
                        0 === s(e).closest(i.$triggerView).length && i._hideTriggerView()
                    })
            },
            _showTriggerView: function() {
                var t = this.options;
                this.$triggerView ? t.hasLimit && this.value && (this._clearItems(),
                    this._createItems(this.items)) : this._createTriggerView(),
                    this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.options.searchable && this.$triggerView.find("input").focus()
            },
            _hideTriggerView: function() {
                var t = this.options;
                this.$triggerView && (s(document).unbind("mousedown.trigger"),
                    this.$triggerView.detach(),
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1))
            },
            _calTriggerViewPos: function() {
                var t = {
                    "z-Index": FX.STATIC.zIndex++
                }
                    , e = this.element.offset()
                    , i = this.options.edge
                    , a = document.body.clientWidth - e.left;
                return a < i.width ? (t.right = a - this.element.outerWidth(),
                    t.left = "auto") : (t.right = "auto",
                    t.left = e.left),
                    document.body.clientHeight + document.body.scrollTop - e.top - this.element.outerHeight() < i.height ? (t.top = "auto",
                        t.bottom = document.body.clientHeight - e.top) : (t.top = e.top + this.element.outerHeight(),
                        t.bottom = "auto"),
                    t
            },
            _createTriggerView: function() {
                var t, e = this, i = this.options;
                this.$triggerView = s('<div class="x-dropdown" />'),
                i.searchable && (t = s('<div class="fui_combo-search"/>').appendTo(this.$triggerView),
                    s("<input />").bind("input propertychange", function() {
                        e.searchValue !== this.value && e._doSearch(this.value)
                    }).appendTo(t),
                    t.append(s('<i class="icon-search search-icon"/>'))),
                    this.$listView = s('<div class="x-dropdown-list combo-list"/>').appendTo(this.$triggerView),
                    this.$listView.on("click", ".x-dropdown-item", function(t) {
                        e._onItemClick(s(t.currentTarget))
                    }),
                    this.itemsMap = {},
                    this._loadItems()
            },
            _loadItems: function(i) {
                var t, e, a = this, n = this.options;
                i = i || 0,
                    this.items = this.items || [],
                    n.async && n.async.url ? (this.ajaxObj && this.ajaxObj.abort && this.ajaxObj.abort(),
                        t = s('<div class="loading-text" />').append(s("<span />").text(i18next.t("loading"))).appendTo(a.$listView),
                        e = {
                            hasLimit: n.hasLimit,
                            skip: i,
                            limit: n.limit
                        },
                    FX.Utils.isEmpty(this.searchValue) || (e[n.searchKey] = this.searchValue,
                        e.hasCurrentUser = !1),
                        this.ajaxObj = FX.Utils.dataAjax({
                            url: n.async.url,
                            data: s.extend({}, n.async.data, e)
                        }, function(t) {
                            var e = FX.Utils.applyFunc(a, n.onAsyncSuccess, [t], !1);
                            !1 === e && (e = t[n.asyncResultKey]),
                                a.items = a.items.concat(e),
                                a._createItems(e),
                            n.hasScrollLoad && e.length >= n.limit && a._bindLoadMore(i + n.limit)
                        }, null, function() {
                            t.remove(),
                                a.ajaxObj = null
                        })) : n.items && (this.items = n.items,
                        a._createItems(this.items))
            },
            _createItems: function(t) {
                var n = this
                    , s = this.options;
                this._onBeforeItemsLoaded();
                var e, r = [], o = [];
                FX.Utils.forEach(t, function(t, e) {
                    var i = {};
                    i[s.textField] = e[s.textField] || e,
                        i[s.valueField] = e[s.valueField] || e;
                    var a = n._createItem(i);
                    a.hasClass("select") ? r.push(a) : o.push(a)
                }),
                FX.Utils.isEmpty(this.searchValue) && this.value && !this.itemsMap[this.value] && ((e = {})[s.valueField] = this.value,
                    e[s.textField] = n.valueMap[this.value] || this.value,
                    r.push(n._createItem(e))),
                    FX.Utils.forEach(r, function(t, e) {
                        n.$listView.append(e)
                    }),
                    FX.Utils.forEach(o, function(t, e) {
                        n.$listView.append(e)
                    })
            },
            _onBeforeItemsLoaded: function() {
                this.options.allowBlank && !this.$selectEmpty && (this.$selectEmpty = s('<a class="x-dropdown-item"/>').text(i18next.t("select")).appendTo(this.$listView))
            },
            _clearItems: function() {
                this.$listView.empty(),
                    this.$selectEmpty = null,
                    this.itemsMap = {}
            },
            _bindLoadMore: function(t) {
                var e = this
                    , i = this.options;
                this.$listView.on("scroll.loadMore", function() {
                    e.$listView.scrollTop() + e.$listView.outerHeight() + i.scrollEdge >= e.$listView.prop("scrollHeight") && (e.$listView.unbind("scroll.loadMore"),
                        e._loadItems(t))
                })
            },
            _doSearch: function(t) {
                var e = this
                    , i = this.options;
                e.searchValue = t,
                    e.$listView.children().addClass("hide");
                var a = e._createLoadingIcon(i18next.t("searching"));
                e.searchinterval && clearTimeout(e.searchinterval),
                    i.async && i.hasLimit ? e.searchinterval = setTimeout(function() {
                        a.remove(),
                            e.items = null,
                            e._clearItems(),
                            e._loadItems()
                    }, 600) : e.searchinterval = setTimeout(function() {
                        a.remove(),
                            e.$listView.children().removeClass("hide"),
                        FX.Utils.isEmpty(e.searchValue) || e._hideItems(e.searchValue)
                    }, 500)
            },
            _createLoadingIcon: function(t) {
                var e = this.$listView.children(".loading-text");
                return 0 === e.length && (e = s('<div class="loading-text"/>').appendTo(this.$listView),
                    s("<span/>").text(t).appendTo(e)),
                    e
            },
            _createItem: function(t) {
                var e = this.options
                    , i = t[e.valueField]
                    , a = t[e.textField];
                FX.Utils.isNull(i) || (this.valueMap[i] = a),
                    this.itemsMap[i] = !0;
                var n = s('<a class="x-dropdown-item"/>').attr("option", i).attr("title", a);
                return e.colorEnable ? (n.addClass("color-item"),
                    new FX.TextTag({
                        renderEl: s("<span/>").appendTo(n),
                        text: a,
                        multiLine: !1,
                        bgColor: e.colorMap && e.colorMap[a]
                    })) : n.text(a),
                this.value === i && n.addClass("select"),
                    n
            },
            _hideItems: function(a) {
                var t = this.$listView.children("a");
                FX.Utils.forEach(t, function(t, e) {
                    var i = s(e);
                    new RegExp(FX.Utils.escapeRegexp(a),"i").test(i.text()) || i.addClass("hide")
                })
            },
            _onItemClick: function(t) {
                this.value = t.attr("option"),
                    s(".select", this.$listView).removeClass("select"),
                    t.addClass("select"),
                    this._hideTriggerView(),
                    this._refreshData()
            },
            _refreshData: function() {
                this.valueMap && (this.text = this.valueMap[this.value]),
                    this._setEditCompText(this.text)
            },
            _setEditCompText: function(t) {
                var e = this.options;
                this.editComp && (this.editComp.empty(),
                    e.colorEnable ? new FX.TextTag({
                        renderEl: s("<span/>").appendTo(this.editComp),
                        text: t,
                        multiLine: !1,
                        bgColor: e.colorMap && e.colorMap[t]
                    }) : this.editComp.text(t))
            },
            doFilterRely: function(t) {
                this.options.async.data.filter = t,
                this.$triggerView && (this.$triggerView.remove(),
                    this.$triggerView = null,
                    this.items = null,
                    this._clearItems())
            },
            doResize: function() {
                FX.XComboBox.superclass.doResize.apply(this, arguments);
                var t = this.options.height;
                this.element.css({
                    "line-height": t - 2 + "px"
                })
            },
            setValue: function(t) {
                this.value = t,
                    this.valueMap && this.valueMap[t] ? this.text = this.valueMap[t] : this.text = t,
                    this._setEditCompText(this.text)
            },
            getValue: function() {
                return this.value
            }
        }),
            s.shortcut("xcombobox", FX.XComboBox)
    }(jQuery),
    function(s) {
        FX.UserComboBox = FX.extend(FX.XComboBox, {
            _createItem: function(t) {
                var e = this.options
                    , i = t[e.valueField]
                    , a = t[e.textField];
                FX.Utils.isNull(i) || (this.valueMap[i] = a),
                    this.itemsMap[i] = !0;
                var n = s('<a class="x-dropdown-item"/>').attr("option", i).attr("title", a).append(s("<span />").text(a));
                return this.value === i && n.addClass("select"),
                i === FX.USER_ID.CurrentUser && n.addClass("field-meta"),
                    n
            },
            setValue: function(e) {
                var i = this;
                this.value = e;
                var t = [];
                this.valueMap[e] || t.push(e),
                    this.valueMap[FX.USER_ID.CurrentUser] = i18next.t("widget.user.current"),
                FX.Utils.isObjectEmpty(t) || FX.Utils.ajax({
                    url: FX.Utils.getApi(FX.API.corp.list_member_name),
                    data: {
                        isUserOnly: !0,
                        members: t
                    }
                }, function(t) {
                    FX.Utils.forEach(t.users, function(t, e) {
                        i.valueMap[e._id] = e.nickname
                    }),
                        i.text = i.valueMap[e],
                        i._setEditCompText(i.text)
                })
            }
        }),
            s.shortcut("usercombobox", FX.UserComboBox)
    }(jQuery),
    function(l) {
        FX.DeptCheckList = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return l.extend(FX.DeptCheckList.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_dept_checklist",
                    allowBlank: !1,
                    dynamicType: "select",
                    hasSelectAll: !0,
                    hasSelectCurrent: !0,
                    hasSelectEmpty: !0,
                    multiSelect: !0,
                    searchable: !0,
                    textField: "name",
                    valueField: "_id",
                    onMultiSelect: null,
                    onStopEdit: null,
                    departmentsUrl: FX.Utils.getApi(FX.API.data.departments),
                    currentDepartmentsUrl: FX.Utils.getApi(FX.API.data.current_departments)
                })
            },
            _init: function() {
                FX.DeptCheckList.superclass._init.apply(this, arguments),
                    this._initData()
            },
            _initData: function() {
                var t = this.options;
                this.valArray = [],
                    this.texts = [],
                    this.valueMap = {},
                t.hasSelectEmpty && (this.valueMap[FX.CONST.PARAMETER.EMPTY] = i18next.t("unfilled")),
                    this._createListView(),
                FX.Utils.isObjectEmpty(this.value) && (this.value = {
                    items: []
                }),
                FX.Utils.isObjectEmpty(this.value.items) && (this.items = [])
            },
            _createListView: function() {
                var t, e = this;
                this.options.searchable && (t = l('<div class="fui_combo-search"/>').appendTo(this.element),
                    l("<input />").bind("input propertychange", function() {
                        e.searchValue !== this.value && e._doSearch(this.value)
                    }).appendTo(t),
                    t.append(l('<i class="icon-search search-icon"/>'))),
                    this.$listView = l('<div class="x-dropdown-list combocheck-list"/>').appendTo(this.element),
                    this.$listView.on("click", ".x-dropdown-item", function(t) {
                        e._onItemClick(l(t.currentTarget))
                    }),
                    this.itemsMap = {},
                    this._loadItems()
            },
            _loadItems: function() {
                var n = this
                    , s = this.options;
                this.items = this.items || [],
                    FX.Utils.dataAjax({
                        url: s.departmentsUrl
                    }, function(t) {
                        n.departments = l.extend(!0, [], t.departments),
                        n.departments[0] && !n.departments[0]._id && n.departments.shift(),
                            FX.Utils.forEach(n.departments, function(t, e) {
                                var i = e[s.valueField]
                                    , a = e[s.textField];
                                FX.Utils.isNull(i) || (n.valueMap[i] = a)
                            }),
                            n.items = n.items.concat(n.departments || []),
                            n._createItems(n.items),
                            n._createDepartmentList()
                    })
            },
            _createDepartmentList: function() {
                var i = this
                    , t = this.options;
                this.departmentTree = new FX.DepartmentsTree({
                    renderEl: l("<div/>").appendTo(this.element),
                    customCls: "x-department-tree select-department dept-checkbox",
                    Nodes: l.extend(!0, [], this.departments),
                    setting: {
                        view: {
                            expandSpeed: 100
                        },
                        data: {
                            simpleData: {
                                enable: !0,
                                idKey: "departmentId",
                                pIdKey: "parentId"
                            }
                        },
                        callback: {
                            onCheck: function(t, e) {
                                i._doSelectItem(e)
                            },
                            onClick: function(t, e) {
                                this.checkNode(e, !e.checked),
                                    i._doSelectItem(e)
                            },
                            beforeNodeCreate: function(t) {
                                i._checkLimit(t) || (t.nocheck = !0),
                                    t.checked = i._checkSelectState(t)
                            },
                            onNodeCreated: function(t, e) {
                                e.isParent && !e.open && e.level < 1 && this.expandNode(e, !0),
                                e.departmentId == i.currentDepartment && this.selectNode(e)
                            }
                        },
                        check: {
                            enable: t.multiSelect,
                            chkboxType: {
                                Y: "",
                                N: ""
                            }
                        }
                    }
                }),
                t.multiSelect && this.departmentTree.element.addClass("multiSelect")
            },
            _createItems: function(t) {
                var n = this
                    , s = this.options
                    , r = []
                    , o = [];
                this._beforeCreateItems(),
                    FX.Utils.forEach(t, function(t, e) {
                        var i = {};
                        i[s.textField] = e[s.textField] || e,
                            i[s.valueField] = e[s.valueField] || e;
                        var a = n._createItem(i);
                        a.hasClass("select") ? r.push(a) : o.push(a)
                    }),
                FX.Utils.isEmpty(this.searchValue) && FX.Utils.forEach(this.valArray, function(t, e) {
                    var i;
                    n.itemsMap[e] || ((i = {})[s.valueField] = e,
                        i[s.textField] = n.valueMap[e] || e,
                        r.push(n._createItem(i)))
                }),
                    FX.Utils.forEach(r, function(t, e) {
                        n.$listView.append(e.addClass("x-ui-hidden"))
                    }),
                    FX.Utils.forEach(o, function(t, e) {
                        n.$listView.append(e.addClass("x-ui-hidden"))
                    }),
                    this.$selectAllItem = l(".select-all", this.$listView),
                    n._checkSelectAll()
            },
            _doSearch: function(t) {
                var e = this;
                this.options;
                e.searchValue = t,
                    e.$listView.children().addClass("x-ui-hidden");
                var i = e._createLoadingIcon(i18next.t("searching"));
                e.searchinterval && clearTimeout(e.searchinterval),
                    FX.Utils.isEmpty(t) ? e.searchinterval = setTimeout(function() {
                        i.remove(),
                            e.inSearch = !1,
                        e.departmentTree && e.departmentTree.setVisible(!0),
                            e.$selectAllItem.find("span").text(i18next.t("selectAll")),
                            e.$listView.children("a.select-empty, a.select-all, a.curDept, a.placeholder").removeClass("x-ui-hidden"),
                            e._checkSelectAll()
                    }, 500) : e.searchinterval = setTimeout(function() {
                        i.remove(),
                            e.inSearch = !0,
                        e.departmentTree && e.departmentTree.setVisible(!1),
                            e.$selectAllItem.find("span").text(i18next.t("selectAllSearchResult")),
                            e.$listView.children("a.select-all").removeClass("x-ui-hidden"),
                            e._showItems(t),
                            e._checkSelectAll()
                    }, 500)
            },
            _createLoadingIcon: function(t) {
                var e = this.$listView.children(".loading-text");
                return 0 === e.length && (e = l('<div class="loading-text"/>').appendTo(this.$listView),
                    l("<span/>").text(t).appendTo(e)),
                    e
            },
            _createItem: function(t) {
                var e = this.options
                    , i = t[e.valueField]
                    , a = t[e.textField];
                FX.Utils.isNull(i) || (this.valueMap[i] = a),
                    this.itemsMap[i] = !0;
                var n = l('<a class="x-dropdown-item x-check"/>').attr("option", i).attr("title", a).append(e.multiSelect ? '<i class="icon-blank"/>' : "").append(l("<span />").text(a));
                return -1 < this.valArray.indexOf(i) && n.addClass("select"),
                    t.selectAll ? n.addClass("select-all field-meta") : t.selectEmpty ? n.addClass("select-empty field-meta") : t.curDept && n.addClass("curDept field-meta"),
                    n
            },
            _beforeCreateItems: function() {
                var t, e, i, a = this.options;
                this.$selectAllItem || (a.allowBlank && l('<a class="x-dropdown-item x-check placeholder field-meta"><span>' + i18next.t("select") + "</span></a>").appendTo(this.$listView),
                a.hasSelectAll && ((t = {
                    selectAll: !0
                })[a.textField] = i18next.t("selectAll"),
                    this.$listView.append(this._createItem(t))),
                a.hasSelectEmpty && ((e = {
                    selectEmpty: !0
                })[a.valueField] = FX.CONST.PARAMETER.EMPTY,
                    e[a.textField] = this.valueMap[FX.CONST.PARAMETER.EMPTY],
                    this.$listView.append(this._createItem(e))),
                "set" === a.dynamicType && a.hasSelectCurrent && (i = {
                    _id: FX.CONST.DEPT_ID.CURRENT,
                    name: i18next.t("dept.current"),
                    curDept: !0
                },
                    this.$listView.append(this._createItem(i))))
            },
            _showItems: function(a) {
                var t = this.$listView.children("a").not(".select-all, .curDept, .select-empty, .placeholder");
                FX.Utils.forEach(t, function(t, e) {
                    var i = l(e);
                    new RegExp(FX.Utils.escapeRegexp(a),"i").test(i.text()) && i.removeClass("x-ui-hidden")
                })
            },
            _onItemClick: function(t) {
                var e, i = this, a = t.hasClass("select");
                t.hasClass("select-all") ? i.inSearch ? (e = this.$listView.children("a").not(".x-ui-hidden").not(".select-all"),
                    a ? t.removeClass("select") : t.addClass("select"),
                    FX.Utils.forEach(e, function(t, e) {
                        i._handleItemClick(l(e), a)
                    })) : (e = this.$listView.children("a").not(".select-all"),
                    a ? (t.removeClass("select"),
                        this.selectAll = !1,
                    FX.Utils.isEmpty(this.searchValue) && (this.valArray = [])) : (t.addClass("select"),
                    FX.Utils.isEmpty(this.searchValue) && (this.selectAll = !0)),
                    FX.Utils.forEach(e, function(t, e) {
                        i._handleItemClick(l(e), a)
                    }),
                this.departmentTree && this.departmentTree.checkAllNodes(!a)) : this._handleItemClick(t, a),
                    this._refreshData()
            },
            _refreshData: function() {
                var a = this
                    , t = this.options;
                this.inSearch && this.departmentTree && this.departmentTree.refresh(),
                this.valueMap && (a.texts = [],
                    FX.Utils.forEach(this.valArray, function(t, e) {
                        var i = a.valueMap[e];
                        i && a.texts.push(i)
                    })),
                    FX.Utils.applyFunc(this, t.onStopEdit, [this.texts.join(",")], !1)
            },
            _handleItemClick: function(t, e) {
                var i = this.options
                    , a = t.attr("option");
                if (e) {
                    if (!i.multiSelect)
                        return void FX.Utils.applyFunc(this, i.onMultiSelect, [], !1);
                    t.removeClass("select");
                    var n = this.valArray.indexOf(a);
                    -1 < n && this.valArray.splice(n, 1),
                    this.$selectAllItem && this.$selectAllItem.removeClass("select"),
                        this.selectAll = !1
                } else
                    this.valArray.indexOf(a) < 0 && (i.multiSelect || (this.$listView.children("a").removeClass("select"),
                        this.valArray = []),
                    FX.Utils.isNull(a) || this.valArray.push(a)),
                        t.addClass("select"),
                        this._checkSelectAll();
                i.multiSelect || FX.Utils.applyFunc(this, i.onMultiSelect, [], !1)
            },
            _checkSelectAll: function() {
                var t, e = this.inSearch ? (t = this.$listView.children("a").not(".x-ui-hidden").not(".select-all"),
                    this.$listView.children("a.select").not(".x-ui-hidden").not(".select-all")) : (t = this.$listView.children("a").not(".select-all"),
                    this.$listView.children("a.select").not(".select-all"));
                t.length === e.length ? (this.$selectAllItem && this.$selectAllItem.addClass("select"),
                FX.Utils.isEmpty(this.searchValue) && (this.selectAll = !0)) : (this.$selectAllItem && this.$selectAllItem.removeClass("select"),
                    this.selectAll = !1)
            },
            _checkLimit: function() {
                return !0
            },
            _checkSelectState: function(t) {
                this.options;
                switch (t._id) {
                    case FX.CONST.PARAMETER.EMPTY:
                        return this.value.hasEmpty;
                    case FX.CONST.DEPT_ID.CURRENT:
                        return this.value.hasCurrentDept;
                    default:
                        return -1 < this.valArray.indexOf(t._id)
                }
            },
            _doSelectItem: function(t) {
                var e, i;
                this.options;
                this._checkLimit(t) && (e = {
                    name: t.name,
                    _id: t._id
                },
                    i = l("[option=" + t._id + "]"),
                    -1 < this.valArray.indexOf(e._id) ? this._handleItemClick(i, !0) : this._handleItemClick(i, !1),
                    this._refreshData(),
                    this._checkSelectAll())
            },
            setCurDept: function() {
                var e, a = this, t = this.options;
                this.value.hasEmpty && this.valArray.indexOf(FX.CONST.PARAMETER.EMPTY) < 0 && (this.valArray.unshift(FX.CONST.PARAMETER.EMPTY),
                t.hasSelectEmpty && (this.valueMap[FX.CONST.PARAMETER.EMPTY] = i18next.t("unfilled"))),
                    this.value.hasCurrentDept ? "set" === t.dynamicType && t.hasSelectCurrent && this.valArray.indexOf(FX.CONST.DEPT_ID.CURRENT) < 0 ? (this.valArray.unshift(FX.CONST.DEPT_ID.CURRENT),
                        this.valueMap[FX.CONST.DEPT_ID.CURRENT] = i18next.t("dept.current"),
                        this._updateDept()) : (e = FX.Utils.createMask(this.element, {
                        isLight: !0,
                        hasLoader: !0
                    }),
                        FX.Utils.dataAjax({
                            url: t.currentDepartmentsUrl
                        }, function(t) {
                            e.remove();
                            var i = [];
                            FX.Utils.forEach(t.departmentList, function(t, e) {
                                i.push(e._id),
                                    a.valueMap[e._id] = e.name
                            }),
                                a.valArray = i.concat(a.valArray).unique(),
                                a._updateDept()
                        })) : this._updateDept()
            },
            _updateDept: function() {
                this._updateText(),
                    this._updateCheckList()
            },
            _updateText: function() {
                var a = this
                    , t = this.options;
                this.texts = [],
                    FX.Utils.forEach(this.valArray, function(t, e) {
                        var i = a.valueMap[e];
                        FX.Utils.isNull(i) || a.texts.push(i)
                    }),
                    FX.Utils.applyFunc(this, t.onStopEdit, [this.texts.join(",")], !1)
            },
            _updateCheckList: function() {
                var a = this;
                this.departmentTree && this.departmentTree.refresh();
                var t = this.$listView.children("a").not(".select-all");
                FX.Utils.forEach(t, function(t, e) {
                    var i = l(e);
                    i.removeClass("select"),
                    -1 < a.valArray.indexOf(i.attr("option")) && i.addClass("select")
                }),
                    this._checkSelectAll()
            },
            setValue: function(t) {
                var e, a = this;
                this.options;
                this.valArray = [],
                    this.value = t,
                FX.Utils.isObjectEmpty(this.value) && (this.value = {
                    items: []
                }),
                    FX.Utils.isObjectEmpty(this.value.items) ? this.setCurDept() : (e = FX.Utils.createMask(this.element, {
                        isLight: !0,
                        hasLoader: !0
                    }),
                        FX.Utils.ajax({
                            url: FX.Utils.getApi(FX.API.corp.list_member_name),
                            data: {
                                isDepartmentOnly: !0,
                                members: this.value.items
                            }
                        }, function(t) {
                            e.remove();
                            var i = [];
                            FX.Utils.forEach(t.departments, function(t, e) {
                                i.push(e._id),
                                    a.valueMap[e._id] = e.name
                            }),
                                a.valArray = i.concat(a.valArray).unique(),
                                a.setCurDept()
                        }))
            },
            getValue: function() {
                if (FX.Utils.isObjectEmpty(this.valArray))
                    return {};
                var t = [].concat(this.valArray)
                    , i = !1
                    , a = !1
                    , n = [];
                return FX.Utils.forEach(t, function(t, e) {
                    switch (e) {
                        case FX.CONST.PARAMETER.EMPTY:
                            i = !0;
                            break;
                        case FX.CONST.DEPT_ID.CURRENT:
                            a = !0;
                            break;
                        default:
                            n.push(e)
                    }
                }),
                    {
                        hasCurrentDept: a,
                        hasEmpty: i,
                        items: n
                    }
            },
            rebuild: function(t) {
                this.value = t,
                    this._initData(),
                    this._refreshData()
            }
        }),
            l.shortcut("deptchecklist", FX.DeptCheckList)
    }(jQuery),
    function(a) {
        FX.DeptCheckBox = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return a.extend(FX.DeptCheckBox.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_dept_check",
                    allowBlank: !1,
                    dynamicType: "select",
                    edge: {
                        width: 240,
                        height: 230
                    },
                    hasScrollLoad: !1,
                    hasSelectAll: !0,
                    hasSelectCurrent: !0,
                    hasSelectEmpty: !0,
                    height: 30,
                    width: 240,
                    multiSelect: !0,
                    searchable: !0,
                    textField: "name",
                    valueField: "_id",
                    departmentsUrl: FX.Utils.getApi(FX.API.data.departments),
                    currentDepartmentsUrl: FX.Utils.getApi(FX.API.data.current_departments),
                    waterMark: null,
                    onStopEdit: null
                })
            },
            _init: function() {
                FX.DeptCheckBox.superclass._init.apply(this, arguments),
                    this._initContent()
            },
            _initContent: function() {
                var t = this.options;
                this.editComp = a('<input class="fui_trigger-input" />').attr("readonly", "readonly").attr("placeholder", t.waterMark).appendTo(this.element),
                    a('<i class="fui_trigger-btn icon-caret-down" />').appendTo(this.element),
                    this._createTriggerView(),
                    this._bindEvents()
            },
            _bindEvents: function() {
                var i = this;
                this.element.unbind("click.trigger"),
                    this.element.bind("click.trigger", function(t) {
                        var e = a(t.target);
                        (0 < e.closest(".fui_trigger-input").length || 0 < e.closest(".fui_trigger-btn").length) && i._onTriggerClick()
                    })
            },
            _onTriggerClick: function() {
                var i = this;
                this._showTriggerView(),
                    a(document).bind("mousedown.dept-check", function(t) {
                        var e = t.target;
                        0 === a(e).closest(i.$triggerView).length && i._hideTriggerView()
                    })
            },
            _showTriggerView: function() {
                this.options;
                this.$triggerView || this._createTriggerView(),
                    this.$triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.options.searchable && this.$triggerView.find("input").focus()
            },
            _hideTriggerView: function() {
                var t = this.options;
                this.$triggerView && (a(document).unbind("mousedown.dept-check"),
                    this.$triggerView.detach(),
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1))
            },
            _calTriggerViewPos: function() {
                var t = {
                    "z-Index": FX.STATIC.zIndex++
                }
                    , e = this.element.offset()
                    , i = this.options.edge
                    , a = document.body.clientWidth - e.left;
                return a < i.width ? (t.right = a - this.element.outerWidth(),
                    t.left = "auto") : (t.right = "auto",
                    t.left = e.left),
                    document.body.clientHeight + document.body.scrollTop - e.top - this.element.outerHeight() < i.height ? (t.top = "auto",
                        t.bottom = document.body.clientHeight - e.top) : (t.top = e.top + this.element.outerHeight(),
                        t.bottom = "auto"),
                    t
            },
            _createTriggerView: function() {
                var e = this
                    , t = this.options;
                this.$triggerView = a('<div class="x-dropdown dept-dropdown" />'),
                    this.deptlist = new FX.DeptCheckList({
                        renderEl: this.$triggerView,
                        allowBlank: t.allowBlank,
                        dynamicType: t.dynamicType,
                        hasSelectAll: t.hasSelectAll,
                        hasSelectCurrent: t.hasSelectCurrent,
                        hasSelectEmpty: t.hasSelectEmpty,
                        multiSelect: t.multiSelect,
                        searchable: t.searchable,
                        textField: t.textField,
                        valueField: t.valueField,
                        departmentsUrl: t.departmentsUrl,
                        currentDepartmentsUrl: t.currentDepartmentsUrl,
                        onStopEdit: function(t) {
                            e.editComp && e.editComp.val(t)
                        },
                        onMultiSelect: function() {
                            e._hideTriggerView()
                        }
                    })
            },
            doResize: function() {
                FX.DeptCheckBox.superclass.doResize.apply(this, arguments);
                var t = this.options.height;
                this.element.css({
                    "line-height": t - 2 + "px"
                })
            },
            setValue: function(t) {
                this.deptlist && this.deptlist.setValue(t)
            },
            getValue: function() {
                return this.deptlist && this.deptlist.getValue()
            },
            rebuild: function(t) {
                this.deptlist && this.deptlist.rebuild(t)
            }
        }),
            a.shortcut("deptcheck", FX.DeptCheckBox)
    }(jQuery),
    function(s) {
        FX.UserCheckBox = FX.extend(FX.XComboCheckBox, {
            _createItem: function(t) {
                var e = this.options
                    , i = t[e.valueField]
                    , a = t[e.textField];
                FX.Utils.isNull(i) || (this.valueMap[i] = a),
                    this.itemsMap[i] = !0;
                var n = s('<a class="x-dropdown-item x-check"/>').data("option", i).attr("title", a).append(s('<i class="icon-blank"/>')).append(s("<span />").text(a));
                return -1 < this.values.indexOf(i) && n.addClass("select"),
                i === FX.USER_ID.CurrentUser && n.addClass("field-meta"),
                    t.selectAll ? n.addClass("select-all field-meta") : t.selectEmpty && n.addClass("select-empty field-meta"),
                    n
            },
            setValue: function(t) {
                var i = this;
                t = t || [];
                var e = [];
                FX.Utils.isArray(t) ? e = t : (e = e.concat(t.items || []),
                t.hasEmpty && e.indexOf(FX.CONST.PARAMETER.EMPTY) < 0 && e.unshift(FX.CONST.PARAMETER.EMPTY)),
                    this.values = e,
                    this.texts = [];
                var a = [];
                FX.Utils.forEach(this.values, function(t, e) {
                    i.valueMap[e] || a.push(e)
                }),
                    this.valueMap[FX.USER_ID.CurrentUser] = i18next.t("widget.user.current"),
                    FX.Utils.isObjectEmpty(a) ? -1 < this.values.indexOf(FX.CONST.PARAMETER.EMPTY) && (this.texts.push(this.valueMap[FX.CONST.PARAMETER.EMPTY]),
                        i._setEditCompTexts(i.texts)) : FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.corp.list_member_name),
                        data: {
                            isUserOnly: !0,
                            members: a
                        }
                    }, function(t) {
                        FX.Utils.forEach(t.users, function(t, e) {
                            i.valueMap[e._id] = e.nickname
                        }),
                            i.texts = [],
                            FX.Utils.forEach(i.values, function(t, e) {
                                i.texts.push(i.valueMap[e] || e)
                            }),
                            i._setEditCompTexts(i.texts)
                    })
            }
        }),
            s.shortcut("usercheck", FX.UserCheckBox)
    }(jQuery),
    function(n) {
        FX.ButtonGroup = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return n.extend(FX.ButtonGroup.superclass._defaultConfig.apply(), {
                    baseCls: "x-group",
                    btnCls: "btn_group",
                    allowBlank: !0,
                    layout: null,
                    colorEnable: !1,
                    items: [{
                        value: "1",
                        text: "1"
                    }, {
                        value: "2",
                        text: "2"
                    }, {
                        value: "3",
                        text: "3"
                    }]
                })
            },
            _init: function() {
                FX.ButtonGroup.superclass._init.apply(this, arguments);
                var t = this.options
                    , i = this;
                this.$btns = [],
                    this.$btnOther = null;
                var e = this._getItems();
                e && FX.Utils.forEach(e, function(t, e) {
                    i._createItem(e)
                }),
                t.colorEnable && this.element.addClass("color-enable"),
                    this._bindEvt()
            },
            _getItems: function() {
                return this.options.items
            },
            _createItem: function(t) {
                var e = this.options
                    , i = this._createItemDOM(t);
                return e.layout && i.addClass(e.layout),
                    n('<i class="icon-blank"/>').appendTo(i),
                t.selected && i.addClass("select"),
                    !e.colorEnable || t.isOther ? n("<span/>").text(t.text).appendTo(i) : new FX.TextTag({
                        renderEl: n("<span/>").appendTo(i),
                        text: t.text,
                        bgColor: t.color,
                        multiLine: !0,
                        size: "large"
                    }),
                    this.$btns.push(i),
                    i
            },
            _createItemDOM: function(t) {
                return n('<div class="group_item"/>').attr("value", t.value).data("item", t).addClass(this.options.btnCls).appendTo(this.element)
            },
            _bindEvt: function() {
                var a = this;
                this.element.unbind("click.group"),
                    this.element.bind("click.group", function(t) {
                        var e, i;
                        a.isEnabled() && ("INPUT" === (e = t.target.tagName ? t.target.tagName.toUpperCase() : "") || "TEXTAREA" === e || (i = n(t.target).closest(".group_item")) && 0 < i.length && a._doItemClick(i))
                    })
            },
            _doItemClick: function(t) {},
            getOptions: function() {
                var t = this.options;
                return n.extend(FX.ButtonGroup.superclass.getOptions.apply(this, arguments), {
                    items: t.items,
                    layout: t.layout,
                    colorEnable: t.colorEnable
                })
            }
        })
    }(jQuery),
    function(s) {
        FX.RadioGroup = FX.extend(FX.ButtonGroup, {
            _defaultConfig: function() {
                return s.extend(FX.RadioGroup.superclass._defaultConfig.apply(), {
                    btnCls: "x-radio",
                    allowDeselect: !0,
                    onAfterItemSelect: null,
                    onItemCreate: null,
                    otherInputWidth: 180,
                    onStopEdit: null,
                    onStateChange: null,
                    layout: "vertical"
                })
            },
            _doItemClick: function(t) {
                var e, i = this.options, a = !0;
                if (t.hasClass("select")) {
                    if (!i.allowDeselect)
                        return;
                    t.removeClass("select"),
                        a = !1
                } else
                    s(".select", this.element).removeClass("select"),
                        t.addClass("select"),
                        a = !0;
                t.hasClass("item-other") ? ((e = t.data("widget")).setEnable(a),
                a && e.select()) : this.$btnOther && this.$btnOther.data("widget").setEnable(!1);
                var n = s(".select", this.element);
                FX.Utils.applyFunc(this, i.onAfterItemSelect, [n, n.data("item")], !1),
                    FX.Utils.applyFunc(this, i.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, i.onStateChange, [], !1)
            },
            _createItem: function(t) {
                var e, i = FX.RadioGroup.superclass._createItem.apply(this, arguments), a = this.options, n = this;
                t.isOther && (e = FX.createWidget({
                    renderEl: s('<div class="text-other"/>').appendTo(i),
                    width: a.otherInputWidth,
                    allowBlank: a.allowBlank,
                    type: "text",
                    enable: !!t.selected,
                    onStopEdit: function() {
                        FX.Utils.applyFunc(n, a.onStopEdit, [], !1),
                            FX.Utils.applyFunc(n, a.onStateChange, [], !1)
                    }
                }),
                    i.addClass("item-other"),
                    (this.$btnOther = i).data("widget", e)),
                    FX.Utils.applyFunc(this, a.onItemCreate, [t, i], !1)
            },
            setEnable: function(t) {
                var e;
                FX.RadioGroup.superclass.setEnable.apply(this, [t]),
                this.$btnOther && (e = this.$btnOther.data("widget"),
                    this.$btnOther.hasClass("select") && t ? e.setEnable(!0) : e.setEnable(!1))
            },
            effectItemLinkWidgets: function() {
                var t = this.options
                    , e = s(".select", this.element);
                FX.Utils.applyFunc(this, t.onAfterItemSelect, [e, e.data("item")], !1)
            },
            setValue: function(a) {
                var n, t;
                s(".select", this.element).removeClass("select"),
                    FX.Utils.isEmpty(a) ? this.$btnOther && this.$btnOther.removeClass("select") : (n = !1,
                        FX.Utils.forEach(this.$btns, function(t, e) {
                            var i = e.data("item");
                            if (i.value === a && !i.isOther)
                                return e.addClass("select"),
                                    !(n = !0)
                        }),
                    this.$btnOther && (t = this.$btnOther.data("widget"),
                        n ? t.setEnable(!1) : (this.$btnOther.addClass("select"),
                            t.setValue(a),
                            t.setEnable(this.isEnabled()))))
            },
            checkValidate: function() {
                return !(!this.options.allowBlank && FX.Utils.isEmpty(this.getValue()))
            },
            getValue: function() {
                var a = []
                    , t = s(".select", this.element);
                return FX.Utils.forEach(t, function(t, e) {
                    var i = s(e).data("item");
                    i && (i.isOther ? a.push(s(e).data("widget").getValue()) : a.push(i.value))
                }),
                    0 < a.length ? a.join("") : null
            },
            setText: function(i) {
                var a = this;
                s(".select", this.element).removeClass("select"),
                    FX.Utils.forEach(this.$btns, function(t, e) {
                        return e.data("item").text === i ? (e.addClass("select"),
                            !1) : void (a.$btnOther && (a.$btnOther.addClass("select"),
                            a.$btnOther.data("widget").setValue(i)))
                    })
            },
            getText: function() {
                var a = []
                    , t = s(".select", this.element);
                return FX.Utils.forEach(t, function(t, e) {
                    var i = s(e).data("item");
                    i.isOther ? a.push(s(e).data("widget").getValue()) : a.push(i.text)
                }),
                    0 < a.length ? a.join("") : null
            }
        }),
            s.shortcut("radiogroup", FX.RadioGroup)
    }(jQuery),
    function(n) {
        FX.CheckBoxGroup = FX.extend(FX.ButtonGroup, {
            _defaultConfig: function() {
                return n.extend(FX.CheckBoxGroup.superclass._defaultConfig.apply(), {
                    btnCls: "x-check",
                    onAfterItemSelect: null,
                    onStateChange: null,
                    layout: "vertical"
                })
            },
            _createItemDOM: function(t) {
                var e = FX.CheckBoxGroup.superclass._createItemDOM.apply(this, arguments)
                    , i = !1 !== t.enable;
                return e.toggleClass("x-ui-disable", !i)
            },
            _doItemClick: function(t) {
                FX.CheckBoxGroup.superclass._doItemClick.apply(this, arguments);
                var e = this.options
                    , i = t.data("item");
                if (t.hasClass("x-ui-disable"))
                    return !1;
                t.toggleClass("select");
                var a = t.hasClass("select");
                this._dealItemClick(i, a),
                    FX.Utils.applyFunc(this, e.onAfterItemSelect, [t, i, a], !1),
                    FX.Utils.applyFunc(this, e.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, e.onStateChange, [], !1)
            },
            _dealItemClick: function(t, e) {},
            checkValidate: function() {
                return !(!this.options.allowBlank && 0 === n(".select", this.element).length)
            },
            setValue: function(t) {
                n(".select", this.element).removeClass("select");
                var a = n.makeArray(t);
                FX.Utils.forEach(this.$btns, function(t, e) {
                    var i = n(e).data("item");
                    -1 < a.indexOf(i.value) && n(e).addClass("select")
                })
            },
            getValue: function() {
                var a = []
                    , t = n(".select", this.element);
                return FX.Utils.forEach(t, function(t, e) {
                    var i = n(e).data("item");
                    a.push(i.value)
                }),
                    a
            },
            setText: function(t) {
                n(".select", this.element).removeClass("select");
                var a = n.makeArray(t);
                FX.Utils.forEach(this.$btns, function(t, e) {
                    var i = n(e).data("item");
                    -1 < a.indexOf(i.text) && n(e).addClass("select")
                })
            },
            getText: function() {
                var a = []
                    , t = n(".select", this.element);
                return FX.Utils.forEach(t, function(t, e) {
                    var i = n(e).data("item");
                    a.push(i.text)
                }),
                    a
            },
            getNullValue: function() {
                return []
            }
        }),
            n.shortcut("checkboxgroup", FX.CheckBoxGroup)
    }(jQuery),
    function(n) {
        FX.Address = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return n.extend(FX.Address.superclass._defaultConfig.apply(), {
                    baseCls: "fui_address",
                    needDetail: !0,
                    allowBlank: !0,
                    width: 420,
                    width4province: "45%",
                    width4city: "24%",
                    width4district: "24%",
                    width4detail: "100%",
                    height4detail: 65,
                    onStateChange: null
                })
            },
            _init: function() {
                FX.Address.superclass._init.apply(this, arguments);
                var t = n('<div class="fui_address-select"/>').appendTo(this.element)
                    , e = this
                    , i = this.options
                    , a = [];
                FX.Utils.forEach(FX.AddressData, function(t) {
                    a.push({
                        value: t,
                        text: t
                    })
                }),
                    this.province = FX.createWidget({
                        type: "combo",
                        customCls: "sel-province",
                        items: a,
                        renderEl: n("<div/>").appendTo(t),
                        allowBlank: i.allowBlank,
                        width: i.width4province,
                        waterMark: i18next.t("widget.address.province"),
                        onAfterItemSelect: function() {
                            e.linkByProvince(this.getValue()),
                                FX.Utils.applyFunc(e, i.onStopEdit, [], !1),
                                FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                        }
                    }),
                    this.city = FX.createWidget({
                        type: "combo",
                        customCls: "sel-city",
                        items: [],
                        renderEl: n("<div/>").appendTo(t),
                        allowBlank: i.allowBlank,
                        width: i.width4city,
                        waterMark: i18next.t("city"),
                        onAfterItemSelect: function() {
                            e.linkByProvinceAndCity(e.province.getValue(), this.getValue()),
                                FX.Utils.applyFunc(e, i.onStopEdit, [], !1)
                        },
                        onStateChange: function() {
                            FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                        }
                    }),
                    this.district = FX.createWidget({
                        type: "combo",
                        renderEl: n("<div/>").appendTo(t),
                        customCls: "sel-district",
                        allowBlank: i.allowBlank,
                        width: i.width4district,
                        waterMark: i18next.t("widget.address.district"),
                        items: [],
                        onAfterItemSelect: function() {
                            FX.Utils.applyFunc(e, i.onStopEdit, [], !1)
                        },
                        onStateChange: function() {
                            FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                        }
                    }),
                    i.needDetail ? this.detail = FX.createWidget({
                        type: "textarea",
                        customCls: "address-detail",
                        waterMark: i18next.t("widget.address.detail"),
                        allowBlank: i.allowBlank,
                        width: i.width4detail,
                        height: i.height4detail,
                        renderEl: n("<div/>").appendTo(this.element),
                        onStopEdit: function() {
                            FX.Utils.applyFunc(e, i.onStopEdit, [], !1)
                        },
                        onStateChange: function() {
                            FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                        }
                    }) : this.element.addClass("no-detail")
            },
            linkByProvince: function(t) {
                var e = [];
                FX.Utils.forEach(FX.AddressData[t], function(t) {
                    e.push({
                        value: t,
                        text: t
                    })
                }),
                    this.city.options.items = e,
                    this.district.options.items = [],
                    this.city.rebuild(),
                    this.district.rebuild()
            },
            linkByProvinceAndCity: function(t, e) {
                var i, a = FX.AddressData[t];
                a ? (i = [],
                    FX.Utils.forEach(a[e], function(t, e) {
                        i.push({
                            value: e,
                            text: e
                        })
                    }),
                    this.district.options.items = i) : this.district.options.items = [],
                    this.district.rebuild()
            },
            setEnable: function(t) {
                this.options.enable = !!t,
                    this.province.setEnable(t),
                    this.city.setEnable(t),
                    this.district.setEnable(t),
                this.detail && this.detail.setEnable(t)
            },
            checkValidate: function() {
                var t = this.province.checkValidate() && this.city.checkValidate() && this.district.checkValidate();
                return this.detail && (t = this.detail.checkValidate() && t),
                    t
            },
            setValue: function(t) {
                FX.Utils.isObjectEmpty(t) ? (this.province.setValue(null),
                    this.linkByProvince(null),
                this.detail && this.detail.setValue(null)) : (this.province.setValue(t.province),
                    this.linkByProvince(t.province),
                    this.city.setValue(t.city),
                    this.linkByProvinceAndCity(t.province, t.city),
                    this.district.setValue(t.district),
                this.detail && this.detail.setValue(t.detail))
            },
            getValue: function() {
                var t = {}
                    , e = this.province.getValue()
                    , i = this.city.getValue()
                    , a = this.district.getValue()
                    , n = this.detail ? this.detail.getValue() : null;
                return FX.Utils.isEmpty(e) || (t.province = e),
                FX.Utils.isEmpty(i) || (t.city = i),
                FX.Utils.isEmpty(a) || (t.district = a),
                FX.Utils.isEmpty(n) || (t.detail = n),
                    t
            },
            getText: function() {
                var t = this.getValue();
                return [t.province, t.city, t.district, t.detail].join("")
            },
            getOptions: function() {
                var t = this.options;
                return n.extend(FX.Address.superclass.getOptions.apply(this, arguments), {
                    needDetail: t.needDetail
                })
            },
            getNullValue: function() {
                return {}
            }
        }),
            n.shortcut("address", FX.Address)
    }(jQuery),
    function(a) {
        FX.Location = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return a.extend(FX.Location.superclass._defaultConfig.apply(), {
                    baseCls: "fui_location",
                    allowBlank: !0,
                    locationText: i18next.t("widget.location.get"),
                    hasBrief: !0,
                    btnWidth: 240,
                    btnHeight: 36,
                    isValueVisible: !0
                })
            },
            _init: function() {
                FX.Location.superclass._init.apply(this, arguments);
                var t = this.options;
                this.button = new FX.Button({
                    renderEl: a('<div class="location-btn"/>').appendTo(this.element),
                    text: t.locationText,
                    style: "white",
                    width: t.btnWidth,
                    height: t.btnHeight
                }),
                t.hasBrief && a('<span class="location-tip"/>').text(i18next.t("widget.location.mobileOpen")).appendTo(this.element)
            },
            checkValidate: function() {
                return this.options.allowBlank || !FX.Utils.isObjectEmpty(this.value)
            },
            setValue: function(t) {
                var e, i = this.options;
                this.value = t,
                !FX.Utils.isObjectEmpty(t) && i.isValueVisible && (e = FX.Utils.address2Str(t, "", "pcda"),
                    this.$info ? this.$info.text(e) : (this.$info = a('<div class="location-info"/>').prependTo(this.element).append("<span>" + e + "</span>"),
                    i.lnglatVisible && a('<div class="sub-info">' + FX.Utils.getLnglatText(t) + "</div>").appendTo(this.$info)))
            },
            getValue: function() {
                return this.value || {}
            },
            getOptions: function() {
                var t = this.options;
                return a.extend(FX.Location.superclass.getOptions.apply(this, arguments), {
                    adjustable: t.adjustable,
                    radius: t.radius,
                    limits: t.limits,
                    lnglatVisible: t.lnglatVisible
                })
            },
            getNullValue: function() {
                return {}
            }
        }),
            a.shortcut("location", FX.Location)
    }(jQuery),
    function(r) {
        FX.Upload = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return r.extend(FX.Upload.superclass._defaultConfig.apply(), {
                    files: [],
                    fileType: [],
                    maxFileSize: 5242880,
                    maxLimitTip: i18next.t("upload.maxLimitTip"),
                    maxFileCount: FX.CONST.UPLOAD_FILE_COUNT.SINGLE,
                    uploadURL: FX.CONST.UPLOAD_URL.qn,
                    uploadTokenURL: FX.Utils.getApi(FX.API.file.get_qn_token),
                    uploadSite: "qn",
                    uploadToMedia: !1,
                    uploadToForm: !1,
                    uploadAnimation: !1,
                    allowBlank: !0,
                    onValidateSuccess: null,
                    onValidateFail: null,
                    onAfterValidate: null,
                    onUpload: null,
                    onUploadSuccess: null,
                    onUploadFail: null,
                    onAfterUpload: null,
                    deleteOnly: !1
                })
            },
            _init: function() {
                FX.Upload.superclass._init.apply(this, arguments),
                    this._initUploadForm(),
                    this._initUploadInput(),
                    this.uploading = !1,
                    this._preventDefault()
            },
            _initUploadForm: function() {
                var t = this.options;
                this.$uploadForm = r('<form class="upload-form" action="' + t.uploadURL + '" enctype="multipart/form-data" method="post"/>')
            },
            _initUploadInput: function() {
                var t = this.options;
                this.files = t.files || [],
                    this.$uploadInput = r('<input type="file" name="file" class="upload-btn-input" multiple="multiple"/>').appendTo(this.$uploadForm),
                    this._bindDragEvent(this.$uploadInput)
            },
            _bindDragEvent: function(t) {
                t.bind("dragover", function(t) {
                    r(t.target.closest(".upload-btn")).addClass("on-drag")
                }),
                    t.bind("dragleave", function(t) {
                        r(t.target.closest(".upload-btn")).removeClass("on-drag")
                    }),
                    t.bind("drop", function(t) {
                        r(t.target.closest(".upload-btn")).removeClass("on-drag")
                    })
            },
            doUpload: function() {
                var t = this;
                if (!this.upFiles) {
                    if (1 < !this.$uploadInput[0].files.length)
                        return;
                    this.upFiles = this.$uploadInput[0].files
                }
                this._setUploadToken(function() {
                    t.uploading = !0,
                        t._doDataUpload()
                })
            },
            _setUploadToken: function(e) {
                var i = this
                    , t = this.options;
                if ("local" === t.uploadSite)
                    return e();
                var a = FX.Utils.applyFunc(this, t.onGetAjaxData, [], {});
                "file" === t.uploadTokenType && (a.type = "file"),
                    FX.Utils.dataAjax({
                        url: t.uploadTokenURL,
                        data: a
                    }, function(t) {
                        i.uploadToken = t.token,
                            e()
                    }, function(t) {
                        FX.Vip.showUpgradeTip(t.responseJSON)
                    })
            },
            _doDataUpload: function() {
                var i = this;
                this.options;
                if (FX.Utils.isFormDataSupported()) {
                    this.successCount = 0,
                        this.failCount = 0;
                    function t() {
                        i.successCount + i.failCount === i.upFiles.length && (i.uploading = !1,
                            FX.Utils.forEach(i.tempFileList, function(t, e) {
                                FX.Utils.isEmpty(e) || i.files.push(e)
                            }),
                            0 < i.failCount ? i.onFail({
                                failCount: i.failCount
                            }) : i.onSuccess(),
                            i._checkFileCount())
                    }
                    if (this.upFiles) {
                        this.tempFileList = Array(this.upFiles.length);
                        for (var e = 0, a = this.upFiles.length; e < a; e++)
                            this._uploadFile(this.upFiles[e], e, t)
                    }
                } else
                    FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("upload.browserNotSupportTip")
                    })
            },
            _uploadFile: function(i, t, a) {
                var n = this
                    , e = this.options
                    , s = this._onBeforeDataUpload(i);
                FX.Utils.uploadFile(r.extend(FX.Utils.applyFunc(this, e.onGetAjaxData, [], {}), {
                    uploadSite: e.uploadSite,
                    uploadUrl: e.uploadURL,
                    uploadToMedia: e.uploadToMedia,
                    uploadToForm: e.uploadToForm,
                    uploadToken: this.uploadToken,
                    widgetName: e.widgetName,
                    sequence: t
                }), i, function(t) {
                    n.onUpload(t, i.size, s)
                }, function(t, e) {
                    n.onUpload(i.size, i.size, r.extend(s, {
                        id: t.file._id
                    })),
                        FX.Utils.isNumber(e) ? n.tempFileList[e] = t.file : n.files.push(t.file),
                        n.successCount++,
                        a()
                }, function() {
                    n.onUpload(0, i.size, r.extend(s, {
                        fail: !0
                    })),
                        n.failCount++,
                        a()
                })
            },
            _onBeforeDataUpload: function() {
                return null
            },
            _setUploadBtnEnable: function(t) {
                var e = this.options;
                t ? this.$uploadInput.removeAttr("disabled").removeAttr("readonly") : this.$uploadInput.attr("disabled", "disabled").attr("readonly", "readonly"),
                e.uploadAnimation && (t ? this.$uploadInput.closest(".fui_upload").children(".upload-preview-list").removeClass("loading") : this.$uploadInput.closest(".fui_upload").children(".upload-preview-list").addClass("loading"))
            },
            checkValidate: function() {
                var t = this.options
                    , e = !0;
                return this.setInvalidateType(""),
                (e = !this.isUploading()) || this.setInvalidateType(FX.CONST.INVALID_TYPE.FILE_UPLOADING),
                !t.allowBlank && e && ((e = this.isUploaded()) || this.setInvalidateType(FX.CONST.INVALID_TYPE.BLANK)),
                    e ? (this.setInvalidateType(""),
                        FX.Utils.applyFunc(this, t.onValidateSuccess, [], !1)) : FX.Utils.applyFunc(this, t.onValidateFail, [], !1),
                    FX.Utils.applyFunc(this, t.onAfterValidate, [], !1),
                    e
            },
            _preventDefault: function() {
                r("body").off("dragover drop").on("dragover drop", function(t) {
                    t.stopPropagation(),
                    "upload-btn-input" !== t.target.className && t.preventDefault()
                })
            },
            checkFile: function(t) {
                var e = this.options;
                if (!t)
                    return !1;
                var i = t.name.split(".").pop()
                    , a = !0;
                a && 0 < e.fileType.length && -1 === e.fileType.indexOf(i.toLowerCase()) && (FX.Msg.toast({
                    msg: i18next.t("upload.notSupportFileTip"),
                    type: "warning"
                }),
                    a = !1);
                var n = e.maxFileSize;
                return a && t.size > n && (FX.Msg.toast({
                    msg: e.maxLimitTip,
                    type: "warning"
                }),
                    a = !1),
                    a
            },
            doClear: function() {
                this.resetUploadInput(),
                    this.files = [],
                    this._checkFileCount()
            },
            _checkFileCount: function() {
                var t = this.options;
                t.maxFileCount === FX.CONST.UPLOAD_FILE_COUNT.SINGLE || t.deleteOnly || (this.files.length >= t.maxFileCount ? (this.$uploadBtn.addClass("number-disable"),
                    this.$uploadInput.attr("disabled", "disabled")) : (this.$uploadBtn.removeClass("number-disable"),
                    this.$uploadInput.removeAttr("disabled")))
            },
            resetUploadInput: function() {
                this.$uploadInput.replaceWith(this.$uploadInput = this.$uploadInput.clone(!0).val(""))
            },
            onUpload: function(t, e, i) {
                var a = this.options;
                FX.Utils.applyFunc(this, a.onUpload, [t, e, i], !1)
            },
            onSuccess: function() {
                var t = this.options;
                FX.Utils.applyFunc(this, t.onUpload, [1, 1], !1),
                    FX.Utils.applyFunc(this, t.onUploadSuccess, [this.files], !1),
                    this.resetUploadInput()
            },
            onFail: function(t) {
                var e = this.options;
                FX.Utils.applyFunc(this, e.onUploadFail, [t], !1),
                    413 === t ? FX.Msg.toast({
                        type: "warning",
                        msg: e.maxLimitTip
                    }) : FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("upload.failTip")
                    })
            },
            onFinish: function() {
                var t = this.options;
                FX.Utils.applyFunc(this, t.onAfterUpload, [], !1)
            },
            isUploaded: function() {
                return !FX.Utils.isObjectEmpty(this.files)
            },
            isUploading: function() {
                return this.uploading
            },
            setUploadingStatus: function(t) {
                this.uploading = t
            },
            setEnable: function(t) {
                this.options.enable = !!t,
                    this._setUploadBtnEnable(t)
            },
            getValue: function() {
                return this.files
            },
            getUpFiles: function() {
                return this.upFiles
            },
            getNullValue: function() {
                return []
            },
            setValue: function(t) {
                var e = this.options;
                this.files = r.makeArray(t),
                this.files.length > e.maxFileCount && (this.files = this.files.slice(0, e.maxFileCount))
            },
            getOptions: function() {
                var t = this.options;
                return r.extend(FX.Upload.superclass.getOptions.apply(this, arguments), {
                    maxFileCount: t.maxFileCount
                })
            }
        })
    }(jQuery),
    function(u) {
        FX.FileUpload = FX.extend(FX.Upload, {
            _defaultConfig: function() {
                return u.extend(FX.FileUpload.superclass._defaultConfig.apply(), {
                    baseCls: "fui_upload",
                    style: "white",
                    size: "normal",
                    mode: "upload",
                    iconCls: "icon-widget-upload",
                    btnText: i18next.t("widget.file.select.detail", {
                        num: 200
                    }),
                    noFileTip: i18next.t("widget.file.empty"),
                    maxFileTip: "",
                    fileThumbSize: "",
                    allowBlank: !0,
                    thumbWidth: 65,
                    thumbHeight: 65,
                    progressWidth: 420,
                    progressHeight: 30,
                    hasPreview: !0,
                    hasPreviewList: !0,
                    hasEmptyTip: !1,
                    onBeforeUpload: null,
                    onUpload: null,
                    onAfterUpload: null,
                    onUploadFail: null,
                    onFileThumbCreate: null,
                    onFileRemove: null,
                    onStopEdit: null,
                    onStateChange: null,
                    disableMode: "other",
                    uploadTokenType: "image",
                    deleteOnly: !1
                })
            },
            _init: function() {
                FX.FileUpload.superclass._init.apply(this, arguments);
                var t = this.options;
                "upload" === t.mode && this._createUploadBtn(),
                    this.$previewList = u('<div class="upload-preview-list"/>').attr("data-watermark", t.noFileTip).appendTo(this.element),
                t.enable || "form" !== t.disableMode || this.$previewList.addClass("disable-mode-form"),
                    this._bindFileEvent(),
                t.deleteOnly && this.setEnable(!1)
            },
            _createUploadBtn: function() {
                var t = this.options;
                this.$uploadBtn = u('<div class="upload-btn x-btn"/>').addClass("style-" + t.style).appendTo(this.element),
                t.deleteOnly && this.$uploadBtn.addClass("delete-only");
                var e, i = u('<div class = "icon-container"/>');
                u('<i class="' + t.iconCls + ' upload-icon"/>').appendTo(i),
                    u("<span/>").text(t.btnText).appendTo(i),
                    i.appendTo(this.$uploadBtn),
                    this.$uploadForm.appendTo(this.$uploadBtn),
                0 < t.fileType.length && (e = "." + t.fileType.join(",."),
                    this.$uploadInput.prop("accept", e))
            },
            _checkUploadFiles: function(t) {
                var e = this.options;
                if (this.files.length + t.length > e.maxFileCount)
                    return FX.Msg.toast({
                        msg: this._getMaxCountTip(),
                        type: "warning"
                    }),
                        !1;
                var i = !0;
                if (t)
                    for (var a = 0, n = t.length; a < n && (i = i && this.checkFile(t[a])); a++)
                        ;
                return i
            },
            _getMaxCountTip: function() {
                var t = this.options;
                return t.maxFileTip || i18next.t("widget.file.maxCount", {
                    num: t.maxFileCount
                })
            },
            _previewFiles: function(t) {
                var e = this.options;
                if (e.hasPreviewList) {
                    var i = (t = t || this.files) && 0 < t.length;
                    if (i)
                        for (var a = 0, n = t.length; a < n; a++)
                            this._createFilePreview(t[a]).attr("file-id", t[a]._id).appendTo(this.$previewList);
                    e.hasEmptyTip && this._renderEmpty(!i)
                }
            },
            _createFilePreview: function(t) {
                var e = this.options
                    , i = FX.Utils.formatFileSize(t.size)
                    , a = this._formatFilename(t.name)
                    , n = t.name ? t.name.split(".").pop() : ""
                    , s = FX.Utils.date2Str(new Date(t.uploadTime), "yyyy/MM/dd");
                if ("print" === e.mode)
                    return u("<div/>").text([a.info + a.ext, i18next.t("widget.file.size") + i, i18next.t("widget.file.uploadTime") + s].join(" "));
                var r, o = u('<div class="upload-info"/>'), l = u('<div class="upload-preview"/>').appendTo(o), c = u('<div class="upload-file-info"/>').appendTo(o);
                FX.Utils.isImageExt(n) && t.size <= FX.CONST.MAX_IMAGE_VIEW_SIZE ? t instanceof File ? (this.drawLocalPreview(t, e.thumbWidth, e.thumbHeight).appendTo(l),
                    FX.Utils.applyFunc(this, e.onFileThumbCreate, [{
                        type: "local",
                        ext: t
                    }], !1)) : (r = u("<img/>").attr("src", t.thumbUrl).appendTo(l),
                    FX.Utils.applyFunc(this, e.onFileThumbCreate, [{
                        type: "remote",
                        ext: r.clone()
                    }], !1)) : (FX.Utils.createFileThumb(n, e.fileThumbSize).appendTo(l),
                    FX.Utils.applyFunc(this, e.onFileThumbCreate, [{
                        type: "normal",
                        ext: n
                    }], !1));
                var d = u('<div class="info-text"/>').appendTo(c);
                return u('<span class="text-info"/>').text(a.info).appendTo(d),
                    u('<span class="text-ext"/>').text(a.ext).appendTo(d),
                    u('<div class="info-sub"/>').text(i).appendTo(c),
                (e.enable || e.deleteOnly) && "upload" === e.mode && u('<div class="upload-info-btn remove-btn"/>').append(u('<i class="icon-trasho"/>')).appendTo(o),
                    o
            },
            _renderEmpty: function(t) {
                var e = this.$previewList.next(".upload-empty");
                e && e.length ? t || e.hide() : t && this.$previewList.after('<div class="upload-empty">' + this.options.noFileTip + "</div>")
            },
            _bindFileEvent: function() {
                var o = this
                    , l = this.options;
                this.$previewList.unbind(".file-op"),
                    this.$previewList.bind({
                        "click.file-op": function(t) {
                            var e, i, a, n, s, r;
                            o.element.hasClass("uploading") || (e = t.target,
                                i = t.type,
                                a = u(e).closest(".upload-info-btn.remove-btn"),
                                n = u(e).closest(".upload-info"),
                                "upload" === l.mode && a && 0 < a.length ? "click" === i && (s = n.index(),
                                    r = n.attr("file-id"),
                                    FX.Utils.forEach(o.files, function(t, e) {
                                        if (e._id === r)
                                            return o.files.splice(t, 1),
                                                !1
                                    }),
                                    n.remove(),
                                    o._checkFileCount(),
                                    FX.Utils.applyFunc(o, l.onFileRemove, [s], !1),
                                    FX.Utils.applyFunc(o, l.onStopEdit, [], !1),
                                    FX.Utils.applyFunc(o, l.onStateChange, [], !1)) : l.hasPreview && n && 0 < n.length && new FX.FilePreview({
                                    files: o.files,
                                    currentItem: n.index(),
                                    autoClose: !1
                                }))
                        }
                    }),
                    this.$uploadInput.unbind("change.file-upload"),
                    this.$uploadInput.bind("change.file-upload", function() {
                        if (o.upFiles = this.files,
                        !o.upFiles && !FX.Utils.isFormDataSupported()) {
                            if (!this.value)
                                return;
                            o.upFiles = [{
                                name: this.value.split("\\").pop(),
                                size: this.size
                            }]
                        }
                        if (l.maxFileCount === FX.CONST.UPLOAD_FILE_COUNT.SINGLE && (o.files = [],
                            o.$previewList.empty(),
                        o.$subWrapper && o.$subWrapper.empty()),
                            !o._checkUploadFiles(o.upFiles))
                            return o.upFiles = null,
                                void o.resetUploadInput();
                        o.doUpload()
                    })
            },
            _formatFilename: function(t) {
                if (/([^\/]+)(?=\.)/gi.test(t)) {
                    var e = RegExp.$1;
                    return {
                        info: e,
                        ext: t.replace(e, "")
                    }
                }
                return {
                    info: t,
                    ext: ""
                }
            },
            drawLocalPreview: function(t, e, i) {
                var a = u("<canvas/>")
                    , n = window.URL || window.webkitURL
                    , s = a[0].getContext("2d")
                    , r = new Image
                    , o = n.createObjectURL(t);
                r.src = o;
                var l = 2 * e
                    , c = 2 * i;
                return s.canvas.width = l,
                    s.canvas.height = c,
                    r.onload = function() {
                        var t = r.width / l
                            , e = r.height / c;
                        e < t ? s.drawImage(r, (r.width - l * e) / 2, 0, l * e, r.height, 0, 0, l, c) : s.drawImage(r, 0, (r.height - c * t) / 2, r.width, c * t, 0, 0, l, c),
                            n.revokeObjectURL(o)
                    }
                    ,
                    a
            },
            doUpload: function() {
                FX.FileUpload.superclass.doUpload.apply(this, arguments);
                var t = this.options;
                !this.upFiles || this.upFiles.length <= 0 || (this._setUploadBtnEnable(!1),
                    this.element.addClass("uploading"),
                    FX.Utils.applyFunc(this, t.onBeforeUpload, [{
                        files: null,
                        up: 0,
                        total: 0
                    }], !1),
                    this._renderEmpty(!1))
            },
            onUpload: function(t, e, i) {
                FX.FileUpload.superclass.onUpload.apply(this, arguments),
                    FX.Utils.applyFunc(this, this.options.onUpload, [{
                        files: null,
                        up: t,
                        total: e
                    }], !1);
                var a, n = i && i.progress, s = i && i.fail;
                n && (n.setValue(t),
                0 !== t && t !== i.file.size || n.setVisible(!1)),
                s && (a = i.preview) && a.length && a.remove(),
                i && i.id && (a = i.preview) && a.length && a.attr("file-id", i.id)
            },
            _onBeforeDataUpload: function(t) {
                if (this.options.hasPreviewList) {
                    var e = this._createFilePreview(t).appendTo(this.$previewList);
                    return {
                        progress: new FX.Progress({
                            renderEl: u("<div/>").appendTo(e),
                            valueMax: t.size,
                            customCls: "upload-progress",
                            width: "100%",
                            height: 4
                        }),
                        file: t,
                        preview: e
                    }
                }
                return null
            },
            onSuccess: function() {
                FX.FileUpload.superclass.onSuccess.apply(this, arguments);
                var t = this.options;
                this.element.removeClass("uploading"),
                    FX.Utils.applyFunc(this, t.onAfterUpload, [{
                        files: this.files,
                        up: 0,
                        total: 0
                    }], !1),
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, t.onStateChange, [], !1),
                    this._setUploadBtnEnable(!0)
            },
            onFail: function(t) {
                FX.FileUpload.superclass.onFail.apply(this, arguments);
                var e = this.options;
                this.element.removeClass("uploading"),
                    this._setUploadBtnEnable(!0),
                    FX.Utils.applyFunc(this, e.onUploadFail, [], !1)
            },
            doClear: function() {
                FX.FileUpload.superclass.doClear.apply(this, arguments),
                    this.$previewList.empty()
            },
            setEnable: function(t) {
                FX.FileUpload.superclass.setEnable.apply(this, [t]),
                    t ? this.element.removeClass("x-ui-disable") : this.element.addClass("x-ui-disable"),
                    this.$previewList.empty(),
                    this._previewFiles()
            },
            setValue: function(t) {
                FX.FileUpload.superclass.setValue.apply(this, arguments),
                    this.$previewList.empty(),
                t && this._previewFiles()
            }
        }),
            u.shortcut("upload", FX.FileUpload)
    }(jQuery),
    jQuery,
    FX.ImageUpload = FX.extend(FX.FileUpload, {
        _defaultConfig: function() {
            return $.extend(FX.ImageUpload.superclass._defaultConfig.apply(), {
                baseCls: "fui_upload fui_image",
                fileType: ["jpg", "jpeg", "png", "gif"],
                iconCls: "icon-widget-image",
                btnText: i18next.t("widget.image.select.detail", {
                    num: 20
                }),
                noFileTip: i18next.t("widget.image.empty"),
                maxFileTip: "",
                compressed: !1,
                onlyCamera: !1,
                watermark: !1,
                uploadAnimation: !0,
                uploadTokenType: "image"
            })
        },
        _createUploadBtn: function() {
            FX.ImageUpload.superclass._createUploadBtn.apply(this, arguments),
            this.options.onlyCamera && $('<span class="upload-tip">' + i18next.t("widget.image.onlyCameraTip") + "</span>").appendTo(this.element)
        },
        _getMaxCountTip: function() {
            var t = this.options;
            return t.maxFileTip || i18next.t("widget.image.maxCount", {
                num: t.maxFileCount
            })
        },
        setEnable: function(t) {
            FX.ImageUpload.superclass.setEnable.apply(this, [t]);
            var e = this.options;
            this.$uploadBtn && this.$uploadInput && (!e.onlyCamera && t ? (this.element.removeClass("x-ui-disable"),
                this.$uploadInput.removeAttr("disabled").removeAttr("readonly")) : (this.element.addClass("x-ui-disable"),
                this.$uploadInput.attr("disabled", "disabled").attr("readonly", "readonly")))
        },
        getOptions: function() {
            var t = this.options;
            return $.extend(FX.ImageUpload.superclass.getOptions.apply(this, arguments), {
                compressed: t.compressed,
                onlyCamera: t.onlyCamera,
                watermark: t.watermark,
                uploadTokenType: t.uploadTokenType
            })
        }
    }),
    $.shortcut("image", FX.ImageUpload),
    function(_) {
        FX.SubForm = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return _.extend(FX.SubForm.superclass._defaultConfig.apply(), {
                    baseCls: "fui_subform",
                    API: FX.API,
                    allowBlank: !0,
                    ignoreOptAuth: !1,
                    items: [],
                    itemPadding: 12,
                    itemShowCount: 10,
                    maxItemCount: 200,
                    newItemText: i18next.t("add"),
                    noFieldText: i18next.t("field.add"),
                    needEvent: !0,
                    label: "",
                    mode: "edit",
                    onBeforeRowEdit: null,
                    onBeforeWidgetCreate: null,
                    onAfterWidgetCreate: null,
                    onRowChange: null,
                    rowHeadWidth: 66,
                    rowBorder: 1,
                    rowHeight: 40,
                    rowBottom: 25,
                    tipWidth: null,
                    subform_create: !0,
                    subform_edit: !0,
                    subform_sort: !1,
                    subform_delete: !0,
                    onStopEdit: null,
                    onStateChange: null
                })
            },
            _init: function() {
                FX.SubForm.superclass._init.apply(this, arguments);
                var t = this.options;
                this.ps = null,
                    this.rowIdx = 0,
                    this.fullScreen = !1,
                    this.colorMap = FX.FormUtils.optionsWidgetConfig2ColorMap({
                        widgetName: t.widgetName,
                        type: "subform",
                        items: t.items
                    }),
                    this._createContent(),
                    this.containerCacheArray = []
            },
            _initSwitchBtn: function(t, s) {
                var r = this
                    , e = this.options;
                this.dataIndex = e.dataIndex;
                var i = _('<div class="switch-pane"><div class="switch-btn prev"><i class="icon-angleleft"/></div><div class="switch-num">' + (s + 1) + "/" + this.rowIdx + '</div><div class="switch-btn next"><i class="icon-angleright"/></div></div>').appendTo(t);
                s <= 0 && _(".prev", i).addClass("disabled"),
                s >= this.rowIdx - 1 && _(".next", i).addClass("disabled"),
                    i.click(function(t) {
                        var e, i, a, n = _(t.target).closest(".switch-btn");
                        n.length && (e = n.hasClass("prev") ? s - 1 : s + 1,
                        n.hasClass("disabled") || (i = r.$container.children('.subform-row[row-idx="' + e + '"]'),
                            a = FX.Utils.createMask(_(".edit-content"), {
                                hasLoader: !0,
                                isLight: !0
                            }),
                            setTimeout(function() {
                                a.remove(),
                                    r._createRowEditor(i, e)
                            }, 200)))
                    })
            },
            _createContent: function() {
                var t = this.options
                    , e = this;
                if (!t.items.length)
                    return this.$content = _('<div class="subform-none-tip"/>').text(t.noFieldText).appendTo(this.element),
                        void (t.tipWidth && this.$content.css("width", t.tipWidth));
                this._createHead(),
                    this.$content = _('<div class="subform-content"/>').appendTo(this.element).css({
                        "max-height": t.rowHeight * t.itemShowCount + t.rowHeight / 2 + t.rowBottom,
                        "max-width": this.maxWidth
                    }),
                    this.$container = _("<div/>").appendTo(this.$content),
                    _('<div class="fix-col-head"><i class="head-icon icon-expand"/><i class="head-icon icon-contract"/></div>').appendTo(this.element).on("click", function() {
                        e.doFullScreen()
                    }),
                this._allowCreate() && !t.value && this._createLine(null, !0),
                    this.$btnPane = _('<div class="btn-pane"/>').appendTo(this.element),
                "edit" === t.mode && this._allowCreate() && this._createAddBtn(),
                    this._bindEvent()
            },
            doFullScreen: function() {
                this.fullScreen = !this.fullScreen,
                    this.element.toggleClass("full-screen", this.fullScreen),
                    this.doResize()
            },
            _createAddBtn: function() {
                var t = this.options
                    , e = this;
                this.addBtn = new FX.Button({
                    renderEl: _('<div class="btn-add"/>').appendTo(this.$btnPane),
                    style: "none",
                    iconCls: "icon-add",
                    text: t.newItemText,
                    enable: this._allowCreate(),
                    onClick: function() {
                        e._allowCreate() && t.needEvent && e._addRow()
                    }
                })
            },
            _createHead: function() {
                var s, r = this, o = this.options, t = _('<div class="subform-head"/>').appendTo(this.element), l = _('<div class="subform-row"><div class="row-head"/></div>').appendTo(t), c = 0;
                c += o.rowHeadWidth,
                    FX.Utils.forEach(o.items, function(t, e) {
                        var i = _('<div class="subform-cell"/>');
                        o.pc_sticky_column && o.pc_sticky_column.enable && t < o.pc_sticky_column.limit && (i.addClass("frozen-cell"),
                        !o.ignoreOptAuth && !1 === e.widget.visible || (s = i));
                        var a = 0;
                        switch (e.widget.type) {
                            case "linkquery":
                            case "linkdata":
                                var n = r._getLinkFieldConfig(e.widget)
                                    , a = n.width;
                                i.append(n.linkField).append(_('<span class="form-cell"/>').text(e.label)),
                                !1 === e.widget.allowBlank && i.append(_('<span class="label-notnull">*</span>'));
                                break;
                            default:
                                i.append(_('<span class="form-cell"/>').text(e.label)),
                                !1 === e.widget.allowBlank && i.append(_('<span class="label-notnull">*</span>')),
                                    a += r.getWidgetWidth(e.widget) + o.itemPadding
                        }
                        i.css({
                            left: c,
                            width: a
                        }).appendTo(l),
                            o.ignoreOptAuth || !1 !== e.widget.visible ? c += a : i.addClass("x-ui-hidden")
                    }),
                s && s.addClass("has-border"),
                    this.maxWidth = c + 2,
                    this.$head = t.css("max-width", this.maxWidth)
            },
            _createLine: function(d, u) {
                var h = this.options
                    , p = this;
                if (0 !== h.items.length) {
                    var f = _('<div class="subform-row"/>').appendTo(this.$container).data({
                        editable: u,
                        "row-idx": this.rowIdx
                    }).attr("row-idx", this.rowIdx);
                    this.rowIdx++;
                    var m, g = 0;
                    return g += h.rowHeadWidth,
                        FX.Utils.forEach(h.items, function(t, e) {
                            var i = p.getWidgetWidth(e.widget)
                                , a = _.extend(!0, {}, e.widget);
                            switch (h.ignoreOptAuth ? (a.enable = !0,
                                a.visible = !0) : p._allowEdit() || u || (a.enable = !1),
                                a.type) {
                                case "location":
                                    _.extend(a, {
                                        locationText: i18next.t("subform.mobileLocation"),
                                        hasBrief: !1,
                                        btnWidth: "100%",
                                        btnHeight: 36,
                                        isValueVisible: !1
                                    });
                                    break;
                                case "linkdata":
                                case "linkquery":
                                    i = p._getLinkFieldWidth(a)
                            }
                            var n = i + h.itemPadding
                                , s = "subform-cell";
                            !1 === a.visible && (s += " x-ui-hidden");
                            var r = _('<div class="' + s + '"/>').css({
                                width: n
                            }).attr("namecol", a.widgetName).appendTo(f);
                            h.pc_sticky_column && h.pc_sticky_column.enable && t < h.pc_sticky_column.limit && (r.addClass("frozen-cell"),
                            p.scrollLeft && r.css(FX.Utils.formatTransform("translate3d(" + p.scrollLeft + "px, 0, 0)")),
                            !1 !== a.visible && (m = r)),
                            !1 !== a.visible && (g += n);
                            var o, l, c = new FX.SubformItem({
                                renderEl: _("<div/>").appendTo(r),
                                API: h.API,
                                label: e.label,
                                subform: h.widgetName,
                                colorMap: p.colorMap,
                                subformLabel: h.label,
                                widget: _.extend(FX.FormUtils.getWidgetDefaultConfig(a.type), a, {
                                    width: i
                                }),
                                onBeforeWidgetCreate: function(t) {
                                    FX.Utils.applyFunc(this, h.onBeforeWidgetCreate, [t, d], !1)
                                },
                                onKeyPress: function(t) {
                                    var e, i;
                                    t.keyCode === FX.CONST.KEY_CODE.ENTER && ((e = f.data("row-idx")) + 1 >= p.rowIdx && p._allowCreate() && p.rowIdx < h.maxItemCount ? p._addRow() : t.target.blur(),
                                    (i = p.getWidgetByName(a.widgetName, e + 1)) && setTimeout(function() {
                                        i.select()
                                    }, 100))
                                }
                            });
                            FX.Utils.applyFunc(p, h.onAfterWidgetCreate, [c], !1),
                            d && (o = c.getWidgetName(),
                            d.hasOwnProperty(o) && (l = d[o],
                                !FX.Utils.isNull(l) && l.hasOwnProperty("widgetType") ? c.setValue(l.data) : c.setValue(l))),
                                r.data("widget", c)
                        }),
                    m && m.addClass("has-border"),
                        this._createRowHead(this.rowIdx, u, f),
                        f.css({
                            width: g
                        }).hover(function() {
                            var t = _(this).data("row-idx");
                            _('.row-head[row-idx="' + t + '"]', p.$container).addClass("edit")
                        }, function() {
                            var t = _(this).data("row-idx");
                            _('.row-head[row-idx="' + t + '"]', p.$container).removeClass("edit")
                        }),
                        f
                }
            },
            _createRowHead: function(t, e, i) {
                _('<div class="row-head"><div class="row-num">' + t + '</div><i class="head-icon icon-expand" role="edit"/><i class="head-icon icon-trasho ' + (this._hasDeleteRow(e) ? "" : "unavailable") + '" role="delete"/></div>').appendTo(i).attr("row-idx", t - 1).css(FX.Utils.formatTransform("translate3d(" + this.$content[0].scrollLeft + "px, 0, 0)"))
            },
            _getLinkFieldConfig: function(a) {
                var t = this.options
                    , n = this
                    , s = ""
                    , r = 0;
                return FX.Utils.forEach(a.linkFields, function(t, e) {
                    var i = n.getWidgetWidth(e);
                    s += '<div class="sub-link-title sub-' + a.type + '" style="width:' + i + 'px;">' + FX.Utils.escapeHtmlSpecialChar(e.text) + (!1 === a.allowBlank ? '<span class="label-notnull">*</span>' : "") + "</div>",
                        r += i + 4
                }),
                    r += t.itemPadding - 4,
                "linkdata" === a.type && (r += 35),
                    r = Math.max(r, n.getWidgetWidth({
                        type: a.type
                    }) + t.itemPadding),
                    {
                        linkField: s,
                        width: r
                    }
            },
            _getLinkFieldWidth: function(t) {
                var a = this
                    , n = -4;
                return FX.Utils.forEach(t.linkFields, function(t, e) {
                    var i = a.getWidgetWidth(e);
                    n += i + 4
                }),
                "linkdata" === t.type && (n += 35),
                    Math.max(n, a.getWidgetWidth({
                        type: t.type
                    }))
            },
            _checkItemLimit: function() {
                var t = this.options;
                t.maxItemCount && this.addBtn && (this.rowIdx > t.maxItemCount && FX.Msg.toast({
                    type: "warning",
                    msg: i18next.t("subform.maxCountTip")
                }),
                    this.addBtn.setEnable(this._allowCreate() && this.rowIdx < t.maxItemCount)),
                    this.doResize()
            },
            setEnable: function(t) {
                var e;
                this.options.enable = !!t,
                !this.$container || 0 < (e = this.$container.find(".row-head > icon-remove")).length && (this._allowDelete() ? e.removeClass("unavailable") : e.addClass("unavailable")),
                this.addBtn && this.addBtn.setEnable(this._allowCreate())
            },
            _allowCreate: function() {
                var t = this.options;
                return t.ignoreOptAuth || t.enable && t.subform_create
            },
            _allowEdit: function() {
                var t = this.options;
                return t.ignoreOptAuth || t.enable && t.subform_edit
            },
            _allowSort: function() {
                var t = this.options;
                return t.ignoreOptAuth || t.enable && t.subform_edit && t.subform_sort
            },
            _allowDelete: function() {
                var t = this.options;
                return t.ignoreOptAuth || t.enable && t.subform_delete
            },
            _fireRowChange: function(t) {
                var e = this.options
                    , a = [];
                t && t.find(".subform-cell").each(function(t, e) {
                    var i = _(e).data("widget");
                    i && FX.Utils.allowValueSubmit(i.getWidgetType()) && a.push(i)
                }),
                    FX.Utils.applyFunc(this, e.onRowChange, [a, this.rowIdx - 1], !1)
            },
            getOptions: function() {
                var t, a, e, i = this.options, n = this;
                return !this.$container || 0 < (t = this.$container.children(".subform-row").eq(0)).length && (a = [],
                    e = t.children(".subform-cell"),
                    FX.Utils.forEach(e, function(t, e) {
                        var i = _(e).data("widget");
                        i && a.push({
                            label: n.$head.find(".subform-cell").eq(t).children(".form-cell").text(),
                            widget: i.getOptions()
                        })
                    }),
                    i.items = a),
                    _.extend(FX.SubForm.superclass.getOptions.apply(this, arguments), {
                        items: i.items,
                        subform_create: i.subform_create,
                        subform_edit: i.subform_edit,
                        subform_delete: i.subform_delete
                    })
            },
            getWidgetByName: function(t, e) {
                var a = [];
                return this.$container && FX.Utils.forEach(this.$container.find('.subform-cell[namecol="' + t + '"]'), function(t, e) {
                    var i = _(e).data("widget");
                    i && a.push(i)
                }),
                    FX.Utils.isNull(e) ? a : a[e]
            },
            getWidgetWidth: function(t) {
                return FX.Utils.getSubformWidgetWidth(t)
            },
            getEditWidgetSize: function(t) {
                var e = {
                    width: 420,
                    height: null
                };
                switch (t.type) {
                    case "textarea":
                        e.height = 140;
                        break;
                    case "address":
                        e.width4province = 200,
                            e.width4city = 105,
                            e.width4district = 105;
                        break;
                    case "text":
                    case "number":
                    case "combo":
                    case "combocheck":
                    case "datetime":
                        e.height = 30
                }
                return e
            },
            getValue: function() {
                var i = [];
                return this.$container && this.$container.find(".subform-row").each(function(t, e) {
                    var n = {}
                        , s = !0;
                    _(e).find(".subform-cell").each(function(t, e) {
                        var i, a = _(e).data("widget");
                        a && FX.Utils.allowValueSubmit(a.getWidgetType()) && (i = a.getValue(),
                            s = FX.Utils.isObjectEmpty(i) && s,
                            n[a.getWidgetName()] = {
                                data: i,
                                widgetType: a.getWidgetType()
                            })
                    }),
                    s || i.push(n)
                }),
                    i
            },
            _getLineWidget: function(t) {
                var a = {};
                return t.find(".subform-cell").each(function(t, e) {
                    var i = _(e).data("widget");
                    i && (a[i.getWidgetName()] = i)
                }),
                    a
            },
            _rebuildRowHead: function() {
                FX.Utils.forEach(this.$container.children(".subform-row"), function(t, e) {
                    _(e).data({
                        "row-idx": t
                    }).attr("row-idx", t),
                        _(".row-num", _(e)).text(t + 1),
                        _(".row-head", _(e)).attr("row-idx", t)
                })
            },
            _clearContent: function() {
                this.$container && this.$container.find(".subform-row").remove(),
                    this.rowIdx = 0
            },
            _bindEvent: function() {
                var n = this;
                this.options.needEvent ? (this.element.on("mouseenter", function() {
                    n.ps ? n.ps.update() : n.ps = new PerfectScrollbar(n.$content[0])
                }),
                    this.$content[0].addEventListener("ps-scroll-x", function() {
                        var i = _(this).scrollLeft();
                        n.scrollLeft = i,
                            n.$head.children(".subform-row").css(FX.Utils.formatTransform("translate3d(" + -i + "px, 0, 0)")),
                            _(".row-head", n.$container).css(FX.Utils.formatTransform("translate3d(" + i + "px, 0, 0)")),
                            _(".frozen-cell", n.element).each(function(t, e) {
                                _(e).css(FX.Utils.formatTransform("translate3d(" + i + "px, 0, 0)"))
                            })
                    }),
                    this.$container.on("mouseenter", ".row-head", function(t) {
                        _(t.currentTarget).addClass("edit");
                        var e = _(t.currentTarget).attr("row-idx");
                        n.$container.children('.subform-row[row-idx="' + e + '"]').addClass("edit")
                    }).on("mouseleave", ".row-head", function(t) {
                        _(t.currentTarget).removeClass("edit");
                        var e = _(t.currentTarget).attr("row-idx");
                        n.$container.children('.subform-row[row-idx="' + e + '"]').removeClass("edit")
                    }).on("click", ".row-head", function(t) {
                        var e = _(t.currentTarget).attr("row-idx")
                            , i = n.$container.children('.subform-row[row-idx="' + e + '"]')
                            , a = _(t.target).closest(".head-icon");
                        n._dealBtnAction(i, a, e)
                    })) : this.element.addClass("no-event")
            },
            _dealBtnAction: function(t, e, i) {
                var a = t.data("editable");
                switch (e.attr("role")) {
                    case "delete":
                        if (!this._hasDeleteRow(a))
                            break;
                        this._deleteRowConfirm(t, e);
                        break;
                    case "edit":
                        FX.Utils.dt(FX.CONST.TRACKER.SUBFORM_EXPAND),
                            this._createRowEditor(t, i);
                        break;
                    case "copy":
                        this._hasCopyRow(a) && (t.removeClass("edit"),
                            this._copyRow(t))
                }
            },
            _deleteRowConfirm: function(t, e) {
                var i, a = this;
                this._isRowEmpty(t) ? this._deleteRow(t) : (t.addClass("select"),
                    i = _(".edit", a.$container).addClass("select"),
                    FX.Msg.bubble({
                        anchor: e,
                        contentHTML: _('<div style="max-width:210px"/>').text(i18next.t("subform.dataExistTip")),
                        type: "error",
                        text4Ok: i18next.t("delete"),
                        onOk: function() {
                            a._deleteRow(t)
                        },
                        onClose: function() {
                            return t.removeClass("select"),
                                i.removeClass("select"),
                                !1
                        }
                    }))
            },
            _hasSortRow: function(t) {
                return this._allowSort() || t
            },
            _hasCopyRow: function(t) {
                return this._allowCreate() && (this._allowEdit() || t)
            },
            _hasDeleteRow: function(t) {
                return this._allowDelete() || t
            },
            _isRowEmpty: function(t) {
                var a = !0;
                return FX.Utils.forEach(_(".subform-cell", t), function(t, e) {
                    var i = _(e).data("widget");
                    if (i && i.isVisible())
                        return FX.Utils.isObjectEmpty(i.getValue()) ? void 0 : a = !1
                }),
                    a
            },
            _addRow: function() {
                var t = this.options;
                this._createLine(null, !0),
                    this._checkItemLimit(),
                    this.$content[0].scrollTop = this.$content[0].scrollHeight,
                    FX.Utils.applyFunc(this, t.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, t.onStateChange, [], !1)
            },
            _deleteRow: function(t) {
                var e = this.options;
                t.remove(),
                    this.rowIdx--,
                    this._checkItemLimit(),
                    this._rebuildRowHead(),
                    FX.Utils.applyFunc(this, e.onStopEdit, [], !1),
                    FX.Utils.applyFunc(this, e.onStateChange, [], !1)
            },
            _copyRow: function(t) {
                var e = this._getLineWidget(t)
                    , a = {};
                FX.Utils.forEach(e, function(t, e) {
                    var i = e.getOptions();
                    i.visible && i.enable && (a[t] = e.getCacheValue())
                });
                var i = this._createLine(a, !0);
                this._checkItemLimit(),
                    this._rebuildRowHead(),
                    this.$content[0].scrollTop = this.$content[0].scrollHeight,
                    this._fireRowChange(i)
            },
            _createRowEditor: function(t, e) {
                var i, l = this, c = this.options, a = l.containerCacheArray;
                0 === a.length ? (i = (i = this.fullScreen ? FX.Utils.applyFunc(this, c.onBeforeRowEdit, [_("body")], !1) : FX.Utils.applyFunc(this, c.onBeforeRowEdit, [], !1)) || _('<div class="editor-container"/>').appendTo(_("body")),
                    a.push(i)) : i = a[0];
                var n = t.data("row-idx")
                    , d = {};
                t.find(".subform-cell").each(function(t, e) {
                    var i = _(e).data("widget");
                    i && (d[i.getWidgetName()] = i)
                });
                var s, r, o = null;
                0 === i.children(".subform-row-editor").length ? (o = _('<div class="subform-row-editor">').appendTo(i),
                this.fullScreen && o.css({
                    "z-index": FX.STATIC.zIndex++
                })) : o = i.children(".subform-row-editor"),
                    0 === o.children(".edit-content").length ? (s = _('<div class="edit-content"></div>')).appendTo(o) : s = o.children(".edit-content"),
                    s.empty(),
                    r = _('<div class="row-title"><span class="label">' + c.label + "</span></div>"),
                    _('<i class="close-btn icon-contract"/>').appendTo(r),
                    r.appendTo(s),
                    this._initSwitchBtn(r, Number(e)),
                    s.on("click", ".close-btn", function() {
                        FX.Utils.forEach(d, function(t, e) {
                            e.unbindWidgetEvent("onRelyDone")
                        }),
                            o.addClass("close"),
                            setTimeout(function() {
                                i.remove(),
                                    a.length = 0
                            }, 300)
                    });
                var u = _('<div class="subform-row"/>').appendTo(s).data("row-idx", n);
                FX.Utils.forEach(c.items, function(t, e) {
                    var i, a, n, s, r, o = d[e.widget.widgetName];
                    o && (i = _('<div class="subform-cell"/>').appendTo(u),
                        a = o.getOptions(),
                        n = o.getCacheValue(),
                        "linkdata" === (s = _.extend(!0, {}, e.widget, {
                            subform: null,
                            enable: a.enable,
                            visible: a.visible,
                            limit: a.limit,
                            onStopEdit: function() {
                                o.setCacheValue(this.getCacheValue()),
                                    o.effectStopEdit()
                            },
                            onBeforeAsync: function() {
                                return o.effectBeforeAsync()
                            },
                            onBeforeLinkData: function(t) {
                                FX.Utils.applyFunc(r.field, o.field.options.onBeforeLinkData, [t], !1)
                            },
                            onGetAjaxData: function() {
                                return FX.Utils.applyFunc(l, c.onGetAjaxData, [], {})
                            }
                        }, l.getEditWidgetSize(e.widget))).type ? s.linkEnable = o.field.options.linkEnable : "linkquery" === s.type && (s.linkFields = o.field.getLinkFields()),
                    "upload" !== s.type && "image" !== s.type || (o.field.options.deleteOnly && (s.deleteOnly = !0),
                            s.onBeforeUpload = function() {
                                o.setUploadingStatus(!0)
                            }
                            ,
                            s.onAfterUpload = function() {
                                o.setUploadingStatus(!1)
                            }
                    ),
                    -1 < FX.LimitFields.userDept.indexOf(s.type) && (s.onBeforeEdit = function(t) {
                            !1 === FX.Utils.applyFunc(o.field, o.field.options.onBeforeEdit, [function() {
                                r.setOptions({
                                    limit: o.getOptions().limit
                                }),
                                t && t()
                            }
                            ], !1) && (r.setOptions({
                                limit: o.getOptions().limit
                            }),
                            t && t())
                        }
                    ),
                        (r = new FX.FormItem({
                            renderEl: i,
                            API: c.API,
                            label: e.label,
                            widget: s,
                            colorMap: l._getRowEditorColorMap()
                        })).setCacheValue(n),
                        o.bindWidgetEvent("onRelyDone", function(t) {
                            switch (t.getWidgetType()) {
                                case "combo":
                                case "combocheck":
                                    r.rebuild();
                                    break;
                                case "dept":
                                case "deptgroup":
                                    r.getValueOption() === FX.WidgetValueOption.CUSTOM ? r.clearLimit() : r.setCacheValue(t.getCacheValue());
                                    break;
                                default:
                                    r.setCacheValue(t.getCacheValue())
                            }
                        }),
                        i.attr("namecol", o.getWidgetName()),
                        i.data("widget", o))
                })
            },
            _getRowEditorColorMap: function() {
                if (!this.colorMap)
                    return null;
                var s = this
                    , r = {};
                return FX.Utils.forEach(this.colorMap, function(t, e) {
                    var i, a, n;
                    /\./.test(t) && (a = (i = t.split("."))[0],
                        n = i[1],
                    a === s.getWidgetName() && (r[n] = e))
                }),
                    r
            },
            getCacheValue: function() {
                var i = [];
                return this.$container && this.$container.find(".subform-row").each(function(t, e) {
                    var n = {}
                        , s = !0;
                    _(e).find(".subform-cell").each(function(t, e) {
                        var i, a = _(e).data("widget");
                        -1 < FX.LimitFields.noCache.indexOf(a.getWidgetType()) || (i = a.getCacheValue(),
                            s = FX.Utils.isObjectEmpty(i) && s,
                            n[a.getWidgetName()] = {
                                data: i,
                                widgetType: a.getWidgetType()
                            })
                    }),
                        n.editable = _(e).data("editable"),
                    s || i.push(n)
                }),
                    i
            },
            setCacheValue: function(t) {
                var i = this;
                this._clearContent(),
                    FX.Utils.forEach(t, function(t, e) {
                        i._createLine(e, e.editable)
                    }),
                    this._checkItemLimit()
            },
            getText: function() {
                var i = [];
                return this.$container && this.$container.find(".subform-row").each(function(t, e) {
                    var n = {}
                        , s = !0;
                    _(e).find(".subform-cell").each(function(t, e) {
                        var i = _(e).data("widget")
                            , a = i.getText();
                        s = FX.Utils.isObjectEmpty(a) && s,
                            "linkdata" === i.getWidgetType() ? _.extend(n, a) : n[i.getWidgetName()] = a
                    }),
                    s || i.push(n)
                }),
                    i
            },
            setValue: function(t) {
                var i = this;
                this._clearContent(),
                    FX.Utils.forEach(t, function(t, e) {
                        i._createLine(e)
                    }),
                    this._checkItemLimit()
            },
            setColorMap: function(t) {
                this.colorMap = t
            },
            checkValidate: function() {
                var d = this
                    , t = this.options
                    , i = []
                    , a = !0
                    , u = !1;
                return this.$container && this.$container.find(".subform-row").each(function(t, e) {
                    var r = {}
                        , o = !0
                        , l = !0
                        , c = [];
                    _(e).find(".subform-cell").each(function(t, e) {
                        var i, a, n, s = _(e).data("widget");
                        s && s.isVisible() && (i = s.checkValidate(),
                        (a = s.getInvalidateType()) === FX.CONST.INVALID_TYPE.FILE_UPLOADING && (u = !0),
                            i || u ? d.clearCellErrorState(_(e)) : (d.setInvalidateType(a),
                                d.setCellErrorState(_(e)),
                                c.push(_(e))),
                            l = i && l,
                            n = s.getValue(),
                            o = FX.Utils.isObjectEmpty(n) && o,
                            r[s.getWidgetName()] = {
                                data: n,
                                widgetType: s.getWidgetType()
                            })
                    }),
                        o ? (l = !0,
                            FX.Utils.forEach(c, function(t, e) {
                                d.clearCellErrorState(e)
                            })) : i.push(r),
                        a = l && a
                }),
                    !t.allowBlank && i.length <= 0 ? (this.setInvalidateType(FX.CONST.INVALID_TYPE.BLANK),
                        !1) : (a || this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX),
                    u && this.setInvalidateType(FX.CONST.INVALID_TYPE.FILE_UPLOADING),
                        a)
            },
            scrollInvalidWidgetToView: function() {
                var t, e, i = this.options, a = _(".subform-cell.x-ui-invalid", this.$content).eq(0), n = FX.Utils.getDomOffset(a, this.$content);
                n && (t = n.top,
                    e = n.left - i.rowHeadWidth - i.rowBorder,
                    this.$content[0].scrollTop += t,
                    this.$content[0].scrollLeft += e)
            },
            getNullValue: function() {
                return []
            },
            setCellErrorState: function(t) {
                t && t.addClass("x-ui-invalid")
            },
            clearCellErrorState: function(t) {
                t && t.removeClass("x-ui-invalid")
            },
            setErrorState: function(e) {
                var n = this;
                this.$content && this.$content.find(".subform-cell").each(function(t, i) {
                    var a = _(i).data("widget");
                    a && a.isVisible() && FX.Utils.forEach(e, function(t, e) {
                        a.getWidgetName() === t && e && -1 < e.indexOf(a.getValue()) && n.setCellErrorState(_(i))
                    })
                })
            },
            getFirstNoRepeatRemind: function(t) {
                var e = null
                    , i = Object.keys(t)[0]
                    , a = this.getWidgetByName(i);
                return a && (e = a[0].getRepeatRemind()),
                    e = e || i18next.t("field.noRepeat.exist")
            },
            clearErrorState: function() {
                var a = this;
                this.$content && this.$content.find(".subform-cell").each(function(t, e) {
                    var i = _(e).data("widget");
                    i && i.isVisible() && a.clearCellErrorState(_(e))
                })
            },
            doResize: function() {
                this.ps && this.ps.update(),
                this.$btnPane && (0 < this.rowIdx ? this.$btnPane.removeClass("no-border") : this.$btnPane.addClass("no-border"),
                    this.$btnPane.css({
                        "max-width": this.maxWidth
                    }))
            },
            rebuild: function(t) {
                _.extend(this.options, t),
                    FX.SubForm.superclass.rebuild.apply(this, arguments)
            }
        }),
            _.shortcut("subform", FX.SubForm)
    }(jQuery),
    function(e) {
        FX.Separator = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return e.extend(FX.Separator.superclass._defaultConfig.apply(), {
                    baseCls: "fui_separator",
                    allowBlank: !0,
                    lineStyle: FX.CONST.SEP_LINE_STYLE.THIN
                })
            },
            _init: function() {
                FX.Separator.superclass._init.apply(this, arguments);
                var t = this.options;
                e('<div class="sep-line ' + t.lineStyle + '"/>').appendTo(this.element),
                    this.$description = e('<div class="x-subhtml"/>').appendTo(this.element)
            },
            setValue: function(t) {
                FX.Separator.superclass.setValue.apply(this, arguments),
                    this.$description.empty(),
                FX.Utils.isEmpty(t) || this.$description.append(t)
            },
            getOptions: function() {
                var t = this.options;
                return e.extend(FX.Separator.superclass.getOptions.apply(this, arguments), {
                    lineStyle: t.lineStyle
                })
            }
        }),
            e.shortcut("separator", FX.Separator)
    }(jQuery),
    function(l) {
        FX.User = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return l.extend(FX.User.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_user",
                    API: FX.API,
                    title: i18next.t("widget.user.listTitle"),
                    msg: i18next.t("user.select"),
                    width: 240,
                    height: 40,
                    value: null,
                    allowBlank: !0,
                    noRepeat: !1,
                    editable: !1,
                    count: 100,
                    limit: {},
                    searchLimit: 50,
                    dynamicFields: [{
                        id: FX.USER_ID.CurrentUser,
                        name: i18next.t("widget.user.current"),
                        type: "dynamic"
                    }],
                    dynamicKey: FX.USER_ID.CurrentUser,
                    dynamicType: "select",
                    hasCount: !1,
                    onStopEdit: null,
                    onStateChange: null,
                    onBeforeEdit: null,
                    waterMark: i18next.t("content.empty")
                })
            },
            _init: function() {
                FX.User.superclass._init.apply(this, arguments);
                var t = this.options;
                t.limit = t.limit || {},
                    this.selectMap = {},
                    this._initSelectPane(),
                    this.element.attr("data-watermark", t.waterMark)
            },
            _initData: function() {
                var t = this.options;
                t.items && (this.items = t.items),
                    this._initSelectPane()
            },
            _initSelectPane: function() {
                if (FX.Utils.isExternalLink())
                    return this.element.empty(),
                        void l('<div class="nonsupport-msg"/>').text(i18next.t("widget.user.notSupportLink")).appendTo(this.element);
                var i = this
                    , t = this.options;
                this.selectMap = {},
                    FX.Utils.forEach(this.items, function(t, e) {
                        i.selectMap[e.id] = e
                    }),
                    this.isEnabled() ? (this._createSelectList(),
                        t.editable ? this._createSelectPane() : this._bindEditEvent()) : this.element.addClass("fui_form_item_disable")
            },
            _bindEditEvent: function() {
                var i = this
                    , a = this.options;
                this.$selectList.unbind("click"),
                    this.$selectList.bind("click", function() {
                        var e;
                        i.isEnabled() && (FX.Utils.applyFunc(i, a.onBeforeEdit, [], !1),
                            (e = new FX.ConfirmDialog({
                                title: a.title,
                                width: 610,
                                contentWidget: {
                                    rowSize: [440],
                                    colSize: [570],
                                    items: [[{
                                        API: a.API,
                                        widgetName: a.widgetName,
                                        type: a.type,
                                        editable: !0,
                                        limit: a.limit,
                                        limitWidget: a.limitWidget,
                                        items: i.items,
                                        value: i.value,
                                        onGetAjaxData: a.onGetAjaxData
                                    }]]
                                },
                                onOk: function() {
                                    var t = e.getWidgetByName(a.widgetName);
                                    return i.value = t.getValue(),
                                        i.items = t.getItems(),
                                        i._initSelectPane(),
                                        FX.Utils.applyFunc(i, a.onStopEdit, [], !1),
                                        FX.Utils.applyFunc(i, a.onStateChange, [], !1),
                                        !1
                                },
                                onClose: function() {
                                    FX.Utils.applyFunc(i, a.onClose, [], !1)
                                }
                            })).show())
                    })
            },
            _createSelectList: function() {
                var t, e = this.options;
                this.$selectList ? this.$selectList.empty() : this.$selectList = l('<ul class="select-list"/>').appendTo(this.element),
                    this.value ? (t = this.selectMap[this.value],
                        this._createSelectItem(t)) : e.editable || this.$selectList.append(l('<div class="select-empty"/>').text(e.msg))
            },
            _setSelectItem: function(t) {
                this.$selectList.empty(),
                    this._createSelectItem(t),
                    this.value = t.id,
                    this.selectMap[t.id] = t,
                    this.refresh()
            },
            _clearSelectItem: function() {
                this.$selectList.empty(),
                    this.value = null,
                    this.refresh()
            },
            _createSelectItem: function(t) {
                var e, i = this.options, a = this;
                t && (e = l('<li class="select-item"/>').append(l("<span/>").text(t.name)).appendTo(this.$selectList).attr("id", t.id).data("item", t),
                    t.id === FX.USER_ID.CurrentUser ? e.prepend(l('<i class="select-icon icon-role-solid"/>')) : new FX.Avatar({
                        renderEl: l('<div class="user-avatar"/>').prependTo(e),
                        name: t.name,
                        avatar: t.avatar,
                        size: "small"
                    }),
                i.editable && l('<span class="remove-btn"/>').append(l('<i class="icon-close-normal"/>')).click(function() {
                    a._clearSelectItem()
                }).appendTo(e))
            },
            _createSelectPane: function() {
                var t, i, e, a;
                this.$selectPane || (t = this.options,
                    i = this,
                    e = l('<div class="select-menu"/>').on("click", ".select-btn", function(t) {
                        var e = l(t.currentTarget);
                        i._switchTab(e.attr("role"))
                    }).appendTo(this.element),
                    this.$selectPane = l('<div class="select-pane"/>').appendTo(this.element),
                this._hasType("organization") && l('<div class="select-btn"/>').attr("role", "organization").text(i18next.t("organization")).appendTo(e),
                this._hasType("role") && l('<div class="select-btn"/>').attr("role", "role").text(i18next.t("role")).appendTo(e),
                this._hasType("member") && l('<div class="select-btn"/>').attr("role", "member").text(i18next.t("member")).appendTo(e),
                this._hasType("dynamic") && ("set" === t.dynamicType ? l('<div class="select-btn"/>').attr("role", "dynamic").text(i18next.t("dynamicParameter")).appendTo(e) : l('<div class="select-btn"/>').attr("role", "curUser").text(i18next.t("widget.user.current")).appendTo(e)),
                    a = l('<div class="select-search-pane"/>').appendTo(e),
                    new FX.SearchInput({
                        renderEl: a,
                        size: "small",
                        placeholder: i18next.t("search"),
                        showSearchResult: !1,
                        onFocus: function() {
                            a.addClass("full-line")
                        },
                        onBlur: function(t) {
                            l(t.target).val().trim() || (a.removeClass("full-line"),
                                this.clearSearch(),
                                i._switchOriginTab())
                        },
                        onSearch: function(t) {
                            l(".select-search .search-list", i.$selectPane).remove(),
                                i._createSearchList(t, 0)
                        },
                        onClose: function() {
                            a.removeClass("full-line"),
                                i._switchOriginTab()
                        }
                    }),
                    i._switchTab())
            },
            _switchTab: function(t) {
                if (t = t || this.types[0],
                    l('.select-menu [role="' + t + '"]', this.element).addClass("select").siblings().removeClass("select"),
                    this._isRelyLimitEmpty()) {
                    var e = l(".tip-empty", this.$selectPane);
                    e.length ? e.show() : l('<span class="tip-empty"/>').text(i18next.t("user.empty")).appendTo(this.$selectPane)
                } else
                    switch (t) {
                        case "organization":
                            this._createOrganizationPane();
                            break;
                        case "role":
                            this._createRolePane();
                            break;
                        case "member":
                            this._createMemberPane();
                            break;
                        case "dynamic":
                            this._createDynamicPane();
                            break;
                        case "curUser":
                            this._createCurrentUserPane()
                    }
            },
            _switchOriginTab: function() {
                var t = l(".select-menu .select-btn.select");
                this._switchTab(t.attr("role"))
            },
            _isRelyLimitEmpty: function() {
                var t = this.options;
                return FX.Utils.isObjectEmpty(t.limit) && !FX.Utils.isObjectEmpty(t.limitWidget)
            },
            _initLimitMap: function(t) {
                var e = this.options
                    , a = this
                    , n = {};
                FX.Utils.forEach(t, function(t, e) {
                    n[e._id] = e
                }),
                    this.limitMap = {},
                    FX.Utils.forEach(e.limit, function(t, e) {
                        var i = n[e];
                        i && i.departmentId && (a.limitMap[i.departmentId] = !0)
                    })
            },
            _createOrganizationPane: function() {
                this.options;
                this.$selectPane.children().hide(),
                    this.$organizationPane ? this.$organizationPane.show() : this.$organizationPane = l('<div class="organization-pane"/>').appendTo(this.$selectPane),
                    this._createMemberMenu().appendTo(this.$organizationPane),
                    this._createOrganizationUserList()
            },
            _createOrganizationUserList: function(a) {
                a = a || 0;
                var n = this
                    , s = this.options
                    , t = l.extend(FX.Utils.applyFunc(this, s.onGetAjaxData, [], {}), {
                    departmentLimit: s.limit.departs,
                    departmentId: this.currentDepartment,
                    limit: s.count,
                    skip: a
                });
                s.hasCount && (t.hasCount = !0),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(s.API.data.user_dept_role),
                        data: t
                    }, function(t) {
                        var e, i;
                        0 === a ? (l(".user-wrapper", n.$organizationPane).remove(),
                            e = n._createUserWrapper(t.users, t.count).appendTo(n.$organizationPane),
                            i = l(".user-list", e)) : (i = l(".user-list", n.$organizationPane),
                            FX.Utils.forEach(t.users, function(t, e) {
                                n._createUserItem(e).appendTo(i)
                            }),
                            n._syncSelectAll(l(".user-wrapper", n.$organizationPane))),
                        t.users.length === s.count && n._createLoadMoreBtn(a + t.users.length, n._createOrganizationUserList).appendTo(i)
                    })
            },
            _createMemberMenu: function() {
                var a = this
                    , t = this.options;
                return this.$memberMenu ? this.$memberMenu.show() : (this.$memberMenu = l('<div class="member-menu"/>'),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.departments),
                        data: l.extend(FX.Utils.applyFunc(this, t.onGetAjaxData, [], {}), {
                            dept_id_list: t.limit.departs
                        })
                    }, function(t) {
                        var i = l('<div class="depart-root selected"/>').text(i18next.t("allMember")).on("click", function() {
                            a.currentDepartment = null,
                                a._createOrganizationUserList(),
                                i.addClass("selected");
                            var t = a.memberTree.options.setting;
                            a.memberTree.cancelPreSelectedNode(t)
                        }).appendTo(a.$memberMenu)
                            , e = l("<div/>").appendTo(a.$memberMenu);
                        a.memberTree = new FX.DepartmentsTree({
                            renderEl: e,
                            customCls: "x-department-tree select-department",
                            Nodes: t.departments,
                            setting: {
                                view: {
                                    expandSpeed: 100
                                },
                                data: {
                                    simpleData: {
                                        enable: !0,
                                        idKey: "departmentId",
                                        pIdKey: "parentId"
                                    }
                                },
                                callback: {
                                    onNodeCreated: function(t, e) {
                                        e.isParent && !e.open && e.level < 1 && this.expandNode(e, !0)
                                    },
                                    onClick: function(t, e) {
                                        a.currentDepartment = e.departmentId,
                                            a._createOrganizationUserList(),
                                            i.removeClass("selected")
                                    }
                                }
                            }
                        })
                    })),
                    this.$memberMenu
            },
            _createRolePane: function() {
                var e = this
                    , t = this.options;
                this.$selectPane.children().hide(),
                    this.$rolePane ? this.$rolePane.show() : (this.$rolePane = l('<div class="role-pane"/>').appendTo(this.$selectPane),
                        FX.Utils.dataAjax({
                            url: FX.Utils.getApi(t.API.data.roles),
                            data: l.extend(FX.Utils.applyFunc(this, t.onGetAjaxData, [], {}), {
                                role_id_list: t.limit.roles,
                                limit: t.limit.roles ? t.limit.roles.length : 0
                            })
                        }, function(t) {
                            FX.Utils.isObjectEmpty(t.roles) || (e.curRole = t.roles[0].role_id,
                                e._createRoleList(t.roles).appendTo(e.$rolePane),
                                e._createRoleUserList())
                        }))
            },
            _createRoleList: function(t) {
                var a = this
                    , n = (this.options,
                    l('<ul class="role-list"/>'));
                return FX.Utils.forEach(t, function(t, e) {
                    var i = l('<li class="role-item"/>').append(l("<span />").text(e.name)).data("role", e.role_id).appendTo(n);
                    e.role_id === a.curRole && i.addClass("select")
                }),
                    n.on("click", ".role-item", function(t) {
                        var e = l(t.currentTarget);
                        e.addClass("select").siblings().removeClass("select");
                        var i = e.data("role");
                        i !== a.curRole && (a.curRole = i,
                            a._createRoleUserList())
                    }),
                    n
            },
            _createRoleUserList: function(a) {
                a = a || 0;
                var n = this
                    , s = this.options
                    , t = l.extend(FX.Utils.applyFunc(this, s.onGetAjaxData, [], {}), {
                    roleId: this.curRole,
                    roleLimit: s.limit.roles,
                    limit: s.count,
                    skip: a
                });
                s.hasCount && (t.hasCount = !0),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(s.API.data.user_dept_role),
                        data: t
                    }, function(t) {
                        var e, i;
                        0 === a ? (l(".user-wrapper", n.$rolePane).remove(),
                            e = n._createUserWrapper(t.users, t.count).appendTo(n.$rolePane),
                            i = l(".user-list", e)) : (i = l(".user-list", n.$rolePane),
                            FX.Utils.forEach(t.users, function(t, e) {
                                n._createUserItem(e).appendTo(i)
                            }),
                            n._syncSelectAll(l(".user-wrapper", n.$rolePane))),
                        t.users.length === s.count && n._createLoadMoreBtn(a + t.users.length, n._createRoleUserList).appendTo(i)
                    })
            },
            _createMemberPane: function() {
                this.$selectPane.children().hide(),
                    this.$memberPane ? (this.$memberPane.show(),
                        this._syncSelectAll(l(".user-wrapper", this.$memberPane))) : (this.$memberPane = l('<div class="member-pane"/>').appendTo(this.$selectPane),
                        this._createMemberUserList())
            },
            _createMemberUserList: function(n) {
                n = n || 0;
                var s = this
                    , r = this.options
                    , t = l.extend(FX.Utils.applyFunc(this, r.onGetAjaxData, [], {}), {
                    dept_id_list: r.limit.departs,
                    role_id_list: r.limit.roles,
                    member_id_list: r.limit.users,
                    has_current: r.limit.hasCurrentUser,
                    limit: r.count,
                    skip: n
                });
                r.hasCount && (t.hasCount = !0),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(r.API.data.users),
                        data: t
                    }, function(t) {
                        var e, i, a = t.members;
                        0 === n ? (l(".user-wrapper", s.$memberPane).remove(),
                            e = s._createUserWrapper(a, t.count).appendTo(s.$memberPane),
                            i = l(".user-list", e)) : (i = l(".user-list", s.$memberPane),
                            FX.Utils.forEach(a, function(t, e) {
                                s._createUserItem(e).appendTo(i)
                            }),
                            s._syncSelectAll(l(".user-wrapper", s.$memberPane))),
                        a.length === r.count && s._createLoadMoreBtn(n + a.length, s._createMemberUserList).appendTo(i)
                    })
            },
            _createLoadMoreBtn: function(e, i) {
                var a = this;
                return l('<div class="load-more"/>').text(i18next.t("loadMore.click")).click(function(t) {
                    l(t.currentTarget).remove(),
                        FX.Utils.applyFunc(a, i, [e], !1)
                })
            },
            _syncSelectAll: function(t) {},
            _getSelectItem: function(t) {
                return {
                    id: t._id || t.id,
                    username: t.username,
                    name: t.nickname || t.name,
                    label: t.label || [],
                    avatar: t.avatar
                }
            },
            _getDynamicFields: function() {
                return this.options.dynamicFields
            },
            _createCurrentUserPane: function() {
                var t;
                this.$selectPane.children().hide(),
                    this.$currentUserPane ? this.$currentUserPane.show() : (this.$currentUserPane = l('<div class="current-pane"/>').appendTo(this.$selectPane),
                        t = [{
                            _id: FX.CorpUser.getMemberId(),
                            username: FX.CorpUser.getMemberUsername(),
                            nickname: FX.CorpUser.getMemberNickname(),
                            avatar: FX.CorpUser.getMemberAvatar()
                        }],
                        this._createUserWrapper(t).appendTo(this.$currentUserPane))
            },
            _createDynamicPane: function() {
                this.$selectPane.children().hide(),
                    this.$dynamicPane ? this.$dynamicPane.show() : (this.$dynamicPane = l('<div class="dynamic-pane"/>').appendTo(this.$selectPane),
                        this._createUserWrapper(this._getDynamicFields(), null, !0).appendTo(this.$dynamicPane))
            },
            _createSearchList: function(a, n) {
                var s, r = this.options, o = this;
                this._isRelyLimitEmpty() || (this.$selectPane.children().hide(),
                0 === l(".select-search", this.$selectPane).length && l('<div class="select-search"/>').appendTo(this.$selectPane),
                    this.$searchList = l(".select-search", this.$selectPane).show(),
                    s = this.$searchList,
                    l(".search-empty", s).remove(),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(r.API.data.users),
                        data: l.extend(FX.Utils.applyFunc(this, r.onGetAjaxData, [], {}), {
                            dept_id_list: r.limit.departs,
                            role_id_list: r.limit.roles,
                            member_id_list: r.limit.users,
                            hasCurrentUser: r.limit.hasCurrentUser,
                            keyword: a,
                            limit: r.searchLimit,
                            skip: n
                        })
                    }, function(t) {
                        var i, e = t.members || [];
                        0 === n && e.length <= 0 ? s.append(l('<span class="search-empty"/>').text(i18next.t("user.searchEmpty"))) : (i = l('<ul class="search-list"/>').appendTo(s),
                            FX.Utils.forEach(e, function(t, e) {
                                o._createUserItem(e, !0).appendTo(i)
                            }),
                        e.length >= r.searchLimit && l('<div class="load-more"/>').text(i18next.t("loadMore")).on("click", function() {
                            l(this).remove(),
                                o._createSearchList(a, n + r.searchLimit)
                        }).appendTo(i))
                    }),
                    this._bindSearchEvent())
            },
            _bindSearchEvent: function() {
                var n = this;
                this.$searchList.off("click.search"),
                    this.$searchList.on("click.search", function(t) {
                        var e = t.target
                            , i = l(e).closest("li")
                            , a = i.data("user");
                        0 < i.length && a && n._setSelectItem(a)
                    })
            },
            getItems: function() {
                var i = [];
                return l(".select-item", this.$selectList).each(function(t, e) {
                    i.push(l(e).data("item"))
                }),
                    i
            },
            setValue: function(t) {
                var e = this.options;
                t = FX.FormItemUtils.dealCurrentUser(t, e.dynamicType),
                    this.value = FX.FormItemUtils.parseUserDeptDefaultValue(t);
                var i = "";
                t && (i = t.nickname || t.name,
                    this.items = this._getDynamicFields().concat([{
                        id: t._id,
                        username: t.username,
                        name: i,
                        avatar: t.avatar
                    }])),
                this.isEnabled() || this.setText(i),
                    this._initData()
            },
            getValue: function() {
                return this.value
            },
            setText: function(t) {
                var e = this.options;
                this.element.empty(),
                e.subform && this.element.attr("title", t),
                    this.element.text(t)
            },
            getLinkValue: function() {
                return this.getValue()
            },
            getCacheValue: function() {
                if (FX.Utils.isExternalLink())
                    return this.getNullValue();
                var t = this.selectMap[this.value];
                return t ? {
                    _id: t.id,
                    username: t.username,
                    name: t.name,
                    avatar: t.avatar
                } : null
            },
            getText: function() {
                return this.value && this.selectMap[this.value] ? this.selectMap[this.value].name : ""
            },
            refresh: function() {
                var n = this;
                l(".user-item", this.$selectPane).each(function(t, e) {
                    var i, a = l(e).data("user");
                    a && (i = l(e).children(".select-btn"),
                        n.value === a.id ? i.addClass("select") : i.removeClass("select"))
                })
            },
            checkValidate: function() {
                if (FX.Utils.isExternalLink())
                    return this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX),
                        !1;
                var t = this.options;
                return !FX.Utils.isEmpty(this.getValue()) || t.allowBlank
            },
            rebuild: function(t) {
                this.setValue(t),
                    this.refresh()
            },
            getOptions: function(t) {
                var e = this.options;
                return l.extend(FX.User.superclass.getOptions.apply(this, arguments), {
                    noRepeat: e.noRepeat,
                    limit: e.limit,
                    limitWidget: e.limitWidget,
                    value: "save" === t ? FX.FormItemUtils.parseUserDeptDefaultValue(e.value) : e.value,
                    valueOption: e.valueOption
                })
            },
            _createUserWrapper: function(t, e, i) {
                var a = this
                    , n = l('<div class="user-wrapper"/>')
                    , s = l('<ul class="user-list"/>').appendTo(n);
                return t.length ? (FX.Utils.forEach(t, function(t, e) {
                    a._createUserItem(e, !1, i).appendTo(s)
                }),
                    s.on("click", ".user-item", function(t) {
                        var e = l(t.currentTarget)
                            , i = l(".select-btn", e);
                        i.hasClass("select") ? (i.removeClass("select"),
                            a._clearSelectItem()) : (l(".select", s).removeClass("select"),
                            i.addClass("select"),
                            a._setSelectItem(e.data("user")))
                    })) : l('<span class="tip-empty"/>').text(i18next.t("user.empty")).appendTo(s),
                    n
            },
            _createUserItem: function(t, e, i) {
                var a = this._getSelectItem(t)
                    , n = l('<li class="user-item"/>').append(l('<span class="item-name"/>').text(a.name)).append(l('<div class="select-btn x-radio"/>').append('<i class="icon-blank"/>')).data("user", a);
                return i || new FX.Avatar({
                    renderEl: l('<div class="item-avatar"/>').prependTo(n),
                    name: a.name,
                    avatar: a.avatar,
                    size: "small"
                }),
                e && FX.Utils.appendUserDeptLabel(n.find(".item-name"), a.name, a.label),
                this.value === a.id && n.children(".select-btn").addClass("select"),
                    n
            },
            _hasType: function(t) {
                var e = this.options;
                return this.types || (this.types = [],
                    FX.Utils.isObjectEmpty(e.limit) ? this.types = ["organization", "member", "dynamic"] : (FX.Utils.isObjectEmpty(e.limit.departs) || this.types.push("organization"),
                    FX.Utils.isObjectEmpty(e.limit.roles) || this.types.push("role"),
                        this.types.push("member"),
                    e.limit.hasCurrentUser && this.types.push("dynamic"))),
                -1 < this.types.indexOf(t)
            }
        }),
            l.shortcut("user", FX.User)
    }(jQuery),
    function(o) {
        FX.UserGroup = FX.extend(FX.User, {
            _defaultConfig: function() {
                return o.extend(FX.UserGroup.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_user fui_user_group ",
                    title: i18next.t("widget.user.listTitle"),
                    msg: i18next.t("user.select"),
                    width: 420,
                    height: 80,
                    value: [],
                    hasCount: !0,
                    onStopEdit: null
                })
            },
            _init: function() {
                this.value = [],
                    FX.UserGroup.superclass._init.apply(this, arguments)
            },
            _initData: function() {
                var t = this.options;
                this.selectMap = {},
                t.items && (this.items = t.items),
                    this._initSelectPane()
            },
            _createSelectList: function() {
                var a = this
                    , t = this.options;
                this.$selectList ? this.$selectList.empty() : this.$selectList = o('<ul class="select-list"/>').appendTo(this.element),
                    this.value && 0 < this.value.length ? FX.Utils.forEach(this.value, function(t, e) {
                        var i = a.selectMap[e];
                        a._createSelectItem(i)
                    }) : t.editable || this.$selectList.append(o('<div class="select-empty"/>').text(t.msg))
            },
            _addSelectItem: function(t) {
                this.options;
                -1 < this.value.indexOf(t.id) || (this._createSelectItem(t),
                    this.value = this.getValue(),
                    this.selectMap[t.id] = t,
                    this.refresh())
            },
            _setSelectItem: function(t) {
                this._addSelectItem(t)
            },
            _removeSelectItem: function(t) {
                this.options;
                o("#" + t.id, this.$selectList).remove(),
                    this.value = this.getValue(),
                    this.refresh()
            },
            _createSelectItem: function(t) {
                var e, i = this.options, a = this;
                t && (e = o('<li class="select-item"/>').append(o("<span/>").text(t.name)).appendTo(this.$selectList).attr("id", t.id).data("item", t),
                    t.id === FX.USER_ID.CurrentUser ? e.prepend(o('<i class="select-icon icon-role-solid"/>')) : new FX.Avatar({
                        renderEl: o('<div class="user-avatar"/>').prependTo(e),
                        name: t.name,
                        avatar: t.avatar,
                        size: "small"
                    }),
                i.editable && o('<span class="remove-btn"/>').append(o('<i class="icon-close-normal"/>')).click(function() {
                    a._removeSelectItem(t),
                        a.refresh()
                }).appendTo(e))
            },
            _createSelectAll: function(t, i) {
                var a = this;
                i.addClass("has-select-all");
                var n = o('<div class="select-all-item"><div class="count-label">' + i18next.t("selected") + ' <span class="check-count">0</span>/' + t + '</div><div class="check-all x-check"><i class="icon-blank"/></div></div>').data("total", t).click(function() {
                    var t = o(".check-all", n)
                        , e = !t.hasClass("select");
                    t.toggleClass("select", e),
                        a._toggleSelectAll(e, i),
                        FX.Utils.dt(FX.CONST.TRACKER.MEMBER_SELECT_ALL)
                });
                setTimeout(function() {
                    n.prependTo(i);
                    var t = o("ul", i);
                    t[0].scrollHeight > t[0].clientHeight && n.addClass("has-scrollbar"),
                        a._syncSelectAll(i)
                })
            },
            _syncSelectAll: function(t) {
                var e = o(".select-all-item", t)
                    , i = o("ul > li", t)
                    , a = o(".select-btn.select", i).length
                    , n = a === i.length;
                o(".check-count", e).text(a),
                    o(".check-all", e).toggleClass("select", n)
            },
            _toggleSelectAll: function(s, t) {
                var r = this;
                FX.Utils.forEach(o("li", t), function(t, e) {
                    var i, a = o(e), n = o(".select-btn", a);
                    n.hasClass("select") !== s && (n.toggleClass("select", s),
                        i = a.data("user"),
                        s ? r._addSelectItem(i) : r._removeSelectItem(i))
                }),
                    this._syncSelectAll(t)
            },
            _createUserWrapper: function(t, e, i) {
                var a = this
                    , n = o('<div class="user-wrapper"/>')
                    , s = o('<ul class="user-list"/>').appendTo(n);
                return t.length ? (FX.Utils.forEach(t, function(t, e) {
                    a._createUserItem(e, !1, i).appendTo(s)
                }),
                FX.Utils.isNumber(e) && a._createSelectAll(e, n),
                    s.on("click", ".user-item", function(t) {
                        var e = o(t.currentTarget)
                            , i = o(".select-btn", e);
                        i.hasClass("select") ? (i.removeClass("select"),
                            a._removeSelectItem(e.data("user"))) : (i.addClass("select"),
                            a._addSelectItem(e.data("user"))),
                            a._syncSelectAll(n)
                    })) : o('<span class="tip-empty"/>').text(i18next.t("user.empty")).appendTo(s),
                    n
            },
            _createUserItem: function(t, e, i) {
                var a = this._getSelectItem(t)
                    , n = o('<li class="user-item"/>').data("user", a).append(o('<span class="item-name"/>').text(a.name)).append(o('<div class="select-btn x-check"/>').append(o('<i class="icon-blank"/>')));
                return i || new FX.Avatar({
                    renderEl: o('<div class="item-avatar"/>').prependTo(n),
                    name: a.name,
                    avatar: a.avatar,
                    size: "small"
                }),
                e && FX.Utils.appendUserDeptLabel(n.find(".item-name"), a.name, a.label),
                -1 < this.value.indexOf(a.id) && n.children(".select-btn").addClass("select"),
                    n
            },
            _bindSearchEvent: function() {
                var s = this;
                this.$searchList.off("click.search"),
                    this.$searchList.on("click.search", function(t) {
                        var e, i = t.target, a = o(i).closest("li"), n = a.data("user");
                        0 < a.length && n && ((e = a.find(".select-btn")).toggleClass("select"),
                            e.hasClass("select") ? s._addSelectItem(n) : s._removeSelectItem(n))
                    })
            },
            checkValidate: function() {
                return FX.Utils.isExternalLink() ? (this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX),
                    !1) : !(!this.options.allowBlank && 0 === this.getValue().length)
            },
            setValue: function(t) {
                var a = this
                    , n = this.options;
                this.value = [];
                var s = [];
                this.items = [].concat(this._getDynamicFields());
                var r = {};
                FX.Utils.forEach(t, function(t, e) {
                    var i;
                    (e = FX.FormItemUtils.dealCurrentUser(e, n.dynamicType)) && (e._id ? r[e._id] || (r[e._id] = !0,
                        a.value.push(e._id),
                        i = e.nickname || e.name,
                        a.items.push({
                            id: e._id,
                            username: e.username,
                            name: i,
                            avatar: e.avatar
                        }),
                        s.push(i)) : r[e] || (r[e] = !0,
                        a.value.push(e)))
                }),
                this.isEnabled() || this.setText(s.join(",")),
                    this._initData()
            },
            getValue: function() {
                this.options;
                var i = this.value;
                return this.$selectList && (i = [],
                    o(".select-item", this.$selectList).each(function(t, e) {
                        i.push(o(e).attr("id"))
                    })),
                    i
            },
            getCacheValue: function() {
                if (FX.Utils.isExternalLink())
                    return this.getNullValue();
                var a = this
                    , n = [];
                return FX.Utils.forEach(this.getValue(), function(t, e) {
                    var i = a.selectMap[e];
                    n.push({
                        _id: i.id,
                        username: i.username,
                        name: i.name,
                        avatar: i.avatar
                    })
                }),
                    n
            },
            getText: function() {
                var i = this
                    , a = [];
                return FX.Utils.forEach(this.value, function(t, e) {
                    i.selectMap[e] && a.push(i.selectMap[e].name)
                }),
                    a
            },
            getNullValue: function() {
                return []
            },
            refresh: function() {
                var n = this;
                o(".user-item", this.$selectPane).each(function(t, e) {
                    var i, a = o(e).data("user");
                    a && (i = o(e).children(".select-btn"),
                        -1 < n.value.indexOf(a.id) ? i.addClass("select") : i.removeClass("select"))
                }),
                this.$organizationPane && this._syncSelectAll(o(".user-wrapper", this.$organizationPane)),
                this.$memberPane && this._syncSelectAll(o(".user-wrapper", this.$memberPane)),
                this.$rolePane && this._syncSelectAll(o(".user-wrapper", this.$rolePane))
            },
            getOptions: function(t) {
                var e = this.options;
                return o.extend(FX.User.superclass.getOptions.apply(this, arguments), {
                    noRepeat: e.noRepeat,
                    limit: e.limit,
                    limitWidget: e.limitWidget,
                    value: "save" === t ? FX.FormItemUtils.parseUserDeptListDefaultValue(e.value) : e.value,
                    valueOption: e.valueOption
                })
            }
        }),
            o.shortcut("usergroup", FX.UserGroup)
    }(jQuery),
    function(o) {
        FX.Dept = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return o.extend(FX.Dept.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_dept",
                    API: FX.API,
                    title: i18next.t("widget.dept.listTitle"),
                    msg: i18next.t("widget.dept.clickToSelect"),
                    width: 240,
                    height: 40,
                    value: null,
                    allowBlank: !0,
                    noRepeat: !1,
                    editable: !1,
                    count: 100,
                    limit: {},
                    searchLimit: 50,
                    dynamicFields: [{
                        _id: FX.CONST.DEPT_ID.CURRENT,
                        name: i18next.t("dept.current"),
                        type: "dynamic"
                    }],
                    dynamicKey: FX.CONST.DEPT_ID.CURRENT,
                    dynamicType: "select",
                    valueOption: FX.WidgetValueOption.CUSTOM,
                    onBeforeEdit: null,
                    onStopEdit: null,
                    onStateChange: null,
                    waterMark: i18next.t("content.empty")
                })
            },
            _init: function() {
                FX.Dept.superclass._init.apply(this, arguments),
                    this.selectMap = {},
                    this._initSelectPane(),
                    this.element.attr("data-watermark", this.options.waterMark)
            },
            _initData: function() {
                var t = this.options;
                t.items && (this.items = t.items),
                    this._initSelectPane()
            },
            _initSelectPane: function() {
                if (FX.Utils.isExternalLink())
                    return this.element.empty(),
                        void o('<div class="nonsupport-msg"/>').text(i18next.t("widget.dept.notSupportLink")).appendTo(this.element);
                var i = this
                    , t = this.options;
                this.selectMap = {},
                    FX.Utils.forEach(this.items, function(t, e) {
                        i.selectMap[e._id] = e
                    }),
                    this.isEnabled() ? (this._createSelectList(),
                        t.editable ? (this._createSelectPane(),
                            this._bindSelectEvent()) : this._bindEditEvent()) : this.element.addClass("fui_form_item_disable")
            },
            _bindEditEvent: function() {
                var t = this
                    , e = this.options;
                this.$selectList.unbind("click"),
                    this.$selectList.bind("click", function() {
                        t.isEnabled() && !1 === FX.Utils.applyFunc(t, e.onBeforeEdit, [function() {
                            t._showEditDialog()
                        }
                        ], !1) && t._showEditDialog()
                    })
            },
            _showEditDialog: function() {
                var e = this.options
                    , i = this
                    , a = new FX.ConfirmDialog({
                    title: e.title,
                    width: 610,
                    contentWidget: {
                        rowSize: [440],
                        colSize: [570],
                        items: [[{
                            API: e.API,
                            widgetName: e.widgetName,
                            type: e.type,
                            editable: !0,
                            limit: e.limit,
                            rely: e.rely,
                            items: i.items,
                            value: i.value,
                            valueOption: e.valueOption,
                            onGetAjaxData: e.onGetAjaxData
                        }]]
                    },
                    onOk: function() {
                        var t = a.getWidgetByName(e.widgetName);
                        return i.value = t.getValue(),
                            i.items = t.getItems(),
                            i._initSelectPane(),
                            FX.Utils.applyFunc(i, e.onStopEdit, [], !1),
                            FX.Utils.applyFunc(i, e.onStateChange, [], !1),
                            !1
                    }
                });
                a.show()
            },
            _createSelectList: function() {
                var t, e = this.options;
                this.$selectList ? this.$selectList.empty() : this.$selectList = o('<ul class="select-list"/>').appendTo(this.element),
                    this.value ? (t = this.selectMap[this.value],
                        this._createSelectItem(t)) : e.editable || this.$selectList.append(o('<div class="select-empty"/>').text(e.msg))
            },
            _bindSelectEvent: function() {
                var i = this;
                this.$selectList.unbind("click"),
                    this.$selectList.bind("click", function(t) {
                        var e = o(t.target).closest(".select-item").data("item");
                        e && 0 < o(t.target).closest(".remove-btn").length && i._removeSelectItem(e)
                    })
            },
            _addSelectItem: function(t) {
                this.$selectList.empty(),
                    this._createSelectItem(t),
                    this.value = t._id,
                    this.selectMap[t._id] = t,
                    this.refresh()
            },
            _removeSelectItem: function() {
                this.$selectList.empty(),
                    this.value = null,
                    this.refresh()
            },
            _createSelectItem: function(t) {
                var e, i = this.options;
                t && ((e = o('<li class="select-item"/>').append(o("<span/>").text(t.name)).appendTo(this.$selectList).attr("id", t._id).data("item", t)).prepend(o('<i class="select-icon icon-department-solid"/>')),
                i.editable && o('<span class="remove-btn"/>').append(o('<i class="icon-close-normal"/>')).appendTo(e))
            },
            _createSelectPane: function() {
                var t, e, i, a, n;
                this.$selectPane || (t = this.options,
                    e = this,
                    i = o('<div class="select-menu"/>').appendTo(this.element),
                    this.$selectPane = o('<div class="select-pane"/>').appendTo(this.element),
                    a = o('<div class="select-btn"/>').attr("role", "depart").click(function() {
                        o(".select-btn", i).removeClass("select"),
                            o(this).addClass("select"),
                            e._createDepartmentList()
                    }).text(i18next.t("organization")).appendTo(i),
                (FX.Utils.isObjectEmpty(t.limit) || t.limit.hasCurrentDept) && ("set" === t.dynamicType ? (o('<div class="select-btn"/>').attr("role", "dynamic").click(function() {
                    o(".select-btn", i).removeClass("select"),
                        o(this).addClass("select"),
                        e._createDynamicList()
                }).text(i18next.t("dynamicParameter")).appendTo(i),
                    this._createDynamicList()) : o('<div class="select-btn"/>').attr("role", "curDepart").click(function() {
                    o(".select-btn", i).removeClass("select"),
                        o(this).addClass("select"),
                        e._createCurrentDepartmentList()
                }).text(i18next.t("dept.current")).appendTo(i)),
                    n = o('<div class="select-search-pane"/>').appendTo(i),
                    new FX.SearchInput({
                        renderEl: n,
                        size: "small",
                        placeholder: i18next.t("search"),
                        showSearchResult: !1,
                        onFocus: function() {
                            n.addClass("full-line")
                        },
                        onBlur: function(t) {
                            o(t.target).val().trim() || (n.removeClass("full-line"),
                                this.clearSearch(),
                                e._switchOriginTab())
                        },
                        onSearch: function(t) {
                            o(".select-search .department-list", e.$selectPane).remove(),
                                e._createSearchList(t, 0)
                        },
                        onClose: function() {
                            n.removeClass("full-line"),
                                e._switchOriginTab()
                        }
                    }),
                    a.addClass("select"),
                    this._createDepartmentList())
            },
            _switchOriginTab: function() {
                switch (o(".select-menu .select-btn.select").attr("role")) {
                    case "depart":
                        this._createDepartmentList();
                        break;
                    case "dynamic":
                        this._createDynamicList();
                        break;
                    case "curDepart":
                        this._createCurrentDepartmentList()
                }
            },
            _isRelyLimitEmpty: function() {
                var t = this.options;
                return FX.Utils.isObjectEmpty(t.limit) && t.valueOption !== FX.WidgetValueOption.RELY && !FX.Utils.isObjectEmpty(t.rely)
            },
            _initLimitMap: function(t) {
                var a, e = this.options, n = this;
                FX.Utils.isObjectEmpty(e.limit) || (a = {},
                    FX.Utils.forEach(t, function(t, e) {
                        a[e._id] = e
                    }),
                    this.limitMap = {},
                    FX.Utils.forEach(e.limit.departs, function(t, e) {
                        var i = a[e];
                        i && i.departmentId && (n.limitMap[i.departmentId] = !0)
                    }),
                    FX.Utils.forEach(t, function(t, i) {
                        n.limitMap[i.departmentId] || FX.Utils.forEach(i.path, function(t, e) {
                            n.limitMap[e] && (n.limitMap[i.departmentId] = !0)
                        })
                    }))
            },
            _doSelectItem: function(t) {
                var e;
                this._checkLimit(t) && (e = {
                    name: t.name,
                    _id: t._id
                },
                    this.value !== e._id ? this._addSelectItem(e) : this._removeSelectItem(e),
                    this.departmentTree.refresh())
            },
            _createDepartmentList: function() {
                var i = this
                    , t = this.options;
                this._isRelyLimitEmpty() || (this.$selectPane.children().hide(),
                    this.$memberMenu ? this.$memberMenu.show() : (this.$memberMenu = o('<div class="select-department"/>').appendTo(i.$selectPane),
                    t.limit.hasCurrentDept && FX.Utils.isEmpty(t.limit.departs) || FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.departments),
                        data: o.extend(FX.Utils.applyFunc(this, t.onGetAjaxData, [], {}), {
                            dept_id_list: t.limit.departs
                        })
                    }, function(t) {
                        i.departments = o.extend(!0, [], t.departments),
                            i._initLimitMap(i.departments),
                            i.departmentTree = new FX.DepartmentsTree({
                                renderEl: o("<div/>").appendTo(i.$memberMenu),
                                customCls: "x-department-tree select-department",
                                Nodes: i.departments,
                                setting: {
                                    view: {
                                        expandSpeed: 100
                                    },
                                    data: {
                                        simpleData: {
                                            enable: !0,
                                            idKey: "departmentId",
                                            pIdKey: "parentId"
                                        }
                                    },
                                    callback: {
                                        onCheck: function(t, e) {
                                            i._doSelectItem(e)
                                        },
                                        onClick: function(t, e) {
                                            i._doSelectItem(e)
                                        },
                                        beforeNodeCreate: function(t) {
                                            i._checkLimit(t) || (t.nocheck = !0),
                                                t.checked = t._id === i.value
                                        },
                                        onNodeCreated: function(t, e) {
                                            e.isParent && !e.open && e.level < 1 && this.expandNode(e, !0),
                                            e.departmentId == i.currentDepartment && this.selectNode(e)
                                        }
                                    },
                                    check: {
                                        enable: !0,
                                        chkStyle: "x-radio",
                                        chkboxType: {
                                            Y: "",
                                            N: ""
                                        }
                                    }
                                }
                            })
                    })))
            },
            _checkLimit: function(t) {
                var e = this.options;
                return !!t && (!!FX.Utils.isObjectEmpty(e.limit) || this.limitMap[t.departmentId])
            },
            _getDynamicFields: function() {
                return this.options.dynamicFields
            },
            _createDepartmentItem: function(t, e) {
                var i = this
                    , a = o("<li/>").append(o('<i class="icon-department"/>')).append(o('<span class="item-name"/>').text(t.name)).append(o('<div class="select-btn x-radio"/>').append(o('<i class="icon-blank"/>'))).data("item", t).click(function() {
                    var t, e = a.children(".select-btn");
                    e.hasClass("select") ? (e.removeClass("select"),
                        i._removeSelectItem()) : (e.addClass("select"),
                        t = a.data("item"),
                        i._addSelectItem(t))
                });
                return e && FX.Utils.appendUserDeptLabel(a.find(".item-name"), t.name, t.label),
                this.value === t._id && a.children(".select-btn").addClass("select"),
                    a
            },
            _createCurrentDepartmentList: function() {
                var i = this
                    , t = this.options;
                this._isRelyLimitEmpty() || (this.$selectPane.children().hide(),
                    this.$currentDepartmentList ? this.$currentDepartmentList.empty().show() : this.$currentDepartmentList = o('<ul class="department-list"/>').appendTo(this.$selectPane),
                    this.currentDepartments ? FX.Utils.forEach(this.currentDepartments, function(t, e) {
                        i.$currentDepartmentList.append(i._createDepartmentItem(e))
                    }) : FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.current_departments),
                        data: FX.Utils.applyFunc(this, t.onGetAjaxData, [], {})
                    }, function(t) {
                        i.currentDepartments = t.departmentList,
                            i._createCurrentDepartmentList()
                    }))
            },
            _createDynamicList: function() {
                var i = this;
                this.$selectPane.children().hide(),
                    this.$dynamicList ? this.$dynamicList.empty().show() : this.$dynamicList = o('<ul class="department-list"/>').appendTo(this.$selectPane),
                    FX.Utils.forEach(this._getDynamicFields(), function(t, e) {
                        i.$dynamicList.append(i._createDepartmentItem(e))
                    })
            },
            _createSearchList: function(i, a) {
                var n, s = this, r = this.options;
                this._isRelyLimitEmpty() || (this.$selectPane.children().hide(),
                0 === o(".select-search", this.$selectPane).length && o('<div class="select-search"/>').appendTo(this.$selectPane),
                    n = o(".select-search", this.$selectPane).show(),
                    o(".search-empty", n).remove(),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(FX.API.data.departments),
                        data: o.extend(FX.Utils.applyFunc(this, r.onGetAjaxData, [], {}), {
                            has_current: r.limit.hasCurrentDept,
                            dept_id_list: r.limit.departs,
                            limit: r.searchLimit,
                            keyword: i,
                            skip: a,
                            has_ancestors: !1
                        })
                    }, function(t) {
                        var e = t.departments;
                        e.length <= 0 ? n.append(o('<span class="search-empty"/>').text(i18next.t("dept.empty"))) : (s.$searchList = o('<ul class="department-list"/>').appendTo(n),
                            FX.Utils.forEach(e, function(t, e) {
                                s._createDepartmentItem(e, !0).appendTo(s.$searchList)
                            }),
                        e.length >= r.searchLimit && i && o('<div class="load-more"/>').text(i18next.t("loadMore")).on("click", function() {
                            o(this).remove(),
                                s._createSearchList(i, a + r.searchLimit)
                        }).appendTo(s.$searchList))
                    }))
            },
            getItems: function() {
                var i = [];
                return o(".select-item", this.$selectList).each(function(t, e) {
                    i.push(o(e).data("item"))
                }),
                    i
            },
            setValue: function(t) {
                var i = this
                    , e = this.options;
                FX.FormItemUtils.dealCurrentDept({
                    url: FX.Utils.getApi(e.API.data.current_departments),
                    data: FX.Utils.applyFunc(this, e.onGetAjaxData, [], {})
                }, t, function(t) {
                    i.value = FX.FormItemUtils.parseUserDeptDefaultValue(t);
                    var e = "";
                    t && (e = t.name,
                        i.items = i._getDynamicFields().concat([t])),
                    i.isEnabled() || i.setText(e),
                        i._initData()
                }, e.dynamicType, this.element)
            },
            setText: function(t) {
                var e = this.options;
                this.element.empty(),
                e.subform && this.element.attr("title", t),
                    this.element.text(t)
            },
            getValue: function() {
                return this.value
            },
            getCacheValue: function() {
                var t = this.selectMap[this.value];
                return !t || FX.Utils.isExternalLink() ? null : {
                    _id: t._id,
                    name: t.name
                }
            },
            getText: function() {
                return this.value && this.selectMap[this.value] ? this.selectMap[this.value].name : ""
            },
            _refreshDepartmentList: function(t) {
                var a = this;
                o("li", t).each(function(t, e) {
                    var i = o(e).data("item");
                    i && (a.value === i._id ? o(e).children(".select-btn").addClass("select") : o(e).children(".select-btn").removeClass("select"))
                })
            },
            clearLimit: function() {
                this.options.limit = {}
            },
            refresh: function() {
                this.departmentTree && this.departmentTree.refresh(),
                this.$dynamicList && this._refreshDepartmentList(this.$dynamicList),
                this.$currentDepartmentList && this._refreshDepartmentList(this.$currentDepartmentList),
                this.$searchList && this._refreshDepartmentList(this.$searchList)
            },
            checkValidate: function() {
                if (FX.Utils.isExternalLink())
                    return this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX),
                        !1;
                var t = this.options;
                return !FX.Utils.isEmpty(this.getValue()) || t.allowBlank
            },
            rebuild: function(t) {
                this.setValue(t),
                    this.refresh()
            },
            getOptions: function(t) {
                var e = this.options;
                return o.extend(FX.Dept.superclass.getOptions.apply(this, arguments), {
                    noRepeat: e.noRepeat,
                    limit: e.limit,
                    value: "save" === t ? FX.FormItemUtils.parseUserDeptDefaultValue(e.value) : e.value,
                    valueOption: e.valueOption
                })
            }
        }),
            o.shortcut("dept", FX.Dept)
    }(jQuery),
    function(n) {
        FX.DeptGroup = FX.extend(FX.Dept, {
            _defaultConfig: function() {
                return n.extend(FX.DeptGroup.superclass._defaultConfig.apply(this, arguments), {
                    baseCls: "fui_dept fui_dept_group",
                    width: 420,
                    height: 80,
                    value: []
                })
            },
            _init: function() {
                this.value = [],
                    FX.DeptGroup.superclass._init.apply(this, arguments)
            },
            _initData: function() {
                var t = this.options;
                this.selectMap = {},
                t.items && (this.items = t.items),
                    this._initSelectPane()
            },
            _createSelectList: function() {
                var a = this
                    , t = this.options;
                this.$selectList ? this.$selectList.empty() : this.$selectList = n('<ul class="select-list"/>').appendTo(this.element),
                    this.value && 0 < this.value.length ? FX.Utils.forEach(this.value, function(t, e) {
                        var i = a.selectMap[e];
                        a._createSelectItem(i)
                    }) : t.editable || this.$selectList.append(n('<div class="select-empty"/>').text(t.msg))
            },
            _addSelectItem: function(t) {
                -1 < this.value.indexOf(t._id) || (this._createSelectItem(t),
                    this.value = this.getValue(),
                    this.selectMap[t._id] = t,
                    this.refresh())
            },
            _removeSelectItem: function(t) {
                n("#" + t._id, this.$selectList).remove(),
                    this.value = this.getValue(),
                    this.refresh()
            },
            _doSelectItem: function(t) {
                var e;
                this._checkLimit(t) && (e = {
                    name: t.name,
                    _id: t._id
                },
                    -1 < this.value.indexOf(e._id) ? this._removeSelectItem(e) : this._addSelectItem(e))
            },
            _createDepartmentList: function() {
                var i = this
                    , t = this.options;
                this._isRelyLimitEmpty() || (this.$selectPane.children().hide(),
                    this.$memberMenu ? this.$memberMenu.show() : (this.$memberMenu = n('<div class="select-department"/>').appendTo(i.$selectPane),
                    t.limit.hasCurrentDept && FX.Utils.isEmpty(t.limit.departs) || FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.departments),
                        data: {
                            dept_id_list: t.limit.departs
                        }
                    }, function(t) {
                        i.departments = n.extend(!0, [], t.departments),
                        i.departments[0] && !i.departments[0]._id && i.departments.shift(),
                            i._initLimitMap(i.departments),
                            i.departmentTree = new FX.DepartmentsTree({
                                renderEl: n("<div/>").appendTo(i.$memberMenu),
                                customCls: "x-department-tree select-department",
                                Nodes: i.departments,
                                setting: {
                                    view: {
                                        expandSpeed: 100
                                    },
                                    data: {
                                        simpleData: {
                                            enable: !0,
                                            idKey: "departmentId",
                                            pIdKey: "parentId"
                                        }
                                    },
                                    callback: {
                                        onCheck: function(t, e) {
                                            i._doSelectItem(e)
                                        },
                                        onClick: function(t, e) {
                                            i._doSelectItem(e)
                                        },
                                        beforeNodeCreate: function(t) {
                                            i._checkLimit(t) || (t.nocheck = !0),
                                                t.checked = -1 < i.value.indexOf(t._id + "")
                                        },
                                        onNodeCreated: function(t, e) {
                                            e.isParent && !e.open && e.level < 1 && this.expandNode(e, !0),
                                            e.departmentId == i.currentDepartment && this.selectNode(e)
                                        }
                                    },
                                    check: {
                                        enable: !0,
                                        chkboxType: {
                                            Y: "",
                                            N: ""
                                        }
                                    }
                                }
                            })
                    })))
            },
            _createDepartmentItem: function(t, e) {
                var i = this
                    , a = n("<li/>").append(n('<i class="icon-department"/>')).append(n('<span class="item-name"/>').text(t.name)).append(n('<div class="select-btn x-check"/>').append(n('<i class="icon-blank"/>'))).data("item", t).click(function() {
                    var t, e = a.children(".select-btn");
                    e.hasClass("select") ? (e.removeClass("select"),
                        i._removeSelectItem(a.data("item"))) : (e.addClass("select"),
                        t = a.data("item"),
                        i._addSelectItem(t))
                });
                return e && FX.Utils.appendUserDeptLabel(a.find(".item-name"), t.name, t.label),
                -1 < this.value.indexOf(t._id) && a.children(".select-btn").addClass("select"),
                    a
            },
            getItems: function() {
                var i = [];
                return n(".select-item", this.$selectList).each(function(t, e) {
                    i.push(n(e).data("item"))
                }),
                    i
            },
            checkValidate: function() {
                return FX.Utils.isExternalLink() ? (this.setInvalidateType(FX.CONST.INVALID_TYPE.REGEX),
                    !1) : !(!this.options.allowBlank && 0 === this.getValue().length)
            },
            setValue: function(t) {
                var n = this
                    , e = this.options;
                FX.FormItemUtils.dealCurrentDeptList({
                    url: FX.Utils.getApi(e.API.data.current_departments),
                    data: FX.Utils.applyFunc(this, e.onGetAjaxData, [], {})
                }, t, function(t) {
                    n.value = [],
                        n.items = [].concat(n._getDynamicFields());
                    var i = []
                        , a = {};
                    FX.Utils.forEach(t, function(t, e) {
                        e && e._id ? a[e._id] || (a[e._id] = !0,
                            i.push(e.name),
                            n.value.push(e._id),
                            n.items.push(e)) : a[e] || (a[e] = !0,
                            n.value.push(e))
                    }),
                    n.isEnabled() || n.setText(i.join(",")),
                        n._initData()
                }, e.dynamicType, this.element)
            },
            getValue: function() {
                var i = this.value;
                return this.$selectList && (i = [],
                    n(".select-item", this.$selectList).each(function(t, e) {
                        i.push(n(e).attr("id"))
                    })),
                    i
            },
            getCacheValue: function() {
                var a = this
                    , n = [];
                return FX.Utils.isExternalLink() || FX.Utils.forEach(this.getValue(), function(t, e) {
                    var i = a.selectMap[e];
                    n.push({
                        _id: i._id,
                        name: i.name
                    })
                }),
                    n
            },
            getText: function() {
                var i = this
                    , a = [];
                return FX.Utils.forEach(this.value, function(t, e) {
                    i.selectMap[e] && a.push(i.selectMap[e].name)
                }),
                    a
            },
            getNullValue: function() {
                return []
            },
            _refreshDepartmentList: function(t) {
                var a = this;
                n("li", t).each(function(t, e) {
                    var i = n(e).data("item");
                    i && (-1 < a.value.indexOf(i._id) ? n(e).children(".select-btn").addClass("select") : n(e).children(".select-btn").removeClass("select"))
                })
            },
            getOptions: function(t) {
                var e = this.options;
                return n.extend(FX.Dept.superclass.getOptions.apply(this, arguments), {
                    noRepeat: e.noRepeat,
                    limit: e.limit,
                    value: "save" === t ? FX.FormItemUtils.parseUserDeptListDefaultValue(e.value) : e.value,
                    valueOption: e.valueOption
                })
            }
        }),
            n.shortcut("deptgroup", FX.DeptGroup)
    }(jQuery),
    function(u) {
        FX.LinkQuery = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return u.extend(FX.LinkQuery.superclass._defaultConfig.apply(), {
                    baseCls: "fui_link_query",
                    API: FX.API,
                    allowBlank: !0,
                    linkFields: [],
                    linkFilter: [],
                    linkForm: null,
                    layout: "",
                    itemPadding: 4,
                    multi: !1,
                    allowAdd: !1,
                    linkEnable: !0
                })
            },
            _init: function() {
                FX.LinkQuery.superclass._init.apply(this, arguments),
                    this.options.multi ? this._renderLinkTable() : this._renderLinkList()
            },
            _renderLinkList: function() {
                var l = this.options
                    , c = this;
                this.widgetsMap = {},
                    this.typeMap = {};
                var d = ["image", "upload", "signature"];
                FX.Utils.forEach(l.linkFields, function(t, e) {
                    var i = u('<div class="link-field"/>').appendTo(c.element)
                        , a = c._formatSubFormItems(e)
                        , n = {}
                        , s = c._formatWidgetType(e.type, !1)
                        , r = s.type;
                    l.subform ? (i.addClass("sub-link"),
                        n.width = FX.Utils.getSubformWidgetWidth(e)) : (i.append(u('<div class="fl-label"/>').text(e.text)),
                    FX.Utils.isEmpty(l.layout) || FX.Utils.setLayoutSize(n, l.layout, r)),
                        u.extend(n, c._getWidgetLinkConfig(r));
                    var o = u.extend(n, {
                        renderEl: u("<div/>").appendTo(i),
                        widgetName: e.name,
                        items: a,
                        format: e.format,
                        enable: !1
                    }, s);
                    -1 < d.indexOf(r) && u.extend(n, {
                        disableMode: "form",
                        noFileTip: i18next.t("content.empty")
                    }),
                    -1 < FX.LimitFields.disable.indexOf(r) && (u.extend(o, {
                        widgetType: r,
                        type: "formitemdisable"
                    }),
                    l.subform && u.extend(o, {
                        customCls: "fui_subform_item_disable",
                        shouldResize: !0
                    })),
                        c.widgetsMap[e.name] = FX.createWidget(o),
                        c.typeMap[e.name] = e.type
                })
            },
            _renderLinkTable: function() {
                var t = this.options
                    , e = this
                    , i = [];
                FX.Utils.forEach(t.linkFields, function(t, e) {
                    i.push(e.name)
                }),
                    this.fields = i;
                var a = FX.Utils.applyFunc(this, t.onGetAjaxData, [], {})
                    , n = [];
                FX.Utils.forEach(t.linkFilter, function(t, e) {
                    "self" === e.type && n.push(e.link)
                }),
                    this.linkTable = new FX.LinkTable({
                        renderEl: u("<div/>").appendTo(this.element),
                        API: t.API,
                        allowAdd: t.allowAdd,
                        linkEnable: t.linkEnable,
                        appId: a.appId,
                        dataId: a.dataId,
                        entryId: t.linkForm,
                        linkDataFields: n,
                        fieldName: t.widgetName,
                        fields: t.linkFields,
                        refAppId: t.refAppId,
                        onLoadData: function(t) {
                            return e._getLinkQuery(t)
                        },
                        onLoadCount: function(t) {
                            e._getLinkCount(t)
                        }
                    })
            },
            _getLinkQuery: function(t) {
                var i = this.options
                    , a = this;
                if (!this.filter)
                    return !1;
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(i.API.data.filter_link),
                    data: u.extend(FX.Utils.applyFunc(this, i.onGetAjaxData, [], {}), {
                        multi: !0,
                        formId: i.linkForm,
                        fields: this.fields,
                        filter: this.filter,
                        limit: t.limit,
                        skip: t.skip,
                        refAppId: i.refAppId
                    })
                }, function(t) {
                    var e = FX.Utils.getFieldsIntersection(t.fields, i.linkFields);
                    a.linkTable.reloadData(t, e)
                }, function(t) {
                    var e = t.responseJSON;
                    e && e.code && FX.Utils.applyFunc(this, i.onLinkErr, [e.code], !1)
                })
            },
            _getColorMap: function(t) {
                var i;
                return FX.Utils.forEach(t, function(t, e) {
                    i = i || {},
                        u.extend(i, FX.FormUtils.optionsWidgetConfig2ColorMap(e))
                }),
                    i
            },
            _getLinkCount: function(e) {
                var t = this.options;
                this.filter ? FX.Utils.dataAjax({
                    url: FX.Utils.getApi(t.API.data.filter_link),
                    data: u.extend(FX.Utils.applyFunc(this, t.onGetAjaxData, [], {}), {
                        multi: !0,
                        formId: t.linkForm,
                        fields: this.fields,
                        filter: this.filter,
                        refAppId: t.refAppId,
                        hasCount: !0,
                        isCountOnly: !0
                    })
                }, function(t) {
                    e && e(t.count)
                }, function() {
                    e && e()
                }) : e && e()
            },
            _getWidgetLinkConfig: function(t) {
                var e = {};
                switch (t) {
                    case "image":
                    case "upload":
                    case "subform_image":
                    case "subform_upload":
                        e.mode = "preview",
                            e.maxFileCount = FX.CONST.UPLOAD_FILE_COUNT.MULTI;
                        break;
                    case "signature":
                    case "subform":
                        e.mode = "preview";
                        break;
                    case "linkdata":
                        var i = FX.Utils.applyFunc(this, this.options.onGetAjaxData, [], {});
                        e.onGetAjaxData = function() {
                            return i
                        }
                }
                return e
            },
            _formatSubFormItems: function(t) {
                if ("subform" === t.type) {
                    var n = this
                        , s = [];
                    return FX.Utils.forEach(t.items, function(t, e) {
                        var i, a;
                        e.widget && (n.typeMap[e.widget.widgetName] = e.widget.type,
                            i = u.extend(!0, {}, e),
                            a = n._formatWidgetType(e.widget.type, !0),
                            u.extend(i.widget, n._getWidgetLinkConfig(e.widget.type), a),
                            s.push(i))
                    }),
                        s
                }
            },
            _formatWidgetType: function(t, e) {
                var i = this.options;
                switch (t) {
                    case "combo":
                    case "combocheck":
                    case "radiogroup":
                    case "checkboxgroup":
                        return {
                            type: "text",
                            oriType: t
                        };
                    case "address":
                    case "location":
                        return {
                            type: "text"
                        };
                    case "image":
                    case "upload":
                        return i.subform && !e ? {
                            type: "subform_" + t,
                            oriType: t
                        } : {
                            type: t
                        };
                    default:
                        return {
                            type: t
                        }
                }
            },
            _formatWidgetData: function(t, e) {
                var a = this
                    , i = this.options;
                switch (t) {
                    case "address":
                        return FX.Utils.address2Str(e, "", "pcda");
                    case "location":
                        var n = FX.Utils.formatData({
                            type: t
                        }, e)
                            , s = "";
                        return n.address && (s = n.address),
                        n.lngLat && (s += " " + n.lngLat),
                            s;
                    case "subform":
                        return FX.Utils.forEach(e, function(t, i) {
                            FX.Utils.forEach(i, function(t, e) {
                                i[t] = a._formatWidgetData(a.typeMap[t], e)
                            })
                        }),
                            e;
                    case "linkdata":
                        return i.refAppId && e && !e.appId && (e.appId = i.refAppId),
                            e;
                    default:
                        return e
                }
            },
            getOptions: function() {
                var t = this.options;
                return u.extend(FX.LinkQuery.superclass.getOptions.apply(this, arguments), {
                    linkFilter: t.linkFilter,
                    linkFields: t.linkFields,
                    linkForm: t.linkForm,
                    refAppId: t.refAppId,
                    multi: t.multi,
                    allowAdd: t.allowAdd
                })
            },
            reload: function(t) {
                var i = this.options
                    , s = this
                    , a = [];
                if (FX.Utils.forEach(i.linkFields, function(t, e) {
                    a.push(e.name)
                }),
                i.linkForm && !(a.length <= 0))
                    return i.multi ? (this.filter = t,
                        void this.linkTable.reload()) : void FX.Utils.dataAjax({
                        url: FX.Utils.getApi(i.API.data.filter_link),
                        data: u.extend(FX.Utils.applyFunc(this, i.onGetAjaxData, [], {}), {
                            formId: i.linkForm,
                            fields: a,
                            filter: t,
                            refAppId: i.refAppId
                        })
                    }, function(t) {
                        var a, n = {};
                        FX.Utils.isObjectEmpty(t.dataList) ? s.clearValue() : (n = t.dataList[0],
                            a = s._getNewLinkFields(t.fields),
                            s._resetLinkWidgets(a),
                            s._cacheLinkFields = a,
                            FX.Utils.forEach(s.widgetsMap, function(t, e) {
                                var i = s._formatWidgetData(s.typeMap[t], n[t]);
                                e.setColorMap && e.setColorMap(s._getColorMap(a)),
                                    e.setValue(i)
                            })),
                            FX.Utils.applyFunc(s, i.onRelyDone, [s], !1)
                    }, function(t) {
                        var e = t.responseJSON;
                        e && e.code && FX.Utils.applyFunc(this, i.onLinkErr, [e.code], !1)
                    })
            },
            _getLinkFieldsMap: function(t) {
                var a = {};
                return FX.Utils.forEach(t, function(t, e) {
                    var i = FX.Utils.getFieldName(e);
                    a[i] = e
                }),
                    a
            },
            _getNewLinkFields: function(t) {
                var e = this.options
                    , i = FX.Utils.getFieldsIntersection(t, e.linkFields);
                return FX.Utils.forEach(i, function(t, e) {
                    var i;
                    "subform" === e.type && (i = [],
                        FX.Utils.forEach(e.items, function(t, e) {
                            i.push({
                                label: e.text,
                                widget: u.extend({
                                    widgetName: e.name
                                }, e)
                            })
                        }),
                        e.items = i)
                }),
                    i
            },
            _resetLinkWidgets: function(t) {
                var o, e = this.options, l = this;
                e.multi || (o = this._getLinkFieldsMap(t),
                    FX.Utils.forEach(e.linkFields, function(t, e) {
                        var n, s, i = FX.Utils.getFieldName(e), a = o[i], r = l.widgetsMap[i];
                        a && r && ("subform" === e.type ? (n = l._getLinkFieldsMap(a.items),
                            s = !1,
                            FX.Utils.forEach(e.items, function(t, e) {
                                var i = FX.Utils.getFieldAttr(e)
                                    , a = FX.Utils.getFieldAttr(n[i.name]);
                                if (i && a)
                                    return a.type !== i.type || a.format !== i.format ? !(s = !0) : void 0
                            }),
                        s && l._rebuildLinkWidget(r, a)) : a.type === e.type && a.format === e.format || l._rebuildLinkWidget(r, a))
                    }))
            },
            _rebuildLinkWidget: function(t, e) {
                var i, a, n;
                t && e && (i = this.options,
                    a = u.extend({}, e, {
                        text: null,
                        value: null
                    }),
                    n = this._formatWidgetType(e.type, !1),
                "subform" === e.type && (a.items = this._formatSubFormItems(e)),
                FX.Utils.isEmpty(i.layout) || FX.Utils.setLayoutSize(a, i.layout, n.type),
                    u.extend(a, this._getWidgetLinkConfig(n.type), n),
                    this.typeMap[e.name] = e.type,
                -1 < ["radiogroup", "checkboxgroup", "combo", "combocheck"].indexOf(e.type) && (a.colorMap = FX.FormUtils.optionsWidgetConfig2ColorMap(e)),
                    t.rebuild(a))
            },
            getLinkFields: function() {
                var t = this.options;
                return this._cacheLinkFields || t.linkFields
            },
            getCacheValue: function() {
                var i = {};
                return FX.Utils.forEach(this.widgetsMap, function(t, e) {
                    i[t] = e.getCacheValue()
                }),
                    i
            },
            setCacheValue: function(a) {
                var n = this;
                FX.Utils.forEach(this.widgetsMap, function(t, e) {
                    var i;
                    e.setColorMap && (i = n.getLinkFields(),
                        e.setColorMap(n._getColorMap(i))),
                        a ? e.setCacheValue(a[t]) : e.setCacheValue(null)
                })
            },
            clearValue: function() {
                var t = this.options;
                t.multi ? (this.filter = null,
                    this.linkTable.reloadData()) : (FX.Utils.forEach(this.widgetsMap, function(t, e) {
                    e.setValue(null)
                }),
                    FX.Utils.applyFunc(this, t.onRelyDone, [this], !1))
            },
            doResize: function(t) {
                var i, a = this.options;
                a.subform && (i = -a.itemPadding,
                    FX.Utils.forEach(a.linkFields, function(t, e) {
                        i += FX.Utils.getSubformWidgetWidth(e) + a.itemPadding
                    }),
                    i = Math.max(i, FX.Utils.getSubformWidgetWidth({
                        type: a.type
                    })),
                    this.element.css({
                        width: i
                    }))
            }
        }),
            u.shortcut("linkquery", FX.LinkQuery)
    }(jQuery),
    FX.LinkTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.LinkTable.superclass._defaultConfig.apply(), {
                baseCls: "x-link-table",
                API: FX.API,
                allowAdd: !1,
                linkEnable: !0,
                itemsPerPage: 20,
                appId: "",
                entryId: "",
                dataId: "",
                fieldName: "",
                fields: [],
                linkDataFields: [],
                refAppId: "",
                onLoadCount: null,
                onLoadData: null,
                colorDisable: !1
            })
        },
        _init: function() {
            FX.LinkTable.superclass._init.apply(this, arguments);
            var t = this.options;
            this.page = 0,
                this.sort = [],
                this.count = null,
                this.data = [],
                this.header = this._initHeader(t.fields),
                this.itemsPerPage = this._getItemsPerPage(),
                this._renderHeadTools(),
                this._loadData()
        },
        _initHeader: function(t) {
            var n = [];
            return FX.Utils.forEach(t, function(t, e) {
                var i, a = $.extend({}, e);
                "subform" === a.type && (i = [],
                    FX.Utils.forEach(e.items, function(t, e) {
                        i.push(FX.Utils.getFieldAttr(e))
                    }),
                    a.items = i),
                    n.push(a)
            }),
                n
        },
        _loadData: function() {
            var t = this
                , e = this.options
                , i = {
                limit: this.itemsPerPage,
                skip: this.page * this.itemsPerPage
            };
            !1 === FX.Utils.applyFunc(this, e.onLoadData, [i], !1) && setTimeout(function() {
                t._renderTable()
            }, 0)
        },
        _renderTable: function() {
            var t = this;
            this.processor = new FX.DataTableProcessor({
                header: this.header,
                data: this.data,
                sort: this.sort,
                supportSortFieldsList: [],
                colSizeMap: this._getColSizeMap(),
                resizable: !0,
                colorDisable: this.options.colorDisable
            }),
                this.table ? this.table.reload(this.processor.getTable()) : this.table = this._doCreateTable(),
                this._loadCount(function() {
                    t._createPagination()
                })
        },
        _doCreateTable: function() {
            var a = this
                , n = this.options;
            return new FX.PlainTable($.extend({
                renderEl: $("<div/>").appendTo(this.element),
                isHeadSticky: !0,
                resizable: !0,
                onMouseOverRow: function(t) {
                    var e = t.attr("data-idx");
                    FX.Utils.isNull(e) || $('tbody > tr[data-idx="' + e + '"]', a.element).addClass("hover")
                },
                onMouseOutRow: function(t) {
                    var e = t.attr("data-idx");
                    FX.Utils.isNull(e) || $('tbody > tr[data-idx="' + e + '"]', a.element).removeClass("hover")
                },
                onRowCreate: function(t, e) {
                    t.attr("data-idx", a.processor.getDataIdxByRow(e))
                },
                onRowClick: function(t) {
                    var e, i;
                    FX.Utils.getSelectionText() || (e = t.data("idx"),
                        i = a.processor.getDataByIdx(e),
                        n.linkEnable ? i && a.showData(i._id) : FX.Utils.isExternalLink() ? FX.Msg.toast({
                            type: "warning",
                            msg: FX.Utils.getErrMsg({
                                code: 3009
                            })
                        }) : FX.STATIC.ISADMIN ? FX.Msg.toast({
                            type: "warning",
                            msg: i18next.t("link.manage.show")
                        }) : FX.Msg.toast({
                            type: "warning",
                            msg: i18next.t("link.preview.show")
                        }))
                },
                onColSizeChange: function(t, e) {
                    a._updateColSize(t, e)
                }
            }, this.processor.getTable()))
        },
        showData: function(t) {
            var i, a, n = this, e = this.options, s = this._addMask();
            s && (i = e.refAppId || e.appId,
                a = e.entryId,
                FX.Utils.ajax({
                    url: FX.Utils.getApi(e.API.data.view),
                    data: {
                        authGroupId: FX.STATIC.ISADMIN ? null : FX.CONST.DEFAULT_AUTH_GROUP,
                        formId: a,
                        dataId: t,
                        appId: i,
                        entryId: a
                    }
                }, function(t) {
                    if ("form" !== t.form.type)
                        return FX.Msg.toast({
                            type: "warning",
                            msg: FX.Utils.getErrMsg({
                                code: 3009
                            })
                        }),
                            n._removeMask(s);
                    s.removeClass("fadeout");
                    var e = FX.STATIC.ISADMIN ? FX.CONST.ADMIN_DATA_PERMS : t.data._dataPerms;
                    n.formConfig = {
                        renderEl: $('<div class="x-shadow-content x-link-form"/>').appendTo(s),
                        appId: i,
                        entryId: a,
                        authGroupId: t.authGroupId,
                        data: $.extend(!0, {}, t.data),
                        editValue: t.data,
                        formId: a,
                        hasShowFieldsBtn: !0,
                        hasCustomPrint: !0,
                        hasDeleteBtn: e.delete || e.flow_delete,
                        hasEditBtn: e.update || e.flow_update,
                        hasPrintBtn: !0,
                        header: t.fields,
                        height: "100%",
                        ignoreOptAuth: FX.STATIC.ISADMIN,
                        ignoreValidate: FX.STATIC.ISADMIN,
                        optAuth: FX.Utils.isObjectEmpty(t.optAuth) ? null : t.optAuth,
                        title: t.form.name,
                        printList: t.printList,
                        dataPerms: e,
                        tabs: t.form.tabs,
                        comment: t.form.comment,
                        hasDataLog: !0,
                        onAfterDeleteData: function() {
                            n._removeMask(s),
                                n._loadData()
                        },
                        onAfterEditData: function() {
                            n._removeMask(s),
                                n.reload()
                        },
                        onClose: function() {
                            n._removeMask(s)
                        }
                    },
                        t.form.hasCoop ? new FX.CoopFormDataPane(n.formConfig) : new FX.FlowFormDataPane(n.formConfig)
                }, function() {
                    return n._removeMask(s),
                        !1
                }))
        },
        addData: function() {
            var i, a, n = this, s = this.options, r = this._addMask();
            r && (i = s.refAppId || s.appId,
                a = s.entryId,
                FX.Utils.ajax({
                    url: FX.Utils.getApi(FX.API.form.get, i, a)
                }, function(t) {
                    var e = t.entry;
                    if ("form" !== e.type)
                        return FX.Msg.toast({
                            type: "warning",
                            msg: FX.Utils.getErrMsg({
                                code: 3009
                            })
                        }),
                            FX.Utils.removeLinkFormMask(r);
                    r.removeClass("fadeout"),
                        new FX.Form($.extend(e.content, {
                            renderEl: $('<div class="x-shadow-content x-link-form"/>').appendTo(r),
                            appId: i,
                            entryId: a,
                            authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                            linkDataId: s.linkDataFields.length ? s.dataId : null,
                            linkDataFields: s.linkDataFields,
                            width: 1080,
                            height: "100%",
                            submitText: i18next.t("flow.action.forward"),
                            title: e.name,
                            multiTabs: e.tabs,
                            formEvents: e.formEvents,
                            cacheEnable: e.hasCache,
                            updateTime: e.updateTime,
                            onAfterCancel: function() {
                                n._removeMask(r)
                            },
                            onSuccess: function() {
                                n._removeMask(r),
                                    n._loadData()
                            }
                        }))
                }, function() {
                    return n._removeMask(r),
                        !1
                }))
        },
        _addMask: function() {
            return FX.Utils.addLinkFormMask()
        },
        _removeMask: function(t) {
            FX.Utils.removeLinkFormMask(t)
        },
        _renderHeadTools: function() {
            var t = $('<div class="table-head"/>').appendTo(this.element)
                , e = this
                , i = this.options;
            this.$title = $('<div class="head-title"/>').text(this.title).appendTo(t),
            i.allowAdd && ($('<a class="data-add-btn"/>').append('<i class="icon-add">').append($("<span />").text(i18next.t("create"))).appendTo(t).click(function() {
                i.linkEnable ? e.addData() : FX.Utils.isExternalLink() ? FX.Msg.toast({
                    type: "warning",
                    msg: FX.Utils.getErrMsg({
                        code: 3009
                    })
                }) : FX.STATIC.ISADMIN ? FX.Msg.toast({
                    type: "warning",
                    msg: i18next.t("link.manage.add")
                }) : FX.Msg.toast({
                    type: "warning",
                    msg: i18next.t("link.preview.add")
                })
            }),
                $('<div class="separator-vertical"/>').appendTo(t)),
                $('<a class="head-icon"/>').append('<i class="icon-enlarge"/><i class="icon-shrink"/>').appendTo(t).click(function() {
                    e.doFullScreen()
                }).hover(function() {
                    var t = e.fullScreen ? i18next.t("zoomOut") : i18next.t("fullScreen");
                    FX.UI.showPopover({
                        position: "bottomLeft",
                        anchor: $(this),
                        content: $("<span/>").text(t),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                })
        },
        doFullScreen: function() {
            var t = this.element;
            this.fullScreen ? (t.removeClass("block-fullscreen"),
            this.table && this.table.doResize(),
                this.fullScreen = !1) : (t.addClass("block-fullscreen"),
            this.table && this.table.doResize(),
                this.fullScreen = !0)
        },
        _createPagination: function() {
            var t, i = this;
            this.page <= 0 && FX.Utils.isObjectEmpty(this.data) ? this.$menu && (this.$menu.remove(),
                this.$menu = null) : (this.$menu ? this.$menu.empty() : this.$menu = $('<div class="table-menu"/>').appendTo(this.element),
                t = this.processor.getDataCount() >= this.itemsPerPage,
                new FX.Pagination({
                    renderEl: $("<div/>").appendTo(this.$menu),
                    count: i.count,
                    limit: this.itemsPerPage,
                    curPage: i.page + 1,
                    hasMore: t,
                    showCount: !0,
                    hasJumpPage: !1,
                    hasTurnLast: !0,
                    onChangePage: function(t) {
                        i.page = t - 1,
                            i._loadData()
                    },
                    onLimitChange: function(t) {
                        i._updateItemsPerPage(t),
                            i.page = 0,
                            i._loadData()
                    },
                    fetchCount: function(t) {
                        var e = this;
                        i._loadCount(function() {
                            FX.Utils.applyFunc(e, t, [i.count], null)
                        })
                    }
                }))
        },
        _loadCount: function(e) {
            var t = this.options
                , i = this;
            FX.Utils.applyFunc(this, t.onLoadCount, [function(t) {
                FX.Utils.isNull(t) && (t = 1e3),
                    i.count = t,
                e && e()
            }
            ], !1)
        },
        _updateItemsPerPage: function(t) {
            this.itemsPerPage = t;
            var e = this._getItemsPerPageKey();
            FX.Store.set(e, t)
        },
        _getItemsPerPageKey: function() {
            var t = this.options
                , e = {
                appId: t.appId,
                entryId: t.entryId,
                ext: t.fieldName
            };
            return FX.Store.getKey("itemsPerPage", e)
        },
        _getItemsPerPage: function() {
            var t = FX.Store.get(this._getItemsPerPageKey());
            return FX.Utils.isNull(t) && (t = this.options.itemsPerPage),
                t
        },
        _getColSizeMap: function() {
            var t = this._getColSizeMapKey();
            return FX.Store.get(t) || {}
        },
        _updateColSize: function(t, e) {
            var i = this._getColSizeMapKey()
                , a = this._getColSizeMap();
            a[t] = e,
                FX.Store.set(i, a)
        },
        _getColSizeMapKey: function() {
            var t = this.options;
            return FX.Store.getKey("colSizeMap", {
                appId: t.appId,
                entryId: t.entryId,
                widgetId: t.fieldName
            })
        },
        reload: function() {
            this.page = 0,
                this._loadData()
        },
        _coloringHeader: function(t, n) {
            function s(i, a) {
                i.length ? FX.Utils.forEach(i, function(t, e) {
                    e.color = a[e.text]
                }) : FX.Utils.forEach(a, function(t, e) {
                    i.push({
                        text: t,
                        value: t,
                        color: e
                    })
                })
            }
            FX.Utils.forEach(t, function(t, a) {
                var e;
                "subform" === a.type ? FX.Utils.isArray(a.items) && FX.Utils.forEach(a.items, function(t, e) {
                    var i = a.name + "." + e.name;
                    n[i] && (e.colorEnable = !0,
                    e.items || (e.items = []),
                        s(e.items, n[i]))
                }) : (e = a.name,
                n[e] && (a.colorEnable = !0,
                a.items || (a.items = []),
                    s(a.items, n[e])))
            })
        },
        reloadData: function(t, e) {
            t ? (this.data = t.dataList,
                this.title = t.formName,
                this.colorMap = t.colorMap,
                this.$title.text(this.title)) : this.data = [],
            e && (this.header = e),
            this.colorMap && this.header && this._coloringHeader(this.header, this.colorMap),
                this._renderTable()
        }
    }),
    function(h) {
        FX.LinkData = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return h.extend(FX.LinkData.superclass._defaultConfig.apply(), {
                    baseCls: "fui_link_data",
                    API: FX.API,
                    allowBlank: !0,
                    linkFields: [],
                    linkKey: null,
                    linkFilter: [],
                    linkForm: null,
                    itemsPerPage: 20,
                    layout: "",
                    onBeforeLinkData: null,
                    onStateChange: null,
                    itemPadding: 4,
                    selectWidth: 35,
                    btnWidth: 240,
                    allowAdd: !1,
                    linkEnable: !0,
                    mode: "edit"
                })
            },
            _init: function() {
                FX.LinkData.superclass._init.apply(this, arguments);
                var c = this.options
                    , d = this;
                this._createSelectBtn(),
                    this.widgetsMap = {},
                    this.typeMap = {},
                    this.keyword = "";
                var u = ["image", "upload", "signature"];
                FX.Utils.forEach(c.linkFields, function(t, e) {
                    var i, a = h('<div class="link-field"/>').appendTo(d.element), n = d._formatSubFormItems(e), s = {}, r = d._formatWidgetType(e.type, !1), o = r.type;
                    c.subform ? (a.addClass("sub-link"),
                        s.width = FX.Utils.getSubformWidgetWidth(e)) : (i = h('<div class="fl-label"/>').text(e.text),
                    !1 === c.allowBlank && i.append(h('<span class="label-notnull">*</span>')),
                        a.append(i),
                    FX.Utils.isEmpty(c.layout) || FX.Utils.setLayoutSize(s, c.layout, o)),
                        h.extend(s, d._getWidgetLinkConfig(o));
                    var l = h.extend(s, {
                        renderEl: h("<div/>").appendTo(a),
                        widgetName: e.name,
                        items: n,
                        format: e.format,
                        enable: !1
                    }, r);
                    -1 < u.indexOf(o) && h.extend(s, {
                        disableMode: "form",
                        noFileTip: i18next.t("content.empty")
                    }),
                    -1 < FX.LimitFields.disable.indexOf(o) && (h.extend(l, {
                        widgetType: o,
                        type: "formitemdisable"
                    }),
                    c.subform && h.extend(l, {
                        customCls: "fui_subform_item_disable",
                        shouldResize: !0
                    })),
                        d.widgetsMap[e.name] = FX.createWidget(l),
                        d.typeMap[e.name] = e.type
                })
            },
            _getWidgetLinkConfig: function(t) {
                var e = {};
                switch (t) {
                    case "image":
                    case "upload":
                    case "subform_image":
                    case "subform_upload":
                        e.mode = "preview",
                            e.maxFileCount = FX.CONST.UPLOAD_FILE_COUNT.MULTI;
                        break;
                    case "signature":
                    case "subform":
                    case "linkdata":
                        e.mode = "preview"
                }
                return e
            },
            _setWidgetsValue: function(a, t) {
                var n, e = this.options, s = this, i = t || e.linkFields;
                FX.Utils.forEach(i, function(t, e) {
                    n = n || {},
                        h.extend(n, FX.FormUtils.optionsWidgetConfig2ColorMap(e))
                }),
                    FX.Utils.forEach(this.widgetsMap, function(t, e) {
                        var i = s._formatWidgetData(s.typeMap[t], a[t]);
                        e.setColorMap && e.setColorMap(n),
                            e.setValue(i)
                    })
            },
            _formatSubFormItems: function(t) {
                if ("subform" === t.type) {
                    var n = this
                        , s = [];
                    return FX.Utils.forEach(t.items, function(t, e) {
                        var i, a;
                        e.widget && (n.typeMap[e.widget.widgetName] = e.widget.type,
                            i = h.extend(!0, {}, e),
                            a = n._formatWidgetType(e.widget.type, !0),
                            h.extend(i.widget, n._getWidgetLinkConfig(a.type), a),
                            s.push(i))
                    }),
                        s
                }
            },
            _formatWidgetType: function(t, e) {
                var i = this.options;
                switch (t) {
                    case "combo":
                    case "combocheck":
                    case "radiogroup":
                    case "checkboxgroup":
                        return {
                            type: "text",
                            oriType: t
                        };
                    case "address":
                    case "location":
                        return {
                            type: "text"
                        };
                    case "image":
                    case "upload":
                        return i.subform && !e ? {
                            type: "subform_" + t,
                            oriType: t
                        } : {
                            type: t
                        };
                    default:
                        return {
                            type: t
                        }
                }
            },
            _formatWidgetData: function(t, e) {
                var a = this
                    , i = this.options;
                switch (t) {
                    case "address":
                        return FX.Utils.address2Str(e, "", "pcda");
                    case "location":
                        var n = FX.Utils.formatData({
                            type: t
                        }, e)
                            , s = "";
                        return n.address && (s = n.address),
                        n.lngLat && (s += " " + n.lngLat),
                            s;
                    case "subform":
                        return FX.Utils.forEach(e, function(t, i) {
                            FX.Utils.forEach(i, function(t, e) {
                                i[t] = a._formatWidgetData(a.typeMap[t], e)
                            })
                        }),
                            e;
                    case "linkdata":
                        return i.refAppId && e && !e.appId && (e.appId = i.refAppId),
                            e;
                    default:
                        return e
                }
            },
            _createSelectBtn: function() {
                var t = this.options
                    , e = this;
                if (t.subform)
                    h('<div class="data-select select-btn"/>').append(h('<i class="icon-data-picker"/>')).appendTo(this.element).click(function() {
                        e.isEnabled() && FX.Utils.applyFunc(e, t.onBeforeLinkData, [t.linkFilter], !1)
                    });
                else {
                    if (!e.isEnabled())
                        return;
                    new FX.Button({
                        text: i18next.t("widget.linkdata.select"),
                        width: t.btnWidth,
                        style: "white",
                        renderEl: h('<div class="select-btn"/>').appendTo(this.element),
                        onClick: function() {
                            e.isEnabled() && FX.Utils.applyFunc(e, t.onBeforeLinkData, [t.linkFilter], !1)
                        }
                    })
                }
            },
            _createDataList: function(t) {
                var e, i, a = this, n = this.options;
                this.datalist ? h(".link-empty-list", this.datalist).remove() : (this.datalist = h('<ul class="link-data-list"/>'),
                "full-line" === n.layout && this.datalist.css({
                    width: n.btnWidth
                })),
                    this.items = t,
                h(".data-search-wrapper", this.datalist).length || (e = h('<li class="data-search-wrapper"><i class="icon-search"></i></li>').appendTo(this.datalist),
                    h("<input />").on("input propertychange", function() {
                        a.keyword !== this.value && (a.searchinterval && clearTimeout(a.searchinterval),
                            a.keyword = this.value,
                            a.searchinterval = setTimeout(function() {
                                a.skip = 0,
                                    a._loadData(!0)
                            }, 500))
                    }).appendTo(e)),
                    this.$listWrapper ? this.$listWrapper.empty() : this.$listWrapper = h('<ul class="data-list-wrapper"/>').appendTo(this.datalist),
                    this.$listWrapper.append(h('<li class="data-item data-clear"/>').text(i18next.t("select"))),
                    t.length <= 0 ? this.datalist.append(h('<div class="link-empty-list"/>').text(i18next.t("widget.linkdata.empty"))) : FX.Utils.forEach(t, function(t, e) {
                        a._createDataItem(e)
                    }),
                n.allowAdd && (i = h('<div class="data-add-btn"/>').insertBefore(this.$listWrapper),
                    new FX.Button({
                        renderEl: h("<div/>").appendTo(i),
                        style: "none",
                        height: 40,
                        width: 70,
                        text: i18next.t("create"),
                        iconCls: "icon-add",
                        customCls: "field-add-btn",
                        onClick: function() {
                            n.linkEnable ? a.addData() : FX.Utils.isExternalLink() ? FX.Msg.toast({
                                type: "warning",
                                msg: FX.Utils.getErrMsg({
                                    code: 3009
                                })
                            }) : FX.STATIC.ISADMIN ? FX.Msg.toast({
                                type: "warning",
                                msg: i18next.t("link.manage.add")
                            }) : FX.Msg.toast({
                                type: "warning",
                                msg: i18next.t("link.preview.add")
                            })
                        }
                    })),
                this.bubble || (this.bubble = FX.Msg.bubble({
                    anchor: h(".select-btn", this.element),
                    text4Ok: null,
                    text4Cancel: null,
                    minWidth: 330,
                    contentHTML: this.datalist,
                    hAdjust: "full-line" === n.layout ? 353 : 158,
                    contentPadding: 0,
                    edge: 370,
                    hasTriangle: !1,
                    onClose: function() {
                        return a.keyword = "",
                            a.datalist.remove(),
                            a.datalist = null,
                            a.$listWrapper = null,
                            a.bubble = null,
                            !1
                    }
                }),
                    this._bindListEvent(this.bubble))
            },
            _createDataItem: function(a) {
                var n, t, e = this.options, s = this, i = a.label, r = "";
                FX.Utils.isEmpty(i) && (n = [],
                    t = s.cacheLinkFields || e.linkFields,
                    FX.Utils.forEach(t, function(t, e) {
                        var i = s._formatData(e.type, a[e.name], e.format);
                        i && n.push(i)
                    }),
                    i = n.join(","),
                "template" === s.dataLabelMode && (r = "style-blue"));
                var o = h('<li class="data-item" title="' + i + '"/>').text(i).appendTo(this.$listWrapper).data("data", a).addClass(r);
                this.value && this.value.id === a._id && o.addClass("select")
            },
            _bindListEvent: function(n) {
                var s = this
                    , r = this.options;
                this.$listWrapper.click(function(t) {
                    var e, i = t.target, a = h(i).closest(".data-item");
                    return a && 0 < a.length && (a.hasClass("data-clear") ? (s.value = {},
                        FX.Utils.forEach(s.widgetsMap, function(t, e) {
                            e.setValue(null)
                        })) : (e = a.data("data"),
                        s.setValue({
                            id: e._id,
                            key: e[r.linkKey]
                        })),
                        FX.Utils.applyFunc(s, r.onStopEdit, [], !1),
                        FX.Utils.applyFunc(s, r.onStateChange, [], !1),
                        n.close()),
                        !1
                }),
                    this.$listWrapper.scroll(function() {
                        this.scrollTop + h(this).height() > this.scrollHeight - 5 && s.loadMore()
                    })
            },
            _formatData: function(t, e, i) {
                if (FX.Utils.isObjectEmpty(e))
                    return "";
                var a = e.toString();
                switch (t) {
                    case "address":
                    case "location":
                        a = FX.Utils.address2Str(e, "", "pcda");
                        break;
                    case "datetime":
                        a = FX.Utils.date2Str(new Date(e), i || "yyyy-MM-dd");
                        break;
                    case "upload":
                    case "image":
                    case "signature":
                    case "subform":
                        a = "";
                        break;
                    case "user":
                    case "dept":
                        a = e && e.name;
                        break;
                    case "usergroup":
                    case "deptgroup":
                        a = e && e.map(function(t) {
                            return t.name
                        });
                        break;
                    case "phone":
                        a = e && e.phone
                }
                return a
            },
            _getLinkFieldsMap: function(t) {
                var a = {};
                return FX.Utils.forEach(t, function(t, e) {
                    var i = FX.Utils.getFieldName(e);
                    a[i] = e
                }),
                    a
            },
            _getNewLinkFields: function(t) {
                var e = this.options
                    , i = FX.Utils.getFieldsIntersection(t, e.linkFields);
                return FX.Utils.forEach(i, function(t, e) {
                    var i;
                    "subform" === e.type && (i = [],
                        FX.Utils.forEach(e.items, function(t, e) {
                            i.push({
                                label: e.text,
                                widget: h.extend({
                                    widgetName: e.name
                                }, e)
                            })
                        }),
                        e.items = i)
                }),
                    i
            },
            _resetLinkWidgets: function(t) {
                var e = this.options
                    , o = this
                    , l = this._getLinkFieldsMap(t);
                FX.Utils.forEach(e.linkFields, function(t, e) {
                    var n, s, i = FX.Utils.getFieldName(e), a = l[i], r = o.widgetsMap[i];
                    a && r && ("subform" === e.type ? (n = o._getLinkFieldsMap(a.items),
                        s = !1,
                        FX.Utils.forEach(e.items, function(t, e) {
                            var i = FX.Utils.getFieldAttr(e)
                                , a = FX.Utils.getFieldAttr(n[i.name]);
                            if (i && a)
                                return a.type !== i.type || a.format !== i.format || "linkdata" === i.type ? !(s = !0) : void 0
                        }),
                    s && o._rebuildLinkWidget(r, a)) : a.type === e.type && a.format === e.format || o._rebuildLinkWidget(r, a))
                })
            },
            _rebuildLinkWidget: function(t, e) {
                var i, a, n;
                t && e && (i = this.options,
                    a = h.extend({}, e, {
                        text: null,
                        value: null
                    }),
                    n = this._formatWidgetType(e.type, !1),
                "subform" === e.type && (a.items = this._formatSubFormItems(e)),
                FX.Utils.isEmpty(i.layout) || FX.Utils.setLayoutSize(a, i.layout, n.type),
                    h.extend(a, this._getWidgetLinkConfig(n.type), n),
                    this.typeMap[e.name] = e.type,
                -1 < ["radiogroup", "checkboxgroup", "combo", "combocheck"].indexOf(e.type) && (a.colorMap = FX.FormUtils.optionsWidgetConfig2ColorMap(e)),
                    t.rebuild(a))
            },
            _setScanData: function() {
                var t, e, n = this.options, s = this;
                this.filterValidate ? ((t = [].concat(this.filter.cond)).push({
                    type: "dataid",
                    field: "_id",
                    method: FX.CONST.FILTER_METHOD.EQ,
                    value: [this.dataId],
                    entryId: n.linkForm
                }),
                    this.dataId = null,
                    e = {
                        cond: t,
                        rel: this.filter.rel
                    },
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(n.API.data.filter_link),
                        data: h.extend(FX.Utils.applyFunc(this, n.onGetAjaxData, [], {}), {
                            formId: n.linkForm,
                            fields: this.fields,
                            filter: e,
                            refAppId: n.refAppId
                        })
                    }, function(t) {
                        var e = [];
                        FX.Utils.isObjectEmpty(t.dataList) || (e = t.dataList);
                        var i, a = e[0];
                        a && (s.value = {
                            id: a._id,
                            key: a[n.linkKey]
                        },
                            i = s._getNewLinkFields(t.fields),
                            s._resetLinkWidgets(i),
                            s._setWidgetsValue(a, i),
                            FX.Utils.applyFunc(s, n.onStopEdit, [], !1),
                            FX.Utils.applyFunc(s, n.onStateChange, [], !1))
                    }, function(t) {
                        var e = t.responseJSON;
                        e && e.code && FX.Utils.applyFunc(this, n.onLinkErr, [e.code], !1)
                    })) : this.dataId = null
            },
            addData: function() {
                var t, i, a, n = this, e = this.options, s = FX.Utils.addLinkFormMask();
                s && (t = FX.Utils.applyFunc(this, e.onGetAjaxData, [], {}),
                    i = e.refAppId || t.appId,
                    a = e.linkForm,
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.form.get, i, a)
                    }, function(t) {
                        var e = t.entry;
                        if ("form" !== e.type)
                            return FX.Msg.toast({
                                type: "warning",
                                msg: FX.Utils.getErrMsg({
                                    code: 3009
                                })
                            }),
                                FX.Utils.removeLinkFormMask(s);
                        s.removeClass("fadeout"),
                            new FX.Form(h.extend(e.content, {
                                renderEl: h('<div class="x-shadow-content x-link-form"/>').appendTo(s),
                                appId: i,
                                entryId: a,
                                authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                                width: 1080,
                                height: "100%",
                                submitText: i18next.t("flow.action.forward"),
                                title: e.name,
                                multiTabs: e.tabs,
                                formEvents: e.formEvents,
                                cacheEnable: e.hasCache,
                                updateTime: e.updateTime,
                                onAfterCancel: function() {
                                    FX.Utils.removeLinkFormMask(s)
                                },
                                onSuccess: function(t) {
                                    FX.Utils.removeLinkFormMask(s),
                                    t && t.data && (n.dataId = t.data._id,
                                        n._setScanData())
                                }
                            }))
                    }, function() {
                        return FX.Utils.removeLinkFormMask(s),
                            !1
                    }))
            },
            checkValidate: function() {
                return this.options.allowBlank || !FX.Utils.isObjectEmpty(this.value)
            },
            setValue: function(t) {
                var e = this.options
                    , i = this;
                this.value = t,
                    "preview" !== e.mode || FX.Utils.isObjectEmpty(t) ? !FX.Utils.isObjectEmpty(t) && t.hasOwnProperty("id") ? FX.Utils.dataAjax({
                        url: FX.Utils.getApi(e.API.data.read_link),
                        data: h.extend(FX.Utils.applyFunc(this, e.onGetAjaxData, [], {}), {
                            formId: t.entryId || e.linkForm,
                            linkId: t.id,
                            refAppId: t.appId || e.refAppId
                        })
                    }, function(t) {
                        var e = i._getNewLinkFields(t.fields);
                        i._resetLinkWidgets(e),
                            i._setWidgetsValue(t.data, e)
                    }, function() {}) : FX.Utils.forEach(this.widgetsMap, function(t, e) {
                        e.setValue(null)
                    }) : this._setWidgetsValue(t)
            },
            getValue: function() {
                var t = this.options;
                return this.value && this.value.id ? h.extend({
                    appId: t.refAppId,
                    entryId: t.linkForm
                }, this.value) : {}
            },
            getText: function() {
                var i = {};
                return FX.Utils.forEach(this.widgetsMap, function(t, e) {
                    i[t] = e.getText()
                }),
                    i
            },
            getLinkValue: function() {
                return this.value && this.value.key
            },
            getLinkType: function() {
                return this.options.linkType
            },
            getOptions: function() {
                var t = this.options;
                return h.extend(FX.LinkData.superclass.getOptions.apply(this, arguments), {
                    linkFilter: t.linkFilter,
                    linkFields: t.linkFields,
                    linkForm: t.linkForm,
                    linkKey: t.linkKey,
                    linkType: t.linkType,
                    refAppId: t.refAppId,
                    scan: t.scan,
                    allowAdd: t.allowAdd
                })
            },
            getNullValue: function() {
                return {}
            },
            _loadData: function(i) {
                var a = this.options
                    , n = this;
                this.filterValidate ? (this.loading = !0,
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(a.API.data.filter_link),
                        data: h.extend(FX.Utils.applyFunc(this, a.onGetAjaxData, [], {}), {
                            multi: !0,
                            formId: a.linkForm,
                            fields: this.fields,
                            filter: this.filter,
                            limit: a.itemsPerPage,
                            skip: this.skip,
                            refAppId: a.refAppId,
                            keyword: this.keyword
                        })
                    }, function(t) {
                        var e = [];
                        FX.Utils.isObjectEmpty(t.dataList) || (e = t.dataList),
                            n.dataLabelMode = t.dataLabelMode,
                            e.length < a.itemsPerPage ? n.hasMore = !1 : n.hasMore = !0,
                            i ? (n.cacheLinkFields = FX.Utils.getFieldsIntersection(t.fields, a.linkFields),
                                n._createDataList(e)) : FX.Utils.forEach(e, function(t, e) {
                                n._createDataItem(e)
                            })
                    }, function(t) {
                        var e = t.responseJSON;
                        e && e.code && FX.Utils.applyFunc(this, a.onLinkErr, [e.code], !1)
                    }, function() {
                        n.skip += a.itemsPerPage,
                            n.loading = !1
                    })) : n._createDataList([])
            },
            loadMore: function() {
                !this.loading && this.hasMore && this._loadData()
            },
            reload: function(t) {
                var e = this.options;
                this.filterValidate = t.cond.length === e.linkFilter.length;
                var i = [];
                FX.Utils.forEach(e.linkFields, function(t, e) {
                    i.push(e.name)
                }),
                e.linkKey && i.push(e.linkKey),
                    !e.linkForm || i.length <= 0 ? this.dataId = null : (this.filter = t,
                        this.fields = i,
                        this.skip = 0,
                        this.hasMore = !0,
                        this.dataId ? this._setScanData() : this._loadData(!0))
            },
            setLinkDataId: function(t) {
                this.dataId = t
            },
            doResize: function(t) {
                var i, a = this.options;
                a.subform && (i = a.selectWidth - a.itemPadding,
                    FX.Utils.forEach(a.linkFields, function(t, e) {
                        i += FX.Utils.getSubformWidgetWidth(e) + a.itemPadding
                    }),
                    i = Math.max(i, FX.Utils.getSubformWidgetWidth({
                        type: a.type
                    })),
                    this.element.css({
                        width: i
                    }))
            }
        }),
            h.shortcut("linkdata", FX.LinkData)
    }(jQuery),
    function(r) {
        FX.Signature = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return r.extend(FX.Signature.superclass._defaultConfig.apply(), {
                    baseCls: "fui_signature",
                    API: FX.API,
                    width4SignatureBtn: 125,
                    height4SignatureBtn: 60,
                    tip: i18next.t("signature.tip"),
                    allowBlank: !0,
                    allowSign: !0,
                    maxImgRetry: 5,
                    onStopEdit: null,
                    onStateChange: null,
                    onValidateFail: null,
                    waterMark: i18next.t("content.empty"),
                    disableMode: "other"
                })
            },
            _init: function() {
                FX.Signature.superclass._init.apply(this, arguments),
                    this.expired = !1,
                    this.canSaveSignature = FX.CorpUser.getUserId() && FX.CorpUser.getCurrentCorpId(),
                    this._createEditBtn()
            },
            _createEditBtn: function() {
                var i = this
                    , t = this.options;
                t.allowSign ? t.enable || "form" !== t.disableMode ? this.editBtn = new FX.Button({
                    renderEl: r("<div />").appendTo(this.element),
                    customCls: "signature-btn",
                    text: i18next.t("signature.add"),
                    width: t.width4SignatureBtn,
                    height: t.height4SignatureBtn,
                    iconCls: "icon-widget-signature",
                    style: "white",
                    enable: t.enable,
                    onClick: function(t) {
                        var e = r(t.currentTarget);
                        i._getSavedSignature(function(t) {
                            FX.Utils.isObjectEmpty(t) ? i._createQrcodeDropDown(e) : i._confirmUseSavedSignature(t, e)
                        })
                    }
                }) : this.element.addClass("disable-mode-form").attr("data-watermark", t.waterMark) : this._createUnusable()
            },
            _createUnusable: function() {
                var t = this.options;
                r('<div class="signature-unusable"/>').append('<i class="icon-widget-signature"/>').append(r("<span />").text(i18next.t("disabled"))).css({
                    "line-height": t.height4SignatureBtn - 2 + "px",
                    width: t.width4SignatureBtn,
                    height: t.height4SignatureBtn
                }).appendTo(this.element)
            },
            _getSavedSignature: function(e) {
                this.canSaveSignature ? FX.Utils.ajax({
                    url: FX.Utils.getApi(FX.API.file.get_member_signature)
                }, function(t) {
                    e && e(t.signature)
                }) : e()
            },
            _confirmUseSavedSignature: function(t, e) {
                var i = this
                    , a = this.options
                    , n = r('<div><div class="title">' + i18next.t("widget.signature.useSaved.tip") + '</div><div class="preview"><img src="' + t.thumbUrl + '"/></div></div>');
                FX.Msg.bubble({
                    anchor: e,
                    customCls: "signature-confirm-preview",
                    text4Cancel: i18next.t("widget.signature.rewrite"),
                    text4Ok: i18next.t("use"),
                    contentHTML: n,
                    contentPadding: 15,
                    minWidth: 250,
                    hAdjust: 75,
                    onCancel: function() {
                        i._deleteSavedSignature(),
                            i._createQrcodeDropDown(e)
                    },
                    onOk: function() {
                        i.setValue(t),
                            FX.Utils.applyFunc(i, a.onStopEdit, [], !1),
                            FX.Utils.applyFunc(i, a.onStateChange, [], !1),
                            FX.Utils.dt(FX.CONST.TRACKER.SIGNATURE_COPY)
                    }
                })
            },
            _deleteSavedSignature: function() {
                FX.Utils.ajax({
                    url: FX.Utils.getApi(FX.API.file.delete_member_signature)
                })
            },
            _createQrcodeDropDown: function(i) {
                var a = this
                    , n = this.options;
                this._fetchQrlink(function(t) {
                    var e = r('<div class="qrcode-dropdown"/>');
                    a.$qrcode = r("<img/>").appendTo(e),
                        r("<div/>").text(n.tip).appendTo(e),
                        FX.Utils.createQrcode(this.qrLink, 148, 148, function(t) {
                            a.$qrcode.attr("src", t)
                        }),
                        a.bubble = FX.Msg.bubble({
                            anchor: i,
                            text4Ok: null,
                            minWidth: 150,
                            text4Cancel: null,
                            contentHTML: e,
                            hAdjust: 75,
                            edge: 200,
                            onClose: function() {
                                return a._clearInterval(),
                                    a.qrLink = null,
                                    !1
                            }
                        }),
                        a._bindSocket(t),
                        a._setInterval()
                })
            },
            _bindSocket: function(e) {
                var i = this
                    , a = this.options;
                FX.Socket.onSignature(FX.Socket.PATH.SIGNATURE, function(t) {
                    if (t.signatureKey === e && t)
                        switch (t.type) {
                            case "qr_link_expired":
                                i.setExpired(!0),
                                    i.closeBubble();
                                break;
                            case "signature_upload_done":
                                i.setValue(t.file),
                                    i.closeBubble(),
                                    FX.Utils.applyFunc(i, a.onStopEdit, [], !1),
                                    FX.Utils.applyFunc(i, a.onStateChange, [], !1)
                        }
                })
            },
            _setInterval: function() {
                var e = this;
                this.interval || (this.interval = setInterval(function() {
                    e.setExpired(!0),
                        e._fetchQrlink(function(t) {
                            FX.Utils.createQrcode(e.qrLink, 148, 148, function(t) {
                                e.$qrcode && e.$qrcode.attr("src", t)
                            }),
                                e._bindSocket(t)
                        })
                }, 6e4))
            },
            _clearInterval: function() {
                this.interval && clearInterval(this.interval),
                    this.interval = null
            },
            _fetchQrlink: function(e) {
                var t, i, a = this, n = this.options;
                this.qrLink && !this.expired ? FX.Utils.applyFunc(this, e, [], null) : (t = FX.Utils.getApi(n.API.data.signature),
                    i = this.getKey(),
                    FX.Utils.dataAjax({
                        url: t,
                        data: r.extend(FX.Utils.applyFunc(this, n.onGetAjaxData, [], {}), {
                            signatureKey: i,
                            field: n.widgetName
                        })
                    }, function(t) {
                        a.qrLink = t.qrLink,
                            FX.Utils.applyFunc(a, e, [i], null)
                    }))
            },
            setSignature: function(t) {
                var e = this
                    , i = this.options;
                this.element.empty(),
                    this.editBtn = null;
                var a = r('<div class="signature-wrapper"/>').appendTo(this.element)
                    , n = r('<div class="signature-img"/>').appendTo(a);
                this.$delBtn = r('<span class="del-btn"/>').append('<i class="icon-trasho"/>').toggleClass("x-ui-hidden", !this.isEnabled()).on("click", function() {
                    e.setValue(null),
                        FX.Utils.applyFunc(e, i.onStopEdit, [], !1),
                        FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                }).appendTo(a);
                var s = 0;
                r("<img/>").attr("src", t.thumbUrl).on("click", function() {
                    new FX.FilePreview({
                        files: r.makeArray(e.getValue())
                    })
                }).on("error", function() {
                    r(this).attr("src", t.thumbUrl),
                    ++s >= i.maxImgRetry && r(this).off("error")
                }).appendTo(n)
            },
            checkValidate: function() {
                var t = this.options;
                return !FX.Utils.isObjectEmpty(this.getValue()) || (t.allowBlank || FX.Utils.applyFunc(this, t.onValidateFail, [], !1),
                    t.allowBlank)
            },
            setValue: function(t) {
                this.value = t,
                    FX.Utils.isObjectEmpty(this.value) ? (this.element.empty(),
                        this._createEditBtn()) : this.setSignature(this.value)
            },
            setEnable: function(t) {
                FX.Signature.superclass.setEnable.apply(this, arguments),
                this.editBtn && this.editBtn.setEnable(t),
                this.$delBtn && this.$delBtn.toggleClass("x-ui-hidden", !this.isEnabled())
            },
            setExpired: function(t) {
                this.expired = t
            },
            closeBubble: function() {
                this.bubble && this.bubble.close()
            },
            getValue: function() {
                return this.value
            },
            getKey: function() {
                return this.UUID || (this.UUID = FX.Utils.UUID()),
                    this.UUID
            }
        }),
            r.shortcut("signature", FX.Signature)
    }(jQuery),
    FX.SerialNum = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return $.extend(FX.SerialNum.superclass._defaultConfig.apply(), {
                baseCls: "fui_serial_num",
                waterMark: i18next.t("content.empty")
            })
        },
        _init: function() {
            FX.SerialNum.superclass._init.apply(this, arguments);
            var t = this.options;
            t.waterMark && this.element.attr("data-watermark", t.waterMark)
        },
        setValue: function(t) {
            var e = FX.Utils.isNull(t) ? "" : t;
            this.element.text(e)
        },
        getValue: function() {
            return this.element.text()
        },
        getOptions: function() {
            var t = this.options;
            return $.extend(FX.SerialNum.superclass.getOptions.apply(this, arguments), {
                rules: t.rules
            })
        }
    }),
    $.shortcut("sn", FX.SerialNum),
    function(r) {
        FX.Phone = FX.extend(FX.Widget, {
            CONST: {
                PHONE_NUM_LEN: 11,
                SMS_CODE_LEN: 4,
                VF_STATE: {
                    DEFAULT: "default",
                    PENDING: "pending",
                    SUCCESS: "success",
                    FAIL: "fail"
                },
                TIME_OUT: 700
            },
            _defaultConfig: function() {
                return r.extend(FX.Phone.superclass._defaultConfig.apply(this, arguments), {
                    entryId: null,
                    formId: null,
                    baseCls: "fui_phone",
                    allowBlank: !0,
                    noRepeat: !1,
                    region: ["CN"],
                    hasSmsVerify: !1,
                    isPreviewMode: !1,
                    ignoreSmsVerify: !1,
                    value: {},
                    needValidatePhone: !0,
                    onValidatePhone: null,
                    onValidateSmsCode: null,
                    onStopEdit: null,
                    onStateChange: null
                })
            },
            _init: function() {
                FX.Phone.superclass._init.apply(this, arguments),
                    this._createPhoneInput(),
                    this._createSmsVerify()
            },
            _hasSmsVerify: function() {
                var t = this.options;
                return !t.ignoreSmsVerify && t.hasSmsVerify
            },
            _createPhoneInput: function() {
                this.$phoneWrapper = r('<div class="phone-wrapper"><div class="phone-input"/><i class="phone-icon icon-widget-phone"/></div>').appendTo(this.element);
                var i = this
                    , a = this.options;
                this.phoneInput = new FX.LimitText({
                    renderEl: r(".phone-input", this.$phoneWrapper),
                    width: "100%",
                    regex: "\\d",
                    maxLen: this.CONST.PHONE_NUM_LEN,
                    onFocus: function(t) {
                        i.editValue = t
                    },
                    onInput: function(t) {
                        var e;
                        i.isTicking || (e = i._allowGetSmsCode(t),
                        i.verifyBtn && i.verifyBtn.setEnable(e))
                    },
                    onStopEdit: function(t) {
                        var e;
                        FX.Utils.applyFunc(i, a.onStopEdit, [t], !1),
                            FX.Utils.applyFunc(i, a.onStateChange, [t], !1),
                        a.needValidatePhone && (e = i._validatePhone(t),
                            this.setErrorState(!e),
                            FX.Utils.applyFunc(i, a.onValidatePhone, [e], !1),
                        i.editValue !== t && i.resetGetSmsCode())
                    }
                }),
                    r('<div class="phone-verified-tag">' + i18next.t("widget.phone.validate.success") + "</div>").appendTo(this.$phoneWrapper)
            },
            _createSmsVerify: function() {
                var e, t, i, a, n = this.options, s = this;
                this._hasSmsVerify() && (this.$verifyWrapper = r('<div class="verify-wrapper"><div class="verify-input"/><div class="verify-btn"/></div>').appendTo(this.element),
                    e = this.CONST.VF_STATE,
                    t = r(".verify-input", this.$verifyWrapper),
                    i = FX.Utils.debounce(function(t) {
                        s._allowVerifySmsCode(t) ? s._validateSmsCode(t, function() {
                            s._setSmsVerifyState(e.SUCCESS),
                                setTimeout(function() {
                                    s._setPhoneVerifyState(!0),
                                        FX.Utils.applyFunc(s, n.onStateChange, [], !1)
                                }, s.CONST.TIME_OUT)
                        }, function() {
                            s._setSmsVerifyState(e.FAIL),
                                s.codeInput.setEnable(!0),
                                FX.Utils.applyFunc(s, n.onStateChange, [], !1)
                        }) : s._setSmsVerifyState(e.DEFAULT)
                    }, this.CONST.TIME_OUT, this),
                    this.codeInput = new FX.LimitText({
                        renderEl: t,
                        waterMark: i18next.t("widget.phone.sms.code"),
                        width: 190,
                        regex: "\\d",
                        maxLen: this.CONST.SMS_CODE_LEN,
                        enable: !1,
                        onInput: i,
                        onStopEdit: function() {
                            var t = s._isSmsVerifySuccess();
                            this.setErrorState(!t),
                                FX.Utils.applyFunc(s, n.onValidateSmsCode, [t], !1)
                        }
                    }),
                    this.$smsVerifyState = r('<div class="verify-state"/>').appendTo(t),
                    a = this._allowGetSmsCode(n.value && n.value.phone),
                    this.verifyBtn = new FX.Button({
                        renderEl: r(".verify-btn", this.$verifyWrapper),
                        style: "white",
                        width: 140,
                        height: 30,
                        text: i18next.t("widget.phone.sms.getCode"),
                        enable: a,
                        onClick: function() {
                            n.isPreviewMode ? FX.Msg.toast({
                                type: "warning",
                                msg: i18next.t("widget.phone.sms.disableInPreview")
                            }) : s._getSmsCode(function() {
                                s._beginTick()
                            })
                        }
                    }))
            },
            resetGetSmsCode: function() {
                var t;
                this._hasSmsVerify() && (this.$verifyWrapper || this._createSmsVerify(),
                    t = this.phoneInput.getValue(),
                this.smsTimer && clearInterval(this.smsTimer),
                    this.isTicking = !1,
                    this.verifyBtn.setText(i18next.t("widget.phone.sms.getCode")),
                    this.verifyBtn.setEnable(this._allowGetSmsCode(t)),
                    this.codeInput.setEnable(!1),
                    this.codeInput.setValue(""),
                    this._setPhoneVerifyState(!1),
                    this._setSmsVerifyState(this.CONST.VF_STATE.DEFAULT))
            },
            _setPhoneVerifyState: function(t) {
                this._hasSmsVerify() && this.$verifyWrapper && ((this.isSmsVerifySuccess = t) ? (this.$verifyWrapper.remove(),
                    this.$verifyWrapper = null,
                    this.$phoneWrapper.addClass("verified")) : this.$phoneWrapper.removeClass("verified"))
            },
            _setSmsVerifyState: function(t) {
                if (this._hasSmsVerify()) {
                    this.isSmsVerifySuccess = !1;
                    var e = this.CONST.VF_STATE;
                    this.$smsVerifyState.empty();
                    var i = r(".verify-input", this.$verifyWrapper);
                    switch (i.addClass("has-state-icon"),
                        t) {
                        case e.PENDING:
                            FX.Utils.createLoadIcon(this.$smsVerifyState, !0),
                                this.codeInput.setEnable(!1);
                            break;
                        case e.SUCCESS:
                            r('<i class="success-icon icon-select"/>').appendTo(this.$smsVerifyState),
                                this.isSmsVerifySuccess = !0;
                            break;
                        case e.FAIL:
                            r('<i class="fail-icon icon-warning-circle"/>').appendTo(this.$smsVerifyState);
                            break;
                        case e.DEFAULT:
                            i.removeClass("has-state-icon")
                    }
                }
            },
            _isSmsVerifySuccess: function() {
                return !!this.isSmsVerifySuccess
            },
            _getSmsCode: function(t) {
                var e = this.options
                    , i = this;
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(e.API.data.get_sms_code),
                    data: r.extend(FX.Utils.applyFunc(this, e.onGetAjaxData, [], {}), {
                        entryId: e.entryId,
                        formId: e.formId,
                        phone: this.phoneInput.getValue(),
                        formWidgetId: this.getWidgetName(),
                        uniqueId: this.getUUID()
                    })
                }, function() {
                    t && t()
                }, function(t) {
                    var e = t.responseJSON || {};
                    FX.Msg.toast({
                        type: "warning",
                        msg: FX.Utils.getErrMsg(e)
                    }),
                    1024 === e.code && i.phoneInput.setErrorState(!0)
                })
            },
            _beginTick: function() {
                var t, e;
                this.$verifyWrapper && (e = 60,
                    (t = this).verifyBtn.setEnable(!1),
                    this.verifyBtn.setText(i18next.t("widget.phone.sms.getCodeAgain", {
                        second: e
                    })),
                    this.codeInput.setEnable(!0),
                    this.codeInput.focus(),
                this.smsTimer && clearInterval(this.smsTimer),
                    this.isTicking = !0,
                    this.smsTimer = setInterval(function() {
                        --e <= 0 ? (clearInterval(t.smsTimer),
                            t.isTicking = !1,
                            t.verifyBtn.setText(i18next.t("widget.phone.sms.getCode")),
                        t._isSmsVerifySuccess() || t.verifyBtn.setEnable(!0)) : t.verifyBtn.setText(i18next.t("widget.phone.sms.getCodeAgain", {
                            second: e
                        }))
                    }, 1e3))
            },
            _allowGetSmsCode: function(t) {
                return !FX.Utils.isEmpty(t) && this._validatePhone(t) && this._hasSmsVerify()
            },
            _allowVerifySmsCode: function(t) {
                return !!FX.Utils.isString(t) && (t.length === this.CONST.SMS_CODE_LEN && this._hasSmsVerify())
            },
            _validatePhone: function(t) {
                if (!FX.Utils.isString(t))
                    return !1;
                var e = this.options
                    , i = t.length === this.CONST.PHONE_NUM_LEN && FX.Utils.startWith(t, "1");
                return e.allowBlank && (i = FX.Utils.isEmpty(t) || i),
                    i
            },
            _validateSmsCode: function(t, e, i) {
                var a = this.options
                    , n = this
                    , s = this.phoneInput.getValue();
                this._setSmsVerifyState(this.CONST.VF_STATE.PENDING),
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(a.API.data.check_sms_code),
                        data: r.extend(FX.Utils.applyFunc(this, a.onGetAjaxData, [], {}), {
                            entryId: a.entryId,
                            phone: s,
                            phoneCode: t,
                            uniqueId: this.getUUID()
                        })
                    }, function() {
                        setTimeout(function() {
                            e && e()
                        }, n.CONST.TIME_OUT)
                    }, function() {
                        setTimeout(function() {
                            i && i()
                        }, n.CONST.TIME_OUT)
                    })
            },
            getUUID: function() {
                return this.UUID || (this.UUID = FX.Utils.UUID()),
                    this.UUID
            },
            checkValidate: function() {
                var t = this.phoneInput.getValue()
                    , e = this._validatePhone(t);
                return e || (this.phoneInput.setErrorState(!0),
                    FX.Utils.isEmpty(t) ? this.setInvalidateType(FX.CONST.INVALID_TYPE.BLANK) : this.setInvalidateType(FX.CONST.INVALID_TYPE.PHONE_REGEX)),
                e && !FX.Utils.isEmpty(t) && this._hasSmsVerify() && ((e = this._isSmsVerifySuccess()) || (this.setInvalidateType(FX.CONST.INVALID_TYPE.SMS),
                this.codeInput.isEnabled() && this._setSmsVerifyState(this.CONST.VF_STATE.FAIL))),
                    e
            },
            getOptions: function() {
                var t = this.options;
                return r.extend(FX.Phone.superclass.getOptions.apply(this, arguments), {
                    noRepeat: t.noRepeat,
                    hasSmsVerify: t.hasSmsVerify,
                    region: t.region
                })
            },
            getValue: function() {
                var t = {
                    phone: this.phoneInput.getValue()
                };
                return this._hasSmsVerify() && (t.uniqueId = this.getUUID()),
                    t
            },
            getCacheValue: function() {
                return {
                    phone: this.phoneInput.getValue()
                }
            },
            setValue: function(t) {
                t = t || {},
                    FX.Phone.superclass.setValue.apply(this, arguments),
                    this.phoneInput.setValue(t.phone),
                    this._setPhoneVerifyState(t.verified);
                var e = this._allowGetSmsCode(t.phone);
                this.verifyBtn && this.verifyBtn.setEnable(e)
            }
        }),
            r.shortcut("phone", FX.Phone)
    }(jQuery),
    function(o) {
        FX.Block = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return o.extend(FX.Block.superclass._defaultConfig.apply(), {
                    title: "",
                    visible4Title: !0,
                    cls4FullScreen: "block-fullscreen",
                    hasHeader: !0,
                    hasBorder: !0,
                    height4Head: 35,
                    height: 230,
                    width: 200,
                    forms: [],
                    filter: null,
                    linkWidgets: null,
                    allowDataLoad: !0,
                    onAfterHeadCreate: null,
                    scalable: !1
                })
            },
            _init: function() {
                FX.Block.superclass._init.apply(this, arguments);
                var t = this.options;
                this.element.addClass("x-block-bg"),
                t.hasBorder || this.element.addClass("no-border"),
                t.hasHeader && this._onCreateHead(),
                    this._onCreateBody()
            },
            _onCreateHead: function() {
                var t, e = this.options;
                return e.height4Head && (this.$head = o('<div class="x-block-head"/>').height(e.height4Head).css({
                    "line-height": e.height4Head + "px"
                }).appendTo(this.element),
                    t = o('<div class="x-block-head-title"/>').appendTo(this.$head),
                e.visible4Title && t.text(e.title)),
                    FX.Utils.applyFunc(this, e.onAfterHeadCreate, [this.$head], !1),
                    this.$head
            },
            createHeadTools: function() {
                var t, e, i = this, a = this.options;
                this.$head.children("a").remove(),
                a.scalable && (t = i18next.t("fullScreen"),
                    e = o("<a />").append('<i class="icon-enlarge">'),
                i.element.hasClass(a.cls4FullScreen) && (e = o("<a />").append('<i class="icon-shrink">'),
                    t = i18next.t("zoomOut")),
                    e.appendTo(this.$head).click(function() {
                        t = i.doFullScreen() ? (e.children("i").removeClass().addClass("icon-shrink"),
                            i18next.t("zoomOut")) : (e.children("i").removeClass().addClass("icon-enlarge"),
                            i18next.t("fullScreen"))
                    }).hover(function() {
                        FX.UI.showPopover({
                            position: "bottomLeft",
                            anchor: o(this).children("i"),
                            content: o("<span/>").text(t),
                            type: "dark"
                        })
                    }, function() {
                        FX.UI.closePopover()
                    }))
            },
            _onCreateBody: function() {
                return this.$body = o('<div class="x-block-body"/>').appendTo(this.element),
                    this._resizeBody(),
                    this._initContent(this.$body),
                    this.$body
            },
            _resizeBody: function() {
                var t, e, i = this.options, a = {};
                FX.Utils.isNumber(i.width) ? (t = i.width,
                i.hasBorder && (t -= 2),
                    a.width = t) : FX.Utils.isNull(i.width) || (a.width = i.width),
                    FX.Utils.isNumber(i.height) ? (e = i.height,
                    i.hasBorder && (e -= 2),
                    i.hasHeader && (e -= i.height4Head),
                        a.height = e,
                        this.$body.addClass("fixed-height")) : FX.Utils.isNull(i.height) ? (this.$body.removeClass("fixed-height"),
                        a.height = "auto") : (this.$body.removeClass("fixed-height"),
                        a.height = i.height),
                    this.$body.css(a)
            },
            _initContent: function(t) {},
            isAllowDataLoad: function() {
                return this.options.allowDataLoad
            },
            setAllowDataLoad: function(t) {
                this.options.allowDataLoad = !!t
            },
            loadingAjax: function(t, i, a) {
                var e, n = this;
                this.isAllowDataLoad() && (this.ajaxObj && this.ajaxObj.abort(),
                    e = this.createLoadingMask(),
                    this.ajaxObj = FX.Utils.dataAjax(t, function(t, e) {
                        return FX.Utils.applyFunc(n, i, [t, e], !1)
                    }, function(t, e) {
                        return FX.Utils.applyFunc(n, a, [t, e], !1)
                    }, function() {
                        e.remove(),
                            n.ajaxObj = null
                    }))
            },
            createLoadingMask: function() {
                return FX.Utils.createMask(this.element, {
                    hasLoader: !0,
                    isLight: !0
                })
            },
            _makeGroups: function(t) {
                function n(t, a) {
                    t.forEach(function(t) {
                        var e = o.extend({}, a)
                            , i = a.tag || a.name;
                        e.groupName = i + "_" + t,
                            e.groupBy = t,
                            s.push(e)
                    })
                }
                var s = [];
                return FX.Utils.forEach(t, function(t, e) {
                    switch (e.type) {
                        case "datetime":
                            var i = e.dateType || "year";
                            n(i.split("&"), e);
                            break;
                        case "address":
                        case "location":
                            var a = e.addressType || "province";
                            n(a.split("&"), e);
                            break;
                        default:
                            s.push(e)
                    }
                }),
                    s
            },
            reload: function(t) {},
            rebuild: function() {
                this.$body.remove(),
                    this._onCreateBody()
            },
            getOptions: function() {
                var t = this.options;
                return o.extend(FX.Block.superclass.getOptions.apply(this, arguments), {
                    title: t.title,
                    linkWidgets: t.linkWidgets,
                    forms: t.forms,
                    filter: t.filter
                })
            },
            _getWidgetNameByTag: function(i) {
                var t = this.options
                    , a = i;
                return FX.Utils.forEach([].concat(t.xFields, t.yFields), function(t, e) {
                    if (e.tag && e.tag === i)
                        return a = e.name,
                            !1
                }),
                    a
            },
            _getLinkFilterParams: function(t) {
                var n = this.options
                    , s = this
                    , r = [];
                return FX.Utils.forEach(t, function(t, a) {
                    var e, i = s._getWidgetNameByTag(a.field);
                    n.relations[i] ? (e = n.relations[i],
                        FX.Utils.forEach(e, function(t, e) {
                            var i = FX.Utils.pick(a, ["method", "type", "value", "keyType"]);
                            o.extend(i, FX.Utils.dealFilterInfoByField({
                                id: t,
                                name: e
                            })),
                                r.push(i)
                        })) : r.push(o.extend(FX.Utils.pick(a, ["method", "type", "value", "keyType"]), FX.Utils.dealFilterInfoByField({
                        id: n.forms[0],
                        name: a.field
                    })))
                }),
                    r
            },
            getFilterData: function(t) {
                var a = this
                    , e = this.options
                    , i = FX.Utils.applyFunc(this, e.onDataFilter, [], !1)
                    , n = [];
                return i && (n = n.concat(i)),
                FX.Utils.isObjectEmpty(t) || FX.Utils.forEach(t, function(t, i) {
                    FX.Utils.forEach(e.forms, function(t, e) {
                        a._isSameEntry(e, i) && n.push(i)
                    })
                }),
                e.filter && "edit" === e.mode && (n = n.concat(e.filter.cond)),
                    FX.Utils.isObjectEmpty(n) ? {} : {
                        cond: n,
                        rel: FX.CONST.FILTER_RELATION.AND
                    }
            },
            _isSameEntry: function(t, e) {
                var i = FX.Utils.getFieldInfoById(t)
                    , a = i.entryId
                    , n = i.appId || e.appId;
                return a === e.entryId && n === e.appId
            },
            doResize: function(t) {
                FX.Block.superclass.doResize.apply(this, arguments),
                    this._resizeBody()
            },
            doFullScreen: function() {
                var t = this.options;
                return this.element.hasClass(t.cls4FullScreen) ? (this.element.removeClass(t.cls4FullScreen),
                    this.doResize({
                        width: FX.Utils.isEmpty(this.originStyle.w) ? "auto" : this.originStyle.w,
                        height: FX.Utils.isEmpty(this.originStyle.h) ? "auto" : this.originStyle.h
                    }),
                    !1) : (this.originStyle = {
                    w: this.element.outerWidth(),
                    h: t.height
                },
                    this.element.addClass(t.cls4FullScreen),
                    this.doResize({
                        width: document.body.clientWidth,
                        height: document.body.clientHeight
                    }),
                    !0)
            }
        })
    }(jQuery),
    function(d) {
        FX.DataTable = FX.extend(FX.Block, {
            _defaultConfig: function() {
                return d.extend(FX.DataTable.superclass._defaultConfig.apply(), {
                    baseCls: "fui_datatable",
                    itemEditable: !1,
                    itemRemovable: !1,
                    itemPrintable: !0,
                    itemsPerPage: 20,
                    filterParam: {},
                    fields: [],
                    data: [],
                    onCheckValid: null,
                    exportable: !0,
                    scalable: !0,
                    tableClass: "x-table",
                    cls4FullScreen: "block-fullscreen",
                    asyncExportURL: FX.Utils.getApi(FX.API.data.list_excel_export),
                    mode: "visit",
                    tabs: [],
                    colorDisable: !1
                })
            },
            _initContent: function(t) {
                FX.DataTable.superclass._initContent.apply(this, arguments);
                var e = this.options;
                this.$wrapper = d('<div class="fui_table-wrapper has-menu"/>').appendTo(t),
                    this.$menu = d('<div class="fui-table-menu"/>').appendTo(t),
                    this.sort = [],
                    this.page = 0,
                    this.count = null,
                    this.filterParam = e.filterParam,
                    this.hasCheck = !1,
                    this._initDataTable()
            },
            _initDataTable: function() {
                var e = this
                    , t = this.options;
                t.itemEditable && e._isMultiForm() && (t.itemEditable = !1),
                t.itemRemovable && e._isMultiForm() && (t.itemRemovable = !1),
                    this.tableRowHead = [],
                    this._loadData(function(t) {
                        e.header = e._filterFields(t.header),
                            e.createTable(e.header, t.data)
                    })
            },
            _isMultiForm: function() {
                var t = this.options;
                return 1 < t.forms.length || !FX.Utils.isObjectEmpty(t.relations)
            },
            _loadData: function(e) {
                this._isFieldsValid() && this.loadingAjax(this._getAsync(!1), function(t) {
                    e && e(t)
                }, function(t) {
                    var e = t.responseJSON || {};
                    FX.Utils.isEmpty(e.code) || FX.Msg.toast({
                        type: "warning",
                        msg: FX.Utils.getErrMsg(e)
                    })
                })
            },
            _getAsync: function(t) {
                var e = this.options
                    , i = {}
                    , a = this.getFilterData(this.filterParam);
                switch (e.mode) {
                    case "edit":
                        i.url = FX.Utils.getApi(FX._API.report.preview_list),
                            i.data = {
                                fields: e.fields,
                                forms: e.forms,
                                relations: e.relations,
                                filter: a
                            };
                        break;
                    case "visit":
                        i.url = FX.Utils.getApi(FX.API.data.list),
                            i.data = {
                                widgetId: e.widgetName,
                                filter: a
                            };
                        break;
                    case "query":
                        t ? (i.url = FX.Utils.getApi(FX.API.data.count),
                            i.data = {
                                filter: a,
                                hasLimit: !1,
                                hasTotalCount: !1
                            }) : (i.url = FX.Utils.getApi(FX.API.data.query),
                            i.data = {
                                filter: a
                            })
                }
                return t ? d.extend(i.data, {
                    isCountOnly: !0
                }) : d.extend(i.data, {
                    sort: this.sort,
                    skip: this.page * e.itemsPerPage,
                    limit: e.itemsPerPage
                }),
                    i
            },
            _filterFields: function(t) {
                var i = [];
                return FX.Utils.forEach(t, function(t, e) {
                    "formula" === e.type && !e.enable || i.push(e)
                }),
                    i
            },
            _isFieldsValid: function() {
                var t = this.options;
                if (-1 < ["query"].indexOf(t.mode))
                    return !0;
                var e = !0;
                return e &= t.forms && 0 < t.forms.length,
                    e &= t.fields && 0 < t.fields.length,
                    FX.Utils.applyFunc(this, t.onCheckValid, [], !1),
                    e
            },
            createTable: function(t, e) {
                var i = this;
                this.processor = new FX.DataTableProcessor({
                    header: t,
                    data: e,
                    sort: this.sort,
                    hasCheck: this.hasCheck,
                    supportFormulaSort: !0,
                    colorDisable: this.options.colorDisable
                }),
                    this.table ? this.table.reload(this._getTableRenderData()) : this.table = this._doCreateTable(),
                    this._loadCount(function() {
                        i._createPagination()
                    })
            },
            _doCreateTable: function() {
                var i = this;
                return new FX.PlainTable(d.extend({
                    renderEl: this.$wrapper,
                    isHeadSticky: !0,
                    isRowHeadSticky: !0,
                    height: "auto",
                    onHeadCellClick: function(t) {
                        t.hasClass("sortable") && i._sortTable(t)
                    },
                    onMouseOverRow: function(t) {
                        var e = t.attr("data-idx");
                        FX.Utils.isNull(e) || d('tbody > tr[data-idx="' + e + '"]', i.$wrapper).addClass("hover")
                    },
                    onMouseOutRow: function(t) {
                        var e = t.attr("data-idx");
                        FX.Utils.isNull(e) || d('tbody > tr[data-idx="' + e + '"]', i.$wrapper).removeClass("hover")
                    },
                    onRowCreate: function(t, e) {
                        t.attr("data-idx", i.processor.getDataIdxByRow(e))
                    },
                    onRowClick: function(t) {
                        FX.Utils.getSelectionText() || i._doShowData(t.data("idx"))
                    }
                }, this._getTableRenderData()))
            },
            _getTableRenderData: function() {
                return this.processor.getTable()
            },
            _sortTable: function(t) {
                var e, i, a, n = t.data("field");
                n && (e = {},
                    i = this.getSortedFieldIdx(n),
                    a = FX.CONST.SORT,
                    t.hasClass("sort-asc") ? (t.removeClass("sort-asc").addClass("sort-desc"),
                        e[n] = a.DESC,
                        -1 < i ? this.sort[i] = e : this.sort.push(e)) : t.hasClass("sort-desc") ? (t.removeClass("sort sort-desc"),
                    -1 < (i = this.getSortedFieldIdx(n)) && this.sort.splice(i, 1)) : (t.removeClass("sort-desc").addClass("sort sort-asc"),
                        i = this.getSortedFieldIdx(n),
                        e[n] = a.ASC,
                        -1 < i ? this.sort[i] = e : this.sort.push(e)),
                    this.page = 0,
                    this._reloadWithoutCount())
            },
            _loadCount: function(t) {
                var e, i = this;
                FX.Utils.isNull(this.count) ? ((e = this._getAsync(!0)).timeout = FX.CONST.DATA_COUNT_TIMEOUT,
                    e.data.hasCountLimit = !0,
                    FX.Utils.dataAjax(e, function(t) {
                        i.count = t.count
                    }, function() {}, function() {
                        FX.Utils.applyFunc(i, t, [], null)
                    })) : FX.Utils.applyFunc(i, t, [], null)
            },
            _createPagination: function() {
                var a = this
                    , e = this.options;
                this.$menu.empty(),
                    new FX.Pagination({
                        renderEl: d("<div />").appendTo(this.$menu),
                        count: a.count,
                        limit: e.itemsPerPage,
                        curPage: a.page + 1,
                        showCount: !0,
                        hasMore: this.hasMore(),
                        onChangePage: function(t) {
                            a.page = t - 1,
                                a.turnPage()
                        },
                        onLimitChange: function(t) {
                            e.itemsPerPage = t,
                                a.page = 0,
                                a._reloadWithoutCount()
                        },
                        fetchCount: function(e) {
                            var i = this
                                , t = a._getAsync(!0);
                            t.data.hasCountLimit = !1,
                                FX.Utils.dataAjax(t, function(t) {
                                    a.count = t.count,
                                        FX.Utils.applyFunc(i, e, [t.count], null)
                                }, function() {
                                    FX.Utils.applyFunc(i, e, [], null)
                                })
                        }
                    })
            },
            _doShowData: function(t, e) {
                var i, a, n, s, r, o, l, c = this.processor.getDataByIdx(t);
                c && (i = this.options,
                    a = this,
                    n = c._id,
                    s = this.header,
                    r = i.title,
                    this._switchCurrentRow(t),
                    o = d('<div class="x-window-mask modal light"/>').css({
                        "z-index": FX.STATIC.zIndex++
                    }).appendTo("body"),
                    d(document).bind("keydown.left keydown.right", function(t) {
                        return d(".x-window-mask", "body").length ? (t.preventDefault(),
                            !1) : void d(document).unbind("keydown.left keydown.right")
                    }),
                    l = new FX.ReportFormDataPane({
                        appId: FX.STATIC.APPID,
                        renderEl: d("<div class='x-shadow-content'/>").appendTo(o),
                        entryId: FX.STATIC.ENTRYID,
                        formId: i.forms[0],
                        widgetId: i.widgetName,
                        isMultiForm: this._isMultiForm(),
                        forms: i.forms,
                        header: s,
                        data: c,
                        dataId: n,
                        title: r,
                        height: "100%",
                        hasPrintBtn: i.itemPrintable,
                        hasEditBtn: "visit" === i.mode && i.itemEditable,
                        hasDeleteBtn: "visit" === i.mode && i.itemRemovable,
                        hasSwitchBtn: !0,
                        hasCustomPrint: !1,
                        dataIndex: t + 1,
                        dataCount: this.processor.getDataCount(),
                        tabs: i.tabs,
                        colorDisable: this.options.colorDisable,
                        onEditData: function() {
                            o.remove()
                        },
                        onAfterEditData: function() {
                            a._reloadWithoutCount(null, !0)
                        },
                        onSwitchData: function(t, e) {
                            a.processor.getDataByIdx(t - 1) && o.parent().length && (o.remove(),
                                a._doShowData(t - 1, e))
                        },
                        onAfterDeleteData: function() {
                            a.turnPage(),
                                o.remove()
                        },
                        onAfterCancel: function() {
                            o.remove(),
                                a._doShowData(t)
                        },
                        onClose: function(t) {
                            o.remove(),
                            t && a.reload(null, !0)
                        }
                    }),
                e && (o.remove(),
                    l._doEditData()))
            },
            _switchCurrentRow: function(t) {
                d("tbody > tr", this.element).removeClass("current-row"),
                    d('tbody > tr[data-idx="' + t + '"]', this.element).addClass("current-row")
            },
            doExcelExport: function() {
                var i, t = this.options;
                this._isFieldsValid() && (i = this.createLoadingMask(),
                    FX.Utils.dataAjax({
                        url: t.asyncExportURL,
                        data: {
                            widgetId: t.widgetName,
                            filter: this.getFilterData(this.filterParam),
                            sort: this.sort
                        }
                    }, function(t) {
                        i.remove(),
                            window.location.href = t.url
                    }, function(t) {
                        i.remove();
                        var e = t.responseJSON || {};
                        FX.Msg.toast({
                            type: "error",
                            msg: FX.Utils.getErrMsg(e) || i18next.t("export.failTip")
                        })
                    }))
            },
            turnPage: function() {
                this._initDataTable()
            },
            reload: function(t, e, i) {
                FX.DataTable.superclass.reload.apply(this, arguments),
                e || (this.page = 0),
                i || (this.count = null),
                    this._setFilterParam(t),
                    this._initDataTable()
            },
            rebuild: function() {
                this.$body.remove(),
                    this.table = null,
                    this._onCreateBody()
            },
            _setFilterParam: function(t) {
                FX.Utils.isNull(t) || (this.filterParam = t)
            },
            _reloadWithoutCount: function(t, e) {
                this.reload(t, e, !0)
            },
            hasMore: function() {
                var t = this.options;
                return this.processor.getDataCount() >= t.itemsPerPage
            },
            setHasCheck: function(t) {
                this.hasCheck = t,
                    this.processor.setHasCheck(t),
                    this.refresh()
            },
            getCheckResult: function() {
                return this.table.getCheckResult()
            },
            createHeadTools: function() {
                FX.DataTable.superclass.createHeadTools.apply(this, arguments);
                var t = this
                    , e = this.options;
                e.exportable && d("<a/>").append('<i class="icon-export">').append(d("<span/>").text(i18next.t("export.excel"))).appendTo(this.$head).click(function() {
                    t.doExcelExport()
                }),
                e.itemRemovable && d("<a/>").append('<i class="icon-trasho">').append(d("<span/>").text(i18next.t("delete.multi"))).appendTo(this.$head).click(function() {
                    t.createTableDeleteButtons()
                })
            },
            createTableDeleteButtons: function() {
                var e = this;
                this.setHasCheck(!0),
                    this.$head.children("a").remove(),
                    d("<a />").append('<i class="icon-signout">').append(d("<span />").text(i18next.t("dataTable.editor.exit"))).appendTo(this.$head).click(function() {
                        e.setHasCheck(!1),
                            e.createHeadTools()
                    }),
                    d("<a />").append('<i class="icon-trasho">').append(d("<span />").text(i18next.t("delete.selected"))).appendTo(this.$head).click(function() {
                        var t = e.getCheckResult().length;
                        e.deleteCheckResult(!1, t)
                    }),
                    d("<a />").append('<i class="icon-broom">').append(d("<span />").text(i18next.t("data.clear"))).appendTo(this.$head).click(function() {
                        e.deleteCheckResult(!0)
                    })
            },
            refresh: function() {
                this.table.reload(this._getTableRenderData())
            },
            deleteCheckResult: function(n, t, s) {
                var e, i, r = this, o = this.options;
                FX.Vip.hasDataBackup() ? e = n ? i18next.t("dataTable.deleteAllTip") : i18next.t("dataTable.deleteTip", {
                    length: '<span class="text warning" >' + t + "</span>"
                }) : (e = n ? i18next.t("dataTable.deleteAllTipForFree") : i18next.t("dataTable.deleteTipForFree", {
                    length: '<span class="text warning" >' + t + "</span>"
                }),
                    i = d('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                    FX.Msg.alert({
                        title: n ? i18next.t("dataTable.deleteAllDataTip") : i18next.t("dataTable.deleteAllSelectDataTip"),
                        msg: e,
                        tip: i,
                        type: "warning",
                        onOk: function() {
                            var t, e, i = {
                                formId: o.forms[0],
                                widgetId: o.widgetName
                            }, a = !0;
                            n ? (i.clearAll = !0,
                                i.filter = r.getFilterData(this.filterParam)) : (t = r.getCheckResult()) && 0 < t.length ? i.idList = t : a = !1,
                            a && (e = function(t) {
                                !1 === FX.Utils.applyFunc(r, s, [t.count], !1) && (r.setHasCheck(!1),
                                    r.createHeadTools(),
                                    r.reload())
                            }
                                ,
                                FX.Socket.onBatchRemoveDataDone(e),
                                FX.Utils.dataAjax({
                                    url: FX.Utils.getApi(FX.API.data.report_remove),
                                    data: i
                                }, function(t) {
                                    t.hasAsyncTask || e(t)
                                }, function(t) {
                                    var e = t.responseJSON || {};
                                    FX.Msg.toast({
                                        type: "warning",
                                        msg: FX.Utils.dealServerErrMsg(e)
                                    })
                                }))
                        }
                    })
            },
            getSortedFieldIdx: function(i) {
                var a = -1;
                return FX.Utils.forEach(this.sort, function(t, e) {
                    if (e)
                        return e[i] ? (a = t,
                            !1) : void 0
                }),
                    a
            },
            doResize: function(t) {
                FX.DataTable.superclass.doResize.apply(this, arguments),
                this.table && this.table.doResize()
            },
            getOptions: function() {
                var t = this.options;
                return d.extend(FX.DataTable.superclass.getOptions.apply(this, arguments), {
                    relations: t.relations,
                    joinedFields: t.joinedFields,
                    fields: t.fields,
                    exportable: t.exportable,
                    itemEditable: t.itemEditable,
                    itemRemovable: t.itemRemovable
                })
            }
        }),
            d.shortcut("datatable", FX.DataTable)
    }(jQuery),
    function(d) {
        FX.CombinedTable = FX.extend(FX.Block, {
            GROUP_DICT: {
                year: i18next.t("year"),
                quarter: i18next.t("quarter"),
                month: i18next.t("month"),
                week: i18next.t("week"),
                day: i18next.t("day"),
                province: i18next.t("province"),
                city: i18next.t("city")
            },
            GROUP_TYPE: ["address", "location", "datetime"],
            _defaultConfig: function() {
                return d.extend(FX.CombinedTable.superclass._defaultConfig.apply(), {
                    baseCls: "fui_combinedtable",
                    hasMenu: !0,
                    isHeadSticky: !0,
                    isRowHeadSticky: !0,
                    chunkSize: 50,
                    forms: [],
                    relations: {},
                    joinedFields: [],
                    xFields: [],
                    yFields: [],
                    valueFields: [],
                    asyncExportURL: FX.Utils.getApi(FX.API.data.excel_export),
                    onItemClick: null,
                    exportable: !0,
                    scalable: !0,
                    hasSummaryRow: !0,
                    mode: "visit"
                })
            },
            _initContent: function(t) {
                FX.CombinedTable.superclass._initContent.apply(this, arguments),
                    this.$wrapper = d('<div class="fui_table-wrapper"/>').appendTo(t),
                    this.$wrapper.addClass("has-menu"),
                    this.$menu = d('<div class="fui-table-menu"/>').appendTo(t),
                    this._initCombinedTable()
            },
            _shouldShowSummaryRow: function() {
                return this.options.hasSummaryRow
            },
            createHeadTools: function() {
                FX.CombinedTable.superclass.createHeadTools.apply(this, arguments);
                var t = this;
                this.options.exportable && d("<a/>").append('<i class="icon-export">').append(d("<span/>").text(i18next.t("export.excel"))).appendTo(this.$head).click(function() {
                    t.doExcelExport()
                })
            },
            _initCombinedTable: function(t) {
                var e, i, a = this, n = this.options;
                this.filterParam = t,
                    this.tableHead = [],
                    this.tableRowHead = [],
                    this.tableData = [],
                    this.rowCount = 0,
                    this.page = 1,
                    this._isFieldsValid() ? (this._initFormatMap(),
                        this.xGroups = this._makeGroups(n.xFields),
                        this.yGroups = this._makeGroups(n.yFields),
                        i = "edit" === n.mode ? (e = FX.Utils.getApi(FX._API.report.preview_combined_group),
                            {
                                forms: n.forms,
                                relations: n.relations,
                                xFields: this.xGroups,
                                yFields: this.yGroups,
                                valFields: n.valueFields,
                                linkWidgets: n.linkWidgets,
                                onlyGroup: !n.hasSummaryRow,
                                filter: this.getFilterData(this.filterParam)
                            }) : (e = FX.Utils.getApi(FX.API.data.combined_group),
                            {
                                widgetId: n.widgetName,
                                onlyGroup: !n.hasSummaryRow,
                                filter: this.getFilterData(this.filterParam)
                            }),
                        this.loadingAjax({
                            url: e,
                            data: i
                        }, function(t) {
                            a._isTableEmpty(t) ? (this.tableHead = [],
                                this.rowHeadChunks = [],
                                this.dataChunks = []) : (a._dealTableInfo(t),
                                a.rowCount = a.tableData.length,
                                a._chunkTable()),
                                a.createTable()
                        })) : this.createTable()
            },
            _initFormatMap: function() {
                var i = this
                    , t = this.options;
                this.formatMap = {},
                    FX.Utils.forEach(t.valueFields, function(t, e) {
                        e.cellFmt && (i.formatMap[i._getFieldTag(e)] = e.cellFmt.data)
                    })
            },
            _getFormattedCellText: function(t, e) {
                var i = t;
                if (e.isPercent)
                    return i;
                var a = this.formatMap[this._getFieldTag(e)]
                    , i = FX.Utils.fixDecimalPrecision(t);
                return a && (i = FX.Utils.num2Str(i, a)),
                    i
            },
            _isTableEmpty: function(t) {
                return 0 === t.data.x.length && 0 === t.data.val.length
            },
            createTable: function() {
                this.table ? this.table.reload(this._getPageData()) : this.table = this._doCreateTable(),
                    this._createPagination()
            },
            _doCreateTable: function() {
                var n = this
                    , s = this.options;
                return new FX.PlainTable(d.extend({
                    renderEl: this.$wrapper,
                    isHeadSticky: s.isHeadSticky,
                    isRowHeadSticky: s.isRowHeadSticky,
                    height: "auto",
                    onCellClick: function(t) {
                        var e, i, a = t.data("id");
                        a && (e = n._getGroupIdCondition(a),
                            i = n._getLinkParams(e),
                            i = n._getLinkFilterParams(i),
                            FX.Utils.applyFunc(n, s.onItemClick, [i], !1))
                    }
                }, this._getPageData()))
            },
            _dealTableInfo: function(t) {
                var e = this.options;
                this.colDataArr = [],
                    this.rowDataArr = [],
                    this.rowHeadTitleRows = this._hasSubGroup(e.xFields) ? 2 : 1;
                var i = this._hasSubGroup(e.yFields) ? 2 : 1;
                this.xGroupLen = this._getXGroupLength(),
                    this.rowHeadTitleCols = Math.max(i, this.xGroupLen);
                for (var a = this.yGroups.length + this.rowHeadTitleRows, n = 0; n < a; n++)
                    this.tableHead.push([]);
                this._createColHeadTitle(),
                    this._createRowHeadTitle(),
                    this._createRowHead(t),
                    this._dealDetail(t),
                    this._createColHeadAndData(t)
            },
            _getXGroupLength: function() {
                var i = this.xGroups.length;
                return FX.Utils.forEach(this.xGroups, function(t, e) {
                    e.detail && (i += e.detail.fields.length)
                }),
                    i
            },
            _chunkTable: function() {
                var s = this
                    , a = this.options;
                this.rowHeadChunks = [],
                    FX.Utils.forEach(this.tableRowHead, function(t, e) {
                        var n = null
                            , i = FX.Utils.chunkArray(e, a.chunkSize);
                        FX.Utils.forEach(i, function(t, e) {
                            n && n.rowspan && (e[0] = n);
                            for (var i = e.length - 1; 0 <= i; i--) {
                                var a = e[i];
                                if (a) {
                                    a.rowspan >= e.length - i && (n = d.extend({}, a),
                                        a.rowspan = e.length - i,
                                        n.rowspan -= a.rowspan);
                                    break
                                }
                            }
                            s.rowHeadChunks[t] = s.rowHeadChunks[t] || [],
                                s.rowHeadChunks[t].push(e)
                        })
                    }),
                    this.dataChunks = FX.Utils.chunkArray(this.tableData, a.chunkSize);
                var t = this._getPageData();
                this.tableHead = t.tableHead,
                    this.tableRowHead = t.tableRowHead,
                    this.tableData = t.tableData
            },
            _getPageData: function() {
                return {
                    tableHead: this.tableHead,
                    tableRowHead: FX.Utils.isObjectEmpty(this.rowHeadChunks) ? [] : this.rowHeadChunks[this.page - 1],
                    tableData: FX.Utils.isObjectEmpty(this.dataChunks) ? [] : this.dataChunks[this.page - 1]
                }
            },
            _hasSubGroup: function(t) {
                var i = this
                    , a = !1;
                return FX.Utils.forEach(t, function(t, e) {
                    if (-1 < i.GROUP_TYPE.indexOf(e.type))
                        return !(a = !0)
                }),
                    a
            },
            _createColHeadTitle: function() {
                var a, n = this;
                FX.Utils.forEach(this.yGroups, function(t, e) {
                    var i = n.tableHead[t];
                    -1 < n.GROUP_TYPE.indexOf(e.type) ? (a && a.text === e.text ? a.rowspan += 1 : (a = {
                        rowspan: 1,
                        colspan: n.rowHeadTitleCols - 1,
                        text: e.text,
                        cls: "group-head"
                    },
                        i.push(a)),
                        i.push({
                            text: n.GROUP_DICT[e.groupBy],
                            cls: "group-head"
                        })) : i.push({
                        rowspan: 1,
                        colspan: n.rowHeadTitleCols,
                        text: e.text,
                        cls: "group-head"
                    })
                })
            },
            _createRowHeadTitle: function() {
                var i, a = this, n = this.tableHead[a.yGroups.length], s = this.tableHead[a.yGroups.length + 1], r = 1;
                this.xGroupLen < this.rowHeadTitleCols && (r = this.rowHeadTitleCols),
                this.xGroups.length || n.push({
                    colspan: this.rowHeadTitleCols,
                    cls: "group-head"
                }),
                    FX.Utils.forEach(this.xGroups, function(t, e) {
                        -1 < a.GROUP_TYPE.indexOf(e.type) ? (i && i.text === e.text ? i.colspan += 1 : (i = {
                            rowspan: 1,
                            colspan: r,
                            text: e.text,
                            cls: "group-head"
                        },
                            n.push(i)),
                            s.push({
                                rowspan: 1,
                                colspan: r,
                                text: a.GROUP_DICT[e.groupBy],
                                cls: "group-head"
                            })) : (n.push({
                            rowspan: a.rowHeadTitleRows,
                            colspan: r,
                            text: e.text,
                            cls: "group-head"
                        }),
                        e.detail && FX.Utils.forEach(e.detail.fields, function(t, e) {
                            n.push({
                                rowspan: a.rowHeadTitleCols,
                                colspan: r,
                                text: e.text,
                                cls: "group-head"
                            })
                        }))
                    })
            },
            _createColHeadAndData: function(r) {
                for (var o = this, t = this.options, l = r.data.val, e = l[0].data.length, c = this.tableHead, d = this.tableData, i = 0; i < e; i++)
                    d.push([]);
                var u = [];
                t.hasSummaryRow && d.push(u);
                var h = null;
                FX.Utils.forEach(l, function(a, n) {
                    n.is_summary_col && o.yGroups.length && (h ? h.colspan += 1 : (h = {
                        text: i18next.t("gather"),
                        rowspan: o.yGroups.length,
                        colspan: 1
                    },
                        c[0].push(h)));
                    var s = !0;
                    FX.Utils.forEach(n.y, function(t, e) {
                        var i = o._getLastCell(c[t]);
                        (s = 0 !== a && (s && l[a - 1].y[t] === e)) ? i.colspan += 1 : c[t].push({
                            colspan: 1,
                            text: o._getGroupText(e, o.yGroups[t], r),
                            data: {
                                id: o._getColHeadCellData(n.y, t)
                            },
                            cls: "clickable"
                        })
                    }),
                        c[o.yGroups.length].push({
                            rowspan: o.rowHeadTitleRows,
                            text: n.text
                        }),
                        FX.Utils.forEach(n.data, function(t, e) {
                            var i = {}
                                , i = FX.Utils.isNull(e) ? {
                                text: "-",
                                cls: "h-right"
                            } : {
                                field: o._getFieldTag(n),
                                isPercent: n.isPercent,
                                text: o._getFormattedCellText(e, n),
                                cls: "h-right clickable",
                                data: {
                                    id: o._getCellData(r, t, a)
                                }
                            };
                            d[t].push(i)
                        }),
                    o._shouldShowSummaryRow() && u.push({
                        field: n.tag,
                        text: o._getFormattedCellText(n.sum, n),
                        isPercent: n.isPercent,
                        cls: "h-right clickable",
                        data: {
                            id: o._getColHeadCellData(n.y, n.y.length - 1)
                        }
                    })
                })
            },
            _getColHeadCellData: function(t, e) {
                for (var i = {}, a = 0; a <= e; a++) {
                    var n = this.yGroups[a];
                    i[n.groupName || n.tag] = t[a]
                }
                return i
            },
            _getRowHeadCellData: function(t, e, i) {
                for (var a = {}, n = 0; n <= i; n++) {
                    var s = this.xGroups[n];
                    a[s.groupName || s.tag || s.name] = t[n].data[e]
                }
                return a
            },
            _getCellData: function(t, e, i) {
                var a = this.colDataArr[i]
                    , n = this.rowDataArr[e];
                return a || (a = this._getColHeadCellData(t.data.val[i].y, this.yGroups.length - 1),
                    this.colDataArr[i] = a),
                n || (n = this._getRowHeadCellData(t.data.x, e, this.xGroups.length - 1),
                    this.rowDataArr[e] = n),
                    d.extend({}, n, a)
            },
            _createRowHead: function(o) {
                var l = this
                    , c = o.data.x
                    , d = this.tableRowHead;
                if (c.length)
                    for (var t = 0; t < c.length; t++)
                        d.push([]);
                else
                    d.push([]);
                FX.Utils.forEach(c, function(n, s) {
                    var r = null;
                    FX.Utils.forEach(s.data, function(t, e) {
                        var i, a = !1;
                        0 < t && (a = s.data[t - 1] === e,
                        0 < n && (a = a && FX.Utils.isNull(d[n - 1][t]))),
                            a ? (r.rowspan += 1,
                                d[n].push(null)) : (i = 1,
                            l.xGroupLen < l.rowHeadTitleCols && (i = l.rowHeadTitleCols),
                                r = {
                                    colspan: i,
                                    rowspan: 1,
                                    text: l._getGroupText(e, l.xGroups[n], o),
                                    data: {
                                        id: l._getRowHeadCellData(c, t, n)
                                    },
                                    cls: "clickable"
                                },
                                d[n].push(r))
                    })
                }),
                this._shouldShowSummaryRow() && d[0].push({
                    text: i18next.t("gather"),
                    colspan: this.rowHeadTitleCols
                })
            },
            _dealDetail: function(o) {
                var l = this
                    , c = 0;
                FX.Utils.forEach(this.xGroups, function(e, t) {
                    var i = t.detail;
                    if (!i)
                        return !1;
                    var r = e + c;
                    FX.Utils.forEach(i.fields, function(t, a) {
                        var n = o.details[i.entry]
                            , s = [];
                        FX.Utils.forEach(l.tableRowHead[r], function(t, e) {
                            var i = null;
                            e && n[e.text] && (i = d.extend({}, e, {
                                text: n[e.text][a.name]
                            })),
                                s.push(i)
                        }),
                            c++,
                            l.tableRowHead.splice(e + c, 0, s)
                    })
                })
            },
            _getGroupText: function(t, e, i) {
                var a = t;
                switch (e.type) {
                    case "user":
                    case "id":
                        var n = i.user[t]
                            , a = n ? n.nickname : t;
                        break;
                    case "dept":
                    case "did":
                        var s = i.department[t];
                        a = s ? s.name : t
                }
                return a
            },
            doExcelExport: function() {
                var t = this.options;
                this._isFieldsValid() && FX.Utils.dataAjax({
                    url: t.asyncExportURL,
                    data: {
                        widgetId: t.widgetName,
                        filter: this.getFilterData(this.filterParam)
                    }
                }, function(t) {
                    window.location.href = t.url
                }, function(t) {
                    var e = t.responseJSON || {};
                    FX.Msg.toast({
                        type: "error",
                        msg: FX.Utils.getErrMsg(e) || i18next.t("export.failTip")
                    })
                })
            },
            _createPagination: function() {
                var e = this
                    , t = this.options;
                this.$menu.empty(),
                    new FX.Pagination({
                        renderEl: d("<div />").appendTo(this.$menu),
                        count: this.rowCount,
                        limit: t.chunkSize,
                        curPage: this.page,
                        hasTurnLast: !0,
                        onChangePage: function(t) {
                            e.page = t,
                                e.turnPage()
                        }
                    })
            },
            turnPage: function() {
                d.extend(this, this._getPageData()),
                    this.createTable()
            },
            _getLastCell: function(t) {
                return t.length ? t[t.length - 1] : null
            },
            _isFieldsValid: function() {
                var t = this.options
                    , e = !0;
                return e &= 0 < t.forms.length,
                    e &= 0 !== t.valueFields.length,
                    e &= 0 !== t.xFields.length || 0 !== t.yFields.length,
                    FX.Utils.applyFunc(this, t.onCheckValid, [], !1),
                    e
            },
            _getGroupIdCondition: function(t) {
                var e, i, a, n = {};
                for (var s in t) {
                    t.hasOwnProperty(s) && ((e = (a = s).match(/(createTime|updateTime|\d{13})_([a-zA-Z]+)/)) && 1 < e.length ? (i = e[e.length - 1],
                        a = s.replace("_" + i, ""),
                    n.hasOwnProperty(a) || (n[a] = {}),
                        n[a][i] = t[s]) : n[a] = t[s])
                }
                return n
            },
            _getLinkParams: function(a) {
                var n = this;
                if (a) {
                    var s = [];
                    return FX.Utils.forEach(a, function(t) {
                        var e = n._getFieldByName(t)
                            , i = a[t];
                        switch (e.type) {
                            case "datetime":
                                i = FX.Utils.getDateRange(i);
                                break;
                            case "address":
                            case "location":
                                i = FX.Utils.getArrayFromRange(i, "address")
                        }
                        s.push(d.extend(FX.Utils.getLinkFilter(e, i), {
                            field: e.name
                        }))
                    }),
                        s
                }
            },
            _getFieldByName: function(i) {
                var t = this.options
                    , e = [].concat(t.xFields, t.yFields)
                    , a = null;
                return FX.Utils.forEach(e, function(t, e) {
                    if ((e.tag || e.name) === i)
                        return a = e,
                            !1
                }),
                    a
            },
            reload: function(t) {
                this.page = 1,
                    this._initCombinedTable(t)
            },
            getOptions: function() {
                var t = this.options;
                return d.extend(FX.CombinedTable.superclass.getOptions.apply(this, arguments), {
                    isHeadSticky: t.isHeadSticky,
                    isRowHeadSticky: t.isRowHeadSticky,
                    forms: t.forms,
                    relations: t.relations,
                    joinedFields: t.joinedFields,
                    xFields: t.xFields,
                    yFields: t.yFields,
                    valueFields: t.valueFields,
                    exportable: t.exportable
                })
            },
            refresh: function() {
                this.table.reload(this._getPageData())
            },
            doResize: function(t) {
                FX.CombinedTable.superclass.doResize.apply(this, arguments),
                this.table && this.table.doResize()
            },
            rebuild: function() {
                this.$body.remove(),
                    this.table = null,
                    this.rowHeadChunks = [],
                    this.dataChunks = [],
                    this._onCreateBody()
            },
            _getFieldTag: function(t) {
                var e = t.tag || t.name;
                return t.isPercent && (e += "_percent"),
                    e
            },
            rebuildStickyHead: function() {
                this.table && this.table.rebuildStickyHead()
            }
        }),
            d.shortcut("combinedtable", FX.CombinedTable)
    }(jQuery),
    function(v) {
        FX.Parameter = FX.extend(FX.Block, {
            _defaultConfig: function() {
                return v.extend(FX.Parameter.superclass._defaultConfig.apply(), {
                    baseCls: "fui_parameter",
                    API: FX.API,
                    distinctUrl: FX.Utils.getApi(FX.API.data.distinct_report),
                    height: null,
                    width: null,
                    fields: [],
                    colorEnable: !1,
                    hasSelectEmpty: !0,
                    showFields: null,
                    filter: null,
                    authGroupId: null,
                    onBeforeConvertField: null,
                    onStopEdit: null,
                    onAfterShowFieldsSelected: null
                })
            },
            _initContent: function(t) {
                FX.Parameter.superclass._initContent.apply(this, arguments);
                var e = this.options
                    , i = this;
                this.fieldMap = {};
                var a = this._dealFields(e.fields);
                FX.Utils.forEach(a, function(t, e) {
                    i._createItem(e)
                })
            },
            _dealFields: function(t) {
                var a = [];
                return FX.Utils.forEach(t, function(t, i) {
                    "subform" === i.type ? FX.Utils.forEach(i.items, function(t, e) {
                        a.push(v.extend({}, e, {
                            text: [i.text, e.text].join("."),
                            name: [i.name, e.name].join(".")
                        }))
                    }) : a.push(i)
                }),
                    a
            },
            setFields: function(i) {
                var t = this.options
                    , a = []
                    , e = this._dealFields(t.showFields);
                FX.Utils.forEach(e, function(t, e) {
                    0 <= i.indexOf(e.name) && a.push(e)
                }),
                    t.fields = a,
                    this.rebuild()
            },
            _createItem: function(e) {
                var t, i = this.options, a = this, n = v('<div class="fui_parameter_cell"/>').appendTo(this.$body), s = a.getConfigFromItem(e);
                s && (v('<div class="cell-title"/>').text(s.title).appendTo(n),
                    s.renderEl = v("<div/>").appendTo(n),
                    s.onStopEdit = function() {
                        var t = JSON.stringify(this.getValue());
                        this.oldValue && this.oldValue == t || (this.oldValue = t,
                            FX.Utils.applyFunc(a, i.onStopEdit, [e.id], !1))
                    }
                    ,
                    t = FX.createWidget(s),
                    n.data("widget", t),
                    this.fieldMap[t.getWidgetName()] = e)
            },
            _resizeBody: function() {},
            getConfigFromItem: function(t) {
                var e = this.options
                    , i = {
                    title: t.text,
                    value: this._parseDefaultValue(t)
                };
                if (!1 === FX.Utils.applyFunc(this, e.onBeforeConvertField, [i, t], !1))
                    switch (t.type) {
                        case "text":
                        case "radiogroup":
                        case "combo":
                        case "sn":
                            "creator" === t.name ? v.extend(i, this._getUserConfig(t)) : v.extend(i, this._getComboConfig(t)),
                            "radiogroup" !== t.type && "combo" !== t.type || (i.colorEnable = e.colorEnable && t.colorEnable,
                            i.colorEnable && (i.colorMap = FX.Utils.getColorMapByItem(t)));
                            break;
                        case "number":
                            i.type = "numberlimit";
                            break;
                        case "datetime":
                            i.type = "datelimit",
                                i.format = t.format || "yyyy-MM-dd",
                                i.width4date = 180;
                            break;
                        case "address":
                            i.type = "address",
                                i.needDetail = !1;
                            break;
                        case "phone":
                            i.type = "phone";
                            break;
                        case "dept":
                            i.type = "deptselect",
                                i.API = e.API,
                                i.limit = this._getComboConfig(t).async;
                            break;
                        case "user":
                            v.extend(i, this._getUserConfig(t));
                            break;
                        default:
                            "creator" === t.name && v.extend(i, this._getUserConfig(t))
                    }
                return FX.Utils.isNull(i.type) ? null : i
            },
            _parseDefaultValue: function(t) {
                if (t.defaultValue) {
                    var e, i, a, n;
                    if ("datetime" === t.type && t.defaultValue) {
                        e = {};
                        var s = t.defaultValue
                            , r = Date.now()
                            , o = FX.Utils.getDateInfo(r);
                        switch (s.type) {
                            case "today":
                                e.min = new Date(o.year,o.month,o.day,0,0,0).getTime(),
                                    e.max = new Date(o.year,o.month,o.day,23,59,59).getTime();
                                break;
                            case "yesterday":
                                var l = FX.Utils.getDateInfo(r - 864e5);
                                e.min = new Date(l.year,l.month,l.day,0,0,0).getTime(),
                                    e.max = new Date(l.year,l.month,l.day,23,59,59).getTime();
                                break;
                            case "lastWeek":
                                var c = FX.Utils.getDateInfo(r - 6048e5);
                                e.min = new Date(c.year,c.month,c.day,0,0,0).getTime(),
                                    e.max = new Date(o.year,o.month,o.day,23,59,59).getTime();
                                break;
                            case "thisWeek":
                                var d = FX.Utils.getWeekStartDate(new Date)
                                    , u = FX.Utils.getWeekEndDate(new Date);
                                e.min = d.setHours(0, 0, 0),
                                    e.max = u.setHours(23, 59, 59);
                                break;
                            case "thisMonth":
                                var h = FX.Utils.getMonthStartDate(new Date)
                                    , p = FX.Utils.getMonthEndDate(new Date);
                                e.min = h.setHours(0, 0, 0),
                                    e.max = p.setHours(23, 59, 59);
                                break;
                            case "formula":
                                var f = "before" === s.min.type ? -1 * s.min.value : s.min.value
                                    , m = "before" === s.max.type ? -1 * s.max.value : s.max.value
                                    , g = new Date(r + f)
                                    , _ = new Date(r + m);
                                e.min = g.setHours(0, 0, 0),
                                    e.max = _.setHours(23, 59, 59);
                                break;
                            default:
                                e.min = s.min,
                                    e.max = s.max
                        }
                    } else {
                        e = "user" !== t.type && "creator" !== t.name || !t.defaultValue ? v.extend(!0, {}, t.defaultValue) : (-1 < (a = (i = [].concat(t.defaultValue.items || [])).indexOf(FX.USER_ID.CurrentUser)) && (!(n = FX.CorpUser.getMemberId()) || -1 < i.indexOf(n) ? i.splice(a, 1) : i[a] = n),
                            {
                                items: i,
                                hasEmpty: t.defaultValue.hasEmpty
                            })
                    }
                    return e
                }
            },
            _getComboConfig: function(t) {
                var e = this.options
                    , i = FX.Utils.getFieldInfoById(t.id);
                return {
                    type: "xcombocheck",
                    async: {
                        url: e.distinctUrl,
                        data: {
                            refAppId: i.appId,
                            formId: i.entryId,
                            field: t.name,
                            type: t.type,
                            authGroupId: e.authGroupId,
                            filter: e.filter
                        }
                    },
                    hasSelectEmpty: e.hasSelectEmpty,
                    hasLimit: !0,
                    searchable: !0,
                    width: 150
                }
            },
            _getUserConfig: function(t) {
                return v.extend(this._getComboConfig(t), {
                    type: "usercheck",
                    hasSelectEmpty: this.options.hasSelectEmpty,
                    textField: "nickname",
                    valueField: "_id"
                })
            },
            getOptions: function() {
                var t = this.options;
                return v.extend(FX.Parameter.superclass.getOptions.apply(this, arguments), {
                    fields: t.fields
                })
            },
            removeField: function(t) {
                v(".fui_parameter_cell", this.element).eq(t).remove()
            },
            updateField: function(t, e) {
                FX.Utils.isNull(e) || (v(".fui_parameter_cell", this.element).eq(e).children(".cell-title").text(t.text),
                    v(".fui_parameter_cell", this.element).eq(e).data("widget").setValue(this._parseDefaultValue(t)))
            },
            addField: function(t) {
                this._createItem(t)
            },
            checkValidate: function() {
                if (this.options.allowBlank)
                    return !0;
                var t = v(".fui_parameter_cell", this.element)
                    , n = !0;
                return FX.Utils.forEach(t, function(t, e) {
                    var i = v(e).data("widget");
                    if (i) {
                        var a = i.getValue();
                        return FX.Utils.isObjectEmpty(a) ? n = !1 : void 0
                    }
                }),
                    n
            },
            _checkWidgetValue: function(t, e) {
                var i = !1;
                switch (t) {
                    case "xcombocheck":
                    case "usercheck":
                        i = e.hasEmpty || !FX.Utils.isObjectEmpty(e.value);
                        break;
                    case "deptselect":
                        i = e.hasEmpty || e.hasCurrentDept || !FX.Utils.isObjectEmpty(e.value);
                        break;
                    default:
                        0 < e.value.length && FX.Utils.forEach(e.value, function(t, e) {
                            if (!FX.Utils.isNull(e))
                                return !(i = !0)
                        })
                }
                return i
            },
            _getFilterByWidget: function(t, e) {
                var i = {
                    type: e.type
                };
                v.extend(i, FX.Utils.dealFilterInfoByField(e));
                var a = t.getValue();
                switch (t.options.type) {
                    case "usercheck":
                        v.extend(i, {
                            type: "user",
                            method: FX.CONST.FILTER_METHOD.IN,
                            value: a.items,
                            hasEmpty: !!a.hasEmpty
                        });
                        break;
                    case "xcombocheck":
                        v.extend(i, {
                            type: "text",
                            method: FX.CONST.FILTER_METHOD.IN,
                            value: a.items,
                            hasEmpty: !!a.hasEmpty
                        });
                        break;
                    case "deptselect":
                        v.extend(i, {
                            method: FX.CONST.FILTER_METHOD.IN,
                            value: a.items,
                            hasEmpty: !!a.hasEmpty,
                            hasCurrentDept: !!a.hasCurrentDept
                        });
                        break;
                    case "datelimit":
                        v.extend(i, {
                            method: FX.CONST.FILTER_METHOD.RG,
                            value: FX.Utils.getArrayFromRange(a, "datetime", e.format)
                        });
                        break;
                    case "numberlimit":
                        v.extend(i, {
                            method: FX.CONST.FILTER_METHOD.RG,
                            value: FX.Utils.getArrayFromRange(a, "number")
                        });
                        break;
                    case "address":
                        v.extend(i, {
                            method: FX.CONST.FILTER_METHOD.ALL,
                            value: FX.Utils.getArrayFromRange(a, "address")
                        });
                        break;
                    case "text":
                        v.extend(i, {
                            type: "text",
                            method: FX.CONST.FILTER_METHOD.EQ,
                            value: v.makeArray(a)
                        });
                        break;
                    case "phone":
                        v.extend(i, {
                            type: "phone",
                            method: FX.CONST.FILTER_METHOD.EQ,
                            value: v.makeArray(a.phone)
                        });
                        break;
                    default:
                        v.extend(i, {
                            method: FX.CONST.FILTER_METHOD.EQ,
                            value: v.makeArray(a)
                        })
                }
                return i
            },
            getValue: function() {
                var t = v(".fui_parameter_cell", this.element)
                    , s = []
                    , r = this;
                this.options;
                return FX.Utils.forEach(t, function(t, e) {
                    var i, a, n = v(e).data("widget");
                    n && (i = r.fieldMap[n.getWidgetName()],
                        a = r._getFilterByWidget(n, i),
                    r._checkWidgetValue(n.options.type, a) && s.push(a))
                }),
                    s
            }
        }),
            v.shortcut("parameter", FX.Parameter)
    }(jQuery),
    FX.SubformItem = FX.extend(FX.FormItem, {
        _defaultConfig: function() {
            return $.extend(FX.SubformItem.superclass._defaultConfig.apply(), {
                subform: "",
                widget: {},
                colorMap: null,
                onBeforeWidgetCreate: null,
                onKeyPress: null
            })
        },
        _render: function() {
            this._renderField()
        },
        _renderField: function() {
            var t = this.options
                , e = $.extend({
                renderEl: this.element
            }, this.widget);
            FX.Utils.applyFunc(this, t.onBeforeWidgetCreate, [e], !1),
                !1 === e.enable && -1 < FX.LimitFields.disable.indexOf(e.type) ? this.field = new FX.FormItemDisable($.extend(e, {
                    API: t.API,
                    widgetType: this.widget.type,
                    oriType: this.widget.oriType,
                    customCls: "fui_subform_item_disable",
                    subform: t.subform,
                    colorMap: t.colorMap
                })) : this.field = FX.createWidget(this._getFieldConfig(e))
        },
        _getFieldConfig: function(t) {
            var e = this
                , i = this.options;
            switch (t.oriType = t.type,
                t.subform = i.subform,
                t.API = i.API,
            "text" !== t.type && "number" !== t.type || (t.onKeyPress = function(t) {
                    FX.Utils.applyFunc(e, i.onKeyPress, [t], !1)
                }
            ),
            i.subformLabel && (t.subformLabel = i.subformLabel),
                t.type) {
                case "textarea":
                    t.type = "subform_" + t.type,
                        t.height = 76;
                    break;
                case "address":
                case "user":
                case "usergroup":
                case "dept":
                case "deptgroup":
                case "radiogroup":
                case "checkboxgroup":
                case "upload":
                case "image":
                case "location":
                case "text":
                case "datetime":
                case "number":
                case "combo":
                case "combocheck":
                    t.type = "subform_" + t.type,
                        t.height = 30;
                    break;
                case "linkquery":
                    t.onRelyDone = function() {
                        FX.Utils.applyFunc(e, i.onRelyDone, [e], !1)
                    }
            }
            return t
        },
        isSubformWidget: function() {
            return !0
        },
        getSubformName: function() {
            return this.options.subform
        },
        getSubFullName: function() {
            return this.options.subform + "." + this.widget.widgetName
        }
    }),
    function(e) {
        FX.SubformBase = FX.extend(FX.Widget, {
            _defaultConfig: function() {
                return e.extend(FX.SubformBase.superclass._defaultConfig.apply(), {
                    oriType: ""
                })
            },
            _init: function() {
                FX.SubformBase.superclass._init.apply(this, arguments),
                    this._createOriWidget()
            },
            _createOriWidget: function() {
                this.oriWidget = FX.createWidget(e.extend(this.getOptions(), {
                    renderEl: e("<div/>").appendTo(this.element)
                }))
            },
            getLinkValue: function() {
                return this.oriWidget.getLinkValue()
            },
            getValue: function() {
                return this.oriWidget.getValue()
            },
            setValue: function(t) {
                this.oriWidget.setValue(t)
            },
            setText: function(t) {
                this.oriWidget.setText(t)
            },
            getText: function() {
                return this.oriWidget.getText()
            },
            getWidgetType: function() {
                return this.options.oriType
            },
            getNullValue: function() {
                return this.oriWidget.getNullValue()
            },
            getInvalidateType: function() {
                return this.oriWidget.getInvalidateType()
            },
            checkValidate: function() {
                return this.oriWidget.checkValidate()
            },
            getCacheValue: function() {
                return this.oriWidget.getCacheValue()
            },
            setCacheValue: function(t) {
                this.oriWidget.setCacheValue(t)
            },
            getOptions: function() {
                var t = this.options;
                return e.extend(FX.SubformBase.superclass.getOptions.apply(this, arguments), {
                    type: t.oriType,
                    fieldWidth: t.fieldWidth
                })
            }
        }),
            e.shortcut("subform_base", FX.SubformBase)
    }(jQuery),
    FX.SubformText = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return $.extend(FX.SubformText.superclass._defaultConfig.apply(), {
                noRepeat: !1,
                regex: null,
                scan: !1
            })
        },
        _createOriWidget: function() {
            var e = this
                , i = this.options;
            this.oriWidget = FX.createWidget($.extend(this.getOptions(), {
                renderEl: $("<div/>").appendTo(this.element),
                onKeyPress: function(t) {
                    FX.Utils.applyFunc(e, i.onKeyPress, [t], !1)
                },
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, i.onStopEdit, [], !1)
                },
                onStateChange: function() {
                    FX.Utils.applyFunc(e, i.onStateChange, [], !1)
                }
            }))
        },
        select: function() {
            this.oriWidget && this.oriWidget.select()
        },
        getOptions: function() {
            var t = this.options;
            return $.extend(FX.SubformText.superclass.getOptions.apply(this, arguments), {
                regex: t.regex,
                scan: t.scan
            })
        }
    }),
    $.shortcut("subform_text", FX.SubformText),
FX.SubformTextarea = FX.extend(FX.SubformText, {}),
$.shortcut("subform_textarea", FX.SubformTextarea),
FX.SubformNumber = FX.extend(FX.SubformText, {
    _defaultConfig: function() {
        return $.extend(FX.SubformNumber.superclass._defaultConfig.apply(), {
            allowDecimals: !1,
            allowNegative: !0,
            maxNumber: null,
            minNumber: null
        })
    },
    getOptions: function() {
        var t = this.options;
        return $.extend(FX.SubformNumber.superclass.getOptions.apply(this, arguments), {
            allowDecimals: t.allowDecimals,
            allowNegative: t.allowNegative,
            maxNumber: t.maxNumber,
            minNumber: t.minNumber
        })
    }
}),
$.shortcut("subform_number", FX.SubformNumber),
FX.SubformCombo = FX.extend(FX.SubformBase, {
    _defaultConfig: function() {
        return $.extend(FX.SubformCombo.superclass._defaultConfig.apply(), {
            noRepeat: !1,
            async: null,
            colorEnable: !1,
            items: [{
                value: "1",
                text: "1"
            }, {
                value: "2",
                text: "2"
            }, {
                value: "3",
                text: "3"
            }]
        })
    },
    _createOriWidget: function() {
        var e = this
            , i = this.options;
        this.oriWidget = FX.createWidget($.extend(this.getOptions(), {
            renderEl: $("<div/>").appendTo(this.element),
            subform: i.subform,
            colorEnable: i.colorEnable,
            onBeforeAsync: function() {
                return FX.Utils.applyFunc(e, i.onBeforeAsync, [], !1)
            },
            onStopEdit: function() {
                this.resizeTextOther(),
                    FX.Utils.applyFunc(e, i.onStopEdit, [], !1)
            },
            onStateChange: function() {
                FX.Utils.applyFunc(e, i.onStateChange, [], !1)
            },
            onGetAjaxData: function() {
                return FX.Utils.applyFunc(e, i.onGetAjaxData, [], {})
            },
            onLinkErr: function(t) {
                return FX.Utils.applyFunc(e, i.onLinkErr, [t], {})
            }
        })),
            this.oriWidget.resizeTextOther()
    },
    getOptions: function() {
        var t = this.options
            , e = {};
        return t.async && t.async.url ? e.async = t.async : e.items = t.items,
            $.extend(FX.SubformCombo.superclass.getOptions.apply(this, arguments), e)
    }
}),
$.shortcut("subform_combo", FX.SubformCombo),
FX.SubformCombocheck = FX.extend(FX.SubformCombo, {
    _initDefaultValue: function() {
        var t = this.options;
        null != t.value && this.setValue(t.value)
    }
}),
$.shortcut("subform_combocheck", FX.SubformCombocheck),
FX.SubformDate = FX.extend(FX.SubformBase, {
    _defaultConfig: function() {
        return $.extend(FX.SubformDate.superclass._defaultConfig.apply(), {
            format: "yyyy-MM-dd"
        })
    },
    _createOriWidget: function() {
        var t = this
            , e = this.options;
        this.oriWidget = FX.createWidget($.extend(this.getOptions(), {
            renderEl: $("<div/>").appendTo(this.element),
            onStopEdit: function() {
                FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
            },
            onStateChange: function() {
                FX.Utils.applyFunc(t, e.onStateChange, [], !1)
            }
        }))
    },
    getOptions: function() {
        var t = this.options;
        return $.extend(FX.SubformDate.superclass.getOptions.apply(this, arguments), {
            format: t.format
        })
    }
}),
$.shortcut("subform_datetime", FX.SubformDate),
function(i) {
    FX.SubformUser = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return i.extend(FX.SubformUser.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_user",
                API: FX.API,
                oriType: "user",
                title: i18next.t("widget.user.listTitle"),
                limit: {},
                limitWidget: "",
                value: null,
                allowBlank: !0,
                dynamicFields: [{
                    id: FX.USER_ID.CurrentUser,
                    name: i18next.t("widget.user.current")
                }],
                dynamicType: "select",
                onBeforeEdit: null,
                onStopEdit: null
            })
        },
        _init: function() {
            FX.SubformUser.superclass._init.apply(this, arguments),
                this._createTriggerBtn(),
                this._createSelectList()
        },
        _createOriWidget: function() {
            var t = this.options
                , e = this
                , i = {
                API: t.API,
                type: t.oriType,
                limit: t.limit,
                limitWidget: t.limitWidget,
                allowBlank: t.allowBlank,
                visible: t.visible,
                enable: t.enable,
                dynamicType: t.dynamicType,
                onGetAjaxData: function() {
                    return FX.Utils.applyFunc(e, t.onGetAjaxData, [], {})
                }
            };
            this.oriWidget = FX.createWidget(i)
        },
        _createTriggerBtn: function() {
            var t = this;
            this.$selectTrigger = i('<div class="select-trigger"><i class="widget-icon icon-widget-user"/></div>').click(function() {
                t._createSelectDialog()
            }).appendTo(this.element)
        },
        _createSelectDialog: function() {
            var e, i = this.oriWidget, a = this.options, n = this;
            i.isEnabled() && (FX.Utils.applyFunc(n, a.onBeforeEdit, [], !1),
                (e = new FX.ConfirmDialog({
                    title: a.title,
                    width: 610,
                    contentWidget: {
                        rowSize: [440],
                        colSize: [570],
                        items: [[{
                            API: a.API,
                            widgetName: a.widgetName,
                            type: a.oriType,
                            editable: !0,
                            limit: a.limit,
                            limitWidget: a.limitWidget,
                            items: i.items,
                            value: i.value,
                            onStopEdit: a.onStopEdit,
                            onGetAjaxData: function() {
                                return FX.Utils.applyFunc(n, a.onGetAjaxData, [], {})
                            }
                        }]]
                    },
                    onOk: function() {
                        var t = e.getWidgetByName(a.widgetName);
                        return i.value = t.getValue(),
                            i.items = t.getItems(),
                            i._initSelectPane(),
                            n._createSelectList(),
                            FX.Utils.applyFunc(n, a.onStopEdit, [], !1),
                            FX.Utils.applyFunc(n, a.onStateChange, [], !1),
                            !1
                    }
                })).show())
        },
        _createSelectList: function() {
            var t, e;
            this.$selectList ? this.$selectList.empty() : this.$selectList = i('<span class="select-list"/>').prependTo(this.$selectTrigger),
                FX.Utils.isExternalLink() ? i('<div class="nonsupport-msg"/>').text(i18next.t("widget.user.notSupportLink")).appendTo(this.element.empty()) : (t = this.oriWidget.getCacheValue()) && (e = i('<span class="select-item"/>').text(t.name).appendTo(this.$selectList),
                    t._id === FX.USER_ID.CurrentUser ? i('<i class="select-icon icon-role-solid"/>').prependTo(e) : new FX.Avatar({
                        renderEl: i('<div class="user-avatar"/>').prependTo(e),
                        name: t.name,
                        avatar: t.avatar,
                        size: "small"
                    }))
        },
        getOptions: function(t) {
            var e = this.options;
            return i.extend(FX.SubformUser.superclass.getOptions.apply(this, arguments), {
                limit: e.limit,
                limitWidget: e.limitWidget,
                value: "save" === t ? this.oriWidget._parseDefaultValue(e.value) : e.value,
                valueOption: e.valueOption,
                type: e.oriType
            })
        },
        setCacheValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformUser.superclass.setCacheValue, [t], !1),
                this._createSelectList()
        },
        setValue: function(t) {
            var a, e;
            this.isEnabled() || (e = "",
                e = Array.isArray(t) ? (a = [],
                    FX.Utils.forEach(t, function(t, e) {
                        var i;
                        e && (i = e.nickname || e.name,
                            a.push(i))
                    }),
                    a.join(", ")) : t && (t.nickname || t.name),
                this.setText(e)),
                FX.Utils.applyFunc(this, FX.SubformUser.superclass.setValue, [t], !1),
                this._createSelectList()
        },
        setText: function(t) {
            var e = this.options;
            this.element.empty(),
            e.subform && this.element.attr("title", t),
                this.element.text(t)
        }
    }),
        i.shortcut("subform_user", FX.SubformUser)
}(jQuery),
function(n) {
    FX.SubformUserGroup = FX.extend(FX.SubformUser, {
        _defaultConfig: function() {
            return n.extend(FX.SubformUserGroup.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_usergroup",
                oriType: "usergroup"
            })
        },
        _init: function() {
            FX.SubformUserGroup.superclass._init.apply(this, arguments)
        },
        _createTriggerBtn: function() {
            var t = this;
            this.$selectTrigger = n('<div class="select-trigger"><i class="widget-icon icon-widget-usergroup"/></div>').click(function() {
                t._createSelectDialog()
            }).appendTo(this.element)
        },
        _createSelectList: function() {
            var a, t;
            this.$selectList ? this.$selectList.empty() : this.$selectList = n('<span class="select-list"/>').prependTo(this.$selectTrigger),
                FX.Utils.isExternalLink() ? n('<div class="nonsupport-msg"/>').text(i18next.t("widget.user.notSupportLink")).appendTo(this.element.empty()) : (t = (a = this).oriWidget.getCacheValue(),
                FX.Utils.isObjectEmpty(t) || FX.Utils.forEach(t, function(t, e) {
                    var i = n('<span class="select-item"/>').text(e.name).appendTo(a.$selectList);
                    e._id === FX.USER_ID.CurrentUser ? n('<i class="select-icon icon-role-solid"/>').prependTo(i) : new FX.Avatar({
                        renderEl: n('<div class="user-avatar"/>').prependTo(i),
                        name: e.name,
                        avatar: e.avatar,
                        size: "small"
                    })
                }))
        }
    }),
        n.shortcut("subform_usergroup", FX.SubformUserGroup)
}(jQuery),
function(i) {
    FX.SubformDept = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return i.extend(FX.SubformDept.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_dept",
                API: FX.API,
                oriType: "dept",
                title: i18next.t("widget.dept.listTitle"),
                value: null,
                allowBlank: !0,
                limit: {},
                dynamicType: "select",
                valueOption: FX.WidgetValueOption.CUSTOM,
                onBeforeEdit: null
            })
        },
        _init: function() {
            FX.SubformDept.superclass._init.apply(this, arguments),
                this._createTriggerBtn(),
                this._createSelectList()
        },
        _createOriWidget: function() {
            var t = this.options
                , e = this
                , i = {
                API: t.API,
                type: t.oriType,
                limit: t.limit,
                rely: t.rely,
                allowBlank: t.allowBlank,
                visible: t.visible,
                enable: t.enable,
                dynamicType: t.dynamicType,
                onGetAjaxData: function() {
                    return FX.Utils.applyFunc(e, t.onGetAjaxData, [], {})
                }
            };
            this.oriWidget = FX.createWidget(i)
        },
        _createTriggerBtn: function() {
            var t = this;
            this.$selectTrigger = i('<div class="select-trigger"><i class="widget-icon icon-widget-dept"/></div>').click(function() {
                t._createSelectDialog()
            }).appendTo(this.element)
        },
        _createSelectDialog: function() {
            var t = this.oriWidget
                , e = this.options
                , i = this;
            t.isEnabled() && !1 === FX.Utils.applyFunc(i, e.onBeforeEdit, [function() {
                i._showEditDialog()
            }
            ], !1) && i._showEditDialog()
        },
        _showEditDialog: function() {
            var e = this.oriWidget
                , i = this.options
                , a = this
                , n = new FX.ConfirmDialog({
                title: i.title,
                width: 610,
                contentWidget: {
                    rowSize: [440],
                    colSize: [570],
                    items: [[{
                        API: i.API,
                        widgetName: i.widgetName,
                        type: i.oriType,
                        editable: !0,
                        limit: i.limit,
                        rely: i.rely,
                        items: e.items,
                        value: e.value,
                        valueOption: i.valueOption,
                        onStopEdit: i.onStopEdit,
                        onGetAjaxData: function() {
                            return FX.Utils.applyFunc(a, i.onGetAjaxData, [], {})
                        }
                    }]]
                },
                onOk: function() {
                    var t = n.getWidgetByName(i.widgetName);
                    return e.value = t.getValue(),
                        e.items = t.getItems(),
                        e._initSelectPane(),
                        a._createSelectList(),
                        FX.Utils.applyFunc(a, i.onStopEdit, [], !1),
                        FX.Utils.applyFunc(a, i.onStateChange, [], !1),
                        !1
                }
            });
            n.show()
        },
        _createSelectList: function() {
            var t;
            this.$selectList ? this.$selectList.empty() : this.$selectList = i('<span class="select-list"/>').prependTo(this.$selectTrigger),
                FX.Utils.isExternalLink() ? i('<div class="nonsupport-msg"/>').text(i18next.t("widget.dept.notSupportLink")).appendTo(this.element.empty()) : (t = this.oriWidget.getCacheValue()) && i('<span class="select-item"/>').text(t.name).prepend('<i class="select-icon dept-icon icon-department-solid"/>').appendTo(this.$selectList)
        },
        clearLimit: function() {
            this.options.limit = {}
        },
        getOptions: function(t) {
            var e = this.options;
            return i.extend(FX.SubformDept.superclass.getOptions.apply(this, arguments), {
                limit: e.limit,
                value: "save" === t ? this._parseDefaultValue(e.value) : e.value,
                valueOption: e.valueOption,
                type: e.oriType
            })
        },
        setCacheValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformDept.superclass.setCacheValue, [t], !1),
                this._createSelectList()
        },
        setValue: function(t) {
            var a, e;
            this.isEnabled() || (e = "",
                e = Array.isArray(t) ? (a = [],
                    FX.Utils.forEach(t, function(t, e) {
                        var i;
                        e && (i = e.nickname || e.name,
                            a.push(i))
                    }),
                    a.join(", ")) : t && (t.nickname || t.name),
                this.setText(e)),
                FX.Utils.applyFunc(this, FX.SubformDept.superclass.setValue, [t], !1),
                this._createSelectList()
        },
        setText: function(t) {
            var e = this.options;
            this.element.empty(),
            e.subform && this.element.attr("title", t),
                this.element.text(t)
        }
    }),
        i.shortcut("subform_dept", FX.SubformDept)
}(jQuery),
function(a) {
    FX.SubformDeptGroup = FX.extend(FX.SubformDept, {
        _defaultConfig: function() {
            return a.extend(FX.SubformDeptGroup.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_deptgroup",
                oriType: "deptgroup"
            })
        },
        _init: function() {
            FX.SubformDeptGroup.superclass._init.apply(this, arguments)
        },
        _createTriggerBtn: function() {
            var t = this;
            this.$selectTrigger = a('<div class="select-trigger"><i class="widget-icon icon-widget-deptgroup"/></div>').click(function() {
                t._createSelectDialog()
            }).appendTo(this.element)
        },
        _createSelectList: function() {
            var i, t;
            this.$selectList ? this.$selectList.empty() : this.$selectList = a('<span class="select-list"/>').prependTo(this.$selectTrigger),
                FX.Utils.isExternalLink() ? a('<div class="nonsupport-msg"/>').text(i18next.t("widget.dept.notSupportLink")).appendTo(this.element.empty()) : (t = (i = this).oriWidget.getCacheValue(),
                FX.Utils.isObjectEmpty(t) || FX.Utils.forEach(t, function(t, e) {
                    a('<span class="select-item"/>').text(e.name).prepend('<i class="select-icon dept-icon icon-department-solid"/>').appendTo(i.$selectList)
                }))
        }
    }),
        a.shortcut("subform_deptgroup", FX.SubformDeptGroup)
}(jQuery),
function(a) {
    FX.SubformAddress = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return a.extend(FX.SubformAddress.superclass._defaultConfig.apply(), {
                baseCls: "fui_subform_address",
                needDetail: !0,
                allowBlank: !0,
                onStopEdit: null
            })
        },
        _init: function() {
            FX.SubformAddress.superclass._init.apply(this, arguments);
            var e = this;
            this.$input = a('<input readonly onfocus="this.blur()" unselectable="on"/>').appendTo(this.element),
                a('<i class="icon-widget-address"/>').appendTo(this.element),
                this.element.on("click", function(t) {
                    e.oriWidget.isEnabled() && e._showTriggerView(a(t.currentTarget))
                })
        },
        _createOriWidget: function() {
            var t = this.options
                , e = this
                , i = {
                type: t.oriType,
                allowBlank: t.allowBlank,
                needDetail: t.needDetail,
                visible: t.visible,
                enable: t.enable,
                onStopEdit: function() {
                    e._showSelectValue()
                },
                onStateChange: function() {
                    FX.Utils.applyFunc(e, t.onStateChange, [], !1)
                }
            };
            t.needDetail ? (i.width = 370,
                i.width4province = 150,
                i.width4city = 105,
                i.width4district = 105) : (i.width = 310,
                i.width4province = "100%",
                i.width4city = 150,
                i.width4district = 150),
                this.oriWidget = FX.createWidget(i)
        },
        _showTriggerView: function(t) {
            var e = this
                , i = this.options;
            this.$triggerView || (this.$triggerView = a('<div class="subform-address-trigger"/>'),
                this.oriWidget.element.appendTo(this.$triggerView)),
                FX.Msg.bubble({
                    anchor: t,
                    contentHTML: this.$triggerView,
                    text4Cancel: null,
                    text4Ok: null,
                    contentPadding: 0,
                    hasTriangle: !1,
                    hAdjust: 120,
                    animation: !1,
                    edge: 240,
                    minWidth: 340,
                    onClose: function() {
                        e.$triggerView.detach(),
                            e._showSelectValue(),
                            FX.Utils.applyFunc(e, i.onStopEdit, [], null)
                    }
                })
        },
        _showSelectValue: function() {
            this.$input.val(this.getText())
        },
        getOptions: function() {
            var t = this.options;
            return a.extend(FX.SubformAddress.superclass.getOptions.apply(this, arguments), {
                type: this.oriWidget.getWidgetType(),
                needDetail: t.needDetail
            })
        },
        getText: function() {
            var t = this.getValue();
            return [t.province || "", t.city || "", t.district || "", t.detail || ""].join("")
        },
        setCacheValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformAddress.superclass.setCacheValue, [t], !1),
                this._showSelectValue()
        },
        setValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformAddress.superclass.setValue, [t], !1),
                this._showSelectValue()
        }
    }),
        a.shortcut("subform_address", FX.SubformAddress)
}(jQuery),
function(a) {
    FX.SubformLocation = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return a.extend(FX.SubformLocation.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_location",
                iconCls: "icon-widget-location",
                oriType: "location"
            })
        },
        _init: function() {
            FX.SubformLocation.superclass._init.apply(this, arguments);
            var e = this.options
                , i = this
                , t = a('<div class="location-subform-wrapper"><div class="btn-icon-wrapper"><i class="' + e.iconCls + '"></i></div></div>').on("click", function(t) {
                e.enable && FX.Msg.bubble({
                    anchor: a(t.currentTarget),
                    contentHTML: i.$triggerView,
                    text4Ok: "",
                    text4Cancel: "",
                    hAdjust: 100,
                    minWidth: 340,
                    hasTriangle: !1,
                    contentPadding: 0,
                    onClose: function() {
                        return i.$triggerView.detach(),
                            !1
                    }
                })
            }).toggleClass("x-ui-disable", !e.enable).appendTo(this.element);
            this.$text = a('<div class="location-text"/>').prependTo(t)
        },
        _createOriWidget: function() {
            var t = this.options;
            this._renderTriggerView();
            var e = a(".location-bubble", this.$triggerView);
            this.oriWidget = FX.createWidget({
                type: t.oriType,
                allowBlank: t.allowBlank,
                visible: t.visible,
                enable: t.enable,
                customCls: "sub-location",
                btnWidth: t.btnWidth,
                lnglatVisible: t.lnglatVisible,
                renderEl: a("<div/>").appendTo(e)
            })
        },
        _renderTriggerView: function() {
            var t = this.options;
            this.$triggerView || (this.$triggerView = a('<div class="' + t.baseCls + '"/>')),
                this.$triggerView.empty(),
                a('<div class="location-bubble"/>').appendTo(this.$triggerView)
        },
        setValue: function(t) {
            FX.SubformLocation.superclass.setValue.apply(this, arguments),
                this.$text.text(FX.Utils.address2Str(t, "", "pcda"))
        },
        getOptions: function() {
            var t = this.options;
            return a.extend(FX.SubformLocation.superclass.getOptions.apply(this, arguments), {
                type: this.oriWidget.getWidgetType(),
                adjustable: t.adjustable,
                radius: t.radius,
                limits: t.limits,
                lnglatVisible: t.lnglatVisible
            })
        }
    }),
        a.shortcut("subform_location", FX.SubformLocation)
}(jQuery),
function(n) {
    FX.SubformRadioGroup = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return n.extend(FX.SubformRadioGroup.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_radiogroup",
                type: "radiogroup",
                colorEnable: !1,
                items: [{
                    value: "1",
                    text: "1"
                }, {
                    value: "2",
                    text: "2"
                }, {
                    value: "3",
                    text: "3"
                }]
            })
        },
        _init: function() {
            FX.SubformRadioGroup.superclass._init.apply(this, arguments),
                this._createTriggerBtn(),
                this._showSelectValue()
        },
        _createOriWidget: function() {
            var i = this
                , t = this.options
                , e = {
                type: t.oriType,
                items: t.items,
                allowBlank: t.allowBlank,
                visible: t.visible,
                enable: t.enable,
                colorEnable: t.colorEnable,
                onAfterItemSelect: function(t, e) {
                    e && e.isOther || i.bubble && i.bubble.close()
                },
                onStateChange: function() {
                    FX.Utils.applyFunc(i, t.onStateChange, [], !1)
                }
            };
            this.oriWidget = FX.createWidget(e)
        },
        _createTriggerBtn: function() {
            var t = this
                , e = "select-val";
            this.options.colorEnable || (e += " text-mode"),
                this.$selectTrigger = n('<div class="select-trigger"><div class="' + e + '"/><i class="widget-icon icon-widget-radiogroup"/></div>').click(function() {
                    t.oriWidget.isEnabled() && t._createTriggerView()
                }).appendTo(this.element)
        },
        _createTriggerView: function() {
            var t = this
                , e = this.options;
            this.$triggerView || (this.$triggerView = n('<div class="group-trigger-view"></div>').append(this.oriWidget.element)),
                this.bubble = FX.Msg.bubble({
                    anchor: this.$selectTrigger,
                    contentHTML: this.$triggerView,
                    text4Ok: "",
                    text4Cancel: "",
                    hasTriangle: !1,
                    hAdjust: 70,
                    minWidth: 200,
                    contentPadding: 0,
                    onClose: function() {
                        return t.$triggerView.detach(),
                            t._showSelectValue(),
                            FX.Utils.applyFunc(t, e.onStopEdit, [], !1),
                            !1
                    }
                })
        },
        _showSelectValue: function() {
            var i, t = this.options, a = this.oriWidget.getValue(), e = n(".select-val", this.$selectTrigger).empty();
            a && (t.colorEnable ? (i = null,
                FX.Utils.forEach(t.items, function(t, e) {
                    if (e.value === a)
                        return i = e.color,
                            !1
                }),
                new FX.TextTag({
                    renderEl: n("<span/>").appendTo(e),
                    bgColor: i,
                    text: a,
                    multiLine: !1
                })) : e.text(a))
        },
        getOptions: function() {
            var t = this.options;
            return n.extend(FX.SubformRadioGroup.superclass.getOptions.apply(this, arguments), {
                items: t.items,
                type: t.oriType
            })
        },
        setCacheValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformRadioGroup.superclass.setCacheValue, [t], !1),
                this._showSelectValue()
        },
        setValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformRadioGroup.superclass.setValue, [t], !1),
                this._showSelectValue()
        }
    }),
        n.shortcut("subform_radiogroup", FX.SubformRadioGroup)
}(jQuery),
function(n) {
    FX.SubformCheckboxGroup = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return n.extend(FX.SubformCheckboxGroup.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_checkboxgroup",
                oriType: "checkboxgroup",
                colorEnable: !1,
                items: [{
                    value: "1",
                    text: "1"
                }, {
                    value: "2",
                    text: "2"
                }, {
                    value: "3",
                    text: "3"
                }]
            })
        },
        _init: function() {
            FX.SubformCheckboxGroup.superclass._init.apply(this, arguments),
                this._createTriggerBtn(),
                this._showSelectValue()
        },
        _createOriWidget: function() {
            var t = this.options
                , e = this
                , i = {
                type: t.oriType,
                items: t.items,
                allowBlank: t.allowBlank,
                visible: t.visible,
                enable: t.enable,
                colorEnable: t.colorEnable,
                onAfterItemSelect: function() {
                    e._showSelectValue(),
                        FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                },
                onStateChange: function() {
                    FX.Utils.applyFunc(e, t.onStateChange, [], !1)
                }
            };
            this.oriWidget = FX.createWidget(i)
        },
        _createTriggerBtn: function() {
            var t = this
                , e = "select-val";
            this.options.colorEnable || (e += " text-mode"),
                this.$selectTrigger = n('<div class="select-trigger"><div class="' + e + '"/><i class="widget-icon icon-widget-checkboxgroup"/></div>').click(function() {
                    t.oriWidget.isEnabled() && t._createTriggerView()
                }).appendTo(this.element)
        },
        _createTriggerView: function() {
            var t = this;
            this.$triggerView || (this.$triggerView = n('<div class="group-trigger-view"></div>').append(this.oriWidget.element)),
                this.bubble = FX.Msg.bubble({
                    anchor: this.$selectTrigger,
                    contentHTML: this.$triggerView,
                    text4Ok: "",
                    text4Cancel: "",
                    hasTriangle: !1,
                    hAdjust: 95,
                    minWidth: 200,
                    contentPadding: 0,
                    onClose: function() {
                        return t.$triggerView.detach(),
                            t._showSelectValue(),
                            !1
                    }
                })
        },
        _showSelectValue: function() {
            var t = this.options
                , e = this.oriWidget.getValue()
                , i = n(".select-val", this.$selectTrigger).empty()
                , a = {};
            FX.Utils.forEach(t.items, function(t, e) {
                var i = e.value;
                a[i] || (a[i] = e.color)
            }),
                t.colorEnable ? FX.Utils.forEach(e, function(t, e) {
                    new FX.TextTag({
                        renderEl: n("<span/>").appendTo(i),
                        bgColor: a[e],
                        text: e,
                        multiLine: !1
                    })
                }) : i.text(e)
        },
        getOptions: function() {
            var t = this.options;
            return n.extend(FX.SubformCheckboxGroup.superclass.getOptions.apply(this, arguments), {
                items: t.items,
                type: t.oriType
            })
        },
        setCacheValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformCheckboxGroup.superclass.setCacheValue, [t], !1),
                this._showSelectValue()
        },
        setValue: function(t) {
            FX.Utils.applyFunc(this, FX.SubformCheckboxGroup.superclass.setValue, [t], !1),
                this._showSelectValue()
        }
    }),
        n.shortcut("subform_checkboxgroup", FX.SubformCheckboxGroup)
}(jQuery),
function(s) {
    FX.SubformFileUpload = FX.extend(FX.SubformBase, {
        _defaultConfig: function() {
            return s.extend(FX.SubformFileUpload.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_subform_file_upload",
                iconCls: "icon-widget-upload",
                uploadTokenURL: FX.Utils.getApi(FX.API.file.get_qn_data_token),
                waterMark: i18next.t("content.empty"),
                deleteOnly: !1
            })
        },
        _init: function() {
            FX.SubformFileUpload.superclass._init.apply(this, arguments),
                this._createSubformUploadBtn(),
                this._createOriWidget()
        },
        _createSubformUploadBtn: function() {
            var i = this.options
                , a = this;
            this.$btn = s('<div class="upload-subform-btn"><div class="btn-icon-wrapper"><i class="' + i.iconCls + '"/></div></div>').on("click", function(t) {
                var e = s(t.target).closest(".thumbnail");
                if (e && e.length)
                    return new FX.FilePreview({
                        files: a.oriWidget.files,
                        currentItem: e.index(),
                        autoClose: !1
                    }),
                        !1;
                i.enable && FX.Msg.bubble({
                    anchor: a.$btn,
                    contentHTML: a.$triggerView,
                    text4Ok: "",
                    text4Cancel: "",
                    hAdjust: 53,
                    minWidth: 340,
                    hasTriangle: !1,
                    contentPadding: 0,
                    onClose: function() {
                        return a.$triggerView.detach(),
                            !1
                    }
                })
            }).toggleClass("x-ui-disable", !i.enable).appendTo(this.element),
                this.$subWrapper = s('<div class="subform-thumb-wrapper"/>').attr("data-watermark", i.waterMark).prependTo(this.$btn)
        },
        _createOriWidget: function() {
            var a = this.options
                , n = this;
            this.$triggerView = s('<div class="' + a.baseCls + '"/>');
            var t = {
                renderEl: s('<div class="upload-bubble"/>').appendTo(this.$triggerView),
                type: a.oriType,
                baseCls: "fui_upload",
                uploadTokenURL: a.uploadTokenURL,
                thumbWidth: 60,
                thumbHeight: 60,
                progressWidth: 310,
                progressHeight: 20,
                hasEmptyTip: !0,
                fileThumbSize: "small",
                width: "100%",
                height: "100%",
                enable: a.enable && !a.deleteOnly,
                maxFileSize: a.maxFileSize,
                maxLimitTip: a.maxLimitTip,
                maxFileCount: a.maxFileCount,
                deleteOnly: a.deleteOnly,
                visible: a.visible,
                allowBlank: a.allowBlank,
                compressed: a.compressed,
                onlyCamera: a.onlyCamera,
                uploadTokenType: a.uploadTokenType,
                onFileThumbCreate: function(t) {
                    switch (a.maxFileCount === FX.CONST.UPLOAD_FILE_COUNT.SINGLE && n.$subWrapper.empty(),
                        t.type) {
                        case "normal":
                            var e = s('<div class="thumbnail"/>').appendTo(n.$subWrapper);
                            FX.Utils.createFileThumb(t.ext, "tiny").appendTo(e);
                            break;
                        case "local":
                            var i = this.drawLocalPreview(t.ext, 13, 13);
                            s('<div class="thumbnail"/>').append(i).appendTo(n.$subWrapper),
                                n.$btn.addClass("uploading");
                            break;
                        case "remote":
                            s('<div class="thumbnail"/>').append(t.ext.css({
                                width: 26,
                                height: 26
                            })).appendTo(n.$subWrapper)
                    }
                },
                onFileRemove: function(t) {
                    s(".thumbnail", n.$subWrapper).eq(t).remove()
                },
                onStateChange: function() {
                    n.$btn.removeClass("uploading"),
                        FX.Utils.applyFunc(n, a.onStateChange, [], !1)
                },
                onGetAjaxData: function() {
                    return FX.Utils.applyFunc(n, a.onGetAjaxData, [], {})
                }
            };
            this.oriWidget = FX.createWidget(t)
        },
        getOptions: function() {
            return s.extend(FX.SubformFileUpload.superclass.getOptions.apply(this, arguments), {
                type: this.oriWidget.getWidgetType(),
                maxFileCount: this.options.maxFileCount
            })
        },
        setCacheValue: function(t) {
            this.$subWrapper.empty(),
                FX.Utils.applyFunc(this, FX.SubformFileUpload.superclass.setCacheValue, [t], !1)
        },
        setUploadingStatus: function(t) {
            this.oriWidget.setUploadingStatus(t)
        },
        setValue: function(t) {
            this.$subWrapper.empty(),
                FX.SubformFileUpload.superclass.setValue.apply(this, arguments)
        }
    }),
        s.shortcut("subform_upload", FX.SubformFileUpload)
}(jQuery),
function(e) {
    FX.SubformImage = FX.extend(FX.SubformFileUpload, {
        _defaultConfig: function() {
            return e.extend(FX.SubformImage.superclass._defaultConfig.apply(this, arguments), {
                iconCls: "icon-widget-image"
            })
        },
        getOptions: function() {
            var t = this.options;
            return e.extend(FX.SubformImage.superclass.getOptions.apply(this, arguments), {
                type: this.oriWidget.getWidgetType(),
                maxFileCount: t.maxFileCount,
                compressed: t.compressed,
                onlyCamera: t.onlyCamera,
                watermark: t.watermark
            })
        }
    }),
        e.shortcut("subform_image", FX.SubformImage)
}(jQuery),
function(s) {
    FX.DashFilterBase = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.DashFilterBase.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_filter_base",
                onStopEdit: null,
                method: null,
                displayType: {
                    list: "checklist",
                    box: "xcombocheck"
                },
                showLabel: !0
            })
        },
        _init: function() {
            FX.DashFilterBase.superclass._init.apply(this, arguments);
            var t = this.options;
            t.method = t.method || this._getDefaultMethod(),
                this.relyFilter = t.relyFilter,
                this._createMethod(),
                this._createValCell()
        },
        _getDefaultMethod: function() {
            var t = this.options;
            return FX.Utils.getDashDefaultFilterMethod(t.fields[0] && t.fields[0].type) || this._getAvailableMethods()[0]
        },
        _createMethod: function() {
            var i = this
                , a = this.options
                , t = s(".dash-head", this.element);
            t.length || (t = s('<div class="dash-head"/>').appendTo(this.element)),
                t.empty(),
            a.showLabel && s('<div class="cond-label"/>').attr("title", a.title).text(a.title).appendTo(t);
            var e = s('<div class="head-right">').appendTo(t)
                , n = s('<div class="cond-method"/>').append(s("<span />").text(this._getMethodName(a.method))).append(s('<i class="icon-caret-down"/>')).toggleClass("hide-label", !a.showLabel).appendTo(e);
            new FX.ComboBox({
                renderEl: n,
                items: this._getMethodItems(),
                height: 30,
                width: a.showLabel ? "auto" : "100%",
                value: a.method,
                allowBlank: !1,
                searchable: !1,
                onAfterItemSelect: function(t, e) {
                    e.value !== a.method && (a.method = e.value,
                        i._createValCell(),
                        i.setValue(null),
                        n.children("span").text(i._getMethodName(a.method)),
                        FX.Utils.applyFunc(i, a.onStopEdit, [], !1),
                        FX.Utils.applyFunc(i, a.onMethodChange, [a.method], !1))
                },
                onElementCreate: function() {
                    return !0
                }
            })
        },
        _getMethodItems: function() {
            var i = this
                , a = [];
            return FX.Utils.forEach(this._getAvailableMethods(), function(t, e) {
                a.push({
                    text: i._getMethodName(e),
                    value: e
                })
            }),
                a
        },
        _getAvailableMethods: function() {
            return []
        },
        _getMethodName: function(t) {
            var e = {};
            return e[FX.CONST.FILTER_METHOD.EQ] = {
                name: i18next.t("filter.method.eq")
            },
                e[FX.CONST.FILTER_METHOD.NE] = {
                    name: i18next.t("filter.method.ne")
                },
                e[FX.CONST.FILTER_METHOD.ALL] = {
                    name: i18next.t("filter.method.all")
                },
                e[FX.CONST.FILTER_METHOD.IN] = {
                    name: this._isMultiValField() ? i18next.t("filter.method.in.many") : i18next.t("filter.method.in.one")
                },
                e[FX.CONST.FILTER_METHOD.NIN] = {
                    name: i18next.t("filter.method.nin")
                },
                e[FX.CONST.FILTER_METHOD.LK] = {
                    name: i18next.t("filter.method.lk")
                },
                e[FX.CONST.FILTER_METHOD.ULK] = {
                    name: i18next.t("filter.method.ulk")
                },
                e[FX.CONST.FILTER_METHOD.EP] = {
                    name: i18next.t("filter.method.ep")
                },
                e[FX.CONST.FILTER_METHOD.NEP] = {
                    name: i18next.t("filter.method.nep")
                },
                e[FX.CONST.FILTER_METHOD.GT] = {
                    name: i18next.t("filter.method.gt")
                },
                e[FX.CONST.FILTER_METHOD.GTE] = {
                    name: i18next.t("filter.method.gte")
                },
                e[FX.CONST.FILTER_METHOD.LT] = {
                    name: i18next.t("filter.method.lt")
                },
                e[FX.CONST.FILTER_METHOD.LTE] = {
                    name: i18next.t("filter.method.lte")
                },
                e[FX.CONST.FILTER_METHOD.RG] = {
                    name: i18next.t("filter.method.rg")
                },
                e[FX.CONST.FILTER_METHOD.VF] = {
                    name: i18next.t("filter.method.vf")
                },
                e[FX.CONST.FILTER_METHOD.NVF] = {
                    name: i18next.t("filter.method.nvf")
                },
                e[FX.CONST.FILTER_METHOD.FM] = {
                    name: i18next.t("filter.method.fm")
                },
                e[t].name
        },
        _isMultiValField: function() {
            var t = this.options.fields[0];
            return !!t && -1 < ["combocheck", "checkboxgroup", "usergroup", "deptgroup"].indexOf(t.type)
        },
        _createValCell: function() {
            this.$content || (this.$content = s('<div class="dash-content"/>').appendTo(this.element)),
                this.$content.height(this.getDashContentHeight()).empty()
        },
        _initDefaultValue: function() {
            var t = this.options;
            FX.Utils.isObjectEmpty(t.defaultConfig) || this.setValue(t.defaultConfig)
        },
        _getCompType: function() {
            var t = this.options;
            return t.displayType ? t.sizeY > t.minRow ? t.displayType.list : t.displayType.box : null
        },
        _getAsyncConfig: function() {
            var t, e, i = this.options;
            return i.fields[0] ? (e = "visit" === i.mode ? (t = FX.Utils.getApi(FX.API.dash.distinct),
                {
                    widgetId: i.widgetId,
                    filter: this.relyFilter
                }) : (t = FX.Utils.getApi(FX._API.dash.distinct),
                {
                    widget: s.extend({}, i.componentAttr, {
                        fields: i.fields,
                        defaultConfig: i.defaultConfig,
                        method: i.method,
                        valueMode: i.valueMode,
                        title: i.title
                    }),
                    filter: this.relyFilter
                }),
                {
                    url: t,
                    data: e
                }) : {}
        },
        _formatComboValue: function(t, e) {
            var i = this.options;
            if (e = e || "value",
            t && t.items || (t = {
                hasEmpty: !1,
                items: t ? [t.value] : []
            }),
            "checklist" !== this._getCompType())
                return t;
            var a = t.items.slice(0);
            return t.hasEmpty && a.push(i.customItem[e]),
                a
        },
        getEditConfig: function() {
            var t = this.options;
            return {
                fields: t.fields,
                triggers: t.triggers,
                method: t.method,
                valueMode: t.valueMode,
                defaultConfig: this.getValue(),
                rely: t.rely
            }
        },
        doResize: function(t) {
            var e = this.options;
            FX.DashFilterBase.superclass.doResize.apply(this, arguments),
            t && "edit" === e.mode && (e.sizeX = t.sizeX,
                e.sizeY = t.sizeY,
                this._createValCell(),
                this._initDefaultValue())
        },
        getDashContentHeight: function() {
            var t = this.options
                , e = s(".dash-head", this.element);
            return t.height - e.height() - 10
        },
        rebuild: function(t) {
            var e = this.options;
            e.defaultConfig = t.defaultConfig,
                e.fields = t.fields,
                e.method = t.method,
                e.valueMode = t.valueMode,
                FX.DashFilterBase.superclass.rebuild.apply(this, arguments)
        },
        getValueMode: function() {
            return this.options.valueMode
        },
        getMethod: function() {
            return this.options.method
        },
        setValueMode: function(t) {
            this.options.valueMode = t,
                this.options.method = this._getDefaultMethod(),
                this._createMethod(),
                this._createValCell(),
                this.setValue(null)
        },
        doFilterRely: function(t) {
            this.relyFilter = t
        }
    })
}(jQuery),
function(s) {
    FX.DashComponent = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.DashComponent.superclass._defaultConfig.apply(), {
                baseCls: "fui_dash_component",
                mode: "edit",
                isLayoutEdit: !1,
                widgetType: "",
                widgetId: "",
                form: null,
                fields: [],
                xFields: [],
                yFields: [],
                metrics: [],
                filter: {},
                title: "",
                emptyTip: i18next.t("data.empty"),
                value: null,
                onItemClick: null,
                onClearLink: null,
                onClick: null,
                onStopEdit: null,
                defaultSort: [],
                onSort: null,
                onPageSizeChange: null,
                onColSizeChange: null,
                onExceedLimit: null,
                widget: {}
            })
        },
        _init: function() {
            FX.DashComponent.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this._getWidgetConfig(FX.Utils.getDashFilterTypeByFieldType(t.widgetType, t.fields && t.fields[0] && t.fields[0].type));
            this._renderWidget(e)
        },
        _renderWidget: function(t) {
            var a = this
                , i = this.options;
            if (t.type) {
                if (!this._checkFieldsValid())
                    return this.exception = !1,
                        void this._triggerException();
                this.widget = FX.createWidget(s.extend({
                    widgetName: i.widgetId,
                    widgetId: i.widgetId,
                    renderEl: s('<div class="component-content"/>').appendTo(this.element),
                    hasHeader: !1,
                    hasBorder: !1,
                    width: this.element.width(),
                    height: this.element.height(),
                    sizeX: i.widget.width,
                    sizeY: i.widget.height,
                    form: i.form,
                    fields: i.fields,
                    filter: i.filter,
                    permission: i.widget.permission,
                    mode: i.mode,
                    isLayoutEdit: i.isLayoutEdit,
                    title: i.title,
                    formAttr: i.formAttr,
                    dataPerms: i.dataPerms,
                    defaultConfig: i.defaultConfig,
                    method: i.method,
                    valueMode: i.valueMode,
                    content: i.content,
                    thresholds: "all" === i.widget.permission ? i.thresholds : [],
                    guideline: i.guideline,
                    legend: i.legend,
                    palette: i.palette,
                    valueSize: i.valueSize,
                    chartLabel: i.chartLabel,
                    background: i.background,
                    onItemClick: i.onItemClick,
                    onClearLink: i.onClearLink,
                    onStopEdit: i.onStopEdit,
                    onDataFilter: i.onDataFilter,
                    onPageSizeChange: i.onPageSizeChange,
                    dashTitle: i.dashTitle,
                    relyFilter: i.relyFilter,
                    onColSizeChange: function(t, e) {
                        FX.Utils.applyFunc(a, i.onColSizeChange, [t, e], null)
                    },
                    onLoadFail: function(t) {
                        var e = t.responseJSON || {}
                            , i = a._getInvalidConf(e.code);
                        a.exception = i.exception,
                            a._triggerException(),
                            a._renderTip(i.tip)
                    },
                    onLoadSuccess: function(t) {
                        a.exception = !1,
                            a._triggerException(),
                        t.isLimitExceeded && FX.Utils.applyFunc(a, i.onExceedLimit, [], null),
                            FX.Utils.applyFunc(a, i.onLoadSuccess, [t], !1)
                    },
                    onLoadNull: function() {
                        a.exception = !1,
                            a._triggerException()
                    },
                    triggers: i.triggers,
                    componentAttr: FX.Utils.pick(i.widget, ["posX", "posY", "height", "width", "type", "formulas"])
                }, t))
            }
        },
        _triggerException: function() {
            this.doException && this.doException(this.exception)
        },
        _isChartOrTable: function() {
            var t = this.options;
            return -1 < t.widgetType.indexOf("table") || -1 < t.widgetType.indexOf("chart")
        },
        _dealValueFields: function(t) {
            var i = this
                , a = [];
            return FX.Utils.forEach(t, function(t, e) {
                a.push(s.extend({
                    text: i._getFieldText(e)
                }, e))
            }),
                a
        },
        _getFieldText: function(t) {
            return t.title
        },
        doResize: function(t, e) {
            FX.DashComponent.superclass.doResize.apply(this, arguments);
            var i = this.element.height();
            t && (t.height = i),
            this.widget && ("metrictable" === this.widget.getWidgetType() ? this.widget.doFullScreen(t, e) : this.widget.doResize(t)),
            this.$empty && this.$empty.css({
                width: this.element.width(),
                height: this.element.height()
            })
        },
        _getWidgetConfig: function(t) {
            var e = ""
                , i = {}
                , a = this.options
                , n = this;
            switch (i.xFields = a.xFields,
                i.yFields = a.yFields,
                i.xAxis = a.widget.xAxis,
                i.yAxes = a.widget.yAxes,
                i.legend = a.widget.legend,
                i.palette = a.widget.palette,
                i.valueSize = a.widget.value_size,
                i.chartLabel = a.widget.chart_label,
                i.background = a.widget.background,
                i.valueFields = this._dealValueFields(a.metrics),
                i.chartType = t,
                i.defaultSort = a.defaultSort,
                i.mapType = a.widget.map_type,
                i.region = a.widget.region,
                i.regionArea = a.widget.region_area,
                i.color = a.widget.color,
                i.stickyColumn = a.widget.sticky_column,
                i.rely = a.widget.rely,
            -1 < FX.LimitFields.dashRowOrderChart.indexOf(t) && (i.rowOrder = a.widget.rowOrder),
            -1 < FX.LimitFields.dashTopDataChart.indexOf(t) && (i.top = a.widget.top),
                t) {
                case "metric_table":
                    e = "metrictable";
                    break;
                case "data_table":
                    e = "dashdatatable",
                        i.onSort = a.onSort,
                        i.itemsPerPage = a.widget.pageSize;
                    break;
                case "pivot_table":
                    e = "dashpivottable",
                        i.isHeadSticky = a.widget.isHeadSticky,
                        i.isRowHeadSticky = a.widget.isRowHeadSticky;
                    break;
                case "line_chart":
                    e = "dashlinechart";
                    break;
                case "column_chart":
                    e = "dashbarchart";
                    break;
                case "bar_chart":
                    e = "dashbarchart",
                        i.isInverted = !0;
                    break;
                case "area_chart":
                    e = "dashareachart";
                    break;
                case "pie_chart":
                    e = "dashpiechart";
                    break;
                case "map_chart":
                    e = "dashmapchart";
                    break;
                case "radar_chart":
                    e = "dashradarchart";
                    break;
                case "multi_axes_chart":
                    e = "dashmultiaxeschart";
                    break;
                case "text_filter":
                    e = "dashtext";
                    break;
                case "combocheck_filter":
                    e = "dashcombocheck";
                    break;
                case "textarea_filter":
                    e = "dashtextarea";
                    break;
                case "user_filter":
                    e = "dashuser";
                    break;
                case "usergroup_filter":
                    e = "dashusergroup";
                    break;
                case "flowstate_filter":
                    e = "dashflowstate";
                    break;
                case "dept_filter":
                    e = "dashdept";
                    break;
                case "deptgroup_filter":
                    e = "dashdeptgroup";
                    break;
                case "number_filter":
                    e = "dashnumber";
                    break;
                case "address_filter":
                    e = "dashaddress";
                    break;
                case "date_filter":
                    e = "dashdate";
                    break;
                case "datetime_filter":
                    e = "dashdate",
                        i.format = "yyyy-MM-dd HH:mm:ss";
                    break;
                case "date_month_filter":
                    e = "dashdate",
                        i.format = "yyyy-MM";
                    break;
                case "date_minute_filter":
                    e = "dashdate",
                        i.format = "yyyy-MM-dd HH:mm";
                    break;
                case "phone_filter":
                    e = "dashphone";
                    break;
                case "filelist_filter":
                    e = "dashfile";
                    break;
                case "description":
                    e = "dashdescription";
                    break;
                case "filter_btn":
                    e = "dashbutton",
                        i.onClick = a.onClick;
                    break;
                case "calendar_manage":
                    e = "dashcalendar",
                        i.dateField = a.dateField,
                        i.posX = a.posX,
                        i.posY = a.posY,
                        i.defaultLayout = a.defaultLayout,
                        i.defaultMobileLayout = a.defaultMobileLayout,
                        i.onAfterWidgetUpdate = function(t) {
                            FX.Utils.applyFunc(n, a.onAfterWidgetUpdate, [t], !1)
                        }
                    ;
                    break;
                case "data_manage":
                    e = "dashdatamanagetable",
                        i.widget = a.widget,
                        i.onAfterWidgetUpdate = function(t) {
                            FX.Utils.applyFunc(n, a.onAfterWidgetUpdate, [t], !1)
                        }
                        ,
                        i.onHeadToolUpdate = function(t) {
                            FX.Utils.applyFunc(n, a.onHeadToolUpdate, [t], !1)
                        }
                    ;
                    break;
                default:
                    e = t
            }
            return i.type = e,
                i
        },
        getSize: function() {
            var t = {};
            return this.widget && this.widget.getSize && (t = this.widget.getSize()),
                t
        },
        getTableDataCount: function() {
            var t = 0;
            return this.widget && this.widget.count && (t = this.widget.count),
                t
        },
        getEditConfig: function() {
            return this.widget && this.widget.getEditConfig()
        },
        setConfig: function(t) {
            t && s.extend(this.options, {
                form: t.form,
                xFields: t.xFields,
                yFields: t.yFields,
                metrics: t.metrics,
                fields: t.fields,
                filter: t.filter,
                mode: t.mode,
                title: t.title,
                defaultConfig: t.defaultConfig,
                valueMode: t.valueMode,
                method: t.method,
                widgetType: t.type,
                triggers: t.triggers,
                widgetId: t.widgetId,
                posX: t.posX,
                posY: t.posY,
                dateField: t.dateField,
                content: t.content,
                showGuide: !1,
                defaultSort: t.defaultSort,
                thresholds: t.thresholds,
                guideline: t.guideline,
                legend: t.legend,
                palette: t.palette,
                chartLabel: t.chartLabel,
                background: t.background,
                valueSize: t.valueSize,
                defaultLayout: t.defaultLayout,
                defaultMobileLayout: t.defaultMobileLayout
            }),
                this.rebuild()
        },
        _checkFieldsValid: function() {
            var t = this.options
                , e = !0;
            if (!this._isChartOrTable())
                return e;
            var i = null;
            if (this._isFieldsValid())
                this._checkSubDimensionFields() ? (e = !1,
                    i = 4212) : this._checkMultipleField() ? (e = !1,
                    i = 4215) : this._checkMultipleFieldAndSubField() ? (e = !1,
                    i = 4216) : this._checkSubCrossFields() && (e = !1,
                    i = 4213);
            else {
                if (t.showGuide)
                    return this._renderGuide(),
                        !1;
                e = !1
            }
            return e || this._renderTip(this._getInvalidConf(i).tip),
                e
        },
        _isFieldsValid: function() {
            var t = this.options;
            switch (t.widgetType) {
                case "line_chart":
                case "column_chart":
                case "bar_chart":
                case "area_chart":
                case "radar_chart":
                case "pie_chart":
                case "map_chart":
                    return (0 < t.xFields.length || 0 < t.yFields.length) && 0 < t.metrics.length;
                case "pivot_table":
                    return 0 < t.xFields.length || 0 < t.yFields.length || 0 < t.metrics.length;
                case "multi_axes_chart":
                    return 0 < t.xFields.length && 0 < t.metrics.length;
                case "metric_table":
                    return 0 < t.metrics.length;
                case "data_table":
                    return 0 < t.fields.length;
                default:
                    return !0
            }
        },
        _renderGuide: function() {
            var t = this.options
                , e = "data_table" === t.widgetType ? "10969" : "10968"
                , i = FX.Utils.getAssetUrl("/resources/images/dash_guide/" + this._getGuideImageByType())
                , a = FX.CONFIG.HOST.HELP_DOC_HOST + "/" + e
                , n = i18next.t("dash.field.add.guide", {
                dimension: '<a class="guide-link" href="' + a + '" target="_blank">' + i18next.t("dash.dimension") + "</a>",
                quota: '<a class="guide-link" href="' + a + '" target="_blank">' + i18next.t("dash.metric") + "</a>"
            });
            "data_table" === t.widgetType && (n = i18next.t("dash.table.field.add.guide", {
                field: '<a class="guide-link" href="' + a + '" target="_blank">' + i18next.t("field.show") + "</a>"
            })),
                s('<div class="component-content component-content-guide"><img class="guide-image" src="' + i + '"/><div class="guide-tip">' + n + "</div></div>").appendTo(this.element.empty())
        },
        _getGuideImageByType: function() {
            switch (this.options.widgetType) {
                case "line_chart":
                    return "dash_guide_line.png";
                case "column_chart":
                    return "dash_guide_column.png";
                case "bar_chart":
                    return "dash_guide_bar.png";
                case "area_chart":
                    return "dash_guide_area.png";
                case "radar_chart":
                    return "dash_guide_radar.png";
                case "pie_chart":
                    return "dash_guide_pie.png";
                case "map_chart":
                    return "dash_guide_map.png";
                case "pivot_table":
                    return "dash_guide_pivot.png";
                case "multi_axes_chart":
                    return "dash_guide_multi_axes.png";
                case "metric_table":
                    return "dash_guide_metric.png";
                case "data_table":
                    return "dash_guide_data_table.png";
                default:
                    return ""
            }
        },
        _getInvalidConf: function(t) {
            var e = this.options.emptyTip
                , i = !1;
            if (FX.Utils.isNull(t))
                return {
                    tip: e,
                    exception: i
                };
            switch (t) {
                case 4010:
                    e = FX.Utils.isEmpty(FX.STATIC.DASH_TOKEN) ? i18next.t("dash.auth.noAuth") : i18next.t("dash.auth.errorTip"),
                        i = !0;
                    break;
                case 4212:
                    e = i18next.t("error.4212");
                    break;
                case 4213:
                    e = i18next.t("error.4213");
                    break;
                case 4215:
                    e = i18next.t("error.4215");
                    break;
                case 4216:
                    e = i18next.t("error.4216");
                    break;
                case 8303:
                    e = i18next.t("error.status.429");
                    break;
                default:
                    e = i18next.t("dash.config.error"),
                        i = !0
            }
            return {
                tip: e,
                exception: i
            }
        },
        _renderTip: function(t) {
            this.widget && this.widget.renderTip ? this.$empty = this.widget.renderTip(t) : this.$empty = s('<div class="component-content component-content-empty"><div class="empty-wrapper"><i class="icon-field-auth"></i><div class="empty-text">' + t + "</div></div></div>").css({
                width: this.element.width(),
                height: this.element.height()
            }).appendTo(this.element.empty())
        },
        _checkMultipleField: function() {
            var t = this.options
                , e = [].concat(t.xFields).concat(t.yFields)
                , i = 0;
            return FX.Utils.forEach(e, function(t, e) {
                if (FX.Utils.isMultipleField(e.type) && i++,
                1 < i)
                    return !1
            }),
            1 < i
        },
        _checkMultipleFieldAndSubField: function() {
            var t = this.options
                , e = [].concat(t.xFields).concat(t.yFields)
                , i = t.metrics
                , a = !1
                , n = !1
                , s = !1;
            return FX.Utils.forEach(e, function(t, e) {
                if (e.subform && (a = !0),
                FX.Utils.isMultipleField(e.type) && (n = !0),
                a && n)
                    return !1
            }),
            n && FX.Utils.forEach(i, function(t, e) {
                if (e.subform)
                    return !(s = !0)
            }),
            a && n || n && s
        },
        _checkSubDimensionFields: function() {
            var t = this.options
                , e = [].concat(t.xFields).concat(t.yFields)
                , i = [].concat(t.metrics)
                , a = !1
                , n = !1;
            return FX.Utils.forEach(e, function(t, e) {
                if (e.subform)
                    return !(a = !0)
            }),
            a && FX.Utils.forEach(i, function(t, e) {
                if ("formula" !== e.type && !e.subform)
                    return !(n = !0)
            }),
            a && n
        },
        _checkSubCrossFields: function() {
            var t = this.options
                , e = [].concat(t.xFields).concat(t.yFields).concat(t.metrics)
                , i = !1
                , a = null;
            return FX.Utils.forEach(e, function(t, e) {
                if (e.subform)
                    if (a) {
                        if (a !== e.subform)
                            return !(i = !0)
                    } else
                        a = e.subform
            }),
                i
        },
        reload: function(t) {
            this.widget && this.widget.reload && this.widget.reload(t)
        },
        reloadWithDataIrrelevantConfig: function(t, e) {
            var i = this.options;
            t && s.extend(i, e);
            var a = this._getWidgetConfig(FX.Utils.getDashFilterTypeByFieldType(i.widgetType, i.fields && i.fields[0] && i.fields[0].type));
            this.widget && this.widget.reloadWithDataIrrelevantConfig && this.widget.reloadWithDataIrrelevantConfig(a)
        },
        dealExcelExport: function(t) {
            this.widget && this.widget.doExcelExport && this.widget.doExcelExport(t)
        },
        doEdit: function() {
            this.widget && this.widget.doEdit && this.widget.doEdit()
        },
        doDataCreate: function() {
            this.widget && this.widget.doDataCreate && this.widget.doDataCreate()
        },
        dealExcelImport: function() {
            this.widget && this.widget.doExcelImport && this.widget.doExcelImport()
        },
        dealRefreshSort: function() {
            this.widget && this.widget.doRefreshSort && this.widget.doRefreshSort()
        },
        dealSort: function() {
            this.widget && this.widget.doSort && this.widget.doSort()
        },
        dealOnDataDelete: function() {
            this.widget && this.widget.onDataDelete && this.widget.onDataDelete()
        },
        dealDataDeleteSelected: function() {
            this.widget && this.widget.doDataDeleteSelected && this.widget.doDataDeleteSelected()
        },
        dealCancel: function() {
            this.widget && this.widget.doCancel && this.widget.doCancel()
        },
        dealSetFields: function(t) {
            this.widget && this.widget.doSetFields && this.widget.doSetFields(t)
        },
        dealClearLink: function() {
            this.widget && this.widget.doClearLink && this.widget.doClearLink()
        },
        dealBatchUpdate: function() {
            this.widget && this.widget.doBatchUpdate && this.widget.doBatchUpdate()
        },
        isAllFieldsShow: function() {
            return this.widget && this.widget.isAllFieldsShow && this.widget.isAllFieldsShow()
        },
        isException: function(e) {
            return FX.Utils.isEmpty(this.exception) ? this.doException = function(t) {
                    return e && e(t)
                }
                : e && e(this.exception)
        },
        getChartData: function() {
            return this.widget && this.widget.getChartData && this.widget.getChartData()
        },
        getCheckResult: function() {
            return this.widget && this.widget.getCheckResult && this.widget.getCheckResult()
        },
        doFilterRely: function(t) {
            this.widget && this.widget.doFilterRely && this.widget.doFilterRely(t)
        }
    })
}(jQuery),
function(c) {
    FX.DashBlock = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.DashBlock.superclass._defaultConfig.apply(), {
                baseCls: "fui_dash_block",
                margin: [38, 10, 10, 10],
                widget: {},
                isLayoutEdit: !1,
                operate: ["edit", "delete"],
                onOperateTrigger: null,
                onItemClick: null,
                onClick: null,
                onClearLink: null,
                onStopEdit: null,
                onDataFilter: null,
                hasLazyLoad: !1,
                onHeadToolUpdate: null
            })
        },
        _init: function() {
            FX.DashBlock.superclass._init.apply(this, arguments);
            var t = this.options;
            this.widgetData = t.widget,
                this.API = "visit" === t.mode ? FX.API : FX._API,
                this._renderHead(),
            t.hasLazyLoad || this._renderWidget()
        },
        _renderHead: function() {
            this.$head = c('<div class="block-head"/>').appendTo(this.element),
                this._renderOperate(),
                this._renderTitle()
        },
        _needTitle: function() {
            return FX.LimitFields.dashCompFilter.indexOf(this.widgetData.type) < 0
        },
        _cancelBatchUpdate: function() {
            var t = c(".batch-update-pane", this.$head)
                , e = c(".block-title", this.$head);
            t.remove(),
                e.show(),
                this.setBatchUpdate(!1),
            this.dashWidget && this.dashWidget.dealCancel()
        },
        _renderTitle: function() {
            var t, e = this.$head.children(".block-title");
            this._needTitle() ? (t = this.widgetData.title || "",
                e.length ? e.text(t).attr("title", t) : c('<div class="block-title"/>').attr("title", t).text(t).appendTo(this.$head)) : e.remove()
        },
        _renderBatchUpdatePane: function() {
            var e = this;
            this.options;
            c(".block-title", this.$head).hide();
            var t = c('<div class="batch-update-pane"/>').appendTo(this.$head);
            FX.Utils.dt(FX.CONST.TRACKER.DATA_MANAGE_BATCH_EDIT),
                new FX.Button({
                    renderEl: c('<div class="btn-manage btn-cancel"/>').appendTo(t),
                    height: 30,
                    style: "white",
                    text: i18next.t("data.cancelOperation"),
                    onClick: function() {
                        e._cancelBatchUpdate()
                    }
                }),
                new FX.Button({
                    renderEl: c('<div class="btn-manage btn-select"/>').appendTo(t),
                    height: 30,
                    style: "border-green",
                    text: i18next.t("data.edit.selected"),
                    onClick: function() {
                        var t = e.dashWidget && e.dashWidget.getCheckResult() || [];
                        0 !== t.length ? (e._doBatchEdit({
                            idList: t
                        }),
                            FX.Utils.dt(FX.CONST.TRACKER.DATA_MANAGE_BATCH_EDIT_RANGE)) : FX.Msg.toast({
                            type: "warning",
                            msg: i18next.t("data.operation.select")
                        })
                    }
                }),
                new FX.Button({
                    renderEl: c('<div class="btn-manage btn-history"/>').appendTo(t),
                    height: 30,
                    style: "white",
                    text: i18next.t("data.batch.edit.record.view"),
                    onClick: function() {
                        new FX.BatchEditDialog({
                            appId: FX.STATIC.APPID,
                            entryId: e.widgetData.form,
                            formId: e.widgetData.form,
                            mode: "preview",
                            formItems: e.formItems,
                            title: i18next.t("update.record"),
                            labelMap: e.labelMap,
                            authGroupId: FX.CONST.DEFAULT_AUTH_GROUP
                        }).show()
                    }
                }),
            this.formItems && this.labelMap || FX.Utils.ajax({
                url: FX.Utils.getApi(this.API.form.get, FX.STATIC.APPID, e.widgetData.form)
            }, function(t) {
                e.formItems = t.entry.content.items,
                    e.formulaFields = e._getDataFields(),
                    e.labelMap = e._getLabelMap(e.formulaFields)
            })
        },
        _doBatchEdit: function(e) {
            var n, i, s, r, o, l;
            this.dashWidget && (i = (n = this).options,
                s = e.idList.length,
                r = {},
                o = {},
                FX.Utils.forEach(this.formItems, function(t, e) {
                    "subform" === e.widget.type && (o[e.widget.widgetName] = !0)
                }),
                FX.Utils.forEach(e.idList, function(t, e) {
                    var i, a = n.dataFieldAuthMap && n.dataFieldAuthMap[e];
                    a && (i = a.optAuth,
                        FX.Utils.forEach(i, function(t, e) {
                            r[t] || (r[t] = {
                                enableCount: 0
                            }),
                                o[t] ? e.subform_edit && r[t].enableCount++ : e.enable && r[t].enableCount++
                        }))
                }),
                l = [],
                FX.Utils.forEach(this.formItems, function(t, e) {
                    var a = e.widget.widgetName;
                    if (r[a] && r[a].enableCount === s) {
                        if ("subform" === e.widget.type) {
                            var i = c.extend(!0, {}, e)
                                , n = [];
                            return FX.Utils.forEach(i.widget.items, function(t, e) {
                                var i = a + "." + e.widget.widgetName;
                                r[i] && r[i].enableCount === s && n.push(e)
                            }),
                                i.widget.items = n,
                                void l.push(i)
                        }
                        l.push(e)
                    }
                }),
                FX.Utils.ajax({
                    url: FX.Utils.getApi(this.API.data.batch_update_tasks),
                    data: {
                        appId: FX.STATIC.APPID,
                        entryId: n.widgetData.form,
                        formId: n.widgetData.form,
                        getRunningTask: !0,
                        skip: 0,
                        limit: 1,
                        authGroupId: FX.CONST.DEFAULT_AUTH_GROUP
                    }
                }, function(t) {
                    t.tasks && 0 < t.tasks.length ? FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("data.batch.edit.busy")
                    }) : new FX.BatchEditDialog(c.extend({
                        appId: FX.STATIC.APPID,
                        entryId: n.widgetData.form,
                        formId: n.widgetData.form,
                        formItems: n.formItems,
                        fields: l,
                        subTitle: i18next.t("data.batch.edit.count", {
                            count: '<span class="count-remind">' + s + "</span>"
                        }),
                        labelMap: n.labelMap,
                        formulaFields: n.formulaFields,
                        count: s,
                        hideFormulaEdit: "visit" === i.mode,
                        authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                        onAfterUpdate: function() {
                            switch (this.type) {
                                case "formula":
                                    FX.Utils.dt(FX.CONST.TRACKER.DATA_MANAGE_BATCH_EDIT_FORMULA);
                                    break;
                                case "fixed":
                                    FX.Utils.dt(FX.CONST.TRACKER.DATA_MANAGE_BATCH_EDIT_FIXED);
                                    break;
                                default:
                                    FX.Utils.dt(FX.CONST.TRACKER.DATA_MANAGE_BATCH_EDIT_FIXED)
                            }
                            n._cancelBatchUpdate()
                        }
                    }, e)).show()
                }))
        },
        _getLabelMap: function(t) {
            var a = {};
            return FX.Utils.forEach(t, function(t, e) {
                e.id = e.form;
                var i = "$" + e.name + "#";
                "formula" !== e.type && (i += e.form),
                    a[i] = e.title
            }),
                a
        },
        _getDataFields: function() {
            var n = this
                , s = FX.LimitFields.batchEditFormulaField
                , a = []
                , r = [];
            return FX.Utils.forEach(this.formItems, function(t, e) {
                var i, a;
                e.widget.visible && ((i = c.extend(!0, {}, e)).formId = n.widgetData.form,
                (a = FX.Utils.getFieldAttr(i, s)) && r.push(a))
            }),
                FX.Utils.forEach(r, function(t, e) {
                    var i;
                    "label" !== e.name && (i = c.extend(e, {
                        title: e.text,
                        form: e.id,
                        name: e.name,
                        type: e.type
                    }),
                        a.push(i))
                }),
                a
        },
        _renderWidget: function() {
            var e = this
                , i = this.options;
            this.isLoaded = !0,
            this.$content && this.$content.remove(),
                this.$content = c('<div class="block-content"/>').appendTo(this.element),
                this._needTitle() ? this.setContentMargin(i.margin) : this.setContentMargin([5, 10]),
                this.dashWidget = new FX.DashComponent(c.extend({
                    widgetType: this.widgetData.type,
                    renderEl: c("<div/>").appendTo(this.$content),
                    hasHeader: !1,
                    hasBorder: !1,
                    onItemClick: i.onItemClick,
                    onClick: i.onClick,
                    onClearLink: i.onClearLink,
                    onStopEdit: function(t) {
                        e.element.removeClass("edit-mode"),
                            FX.Utils.applyFunc(this, i.onStopEdit, [t], !1)
                    },
                    onDataFilter: function() {
                        FX.Utils.applyFunc(e, i.onDataFilter, [], !1);
                        var t = [];
                        return e.filter && (t = t.concat(e.filter)),
                        e.linkFilter && (t = t.concat(e.linkFilter)),
                            t
                    },
                    onAfterWidgetUpdate: function(t) {
                        FX.Utils.applyFunc(e, i.onAfterWidgetUpdate, [t], !1)
                    },
                    onHeadToolUpdate: function(t) {
                        FX.Utils.applyFunc(e, i.onHeadToolUpdate, [t], !1)
                    },
                    onLoadSuccess: function(t) {
                        t && (e._setDataFieldMap(t.data),
                        "visit" !== i.mode && "preview" !== i.mode || (e.dataUpdate = t.data_update,
                            e._renderETLInfo(e.dataUpdate)))
                    },
                    mode: i.mode,
                    isLayoutEdit: i.isLayoutEdit,
                    widgetId: i.widgetId,
                    widget: i.widget,
                    dashTitle: i.dashTitle
                }, this.widgetData, {
                    width: this.$content.outerWidth(),
                    height: this.$content.outerHeight()
                }))
        },
        _setDataFieldMap: function(t) {
            var a = this;
            this.dataFieldAuthMap = {},
                FX.Utils.forEach(t, function(t, e) {
                    var i;
                    FX.Utils.isObjectEmpty(e) || (i = {},
                        a.dataFieldAuthMap[e._id] = {},
                        FX.Utils.forEach(e._optAuth, function(t, e) {
                            i[t] = FX.Utils.fieldAuthValue2Json(e)
                        }),
                        a.dataFieldAuthMap[e._id].optAuth = i)
                })
        },
        _renderOperate: function() {
            var t = this.options
                , i = this
                , a = "";
            FX.Utils.forEach(t.operate, function(t, e) {
                a += i._getOperateBtn(e)
            });
            var e = c(".block-operate", this.$head);
            e.length ? e.empty().append(a) : (e = c('<div class="block-operate">' + a + "</div>").appendTo(this.$head),
                this._bindOperate(e)),
                this._bindOperateTip(e)
        },
        updateETLInfo: function(t) {
            this.dataUpdate = this.dataUpdate || {},
                c.extend(this.dataUpdate, t),
                this._renderETLInfo(this.dataUpdate)
        },
        _renderETLInfo: function(t) {
            var e = this
                , i = this.options;
            this.shouldStopETLInfoPopEvent = !1;
            var a, n = FX.Utils.createETLStatusInfo(t, "block-custom-operate", function() {
                FX.Utils.applyFunc(e, i.onETLUpdate, [e.widgetData.form, i.widgetId], !1)
            }, function() {
                e.shouldStopETLInfoPopEvent = !0
            }, function() {
                e.shouldStopETLInfoPopEvent = !1
            });
            n && (c(".block-custom-operate", this.$head).remove(),
                n.prependTo(this.$head),
                t && t.last_status === FX.CONST.ETL_STATUS.SUCCESS && !t.has_delay_task ? this.$head.addClass("visible-head") : this.$head.addClass("custom-head"),
            c(".block-operate", e.$head).is(":visible") && (a = c(".block-operate", e.$head).outerWidth(),
                n.addClass("transition-none"),
                n.css(FX.Utils.formatTransform("translate(-" + a + "px,0)"))),
                this.element.hover(function() {
                    n.removeClass("transition-none");
                    var t = c(".block-operate", e.$head).outerWidth();
                    n.css(FX.Utils.formatTransform("translate(-" + t + "px,0)")),
                        e.element.addClass("show")
                }, function() {
                    setTimeout(function() {
                        e.shouldStopETLInfoPopEvent || (n.css(FX.Utils.formatTransform("translate(0,0)")),
                            e.element.removeClass("show"))
                    }, 50)
                }),
            t.last_status === FX.CONST.ETL_STATUS.RUNNING && FX.Utils.applyFunc(this, i.onETLRunning, [this.widgetData.form], !1))
        },
        _getOperateBtn: function(t) {
            var e = ""
                , i = "";
            switch (t) {
                case "edit":
                    e += '<i class="icon-flow-edit"/>';
                    break;
                case "copy":
                    e += '<i class="icon-copy"/>';
                    break;
                case "delete":
                    e += '<i class="icon-trasho"/>';
                    break;
                case "remove":
                    e += '<i class="icon-close-normal"/>',
                        i += "right-top";
                    break;
                case "enlarge":
                    e += '<i class="icon-enlarge"/>';
                    break;
                case "shrink":
                    e += '<i class="icon-shrink"/>';
                    break;
                case "export":
                    e += '<i class="icon-export"/>';
                    break;
                case "create":
                    e += '<i class="icon-add"/>';
                    break;
                case "import":
                    e += '<i class="icon-vip-center-excel-import"/>';
                    break;
                case "deleteSelected":
                    e += '<i class="icon-trasho"/>';
                    break;
                case "cancel":
                    e += '<i class="icon-signout"/>';
                    break;
                case "setFields":
                    e += '<i class="icon-page-view"/>',
                    this.dashWidget && !this.dashWidget.isAllFieldsShow() && (i += " active");
                    break;
                case "sort":
                    e += '<i class="icon-sort-flow"/>';
                    break;
                case "refreshSort":
                    e += '<i class="icon-async"/>';
                    break;
                case "clearLink":
                    e += '<i class="icon-unlink-alt"/>';
                    break;
                case "batchUpdate":
                    e += '<i class="icon-edit"/>'
            }
            return '<div class="operate-btn ' + i + '" role="' + t + '">' + e + "</div>"
        },
        _getOperateTip: function(t) {
            var e = "";
            switch (t) {
                case "edit":
                    e = i18next.t("edit");
                    break;
                case "copy":
                    e = i18next.t("copy");
                    break;
                case "delete":
                case "remove":
                    e = i18next.t("delete");
                    break;
                case "enlarge":
                    e = i18next.t("zoomIn");
                    break;
                case "shrink":
                    e = i18next.t("zoomOut");
                    break;
                case "export":
                    e = i18next.t("export");
                    break;
                case "create":
                    e = i18next.t("add");
                    break;
                case "import":
                    e = i18next.t("import");
                    break;
                case "deleteSelected":
                    e = i18next.t("delete.selected");
                    break;
                case "cancel":
                    e = i18next.t("dataTable.editor.exit");
                    break;
                case "setFields":
                    e = i18next.t("field.show");
                    break;
                case "refreshSort":
                    e = i18next.t("refresh");
                    break;
                case "sort":
                    e = i18next.t("sort");
                    break;
                case "clearLink":
                    e = i18next.t("clearLink");
                    break;
                case "batchUpdate":
                    e = i18next.t("data.batch.edit")
            }
            return e
        },
        _bindOperate: function(t) {
            var i = this
                , a = this.options;
            t.on("click", ".operate-btn", function(t) {
                var e = c(t.currentTarget);
                FX.UI.closePopover(),
                    FX.Utils.applyFunc(i, a.onOperateTrigger, [e.attr("role"), e], !1)
            })
        },
        _bindOperateTip: function(t) {
            var e = this;
            t.children(".operate-btn").hover(function() {
                var t = c(this).attr("role");
                FX.UI.showPopover({
                    position: "bottomLeft",
                    anchor: c(this),
                    content: c("<span/>").text(e._getOperateTip(t)),
                    type: "dark"
                })
            }, function() {
                FX.UI.closePopover()
            })
        },
        removeCustomOperate: function() {
            c(".block-custom-operate", this.$head).remove(),
                FX.UI.closePopover()
        },
        doResize: function(t) {
            var e;
            this.dashWidget && (t = t || {
                width: this.element.width(),
                height: this.element.height()
            },
                e = this.options,
                t = {
                    width: t.width - e.margin[1] - (e.margin[3] || e.margin[1]),
                    height: t.height - e.margin[0] - (e.margin[2] || e.margin[0]),
                    sizeX: t.sizeX || this.widgetData.width,
                    sizeY: t.sizeY || this.widgetData.height
                },
                this.dashWidget.doResize(t, this.isFullScreen()))
        },
        getSize: function() {
            return this.dashWidget.getSize()
        },
        getOptions: function() {
            return this.widgetData
        },
        updateOptions: function(t) {
            c.extend(this.widgetData, t)
        },
        getFilter: function() {
            return this.filter
        },
        getLinkFilter: function() {
            return this.linkFilter
        },
        setContentMargin: function(t) {
            var e = this.options;
            FX.Utils.isObjectEmpty(t) || (c.extend(e, {
                margin: t
            }),
                this.$content.css({
                    margin: e.margin.join("px ") + "px"
                }))
        },
        getEditConfig: function() {
            return c.extend({
                title: this.widgetData.title
            }, this.dashWidget.getEditConfig())
        },
        setConfig: function(t) {
            c.extend(this.widgetData, t),
                this.dashWidget.setConfig(t),
                this._renderTitle()
        },
        reload: function() {
            this.dashWidget && this.dashWidget.reload()
        },
        setFilter: function(t) {
            this.filter = t
        },
        setLinkFilter: function(t) {
            this.linkFilter = t
        },
        dealExcelExport: function(t) {
            this.dashWidget.dealExcelExport(t)
        },
        dealRefreshSort: function() {
            this.dashWidget.dealRefreshSort()
        },
        dealSort: function() {
            this.dashWidget.dealSort()
        },
        doEdit: function() {
            this.element.addClass("edit-mode"),
                this.dashWidget.doEdit()
        },
        doDataCreate: function() {
            this.dashWidget.doDataCreate()
        },
        dealExcelImport: function() {
            this.dashWidget.dealExcelImport()
        },
        dealOnDataDelete: function() {
            this.dashWidget.dealOnDataDelete()
        },
        dealDataDeleteSelected: function() {
            this.dashWidget.dealDataDeleteSelected()
        },
        dealCancel: function() {
            this.dashWidget.dealCancel()
        },
        dealSetFields: function(t) {
            this.dashWidget.dealSetFields(t)
        },
        dealClearLink: function() {
            this.dashWidget.dealClearLink()
        },
        dealBatchUpdate: function() {
            this.dashWidget.dealBatchUpdate(),
                this._renderBatchUpdatePane()
        },
        loadWidget: function() {
            this._renderWidget(),
                this.doResize()
        },
        isWidgetLoaded: function() {
            return this.isLoaded
        },
        isException: function(t) {
            return this.dashWidget && this.dashWidget.isException(t)
        },
        updateOperate: function(t) {
            this.options.operate = t,
                this._renderOperate()
        },
        enlarge: function() {
            this.element.addClass("block-full-screen"),
                this.doResize()
        },
        isFullScreen: function() {
            return this.element.hasClass("block-full-screen")
        },
        getBatchUpdate: function() {
            return !!this.isBatchUpdate
        },
        setBatchUpdate: function(t) {
            this.isBatchUpdate = t
        },
        shrink: function() {
            this.element.removeClass("block-full-screen"),
                this.doResize()
        },
        doFilterRely: function(t) {
            this.dashWidget && this.dashWidget.doFilterRely(t)
        }
    }),
        c.shortcut("dashblock", FX.DashBlock)
}(jQuery),
function(n) {
    FX.DashDate = FX.extend(FX.DashFilterBase, {
        DEFAULT_SIZE: {
            single: {
                minSizeX: 15,
                minSizeY: 6
            },
            double: {
                minSizeX: 10,
                minSizeY: 8
            },
            custom: {
                minSizeX: 10,
                minSizeY: 6
            }
        },
        VIEW_MODE: {
            CAL: 1,
            LIM: 2
        },
        _defaultConfig: function() {
            return n.extend(FX.DashDate.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fui_dash_date",
                minRow: 8,
                minCol: 10,
                calendarDateMinCol: 20,
                calendarDateTimeMinCol: 24,
                calendarMinRow: 26,
                onStopEdit: null,
                format: "yyyy-MM-dd"
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.GTE, FX.CONST.FILTER_METHOD.LTE, FX.CONST.FILTER_METHOD.RG, FX.CONST.FILTER_METHOD.FM, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _istypeyearMonth: function() {
            return "yyyy-MM" === this.options.format
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            switch (FX.DashDate.superclass._createValCell.apply(this, arguments),
                this.$content.removeClass("custom-single"),
                e.method) {
                case FX.CONST.FILTER_METHOD.RG:
                    this.viewMode = this._getViewMode(),
                        this._createDate();
                    break;
                case FX.CONST.FILTER_METHOD.FM:
                    var i = this._getDateItems()
                        , a = !e.sizeY || e.sizeY <= e.minRow;
                    this.$content.toggleClass("custom-single", a),
                    a && this.$content.toggleClass("min-col-single", e.sizeX <= e.minCol),
                        this.dashDate = new FX.ComboBox({
                            renderEl: n('<div class="custom-line"/>').appendTo(this.$content),
                            items: i,
                            allowBlank: !1,
                            width: "100%",
                            onStopEdit: function() {
                                "custom" === this.getValue() ? t.dashDatetime.setVisible(!0) : t.dashDatetime.setVisible(!1),
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                            }
                        }),
                        this.dashDatetime = new FX.TimePicker({
                            renderEl: n('<div class="custom-line custom-time"/>').appendTo(this.$content),
                            visible: !1,
                            width: "100%",
                            format: e.format,
                            onStopEdit: function() {
                                FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                            }
                        });
                    break;
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LTE:
                    this.dashDate = new FX.DateTime({
                        renderEl: n('<div class="custom-line"/>').appendTo(this.$content),
                        value: FX.Utils.parseDate(this.value),
                        format: e.format,
                        width: "100%",
                        onStopEdit: function() {
                            FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                        }
                    })
            }
        },
        _getDateItems: function() {
            var t = [{
                text: i18next.t("today"),
                value: "today"
            }, {
                text: i18next.t("date.yesterday"),
                value: "yesterday"
            }, {
                text: i18next.t("date.tomorrow"),
                value: "tomorrow"
            }]
                , e = [{
                text: i18next.t("date.thisWeek"),
                value: "thisWeek"
            }, {
                text: i18next.t("date.lastWeek"),
                value: "lastWeek"
            }, {
                text: i18next.t("date.nextWeek"),
                value: "nextWeek"
            }]
                , i = [{
                text: i18next.t("date.thisMonth"),
                value: "thisMonth"
            }, {
                text: i18next.t("date.lastMonth"),
                value: "lastMonth"
            }, {
                text: i18next.t("date.nextMonth"),
                value: "nextMonth"
            }];
            return this.timePick = [{
                text: i18next.t("custom"),
                value: "custom"
            }].concat(t).concat(e).concat(i),
                this._istypeyearMonth() ? [{
                    text: i18next.t("custom"),
                    value: "custom"
                }].concat(i) : [{
                    text: i18next.t("custom"),
                    value: "custom"
                }].concat(t).concat(e).concat(i)
        },
        _createDate: function() {
            this.dashDate = FX.createWidget(this._getDateConfig()),
                this._doWrap()
        },
        _getDateConfig: function() {
            var t = this.options
                , e = this
                , i = this.VIEW_MODE
                , a = {
                renderEl: n('<div class="custom-line"/>').appendTo(this.$content),
                format: t.format,
                width: t.width,
                height: t.height,
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }
            };
            switch (this.viewMode) {
                case i.CAL:
                    a.type = "daterange";
                    break;
                case i.LIM:
                    a.type = "datelimit",
                        a.width4date = "auto",
                        a.customCls = "date-range"
            }
            return a
        },
        _getViewMode: function() {
            var t = this.options;
            return t.sizeY >= t.calendarMinRow ? t.format && t.format.match(/[YyDd]/) && t.format.match(/[Hh]/) ? t.sizeX >= t.calendarDateTimeMinCol ? this.VIEW_MODE.CAL : this.VIEW_MODE.LIM : t.sizeX >= t.calendarDateMinCol ? this.VIEW_MODE.CAL : this.VIEW_MODE.LIM : this.VIEW_MODE.LIM
        },
        _doWrap: function() {
            var t = this.options
                , e = n(".date-range", this.$content);
            if (e && e.length) {
                if (t.sizeY > t.minRow)
                    return void e.addClass("wrap");
                e.removeClass("wrap")
            }
        },
        doResize: function(t) {
            FX.DashDate.superclass.doResize.apply(this, arguments),
            t && t.width && this.dashDate && this.dashDate.doResize({
                width: t.width
            })
        },
        setValue: function(t) {
            var i, a, e = this;
            switch (this.options.method) {
                case FX.CONST.FILTER_METHOD.RG:
                    this.dashDate.setValue(t);
                    break;
                case FX.CONST.FILTER_METHOD.FM:
                    t && ("custom" === t.mode ? (this.dashDate.setValue(t.mode),
                        this.dashDatetime.setValue(t.formula),
                        this.dashDatetime.setVisible(!0)) : (this.dashDate.setValue(t.formula),
                        this.dashDate.setText((i = t.formula,
                            a = i,
                            e.timePick ? (FX.Utils.forEach(e.timePick, function(t, e) {
                                if (e.value === i)
                                    return a = e.text,
                                        !1
                            }),
                                a) : i)),
                        this.dashDatetime.setVisible(!1)));
                    break;
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LTE:
                    this.dashDate.setValue(t && t.value)
            }
        },
        getValue: function() {
            switch (this.options.method) {
                case FX.CONST.FILTER_METHOD.RG:
                    return this.dashDate.getValue();
                case FX.CONST.FILTER_METHOD.FM:
                    var t = this.dashDate.getValue();
                    return "custom" === t ? {
                        mode: t,
                        formula: this.dashDatetime.getValue()
                    } : {
                        mode: "preset",
                        formula: t
                    };
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LTE:
                    return {
                        value: this.dashDate.getValue()
                    };
                default:
                    return null
            }
        },
        getSize: function() {
            var t = this.options
                , e = FX.CONST.FILTER_METHOD;
            return t.method === e.RG || t.method === e.FM && t.defaultConfig && "custom" === t.defaultConfig.mode ? t.sizeY > t.minRow ? this.DEFAULT_SIZE.double : this.DEFAULT_SIZE.single : this.DEFAULT_SIZE.custom
        },
        getOptions: function() {
            var t = "date_filter"
                , e = this.options;
            return e.format && (t = FX.DashUtils.dateFormat2FilterType(e.format)),
                n.extend(FX.DashDate.superclass.getOptions.apply(this, arguments), {
                    type: t
                }, this.getEditConfig())
        }
    }),
        n.shortcut("dashdate", FX.DashDate)
}(jQuery),
function(c) {
    FX.DashCalendar = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.DashCalendar.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_calendar",
                onStopEdit: null,
                perPage: 50
            })
        },
        _init: function() {
            FX.DashCalendar.superclass._init.apply(this, arguments);
            var i = this
                , a = this.options;
            this.currentDate = null,
                this.dateMap = {},
                this.dayData = [],
                this.weekData = {},
                this._initPageData(),
                this.calendar = new FX.Calendar({
                    width: a.widget,
                    height: a.height,
                    renderEl: c("<div/>").appendTo(i.element),
                    pointDays: [],
                    viewMode: FX.CONST.CALENDAR_VIEWMODE[a.defaultLayout] || FX.CONST.CALENDAR_VIEWMODE.month,
                    onBlockContentCreate: function(t) {
                        i.$blockContent = t,
                            i.$dayContent = c('<div class="calendar-block-main"/>').on("click", function(t) {
                                if ("visit" !== a.mode)
                                    return t.preventDefault(),
                                        !1;
                                var e = c(t.target).closest(".main-item");
                                e && e.length && i._createFormData(e.index(), i.dayData)
                            }).appendTo(t)
                    },
                    onWeekContentCreate: function(t, e) {
                        i.dateMap = c.extend({}, t),
                            i.$weekContent = e,
                            i._renderWeekContent()
                    },
                    onDateUpdate: function() {
                        var t = this.getValue();
                        i._renderDayContent(t)
                    }
                })
        },
        _initPageData: function() {
            this.page = 0,
                this.loading = !1,
                this.hasMore = !0
        },
        _bindLoadMore: function(t, e) {
            var i = t.next(".btn-load-more");
            this.hasMore ? i.length || c('<div class="btn-load-more">' + i18next.t("loadMore") + "</div>").on("click", function() {
                e && e()
            }).insertAfter(t) : i.length && i.remove()
        },
        _getFormAttr: function(e) {
            var i = this.options;
            this._fetch({
                url: FX.Utils.getApi(FX.API.form.get, FX.STATIC.APPID, i.form)
            }, function(t) {
                c.extend(i, {
                    formAttr: t.entry
                }),
                e && e()
            })
        },
        _getDailyData: function(e, i) {
            var a = this.options
                , n = this;
            this.loading || (this.loading = !0,
                this._fetch(this._getFetchConfig("daily", {
                    date: FX.Utils.date2Str(e),
                    skip: this.page * a.perPage,
                    limit: a.perPage
                }), function(t) {
                    n.page++,
                        n.hasMore = t.data.length === a.perPage,
                    t.data && t.data.length && FX.Utils.forEach(t.data, function(t, e) {
                        c('<div class="main-item"/>').text(FX.Utils.isEmpty(e.label) ? i18next.t("unnamedData") : e.label).appendTo(n.$dayContent)
                    }),
                        n.dayData = n.dayData.concat(t.data),
                        n._bindLoadMore(n.$dayContent, function() {
                            n._getDailyData(e)
                        }),
                    i && i(t)
                }, function() {
                    n.loading = !1
                }))
        },
        _getWeeklyData: function(t) {
            var i, s = this, r = this.options;
            this.loading || (this.loading = !0,
                i = [],
                FX.Utils.forEach(Object.keys(this.dateMap), function(t, e) {
                    i.push(e)
                }),
                s._fetch(s._getFetchConfig("weekly", {
                    dates: i,
                    skip: this.page * r.perPage,
                    limit: r.perPage
                }), function(e) {
                    s.page++,
                        s.hasMore = !1;
                    var n = 0;
                    FX.Utils.forEach(s.dateMap, function(i, t) {
                        var a = c(".calendar-block-main", t);
                        a.length || (a = c('<div class="calendar-block-main"/>').on("click", function(t) {
                            if ("visit" !== r.mode)
                                return t.preventDefault(),
                                    !1;
                            var e, i = c(t.target).closest(".main-item");
                            i && i.length && (e = i.data("day"),
                                s._createFormData(i.index(), s.weekData[e]))
                        }).appendTo(t)),
                            s.weekData[i] ? s.weekData[i] = s.weekData[i].concat(e.data[i]) : s.weekData[i] = e.data[i] || [],
                        e.data[i] && e.data[i].length === r.perPage && (s.hasMore = !0),
                            FX.Utils.forEach(e.data[i], function(t, e) {
                                c('<div class="main-item"/>').data("day", i).text(FX.Utils.isEmpty(e.label) ? i18next.t("unnamedData") : e.label).appendTo(a)
                            }),
                            n = Math.max(t.outerHeight(), n)
                    }),
                        FX.Utils.forEach(s.dateMap, function(t, e) {
                            e.css("min-height", n)
                        }),
                        s._bindLoadMore(s.$weekContent, function() {
                            s._getWeeklyData()
                        }),
                    t && t(e)
                }, function() {
                    s.loading = !1
                }))
        },
        _renderDayContent: function(t, e) {
            var i, a = this, n = this.options, s = !1;
            this.currentDate && (s = FX.Utils.date2Str(this.currentDate) === FX.Utils.date2Str(t)),
            !e && s || (this._initPageData(),
                this.dayData = [],
                this.$dayContent.empty(),
                this._getDailyData(t, function(t) {
                    t.data.length || (c('<div class="empty-content">' + i18next.t("dash.calendar.empty") + "</div>").appendTo(a.$dayContent),
                        a.dayData = []),
                        FX.Utils.applyFunc(a, n.onAfterWidgetUpdate, [{
                            dataPerms: t.dataPerms
                        }], !1)
                }),
                i = this._getDateRange(t, e),
                this.currentDate = new Date(t),
            FX.Utils.isObjectEmpty(i) || this._fetch(this._getFetchConfig("monthly", {
                dateRange: i
            }), function(t) {
                a.calendar.setPointDays(t.dates)
            }))
        },
        _renderWeekContent: function() {
            var e = this
                , i = this.options;
            this._initPageData(),
                this.weekData = {},
                this._getWeeklyData(function(t) {
                    FX.Utils.applyFunc(e, i.onAfterWidgetUpdate, [{
                        dataPerms: t.dataPerms
                    }], !1)
                })
        },
        _getDateRange: function(t, e) {
            t = t || new Date;
            var i = !1;
            if (this.currentDate && (i = FX.Utils.date2Str(this.currentDate, "yyyy-MM") === FX.Utils.date2Str(t, "yyyy-MM")),
            !e && i)
                return [];
            var a = new Date(t.getFullYear(),t.getMonth(),1)
                , n = new Date(t.getFullYear(),t.getMonth(),FX.Utils.getMonthDays(t.getFullYear(), t.getMonth()));
            return [FX.Utils.date2Str(a), FX.Utils.date2Str(n)]
        },
        _fetch: function(t, e, i) {
            var a = this.options
                , n = this;
            a.widgetId ? FX.Utils.dataAjax(t, function(t) {
                e && e(t),
                    FX.Utils.applyFunc(n, a.onLoadSuccess, [t], !1)
            }, function(t) {
                FX.Utils.applyFunc(n, a.onLoadFail, [t], !1)
            }, i) : FX.Utils.applyFunc(this, a.onLoadNull, [], !1)
        },
        _getDataConfig: function(t) {
            var e = this.options;
            return "visit" === e.mode ? c.extend({
                widgetId: e.widgetId,
                filter: this._getFilter()
            }, t) : c.extend({
                widget: {
                    widgetId: e.widgetId,
                    title: e.title,
                    type: "calendar_manage",
                    form: e.form,
                    dateField: e.dateField,
                    permission: e.permission,
                    filter: this._getFilter(),
                    posX: e.posX,
                    posY: e.posY,
                    width: e.width,
                    height: e.height
                }
            }, t)
        },
        _getFilter: function() {
            var t = this.options
                , e = []
                , i = FX.Utils.applyFunc(this, t.onDataFilter, [], !1);
            return i && (e = e.concat(i)),
            FX.Utils.isObjectEmpty(t.filter && t.filter.cond) || (e = e.concat(t.filter.cond)),
                {
                    rel: FX.CONST.FILTER_RELATION.AND,
                    cond: e
                }
        },
        _getFetchConfig: function(t, e) {
            var i = "visit" === this.options.mode ? FX.API : FX._API;
            return {
                daily: {
                    url: FX.Utils.getApi(i.dash.get_daily_data),
                    data: this._getDataConfig(e)
                },
                weekly: {
                    url: FX.Utils.getApi(i.dash.get_weekly_data),
                    data: this._getDataConfig(e)
                },
                monthly: {
                    url: FX.Utils.getApi(i.dash.get_monthly_data),
                    data: this._getDataConfig(e)
                }
            }[t]
        },
        _createFormData: function(t, e) {
            var i = c('<div class="x-window-mask modal light scrollable"/>').css({
                "z-index": FX.STATIC.zIndex++
            }).appendTo("body");
            c(document).bind("keydown.left keydown.right", function(t) {
                return c(".x-window-mask", "body").length ? (t.preventDefault(),
                    !1) : void c(document).unbind("keydown.left keydown.right")
            }),
                this._doShowData(i, t, e)
        },
        _doShowData: function(e, i, a) {
            var n = this.options
                , s = this
                , r = a[i];
            r && this._fetch({
                url: FX.Utils.getApi(FX.API.data.view),
                data: {
                    entryId: n.form,
                    formId: n.form,
                    dataId: r._id,
                    authGroupId: FX.CONST.DEFAULT_AUTH_GROUP
                }
            }, function(t) {
                FX.Utils.isObjectEmpty(n.formAttr) ? s._getFormAttr(function() {
                    s._renderFormData(e, i, a, r, t)
                }) : s._renderFormData(e, i, a, r, t)
            })
        },
        _renderFormData: function(e, t, i, a, n) {
            var s = this.options
                , r = this
                , o = n.data._dataPerms
                , l = {
                appId: FX.STATIC.APPID,
                comment: s.formAttr.comment,
                renderEl: c("<div class='x-shadow-content'/>").appendTo(e),
                formId: s.form,
                entryId: s.form,
                dataId: a._id,
                height: "100%",
                title: s.title,
                needFetchViewData: !1,
                hasCopyBtn: o.copy || o.flow_copy,
                hasPrintBtn: !0,
                hasEditBtn: r._isDataEditable(n.data._dataPerms),
                hasDeleteBtn: !1 !== n.data._dataPerms.delete || !1 !== n.data._dataPerms.flow_delete,
                hasSwitchBtn: !0,
                hasCustomPrint: !0,
                hasShareBtn: !0,
                hasShowFieldsBtn: !0,
                dataIndex: t + 1,
                dataCount: i.length,
                header: n.fields,
                data: n.data,
                dataPerms: n.data._dataPerms,
                authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                printList: n.printList,
                tabs: n.form.tabs,
                onClose: function() {
                    e.remove()
                },
                onAfterCopyData: function(t) {
                    r.reload(),
                        e.remove()
                },
                onAfterEditData: function() {
                    e.empty(),
                        r._doShowData(e, t, i),
                        r.reload()
                },
                onSwitchData: function(t) {
                    i[t - 1] && (e.empty(),
                        r._doShowData(e, t - 1, i))
                },
                onAfterDeleteData: function() {
                    e.remove(),
                        r.reload()
                }
            };
            s.formAttr.hasCoop ? (c.extend(l, {
                isPublicData: s.formAttr.isPublicData,
                publicDataUrlPrefix: FX.CONFIG.HOST.SITE_SHORT_HOST + "/l/" + s.formAttr._id
            }),
                new FX.CoopFormDataPane(l)) : (c.extend(l, {
                hasFlow: !0,
                flow: FX.Utils.getFlowOption(n, "part"),
                hasDataLog: !0
            }),
                new FX.FlowFormDataPane(l))
        },
        _isDataEditable: function(t) {
            return this.options.formAttr.hasCoop ? !1 !== t.update : !1 !== t.flow_update
        },
        doResize: function(t) {
            var i;
            FX.DashCalendar.superclass.doResize.apply(this, arguments),
            this.calendar && (this.calendar.doResize(t),
            1 === this.calendar.getViewMode() && (i = Math.max(this.$weekContent.parent(".body-wrapper").outerHeight(), this.$weekContent.outerHeight()),
                FX.Utils.forEach(this.dateMap, function(t, e) {
                    e.css("min-height", i)
                })))
        },
        reload: function() {
            if (this.calendar)
                switch (this.calendar.getViewMode()) {
                    case 0:
                        this.$dayContent.empty(),
                            this._renderDayContent(this.currentDate, !0);
                        break;
                    case 1:
                        FX.Utils.forEach(this.dateMap, function(t, e) {
                            e.empty()
                        }),
                            this._renderWeekContent(this.dateMap)
                }
        },
        getEditConfig: function() {
            var t = this.options;
            return {
                type: "calendar_manage",
                form: t.form,
                dateField: t.dateField,
                permission: t.permission,
                defaultLayout: t.defaultLayout,
                defaultMobileLayout: t.defaultMobileLayout,
                filter: t.filter
            }
        },
        doDataCreate: function() {
            var t = this.options
                , e = this;
            FX.Utils.isObjectEmpty(t.formAttr) ? this._getFormAttr(function() {
                e._createData()
            }) : this._createData()
        },
        _createData: function() {
            var t = this.options
                , e = this
                , i = c('<div class="x-window-mask modal light"/>').css({
                "z-index": FX.STATIC.zIndex++
            }).appendTo("body")
                , a = t.formAttr.submit_prompt.hasLastContent
                , n = FX.Utils.getSubmitFormDataKey(t.formAttr.appId, t.formAttr.entryId)
                , s = FX.Utils.getSaveContentCheckKey(t.formAttr.appId, t.formAttr.entryId);
            new FX.Form(c.extend({}, t.formAttr.content, {
                renderEl: c("<div class='x-shadow-content'/>").appendTo(i),
                title: t.formAttr.name,
                appId: t.formAttr.appId,
                entryId: t.formAttr.entryId,
                buttonPosition: "middle",
                height: "100%",
                submitText: i18next.t("submit"),
                items: t.formAttr.content.items,
                authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                validators: t.formAttr.content.validators,
                multiTabs: t.formAttr.tabs,
                formEvents: t.formAttr.formEvents,
                copyValue: FX.Utils.getCopyValue(a, n, s),
                hasLastContent: a,
                onSuccess: function(t) {
                    FX.Utils.dealSubmitFormData(this.hasContentCheck, n, t.data),
                        FX.Msg.toast({
                            msg: i18next.t("submit.success"),
                            type: "success"
                        }),
                        i.remove(),
                        e.reload()
                },
                onAfterCancel: function() {
                    i.remove()
                }
            }))
        },
        doExcelImport: function() {
            function t() {
                new FX.ExcelImportPane({
                    formId: e.form,
                    formName: e.formAttr.name,
                    formItems: FX.Utils.getEditableFormItems(e.formAttr.content.items),
                    authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                    hasCoop: e.formAttr.hasCoop,
                    mustLaunchFlow: !0,
                    onFinish: function() {
                        i.reload()
                    }
                }),
                e.formAttr.hasCoop || FX.Utils.dt(FX.CONST.TRACKER.MEMBER_FLOW_IMPORT)
            }
            var e = this.options
                , i = this;
            FX.Utils.isObjectEmpty(e.formAttr) ? this._getFormAttr(function() {
                t()
            }) : t()
        }
    }),
        c.shortcut("dashcalendar", FX.DashCalendar)
}(jQuery),
function(c) {
    FX.DashDataManageTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.DashDataManageTable.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_data_manage",
                form: "",
                widgetId: "",
                filter: {},
                permission: "form",
                itemsPerPage: 20,
                title: "",
                mode: "visit",
                onAfterWidgetUpdate: null,
                onHeadToolUpdate: null
            })
        },
        _init: function() {
            FX.DashDataManageTable.superclass._init.apply(this, arguments);
            var t = this.options;
            this.$body = c('<div class="x-block-body"/>').appendTo(this.element),
                this.$footer = c('<div class="x-block-footer"/>').appendTo(this.element),
                this.sort = [],
                this.page = 1,
                this.count = null,
                this.API = "visit" === t.mode ? FX.API : FX._API,
                this.fields = this._getCachedFields(),
                this._initTable()
        },
        _initTable: function() {
            var i = this
                , a = this.options;
            this._loadData(function(t, e) {
                i._createTable(t, e),
                    FX.Utils.applyFunc(i, a.onAfterWidgetUpdate, [{
                        dataPerms: i.dataPerms
                    }], !1)
            })
        },
        _getCachedFields: function() {
            return FX.Store.get(this._getFieldCacheKey())
        },
        _updateCachedFields: function() {
            FX.Store.set(this._getFieldCacheKey(), this.fields)
        },
        _getFieldCacheKey: function() {
            var t = this.options;
            return FX.Store.getKey("dashShowFields", {
                appId: FX.STATIC.APPID,
                entryId: FX.STATIC.ENTRYID,
                widgetId: t.widgetId
            })
        },
        _loadData: function(e) {
            var t, i, a = this, n = this.options;
            n.widgetId ? (t = {
                permission: n.permission,
                skip: (this.page - 1) * n.itemsPerPage,
                limit: n.itemsPerPage,
                sort: this.sort,
                filter: this._getFilter(),
                fields: this.fields,
                hasAllFields: FX.Utils.isNull(this.allFields)
            },
            "visit" === n.mode || (t.widget = n.widget),
                t.widgetId = n.widgetId,
                i = FX.Utils.createSkeletonSpin(this.element),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(this.API.dash.manage_list),
                    data: t
                }, function(t) {
                    a.dataPerms = t.dataPerms,
                    FX.Utils.isNull(a.allFields) && (a.allFields = t.allFields),
                    FX.Utils.isNull(a.fields) && (a.fields = a.allFields),
                    e && e(t.header, t.data),
                        FX.Utils.applyFunc(a, n.onLoadSuccess, [t], !1)
                }, function(t) {
                    FX.Utils.applyFunc(a, n.onLoadFail, [t], !1)
                }, function() {
                    i.remove()
                })) : FX.Utils.applyFunc(this, n.onLoadNull, [], !1)
        },
        _loadFormAttr: function(e) {
            var i = this
                , t = this.options;
            FX.Utils.ajax({
                url: FX.Utils.getApi(this.API.form.get, FX.STATIC.APPID, t.form)
            }, function(t) {
                i.formAttr = t.entry,
                    FX.Utils.applyFunc(i, e, [], null)
            })
        },
        _createTable: function(t, e) {
            var i = this
                , a = this.options;
            this.header = t,
                this.processor = new FX.DataTableProcessor({
                    header: t,
                    data: e,
                    sort: this.sort,
                    showNoAuthCell: !0,
                    hasCheck: this.hasCheck,
                    colSizeMap: this._getColSizeMap(),
                    resizable: "preview" !== a.mode,
                    dataHasCheck: function(t) {
                        return "delete" !== i.checkType || FX.Utils.isNull(t._dataPerms) ? !("edit" === i.checkType && !FX.Utils.isNull(t._dataPerms)) || (t._dataPerms.batch_update || t._dataPerms.flow_batch_update) : t._dataPerms.delete || t._dataPerms.flow_delete
                    }
                }),
                this.table = this._doCreateTable(),
                this._loadCount(function() {
                    i._createPagination()
                })
        },
        _getColSizeMap: function() {
            var t = this._getColSizeMapKey();
            return FX.Store.get(t) || {}
        },
        _updateColSize: function(t, e) {
            var i = this._getColSizeMapKey()
                , a = this._getColSizeMap();
            a[t] = e,
                FX.Store.set(i, a)
        },
        _getColSizeMapKey: function() {
            var t = this.options;
            return FX.Store.getKey("colSizeMap", {
                appId: FX.STATIC.APPID,
                entryId: FX.STATIC.ENTRYID,
                widgetId: t.widgetName
            })
        },
        _doCreateTable: function() {
            var i = this
                , e = this.options;
            return this.$body.empty(),
                new FX.PlainTable(c.extend({
                    renderEl: this.$body,
                    isHeadSticky: !0,
                    isRowHeadSticky: !0,
                    resizable: "preview" !== e.mode,
                    onHeadCellClick: function(t) {
                        t.hasClass("sortable") && i._sortTable(t)
                    },
                    onRowClick: function(t) {
                        "visit" !== e.mode || FX.Utils.getSelectionText() || i._doShowData(t.data("idx"))
                    },
                    onMouseOverRow: function(t) {
                        var e = t.attr("data-idx");
                        FX.Utils.isNull(e) || c('tbody > tr[data-idx="' + e + '"]', i.$body).addClass("hover")
                    },
                    onMouseOutRow: function(t) {
                        var e = t.attr("data-idx");
                        FX.Utils.isNull(e) || c('tbody > tr[data-idx="' + e + '"]', i.$body).removeClass("hover")
                    },
                    onRowCreate: function(t, e) {
                        t.attr("data-idx", i.processor.getDataIdxByRow(e))
                    },
                    onColSizeChange: function(t, e) {
                        i._updateColSize(t, e)
                    },
                    onCheckHover: function() {
                        var t = "";
                        return "delete" === i.checkType ? t = i18next.t("data.delete.noAuth.tip") : "edit" === i.checkType && (t = i18next.t("data.edit.noAuth.tip")),
                            t
                    }
                }, this._getTableRenderData()))
        },
        _getTableRenderData: function() {
            return this.processor.getTable()
        },
        _loadCount: function(t) {
            var e, i = this, a = this.options;
            FX.Utils.isNull(this.count) ? (e = {
                filter: this._getFilter()
            },
                "visit" === a.mode ? e.widgetId = a.widgetId : e.widget = a.widget,
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(this.API.dash.count),
                    data: e,
                    hasCountLimit: !0,
                    timeout: FX.CONST.DATA_COUNT_TIMEOUT
                }, function(t) {
                    i.count = t.count
                }, function() {}, function() {
                    FX.Utils.applyFunc(i, t, [], null)
                })) : FX.Utils.applyFunc(this, t, [], null)
        },
        _createPagination: function() {
            var a = this
                , n = this.options;
            this.$footer.empty();
            var t = {
                filter: this._getFilter(),
                hasLimit: !1
            };
            "visit" === n.mode ? t.widgetId = n.widgetId : t.widget = n.widget;
            var e = this.processor.getDataCount() >= n.itemsPerPage;
            new FX.Pagination({
                renderEl: c("<div />").appendTo(this.$footer),
                customCls: "dash-pagination",
                count: a.count,
                limit: n.itemsPerPage,
                curPage: a.page,
                hasMore: e,
                showCount: !0,
                onChangePage: function(t) {
                    a.page = t,
                        a.reload(!0)
                },
                onLimitChange: function(t) {
                    n.itemsPerPage = t,
                        a.page = 1,
                        a.reloadWithoutCount()
                },
                fetchCount: function(e) {
                    var i = this
                        , t = {
                        filter: a._getFilter(),
                        hasLimit: !1
                    };
                    "visit" === n.mode ? t.widgetId = n.widgetId : t.widget = n.widget,
                        FX.Utils.dataAjax({
                            url: FX.Utils.getApi(a.API.dash.count),
                            data: t,
                            hasCountLimit: !1
                        }, function(t) {
                            a.count = t.count,
                                FX.Utils.applyFunc(i, e, [t.count], null)
                        }, function() {
                            FX.Utils.applyFunc(i, e, [], null)
                        })
                }
            })
        },
        _sortTable: function(t) {
            var e, i, a, n = t.data("field");
            n && (e = {},
                i = this.getSortedFieldIdx(n),
                a = FX.CONST.SORT,
                t.hasClass("sort-asc") ? (t.removeClass("sort-asc").addClass("sort-desc"),
                    e[n] = a.DESC,
                    -1 < i ? this.sort[i] = e : this.sort.push(e)) : t.hasClass("sort-desc") ? (t.removeClass("sort sort-desc"),
                -1 < (i = this.getSortedFieldIdx(n)) && this.sort.splice(i, 1)) : (t.removeClass("sort-desc").addClass("sort sort-asc"),
                    i = this.getSortedFieldIdx(n),
                    e[n] = a.ASC,
                    -1 < i ? this.sort[i] = e : this.sort.push(e)),
                this.page = 1,
                this.reloadWithoutCount())
        },
        _doShowData: function(t, e) {
            var i = this;
            FX.Utils.isObjectEmpty(this.formAttr) ? this._loadFormAttr(function() {
                i._createFormData(t, e)
            }) : this._createFormData(t, e)
        },
        _createFormData: function(t, e) {
            var i, a, n, s, r, o, l = this.processor.getDataByIdx(t);
            FX.Utils.isNull(l) || (a = (i = this).options,
                n = this.header,
                s = l._dataPerms,
                this._switchCurrentRow(t),
                r = c('<div class="x-window-mask modal light scrollable"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body"),
                c(document).bind("keydown.left keydown.right", function(t) {
                    return c(".x-window-mask", "body").length ? (t.preventDefault(),
                        !1) : void c(document).unbind("keydown.left keydown.right")
                }),
                o = {
                    API: this.API,
                    appId: FX.STATIC.APPID,
                    comment: this.formAttr.comment,
                    renderEl: c('<div class="x-shadow-content"/>').appendTo(r),
                    formId: a.form,
                    entryId: a.form,
                    authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                    header: n,
                    data: l,
                    dataId: l._id,
                    dataPerms: s,
                    height: "100%",
                    title: a.title,
                    hasCopyBtn: s.copy || s.flow_copy,
                    hasPrintBtn: !0,
                    hasShareBtn: !0,
                    hasEditBtn: this._isDataEditable(s),
                    hasDeleteBtn: !1 !== s.delete || !1 !== s.flow_delete,
                    hasSwitchBtn: !0,
                    hasCustomPrint: !0,
                    dataIndex: t + 1,
                    dataCount: this.processor.getDataCount(),
                    needFetchViewData: !0,
                    publicDataUrlPrefix: FX.CONFIG.HOST.SITE_SHORT_HOST + "/l/" + this.formAttr._id,
                    onAfterLoadData: function() {
                        e && i.formData._doEditData()
                    },
                    onAfterCopyData: function(t) {
                        i.reload(!0),
                            r.remove()
                    },
                    onAfterEditData: function() {
                        r.remove(),
                            i.reloadWithoutCount(!0),
                            i._doShowData(t)
                    },
                    onSwitchData: function(t, e) {
                        i.processor.getDataByIdx(t - 1) && r.parent().length && (r.remove(),
                            i._doShowData(t - 1, e))
                    },
                    onAfterDeleteData: function() {
                        i.reload(!0),
                            r.remove()
                    },
                    onAfterCancel: function() {
                        r.remove(),
                            i._doShowData(t)
                    },
                    onClose: function(t) {
                        r.remove(),
                        t && i.reload(!0)
                    }
                },
                this.formAttr.hasCoop ? (o.isPublicData = this.formAttr.isPublicData,
                    this.formdata = new FX.CoopFormDataPane(o)) : (o.hasFlow = !0,
                    o.hasDataLog = !0,
                    this.formdata = new FX.FlowFormDataPane(o)))
        },
        doDataCreate: function() {
            var t = this;
            FX.Utils.isObjectEmpty(this.formAttr) ? this._loadFormAttr(function() {
                t._createData()
            }) : this._createData()
        },
        _createData: function() {
            var e = this
                , i = (this.options,
                c('<div class="x-window-mask modal light"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body"))
                , t = this.formAttr.submit_prompt.hasLastContent
                , a = FX.Utils.getSubmitFormDataKey(this.formAttr.appId, this.formAttr.entryId)
                , n = FX.Utils.getSaveContentCheckKey(this.formAttr.appId, this.formAttr.entryId);
            new FX.Form(c.extend(this.formAttr.content, {
                renderEl: c('<div class="x-shadow-content"/>').appendTo(i),
                API: this.API,
                appId: this.formAttr.appId,
                entryId: this.formAttr.entryId,
                title: this.formAttr.name,
                authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                items: this.formAttr.content.items,
                buttonPosition: "middle",
                height: "100%",
                submitText: i18next.t("submit"),
                multiTabs: this.formAttr.tabs,
                formEvents: this.formAttr.formEvents,
                copyValue: FX.Utils.getCopyValue(t, a, n),
                hasLastContent: t,
                onSuccess: function(t) {
                    FX.Utils.dealSubmitFormData(this.hasContentCheck, a, t.data),
                        FX.Msg.toast({
                            msg: i18next.t("submit.success"),
                            type: "success"
                        }),
                        i.remove(),
                        e.reload(!0)
                },
                onAfterCancel: function() {
                    i.remove()
                }
            }))
        },
        _isDataEditable: function(t) {
            return this.formAttr.hasCoop ? !1 !== t.update : !1 !== t.flow_update
        },
        _switchCurrentRow: function(t) {
            c("tbody > tr", this.element).removeClass("current-row"),
                c('tbody > tr[data-idx="' + t + '"]', this.element).addClass("current-row")
        },
        getSortedFieldIdx: function(i) {
            var a = -1;
            return FX.Utils.forEach(this.sort, function(t, e) {
                if (e)
                    return e[i] ? (a = t,
                        !1) : void 0
            }),
                a
        },
        reload: function(t, e) {
            var i = !e;
            t || (this.page = 1),
            i && (this.count = null),
                this._initTable()
        },
        reloadWithoutCount: function(t) {
            this.reload(t, !0)
        },
        doResize: function() {
            FX.DashDataManageTable.superclass.doResize.apply(this, arguments),
            this.table && this.table.doResize()
        },
        getEditConfig: function() {
            var t = this.options;
            return {
                type: "data_manage",
                form: t.form,
                filter: t.filter
            }
        },
        doExcelExport: function() {
            var t, i, a, n, e = this.options;
            e.form && (t = c.extend(!0, [], this.header),
                i = -1,
                FX.Utils.forEach(t, function(t, e) {
                    if ("chargers" === e.type)
                        return i = t,
                            e.format = "currentNodes",
                            e.text = i18next.t("flow.node.current"),
                            !1
                }),
            -1 < i && t.splice(i + 1, 0, {
                name: "chargers",
                type: "chargers",
                format: "chargers",
                text: i18next.t("flow.charger.current")
            }),
                a = FX.LimitFields.excelExport.concat(["flowState", "chargers"]),
                n = [],
                FX.Utils.forEach(this.allFields, function(t, e) {
                    var i;
                    "subform" === e.type ? (i = [],
                        FX.Utils.forEach(e.items, function(t, e) {
                            -1 < a.indexOf(e.type) && i.push(e)
                        }),
                        n.push(c.extend(!0, {}, e, {
                            items: i
                        }))) : -1 < a.indexOf(e.type) && n.push(e)
                }),
                new FX.ExcelExportPane({
                    fields: n,
                    selectedFields: this.fields,
                    filter: this._getFilter(),
                    baseFilter: this._getWidgetFilter(),
                    entryId: e.form,
                    name: [e.dashTitle, e.title].join(FX.CONST.DASH_CHART_TITLE_DELIMITER),
                    authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                    exportURL: FX.Utils.getApi(this.API.data.find_excel_export),
                    sort: this.sort
                }).show())
        },
        doExcelImport: function() {
            function t() {
                new FX.ExcelImportPane({
                    API: e.API,
                    formId: i.form,
                    formName: e.formAttr.name,
                    formItems: FX.Utils.getEditableFormItems(e.formAttr.content.items),
                    authGroupId: FX.CONST.DEFAULT_AUTH_GROUP,
                    hasCoop: e.formAttr.hasCoop,
                    mustLaunchFlow: !0,
                    onFinish: function() {
                        e.reload()
                    }
                }),
                e.formAttr.hasCoop || FX.Utils.dt(FX.CONST.TRACKER.MEMBER_FLOW_IMPORT)
            }
            var e = this
                , i = this.options;
            FX.Utils.isObjectEmpty(this.formAttr) ? this._loadFormAttr(function() {
                t()
            }) : t()
        },
        onDataDelete: function() {
            var t = this.options;
            this.checkType = "delete",
                this.processor.setHasCheck(!0),
                this.table.reload(),
                FX.Utils.applyFunc(this, t.onHeadToolUpdate, [], null)
        },
        doDataDeleteSelected: function() {
            this._deleteCheckResult(this.getCheckResult())
        },
        doCancel: function() {
            this.hasCheck = !1,
                this.checkType = "",
                this.processor.setHasCheck(!1),
                this.reload()
        },
        doSetFields: function(t) {
            var e, i = this;
            FX.Utils.isNull(this.fields) || (e = FX.Utils.getShowFieldItems(this.fields, this.allFields),
                FX.Utils.addClsToSystemField(e, "field-system"),
                new FX.ComboCheckBox({
                    renderEl: t,
                    items: e,
                    width: null,
                    height: null,
                    onElementCreate: function() {
                        return !0
                    },
                    onAfterTriggerHide: function() {
                        i.fields = FX.Utils.getShowFieldsByNames(i.allFields, this.getValue()),
                            i._updateCachedFields(),
                            i.reloadWithoutCount()
                    },
                    onAfterItemCreate: function(t, e, i) {
                        i.addClass(t.cls)
                    }
                })._onTriggerClick())
        },
        doBatchUpdate: function() {
            this.hasCheck = !0,
                this.checkType = "edit",
                this.processor.setHasCheck(!0),
                this.table.reload()
        },
        isAllFieldsShow: function() {
            return FX.Utils.getFlatLengthByFields(this.fields) === FX.Utils.getFlatLengthByFields(this.allFields)
        },
        getCheckResult: function() {
            return this.table.getCheckResult()
        },
        _getWidgetFilter: function() {
            var t = this.options
                , e = [];
            return FX.Utils.isObjectEmpty(t.filter.cond) || (e = e.concat(t.filter.cond)),
                {
                    rel: FX.CONST.FILTER_RELATION.AND,
                    cond: e
                }
        },
        _getFilter: function() {
            var t = this.options
                , e = []
                , i = FX.Utils.applyFunc(this, t.onDataFilter, [], !1);
            return i && (e = e.concat(i)),
            FX.Utils.isObjectEmpty(t.filter.cond) || (e = e.concat(t.filter.cond)),
                {
                    rel: FX.CONST.FILTER_RELATION.AND,
                    cond: e
                }
        },
        _deleteCheckResult: function(e) {
            var t, i, a = this, n = this.options, s = e.length;
            FX.Vip.hasDataBackup() ? t = i18next.t("dataTable.deleteTip", {
                length: '<span class="text warning" >' + s + "</span>"
            }) : (t = i18next.t("dataTable.deleteTipForFree", {
                length: '<span class="text warning" >' + s + "</span>"
            }),
                i = c('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                FX.Msg.alert({
                    title: i18next.t("dataTable.deleteAllSelectDataTip"),
                    msg: t,
                    tip: i,
                    type: "warning",
                    onOk: function() {
                        var t = {
                            entryId: n.form,
                            formId: n.form,
                            authGroupId: FX.CONST.DEFAULT_AUTH_GROUP
                        };
                        FX.Utils.isObjectEmpty(e) || (t.idList = e,
                            FX.Utils.dataAjax({
                                url: FX.Utils.getApi(a.API.data.remove),
                                data: t
                            }, function() {
                                this.checkType = "",
                                    a.processor.setHasCheck(!1),
                                    a.reload()
                            }))
                    }
                })
        }
    }),
        c.shortcut("dashdatamanagetable", FX.DashDataManageTable)
}(jQuery),
function(d) {
    FX.DashMetricTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return d.extend(FX.DashMetricTable.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_metric_table",
                widgetName: "",
                form: null,
                xFields: [],
                valueFields: [],
                filter: {},
                thresholds: [],
                componentAttr: null,
                top: {},
                mode: "edit",
                title: i18next.t("dash.chart.unnamed"),
                valueMinSize: 25,
                defaultSort: [],
                onDataFilter: null,
                onLoadFail: null
            })
        },
        _init: function() {
            FX.DashMetricTable.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.dashSort || (this.dashSort = new FX.DashSort({
                sorts: t.defaultSort,
                onChange: function() {
                    e.reload()
                }
            }));
            var i = FX.Utils.createSkeletonSpin(this.element);
            this._fetchData(function(t) {
                i.remove(),
                    e.data = t,
                    e._initContent()
            })
        },
        _fetchData: function(e) {
            var t, i, a, n = this.options, s = this;
            if (FX.Utils.isObjectEmpty(n.valueFields)) {
                n.xFields = [];
                return FX.Utils.applyFunc(this, n.onLoadNull, [], !1),
                e && e({
                    val: [{
                        sum: 2e6
                    }]
                })
            }
            "visit" !== n.mode ? (t = FX.Utils.getApi(FX._API.dash.preview_combined_group),
                a = {
                    widget: i = d.extend({
                        form: n.form,
                        xFields: n.xFields,
                        yFields: [],
                        metrics: n.valueFields,
                        filter: this._getFilter(),
                        type: n.chartType,
                        top: n.top,
                        defaultSort: n.defaultSort
                    }, n.componentAttr)
                },
            this.hasSort && (i.defaultSort = this.dashSort.getSorts())) : (t = FX.Utils.getApi(FX.API.dash.combined_group),
                a = {
                    widgetId: n.widgetName,
                    filter: this._getFilter()
                },
            this.hasSort && (a.sort = this.dashSort.getSorts())),
                FX.Utils.dataAjax({
                    url: t,
                    data: a
                }, function(t) {
                    s.resData = t,
                    e && e(t.data),
                        FX.Utils.applyFunc(s, n.onLoadSuccess, [t], !1)
                }, function(t) {
                    FX.Utils.applyFunc(s, n.onLoadFail, [t], !1)
                })
        },
        _getFilter: function() {
            var t = this.options
                , e = []
                , i = FX.Utils.applyFunc(this, t.onDataFilter, [], !1);
            return i && (e = e.concat(i)),
            FX.Utils.isObjectEmpty(t.filter.cond) || (e = e.concat(t.filter.cond)),
                {
                    rel: FX.CONST.FILTER_RELATION.AND,
                    cond: e
                }
        },
        _initContent: function() {
            this.element.empty(),
                this._hasDimension() ? this._createOneDimensionTable() : (this._createNoDimensionTable(),
                    this.doResize(),
                    this._setTheme())
        },
        _hasDimension: function() {
            return 0 < this.options.xFields.length
        },
        _shouldShowSummaryRow: function() {
            var t = this.options;
            return !(t.top && t.top.enable && t.top.limit)
        },
        _createOneDimensionTable: function() {
            var i = this
                , a = this.options
                , n = this.data && this.data.val
                , t = this.data && this.data.x;
            this.element.addClass("one-dimension"),
                this.$contentWrapper = d('<div class="content-wrapper one-dimension"/>').appendTo(this.element);
            var e, s, r, o, l, c = d('<div class="number-lines"/>').appendTo(this.$contentWrapper);
            this._shouldShowSummaryRow() && (e = d('<div class="line sum"><div class="left">' + i18next.t("total") + '</div><div class="right"/></div>').appendTo(c)),
                FX.Utils.isObjectEmpty(n) || FX.Utils.isObjectEmpty(t) ? e && d(".right", e).text("0") : (s = n[0].sum,
                    r = t[0].data,
                    o = n[0].data,
                    l = a.xFields[0],
                e && d(".right", e).text(this._formatData(s)),
                    FX.Utils.forEach(r, function(t, e) {
                        d('<div class="line number"/>').append(d('<div class="left"/>').text(i._formatLabel(e, l))).append(d('<div class="right"/>').toggleClass("show-alert", FX.DashUtils.checkThresholdAlert(o[t], n[0], a.thresholds)).text(i._formatData(o[t]))).appendTo(c)
                    }))
        },
        _formatLabel: function(i, t) {
            var a = i
                , e = this.resData;
            switch (t.type) {
                case "user":
                case "usergroup":
                    var n = e.user[i];
                    n && (a = n.nickname || "");
                    break;
                case "dept":
                case "deptgroup":
                    var s = e.department[i];
                    s && (a = s.name || "");
                    break;
                case "datetime":
                    var r = t.groupRule || "year"
                        , a = FX.Utils.date2GroupStr(i, r);
                    break;
                case "location":
                case "address":
                    a = "";
                    var o = t.groupRule && t.groupRule.split("_");
                    FX.Utils.forEach(o, function(t, e) {
                        FX.Utils.isEmpty(i[e]) || (a += i[e])
                    });
                    break;
                case "flowState":
                    a = FX.Utils.getFlowStateText(i)
            }
            return a
        },
        _createNoDimensionTable: function() {
            var t = this.options
                , e = this.data && this.data.val;
            this.element.addClass("no-dimension");
            var i = !FX.Utils.isObjectEmpty(e) && e[0].sum || 0
                , a = this._formatData(i);
            this.valFontCount = a.toString().length,
                this.$contentWrapper = d('<div class="content-wrapper">').append(d('<div class="inner-content"/>').append(d('<div class="sum"/>').attr("title", a).append(d('<span class="sum-val"/>').toggleClass("show-alert", FX.DashUtils.checkThresholdAlert(i, {
                    tag: t.valueFields[0] && t.valueFields[0].tag
                }, t.thresholds)).text(a)))).appendTo(this.element)
        },
        _formatData: function(t) {
            var e = this.options.valueFields[0];
            return e && e.format ? FX.Utils.num2Str(FX.Utils.fixDecimalPrecision(t), e.format) : FX.Utils.fixDecimalPrecision(t)
        },
        doResize: function(t) {
            if (FX.DashMetricTable.superclass.doResize.apply(this, arguments),
            !this._hasDimension() && this.$contentWrapper) {
                var e, i = this.options.valueSize, a = 0, a = t ? t.height : this.element.height();
                if (this.isFullScreen)
                    e = a / 3;
                else
                    switch (i) {
                        case "S":
                            e = a / 3;
                            break;
                        case "M":
                            e = a / 2;
                            break;
                        case "L":
                            e = a - 30;
                            break;
                        default:
                            e = a / 3
                    }
                this.$contentWrapper.height(e),
                    this._adjustFontSize()
            }
        },
        _adjustFontSize: function() {
            if (!this._hasDimension()) {
                this.outerW = this.$contentWrapper.width(),
                    this.outerH = this.$contentWrapper.height(),
                    this._initFontSize();
                var t = this.options
                    , e = d(".sum-val", this.$contentWrapper)
                    , i = this.valBaseSize;
                if (this._collisionCheck(this.outerW, this.outerH))
                    for (; this._collisionCheck(this.outerW, this.outerH) && (--i,
                        e.css({
                            fontSize: i + "px"
                        }),
                        !(i <= t.valueMinSize)); )
                        ;
                else {
                    for (; !this._collisionCheck(this.outerW, this.outerH); )
                        i += 1,
                            e.css({
                                fontSize: i + "px"
                            });
                    e.css({
                        fontSize: i - 1 + "px"
                    })
                }
            }
        },
        _initFontSize: function() {
            var t = this.options
                , e = d(".sum-val", this.$contentWrapper);
            this.valBaseSize = Math.max(t.valueMinSize, Math.min(this.outerW / this.valFontCount / .6, this.outerH / 1.2)),
                e.css({
                    fontSize: this.valBaseSize + "px"
                })
        },
        _collisionCheck: function(t, e) {
            var i = d(".sum-val", this.$contentWrapper)
                , a = i.height()
                , n = i.width();
            return e <= a || t <= n ? !0 : !1
        },
        _setTheme: function() {
            var t = this.options
                , e = {
                background: "#fff",
                color: "#1F2D3D"
            }
                , i = d(".sum", this.$contentWrapper);
            this._hasDimension() || 0 === t.valueFields.length || d.extend(e, {
                background: t.background && t.background.color,
                color: t.valueFields[0].color
            }),
                this.element.css("background", e.background),
                i.css("color", e.color)
        },
        reloadWithDataIrrelevantConfig: function(t) {
            d.extend(this.options, {
                valueFields: t.valueFields,
                background: t.background,
                valueSize: t.valueSize
            }),
                this._initContent()
        },
        reload: function() {
            this.rebuild()
        },
        doSort: function() {
            var t = this.options
                , e = this
                , i = FX.Utils.getDashSortFields(t.xFields).concat(FX.Utils.getDashQuotaSortFields(t.valueFields))
                , a = [];
            FX.Utils.forEach(t.xFields.concat(t.valueFields), function(t, e) {
                a.push(e.tag)
            });
            var n = new FX.ConfirmDialog({
                title: i18next.t("dash.sort.setting"),
                width: 600,
                text4Ok: i18next.t("sort"),
                hasSeparator: !0,
                onContentCreate: function(t) {
                    e.dashChartSort = new FX.DashChartSortPane({
                        renderEl: t,
                        sorts: e.dashSort.getSorts(),
                        fields: i,
                        incompatibleTags: a,
                        hideCustomSort: !0
                    })
                },
                onOk: function() {
                    var t = e.dashChartSort.getSorts();
                    e.hasSort = !0,
                        e.dashSort.reset(t),
                        n.close()
                }
            });
            n.show()
        },
        doRefreshSort: function() {
            var t = this.options;
            this.hasSort = !1,
            this.dashSort && this.dashSort.reset(t.defaultSort)
        },
        doExcelExport: function() {
            var t = this.options;
            FX.Utils.isObjectEmpty(t.valueFields) || FX.Utils.excelExport({
                url: FX.Utils.getApi(FX.API.dash.excel_export),
                data: {
                    widgetId: t.widgetName,
                    filter: this._getFilter(),
                    name: [t.dashTitle, t.title].join(FX.CONST.DASH_CHART_TITLE_DELIMITER),
                    sort: this.dashSort.getSorts()
                }
            })
        },
        doFullScreen: function(t, e) {
            this.isFullScreen = e,
                this.doResize(t)
        }
    }),
        d.shortcut("metrictable", FX.DashMetricTable)
}(jQuery),
function(u) {
    FX.DashDataTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return u.extend(FX.DashDataTable.superclass._defaultConfig.apply(), {
                title: "",
                baseCls: "fui_dash_datatable",
                cls4FullScreen: "block-fullscreen",
                form: null,
                filter: null,
                allowDataLoad: !0,
                onCheckValid: null,
                exportable: !1,
                itemsPerPage: 20,
                fields: [],
                data: [],
                componentAttr: null,
                asyncExportURL: FX.Utils.getApi(FX.API.dash.list_excel_export),
                mode: "visit",
                defaultSort: [],
                rowOrder: {},
                top: {},
                onPageSizeChange: null,
                onDataFilter: null,
                onLoadFail: null,
                onSort: null,
                stickyColumn: {
                    enable: !1,
                    limit: 1
                }
            })
        },
        _init: function() {
            FX.DashDataTable.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.dashSort = new FX.DashSort({
                sorts: t.defaultSort,
                onChange: function() {
                    e.reload(null, !1, !0, e.dashSort.getSorts())
                },
                onFail: function(t) {
                    t === FX.CONST.DASH_SORT_ERROR.MAX_COUNT && FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("dash.sort.maxCount.tip", {
                            count: FX.CONST.MAX_DASH_SORT_COUNT
                        })
                    })
                }
            }),
                this._onCreateBody()
        },
        _initContent: function(t) {
            this.$wrapper = u('<div class="fui_table-wrapper has-menu"/>').appendTo(t),
                this.$menu = u('<div class="fui-table-menu"/>').appendTo(t),
                this.sort = this.options.defaultSort.slice(0),
                this.page = 0,
                this.count = null,
                this._initDataTable()
        },
        _initDataTable: function() {
            var e = this;
            this._loadData(function(t) {
                e.header = t.header,
                    e.createTable(t.header, t.data)
            })
        },
        _loadData: function(e) {
            var i = this
                , a = this.options;
            this._isFieldsValid() ? this.loadingAjax(this._getAsyncConfig(!1), function(t) {
                e && e(t),
                    FX.Utils.applyFunc(i, a.onLoadSuccess, [t], !1)
            }, function(t) {
                FX.Utils.applyFunc(i, a.onLoadFail, [t], !1)
            }) : FX.Utils.applyFunc(this, a.onLoadNull, [], !1)
        },
        _getAsyncConfig: function(t) {
            var e, i, a = this.options;
            return i = "visit" !== a.mode ? (e = FX.Utils.getApi(FX._API.dash.preview_list),
                {
                    widget: u.extend({
                        fields: a.fields,
                        form: a.form,
                        filter: this.getFilterData(this.filterParam),
                        hasHeader: !0
                    }, a.componentAttr),
                    sort: this.sort,
                    skip: this.page * a.itemsPerPage,
                    limit: a.itemsPerPage,
                    rowOrder: a.rowOrder,
                    top: a.top,
                    hasCount: t,
                    isCountOnly: t
                }) : (e = FX.Utils.getApi(FX.API.dash.list),
                {
                    widgetId: a.widgetName,
                    sort: this.sort,
                    skip: this.page * a.itemsPerPage,
                    limit: a.itemsPerPage,
                    filter: this.getFilterData(this.filterParam),
                    hasCount: t,
                    isCountOnly: t
                }),
                {
                    url: e,
                    data: i
                }
        },
        _isFieldsValid: function() {
            var t = this.options
                , e = !0;
            return e &= !FX.Utils.isEmpty(t.form),
                e &= t.fields && 0 < t.fields.length,
                FX.Utils.applyFunc(this, t.onCheckValid, [], !1),
                e
        },
        createTable: function(t, e) {
            var i = this
                , a = this.options;
            this.processor = new FX.DataTableProcessor({
                header: t,
                data: e,
                sort: this.sort,
                supportSortFieldsList: FX.LimitFields.dashSort,
                colSizeMap: this._getColSizeMap(),
                resizable: "preview" !== a.mode,
                stickyColLimit: a.stickyColumn.enable && a.stickyColumn.limit || 0
            }),
                this.table ? this.table.reload(this._getTableRenderData()) : this.table = this._doCreateTable(),
                this._loadCount(function() {
                    i._createPagination()
                })
        },
        _getColSizeMap: function() {
            var t = this._getColSizeMapKey();
            return FX.Store.get(t) || {}
        },
        _updateColSize: function(t, e) {
            var i = this.options
                , a = this._getColSizeMapKey()
                , n = this._getColSizeMap();
            n[t] = e,
                FX.Store.set(a, n),
            "edit" === i.mode && FX.Utils.applyFunc(this, i.onColSizeChange, [t, e], null)
        },
        _getColSizeMapKey: function() {
            var t = this.options;
            return FX.Store.getKey("colSizeMap", {
                appId: FX.STATIC.APPID,
                entryId: FX.STATIC.ENTRYID,
                widgetId: t.widgetName
            })
        },
        _loadCount: function(t) {
            var e, i = this;
            FX.Utils.isNull(this.count) ? ((e = this._getAsyncConfig(!0)).timeout = FX.CONST.DATA_COUNT_TIMEOUT,
                e.hasCountLimit = !0,
                FX.Utils.dataAjax(e, function(t) {
                    i.count = t.count
                }, function() {}, function() {
                    FX.Utils.applyFunc(i, t, [], null)
                })) : FX.Utils.applyFunc(i, t, [], null)
        },
        _doCreateTable: function() {
            var i = this
                , e = this.options;
            return new FX.PlainTable(u.extend({
                renderEl: this.$wrapper,
                isHeadSticky: !0,
                isRowHeadSticky: e.stickyColumn.enable,
                resizable: "preview" !== e.mode,
                onHeadCellClick: function(t) {
                    t.hasClass("sortable") && i._sortTable(t)
                },
                onMouseOverRow: function(t) {
                    var e = t.attr("data-idx");
                    FX.Utils.isNull(e) || u('tbody > tr[data-idx="' + e + '"]', i.$wrapper).addClass("hover")
                },
                onMouseOutRow: function(t) {
                    var e = t.attr("data-idx");
                    FX.Utils.isNull(e) || u('tbody > tr[data-idx="' + e + '"]', i.$wrapper).removeClass("hover")
                },
                onRowCreate: function(t, e) {
                    t.attr("data-idx", i.processor.getDataIdxByRow(e))
                },
                onRowClick: function(t) {
                    "visit" !== e.mode || FX.Utils.getSelectionText() || i._doShowData(t.data("idx"))
                },
                onColSizeChange: function(t, e) {
                    i._updateColSize(t, e)
                }
            }, this._getTableRenderData()))
        },
        _doShowData: function(t) {
            var e, i, a, n, s, r = this.processor.getDataByIdx(t);
            r && (i = (e = this).options,
                a = r._id,
                n = this.header,
                this._switchCurrentRow(t),
                s = u('<div class="x-window-mask modal light"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body"),
                new FX.ReportFormDataPane({
                    renderEl: u('<div class="x-window-content"/>').appendTo(s),
                    appId: FX.STATIC.APPID,
                    entryId: FX.STATIC.ENTRYID,
                    formId: i.form,
                    widgetId: i.widgetName,
                    forms: [i.form],
                    header: this._parseFieldLabelFormat(n),
                    data: r,
                    dataId: a,
                    title: i.title,
                    height: "100%",
                    hasSwitchBtn: !0,
                    dataIndex: t + 1,
                    dataCount: this.processor.getDataCount(),
                    onSwitchData: function(t) {
                        e.processor.getDataByIdx(t - 1) && s.parent().length && (s.remove(),
                            e._doShowData(t - 1))
                    },
                    onClose: function() {
                        s.remove()
                    }
                }))
        },
        _parseFieldLabelFormat: function(t) {
            var n = [];
            return FX.Utils.forEach(t, function(t, e) {
                var a, i = u.extend({}, e);
                FX.Utils.isNull(i.text) && (i.text = e.title),
                "subform" === e.type && (a = [],
                    FX.Utils.forEach(e.items, function(t, e) {
                        var i = u.extend({}, e);
                        FX.Utils.isNull(i.text) && (i.text = e.title),
                            a.push(i)
                    }),
                    i.items = a),
                    n.push(i)
            }),
                n
        },
        _switchCurrentRow: function(t) {
            u("tbody > tr", this.element).removeClass("current-row"),
                u('tbody > tr[data-idx="' + t + '"]', this.element).addClass("current-row")
        },
        _getTableRenderData: function() {
            return this.processor.getTable()
        },
        _sortTable: function(t) {
            var e, i, a, n, s, r = t.data("field");
            r && (e = {},
                i = this.getSortedFieldIdx(r),
                a = FX.CONST.SORT,
                t.hasClass("sort-asc") ? (n = function() {
                    t.removeClass("sort-asc").addClass("sort-desc")
                }
                    ,
                    e[r] = a.DESC,
                    -1 < i ? this.sort[i] = e : this.sort.push(e)) : t.hasClass("sort-desc") ? (n = function() {
                    t.removeClass("sort sort-desc")
                }
                    ,
                -1 < (i = this.getSortedFieldIdx(r)) && this.sort.splice(i, 1)) : (n = function() {
                    t.removeClass("sort-desc").addClass("sort sort-asc")
                }
                    ,
                    i = this.getSortedFieldIdx(r),
                    e[r] = a.ASC,
                    -1 < i ? this.sort[i] = e : this.sort.push(e)),
                s = e[r] || a.DEFAULT,
            !1 === FX.Utils.applyFunc(this, this.options.onSort, [r, s], !1) && this.dashSort.updateSort(r, s) && n && n())
        },
        getSortedFieldIdx: function(i) {
            var a = -1;
            return FX.Utils.forEach(this.sort, function(t, e) {
                if (e)
                    return e[i] ? (a = t,
                        !1) : void 0
            }),
                a
        },
        _createPagination: function() {
            var a = this
                , e = this.options;
            this.$menu.empty();
            var t = this.processor.getDataCount() >= e.itemsPerPage;
            new FX.Pagination({
                renderEl: u("<div />").appendTo(this.$menu),
                count: a.count,
                limit: e.itemsPerPage,
                curPage: a.page + 1,
                hasMore: t,
                showCount: !0,
                onChangePage: function(t) {
                    a.page = t - 1,
                        a.turnPage()
                },
                onLimitChange: function(t) {
                    e.itemsPerPage = t,
                        a.page = 0,
                        a._reloadWithoutCount(e.filterPane),
                        FX.Utils.applyFunc(a, e.onPageSizeChange, [t], !1)
                },
                fetchCount: function(e) {
                    var i = this
                        , t = a._getAsyncConfig(!0);
                    t.data.hasCountLimit = !1,
                        FX.Utils.dataAjax(t, function(t) {
                            a.count = t.count,
                                FX.Utils.applyFunc(i, e, [t.count], null)
                        }, function() {
                            FX.Utils.applyFunc(i, e, [], null)
                        })
                }
            })
        },
        doExcelExport: function(t) {
            var i, a, e, n, s, r, o, l, c, d = this.options;
            this._isFieldsValid() && (a = !(i = ["upload", "image", "signature"]),
                e = FX.Vip.hasFileExport(),
                FX.Utils.forEach(d.fields, function(t, e) {
                    if ("subform" === e.type) {
                        if (FX.Utils.forEach(e.items, function(t, e) {
                            if (-1 < i.indexOf(e.type))
                                return !(a = !0)
                        }),
                            a)
                            return !1
                    } else if (-1 < i.indexOf(e.type))
                        return !(a = !0)
                }),
                n = {
                    widgetId: d.widgetName,
                    filter: this.getFilterData(this.filterParam),
                    sort: this.sort,
                    name: [d.dashTitle, d.title].join(FX.CONST.DASH_CHART_TITLE_DELIMITER)
                },
                s = function() {
                    var t = FX.Utils.createMask(u("body"), {
                        isLight: !0,
                        hasLoader: !0
                    });
                    FX.Utils.excelExport({
                        url: d.asyncExportURL,
                        data: n
                    }, function() {
                        t.remove()
                    }, function() {
                        t.remove()
                    })
                }
                ,
                a && e ? (r = u('<div class="fui_dash_datatable_bubble_content"/>'),
                    u('<div class="content-text"/>').text(i18next.t("export.excel.dataTip")).appendTo(r),
                    o = u('<div class="content-btn-wrapper"/>').appendTo(r),
                    new FX.Button({
                        renderEl: u('<div class="wrapper-btn"/>').appendTo(o),
                        text: i18next.t("export.excel.onlyData"),
                        style: "white",
                        width: 115,
                        height: 24,
                        onClick: function() {
                            s(),
                                c.close()
                        }
                    }),
                    new FX.Button({
                        renderEl: u('<div class="wrapper-btn"/>').appendTo(o),
                        text: i18next.t("export.excel.dataAndFile"),
                        style: "white",
                        width: 115,
                        height: 24,
                        onClick: function() {
                            n.hasFileFields = !0,
                                s(),
                                c.close()
                        }
                    }),
                    l = t.closest(".fui_dash_block"),
                    r.hover(function() {
                        l.addClass("show")
                    }, function() {
                        l.removeClass("show")
                    }),
                    c = FX.Msg.bubble({
                        anchor: t,
                        dockPosition: "right",
                        text4Cancel: null,
                        text4Ok: null,
                        minWidth: 270,
                        contentPadding: 0,
                        contentHTML: r,
                        hAdjust: 30
                    })) : s())
        },
        turnPage: function() {
            this._initDataTable()
        },
        reload: function(t, e, i, a) {
            e || (this.page = 0),
            i || (this.count = null),
            a && (this.sort = a.slice(0)),
                this._setFilterParam(t),
                this._initDataTable()
        },
        _setFilterParam: function(t) {
            FX.Utils.isNull(t) || (this.filterParam = t)
        },
        _reloadWithoutCount: function(t, e) {
            this.reload(t, e, !0)
        },
        createHeadTools: function() {
            var t = this
                , e = this.options;
            this.$head.children("a").remove();
            var i = i18next.t("fullScreen")
                , a = u("<a />").append('<i class="icon-enlarge">');
            t.element.hasClass(e.cls4FullScreen) && (a = u("<a />").append('<i class="icon-shrink">'),
                i = i18next.t("zoomOut")),
                a.appendTo(this.$head).click(function() {
                    i = t.doFullScreen() ? (a.children("i").removeClass().addClass("icon-shrink"),
                        i18next.t("zoomOut")) : (a.children("i").removeClass().addClass("icon-enlarge"),
                        i18next.t("fullScreen"))
                }).hover(function() {
                    FX.UI.showPopover({
                        position: "bottomLeft",
                        anchor: u(this).children("i"),
                        content: u("<span/>").text(i),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                }),
            e.exportable && u("<a/>").append('<i class="icon-export">').append(u("<span/>").text(i18next.t("export.excel"))).appendTo(this.$head).click(function() {
                t.doExcelExport()
            })
        },
        _onCreateBody: function() {
            return this.$body = u('<div class="x-block-body"/>').appendTo(this.element),
                this._resizeBody(),
                this._initContent(this.$body),
                this.$body
        },
        _resizeBody: function() {
            var t = this.options;
            this.$body.addClass("fixed-height"),
                this.$body.css({
                    width: t.width - 2,
                    height: t.height - 2
                })
        },
        isAllowDataLoad: function() {
            return this.options.allowDataLoad
        },
        setAllowDataLoad: function(t) {
            this.options.allowDataLoad = !!t
        },
        loadingAjax: function(t, i, a) {
            var e, n = this;
            this.isAllowDataLoad() && (this.ajaxObj && this.ajaxObj.abort(),
                e = this.createLoadingMask(),
                this.ajaxObj = FX.Utils.dataAjax(t, function(t, e) {
                    return FX.Utils.applyFunc(n, i, [t, e], !1)
                }, function(t, e) {
                    return FX.Utils.applyFunc(n, a, [t, e], !1)
                }, function() {
                    n.ajaxObj = null,
                        e.remove()
                }))
        },
        createLoadingMask: function() {
            return FX.Utils.createSkeletonSpin(this.element)
        },
        rebuild: function() {
            this.$body.remove(),
                this._onCreateBody()
        },
        refresh: function() {
            this.table.reload(this._getTableRenderData())
        },
        doResize: function() {
            FX.DashDataTable.superclass.doResize.apply(this, arguments),
                this._resizeBody(),
            this.table && this.table.doResize()
        },
        doFullScreen: function() {
            var t = this.options;
            return this.element.hasClass(t.cls4FullScreen) ? (this.element.removeClass(t.cls4FullScreen),
                this.doResize({
                    width: FX.Utils.isEmpty(this.originStyle.w) ? "auto" : this.originStyle.w,
                    height: FX.Utils.isEmpty(this.originStyle.h) ? "auto" : this.originStyle.h
                }),
                !1) : (this.originStyle = {
                w: this.element.outerWidth(),
                h: t.height
            },
                this.element.addClass(t.cls4FullScreen),
                this.doResize({
                    width: document.body.clientWidth,
                    height: document.body.clientHeight
                }),
                !0)
        },
        getFilterData: function(t) {
            var e = this.options
                , i = FX.Utils.applyFunc(this, e.onDataFilter, [], !1)
                , a = [];
            return i && (a = a.concat(i)),
            FX.Utils.isObjectEmpty(t) || (a = a.concat(t)),
            e.filter && "visit" !== e.mode && (a = a.concat(e.filter.cond)),
                FX.Utils.isObjectEmpty(a) ? {} : {
                    cond: a,
                    rel: FX.CONST.FILTER_RELATION.AND
                }
        },
        doRefreshSort: function() {
            var t = this.options;
            this.dashSort && this.dashSort.reset(t.defaultSort)
        },
        doSort: function() {
            var t = this.options
                , e = this
                , i = null
                , a = new FX.ConfirmDialog({
                title: i18next.t("dash.sort.setting"),
                width: 600,
                text4Ok: i18next.t("sort"),
                hasSeparator: !0,
                onContentCreate: function(t) {
                    i = t
                },
                onOk: function() {
                    e.dashSort.reset(n.getSorts()),
                        a.close()
                }
            });
            a.show();
            var n = new FX.DashSortPane({
                renderEl: i,
                fields: t.fields,
                sorts: e.dashSort.getSorts()
            })
        }
    }),
        u.shortcut("dashdatatable", FX.DashDataTable)
}(jQuery),
function(r) {
    FX.DashPivotTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return r.extend(FX.DashPivotTable.superclass._defaultConfig.apply(), {
                baseCls: "fui_dash_pivottable",
                title: "",
                cls4FullScreen: "block-fullscreen",
                height4Head: 35,
                filter: null,
                linkWidgets: null,
                allowDataLoad: !0,
                chunkSize: 50,
                form: null,
                xFields: [],
                yFields: [],
                valueFields: [],
                defaultSort: [],
                thresholds: [],
                isHeadSticky: !0,
                isRowHeadSticky: !0,
                rowOrder: {},
                top: {},
                asyncExportURL: FX.Utils.getApi(FX.API.dash.excel_export),
                onItemClick: null,
                onCheckValid: null,
                onLoadFail: null,
                exportable: !0,
                scalable: !0,
                tableClass: "x-table",
                mode: "visit",
                componentAttr: null
            })
        },
        _init: function() {
            FX.DashPivotTable.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.dashSort || (this.dashSort = new FX.DashSort({
                sorts: t.defaultSort,
                onChange: function() {
                    e.reload()
                }
            })),
                this.linkParam = null,
                this._onCreateBody()
        },
        _initContent: function(t) {
            this.$wrapper = r('<div class="fui_table-wrapper"/>').appendTo(t),
                this.$wrapper.addClass("has-menu"),
                this.$menu = r('<div class="fui-table-menu"/>').appendTo(t),
                this._initCombinedTable()
        },
        createHeadTools: function() {
            var t, e, i = this, a = this.options;
            this.$head.children("a").remove(),
            a.scalable && (t = i18next.t("fullScreen"),
                e = r("<a />").append('<i class="icon-enlarge">'),
            i.element.hasClass(a.cls4FullScreen) && (e = r("<a />").append('<i class="icon-shrink">'),
                t = i18next.t("zoomOut")),
                e.appendTo(this.$head).click(function() {
                    t = i.doFullScreen() ? (e.children("i").removeClass().addClass("icon-shrink"),
                        i18next.t("zoomOut")) : (e.children("i").removeClass().addClass("icon-enlarge"),
                        i18next.t("fullScreen"))
                }).hover(function() {
                    FX.UI.showPopover({
                        position: "bottomLeft",
                        anchor: r(this).children("i"),
                        content: r("<span/>").text(t),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                })),
            a.exportable && r("<a/>").append('<i class="icon-export">').append(r("<span/>").text(i18next.t("export.excel"))).appendTo(this.$head).click(function() {
                i.doExcelExport()
            })
        },
        _onCreateBody: function() {
            return this.$body = r('<div class="x-block-body"/>').appendTo(this.element),
                this._resizeBody(),
                this._initContent(this.$body),
                this.$body
        },
        _resizeBody: function() {
            var t = this.options
                , e = {};
            FX.Utils.isNumber(t.width) ? e.width = t.width - 2 : FX.Utils.isNull(t.width) || (e.width = t.width),
                FX.Utils.isNumber(t.height) ? (e.height = t.height - 2,
                    this.$body.addClass("fixed-height")) : FX.Utils.isNull(t.height) ? (this.$body.removeClass("fixed-height"),
                    e.height = "auto") : (this.$body.removeClass("fixed-height"),
                    e.height = t.height),
                this.$body.css(e)
        },
        isAllowDataLoad: function() {
            return this.options.allowDataLoad
        },
        setAllowDataLoad: function(t) {
            this.options.allowDataLoad = !!t
        },
        loadingAjax: function(t, i, a) {
            var e, n = this;
            this.isAllowDataLoad() && (this.ajaxObj && this.ajaxObj.abort(),
                e = this.createLoadingMask(),
                this.ajaxObj = FX.Utils.dataAjax(t, function(t, e) {
                    return FX.Utils.applyFunc(n, i, [t, e], !1)
                }, function(t, e) {
                    return FX.Utils.applyFunc(n, a, [t, e], !1)
                }, function() {
                    n.ajaxObj = null,
                        e.remove()
                }))
        },
        createLoadingMask: function() {
            return FX.Utils.createSkeletonSpin(this.element)
        },
        _initCombinedTable: function(t) {
            var e, i, a, n = this, s = this.options;
            if (this.filterParam = t,
                this.tableHead = [],
                this.tableRowHead = [],
                this.tableData = [],
                this.rowCount = 0,
                !this._isFieldsValid())
                return this.createTable(),
                    void FX.Utils.applyFunc(this, s.onLoadNull, [], !1);
            "visit" !== s.mode ? (e = FX.Utils.getApi(FX._API.dash.preview_combined_group),
                a = {
                    widget: i = r.extend({
                        form: s.form,
                        xFields: s.xFields,
                        yFields: s.yFields,
                        metrics: s.valueFields,
                        filter: this.getFilterData(this.filterParam),
                        type: s.chartType,
                        rowOrder: s.rowOrder,
                        top: s.top,
                        defaultSort: s.defaultSort
                    }, s.componentAttr)
                },
            this.hasSort && (i.defaultSort = this.dashSort.getSorts())) : (e = FX.Utils.getApi(FX.API.dash.combined_group),
                a = {
                    widgetId: s.widgetName,
                    filter: this.getFilterData(this.filterParam)
                },
            this.hasSort && (a.sort = this.dashSort.getSorts())),
                this.loadingAjax({
                    url: e,
                    data: a
                }, function(t) {
                    n._isTableEmpty(t) ? n.processor = null : n.processor = new FX.CombinedTableProcessor(t,{
                        chunkSize: s.chunkSize,
                        top: s.top,
                        thresholds: s.thresholds
                    }),
                        n.createTable(),
                        FX.Utils.applyFunc(n, s.onLoadSuccess, [t], !1)
                }, function(t) {
                    FX.Utils.applyFunc(n, s.onLoadFail, [t], !1)
                })
        },
        _isTableEmpty: function(t) {
            return 0 === t.data.x.length && 0 === t.data.val.length
        },
        createTable: function() {
            this.table ? this.table.reload(this._getPageData()) : this.table = this._doCreateTable(),
                this._createPagination()
        },
        _doCreateTable: function() {
            var a = this
                , n = this.options;
            return new FX.PlainTable(r.extend({
                renderEl: this.$wrapper,
                isHeadSticky: n.isHeadSticky,
                isRowHeadSticky: n.isRowHeadSticky,
                height: "auto",
                onCellClick: function(t) {
                    var e, i = t.data("id");
                    i && (e = a._getLinkParams(i),
                        e = a._getLinkFilterParams(e),
                        a.linkParam = e,
                        FX.Utils.applyFunc(a, n.onItemClick, [e], !1))
                }
            }, this._getPageData()))
        },
        rebuild: function() {
            this.$body.remove(),
                this._onCreateBody()
        },
        _getPageData: function() {
            return this.processor ? this.processor.getTable() : {
                tableHead: [],
                tableData: [],
                tableRowHead: []
            }
        },
        doExcelExport: function() {
            var t = this.options;
            this._isFieldsValid() && FX.Utils.excelExport({
                url: t.asyncExportURL,
                data: {
                    widgetId: t.widgetName,
                    filter: this.getFilterData(this.filterParam),
                    name: [t.dashTitle, t.title].join(FX.CONST.DASH_CHART_TITLE_DELIMITER),
                    sort: this.dashSort.getSorts()
                }
            })
        },
        _createPagination: function() {
            var e = this
                , t = this.options;
            this.$menu.empty(),
                new FX.Pagination({
                    renderEl: r("<div />").appendTo(this.$menu),
                    count: this.processor ? this.processor.getCount() : 0,
                    limit: t.chunkSize,
                    curPage: this.processor ? this.processor.getPage() : 1,
                    hasTurnLast: !0,
                    onChangePage: function(t) {
                        e.processor.turnPage(t),
                            e.createTable()
                    }
                })
        },
        _isFieldsValid: function() {
            var t = this.options
                , e = !0;
            return e &= !FX.Utils.isEmpty(t.form),
                e &= 0 !== t.valueFields.length,
                e &= 0 !== t.xFields.length || 0 !== t.yFields.length,
                FX.Utils.applyFunc(this, t.onCheckValid, [], !1),
                e
        },
        _getLinkParams: function(a) {
            var n = this;
            if (a) {
                var s = [];
                return FX.Utils.forEach(a, function(t) {
                    var e = n._getFieldByName(t);
                    if (e) {
                        var i = a[t];
                        switch (e.type) {
                            case "datetime":
                                i = FX.Utils.getDateRange(i);
                                break;
                            case "address":
                            case "location":
                                i = FX.Utils.getArrayFromRange(i, "address")
                        }
                        s.push(r.extend(FX.Utils.getLinkFilter(e, i), {
                            field: e.name
                        }))
                    }
                }),
                    s
            }
        },
        _getFieldByName: function(i) {
            var t = this.options
                , e = [].concat(t.xFields, t.yFields)
                , a = null;
            return FX.Utils.forEach(e, function(t, e) {
                if ((e.tag || e.name) === i)
                    return a = e,
                        !1
            }),
                a
        },
        reload: function(t) {
            var e = r(".component-content-empty", this.element);
            e && e.length && (e.remove(),
                this.$body = r('<div class="x-block-body"/>').appendTo(this.element),
                this._resizeBody(),
                this.element.removeClass("component-content-empty"),
                this.$wrapper = r('<div class="fui_table-wrapper"/>').appendTo(this.$body),
                this.$wrapper.addClass("has-menu"),
                this.$menu = r('<div class="fui-table-menu"/>').appendTo(this.$body)),
                this._initCombinedTable(t)
        },
        refresh: function() {
            this.table.reload(this._getPageData())
        },
        reloadWithDataIrrelevantConfig: function(t) {
            var e = {
                isHeadSticky: t.isHeadSticky,
                isRowHeadSticky: t.isRowHeadSticky
            };
            r.extend(this.options, e),
            this.processor && (this.processor.thresholds = this.options.thresholds,
                this.processor.process()),
            this.table && this.table.reload(r.extend(e, this._getPageData()))
        },
        doResize: function(t) {
            FX.DashPivotTable.superclass.doResize.apply(this, arguments),
                this._resizeBody(),
            this.table && this.table.doResize()
        },
        doFullScreen: function() {
            var t = this.options;
            return this.element.hasClass(t.cls4FullScreen) ? (this.element.removeClass(t.cls4FullScreen),
                this.doResize({
                    width: FX.Utils.isEmpty(this.originStyle.w) ? "auto" : this.originStyle.w,
                    height: FX.Utils.isEmpty(this.originStyle.h) ? "auto" : this.originStyle.h
                }),
                !1) : (this.originStyle = {
                w: this.element.outerWidth(),
                h: t.height
            },
                this.element.addClass(t.cls4FullScreen),
                this.doResize({
                    width: document.body.clientWidth,
                    height: document.body.clientHeight
                }),
                !0)
        },
        getOptions: function() {
            var t = this.options;
            return r.extend(FX.DashPivotTable.superclass.getOptions.apply(this, arguments), {
                title: t.title,
                linkWidgets: t.linkWidgets,
                form: t.form,
                filter: t.filter,
                xFields: t.xFields,
                yFields: t.yFields,
                valueFields: t.valueFields,
                exportable: t.exportable
            })
        },
        _getLinkFilterParams: function(t) {
            var i = this.options
                , a = [];
            return FX.Utils.forEach(t, function(t, e) {
                a.push(r.extend(FX.Utils.pick(e, ["method", "type", "value", "keyType"]), FX.Utils.dealFilterInfoByField({
                    id: i.form,
                    name: e.field
                })))
            }),
                a
        },
        getFilterData: function(t) {
            var e = this.options
                , i = FX.Utils.applyFunc(this, e.onDataFilter, [], !1)
                , a = [];
            return i && (a = a.concat(i)),
            FX.Utils.isObjectEmpty(t) || (a = a.concat(t)),
            e.filter && "visit" !== e.mode && (a = a.concat(e.filter.cond)),
                FX.Utils.isObjectEmpty(a) ? {} : {
                    cond: a,
                    rel: FX.CONST.FILTER_RELATION.AND
                }
        },
        doSort: function() {
            var t = this.options
                , e = this
                , i = FX.Utils.getDashSortFields(t.yFields).concat(FX.Utils.getDashSortFields(t.xFields)).concat(FX.Utils.getDashQuotaSortFields(t.valueFields))
                , a = [];
            FX.Utils.forEach(t.xFields.slice(-1).concat(t.valueFields), function(t, e) {
                a.push(e.tag)
            });
            var n = new FX.ConfirmDialog({
                title: i18next.t("dash.sort.setting"),
                width: 600,
                text4Ok: i18next.t("sort"),
                hasSeparator: !0,
                onContentCreate: function(t) {
                    e.dashChartSort = new FX.DashChartSortPane({
                        renderEl: t,
                        sorts: e.dashSort.getSorts(),
                        fields: i,
                        incompatibleTags: a,
                        maxCount: -1,
                        hideCustomSort: !0
                    })
                },
                onOk: function() {
                    var t = e.dashChartSort.getSorts();
                    e.hasSort = !0,
                        e.dashSort.reset(t),
                        n.close()
                }
            });
            n.show()
        },
        doRefreshSort: function() {
            var t = this.options;
            this.hasSort = !1,
            this.dashSort && this.dashSort.reset(t.defaultSort)
        },
        doClearLink: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onClearLink, [this.linkParam], null),
                this.linkParam = null
        },
        renderTip: function(t) {
            return this.element.empty(),
                this.element.append(r('<div class="component-content component-content-empty"><div class="empty-wrapper"><i class="icon-field-auth"></i><div class="empty-text">' + t + "</div></div></div>").css({
                    width: this.element.width(),
                    height: this.element.height()
                }))
        }
    }),
        r.shortcut("dashpivottable", FX.DashPivotTable)
}(jQuery),
function(i) {
    FX.DashNumber = FX.extend(FX.DashFilterBase, {
        DEFAULT_SIZE: {
            single: {
                minSizeX: 10,
                minSizeY: 6
            },
            double: {
                minSizeX: 10,
                minSizeY: 8
            }
        },
        _defaultConfig: function() {
            return i.extend(FX.DashNumber.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fui_dash_number",
                minRow: 8,
                onStopEdit: null
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.GT, FX.CONST.FILTER_METHOD.GTE, FX.CONST.FILTER_METHOD.LT, FX.CONST.FILTER_METHOD.LTE, FX.CONST.FILTER_METHOD.RG, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            switch (FX.DashNumber.superclass._createValCell.apply(this, arguments),
                e.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GT:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LT:
                case FX.CONST.FILTER_METHOD.LTE:
                    this.dashNumber = new FX.Number({
                        renderEl: i("<div/>").appendTo(this.$content),
                        value: this.value,
                        allowDecimals: !0,
                        width: "100%",
                        onStopEdit: function() {
                            FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                        }
                    });
                    break;
                case FX.CONST.FILTER_METHOD.RG:
                    this._createMain();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _createMain: function() {
            var t = this.options
                , e = this;
            this.dashNumber = new FX.NumberLimit({
                renderEl: this.$content,
                width4number: "auto",
                width: "100%",
                height: 30,
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }
            }),
                this._doWrap(t.sizeY > t.minRow)
        },
        _doWrap: function(t) {
            t ? this.$content.addClass("wrap") : this.$content.removeClass("wrap")
        },
        setValue: function(t) {
            switch (this.options.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GT:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LT:
                case FX.CONST.FILTER_METHOD.LTE:
                    this.dashNumber.setValue(t && t.value);
                    break;
                case FX.CONST.FILTER_METHOD.RG:
                    this.dashNumber.setValue(t)
            }
        },
        getValue: function() {
            switch (this.options.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                case FX.CONST.FILTER_METHOD.GT:
                case FX.CONST.FILTER_METHOD.GTE:
                case FX.CONST.FILTER_METHOD.LT:
                case FX.CONST.FILTER_METHOD.LTE:
                    return {
                        value: this.dashNumber.getValue()
                    };
                case FX.CONST.FILTER_METHOD.RG:
                    return this.dashNumber.getValue();
                default:
                    return null
            }
        },
        getSize: function() {
            var t = this.options;
            return t.sizeY > t.minRow ? this.DEFAULT_SIZE.double : this.DEFAULT_SIZE.single
        },
        getOptions: function() {
            return i.extend(FX.DashNumber.superclass.getOptions.apply(this, arguments), {
                type: "number_filter"
            }, this.getEditConfig())
        }
    }),
        i.shortcut("dashnumber", FX.DashNumber)
}(jQuery),
function(i) {
    FX.DashAddress = FX.extend(FX.DashFilterBase, {
        DEFAULT_SIZE: {
            single: {
                minSizeX: 20,
                minSizeY: 6
            },
            double: {
                minSizeX: 15,
                minSizeY: 8
            }
        },
        ITEM_WIDTH: {
            NO_WRAP: {
                width4province: "33.3%",
                width4city: "33.3%",
                width4district: "33.3%"
            },
            WRAP: {
                width4province: "100%",
                width4city: "50%",
                width4district: "50%"
            }
        },
        _defaultConfig: function() {
            return i.extend(FX.DashAddress.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fui_dash_address",
                minRow: 8,
                onStopEdit: null
            })
        },
        _createMain: function() {
            var t = this.options
                , e = this;
            this.dashAddress = new FX.Address(i.extend({
                renderEl: this.$content,
                needDetail: !1,
                width: "100%",
                height: t.height,
                value: t.defaultConfig,
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }
            }, this.ITEM_WIDTH.NO_WRAP)),
                this._doWrap(t.sizeY > t.minRow)
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.ALL, FX.CONST.FILTER_METHOD.NIN, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _getMethodName: function(t) {
            var e = {};
            return e[FX.CONST.FILTER_METHOD.ALL] = {
                name: i18next.t("filter.method.all.address")
            },
                e[FX.CONST.FILTER_METHOD.NIN] = {
                    name: i18next.t("filter.method.nin.address")
                },
                e[FX.CONST.FILTER_METHOD.EP] = {
                    name: i18next.t("filter.method.ep")
                },
                e[FX.CONST.FILTER_METHOD.NEP] = {
                    name: i18next.t("filter.method.nep")
                },
                e[t].name
        },
        _createValCell: function() {
            switch (FX.DashAddress.superclass._createValCell.apply(this, arguments),
                this.options.method) {
                case FX.CONST.FILTER_METHOD.ALL:
                case FX.CONST.FILTER_METHOD.NIN:
                    this._createMain();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _doWrap: function(t) {
            t ? (this.$content.addClass("wrap"),
                i.extend(this.dashAddress.options, this.ITEM_WIDTH.WRAP)) : (this.$content.removeClass("wrap"),
                i.extend(this.dashAddress.options, this.ITEM_WIDTH.NO_WRAP)),
                this.dashAddress.rebuild()
        },
        setValue: function(t) {
            this.dashAddress && this.dashAddress.setValue(t)
        },
        getValue: function() {
            return this.dashAddress && this.dashAddress.getValue() || null
        },
        getSize: function() {
            var t = this.options;
            return t.sizeY > t.minRow ? this.DEFAULT_SIZE.double : this.DEFAULT_SIZE.single
        },
        getOptions: function() {
            return i.extend(FX.DashAddress.superclass.getOptions.apply(this, arguments), {
                type: "address_filter"
            }, this.getEditConfig())
        }
    }),
        i.shortcut("dashaddress", FX.DashAddress)
}(jQuery),
function(s) {
    FX.DashComboCheck = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return s.extend(FX.DashComboCheck.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null,
                valueMode: FX.CONST.FILTER_VALUE_MODE.ITEM,
                customItem: {
                    text: i18next.t("unfilled"),
                    value: "hasEmpty"
                }
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.ALL, FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            FX.DashComboCheck.superclass._createValCell.apply(this, arguments);
            var i = FX.CONST.FILTER_VALUE_MODE;
            switch (e.valueMode) {
                case i.ITEM:
                    switch (e.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.ALL:
                        case FX.CONST.FILTER_METHOD.IN:
                            this._createComboCheck();
                            break;
                        default:
                            this.$content.remove(),
                                this.$content = null
                    }
                    break;
                case i.CUSTOM:
                    switch (e.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.IN:
                        case FX.CONST.FILTER_METHOD.ALL:
                            this.dashCombocheck = new FX.MultiTextEditor({
                                renderEl: s("<div />").appendTo(this.$content),
                                width: "100%",
                                autoWrap: e.sizeY > e.minRow,
                                height: e.sizeY > e.minRow ? this.getDashContentHeight() : 32,
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            });
                            break;
                        default:
                            this.$content.remove(),
                                this.$content = null
                    }
            }
        },
        _createComboCheck: function() {
            var t = this.options;
            t.fields && t.fields.length ? this._createMain(this._getAsyncConfig()) : this._createMain()
        },
        _createMain: function(t) {
            var e = this.options
                , i = this
                , a = this._getCompType()
                , n = {
                renderEl: s("<div/>").appendTo(this.$content),
                width: "100%",
                type: a,
                async: t,
                hasLimit: !0,
                items: [],
                onStopEdit: function() {
                    FX.Utils.applyFunc(i, e.onStopEdit, [], !1)
                }
            };
            "checklist" === a ? s.extend(n, {
                height: this.getDashContentHeight()
            }) : s.extend(n, {
                hasSelectEmpty: !1
            }),
                this.dashCombocheck = FX.createWidget(n)
        },
        setValue: function(t) {
            var e = this.options
                , i = FX.CONST.FILTER_VALUE_MODE;
            if (this.dashCombocheck)
                switch (e.valueMode) {
                    case i.ITEM:
                        switch (e.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.ALL:
                            case FX.CONST.FILTER_METHOD.IN:
                                this.dashCombocheck.setValue(this._formatComboValue(t))
                        }
                        break;
                    case i.CUSTOM:
                        switch (e.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.ALL:
                                this.dashCombocheck.setValue(t && t.items)
                        }
                }
        },
        getValue: function() {
            var i = this.options
                , t = FX.CONST.FILTER_VALUE_MODE;
            if (this.dashCombocheck) {
                var e = this.dashCombocheck.getValue();
                switch (i.valueMode) {
                    case t.ITEM:
                        switch (i.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.ALL:
                            case FX.CONST.FILTER_METHOD.IN:
                                if ("checklist" !== this._getCompType())
                                    return e;
                                var a = !1
                                    , n = [];
                                return FX.Utils.forEach(e, function(t, e) {
                                    e !== i.customItem.value ? n.push(e) : a = !0
                                }),
                                    {
                                        hasEmpty: a,
                                        items: n
                                    };
                            default:
                                return null
                        }
                    case t.CUSTOM:
                        switch (i.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.ALL:
                                return {
                                    items: e
                                };
                            default:
                                return null
                        }
                }
            }
            return null
        },
        getOptions: function() {
            return s.extend(FX.DashComboCheck.superclass.getOptions.apply(this, arguments), {
                type: "combocheck_filter"
            }, this.getEditConfig())
        },
        doFilterRely: function() {
            var t = this.options;
            FX.DashComboCheck.superclass.doFilterRely.apply(this, arguments);
            var e = FX.CONST.FILTER_VALUE_MODE;
            switch (t.valueMode) {
                case e.ITEM:
                    switch (t.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.ALL:
                        case FX.CONST.FILTER_METHOD.IN:
                            this.dashCombocheck.doFilterRely(this.relyFilter)
                    }
            }
        }
    }),
        s.shortcut("dashcombocheck", FX.DashComboCheck)
}(jQuery),
function(s) {
    FX.DashText = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return s.extend(FX.DashText.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null,
                valueMode: FX.CONST.FILTER_VALUE_MODE.ITEM,
                customItem: {
                    text: i18next.t("unfilled"),
                    value: "hasEmpty"
                }
            })
        },
        _getAvailableMethods: function() {
            var t = this.options.fields;
            return t && t.length && "wx_gender" === t[0].field ? [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.NIN, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP] : [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.NIN, FX.CONST.FILTER_METHOD.LK, FX.CONST.FILTER_METHOD.ULK, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            FX.DashText.superclass._createValCell.apply(this, arguments);
            var i = FX.CONST.FILTER_VALUE_MODE;
            switch (e.valueMode) {
                case i.ITEM:
                    switch (e.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.NE:
                            e.sizeY > e.minRow ? this.dashText = new FX.RadioList({
                                renderEl: s("<div/>").appendTo(this.$content),
                                async: this._getAsyncConfig(),
                                hasLimit: !0,
                                items: [],
                                height: this.getDashContentHeight(),
                                width: "100%",
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            }) : this.dashText = new FX.XComboBox({
                                renderEl: s("<div/>").appendTo(this.$content),
                                async: this._getAsyncConfig(),
                                hasLimit: !0,
                                items: [],
                                width: "100%",
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            });
                            break;
                        case FX.CONST.FILTER_METHOD.IN:
                        case FX.CONST.FILTER_METHOD.NIN:
                            this._createComboCheck();
                            break;
                        case FX.CONST.FILTER_METHOD.LK:
                        case FX.CONST.FILTER_METHOD.ULK:
                            this.dashText = new FX.TextEditor({
                                renderEl: s("<div/>").appendTo(this.$content),
                                width: "100%",
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            });
                            break;
                        default:
                            this.$content.remove(),
                                this.$content = null
                    }
                    break;
                case i.CUSTOM:
                    switch (e.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.NE:
                        case FX.CONST.FILTER_METHOD.LK:
                        case FX.CONST.FILTER_METHOD.ULK:
                            this.dashText = new FX.TextEditor({
                                renderEl: s("<div/>").appendTo(this.$content),
                                width: "100%",
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            });
                            break;
                        case FX.CONST.FILTER_METHOD.IN:
                        case FX.CONST.FILTER_METHOD.NIN:
                            this.dashText = new FX.MultiTextEditor({
                                renderEl: s("<div />").appendTo(this.$content),
                                width: "100%",
                                autoWrap: e.sizeY > e.minRow,
                                height: e.sizeY > e.minRow ? this.getDashContentHeight() : 32,
                                onStopEdit: function() {
                                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                                }
                            });
                            break;
                        default:
                            this.$content.remove(),
                                this.$content = null
                    }
            }
        },
        _createComboCheck: function() {
            var t = this.options;
            t.fields && t.fields.length ? this._createMain(this._getAsyncConfig()) : this._createMain()
        },
        _createMain: function(t) {
            var e = this.options
                , i = this
                , a = this._getCompType()
                , n = {
                renderEl: s("<div/>").appendTo(this.$content),
                width: "100%",
                type: a,
                async: t,
                hasLimit: !0,
                hasSelectEmpty: e.method === FX.CONST.FILTER_METHOD.IN,
                items: [],
                onStopEdit: function() {
                    FX.Utils.applyFunc(i, e.onStopEdit, [], !1)
                }
            };
            "checklist" === a && (s.extend(n, {
                height: this.getDashContentHeight()
            }),
            e.method === FX.CONST.FILTER_METHOD.IN && s.extend(n, {
                customItem: e.customItem
            })),
                this.dashText = FX.createWidget(n)
        },
        doFilterRely: function(t) {
            var e = this.options;
            FX.DashText.superclass.doFilterRely.apply(this, arguments);
            var i = FX.CONST.FILTER_VALUE_MODE;
            switch (e.valueMode) {
                case i.ITEM:
                    switch (e.method) {
                        case FX.CONST.FILTER_METHOD.EQ:
                        case FX.CONST.FILTER_METHOD.NE:
                        case FX.CONST.FILTER_METHOD.IN:
                        case FX.CONST.FILTER_METHOD.NIN:
                            this.dashText.doFilterRely(t)
                    }
            }
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashText) {
                var i = FX.CONST.FILTER_VALUE_MODE;
                switch (e.valueMode) {
                    case i.ITEM:
                        switch (e.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.NE:
                            case FX.CONST.FILTER_METHOD.LK:
                            case FX.CONST.FILTER_METHOD.ULK:
                                this.dashText.setValue(t && t.value);
                                break;
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.NIN:
                                this.dashText.setValue(this._formatComboValue(t))
                        }
                        break;
                    case i.CUSTOM:
                        switch (e.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.NE:
                            case FX.CONST.FILTER_METHOD.LK:
                            case FX.CONST.FILTER_METHOD.ULK:
                                this.dashText.setValue(t && t.value);
                                break;
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.NIN:
                                this.dashText.setValue(t && t.items)
                        }
                }
            }
        },
        getValue: function() {
            var i = this.options;
            if (this.dashText) {
                var t = this.dashText.getValue()
                    , e = FX.CONST.FILTER_VALUE_MODE;
                switch (i.valueMode) {
                    case e.ITEM:
                        switch (i.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.NE:
                            case FX.CONST.FILTER_METHOD.LK:
                            case FX.CONST.FILTER_METHOD.ULK:
                                return {
                                    value: t
                                };
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.NIN:
                                if ("checklist" !== this._getCompType())
                                    return t;
                                var a = !1
                                    , n = [];
                                return FX.Utils.forEach(t, function(t, e) {
                                    e !== i.customItem.value ? n.push(e) : a = !0
                                }),
                                    {
                                        hasEmpty: a,
                                        items: n
                                    };
                            default:
                                return null
                        }
                    case e.CUSTOM:
                        switch (i.method) {
                            case FX.CONST.FILTER_METHOD.EQ:
                            case FX.CONST.FILTER_METHOD.NE:
                            case FX.CONST.FILTER_METHOD.LK:
                            case FX.CONST.FILTER_METHOD.ULK:
                                return {
                                    value: t
                                };
                            case FX.CONST.FILTER_METHOD.IN:
                            case FX.CONST.FILTER_METHOD.NIN:
                                return {
                                    items: t
                                };
                            default:
                                return null
                        }
                }
            }
            return null
        },
        getOptions: function() {
            return s.extend(FX.DashText.superclass.getOptions.apply(this, arguments), {
                type: "text_filter"
            }, this.getEditConfig())
        }
    }),
        s.shortcut("dashtext", FX.DashText)
}(jQuery),
function(i) {
    FX.DashTextArea = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return i.extend(FX.DashTextArea.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.LK, FX.CONST.FILTER_METHOD.ULK, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            switch (FX.DashTextArea.superclass._createValCell.apply(this, arguments),
                e.method) {
                case FX.CONST.FILTER_METHOD.LK:
                case FX.CONST.FILTER_METHOD.ULK:
                    this.dashTextArea = new FX.TextEditor({
                        renderEl: i("<div/>").appendTo(this.$content),
                        width: "100%",
                        onStopEdit: function() {
                            FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                        }
                    });
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashTextArea)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.LK:
                    case FX.CONST.FILTER_METHOD.ULK:
                        t = t && t.items ? t.items[0] : t && t.value,
                            this.dashTextArea.setValue(t)
                }
        },
        getValue: function() {
            var t = this.options;
            if (this.dashTextArea)
                switch (t.method) {
                    case FX.CONST.FILTER_METHOD.LK:
                    case FX.CONST.FILTER_METHOD.ULK:
                        return {
                            value: this.dashTextArea.getValue()
                        };
                    default:
                        return null
                }
        },
        getOptions: function() {
            return i.extend(FX.DashTextArea.superclass.getOptions.apply(this, arguments), {
                type: "textarea_filter"
            }, this.getEditConfig())
        }
    }),
        i.shortcut("dashtextarea", FX.DashTextArea)
}(jQuery),
function(s) {
    FX.DashUser = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return s.extend(FX.DashUser.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null,
                customItem: {
                    nickname: i18next.t("unfilled"),
                    _id: "hasEmpty"
                },
                displayType: {
                    list: "checklist",
                    box: "usercheck"
                }
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.NIN, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this
                , e = this.options;
            FX.DashUser.superclass._createValCell.apply(this, arguments);
            var i = e.fields[0];
            if (i && i.type)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                        var a = {
                            renderEl: s("<div/>").appendTo(this.$content),
                            async: this._getAsyncConfig(),
                            items: [],
                            width: "100%",
                            textField: "nickname",
                            valueField: "_id",
                            hasScrollLoad: !0,
                            hasLimit: !0,
                            onStopEdit: function() {
                                FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                            }
                        };
                        e.sizeY > e.minRow ? (a.type = "radiolist",
                            a.height = this.getDashContentHeight()) : a.type = "usercombobox",
                            this.dashUser = FX.createWidget(a);
                        break;
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        this._createComboCheck();
                        break;
                    default:
                        this.$content.remove(),
                            this.$content = null
                }
        },
        _createComboCheck: function() {
            var t = this.options;
            t.fields && t.fields.length ? this._createMain(this._getAsyncConfig()) : this._createMain()
        },
        _createMain: function(t) {
            var e = this.options
                , i = this
                , a = this._getCompType()
                , n = {
                renderEl: s("<div/>").appendTo(this.$content),
                width: "100%",
                type: a,
                async: t,
                hasLimit: !0,
                items: [],
                hasSelectEmpty: e.method === FX.CONST.FILTER_METHOD.IN,
                onStopEdit: function() {
                    FX.Utils.applyFunc(i, e.onStopEdit, [], !1)
                }
            };
            "checklist" === a && (s.extend(n, {
                height: this.getDashContentHeight()
            }),
            e.method === FX.CONST.FILTER_METHOD.IN && s.extend(n, {
                customItem: e.customItem
            })),
                s.extend(n, {
                    textField: "nickname",
                    valueField: "_id"
                }),
                this.dashUser = FX.createWidget(n)
        },
        doFilterRely: function(t) {
            var e = this.options;
            FX.DashUser.superclass.doFilterRely.apply(this, arguments);
            var i = e.fields[0];
            if (i && i.type)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        this.dashUser.doFilterRely(t)
                }
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashUser)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                        this.dashUser.setValue(t && t.value);
                        break;
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        this.dashUser.setValue(this._formatComboValue(t, "_id"))
                }
        },
        getValue: function() {
            var i = this.options;
            if (this.dashUser) {
                var t = this.dashUser.getValue();
                switch (i.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                        return {
                            value: t
                        };
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        if ("checklist" !== this._getCompType())
                            return t;
                        var a = !1
                            , n = [];
                        return FX.Utils.forEach(t, function(t, e) {
                            e !== i.customItem._id ? n.push(e) : a = !0
                        }),
                            {
                                hasEmpty: a,
                                items: n
                            };
                    default:
                        return null
                }
            }
            return null
        },
        getOptions: function() {
            return s.extend(FX.DashUser.superclass.getOptions.apply(this, arguments), {
                type: "user_filter"
            }, this.getEditConfig())
        }
    }),
        s.shortcut("dashuser", FX.DashUser)
}(jQuery),
function(s) {
    FX.DashUserGroup = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return s.extend(FX.DashUserGroup.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null,
                customItem: {
                    text: i18next.t("unfilled"),
                    value: "hasEmpty"
                },
                displayType: {
                    list: "checklist",
                    box: "usercheck"
                }
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.ALL, FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this.options;
            switch (FX.DashUserGroup.superclass._createValCell.apply(this, arguments),
                t.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.ALL:
                case FX.CONST.FILTER_METHOD.IN:
                    this._createComboCheck();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _createComboCheck: function() {
            var t = this.options;
            t.fields && t.fields.length ? this._createMain(this._getAsyncConfig()) : this._createMain()
        },
        _createMain: function(t) {
            var e = this.options
                , i = this
                , a = this._getCompType()
                , n = {
                renderEl: s("<div/>").appendTo(this.$content),
                width: "100%",
                type: a,
                async: t,
                hasLimit: !0,
                items: [],
                onStopEdit: function() {
                    FX.Utils.applyFunc(i, e.onStopEdit, [], !1)
                }
            };
            "checklist" === a ? s.extend(n, {
                height: this.getDashContentHeight()
            }) : s.extend(n, {
                hasSelectEmpty: !1
            }),
                s.extend(n, {
                    textField: "nickname",
                    valueField: "_id"
                }),
                this.dashUserGroup = FX.createWidget(n)
        },
        doFilterRely: function(t) {
            var e = this.options;
            switch (FX.DashUserGroup.superclass.doFilterRely.apply(this, arguments),
                e.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.ALL:
                case FX.CONST.FILTER_METHOD.IN:
                    this.dashUserGroup.doFilterRely(t)
            }
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashUserGroup)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.ALL:
                    case FX.CONST.FILTER_METHOD.IN:
                        this.dashUserGroup.setValue(this._formatComboValue(t))
                }
        },
        getValue: function() {
            var i = this.options;
            if (this.dashUserGroup) {
                var t = this.dashUserGroup.getValue();
                switch (i.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.ALL:
                    case FX.CONST.FILTER_METHOD.IN:
                        if ("checklist" !== this._getCompType())
                            return t;
                        var a = !1
                            , n = [];
                        return FX.Utils.forEach(t, function(t, e) {
                            e !== i.customItem.value ? n.push(e) : a = !0
                        }),
                            {
                                hasEmpty: a,
                                items: n
                            };
                    default:
                        return null
                }
            }
            return null
        },
        getOptions: function() {
            return s.extend(FX.DashUserGroup.superclass.getOptions.apply(this, arguments), {
                type: "usergroup_filter"
            }, this.getEditConfig())
        }
    }),
        s.shortcut("dashusergroup", FX.DashUserGroup)
}(jQuery),
function(i) {
    FX.DashFlowState = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return i.extend(FX.DashFlowState.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE]
        },
        _createValCell: function() {
            FX.DashFlowState.superclass._createValCell.apply(this, arguments),
                this._createMain()
        },
        _createMain: function() {
            var t = this.options
                , e = this;
            this.dashFlowState = new FX.ComboBox({
                renderEl: i("<div/>").appendTo(this.$content),
                colorEnable: !0,
                items: FX.Utils.getFlowStateItems(),
                width: "100%",
                allowBlank: !0,
                searchable: !1,
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }
            })
        },
        setValue: function(t) {
            t = t && t.items ? t.items[0] : t && t.value,
                this.dashFlowState.setValue(t)
        },
        getValue: function() {
            return {
                value: this.dashFlowState.getValue()
            }
        },
        getOptions: function() {
            return i.extend(FX.DashFlowState.superclass.getOptions.apply(this, arguments), {
                type: "flowstate_filter"
            }, this.getEditConfig())
        }
    }),
        i.shortcut("dashflowstate", FX.DashFlowState)
}(jQuery),
function(t) {
    FX.DashFile = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return t.extend(FX.DashFile.superclass._defaultConfig.apply(this, arguments), {
                minRow: 10,
                onStopEdit: null
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        setValue: function() {},
        getValue: function() {
            return null
        },
        getOptions: function() {
            return t.extend(FX.DashFile.superclass.getOptions.apply(this, arguments), {
                type: "filelist_filter"
            }, this.getEditConfig())
        }
    }),
        t.shortcut("dashfile", FX.DashFile)
}(jQuery),
function(o) {
    FX.DashDept = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return o.extend(FX.DashDept.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fui_dash_dept",
                minRow: 12,
                onStopEdit: null,
                displayType: {
                    list: "deptchecklist",
                    box: "deptcheck"
                }
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.NE, FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.NIN, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this.options;
            switch (FX.DashDept.superclass._createValCell.apply(this, arguments),
                t.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                    this._createMain({
                        hasSelectEmpty: !1,
                        hasSelectAll: !1,
                        width: "100%",
                        textField: "name",
                        valueField: "_id",
                        hasScrollLoad: !0,
                        multiSelect: !1,
                        allowBlank: !0
                    });
                    break;
                case FX.CONST.FILTER_METHOD.IN:
                case FX.CONST.FILTER_METHOD.NIN:
                    this._createMain();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _getCompType: function() {
            switch (this.options.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.NE:
                    return "deptcheck";
                default:
                    return FX.DashDept.superclass._getCompType.apply(this, arguments)
            }
        },
        _createMain: function(t) {
            var e, i = this.options, a = this, n = t && t.hasSelectEmpty || i.method === FX.CONST.FILTER_METHOD.IN, s = this._getCompType(), r = o.extend({
                renderEl: o("<div/>").appendTo(this.$content),
                width: "100%",
                type: s,
                hasSelectEmpty: n,
                departmentsUrl: FX.Utils.getApi(FX.API.dash.departments),
                currentDepartmentsUrl: FX.Utils.getApi(FX.API.dash.current_departments),
                onStopEdit: function() {
                    FX.Utils.applyFunc(a, i.onStopEdit, [], !1)
                }
            }, t);
            "deptchecklist" === s && (e = "dash_dept_check",
            n && (e += " has-empty"),
                r.customCls = e),
                this.dashDept = FX.createWidget(r)
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashDept)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        this.dashDept.setValue(t)
                }
        },
        getValue: function() {
            var t = this.options;
            if (this.dashDept)
                switch (t.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.NE:
                    case FX.CONST.FILTER_METHOD.IN:
                    case FX.CONST.FILTER_METHOD.NIN:
                        return this.dashDept.getValue();
                    default:
                        return null
                }
            return null
        },
        getOptions: function() {
            return o.extend(FX.DashDept.superclass.getOptions.apply(this, arguments), {
                type: "dept_filter"
            }, this.getEditConfig())
        }
    }),
        o.shortcut("dashdept", FX.DashDept)
}(jQuery),
function(n) {
    FX.DashDeptGroup = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return n.extend(FX.DashDeptGroup.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fui_dash_dept_group",
                minRow: 12,
                onStopEdit: null,
                displayType: {
                    list: "deptchecklist",
                    box: "deptcheck"
                }
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.IN, FX.CONST.FILTER_METHOD.ALL, FX.CONST.FILTER_METHOD.EQ, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            var t = this.options;
            switch (FX.DashDeptGroup.superclass._createValCell.apply(this, arguments),
                t.method) {
                case FX.CONST.FILTER_METHOD.EQ:
                case FX.CONST.FILTER_METHOD.ALL:
                case FX.CONST.FILTER_METHOD.IN:
                    this._createMain();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _createMain: function() {
            var t = this.options
                , e = this
                , i = this._getCompType()
                , a = {
                renderEl: n("<div/>").appendTo(this.$content),
                width: "100%",
                type: i,
                hasSelectEmpty: !1,
                departmentsUrl: FX.Utils.getApi(FX.API.dash.departments),
                currentDepartmentsUrl: FX.Utils.getApi(FX.API.dash.current_departments),
                onStopEdit: function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }
            };
            "deptchecklist" === i && (a.customCls = "dash_dept_check"),
                this.dashDeptGroup = FX.createWidget(a)
        },
        setValue: function(t) {
            var e = this.options;
            if (this.dashDeptGroup)
                switch (e.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.ALL:
                    case FX.CONST.FILTER_METHOD.IN:
                        this.dashDeptGroup.setValue(t)
                }
        },
        getValue: function() {
            var t = this.options;
            if (this.dashDeptGroup)
                switch (t.method) {
                    case FX.CONST.FILTER_METHOD.EQ:
                    case FX.CONST.FILTER_METHOD.ALL:
                    case FX.CONST.FILTER_METHOD.IN:
                        return this.dashDeptGroup.getValue();
                    default:
                        return null
                }
            return null
        },
        getOptions: function() {
            return n.extend(FX.DashDeptGroup.superclass.getOptions.apply(this, arguments), {
                type: "deptgroup_filter"
            }, this.getEditConfig())
        }
    }),
        n.shortcut("dashdeptgroup", FX.DashDeptGroup)
}(jQuery),
function(t) {
    FX.DashButton = FX.extend(FX.Widget, {
        DEFAULT_SIZE: {
            defaultSizeX: 6,
            defaultSizeY: 3,
            minSizeX: 4,
            minSizeY: 2
        },
        _defaultConfig: function() {
            return t.extend(FX.DashButton.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_button",
                onClick: null,
                text: i18next.t("filter")
            })
        },
        _init: function() {
            FX.DashButton.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.element.addClass("x-btn style-green").text(t.text).on("click", function() {
                FX.Utils.applyFunc(e, t.onClick, [], !1)
            })
        },
        doResize: function(t) {
            FX.DashButton.superclass.doResize.apply(this, arguments),
            t && this.element.css("line-height", t.height + "px")
        },
        getSize: function() {
            return this.DEFAULT_SIZE
        },
        getOptions: function() {
            return t.extend(FX.DashButton.superclass.getOptions.apply(this, arguments), {
                type: "filter_btn"
            })
        }
    }),
        t.shortcut("dashbutton", FX.DashButton)
}(jQuery),
function(n) {
    FX.DashDescription = FX.extend(FX.Widget, {
        TOOLBAR: [["font", ["bold", "italic", "underline"]], ["para", ["paragraph"]], ["color", ["color"]], ["fontsize", ["fontsize"]], ["insert", ["custom_link", "unlink"]]],
        _defaultConfig: function() {
            return n.extend(FX.DashDescription.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_dash_description",
                onStopEdit: null,
                maxWords: 500,
                content: ""
            })
        },
        _init: function() {
            FX.DashDescription.superclass._init.apply(this, arguments),
                this.content = this.options.content,
                this._renderContent()
        },
        _renderRich: function() {
            var e = this.options
                , i = this
                , a = n(".fui_dash_rich");
            a.length || (a = n('<div class="fui_dash_rich"/>').on("mousedown", function(t) {
                n(t.target).closest(".dash-rich").length || (a.remove(),
                    n(window).off("resize.dash_rich"),
                    i.element.parents(".block-content").prevAll(".gs-resize-handle").show(),
                    FX.Utils.applyFunc(i, e.onStopEdit, [i.content], !1))
            }).appendTo("body")),
                a.empty();
            var t = this.element.offset();
            this.$editor = n('<div class="dash-rich"/>').css({
                left: t.left + 9,
                top: t.top + 10
            }).appendTo(a),
                this.editor = new FX.RichText({
                    renderEl: this.$editor,
                    toolbar: this.TOOLBAR,
                    width: e.width - 10,
                    height: e.height - 35,
                    onAfterEdit: function() {
                        var t = i.content;
                        if (i.content = this.getValue(),
                        i._getContentWords() > e.maxWords)
                            return this.reset(),
                                void this.setValue(t);
                        i._setFooterText()
                    },
                    onPaste: function(t) {
                        var e = ((t.originalEvent || t).clipboardData || window.clipboardData).getData("Text");
                        t.preventDefault(),
                            document.execCommand("insertText", !1, e)
                    }
                }),
                this.editor.focus(),
                this.editor.setValue(this.content),
                this._setFooterText(),
                this._setToolBarPos(),
                n(window).on("resize.dash_rich", function() {
                    var t = i.element.offset();
                    i.$editor && i.$editor.css({
                        left: t.left + 9,
                        top: t.top + 10
                    })
                })
        },
        _getContentWords: function() {
            var t = document.createElement("div");
            t.innerHTML = this.content;
            var e = t.textContent;
            return e && e.length
        },
        _createEmpty: function() {
            FX.Utils.isEmpty(this.content) ? n(".dash-empty", this.element).length || n('<div class="dash-empty"/>').text(i18next.t("dash.description.empty")).appendTo(this.element) : this._removeEmpty()
        },
        _removeEmpty: function() {
            n(".dash-empty", this.element).remove()
        },
        _setToolBarPos: function() {
            if (this.$editor) {
                var t = n(".note-toolbar", this.$editor)
                    , e = t.outerWidth();
                if (this.element.outerWidth() < e)
                    if (this.element.offset().left + 20 + e > n("body").outerWidth())
                        return void t.css({
                            left: "auto",
                            right: 0
                        });
                t.css({
                    left: -10,
                    right: "auto"
                })
            }
        },
        _setFooterText: function() {
            var t = this.options
                , e = n(".dash-footer", this.$editor);
            e.length || (e = n('<div class="dash-footer"/>').appendTo(this.$editor)),
                e.text((this._getContentWords() || 0) + "/" + t.maxWords)
        },
        _renderContent: function() {
            var t = this.options
                , e = n(".dash-content", this.element);
            e.length || (e = n('<div class="dash-content"/>').appendTo(this.element)),
                e.show().empty().append(n('<div class="content-container"/>').html(this.content)),
            "edit" === t.mode && this._createEmpty()
        },
        doEdit: function() {
            n(".dash-content", this.element).hide(),
                this.element.parents(".block-content").prevAll(".gs-resize-handle").hide(),
                this._removeEmpty(),
                this._renderRich()
        }
    }),
        n.shortcut("dashdescription", FX.DashDescription)
}(jQuery),
function(t) {
    FX.DashPhone = FX.extend(FX.DashFilterBase, {
        _defaultConfig: function() {
            return t.extend(FX.DashPhone.superclass._defaultConfig.apply(this, arguments), {
                onStopEdit: null
            })
        },
        _getAvailableMethods: function() {
            return [FX.CONST.FILTER_METHOD.LK, FX.CONST.FILTER_METHOD.VF, FX.CONST.FILTER_METHOD.NVF, FX.CONST.FILTER_METHOD.EP, FX.CONST.FILTER_METHOD.NEP]
        },
        _createValCell: function() {
            switch (FX.DashPhone.superclass._createValCell.apply(this, arguments),
                this.options.method) {
                case FX.CONST.FILTER_METHOD.LK:
                    this._createMain();
                    break;
                default:
                    this.$content.remove(),
                        this.$content = null
            }
        },
        _createMain: function() {
            var e = this.options
                , i = this;
            this.dashPhone = new FX.Phone({
                renderEl: t("<div/>").appendTo(this.$content),
                hasSmsVerify: !1,
                needValidatePhone: !1,
                onStopEdit: function(t) {
                    FX.Utils.applyFunc(i, e.onStopEdit, [t], !1)
                }
            })
        },
        setValue: function(t) {
            this.dashPhone && this.dashPhone.setValue(t)
        },
        getValue: function() {
            return this.dashPhone && this.dashPhone.getValue() || null
        },
        getOptions: function() {
            return t.extend(FX.DashPhone.superclass.getOptions.apply(this, arguments), {
                type: "phone_filter"
            }, this.getEditConfig())
        }
    }),
        t.shortcut("dashphone", FX.DashPhone)
}(jQuery),
function(e) {
    FX.DashSort = function(t) {
        this.options = e.extend({
            sorts: [],
            onChange: null,
            onFail: null,
            onRemoveIncompatible: null,
            maxCount: FX.CONST.MAX_DASH_SORT_COUNT,
            maxCustomSortCount: FX.CONST.MAX_DASH_CUSTOM_SORT_COUNT
        }, t),
            this._init()
    }
        ,
        e.extend(FX.DashSort.prototype, {
            _init: function() {
                this.clientList = {},
                    this.sorts = this.options.sorts.slice() || [];
                var t = this.options.onChange;
                this._listen("update", t),
                    this._listen("remove", t),
                    this._listen("add", t),
                    this._listen("reset", t)
            },
            _listen: function(t, e) {
                this.clientList[t] || (this.clientList[t] = []),
                    this.clientList[t].push(e)
            },
            _trigger: function() {
                var t = Array.prototype.shift.call(arguments);
                if (this.clientList[t])
                    for (var e = this.clientList[t], i = 0; i < e.length; i++)
                        e[i] && e[i].apply(this, arguments)
            },
            _update: function(t, e) {
                var i = this.options
                    , a = this.sorts[t];
                if (!a)
                    return !1;
                if (-1 !== i.maxCustomSortCount && this.isCustomSort(e) && (!this.isCustomSort(a) && this.getCustomSortsCount() === i.maxCustomSortCount))
                    return FX.Utils.applyFunc(this, i.onFail, [FX.CONST.DASH_SORT_ERROR.MAX_CUSTOM_SORT_COUNT], !1),
                        !1;
                return this.sorts.splice(t, 1, e),
                    this._trigger("update"),
                    !0
            },
            _remove: function(t) {
                return !!this.sorts[t] && (this.sorts.splice(t, 1),
                    this._trigger("remove"),
                    !0)
            },
            _add: function(t, e, i) {
                var a, n = this.options, s = FX.CONST.DASH_SORT_ERROR;
                return -1 !== n.maxCount && n.maxCount === this.sorts.length ? (FX.Utils.applyFunc(this, n.onFail, [s.MAX_COUNT], !1),
                    !1) : -1 !== n.maxCustomSortCount && this.isCustomSort(e) && this.getCustomSortsCount() === n.maxCustomSortCount ? (FX.Utils.applyFunc(this, n.onFail, [s.MAX_CUSTOM_SORT_COUNT], !1),
                    !1) : (this.sorts.splice(t, 0, e),
                !i || (a = this._getSortByTag(i)) && (this.sorts.splice(a.idx, 1),
                    FX.Utils.applyFunc(this, n.onRemoveIncompatible, [i], !1)),
                    this._trigger("add"),
                    !0)
            },
            _getSortByTag: function(i) {
                var a;
                if (i)
                    return FX.Utils.forEach(this.sorts, function(t, e) {
                        if (!FX.Utils.isEmpty(e[i]))
                            return !(a = {
                                idx: t,
                                sort: e
                            })
                    }),
                        a
            },
            reset: function(t) {
                if (!t)
                    return !1;
                var e = this.options
                    , i = FX.CONST.DASH_SORT_ERROR;
                return -1 !== e.maxCount && t.length > e.maxCount ? (FX.Utils.applyFunc(this, e.onFail, [i.MAX_COUNT], !1),
                    !1) : -1 !== e.maxCustomSortCount && this.getCustomSortsCount() > e.maxCustomSortCount ? (FX.Utils.applyFunc(this, e.onFail, [i.MAX_CUSTOM_SORT_COUNT], !1),
                    !1) : (this.sorts = t.slice(0),
                    this._trigger("reset"),
                    !0)
            },
            updateSort: function(t, e, i) {
                var a = this._getSortByTag(t)
                    , n = {};
                if (n[t] = e,
                    FX.Utils.isObjectEmpty(a))
                    return !!e && this._add(this.sorts.length, n, i);
                switch (e) {
                    case FX.CONST.SORT.DEFAULT:
                        return this._remove(a.idx);
                    default:
                        return this._update(a.idx, n)
                }
            },
            getSortValueByTag: function(t) {
                var e = this._getSortByTag(t);
                return e && e.sort[t]
            },
            getSorts: function() {
                return this.sorts
            },
            getCustomSorts: function() {
                var i = this
                    , a = [];
                return FX.Utils.forEach(this.getSorts(), function(t, e) {
                    i.isCustomSort(e) && a.push(e)
                }),
                    a
            },
            getCustomSortsCount: function() {
                return this.getCustomSorts().length
            },
            isCustomSort: function(t) {
                var i = !1;
                return FX.Utils.forEach(t, function(t, e) {
                    if (FX.DashUtils.isCustomSort(e))
                        return !(i = !0)
                }),
                    i
            },
            getSortedTags: function() {
                var i = [];
                return FX.Utils.forEach(this.sorts, function(t, e) {
                    i = i.concat(Object.keys(e))
                }),
                    i
            },
            clear: function() {
                this.sorts = []
            }
        })
}(jQuery),
FX.Dash = FX.extend(FX.Widget, {
    _defaultConfig: function() {
        return $.extend(FX.Dash.superclass._defaultConfig.apply(this, arguments), {
            baseCls: "fui_dash",
            entryId: "",
            components: {},
            sizeUnit: 15,
            minWidth: 900,
            cols: 60,
            gap: 10,
            padding: [2, 10],
            hasLazyLoad: !1,
            supportExport: !0,
            relative: !1,
            scrollView: null,
            mode: "visit"
        })
    },
    _init: function() {
        FX.Dash.superclass._init.apply(this, arguments);
        var t = this.options;
        FX.STATIC.ENTRYID = t.entryId,
            this.widgetsMap = {},
            this._initSizeUnit(),
            this._initFilter(),
            this._renderComponents(),
            this._bindLazyLoadEvt()
    },
    _initSizeUnit: function() {
        var t = this.options
            , e = this.element.width() - t.gap - 2 * t.padding[1];
        this.widthUnit = Math.max(e, t.minWidth) / t.cols,
            this.heightUnit = t.sizeUnit
    },
    _getSize: function(t) {
        var e = this.options;
        return {
            x: t.posX * this.widthUnit + e.gap + e.padding[1],
            y: t.posY * this.heightUnit + e.gap + e.padding[0],
            width: t.width * this.widthUnit - e.gap,
            height: t.height * this.heightUnit - e.gap
        }
    },
    _renderComponents: function() {
        var i = this
            , t = this.options;
        FX.Utils.forEach(t.components, function(t, e) {
            e && i._renderWidget(t, e).setFilter(i._getFilter(t))
        }),
            this.$dashGap = $('<div class="dash-gap"/>').css({
                top: this.lastBottomHeight + "px",
                height: t.gap + "px"
            }).appendTo(this.element),
            this._doLazyLoad()
    },
    _renderWidget: function(i, e) {
        var a = this
            , n = this.options
            , t = $('<div class="dash-widget"/>').appendTo(this.element)
            , s = this._getSize(e);
        t.css({
            left: s.x + "px",
            top: s.y + "px",
            width: s.width + "px",
            height: s.height + "px"
        }),
            this.lastBottomHeight ? this.lastBottomHeight = Math.max(this.lastBottomHeight, s.y + s.height) : this.lastBottomHeight = s.y + s.height,
        this.filter[i] && (e.relyFilter = this.filter[i].relyFilter);
        var r = new FX.DashBlock($.extend({
            renderEl: t,
            widget: e,
            operate: this._getOperate(e),
            hasLazyLoad: n.hasLazyLoad,
            mode: n.mode,
            widgetId: i,
            dashTitle: n.name,
            onItemClick: function(t) {
                a._triggerLink(e, t)
            },
            onClearLink: function(t) {
                FX.Utils.isObjectEmpty(t) ? FX.Msg.toast({
                    type: "warning",
                    msg: i18next.t("dash.link.empty")
                }) : (a._triggerLink(e, {}),
                    FX.Msg.toast({
                        type: "success",
                        msg: i18next.t("dash.link.canceled")
                    }))
            },
            onClick: function() {
                a._dealFilter()
            },
            onOperateTrigger: function(t, e) {
                a._dealOperate(t, i, e)
            },
            onStopEdit: function() {
                var t = this.getValue();
                a._updateFilter(i, $.extend(e, {
                    method: this.getMethod()
                }), t),
                a.hasFilterBtn || a._dealFilter(e.triggers),
                    FX.Utils.forEach(e.rely, function(t, e) {
                        a.widgetsMap[e].doFilterRely(FX.DashUtils.getFilterRelyFilter(e, a.filter))
                    }),
                this.relyFilter && this.relyFilter.cond && this.relyFilter.cond.length && FX.Utils.dt(FX.CONST.TRACKER.DASH_RELY_FILTER_VISIT)
            },
            onAfterWidgetUpdate: function(t) {
                $.extend(e, {
                    dataPerms: t.dataPerms
                }),
                    r.updateOperate(a._getOperate(e, r.isFullScreen(), r.getBatchUpdate()))
            },
            onHeadToolUpdate: function() {
                r.updateOperate(a._getDeleteOperate())
            },
            onETLUpdate: function(i, t) {
                "visit" === n.mode ? (FX.Utils.forEach(a.widgetsMap, function(t, e) {
                    e && e.widgetData.form === i && e.isWidgetLoaded() && e.updateETLInfo({
                        last_status: FX.CONST.ETL_STATUS.RUNNING
                    })
                }),
                    a._triggerETLRunning(i),
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.etl.execute, FX.STATIC.APPID, FX.STATIC.ENTRYID, t)
                    }, null, function(t) {
                        var e = t.responseJSON || {};
                        a._triggerETLFail(e.code, i)
                    })) : FX.Msg.toast({
                    type: "warning",
                    msg: i18next.t("etl.update.notSupport")
                })
            },
            onETLRunning: function(t) {
                a._triggerETLRunning(t)
            }
        }, this._getBlockConfig(e.type)));
        return this.widgetsMap[i] = r
    },
    _triggerETLFail: function(t, e) {
        var i = this;
        switch (t) {
            case 3071:
            case 3e3:
                this._triggerETLUpdate(e);
                break;
            default:
                var a = $("<div>" + i18next.t("dash.refreshed.failInfo") + "</div>")
                    , n = $('<div class="foot-btn-group"/>').appendTo(a);
                new FX.Button({
                    renderEl: $('<div class="foot-btn"/>').appendTo(n),
                    style: "green",
                    text: i18next.t("iSee"),
                    width: 70,
                    height: 24,
                    onClick: function() {
                        s.close(),
                            i._triggerETLUpdate(e)
                    }
                });
                var s = FX.Msg.notice({
                    title: i18next.t("dash.refreshed.fail"),
                    content: a,
                    type: "success"
                })
        }
    },
    _triggerETLRunning: function(t) {
        var s = this;
        FX.Socket.onETLUpdateComplete(t, function(t, e) {
            switch (e.status) {
                case "success":
                    var i = $("<div>" + i18next.t("dash.refresh.info") + "</div>")
                        , a = $('<div class="foot-btn-group"/>').appendTo(i);
                    new FX.Button({
                        renderEl: $('<div class="foot-btn"/>').appendTo(a),
                        style: "green",
                        text: i18next.t("dash.refresh"),
                        width: 70,
                        height: 24,
                        onClick: function() {
                            n.close(),
                                s._triggerETLUpdate(t)
                        }
                    });
                    var n = FX.Msg.notice({
                        title: i18next.t("dash.refreshed"),
                        content: i,
                        type: "success"
                    });
                    break;
                case "failure":
                    s._triggerETLFail(e.errCode, t)
            }
        })
    },
    _triggerETLUpdate: function(a) {
        var n = this.$scrollView.offset().top
            , s = this.$scrollView.outerHeight();
        FX.Utils.forEach(this.widgetsMap, function(t, e) {
            var i;
            e && e.widgetData.form === a && (i = e.element.offset().top,
                n <= i && i <= s || e.isFullScreen() ? (e.loadWidget(),
                    e.isException(function(t) {
                        t && (e.updateOperate([]),
                            e.removeCustomOperate())
                    })) : e.isLoaded = !1)
        })
    },
    _triggerLink: function(t, a) {
        var n = this;
        FX.Utils.forEach(t.triggers, function(t, e) {
            var i = n.getWidgetByName(e);
            i && (i.setLinkFilter(a),
                i.reload())
        })
    },
    _getDeleteOperate: function() {
        return ["deleteSelected", "cancel"]
    },
    _getBatchUpdateOperate: function(t) {
        var e = ["setFields"];
        return e.push(t ? "shrink" : "enlarge"),
            e
    },
    _getOperate: function(t, e, i) {
        var a = [];
        return i ? (a.push("setFields"),
            a.push(e ? "shrink" : "enlarge")) : (t.dataPerms && ((t.dataPerms.create || t.dataPerms.flow_create) && a.push("create"),
        (t.dataPerms.batch_update || t.dataPerms.flow_batch_update) && "data_manage" === t.type && a.push("batchUpdate"),
        (t.dataPerms.import || t.dataPerms.flow_import) && a.push("import")),
        this._hasClearLink(t) && a.push("clearLink"),
        this._hasExport(t) && a.push("export"),
        t.dataPerms && (t.dataPerms.delete || t.dataPerms.flow_delete) && a.push("delete"),
        "data_manage" === t.type && a.push("setFields"),
        this._hasSort(t) && (a.push("refreshSort"),
        "map_chart" !== t.type && a.push("sort")),
        t.form && this._checkFieldsValid(t) && (e ? a.push("shrink") : a.push("enlarge"))),
            a
    },
    _hasExport: function(t) {
        var e = this.options;
        return "data_manage" === t.type ? t.dataPerms && (t.dataPerms.export || t.dataPerms.flow_export) : e.supportExport && t.hasExport && /table/.test(t.type) && this._checkFieldsValid(t)
    },
    _hasClearLink: function(t) {
        return !/_filter$/.test(t.type) && !FX.Utils.isObjectEmpty(t.triggers)
    },
    _checkFieldsValid: function(t) {
        if (FX.Utils.isObjectEmpty(t))
            return !1;
        var e = !0;
        switch (t.type) {
            case "line_chart":
            case "column_chart":
            case "bar_chart":
            case "area_chart":
            case "radar_chart":
            case "pie_chart":
            case "map_chart":
                e = (0 < t.xFields.length || 0 < t.yFields.length) && 0 < t.metrics.length;
                break;
            case "pivot_table":
                e = 0 < t.xFields.length || 0 < t.yFields.length || 0 < t.metrics.length;
                break;
            case "multi_axes_chart":
                e = 0 < t.xFields.length && 0 < t.metrics.length;
                break;
            case "metric_table":
                e = 0 < t.metrics.length;
                break;
            case "data_table":
                e = t.fields && 0 < t.fields.length
        }
        return e
    },
    _hasSort: function(t) {
        return !("metric_table" === t.type && t.xFields.length <= 0) && ((/chart/.test(t.type) || /table/.test(t.type)) && this._checkFieldsValid(t))
    },
    _dealOperate: function(t, e, i) {
        var a = this.widgetsMap[e];
        if (a)
            switch (t) {
                case "enlarge":
                    a.updateOperate(this._getOperate(a.getOptions(), !0, a.getBatchUpdate())),
                        a.enlarge();
                    break;
                case "shrink":
                    a.updateOperate(this._getOperate(a.getOptions(), !1, a.getBatchUpdate())),
                        a.shrink();
                    break;
                case "export":
                    a.dealExcelExport(i);
                    break;
                case "create":
                    a.doDataCreate();
                    break;
                case "import":
                    a.dealExcelImport();
                    break;
                case "delete":
                    a.dealOnDataDelete();
                    break;
                case "deleteSelected":
                    a.dealDataDeleteSelected();
                    break;
                case "cancel":
                    a.dealCancel();
                    break;
                case "setFields":
                    a.dealSetFields(i);
                    break;
                case "refreshSort":
                    a.dealRefreshSort();
                    break;
                case "sort":
                    a.dealSort();
                    break;
                case "clearLink":
                    a.dealClearLink();
                    break;
                case "batchUpdate":
                    a.dealBatchUpdate(),
                        a.updateOperate(this._getBatchUpdateOperate(a.isFullScreen())),
                        a.setBatchUpdate(!0)
            }
    },
    _initFilter: function() {
        var t = this.options
            , n = this;
        this.hasFilterBtn = !1,
            this.filter = {},
            FX.Utils.forEach(t.components, function(t, e) {
                var i, a;
                e && ("filter_btn" === e.type && (n.hasFilterBtn = !0),
                FX.LimitFields.dashCompFilter.indexOf(e.type) < 0 || e.fields.length && (a = {
                    entryId: (i = e.fields[0]).form,
                    field: i.field,
                    triggers: e.triggers
                },
                i.subform && $.extend(a, {
                    subform: i.subform,
                    subField: i.subField
                }),
                    n.filter[t] = a,
                    n._updateFilter(t, e, e.defaultConfig)))
            }),
            FX.Utils.forEach(this.filter, function(t) {
                n.filter[t].relyFilter = FX.DashUtils.getFilterRelyFilter(t, n.filter)
            })
    },
    _updateFilter: function(t, e, i) {
        this.filter[t] = this.filter[t] || {},
            $.extend(this.filter[t], FX.DashUtils.getFilterByComponent(t, e, i))
    },
    _getFilter: function(t) {
        return FX.DashUtils.getFilterByWidgetName(t, this.filter, this.options.components)
    },
    _dealFilter: function(t) {
        var a = this;
        t ? FX.Utils.forEach(t, function(t, e) {
            var i = a.widgetsMap[e];
            i && (i.setFilter(a._getFilter(e)),
                i.reload())
        }) : FX.Utils.forEach(this.widgetsMap, function(t, e) {
            e && (e.setFilter(a._getFilter(t)),
                e.reload())
        })
    },
    _bindLazyLoadEvt: function() {
        var t = this.options
            , e = this;
        t.hasLazyLoad && (this._doLazyLoad(),
            this.$scrollView = this.element,
        t.scrollView && (this.$scrollView = $(t.scrollView)),
            this.$scrollView.unbind("scroll.lazy"),
            this.$scrollView.bind("scroll.lazy", function() {
                e._doLazyLoad()
            }))
    },
    _doLazyLoad: function() {
        this.options.hasLazyLoad && FX.Utils.forEach(this.widgetsMap, function(t, e) {
            e && (e.isWidgetLoaded() || $(e.element).offset().top <= document.body.clientHeight && (e.loadWidget(),
                e.isException(function(t) {
                    t && e.updateOperate([])
                })))
        })
    },
    _getBlockConfig: function(t) {
        var e = {};
        switch (t) {
            case "description":
            case "filter_btn":
                e = {
                    margin: [0, 0]
                }
        }
        return e
    },
    getWidgetByName: function(t) {
        return this.widgetsMap[t]
    },
    updateComponentsPos: function() {
        var a = this
            , t = this.options;
        this._initSizeUnit(),
            FX.Utils.forEach(t.components, function(t, e) {
                var i;
                e && (i = a._getSize(e),
                    a.widgetsMap[t].element.css({
                        left: i.x + "px",
                        top: i.y + "px",
                        width: i.width + "px",
                        height: i.height + "px"
                    }),
                    a.widgetsMap[t].doResize(),
                    a.lastBottomHeight ? a.lastBottomHeight = Math.max(a.lastBottomHeight, i.y + i.height) : a.lastBottomHeight = i.y + i.height)
            }),
            this.$dashGap.css({
                top: this.lastBottomHeight + "px",
                height: t.gap + "px"
            })
    },
    doResize: function(t, e) {
        FX.Dash.superclass.doResize.apply(this, arguments);
        var i = this.options;
        e && this.updateComponentsPos(),
        i.relative && this.element.addClass("relative").css({
            height: this.lastBottomHeight + 10
        })
    }
}),
$.shortcut("dash", FX.Dash),
function(l) {
    FX.TableContainer = FX.extend(FX.Container, {
        _defaultConfig: function() {
            return l.extend(FX.TableContainer.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-layout-table",
                rowSize: [],
                colSize: [],
                hgap: 0,
                vgap: 0,
                items: [],
                padding: 0
            })
        },
        _init: function() {
            FX.TableContainer.superclass._init.apply(this, arguments),
                this.$rows = [];
            var t = this.options;
            t.padding && this.element.css({
                padding: t.padding
            });
            for (var e = 0, i = t.rowSize.length; e < i; e++) {
                for (var a = l('<div class="x-layout-table-row"/>').appendTo(this.element), n = 0, s = t.colSize.length; n < s; n++) {
                    var r, o = t.items[e][n];
                    o && (r = l('<div class="x-layout-table-item"/>').appendTo(a),
                        o.type ? this._addWidget(l.extend(o, {
                            width: o.width ? o.width : t.colSize[n],
                            height: o.height ? o.height : t.rowSize[e],
                            renderEl: r
                        })) : r.css({
                            width: t.colSize[n],
                            height: t.rowSize[e]
                        }).append(o),
                    0 < n && r.css({
                        "margin-left": t.hgap
                    }))
                }
                0 < e && a.css({
                    "margin-top": t.vgap
                }),
                    this.$rows.push(a)
            }
        },
        getRowAt: function(t) {
            return this.$rows[t]
        },
        setRowVisible: function(t, e) {
            for (var i = 0, a = t.length; i < a; i++)
                e ? this.$rows[t[i]].show() : this.$rows[t[i]].hide()
        }
    }),
        l.shortcut("tablecontainer", FX.TableContainer)
}(jQuery),
FX.InputNumber = FX.extend(FX.Widget, {
    _defaultConfig: function() {
        return $.extend(FX.InputNumber.superclass._defaultConfig.apply(), {
            baseCls: "x-input-number",
            min: -1 / 0,
            max: 1 / 0,
            step: 1,
            defaultValue: 0,
            allowNegative: !0,
            controls: !0,
            controlPos: "",
            editable: !0,
            onValidateFail: null,
            onChange: null,
            width: 155
        })
    },
    _init: function() {
        FX.InputNumber.superclass._init.apply(this, arguments);
        var t, e = this.options, i = this;
        this.input = new FX.Number({
            renderEl: $('<div class="input-number"/>').appendTo(this.element),
            width: "auto",
            enable: e.editable,
            allowNegative: e.allowNegative,
            onValidateFail: function(t) {
                FX.Utils.applyFunc(i, e.onValidateFail, [t], !1)
            },
            onStopEdit: function() {
                i.value = this.getValue(),
                    i.value <= e.min ? (i.value = e.min,
                        this.setValue(i.value)) : i.value >= e.max && (i.value = e.max,
                        this.setValue(i.value)),
                    i._checkControlState(),
                    FX.Utils.applyFunc(i, e.onChange, [], !1)
            }
        }),
        e.controls && ("right" === e.controlPos ? (this.element.addClass("control-in-right"),
            t = $('<div class="control-group"/>').appendTo(this.element),
            this.$increase = $('<div class="control-increase"><i class="icon-angleup"/></div>').appendTo(t),
            this.$descrease = $('<div class="control-decrease"><i class="icon-angledown"/></div>').appendTo(t)) : (this.$descrease = $('<div class="control-decrease"><i class="icon-minus"/></div>').prependTo(this.element),
            this.$increase = $('<div class="control-increase"><i class="icon-add"/></div>').appendTo(this.element))),
            this._bindEvent()
    },
    _bindEvent: function() {
        var t = this.options
            , e = this;
        this.$descrease.on("click", function() {
            !e.isEnabled() || e.value <= t.min || (FX.Utils.isNull(e.value) ? e.vlaue = t.defaultValue : e.value -= t.step,
                e.setValue(e.value),
                e._checkControlState(),
                FX.Utils.applyFunc(e, t.onChange, [], !1))
        }),
            this.$increase.on("click", function() {
                !e.isEnabled() || e.value >= t.max || (FX.Utils.isNull(e.value) ? e.vlaue = t.defaultValue : e.value += t.step,
                    e.setValue(e.value),
                    e._checkControlState(),
                    FX.Utils.applyFunc(e, t.onChange, [], !1))
            })
    },
    _checkControlState: function() {
        var t = this.options;
        this.$descrease && this.$descrease.toggleClass("control-disable", this.value <= t.min),
        this.$increase && this.$increase.toggleClass("control-disable", this.value >= t.max)
    },
    setEnable: function(t) {
        FX.InputNumber.superclass.setEnable.apply(this, [t]),
            this.input.setEnable(t),
        this.$descrease && this.$descrease.toggleClass("control-disable", !t),
        this.$increase && this.$increase.toggleClass("control-disable", !t)
    },
    getValue: function() {
        return this.value
    },
    setValue: function(t) {
        this.value = t,
            this.input.setValue(t),
            this._checkControlState()
    }
}),
$.shortcut("inputnumber", FX.InputNumber),
function(i) {
    FX.CheckBox = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return i.extend(FX.CheckBox.superclass._defaultConfig.apply(), {
                baseCls: "x-check",
                isSelected: !1,
                onStateChange: null
            })
        },
        _init: function() {
            FX.CheckBox.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            i('<i class="icon-blank"/>').appendTo(this.element),
                this.$text = i("<span/>").appendTo(this.element),
                this.element.click(function() {
                    e.isEnabled() && e.setSelected(!t.isSelected) && FX.Utils.applyFunc(e, t.onStateChange, [t.isSelected], !1)
                })
        },
        _initDefaultValue: function() {
            var t = this.options;
            FX.Utils.isEmpty(t.text) || this.setText(t.text),
            t.value && this.setValue(t.value)
        },
        setSelected: function(t) {
            return this.options.isSelected !== t && ((this.options.isSelected = t) ? this.element.addClass("select") : this.element.removeClass("select"),
                !0)
        },
        isSelected: function() {
            return this.options.isSelected
        },
        setValue: function(t) {
            t ? this.setSelected(!0) : this.setSelected(!1)
        },
        getValue: function() {
            return this.isSelected()
        },
        setText: function(t) {
            this.$text.text(t)
        },
        getText: function() {
            return this.$text.text()
        }
    }),
        i.shortcut("checkbox", FX.CheckBox)
}(jQuery),
function(i) {
    FX.Switch = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return i.extend(FX.Switch.superclass._defaultConfig.call(), {
                baseCls: "fui_switch",
                width: 44,
                height: 22,
                value: !1,
                onSwitch: null,
                btnPadding: 2,
                text4On: i18next.t("on"),
                text4Off: i18next.t("off")
            })
        },
        _init: function() {
            FX.Switch.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.$text = i('<span class="switch-text"/>').text(t.text4On).appendTo(this.element),
                this.$btn = i('<span class="switch-btn"/>').appendTo(this.element),
                this.element.click(function() {
                    e.isEnabled() && e._doSwitch(!t.value, !0)
                })
        },
        _doSwitch: function(t, e) {
            var i = this.options
                , a = this
                , n = {}
                , s = {}
                , r = "";
            i.value = t,
                r = !0 === i.value ? (this.element.addClass("on").removeClass("off"),
                    this.$text.text(""),
                    n.left = i.width - i.height + i.btnPadding,
                    s["padding-left"] = 0,
                    s["padding-right"] = i.height - 3 * i.btnPadding,
                    i.text4On) : (this.element.addClass("off").removeClass("on"),
                    this.$text.text(""),
                    n.left = i.btnPadding,
                    s["padding-left"] = i.height - 3 * i.btnPadding,
                    s["padding-right"] = 0,
                    i.text4Off),
                e ? this.$btn.animate(n, 150, function() {
                    a.element.css(s),
                        a.$text.text(r),
                        FX.Utils.applyFunc(a, i.onSwitch, [i.value], !1)
                }) : (this.$btn.css(n),
                    this.element.css(s),
                    this.$text.text(r))
        },
        setValue: function(t) {
            this._doSwitch(t, !1)
        },
        getValue: function() {
            return this.options.value
        },
        doResize: function(t) {
            FX.Switch.superclass.doResize.apply(this, arguments);
            var e = this.options
                , i = e.height
                , a = e.width
                , n = i - 2 * e.btnPadding
                , s = {};
            i && (s["line-height"] = i + "px"),
            a && (this.$btn.css({
                width: n,
                height: n
            }),
                s["border-radius"] = a / 2),
                this.element.css(s)
        }
    }),
        i.shortcut("switch", FX.Switch)
}(jQuery),
function(t) {
    FX.Button = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return t.extend(FX.Button.superclass._defaultConfig.apply(), {
                baseCls: "x-btn",
                iconCls: null,
                style: "blue"
            })
        },
        _init: function() {
            FX.Button.superclass._init.apply(this, arguments);
            var e = this.options
                , i = this;
            e.iconCls && t("<i/>").addClass(e.iconCls).appendTo(this.element),
                this.$text = t("<span/>").appendTo(this.element),
            e.style && this.element.addClass("style-" + e.style),
            e.hoverCls && this.element.hover(function() {
                i.isEnabled() && t(this).addClass(e.hoverCls)
            }, function() {
                i.isEnabled() && t(this).removeClass(e.hoverCls)
            }),
                this.element.click(function(t) {
                    i.isEnabled() && FX.Utils.applyFunc(i, e.onClick, [t], !1)
                })
        },
        doResize: function(t) {
            FX.Button.superclass.doResize.apply(this, arguments);
            var e = this.options;
            FX.Utils.isEmpty(e.height) || this.element.css("line-height", e.height - 2 + "px")
        },
        setValue: function(t) {
            FX.Button.superclass.setValue.apply(this, arguments),
            FX.Utils.isNull(t) && (t = ""),
                this.$text.text(t)
        },
        setText: function(t) {
            FX.Button.superclass.setText.apply(this, arguments),
            FX.Utils.isNull(t) && (t = ""),
                this.$text.text(t)
        }
    }),
        t.shortcut("button", FX.Button)
}(jQuery),
jQuery,
FX.ExpansionButton = FX.extend(FX.Widget, {
    _defaultConfig: function() {
        return $.extend(FX.ExpansionButton.superclass._defaultConfig.apply(), {
            baseCls: "x-expand-button",
            cacheKey: "form-data-expansion",
            cacheEmbedKey: "form-embed-data-expansion",
            target: null,
            embed: !1
        })
    },
    _init: function() {
        FX.ExpansionButton.superclass._init.apply(this, arguments);
        var t = this;
        this.options;
        this.isExpand = !1,
            this.element.append($('<i class="icon-expansion">')).on("click", function() {
                t.doExpand(),
                t.widget && t.widget.doResize && t.widget.doResize(),
                    FX.Utils.dt(FX.CONST.TRACKER.FORM_DATA_EXPANSION)
            }),
        this._getCacheValue() && this.doExpand()
    },
    doExpand: function() {
        var t = this.options;
        this.isExpand = !this.isExpand,
            FX.Store.set(this._getCacheKey(), this.isExpand),
            this.isExpand ? $('<i class="icon-collapse"/>').appendTo(this.element.empty()) : $('<i class="icon-expansion">').appendTo(this.element.empty()),
        t.target && t.target.toggleClass("x-form-data-expand", this.isExpand)
    },
    _getCacheKey: function() {
        var t = this.options;
        return t.embed ? t.cacheEmbedKey : t.cacheKey
    },
    _getCacheValue: function() {
        var t = this.options
            , e = FX.Store.get(this._getCacheKey());
        return t.embed ? !!FX.Utils.isNull(e) || e : !!e
    },
    setWidget: function(t) {
        this.widget = t
    }
}),
function(i) {
    FX.Label = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return i.extend(FX.Label.superclass._defaultConfig.apply(), {
                baseCls: "x-label",
                text: "",
                onClick: null
            })
        },
        _init: function() {
            FX.Label.superclass._init.apply(this, arguments);
            var t = this
                , e = this.options;
            this.$label = i("<a/>").appendTo(this.element),
            e.onClick && this.$label.addClass("link").click(function() {
                FX.Utils.applyFunc(t, e.onClick, [t.$label], !1)
            })
        },
        setText: function(t) {
            t = FX.Utils.isNull(t) ? "" : t,
                this.$label.text(t)
        },
        setValue: function(t) {
            this.setText(t)
        }
    }),
        i.shortcut("label", FX.Label)
}(jQuery),
function(n) {
    FX.MultiTextEditor = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return n.extend(FX.MultiTextEditor.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_multi_text",
                value: [],
                waterMark: i18next.t("widget.multiText.placeholder"),
                width: 375,
                minWidth4TagInput: 90,
                allowMultiTag: !0,
                autoWrap: !1,
                onStopEdit: null
            })
        },
        _init: function() {
            var t = this.options;
            FX.MultiTextEditor.superclass._init.apply(this, arguments),
                this.valList = t.value,
                this.activeValIdx = -1,
                this._createContent(this.valList),
                this._bindEvent()
        },
        _createContent: function(t) {
            var e = this.options;
            this.element.empty().toggleClass("auto-wrap", e.autoWrap),
                this._createValList(t),
                this._createInput()
        },
        _createValList: function(t) {
            var a = this;
            this.$valWrapper = n('<div class="val-wrapper"/>').css({
                maxWidth: this._getMaxWidth4ValList()
            }).appendTo(this.element),
                this.$list = n('<div class="val-list"/>').appendTo(this.$valWrapper),
                FX.Utils.forEach(t, function(t, e) {
                    var i = a._createValTag(e).data("index", t).appendTo(a.$list);
                    t === a.activeValIdx && i.addClass("active")
                }),
            this._needAdjustListPos() && this._adjustListPos()
        },
        _getMaxWidth4ValList: function() {
            var t = this.options;
            return this._showTagInput() ? this.element.width() - t.minWidth4TagInput - 20 : this.element.width()
        },
        _showTagInput: function() {
            var t = this.options;
            return !(1 <= this.valList.length && !t.allowMultiTag)
        },
        _needAdjustListPos: function() {
            return !this.options.autoWrap
        },
        _adjustListPos: function() {
            var t, e = this.$list.width(), i = this.$valWrapper.width() - e, a = n(".active", this.$list);
            !a.length || (t = a.position().left) < -i && (i = -t),
                this.$list.css({
                    left: i
                })
        },
        _createValTag: function(t) {
            return n('<span class="val-tag"/>').text(t).attr("title", t)
        },
        _createInput: function() {
            var e = this
                , t = this.options;
            this.$input = n('<div class="text-input" contenteditable="true"/>').css({
                minWidth: t.minWidth4TagInput
            }).attr("data-watermark", t.waterMark).on({
                focus: function() {
                    e._deSelectValTag()
                },
                blur: function() {
                    var t = e.$input.text().trim();
                    setTimeout(function() {
                        e._addValTag(t)
                    }, 100)
                }
            }),
                t.autoWrap ? this.$input.appendTo(this.$list) : this.$input.appendTo(this.element),
            this._showTagInput() || this.$input.hide()
        },
        _bindEvent: function() {
            var a = this;
            this.element.attr("tabindex", -1),
                this.element.on({
                    keydown: function(t) {
                        switch (t.which || t.keyCode) {
                            case FX.CONST.KEY_CODE.ENTER:
                                t.stopEvent(),
                                    a.$input.blur();
                                break;
                            case FX.CONST.KEY_CODE.DELETE:
                            case FX.CONST.KEY_CODE.BACKSPACE:
                                a._removeValTag();
                                break;
                            case FX.CONST.KEY_CODE.LEFT:
                                a._focusValTag("left");
                                break;
                            case FX.CONST.KEY_CODE.RIGHT:
                                a._focusValTag("right")
                        }
                    },
                    mousedown: function(t) {
                        var e = n(t.target).closest(".val-tag");
                        a.isClickingTag = !!e.length
                    },
                    click: function(t) {
                        var e, i = n(t.target).closest(".val-tag");
                        i.length ? i.hasClass("active") ? a._deSelectValTag() : (e = i.data("index"),
                            a._focusValTag(e)) : a.$input.focus(),
                            t.stopEvent()
                    }
                }),
                n(document).off("click.deSelectTag"),
                n(document).on("click.deSelectTag", function(t) {
                    n(t.target).closest(".fui_multi_text").length || a._deSelectValTag()
                })
        },
        _deSelectValTag: function() {
            n(".active", this.$valWrapper).removeClass("active"),
                this.activeValIdx = -1
        },
        _focusValTag: function(t) {
            if (FX.Utils.isNumber(t))
                return this.activeValIdx = t,
                    void this.refresh();
            var e = this.$input.text().trim()
                , i = this.$input.is(":focus")
                , a = this.activeValIdx;
            if (!i || FX.Utils.isObjectEmpty(e)) {
                var n = !1;
                switch (t) {
                    case "left":
                        a < 0 ? this.activeValIdx = this.valList.length - 1 : 0 < a && --this.activeValIdx;
                        break;
                    case "right":
                        -1 < a && (this.valList.length === a + 1 ? this._showTagInput() && (this.activeValIdx = -1,
                            n = !0) : this.activeValIdx += 1)
                }
                a !== this.activeValIdx && this.refresh(n)
            }
        },
        _addValTag: function(t) {
            var e, i = this.options;
            FX.Utils.isEmpty(t) || (this.valList.push(t),
                e = !this.isClickingTag,
                this.refresh(e),
                FX.Utils.applyFunc(this, i.onStopEdit, [], null))
        },
        _removeValTag: function() {
            var t, e = this.options, i = this.$input.text().trim();
            FX.Utils.isEmpty(i) && (this.valList.splice(this.activeValIdx, 1),
                t = !1,
            this.activeValIdx >= this.valList.length && (this.activeValIdx = -1),
            this.activeValIdx < 0 && (t = !0),
                this.refresh(t),
                FX.Utils.applyFunc(this, e.onStopEdit, [], null))
        },
        getValue: function() {
            var a = [];
            return n(".val-tag", this.$list).each(function(t, e) {
                var i = n(e);
                a.push(i.text())
            }),
                a
        },
        setValue: function(t) {
            this.valList = FX.Utils.isObjectEmpty(t) ? [] : t,
                this.refresh()
        },
        getSelectValue: function() {
            return -1 < this.activeValIdx ? this.valList[this.activeValIdx] : null
        },
        refresh: function(t) {
            this._createContent(this.valList),
                this.element.focus(),
            t && this.$input.focus()
        }
    }),
        n.shortcut("multitext", FX.MultiTextEditor)
}(jQuery),
function(t) {
    FX.LimitText = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return t.extend(FX.LimitText.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_limit_text",
                height: 30,
                width: 240,
                waterMark: "",
                regex: "",
                flags: "g",
                maxLen: null,
                onFocus: null,
                onInput: null,
                onStopEdit: null
            })
        },
        _init: function() {
            FX.LimitText.superclass._init.apply(this, arguments);
            var e = this.options
                , i = this;
            this.$input = t('<input class="x-input"/>').on("focus", function() {
                this.value = i._getPrunedValue(this.value),
                    FX.Utils.applyFunc(i, e.onFocus, [this.value], !1)
            }).on("input", function() {
                var t = this.value;
                this.value = i._getPrunedValue(t),
                (!e.maxLen || t.length <= e.maxLen) && FX.Utils.applyFunc(i, e.onInput, [this.value], !1)
            }).on("blur", function() {
                this.value = i._getPrunedValue(this.value),
                    FX.Utils.applyFunc(i, e.onStopEdit, [this.value], !1)
            }).appendTo(this.element),
            e.waterMark && this.$input.attr("placeholder", e.waterMark)
        },
        _getPrunedValue: function(t) {
            var e = this.options
                , i = null;
            if (e.regex && FX.Utils.isString(e.regex) && (i = new RegExp("[^" + e.regex + "]",e.flags)),
            !FX.Utils.isString(t) || !i)
                return "";
            var a = t.replace(i, "");
            return e.maxLen && FX.Utils.isNumber(e.maxLen) && a.length > e.maxLen && (a = a.slice(0, e.maxLen)),
                a
        },
        focus: function() {
            this.$input && this.$input.focus()
        },
        setErrorState: function(t) {
            this.$input && this.$input.toggleClass("x-input-error", !!t)
        },
        setEnable: function(t) {
            FX.LimitText.superclass.setEnable.apply(this, arguments),
                t ? this.$input.removeAttr("readOnly") : this.$input.attr("readOnly", "readOnly")
        },
        setValue: function(t) {
            t = this._getPrunedValue(t),
                this.$input.val(t)
        },
        getValue: function() {
            return this.$input.val()
        }
    }),
        t.shortcut("limittext", FX.LimitText)
}(jQuery),
function(l) {
    FX.ComboTree = FX.extend(FX.Trigger, {
        _defaultConfig: function() {
            return l.extend(FX.ComboTree.superclass._defaultConfig.apply(), {
                baseCls: "fui_combotree",
                triggerIcon: "icon-caret-down",
                triggerList: "combotree-list",
                delimiter: ",",
                items: null,
                allowBlank: !0,
                searchable: !0,
                autoScrollToSelect: !1,
                onSetTriggerContent: null,
                onAfterNodeClick: null
            })
        },
        _init: function() {
            FX.ComboTree.superclass._init.apply(this, arguments),
                this.value = [],
                this.text = [],
            this.options.async || this._createTreeView()
        },
        _createEditComp: function() {
            return l('<div class="fui_combotree-trigger"/>').appendTo(this.element)
        },
        _onTriggerClick: function(t) {
            var i;
            this.isEnabled() && ((i = this)._showTriggerView(),
                l(document).bind("mousedown.treeview", function(t) {
                    var e = t.target;
                    0 === l(e).closest(i.triggerView).length && i._hideTriggerView()
                }))
        },
        _createTreeView: function() {
            var t, e, i, a, n = this.options, s = this;
            this.triggerView = l('<div class="x-dropdown"/>'),
            n.searchable && (t = l('<div class="fui_combo-search"/>').appendTo(this.triggerView),
                i = l("<input/>").bind("input propertychange", function() {
                    s.searchValue !== this.value && (s.treeView.empty(),
                        e = s._createLoadingIcon(i18next.t("searching")),
                        a())
                }).appendTo(t),
                a = FX.Utils.debounce(function() {
                    s.searchValue = i.val().trim(),
                        e.remove(),
                        s._createTreeList(s._getFilterItems())
                }, 500, s),
                t.append(l('<i class="icon-search search-icon"/>'))),
                this.treeView = l('<div class="x-dropdown-list"/>').addClass(n.triggerList).appendTo(this.triggerView),
                this._createTreeList(n.items)
        },
        _getFilterItems: function() {
            var t = this.options;
            if (!this.searchValue)
                return t.items;
            var i = this
                , a = [];
            return FX.Utils.forEach(t.items, function(t, e) {
                0 <= e.name.indexOf(i.searchValue) && a.push(e)
            }),
                a
        },
        _createTreeList: function(t) {
            var i = this.options
                , a = this;
            this.tree = new FX.Tree({
                renderEl: l("<div/>").appendTo(this.treeView),
                Nodes: t,
                setting: {
                    treeId: i.treeId,
                    data: {
                        simpleData: {
                            enable: !0
                        }
                    },
                    callback: {
                        onClick: function(t, e) {
                            e.isParent ? this.onSwitchNode(t, e) : (a._setValueByNode(e),
                                FX.Utils.applyFunc(a, i.onAfterNodeClick, [e], !1),
                                a._hideTriggerView())
                        }
                    }
                }
            })
        },
        _createLoadingIcon: function(t) {
            var e = this.treeView.children(".loading-text");
            return 0 === e.length && (e = l('<div class="loading-text"/>').appendTo(this.treeView),
                l("<span/>").text(t).appendTo(e)),
                e
        },
        _setValueByNode: function(t) {
            if (t) {
                this.value = [t.id],
                    this.text = [t.name];
                for (var e = t.getParentNode(); e; )
                    this.value.unshift(e.id),
                        this.text.unshift(e.name),
                        e = e.getParentNode()
            }
            this._setTriggerContent(this.text)
        },
        _hideTriggerView: function() {
            this.triggerView && (l(document).unbind("mousedown.treeview"),
                this.triggerView.detach())
        },
        _showTriggerView: function() {
            var t = this.options;
            null == this.triggerView && this._createTreeView(),
                this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
            this.options.searchable && this.triggerView.find("input").focus(),
            t.autoScrollToSelect && this._scrollSelectToView()
        },
        _scrollSelectToView: function() {
            var t, e = l(".curSelectedNode", this.treeView);
            !e.length || FX.Utils.isObjectEmpty(this.value) || (t = FX.Utils.getDomOffset(e, this.treeView)) && this.treeView.scrollTop(t.top)
        },
        _setTriggerContent: function(t) {
            var e, i;
            this.editComp && (e = this.options,
            !1 === FX.Utils.applyFunc(this, e.onSetTriggerContent, [this.editComp, t], !1) && (i = FX.Utils.isArray(t) ? t.join(e.delimiter) : "",
                this.editComp.text(i)))
        },
        checkValidate: function() {
            return !(!this.options.allowBlank && FX.Utils.isObjectEmpty(this.getValue()))
        },
        setValue: function(t) {
            var s = this
                , r = l.makeArray(t)
                , o = this.tree.getNodes();
            this.value = [],
                this.text = [],
                FX.Utils.forEach(r, function(i, a) {
                    var n = !1;
                    if (FX.Utils.forEach(o, function(t, e) {
                        if (e.id === a)
                            return s.value.push(e.id),
                                s.text.push(e.name),
                                n = !0,
                                o = e.children,
                                s.tree.expandNode(e, !0),
                            i === r.length - 1 && s.tree.selectNode(e),
                                !1
                    }),
                        !n)
                        return !1
                }),
                this._setTriggerContent(this.text)
        },
        getValue: function() {
            return this.value
        },
        getText: function() {
            return this.text
        }
    }),
        l.shortcut("combotree", FX.ComboTree)
}(jQuery),
function(c) {
    FX.Grid = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.Grid.superclass._defaultConfig.call(), {
                baseCls: "fui-grid",
                baseId: null,
                itemsPerPage: 15,
                items: [],
                columnsConfig: [],
                footAlign: "bottom",
                isHeadShow: !0,
                multiSelect: !1,
                intervalColor: !1,
                noWrap: !1,
                async: null,
                hasHoverCls: !0,
                hasPagination: !1,
                allowRowClick: !1,
                checkBoxColWidth: 25,
                onPageTurn: null,
                onAsyncSuccess: null,
                onAsyncError: null,
                onBeforeRowCreate: null,
                onAfterRowCreate: null,
                onBeforeHeadCreate: null,
                onAfterHeadCreate: null,
                onAfterRowCheck: null
            })
        },
        _init: function() {
            FX.Grid.superclass._init.apply(this, arguments);
            var t = this.options;
            t.baseId && this.element.attr("id", t.baseId),
            t.noWrap && this.element.addClass("cell-nowrap"),
            t.allowRowClick && this.element.addClass("row-click"),
            t.hasPagination && !this.page && (this.page = 0),
                this.refresh()
        },
        refresh: function(i) {
            var t, a = this, n = this.options;
            c.isArray(i) ? (n.items = i,
                this._createTable()) : n.async ? (t = n.async.data,
            n.hasPagination && (t = c.extend({}, t, {
                skip: this.page * n.itemsPerPage,
                limit: n.itemsPerPage
            })),
                FX.Utils.ajax({
                    url: n.async.url,
                    data: t
                }, function(t, e) {
                    FX.Utils.applyFunc(a, n.onAsyncSuccess, [t, e, i], !1),
                    n.hasPagination && (a.count = t.count),
                        a._createTable()
                }, function(t, e) {
                    FX.Utils.applyFunc(a, n.onAsyncError, [t, e, i], !1)
                })) : this._createTable()
        },
        _createTable: function() {
            var t = this.options;
            t.multiSelect && (this.allBoxes = []),
                this.element.empty(),
                this.$container = c('<div class="fui-grid-table"/>').appendTo(this.element),
                this.$table = c('<table cellPadding="0" cellSpacing="0"/>'),
                this._onCreateHead(),
                this._onCreateTable();
            var i = !0;
            FX.Utils.forEach(this.allBoxes, function(t, e) {
                if (!e.isSelected())
                    return i = !1
            }),
            this.$AllCheck && (this.$AllCheck.setValue(i),
            t.allowRowClick && i && this.$AllCheck.element.closest("tr").addClass("select")),
                this._bindEvts(),
            t.hasPagination && this._createPagination(),
                this.$container.append(this.$table)
        },
        _onCreateHead: function() {
            var a = this.options
                , t = this
                , e = a.isHeadShow;
            this.$head = c("<thead/>");
            var n = c("<tr/>").appendTo(this.$head);
            FX.Utils.applyFunc(this, a.onBeforeHeadCreate, [n], !1),
            a.multiSelect && (this.$AllCheck = new FX.CheckBox({
                width: a.checkBoxColWidth,
                onStateChange: function() {
                    i(this.isSelected())
                }
            }),
                c("<td/>").width(a.checkBoxColWidth).append(this.$AllCheck.element).appendTo(n),
            a.allowRowClick && n.on("click", function(t) {
                c(t.target).closest(".x-check").length || (n.toggleClass("select"),
                    i(n.hasClass("select")))
            })),
                FX.Utils.forEach(a.columnsConfig, function(t, e) {
                    var i = c("<td/>").width(e.width)
                        , a = FX.Utils.applyFunc(this, e.onHeadCellCreate, [t, e], !1);
                    !1 === a ? i.css("text-align", e.textAlign ? e.textAlign : "left").text(e.value ? e.value : e.key) : i.append(a),
                        i.appendTo(n)
                }),
                FX.Utils.applyFunc(this, a.onAfterHeadCreate, [n], !1),
            e && this.$table.append(this.$head);
            var i = function(i) {
                t.allBoxes && (FX.Utils.forEach(t.allBoxes, function(t, e) {
                    e.isEnabled() && (e.setValue(i),
                    a.allowRowClick && (i ? e.element.closest("tr").addClass("select") : e.element.closest("tr").removeClass("select")))
                }),
                    t.$AllCheck.setValue(i),
                a.allowRowClick && (i ? n.addClass("select") : n.removeClass("select")),
                    FX.Utils.applyFunc(t, a.onAfterRowCheck, [i], !1))
            }
        },
        _onCreateTable: function() {
            this.$tbody = c("<tbody/>");
            var a = this
                , t = this.options.items;
            FX.Utils.forEach(t, function(t, e) {
                var i = a.onCreateRow(t, e);
                a.$tbody.append(i)
            }),
                this.$table.append(this.$tbody)
        },
        _bindEvts: function() {
            function t(t) {
                var e, i = t.target, a = t.type, n = s._getTargetDom(i, "TR");
                n && (e = n.data("item"),
                    "mousedown" === a ? FX.Utils.applyFunc(s, r.onRowMouseDown, [n, e, t], !1) : "mouseover" === a ? (r.hasHoverCls && n.addClass("hover"),
                        FX.Utils.applyFunc(s, r.onRowMouseOver, [n, e, t], !1)) : "mouseout" === a ? (n.removeClass("hover"),
                        FX.Utils.applyFunc(s, r.onRowMouseOut, [n, e, t], !1)) : "mouseup" === a && FX.Utils.applyFunc(s, r.onRowClick, [n, e, t], !1))
            }
            var s = this
                , r = this.options;
            this.$tbody.unbind(),
                this.$tbody.bind("mousedown", t).bind("mouseover", t).bind("mouseup", t).bind("mouseout", t)
        },
        _getTargetDom: function(t, e) {
            for (; t && t.tagName; ) {
                if (t.tagName.toUpperCase() === e.toUpperCase())
                    return c(t);
                t = t.parentNode
            }
            return null
        },
        onCreateRow: function(i, a) {
            var e, n = this, s = this.options, r = c("<tr/>").on("click", function(t) {
                s.allowRowClick && s.multiSelect && !1 !== a.enable && (c(t.target).closest(".x-check").length || (r.toggleClass("select"),
                    o(r.hasClass("select"))))
            }).data("item", a);
            s.allowRowClick && s.multiSelect && !1 !== a.enable && a.selected && r.addClass("select"),
                FX.Utils.applyFunc(this, s.onBeforeRowCreate, [r, i, a], !1),
            s.multiSelect && (e = new FX.CheckBox({
                width: s.checkBoxColWidth,
                enable: !1 !== a.enable,
                gridRowData: a,
                onStateChange: function() {
                    o(this.isSelected())
                }
            }),
            a.selected && e.setSelected(a.selected),
                this.allBoxes.push(e),
                c("<td/>").append(e.element).appendTo(r),
            a.toolTip && new FX.Tooltip({
                renderEl: r,
                content: c('<div class="fui_grid_tool-tip"/>').html(a.toolTip),
                style: "",
                hasIcon: !1,
                anchor: c(".x-check > .icon-blank", r),
                mouseDelay: 0,
                tipWidth: 260,
                position: "leftTop"
            })),
                FX.Utils.forEach(s.columnsConfig, function(t, e) {
                    n.onCellCreate(i, t, a, e).appendTo(r)
                }),
            s.intervalColor && i % 2 == 0 && r.addClass("even"),
                FX.Utils.applyFunc(this, s.onAfterRowCreate, [r, i, a], !1);
            var o = function(t) {
                var i;
                n.$AllCheck && (e && e.setValue(t),
                    t ? (i = !0,
                        FX.Utils.forEach(n.allBoxes, function(t, e) {
                            if (!e.isSelected() && e.isEnabled())
                                return i = !1
                        }),
                        n.$AllCheck.setValue(i),
                    s.allowRowClick && n.$AllCheck.element.closest("tr").addClass("select")) : (n.$AllCheck.setValue(!1),
                    s.allowRowClick && n.$AllCheck.element.closest("tr").removeClass("select")),
                s.allowRowClick && (t ? r.addClass("select") : r.removeClass("select")),
                    FX.Utils.applyFunc(n, s.onAfterRowCheck, [t], !1))
            };
            return r
        },
        onCellCreate: function(t, e, i, a) {
            var n, s = c("<td/>"), r = this, o = this.options, l = FX.Utils.applyFunc(this, a.onCellCreate, [t, e, i, a], !1);
            return !1 === l ? (FX.Utils.isEmpty(a.value) || (n = FX.Utils.isEmpty(i[a.key]) ? "" : i[a.key],
                l = c('<div class="cell"/>').text(n).attr("title", n).appendTo(s)),
            o.noWrap && l.css({
                maxWidth: a.width
            })) : s.append(l),
                s.click(function() {
                    FX.Utils.applyFunc(r, a.onCellClick, [t, e, i, a, l], !1)
                }),
                FX.Utils.applyCss(l, a.css),
                s
        },
        getValue: function() {
            return this.options.items
        },
        addRowData: function(t) {
            var e;
            this.options.async || (e = this.onCreateRow(this.options.items.length, t),
                this.options.items.push(t),
                e.appendTo(this.$tbody))
        },
        getSelectedData: function() {
            var i = [];
            return this.allBoxes && FX.Utils.forEach(this.allBoxes, function(t, e) {
                e.isSelected() && i.push(e.options.gridRowData)
            }),
                i
        },
        hasMore: function() {
            var t = this.options;
            return (this.page + 1) * t.itemsPerPage < this.count
        },
        _createPagination: function() {
            var i = this
                , t = this.options;
            new FX.Pagination({
                renderEl: c("<div />").appendTo(this.element),
                count: this.count,
                limit: t.itemsPerPage,
                curPage: this.page + 1,
                onChangePage: function(t, e) {
                    i.page = t - 1,
                        i.rebuild()
                }
            })
        }
    }),
        c.shortcut("grid", FX.Grid)
}(jQuery),
function(r) {
    FX.SearchInput = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return r.extend(FX.SearchInput.superclass._defaultConfig.apply(), {
                isHighLight: !0,
                items: [],
                async: null,
                maxShow: 30,
                maxVisible: 8,
                keyName: "name",
                keyWord: "keyword",
                size: "normal",
                normalInputStyle: !1,
                placeholder: i18next.t("form.search.placeholder"),
                showSearchResult: !0,
                onBeforeCreate: null,
                onAfterCreate: null,
                onAfterItemCreate: null,
                onAsyncSuccess: null,
                onAsyncError: null,
                onItemClick: null,
                onFocus: null,
                onBlur: null,
                onClose: null,
                onReturn: null,
                onEmptyInput: null,
                onInputChange: null
            })
        },
        _init: function() {
            FX.SearchInput.superclass._init.apply(this, arguments),
                this.items = this.options.items,
                this._createInput(),
                this._bindEvent(),
                this.currentIndex = 0
        },
        _bindEvent: function() {
            var i = this.options
                , a = this;
            this.$inputSearch.on({
                focus: function(t) {
                    FX.Utils.applyFunc(a, i.onFocus, [t], !1)
                },
                blur: function(t) {
                    FX.Utils.applyFunc(a, i.onBlur, [t], !1)
                },
                keydown: function(t) {
                    var e;
                    t.keyCode === FX.Keys.ENTER ? (e = a._getCurrentItem()) && (FX.Utils.applyFunc(a, i.onReturn, [e], !1),
                        FX.Utils.applyFunc(a, i.onInputChange, [e.name], !1)) : t.keyCode === FX.Keys.DOWN ? a._dealDownKeyDown() : t.keyCode === FX.Keys.UP && a._dealUpKeyDown()
                },
                "input propertychange": FX.Utils.debounce(function() {
                    a._dealInputChange()
                }, 500, a)
            })
        },
        _dealDownKeyDown: function() {
            var t, e, i, a, n = r(".item-list", this.$inputBox);
            0 !== n.length && (t = this.options,
                e = n.children(".filter-item").height(),
                this.currentIndex === this.maxIndex ? (this.currentIndex = 0,
                    this._setScrollTop(n, 0)) : (this.currentIndex++,
                    this.currentIndex === this.maxIndex ? (i = this.currentIndex * e,
                        this._setScrollTop(n, i)) : (a = (this.currentIndex + 1 - t.maxVisible) * e) > n.scrollTop() && this._setScrollTop(n, a)),
                this._setCurrentItem())
        },
        _dealUpKeyDown: function() {
            var t, e, i, a = r(".item-list", this.$inputBox);
            0 !== a.length && (t = a.children(".filter-item").height(),
                0 === this.currentIndex ? (this.currentIndex = this.maxIndex,
                    e = this.currentIndex * t,
                    this._setScrollTop(a, e)) : (this.currentIndex--,
                (i = this.currentIndex * t) < a.scrollTop() && this._setScrollTop(a, i)),
                this._setCurrentItem())
        },
        _dealInputChange: function() {
            var t = this.options
                , e = this.$inputSearch.val().trim();
            this.currentIndex = 0,
                e ? (this.$closeIcon.show(),
                t.showSearchResult && (this._createSearchingPane(),
                    t.async ? this._initAsyncItems(e) : this._renderItemList(e)),
                    FX.Utils.applyFunc(this, t.onSearch, [e], !1)) : (this.$closeIcon.hide(),
                    this._removeItemList(),
                    FX.Utils.applyFunc(this, t.onEmptyInput, [], !1)),
                FX.Utils.applyFunc(this, t.onInputChange, [e], !1)
        },
        _setScrollTop: function(t, e) {
            t && t.scrollTop(e)
        },
        _initAsyncItems: function(i) {
            var a = this.options
                , n = this
                , t = a.async.data;
            t[a.keyWord] = i,
                FX.Utils.ajax({
                    url: a.async.url,
                    data: t
                }, function(t, e) {
                    FX.Utils.applyFunc(n, a.onAsyncSuccess, [t, e], !1),
                        n._renderItemList(i)
                }, function(t, e) {
                    FX.Utils.applyFunc(n, a.onAsyncError, [t, e], !1)
                })
        },
        _setCurrentItem: function() {
            var t = r(".item-list", this.$inputBox);
            0 !== t.length && t.children(".filter-item").eq(this.currentIndex).addClass("select").siblings().removeClass("select")
        },
        _getCurrentItem: function() {
            if (this.filterItems)
                return this.filterItems[this.currentIndex]
        },
        _createInput: function() {
            var t = this
                , e = this.options;
            FX.Utils.applyFunc(t, e.onBeforeCreate, [], !1),
                this.$inputBox = (e.normalInputStyle ? r('<div class="fui-search-input"/>') : r('<div class="fui-search-input"><i class="icon-search"></i></div>')).addClass("size-" + e.size).appendTo(this.element),
                this.$inputSearch = (e.normalInputStyle ? r('<input class="normal-style-input"/>') : r('<input class="search-source" placeholder="' + e.placeholder + '"/>')).appendTo(this.$inputBox),
                this.$closeIcon = r('<i class="icon-close-normal"></i>').appendTo(this.$inputBox).hide().on("click", function() {
                    t.$inputSearch.val(""),
                        t._dealInputChange(),
                        t.$closeIcon.hide(),
                        t._removeItemList(),
                        FX.Utils.applyFunc(t, e.onClose, [], !1)
                }),
                FX.Utils.applyFunc(t, e.onAfterCreate, [this.$inputBox], !1)
        },
        clearSearch: function() {
            this.$inputSearch.val(""),
                this.currentIndex = 0,
                this.$closeIcon.hide(),
                this._removeItemList()
        },
        _removeItemList: function() {
            r(".item-list", this.$inputBox).remove()
        },
        _renderItemList: function(t) {
            r(".item-list", this.$inputBox).empty();
            var a = this.options
                , n = this;
            this.filterItems = this._getFilterItems(t),
                this.maxIndex = 0 < this.filterItems.length ? this.filterItems.length - 1 : 0;
            var s = r(".item-list", this.$inputBox);
            s.unbind(),
                s.bind({
                    click: function(t) {
                        var e = r(t.target).closest(".filter-item");
                        0 < e.length && (FX.Utils.applyFunc(this, a.onInputChange, [e.data("item").name], !1),
                            FX.Utils.applyFunc(this, a.onItemClick, [e.data("item")], !1))
                    },
                    mouseover: function(t) {
                        var e = r(t.target).closest(".filter-item").data("index");
                        0 <= e && (n.currentIndex = e),
                            n._setCurrentItem()
                    }
                }),
                0 !== this.filterItems.length ? (FX.Utils.forEach(this.filterItems, function(t, e) {
                    var i = r('<li class="filter-item"/>').html(e.filterName).attr("title", e[a.keyName]).data({
                        item: e,
                        index: t
                    }).appendTo(s);
                    FX.Utils.applyFunc(n, a.onAfterItemCreate, [e, i], !1)
                }),
                    this._setCurrentItem(),
                this.overMax && r('<li class="empty-content"/>').text(i18next.t("search.max.show.tip", {
                    count: a.maxShow
                })).appendTo(s)) : r('<span class="empty-content"/>').text(i18next.t("template.not.found")).appendTo(s)
        },
        _createSearchingPane: function() {
            0 === r(".item-list", this.$inputBox).length ? r('<ul class="item-list"/>').appendTo(this.$inputBox) : r(".item-list", this.$inputBox).empty();
            var t = r(".item-list", this.$inputBox);
            r('<li class="empty-content searching-pane"/>').text(i18next.t("searching")).appendTo(t)
        },
        _getFilterItems: function(i) {
            var s = this.options
                , r = this
                , o = s.keyName
                , l = []
                , c = FX.Utils.escapeRegexp(i);
            return this.overMax = !1,
                FX.Utils.forEach(this.items, function(t, a) {
                    if (a[o] && new RegExp(c,"i").test(a[o])) {
                        if (r.overMax)
                            return !1;
                        var e, n;
                        a.filterName = FX.Utils.escapeHtmlSpecialChar(a[o]),
                        s.isHighLight && (e = a[o].split(new RegExp(c)),
                            n = FX.Utils.escapeHtmlSpecialChar(i),
                            a.filterName = "",
                            FX.Utils.forEach(e, function(t, e) {
                                var i = FX.Utils.escapeHtmlSpecialChar(e);
                                a.filterName += 0 === t ? i : '<span class="high-light">' + n + "</span>" + i
                            })),
                            l.push(a),
                        l.length >= s.maxShow && (r.overMax = !0)
                    }
                }),
                l
        },
        setInputFocus: function() {
            this.$inputSearch.focus()
        }
    }),
        r.shortcut("searchinput", FX.SearchInput)
}(jQuery),
function(l) {
    FX.PlainTable = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return l.extend(FX.PlainTable.superclass._defaultConfig.apply(), {
                baseCls: "fx_plain_table",
                tableHead: [],
                tableRowHead: [],
                tableData: [],
                cols: [],
                resizable: !1,
                isHeadSticky: !1,
                isRowHeadSticky: !1,
                onHeadCellClick: null,
                onRowClick: null,
                onOpBtnClick: null,
                onRowCreate: null,
                onMouseOverRow: null,
                onMouseOutRow: null,
                onCellClick: null,
                onColSizeChange: null,
                onCheckHover: null,
                rowHeight: 32
            })
        },
        _init: function() {
            FX.PlainTable.superclass._init.apply(this, arguments),
                this._createTable(),
                this._bindEvent()
        },
        _createTable: function() {
            var t, s = this, i = this.options;
            this.$tableScroller = l('<div class="table-scroller"/>').on("scroll", function() {
                s._scrollStickyHead()
            }).appendTo(this.element),
                this.$table = l('<table class="x-table x-table-bordered x-table-striped"/>').appendTo(this.$tableScroller),
            i.resizable && (this._initColSizeMap(),
                this._initColumnResizer(),
                this.element.addClass("resizable"),
                t = this._createColGroup(i.cols),
                this.tableWidth = t.data("totalWidth"),
                this.$table.append(this._createColGroup(i.cols)));
            var a = l('<thead class="t-head"/>').appendTo(this.$table);
            0 < i.tableHead.length && FX.Utils.forEach(i.tableHead, function(t, e) {
                var i = l('<tr class="t-row th-row"/>').appendTo(a);
                FX.Utils.forEach(e, function(t, e) {
                    s._createCell(e, {
                        tag: "th",
                        cls: "th-cell"
                    }).appendTo(i)
                })
            });
            var r = l('<tbody class="t-body" />').appendTo(this.$table);
            FX.Utils.forEach(i.tableData, function(a, t) {
                var e = a % 2 == 0 ? "odd" : "even"
                    , n = l('<tr class="t-row tb-row"/>').addClass(e).appendTo(r);
                FX.Utils.applyFunc(s, i.onRowCreate, [n, a], null),
                    FX.Utils.forEach(i.tableRowHead, function(t, e) {
                        var i = e[a];
                        i && s._createCell(i, {
                            tag: "th",
                            cls: "rh-cell"
                        }).appendTo(n)
                    }),
                    FX.Utils.forEach(t, function(t, e) {
                        e.row = a,
                            e.col = t,
                            s._createCell(e, {
                                tag: "td",
                                cls: "td-cell"
                            }).appendTo(n)
                    })
            }),
                this.$table.width(this._getTableWidth()),
                this._createStickyHead()
        },
        _getTableWidth: function() {
            if (this.tableWidth > this.$tableScroller.width())
                return this.tableWidth;
            var t = l(".width-ruler", this.$tableScroller);
            return t.length || (t = l('<div class="width-ruler"/>').appendTo(this.$tableScroller)),
                t.width()
        },
        _initColSizeMap: function() {
            var t = this.options
                , i = this.colSizeMap || {};
            FX.Utils.forEach(t.cols, function(t, e) {
                i[e.name] = i[e.name] || e.width
            }),
                this.colSizeMap = i
        },
        _initColumnResizer: function() {
            var s = this
                , i = this.options;
            this.$columnResizerLine || (this.$columnResizerLine = l('<div class="column-resizer-line"/>').appendTo(this.element)),
            this.$columnResizer || (this.$columnResizer = l('<div class="column-resizer"/>').appendTo(this.element)),
                this.element.off("mouseover.resize"),
                this.element.on("mouseover.resize", function(t) {
                    var e, i;
                    s.pressed || (e = l(t.target).closest(".th-cell")).length && e.data("field") && !e.hasClass("combined-col") && (i = (s.$currentTH = e).offset(),
                        s.$columnResizer.css({
                            left: i.left + e.outerWidth() - s.$columnResizer.outerWidth(),
                            top: i.top,
                            height: e.outerHeight()
                        }))
                }),
                this.element.off("mousedown.resize"),
                this.element.on("mousedown.resize", function(t) {
                    var e, i, a, n = l(t.target);
                    n.hasClass("column-resizer") && (s.element.addClass("unselectable"),
                        s.pressed = !0,
                        e = s.$currentTH,
                        i = n.offset(),
                        a = s.element.offset(),
                        s.$columnResizerLine.css({
                            left: i.left + 10,
                            top: a.top,
                            height: s.element.height()
                        }).addClass("active"),
                        s.startLeft = i.left,
                        s.currentField = e.data("field"),
                        s.startX = t.pageX,
                        s.startWidth = parseInt(e.outerWidth()),
                        t.preventDefault())
                }),
                this.element.off("mousemove.resize"),
                this.element.on("mousemove.resize", function(t) {
                    if (s.pressed) {
                        var e = Math.max(t.pageX, s.startLeft - s.startWidth + 45);
                        return s.$columnResizerLine.css({
                            left: e
                        }),
                            s.$columnResizer.css({
                                left: e - 5
                            }),
                            !1
                    }
                });
            function t(t) {
                var e;
                s.element.removeClass("unselectable"),
                    s.$columnResizerLine.removeClass("active"),
                s.pressed && (s.pressed = !1,
                    s.$columnResizerLine.removeClass("active"),
                s.$currentTH && s.currentField && (e = s.$currentTH.offset(),
                    s.tableWidth -= s.colSizeMap[s.currentField],
                    s.colSizeMap[s.currentField] = Math.max(s.startWidth + t.pageX - s.startX, 35),
                    s.$columnResizer.css({
                        left: e.left + s.$currentTH.outerWidth() - 10
                    }),
                    s.tableWidth += s.colSizeMap[s.currentField],
                    s.$table.width(s._getTableWidth()),
                    l('colgroup col[col="' + s.currentField + '"]', s.$table).width(s.colSizeMap[s.currentField]),
                    s.rebuildStickyHead(),
                    s._initColumnResizer(),
                    s.$table.scroll(),
                    FX.Utils.applyFunc(s, i.onColSizeChange, [s.currentField, s.colSizeMap[s.currentField]], !1),
                    s.currentField = null))
            }
            this.element.off("mouseup.resize"),
                this.element.on("mouseup.resize", t),
                this.element.off("mouseleave.resize"),
                this.element.on("mouseleave.resize", t)
        },
        _createColGroup: function(t) {
            var i = this
                , a = l("<colgroup />")
                , n = 0
                , s = 0;
            return FX.Utils.forEach(t, function(t, e) {
                n = i.colSizeMap[e.name],
                    l("<col />").attr("col", e.name).width(n).appendTo(a),
                    s += n
            }),
                a.data("totalWidth", s)
        },
        _createCell: function(t, e) {
            var i = e || {
                tag: "td"
            };
            i.cls && t.cls && (t.cls = i.cls + " " + t.cls);
            var a = l.extend(i, t.text || t.html || !FX.Utils.isString(t) ? t : {
                text: t
            })
                , n = l("<" + a.tag + ' class="t-cell"/>');
            switch (n.attr({
                row: a.row,
                col: a.col
            }),
                a.hasOwnProperty("html") ? n.html(a.html) : n.text(a.text),
                a.align) {
                case "center":
                    n.addClass("h-center");
                    break;
                case "right":
                    n.addClass("h-right")
            }
            return FX.Utils.forEach(a.data, function(t, e) {
                n.data(t, e)
            }),
            a.cls && n.addClass(a.cls),
            a.colspan && n.attr("colspan", a.colspan),
            a.rowspan && n.attr("rowspan", a.rowspan),
            a.width && n.width(a.width),
            a.height && n.height(a.height),
                n
        },
        _createStickyHead: function() {
            var a = this
                , t = this.options;
            !0 === t.isHeadSticky && (this.$stickyHead = l('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head").clone(!0)).outerWidth(this.$table.outerWidth()),
                l('<div class="table-sticky-head"/>').css({
                    width: this.$tableScroller[0].clientWidth
                }).append(this.$stickyHead).appendTo(this.element),
                this.$stickyHead.find(".t-head .th-cell").each(function(t, e) {
                    var i = a.$table.find(".t-head .th-cell").eq(t);
                    l(e).outerWidth(i.outerWidth())
                }),
            t.resizable && this.$stickyHead.prepend(this._createColGroup(t.cols)));
            var i, n = [];
            FX.Utils.forEach(t.cols, function(t, e) {
                e.isSticky && n.push(e)
            }),
            !0 === t.isRowHeadSticky && (this.$stickyRowHead = l('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$table.children(".t-head, .t-body").clone(!0)),
                l('<div class="table-sticky-row-head"/>').css({
                    height: this.$tableScroller[0].clientHeight
                }).append(this.$stickyRowHead).appendTo(this.element),
                this.$stickyRowHead.find(".t-head .th-cell").each(function(t, e) {
                    var i = a.$table.find(".t-head .th-cell").eq(t);
                    l(e).outerWidth(i.outerWidth()),
                        l(e).outerHeight(i.outerHeight())
                }),
                this.$stickyRowHead.find(".t-body .rh-cell").each(function(t, e) {
                    var i = a.$table.find(".t-body .rh-cell").eq(t);
                    l(e).outerWidth(i.outerWidth()),
                        l(e).outerHeight(i.outerHeight())
                }),
                this.$stickyRowHead.children(".t-head").children("tr.t-row").each(function(t, e) {
                    l(e).children(".th-cell").not(".group-head").remove()
                }),
                this.$stickyRowHead.find(".t-body .td-cell").remove(),
            t.resizable && (this.$stickyRowHead.prepend(this._createColGroup(n)),
                i = 0,
                FX.Utils.forEach(t.cols, function(t, e) {
                    e.isSticky && (i += a.colSizeMap[e.name])
                }),
                this.$stickyRowHead.width(i))),
            !0 === t.isHeadSticky && !0 === t.isRowHeadSticky && (this.$stickyIntersect = l('<table cellpadding="0" cellspacing="0" class="x-table x-table-bordered x-table-striped"/>').append(this.$stickyRowHead.children(".t-head").clone(!0)).width(this.$stickyRowHead.width()),
                this.$stickyIntersect.prepend(this._createColGroup(n)),
                l('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.element))
        },
        reload: function(t) {
            l.extend(this.options, t),
                this.element.empty(),
            this.options.resizable && (this.$columnResizerLine = null,
                this.$columnResizer = null),
                this._createTable()
        },
        doResize: function(t) {
            FX.PlainTable.superclass.doResize.apply(this, arguments),
                this.$table.width(this._getTableWidth()),
                this.rebuildStickyHead(),
                this._scrollStickyHead()
        },
        _scrollStickyHead: function() {
            var t = this.$tableScroller.scrollTop()
                , e = this.$tableScroller.scrollLeft();
            this.$stickyHead && this.$stickyHead.css({
                "margin-left": -e
            }),
            this.$stickyRowHead && this.$stickyRowHead.css({
                "margin-top": -t
            })
        },
        _bindEvent: function() {
            var r = this
                , o = this.options;
            this.element.off("click"),
                this.element.on("click", function(t) {
                    var e = l(t.target)
                        , i = e.closest(".th-cell");
                    0 < i.length && FX.Utils.applyFunc(r, o.onHeadCellClick, [i], null);
                    var a = e.closest(".t-cell");
                    0 < a.length && FX.Utils.applyFunc(r, o.onCellClick, [a], null);
                    var n, s = e.closest(".table-op-btn");
                    if (0 < s.length)
                        return "check" !== s.data("op") || s.hasClass("x-ui-disable") ? (FX.Utils.applyFunc(r, o.onOpBtnClick, [s], null),
                            !1) : (s.toggleClass("select"),
                            void (s.hasClass("check-all") && r.$stickyRowHead.find(".x-check:not(.x-ui-disable) ").toggleClass("select", s.hasClass("select"))));
                    e.closest("a[href]").length || 0 < (n = e.closest(".tb-row")).length && FX.Utils.applyFunc(r, o.onRowClick, [n], null)
                }),
                this.element.off("mouseover.event"),
                this.element.on("mouseover.event", function(t) {
                    var e = l(t.target).closest(".tb-row");
                    0 < e.length && FX.Utils.applyFunc(r, o.onMouseOverRow, [e], null)
                }),
                this.element.off("mouseout.event"),
                this.element.on("mouseout.event", function(t) {
                    var e = l(t.target).closest(".tb-row");
                    0 < e.length && FX.Utils.applyFunc(r, o.onMouseOutRow, [e], null)
                }),
                this.element.off("mouseenter.event"),
                this.element.on("mouseenter.event", ".table-op-btn", function(t) {
                    var e = FX.Utils.applyFunc(r, o.onCheckHover, [], null)
                        , i = l(t.currentTarget);
                    "check" === i.data("op") && i.hasClass("x-ui-disable") && FX.UI.showPopover({
                        position: "topLeft",
                        anchor: i,
                        content: l("<span/>").text(e || i18next.t("data.delete.noAuth.tip"))
                    })
                }),
                this.element.off("mouseleave.event"),
                this.element.on("mouseleave.event", ".table-op-btn", function(t) {
                    var e = l(t.currentTarget);
                    "check" === e.data("op") && e.hasClass("x-ui-disable") && FX.UI.closePopover()
                }),
                this.element.off("wheel.event"),
                this.element.on("wheel.event", ".table-sticky-row-head", function(t) {
                    var e = t.originalEvent
                        , i = r.$tableScroller.scrollTop()
                        , a = e.deltaY;
                    1 === e.deltaMode && (a *= o.rowHeight),
                        r.$tableScroller.scrollTop(i + a),
                        t.preventDefault()
                })
        },
        getCheckResult: function() {
            if (!this.$stickyRowHead)
                return [];
            var i = [];
            return this.$stickyRowHead.find(".t-body .x-check").each(function(t, e) {
                l(e).hasClass("select") && i.push(l(e).closest(".table-op-btn-cell").data("dataId"))
            }),
                i
        },
        rebuildStickyHead: function() {
            this.element.find(".table-sticky-head, .table-sticky-row-head, .table-sticky-intersect").remove(),
                this._createStickyHead()
        },
        getScroller: function() {
            return this.$tableScroller
        }
    })
}(jQuery),
function(i) {
    FX.Dialog = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return i.extend(FX.Dialog.superclass._defaultConfig.apply(), {
                renderEl: i("<div/>").appendTo("body"),
                baseCls: "x-dialog",
                title: "",
                subTitle: "",
                animation: 300,
                hasPadding: !1,
                style4Header: null,
                hasCloseBtn: !0,
                contentWidget: {},
                autoClose: !1,
                hideHeader: !1,
                onContentCreate: null,
                onBeforeClose: null,
                onClose: null
            })
        },
        _init: function() {
            FX.Dialog.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.$mask = i('<div class="x-window-mask light modal fadeout scrollable"/>').css({
                "z-index": FX.STATIC.zIndex++
            }).appendTo("body"),
                this.element.appendTo(this.$mask),
            t.autoClose && this.$mask.click(function(t) {
                i(t.target).hasClass("x-window-mask") && e._doClose()
            }),
            t.hideHeader || this._createHeader(),
                this.$content = i('<div class="dialog-body"/>').appendTo(this.element),
            t.hasPadding && this.$content.addClass("has-padding"),
                this._createContent(this.$content)
        },
        _createHeader: function() {
            var t = this.options
                , e = this;
            this.$header ? this.$header.empty() : this.$header = i('<div class="dialog-header"/>').appendTo(this.element),
                this.$header.append(i('<span class="title"/>').text(t.title)),
            t.subTitle && (this.$header.addClass("has-subtitle"),
                this.$header.append(i('<span class="subtitle"/>').append(t.subTitle))),
            t.style4Header && this.$header.addClass(t.style4Header),
            t.hasCloseBtn && i('<i class="icon-close-normal"/>').click(function() {
                e._doClose()
            }).appendTo(this.$header)
        },
        _createContent: function(t) {
            var e = this.options;
            !1 === FX.Utils.applyFunc(this, e.onContentCreate, [t], !1) && (this.container = FX.createWidget(i.extend({
                type: "tablecontainer",
                renderEl: i("<div/>").appendTo(t)
            }, e.contentWidget)))
        },
        _doClose: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onBeforeClose, [], !0) && this.close()
        },
        getWidgetByName: function(t) {
            return this.container ? this.container.getWidgetByName(t) : null
        },
        show: function() {
            var t = this;
            setTimeout(function() {
                t.$mask.addClass("fadein").removeClass("fadeout")
            }, 0)
        },
        close: function() {
            var t = this.options
                , e = this;
            this.$mask.addClass("fadeout").removeClass("fadein"),
                setTimeout(function() {
                    e.element.remove(),
                        e.$mask.remove(),
                        FX.Utils.applyFunc(e, t.onClose, [], !1)
                }, t.animation)
        },
        rebuildContent: function(t) {
            this.options = i.extend(this.options, t),
                this.$content.empty(),
                this._createContent(this.$content),
                this.doResize()
        },
        rebuildHeader: function(t) {
            this.options = i.extend(this.options, t),
                this._createHeader()
        }
    }),
        i.shortcut("dialog", FX.Dialog)
}(jQuery),
function(s) {
    FX.ConfirmDialog = FX.extend(FX.Dialog, {
        _defaultConfig: function() {
            return s.extend(FX.ConfirmDialog.superclass._defaultConfig.apply(), {
                text4Ok: i18next.t("ok"),
                text4Cancel: i18next.t("cancel"),
                hasSeparator: !1,
                onOk: null,
                onCancel: null,
                hasPadding: !0,
                onCreateFooterLeft: null
            })
        },
        _init: function() {
            FX.ConfirmDialog.superclass._init.apply(this, arguments),
                this.$content.addClass("has-footer"),
                this._createFooter().appendTo(this.element)
        },
        _createButtonGroup: function() {
            var t = this
                , e = this.options
                , i = s('<div class="dialog-btn-row"/>')
                , a = s('<div class="dialog-btn ok-btn"/>')
                , n = s('<div class="dialog-btn cancel-btn"/>');
            return e.text4Cancel && (this.btnCancel = new FX.Button({
                renderEl: n.appendTo(i),
                widgetName: "confirmBtnCancel",
                text: e.text4Cancel,
                style: "white",
                height: 32,
                onClick: function() {
                    t._handleCancel()
                }
            })),
            e.text4Ok && (this.btnOk = new FX.Button({
                renderEl: a.appendTo(i),
                widgetName: "confirmBtnOK",
                text: e.text4Ok,
                style: "green",
                height: 32,
                onClick: function() {
                    t._handleOk()
                }
            })),
                i
        },
        _createFooter: function() {
            var t = this.options
                , e = s('<div class="dialog-footer"/>');
            t.hasSeparator && e.addClass("has-top-border"),
                this._createButtonGroup().appendTo(e);
            var i = s('<div class="footer-left"/>').appendTo(e);
            return FX.Utils.applyFunc(this, t.onCreateFooterLeft, [i], !1),
                e
        },
        _handleOk: function() {
            var t = this.options;
            !1 === FX.Utils.applyFunc(this, t.onOk, [], !1) && this.close()
        },
        _handleCancel: function() {
            var t = this.options;
            !1 === FX.Utils.applyFunc(this, t.onCancel, [], !1) && this.close()
        },
        getOkBtn: function() {
            return this.btnOk
        },
        rebuildContent: function(t) {
            FX.ConfirmDialog.superclass.rebuildContent.apply(this, arguments),
                s(".dialog-footer", this.element).remove(),
                this._createFooter().appendTo(this.element)
        }
    }),
        s.shortcut("confirmdialog", FX.ConfirmDialog)
}(jQuery),
function(m) {
    FX.Form = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return m.extend(FX.Form.superclass._defaultConfig.apply(), {
                baseCls: "fui-form",
                API: FX.API,
                title: "",
                appId: null,
                entryId: null,
                formId: null,
                dataId: null,
                onAfterItemCreate: null,
                onSuccess: null,
                onAfterCancel: null,
                onAfterClose: null,
                onFlowDone: null,
                onGetScrollContainer: null,
                isPublicData: !1,
                layout: "normal",
                mode: "new",
                submitRule: FX.InvisibleSubmitRules.KEEP,
                width: 780,
                extParam: null,
                submitUrl: FX.Utils.getApi(FX.API.data.create),
                submitData: {},
                submitText: null,
                validators: null,
                ignoreOptAuth: !1,
                isLaunchFlow: !1,
                ignoreValidate: !1,
                widgetOptAuth: null,
                copyValue: null,
                editValue: null,
                buttonPosition: "left",
                hasFooter: !0,
                hasHeader: !0,
                hasFlowHeader: !0,
                onCreateMoreBtn: null,
                flow: null,
                authGroupId: null,
                cacheEnable: !1,
                updateTime: null,
                formEvents: [],
                multiTabs: [],
                linkDataId: null,
                linkDataFields: [],
                multiTabScrollElement: null,
                hasLastContent: !1,
                isCopyMode: !1,
                embed: !1
            })
        },
        _init: function() {
            FX.Form.superclass._init.apply(this, arguments),
                this._initMain();
            var t = this.options;
            this._hasMultiTab() && FX.Utils.fixFormMultiTab(t.multiTabScrollElement || this.$wrapper, m(".multi-tab-pane", this.$wrapper))
        },
        _initMain: function() {
            var a = this
                , t = this.options;
            t.hasHeader && (this.$header ? this.$header.children("span").text(t.title) : this.$header = m('<div class="header"/>').append(m('<span class="header-title"/>').text(t.title)).appendTo(this.element),
            t.flow && t.hasFlowHeader && this._initFlowHeader(),
                new FX.ExpansionButton({
                    renderEl: m("<div/>").appendTo(this.$header),
                    target: this.element,
                    embed: t.embed
                }).setWidget(this),
            t.onAfterCancel && m('<i class="icon-close-normal form-exit-icon">').click(function() {
                a.doCancel()
            }).appendTo(this.$header)),
                this.$wrapper = m('<div class="widget-wrapper">').appendTo(this.element);
            var i, e, n = m("<ul/>").appendTo(this.$wrapper), s = "normal-layout";
            "grid-2" === t.layout && (s = "grid-layout"),
                this.element.addClass(s),
                this.rely = new FX.RelyProcessor(t.items),
                this.formEvent = new FX.FormEvent({
                    events: t.formEvents,
                    API: t.API,
                    appId: t.appId,
                    entryId: t.entryId,
                    formId: t.formId || t.entryId,
                    dataId: t.dataId
                }),
                this.formula = new FX.FormulaCalcParser({
                    RecnoLock: this._isPreviewMode(),
                    EntryRecNo: null,
                    API: t.API.formula,
                    APPID: t.appId,
                    ENTRYID: t.entryId,
                    DATAID: t.dataId
                }),
                this.association = new FX.AssociationProcessor(t.items),
                this.widgetsMap = {},
            t.items && (t.resultWidgets = {},
                t.widgetOptAuth = t.widgetOptAuth || {},
                i = this._hasMultiTab(),
                FX.Utils.forEach(t.items, function(t, e) {
                    i && e.tab || a._createItem(e).appendTo(n)
                }),
            i && (e = this._getTabItems(),
                this.multiTab = new FX.FormMultiTab({
                    renderEl: m('<div class="multi-tab-pane has-padding"/>').appendTo(this.$wrapper),
                    items: e,
                    tabs: FX.FormUtils.getNoEmptyTabs(e, t.multiTabs),
                    viewWidth: t.width - 60,
                    onCreateTabItem: function(t) {
                        var e = a._createItem(t);
                        return e.data("tabName", t.tab),
                            e
                    },
                    onTabClick: function() {
                        FX.Utils.multiTabScrollTop(a.$wrapper, t.multiTabScrollElement || a.$wrapper)
                    }
                }))),
                FX.Utils.forEach(this.association.getVisibleMap(), function(t, e) {
                    a._setWidgetVisible(t, e)
                }),
            this.multiTab && a._refreshMultiTab(),
                this._initFooter(),
                this._isEditMode() ? (FX.Utils.forEach(t.editValue, function(t, e) {
                    var i = a.getWidgetByName(t);
                    i && (i.setValue(e),
                    i.effectItemLinkWidgets && i.effectItemLinkWidgets())
                }),
                    this._setLinkQuery()) : (this.loadFormData(),
                t.cacheEnable && this.needCache || this.rely.fireDefaultRely(this, this.rely.getDefaultRely()),
                    this._setLinkQuery(),
                    this._setLinkData()),
            t.copyValue && (t.ignoreOptAuth ? FX.Utils.dt(FX.CONST.TRACKER.DATA_COPY_ADMIN) : FX.Utils.isEmpty(t.authGroupId) || t.authGroupId === FX.CONST.AUTH_GROUP.SUBMIT ? FX.Utils.dt(FX.CONST.TRACKER.DATA_COPY_SUBMIT) : FX.Utils.dt(FX.CONST.TRACKER.DATA_COPY_VIEW))
        },
        _hasMultiTab: function() {
            var t = this.options;
            if (FX.Utils.isObjectEmpty(t.multiTabs))
                return !1;
            var e = this._getTabItems();
            return !FX.Utils.isObjectEmpty(e)
        },
        _refreshMultiTab: function() {
            var t, e, i, a;
            this.multiTab && (t = this.options,
                e = FX.FormUtils.getNoEmptyTabs(this._getTabItems(), t.multiTabs),
                i = [],
                FX.Utils.forEach(e, function(t, e) {
                    i.push(e.name)
                }),
                a = this.multiTab.getActiveTabName(),
            i.indexOf(a) < 0 && this.multiTab.setActiveTabName(i[0]),
                this.multiTab.refreshWithConfig({
                    tabs: e
                }))
        },
        _getTabItems: function() {
            var t = this.options
                , s = this
                , r = [];
            return FX.Utils.forEach(t.items, function(t, e) {
                var i, a, n;
                e.tab && (a = !0,
                    n = (i = m.extend({}, e.widget, s._getWidgetOptAuth(e))).widgetName,
                (!i.visible || s.widgetVisibleMap && !1 === s.widgetVisibleMap[n]) && (a = !1),
                    a ? r.push(e) : r.push(m.extend({}, e, {
                        hidden: !0
                    })))
            }),
                r
        },
        _initFooter: function() {
            var t, e, i, a, n, s, r, o, l, c, d, u, h = this, p = this.options;
            p.hasFooter && (this.$footer = m('<div class="footer"/>').appendTo(this.element),
                t = p.flow && p.flow.comment,
                i = (e = p.flow && p.flow.signature) && e.enable,
                a = t && t.enable,
                n = t && t.required,
            (a || i) && (this.$footer.addClass("comment-footer"),
                s = m('<div class="comment-pane"><span>' + i18next.t("form.comment") + "</span></div>").appendTo(this.$footer),
                r = "",
                a ? n ? r = "*" : i && (r = i18next.t("form.comment.signature.notNull")) : i && (r = "*"),
            FX.Utils.isEmpty(r) || s.append(m('<span class="label-notnull"/>').text(r)),
                o = m('<div class="comment-content"/>').appendTo(s),
            a && (this.flowComment = new FX.TextArea({
                renderEl: m('<div class="content-item"/>').appendTo(o),
                allowBlank: !n,
                width: i ? 585 : "100%",
                height: 65,
                onStopEdit: function() {
                    p.submitData.comment = this.getValue()
                }
            })),
            i && (this.flowSignature = new FX.Signature({
                renderEl: m('<div class="content-item"/>').appendTo(o),
                allowBlank: !1,
                allowSign: FX.Vip.hasSignature(),
                height4SignatureBtn: 65,
                onStopEdit: function() {
                    p.submitData.signature = this.getValue(),
                        this.element.removeClass("invalid")
                },
                onValidateFail: function() {
                    this.element.addClass("invalid")
                },
                onGetAjaxData: function() {
                    return {
                        appId: p.appId,
                        entryId: p.entryId,
                        dataId: p.dataId
                    }
                }
            }))),
                l = m('<div class="btn-pane"/>').addClass(p.buttonPosition).appendTo(this.$footer),
            "new" === p.mode && !p.ignoreOptAuth && p.hasLastContent && (c = FX.Utils.getSaveContentCheckKey(p.appId, p.entryId),
                this.$footer.addClass("has-save-content"),
                d = void 0 === FX.Store.get(c) || FX.Store.get(c),
                u = new FX.CheckBox({
                    renderEl: m('<div class="last-content-check"/>').addClass(p.buttonPosition).appendTo(this.$footer),
                    text: i18next.t("form.submit.lastContent"),
                    value: d,
                    onStateChange: function() {
                        var t = this.getValue();
                        h.hasContentCheck = t,
                            FX.Store.set(c, t)
                    }
                }),
                this.hasContentCheck = u.getValue()),
                p.flow ? new FX.FlowBtn({
                    renderEl: l,
                    flow: p.flow,
                    appId: p.appId,
                    entryId: p.entryId,
                    submitEnable: !(this._isNewMode() && FX.Vip.isDataCreateLimit()),
                    onSubmit: function(t, e, i) {
                        "print" === t && (h.needPrint = !0,
                            t = "forward"),
                            p.submitData.flowAction = t,
                            m.extend(p.submitData, i),
                            e ? h.doVerifyAndSubmit() : h._checkFlowComment(function() {
                                h.doSubmit()
                            })
                    },
                    onCancel: function() {
                        h.doCancel()
                    },
                    onPrint: p.onPrint
                }) : (p.submitText && new FX.Button({
                    renderEl: m('<div class="ok-btn"/>').appendTo(l),
                    text: p.submitText,
                    width: 120,
                    enable: !(this._isNewMode() && FX.Vip.isDataCreateLimit()),
                    style: "green",
                    onClick: function() {
                        h.doVerifyAndSubmit()
                    }
                }),
                p.cancelText && new FX.Button({
                    renderEl: m('<div class="cancel-btn"/>').appendTo(l),
                    text: p.cancelText,
                    width: 120,
                    style: "white",
                    onClick: function() {
                        h.doCancel()
                    }
                }),
                p.submitText && !p.cancelText && l.addClass("single"),
                    FX.Utils.applyFunc(this, p.onCreateMoreBtn, [l], !1)))
        },
        _initFlowHeader: function() {
            var e = this.options
                , i = this;
            FX.Utils.isArray(e.flow.flowNodes) && (this.flowMenu ? this.flowMenu.refresh({
                currentMenuId: e.submitData.flowId,
                items: e.flow.flowNodes
            }) : (this.$menu = m("<div/>").appendTo(this.$header.empty()),
                this.flowMenu = new FX.FlowNodes({
                    renderEl: this.$menu,
                    customCls: "form-flow-menu",
                    title: e.title,
                    items: e.flow.flowNodes,
                    currentMenuId: e.submitData.flowId,
                    menuKey: "flowId",
                    onMenuClick: function(t) {
                        FX.Utils.applyFunc(i, e.onFlowNodeClick, [e.entryId, e.dataId, t], !1)
                    }
                }))),
                this._createFlowInfo()
        },
        _createFlowInfo: function() {
            var t = this.options;
            this.element.addClass("has-log"),
                new FX.FormDataFLowInfoPane({
                    renderEl: m('<div class="log-wrapper"/>').appendTo(this.element),
                    flowStateContainer: this.element,
                    API: t.API,
                    appId: t.appId,
                    flow: t.flow,
                    data: t.data,
                    dataId: t.dataId,
                    entryId: t.entryId,
                    authGroupId: t.authGroupId,
                    hasLog: t.flow.hasLogView,
                    hasDataComment: t.comment && t.comment.enable,
                    hasFlowComment: !0
                })
        },
        _isEditMode: function() {
            return "edit" === this.options.mode
        },
        _isPreviewMode: function() {
            return "preview" === this.options.mode
        },
        _isNewMode: function() {
            return "new" === this.options.mode
        },
        _setWidgetVisible: function(t, e) {
            var i, a, n = this.getWidgetByName(t);
            n && (this.widgetVisibleMap || (this.widgetVisibleMap = {}),
                i = n.isVisible(),
                a = n.element.closest(".widget-view"),
                i && e ? (this.widgetVisibleMap[t] = !0,
                    a.removeClass("x-ui-hidden")) : (this.widgetVisibleMap[t] = !1,
                    a.addClass("x-ui-hidden")))
        },
        _dealWidgetAssociation: function(t, e) {
            var i = this
                , a = this.association.dealAssociation(t, e);
            FX.Utils.forEach(a, function(t, e) {
                i._setWidgetVisible(t, e)
            }),
            this.multiTab && this._refreshMultiTab()
        },
        _isWidgetVisible: function(t) {
            return !(!t || !t.isVisible()) && !(this.widgetVisibleMap && !1 === this.widgetVisibleMap[t.getWidgetName()])
        },
        _getWidgetOptAuth: function(i) {
            var t = this.options
                , a = this
                , e = {};
            switch (t.mode) {
                case "new":
                    t.ignoreOptAuth && (e = {
                        ignoreOptAuth: !0,
                        visible: !0,
                        enable: !0
                    });
                    break;
                case "edit":
                    t.ignoreOptAuth ? e = {
                        ignoreOptAuth: !0,
                        visible: !0,
                        enable: !0
                    } : !t.flow && FX.Utils.isNull(t.authGroupId) && !t.isPublicData || ("subform" === i.widget.type && FX.Utils.forEach(i.widget.items, function(t, e) {
                        m.extend(e.widget, a._getWidgetOptAuth({
                            widget: {
                                widgetName: [i.widget.widgetName, e.widget.widgetName].join(".")
                            }
                        }))
                    }),
                        e = t.widgetOptAuth[i.widget.widgetName] || {
                            visible: !1,
                            enable: !1
                        })
            }
            return e
        },
        _createItem: function(t) {
            var e, i = this.options, a = this, n = m('<li class="widget-view"/>'), s = {
                renderEl: n,
                API: i.API,
                appId: i.appId,
                entryId: i.entryId,
                formId: i.formId,
                dataId: i.dataId,
                description: t.description,
                label: t.label,
                mode: i.mode,
                widget: m.extend(FX.FormUtils.getWidgetDefaultConfig(t.widget.type), t.widget, this._getWidgetOptAuth(t)),
                layout: this._doLayoutResize({
                    type: t.widget.type
                }, t.lineWidth),
                ignoreValidate: i.ignoreValidate,
                onAssociate: function(t, e) {
                    a._dealWidgetAssociation(t, e)
                },
                onAddSubWidget: function(t) {
                    a._addLinkQuery(t),
                        a._addLinkData(t)
                },
                onCalFormula: function(t) {
                    return a._calFormula(t, {})
                },
                onGetFilter: function() {
                    return a._iterAddFilter(this)
                },
                onGetLinkFilter: function(t, e) {
                    var i = FX.Utils.getSubformRowIdx(this);
                    return a._getLinkFilter(t, e, i).filterArray
                },
                onGetLinkValue: function(t) {
                    var e = a.getWidgetByName(t);
                    if (e)
                        return e.getLinkValue()
                },
                onRowEdit: function(t) {
                    if (t = t || a.element,
                        i.height) {
                        var e = m('<div class="editor-container"/>').appendTo(t);
                        return i.hasHeader && e.css({
                            top: a.$header.outerHeight()
                        }),
                            e
                    }
                    return !1
                },
                onStopEdit: function() {
                    a._fireWidgetRelyEvent(this, null),
                        a.needCache = !0
                },
                onValueChange: function() {
                    a.needCache = !0
                },
                onStateChange: function() {
                    a._updateVerifyState(this)
                },
                onRowChange: function(t, e) {
                    a.rely.fireDefaultRely(a, t, e)
                }
            }, r = this._dealCopyValueAuth(s), o = new FX.FormItem(s);
            return o.supportLayout() && (e = t.lineWidth || FX.CONST.FIELD_LINE_WIDTH,
                n.addClass("x-grid-col-" + e)),
                this._addLinkQuery(o),
                this._addLinkData(o),
                !1 !== r ? ("subform" === o.getWidgetType() && (o.options.onAddSubWidget = function(t) {
                        a._addLinkQuery(t),
                            a._addLinkData(t),
                        t.isVisible() && t.isEnable() && a.rely.addDefaultRely(t, !0)
                    }
                ),
                "phone" === o.getWidgetType() && null != r && (r.verified = !1),
                -1 === FX.LimitFields.unCopy.indexOf(o.getWidgetType()) && o.setValue(r),
                    o.effectItemLinkWidgets(),
                    this.rely.addDefaultRely(o, !0)) : this.rely.addDefaultRely(o),
                i.resultWidgets[o.getWidgetName()] = o,
                n
        },
        _dealCopyValueAuth: function(t) {
            var s = this.options;
            if (!s.copyValue)
                return !1;
            var e = t.widget;
            if (FX.Utils.isValueWidget(e.type) && (e.ignoreOptAuth || e.visible && e.enable)) {
                if (!s.isCopyMode && -1 < FX.LimitFields.noCache.indexOf(e.type))
                    return !1;
                if ("subform" !== e.type || s.ignoreOptAuth)
                    return s.copyValue[e.widgetName];
                var i = [];
                return FX.Utils.forEach(s.copyValue[e.widgetName], function(t, a) {
                    var n = {};
                    FX.Utils.forEach(e.items, function(t, e) {
                        var i;
                        !s.isCopyMode && -1 < FX.LimitFields.noCache.indexOf(e.widget.type) || (i = e.widget.widgetName,
                        e.widget.visible && e.widget.enable && (n[i] = a[i]))
                    }),
                        i.push(n)
                }),
                    i
            }
            return !1
        },
        _doLayoutResize: function(t, e) {
            var i = this.options;
            return "grid-2" === i.layout && e === FX.CONST.FIELD_LINE_WIDTH ? FX.Utils.setLayoutSize(t, "full-line", t.type) : FX.Utils.setLayoutSize(t, i.layout, t.type),
                t
        },
        _fireWidgetRelyEvent: function(t, e) {
            e ? FX.Utils.applyFunc(this, t.options.onRelyDone, [t], !1) : this._fireFormEvent(t),
                this.rely.fireRely(t, e, this)
        },
        _fireFormEvent: function(t) {
            var n = this;
            this.formEvent.triggerEvent(t.getWidgetName(), function(t) {
                var a = {};
                return FX.Utils.forEach(t, function(t, e) {
                    var i = n.getWidgetByName(e);
                    i && (a[e] = i.getValue())
                }),
                    a
            }, function(t) {
                var a = [];
                FX.Utils.forEach(t, function(t, e) {
                    var i = n.getWidgetByName(t);
                    i && (i.setValue(e),
                        a.push(i))
                }),
                    n.rely.fireDefaultRely(n, a)
            })
        },
        _iterAddFilter: function(r, o) {
            var l = this;
            if (r) {
                var c = r.getRely();
                if (c) {
                    o = o || {};
                    var t = r.getWidgetName();
                    if (r.isSubformWidget() && (t = [r.getSubformName(), t].join(".")),
                        !o[t]) {
                        o[t] = !0;
                        var d = [];
                        return c.data && c.ref && FX.Utils.forEach(c.widgets, function(t, e) {
                            if (o[e])
                                return !1;
                            var i = -1;
                            l._isSubformWidget(e) && r.isSubformWidget() && (i = FX.Utils.getSubformRowIdx(r));
                            var a = l.getWidgetByName(e, i);
                            if (!a)
                                return !1;
                            var n = a.getLinkValue()
                                , s = l._createDataFilter(a, n, c.ref.field);
                            return s.entryId = c.ref.formId,
                                d.push(s),
                                d = d.concat(l._iterAddFilter(a, o) || []),
                                !1
                        }),
                            d
                    }
                }
            }
        },
        _createDataFilter: function(t, e, i) {
            var a, n, s = {};
            return t && (n = e,
            "datetime" === t.getLinkType() && (n = [a = FX.Utils.date2Str(new Date(e), t.getFormat() || "yyyy-MM-dd HH:mm:ss"), a]),
            -1 < ["address", "location"].indexOf(t.getLinkType()) && (n = [e.province, e.city, e.district]),
                s = FX.Utils.getLinkFilter({
                    type: t.getLinkType(),
                    name: i
                }, n)),
                s
        },
        getLinkValue: function(t) {
            var e;
            switch (t.getWidgetType()) {
                case "user":
                case "usergroup":
                    e = t.getCacheValue();
                    break;
                default:
                    e = t.getLinkValue()
            }
            return e
        },
        dealRely: function(t, i, e, a) {
            i.options.label;
            var n, s, r, o, l, c = this, d = this.options, u = null, h = i.getRely();
            if (i.isSubformWidget() && (u = FX.Utils.getSubformRowIdx(i)),
            d.copyValue && e === this.rely.DEFAULT_RELY_VERSION && i.isVisible() && i.isEnable())
                return this._fireWidgetRelyEvent(i, e);
            if (h.formula && (n = h.formula.formula,
                (s = {})[t] = a,
                FX.Utils.forEach(h.widgets, function(t, e) {
                    var i, a = c.getWidgetByName(e, u);
                    FX.Utils.isArray(a) ? (i = [],
                        FX.Utils.forEach(a, function(t, e) {
                            i.push(c.getLinkValue(e))
                        }),
                        s[e] = i) : a && (s[e] = c.getLinkValue(a))
                }),
                r = null,
                o = c._calFormula(n, s, function(t) {
                    var e;
                    t === FX.CONST.FORMULA_ERROR.MAPX && (e = i.getWidgetName(),
                    i.options.subform && (e = i.getSubFullName()),
                        c.rely.setErrorMap(!1, e, t),
                        r = t)
                }),
                i.setValue(o),
            r || (l = i.getWidgetName(),
            i.options.subform && (l = i.getSubFullName()),
                c.rely.setErrorMap(!0, l),
                c._fireWidgetRelyEvent(i, e))),
            h.ref && h.data) {
                var p = FX.Utils.pick(h.data, ["field", "formId", "refAppId"]);
                switch (i.getWidgetType()) {
                    case "combo":
                    case "combocheck":
                        i.rebuild(),
                            c._fireWidgetRelyEvent(i, e);
                        break;
                    case "dept":
                    case "deptgroup":
                        i.getValueOption() === FX.WidgetValueOption.CUSTOM ? (i.clearLimit(),
                            c._fireWidgetRelyEvent(i, e)) : c._dealValueDataLink(p, i, e);
                        break;
                    default:
                        c._dealValueDataLink(p, i, e)
                }
            }
            c._getLinkQueryData(i)
        },
        _dealValueDataLink: function(a, n, i) {
            var s = this
                , t = this.options
                , e = this._iterAddFilter(n)
                , r = !0;
            if (FX.Utils.forEach(e, function(t, e) {
                if (e.entryId === a.formId) {
                    if (FX.Utils.isObjectEmpty(e.value))
                        return r = !1;
                    var i = !0;
                    return FX.Utils.forEach(e.value, function(t, e) {
                        if (!FX.Utils.isEmpty(e))
                            return i = !1
                    }),
                        i ? r = !1 : void 0
                }
            }),
                !r)
                return n.setValue(null),
                    void this._fireWidgetRelyEvent(n, i);
            m.extend(a, {
                appId: t.appId,
                entryId: t.entryId,
                dataId: t.dataId,
                filter: {
                    cond: e,
                    rel: FX.CONST.FILTER_RELATION.AND
                }
            }),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(t.API.data.link),
                    data: a
                }, function(t) {
                    var e;
                    s.rely.checkAsyncVersion(n, i) ? (e = s._dealSubformDataLink(n, t.value),
                        n.setValue(e),
                        s._fireWidgetRelyEvent(n, i)) : s.rely.releaseAsyncQue(n)
                }, function(t) {
                    var e = t.responseJSON;
                    if (e && e.code)
                        switch (e.code) {
                            case 3e3:
                            case 2010:
                                var i = "field.config.msg.fail";
                                "subform" === n.options.widget.type && (i = "field.config.msg.fail.in");
                                var a = n.getWidgetName();
                                n.options.subform && (a = n.getSubFullName()),
                                    s.rely.setErrorMap(!1, a, e.code),
                                    FX.Msg.toast({
                                        msg: i18next.t(i, {
                                            name: FX.Utils.limitText(n.options.label, 12)
                                        }),
                                        type: "warning"
                                    })
                        }
                })
        },
        _dealSubformDataLink: function(t, e) {
            var n, i = t.getRely(), a = t.getWidgetType(), s = e;
            return "subform" === a && i && (s = [],
                n = {},
                FX.Utils.forEach(i.subLink, function(t, e) {
                    n[e.link] ? n[e.link].push(e.rely) : n[e.link] = [e.rely]
                }),
                FX.Utils.forEach(e, function(t, e) {
                    var a = {};
                    FX.Utils.forEach(e, function(t, i) {
                        n[t] && FX.Utils.forEach(n[t], function(t, e) {
                            a[e] = i
                        })
                    }),
                        s.push(a)
                })),
                s
        },
        _addLinkQuery: function(t) {
            t && "linkquery" === t.getWidgetType() && (this.linkQueryWidgets || (this.linkQueryWidgets = []),
                this.linkQueryWidgets.push(t))
        },
        _setLinkQuery: function() {
            var i = this;
            FX.Utils.forEach(this.linkQueryWidgets, function(t, e) {
                i._getLinkQueryData(e)
            })
        },
        _addLinkData: function(t) {
            var e, i = this.options;
            i.linkDataId && t && "linkdata" === t.getWidgetType() && (this.linkDataWidgets || (this.linkDataWidgets = []),
                e = t.getWidgetName(),
            t.isSubformWidget() && (e = [t.getSubformName(), e].join(FX.CONST.FIELD.SUBFORM_DELIMITER)),
            -1 < i.linkDataFields.indexOf(e) && this.linkDataWidgets.push(t))
        },
        _setLinkData: function() {
            var r = this
                , o = this.options;
            o.linkDataId && FX.Utils.forEach(this.linkDataWidgets, function(t, e) {
                var i, a, n = FX.Utils.getSubformRowIdx(e), s = e.getLinkForm();
                s && (i = e.getLinkFilter(),
                ((a = r._getLinkFilter(i, s, n)).validate || FX.Utils.isObjectEmpty(i)) && (e.setLinkDataId(o.linkDataId),
                    e.reload({
                        cond: a.filterArray,
                        rel: FX.CONST.FILTER_RELATION.AND
                    })))
            })
        },
        _getLinkQueryData: function(t) {
            var e, i, a, n;
            "linkquery" === t.getWidgetType() && (e = t.getWidgetName(),
                i = null,
            t.isSubformWidget() && (e = [t.getSubformName(), e].join("."),
                i = FX.Utils.getSubformRowIdx(t)),
                this.rely.setStateMap(e, this.rely.RELY_END),
                this.rely.setAsyncMap(e, this.rely.RELY_END),
            (a = t.getLinkForm()) && ((n = this._getLinkFilter(t.getLinkFilter(), a, i)).validate ? t.reload({
                cond: n.filterArray,
                rel: FX.CONST.FILTER_RELATION.AND
            }) : t.clearValue()))
        },
        _getLinkFilter: function(t, s, r) {
            var o = this.options
                , l = this
                , c = []
                , d = !FX.Utils.isObjectEmpty(t);
            return FX.Utils.forEach(t, function(t, e) {
                var i = {};
                switch (e.type) {
                    case "fixed":
                        i = {
                            type: e.fixed.type,
                            value: [e.fixed.value]
                        },
                            m.extend(i, FX.Utils.dealFilterFieldName({
                                name: e.link
                            }));
                        break;
                    case "self":
                        if (!o.dataId)
                            return d = !1;
                        i = {
                            type: "linkdata",
                            keyType: "id",
                            value: [o.dataId]
                        },
                            m.extend(i, FX.Utils.dealFilterFieldName({
                                name: e.link
                            }));
                        break;
                    case "widget":
                    default:
                        var a = l.getWidgetByName(e.rely, r);
                        if (!a || !a.getLinkValue)
                            return d = !1;
                        var n = a.getLinkValue();
                        if (FX.Utils.isObjectEmpty(n))
                            return d = !1;
                        i = l._createDataFilter(a, n, e.link),
                        "linkdata" === e.linkType && (i.keyType = i.type,
                            i.type = e.linkType,
                        "datetime" === i.keyType && 1 < i.value.length && (i.value = [i.value[0]]))
                }
                e.method && (i.method = e.method),
                    i.entryId = s,
                    c.push(i)
            }),
                {
                    filterArray: c,
                    validate: d
                }
        },
        _isSubformWidget: function(t) {
            return -1 < t.indexOf(".")
        },
        _jsonValue2String: function(t) {
            var i = this;
            if (m.isPlainObject(t))
                return JSON.stringify(t);
            if (FX.Utils.isArray(t)) {
                var a = [];
                return FX.Utils.forEach(t, function(t, e) {
                    a.push(i._jsonValue2String(e))
                }),
                    a
            }
            return t
        },
        _calFormula: function(t, l, e) {
            var i, c = this, a = (this.options,
                t.split(/(\$[0-9a-zA-Z\._#@]+)/g)), d = [];
            FX.Utils.forEach(a, function(t, e) {
                var i, a, n, s, r, o;
                FX.Utils.startWith(e, "$_widget_") || FX.Utils.startWith(e, "$ext") ? (a = (i = e.replace("$", "").split("#"))[0],
                    n = i[1],
                    FX.Utils.isEmpty(n) ? (l ? s = l[a] : (r = c.getWidgetByName(a),
                        FX.Utils.isArray(r) ? (s = [],
                            FX.Utils.forEach(r, function(t, e) {
                                s.push(e.getLinkValue())
                            })) : r && (s = r.getLinkValue())),
                        s = c._jsonValue2String(s),
                        o = (o = (o = JSON.stringify(s) + "").replace(/\\\\(?=.+)/g, '"+CHAR(92)+"')).replace(/\\\"(?=.+)/g, '"+CHAR(34)+"'),
                    !isNaN(s) && s < 0 && (o = "(" + o + ")"),
                        d.push(o)) : d.push('"' + e + '"')) : d.push(e)
            });
            try {
                i = this.formula.parse(d.join(""))
            } catch (t) {
                i = "",
                e && e(t)
            }
            return i
        },
        getWidgetByName: function(t, e) {
            var i, a, n = this.options;
            return FX.Utils.isEmpty(t) || !n.resultWidgets ? null : (this._isSubformWidget(t) ? (a = n.resultWidgets[[t.split(".")[0]]]) && (i = a.getWidgetByName(t.split(".")[1], e)) : i = n.resultWidgets[t],
                i)
        },
        doSubmit: function() {
            var t, i, h, p = this, f = this.options, e = this.rely.getErrorMap();
            if (e) {
                var a = null
                    , n = null;
                if (FX.Utils.forEach(e, function(t, e) {
                    if (!0 !== e)
                        return a = e,
                            n = p.getWidgetByName(t),
                        Array.isArray(n) && (n = n[0]),
                            !1
                }),
                a === FX.CONST.FORMULA_ERROR.MAPX)
                    return void FX.Msg.alert({
                        type: "warning",
                        title: i18next.t("mapx.fail.alert"),
                        msg: i18next.t("mapx.fail.alert.description"),
                        text4Ok: "",
                        text4Cancel: i18next.t("iSee")
                    });
                if ((3e3 === a || 2010 === a) && n)
                    return void FX.Msg.alert({
                        type: "warning",
                        title: i18next.t("field.config.msg.fail.title"),
                        msg: i18next.t("field.config.msg.fail", {
                            name: FX.Utils.limitText(n.options.label, 12)
                        }),
                        text4Ok: "",
                        text4Cancel: i18next.t("iSee")
                    })
            }
            this.rely.checkAsyncState(this) ? this.formEvent.checkAsyncState() ? this.formEvent.checkError() ? this.ajaxLoading || (this.ajaxLoading = !0,
                t = FX.Utils.createMask(this.element, {
                    hasLoader: !0,
                    isLight: !0
                }),
                i = m.extend({
                    values: this.getValue()
                }, f.submitData),
                m.extend(i, {
                    appId: f.appId,
                    entryId: f.entryId,
                    formId: f.formId || f.entryId,
                    dataId: f.dataId,
                    hasResult: !0
                }),
            FX.Utils.isNull(f.authGroupId) || m.extend(i, {
                authGroupId: f.authGroupId
            }),
            f.extParam && m.extend(i.values, {
                ext: {
                    data: f.extParam,
                    widgetType: "text"
                }
            }),
                h = p.needCache,
                p.needCache = !1,
                FX.Utils.dataAjax({
                    url: f.submitUrl,
                    data: i
                }, function(t, e) {
                    !1 === FX.Utils.applyFunc(p, f.onSuccess, [t, i.flowAction, p.needPrint], !1) && FX.Msg.toast({
                        type: "success",
                        msg: i18next.t("submit.success")
                    }),
                    t.flowFailureCode && p._showFlowFailHint(t.flowFailureCode)
                }, function(t, e) {
                    p.needCache = h;
                    var r, o, l, i = t.responseJSON || {}, c = FX.Utils.getErrMsg(i) || i18next.t("form.submit.fail");
                    switch (i.code) {
                        case 4002:
                            i.meta && (r = {},
                                o = null,
                                l = i18next.t("field.noRepeat.exist"),
                                FX.Utils.forEach(i.meta.repeatFields, function(t, e) {
                                    var i, a, n, s;
                                    p._isSubformWidget(t) ? (i = t.split(".")) && (a = i[0],
                                        n = i[1],
                                        r[a] = r[a] || {},
                                        r[a][n] = e,
                                    o || (o = p.getWidgetByName(a),
                                        c = p.getWidgetByName(t)[0].getRepeatRemind() || l)) : (s = p.getWidgetByName(t)) && (s.setInvalidateType(FX.CONST.INVALID_TYPE.REPEAT),
                                        p.setErrorState(s, i18next.t("field.noRepeat.exist")),
                                    o || (c = (o = s).getRepeatRemind() || l))
                                }),
                                FX.Utils.forEach(r, function(t, e) {
                                    var i = p.getWidgetByName(t);
                                    i && (i.clearErrorState(),
                                        i.setInvalidateType(FX.CONST.INVALID_TYPE.REPEAT),
                                        p.setErrorState(i, l, e))
                                }),
                            o && p.scrollInvalidWidgetToView(o),
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: c
                                }));
                            break;
                        case 9907:
                        case 1024:
                            var a, n, s = "", d = "", u = "";
                            u = 9907 === i.code ? (s = FX.Utils.getErrMsg(i),
                                d = i18next.t("widget.phone.sms.error"),
                                FX.CONST.INVALID_TYPE.PHONE_TIMEOUT) : (a = p.getWidgetByName(i.meta.widgetId).options.label,
                                s = i18next.t("item.correct.toast", {
                                    name: a
                                }),
                                d = FX.Utils.getErrMsg(i),
                                FX.CONST.INVALID_TYPE.PHONE_REGEX),
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: s
                                }),
                            i.meta && i.meta.widgetId && ((n = p.getWidgetByName(i.meta.widgetId)) && (n.setInvalidateType(u),
                                p.setErrorState(n, d),
                                p.scrollInvalidWidgetToView(n)));
                            break;
                        case 4402:
                            FX.Msg.toast({
                                type: "warning",
                                msg: i.msg
                            });
                            break;
                        case 4008:
                        case 4009:
                            FX.Utils.applyFunc(p, f.onFlowDone, [], null);
                            break;
                        case 4214:
                            FX.Msg.toast({
                                type: "warning",
                                msg: i18next.t("submit.timeout")
                            });
                            break;
                        default:
                            FX.Msg.toast({
                                type: "warning",
                                msg: c
                            })
                    }
                }, function() {
                    t.remove(),
                        p.ajaxLoading = !1
                })) : FX.Msg.alert({
                type: "warning",
                title: i18next.t("form.submit.eventError"),
                msg: i18next.t("form.submit.eventError.desc"),
                text4Cancel: i18next.t("iSee"),
                text4Ok: null
            }) : FX.Msg.alert({
                type: "warning",
                title: i18next.t("form.submit.eventAsync"),
                msg: i18next.t("form.submit.eventAsync.desc"),
                text4Cancel: i18next.t("iSee"),
                text4Ok: null
            }) : FX.Msg.alert({
                type: "warning",
                title: i18next.t("form.submit.async"),
                msg: i18next.t("form.submit.async.desc"),
                text4Cancel: i18next.t("iSee"),
                text4Ok: null
            })
        },
        doVerify: function() {
            var i = this
                , t = this.options
                , a = {
                result: !0,
                uploading: !1
            };
            if (t.ignoreValidate)
                return a;
            var e = t.resultWidgets
                , n = null;
            for (var s in e) {
                var r = e[s];
                if (this._isWidgetVisible(r) && (this.clearErrorState(r),
                    !r.checkValidate())) {
                    if (r.getInvalidateType() === FX.CONST.INVALID_TYPE.FILE_UPLOADING)
                        return a.uploading = !0,
                            this.scrollInvalidWidgetToView(r),
                            a;
                    a.result = !1,
                        this.setErrorState(r),
                    n || (a.errMsg = this.getErrorMsg(r),
                        n = r)
                }
            }
            return a.result && FX.Utils.forEach(t.validators, function(t, e) {
                if (!i._calFormula(e.formula))
                    return a.result = !1,
                        a.errMsg = e.remind,
                        !1
            }),
            !a.result && n && this.scrollInvalidWidgetToView(n),
                a
        },
        _checkFlowComment: function(t) {
            var e, i, a, n, s = this.options;
            this.flowComment || this.flowSignature ? "save" === s.submitData.flowAction ? (e = this.flowComment && this.flowComment.getValue()) ? FX.Msg.alert({
                title: i18next.t("form.comment.save"),
                msg: i18next.t("form.comment.save.desc"),
                type: "warning",
                text4Ok: i18next.t("form.comment.copy"),
                onOk: function() {
                    FX.Utils.copyToClipboard(e, function() {
                        FX.Msg.toast({
                            type: "success",
                            msg: i18next.t("form.comment.copied")
                        })
                    }),
                    t && t()
                }
            }) : t && t() : (i = !this.flowComment || this.flowComment.checkValidate(),
                a = !this.flowSignature || this.flowSignature.checkValidate(),
                i && a ? t && t() : (n = i ? i18next.t("form.comment.notNull.signature") : i18next.t("form.comment.notNull.text"),
                i || a || (n = i18next.t("form.comment.notNull")),
                    FX.Msg.toast({
                        type: "warning",
                        msg: n
                    }))) : t && t()
        },
        setErrorState: function(t, e, i) {
            t.setErrorState(e, i)
        },
        getErrorMsg: function(t) {
            return t.getErrorMsg()
        },
        clearErrorState: function(t) {
            t.clearErrorState()
        },
        hasErrorState: function(t) {
            return t.element.hasClass("error")
        },
        _updateVerifyState: function(t) {
            if (t && (t.isSubformWidget() && (t = this.getWidgetByName(t.getSubformName())),
            this._isWidgetVisible(t) && t.getInvalidateType() !== FX.CONST.INVALID_TYPE.REPEAT)) {
                if (!this.hasErrorState(t))
                    switch (t.getWidgetType()) {
                        case "address":
                        case "radiogroup":
                        case "combo":
                        case "phone":
                        case "subform":
                            return
                    }
                t.checkValidate() ? this.clearErrorState(t) : this.setErrorState(t)
            }
        },
        scrollInvalidWidgetToView: function(t) {
            var e, i, a, n, s = this.options, r = FX.Utils.applyFunc(this, s.onGetScrollContainer, [], !1) || this.$wrapper;
            t && r && ((i = (e = t.element).data("tabName")) && this.multiTab && (this.multiTab.setActiveTabName(i),
                this.multiTab.rebuildTabList()),
                a = e.outerHeight(),
                n = .5 * r.outerHeight() - .5 * a - FX.Utils.getDomOffset(e, r).top,
                r[0].scrollTop -= n,
            "subform" === t.getWidgetType() && t.scrollInvalidWidgetToView())
        },
        getFormDataKey: function() {
            var t = this.options;
            return FX.Store.getKey("formData", {
                appId: t.appId,
                entryId: t.entryId
            })
        },
        removeFormData: function() {
            this.options.cacheEnable && FX.Store.remove(this.getFormDataKey())
        },
        loadFormData: function() {
            var a, t = this.options;
            t.cacheEnable && (this._bindCacheEvent(),
            (a = FX.Store.get(this.getFormDataKey())) && a.time >= t.updateTime && a.data && (FX.Utils.forEach(t.resultWidgets, function(t, e) {
                var i = a.data[t];
                !e || -1 < FX.LimitFields.noCache.indexOf(e.getWidgetType()) || (e.setCacheValue(i),
                e.effectItemLinkWidgets && e.effectItemLinkWidgets())
            }),
                this._setLinkQuery(),
                this.needCache = !0),
                this.removeFormData())
        },
        saveFormData: function() {
            var a, t, n, e = this.options;
            e.cacheEnable && m("body").find(this.element).length && this.needCache && this.rely.checkAsyncState(this) && (a = {},
                t = e.resultWidgets,
                n = !0,
                FX.Utils.forEach(t, function(t, e) {
                    if (e && FX.Utils.allowValueSubmit(e.getWidgetType()) && !(-1 < FX.LimitFields.noCache.indexOf(e.getWidgetType()))) {
                        if (FX.Utils.isExternalLink() && -1 < FX.LimitFields.userDept.indexOf(e.getWidgetType()))
                            return n = !1;
                        var i = e.getCacheValue();
                        FX.Utils.isObjectEmpty(i) || (a[t] = i)
                    }
                }),
            FX.Utils.isObjectEmpty(a) || n && (FX.CorpUser.isUserExist() && FX.Store.forEach(function(t) {
                /formData[0-9a-f]{72}/.test(t) && !new RegExp(FX.CorpUser.getUserId()).test(t) && FX.Store.remove(t)
            }),
                FX.Store.set(this.getFormDataKey(), {
                    data: a,
                    time: e.updateTime
                }, 1)))
        },
        _bindCacheEvent: function() {
            var t = this;
            this.options.cacheEnable && (FX.FORMCACHE = this,
                m(window).one("unload", function() {
                    t.saveFormData()
                }))
        },
        doCancel: function() {
            var t = this.options;
            this.saveFormData(),
                FX.Utils.applyFunc(this, t.onAfterCancel, [], !1)
        },
        doClose: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onAfterClose, [], !1)
        },
        doVerifyAndSubmit: function() {
            var t = this
                , e = this.doVerify();
            e.result ? e.uploading ? FX.Msg.alert({
                type: "warning",
                title: i18next.t("widget.file.uploading.wait.until"),
                msg: i18next.t("widget.file.uploading.wait.detail"),
                text4Cancel: i18next.t("iSee"),
                text4Ok: null
            }) : this._checkFlowComment(function() {
                t.doSubmit()
            }) : FX.Msg.toast({
                type: "warning",
                msg: e.errMsg ? e.errMsg : i18next.t("form.submit.invalid")
            })
        },
        getValue: function() {
            var t = {}
                , e = this.options.resultWidgets;
            for (var i in e) {
                var a, n = e[i];
                n && FX.Utils.allowValueSubmit(n.getWidgetType()) && (a = n.getValue(),
                    t[i] = {
                        data: a,
                        visible: this._isWidgetVisible(n)
                    })
            }
            return t
        },
        doResize: function(t) {
            FX.Form.superclass.doResize.apply(this, arguments);
            var e = this.options;
            e.height && (this.element.addClass("form-modal"),
            e.hasHeader && this.$wrapper.css({
                top: this.$header.outerHeight()
            }),
            e.hasFooter && this.$wrapper.css({
                bottom: this.$footer.outerHeight()
            }),
            this.multiTab && this.multiTab.rebuildTabList())
        },
        reload: function(t) {
            this.options = m.extend(this.options, t),
                m(".widget-wrapper", this.element).remove(),
                m(".footer", this.element).remove(),
                this._initMain(),
                this.doResize()
        },
        _showFlowFailHint: function(t) {
            var e, i, a;
            FX.Utils.isExternalLink() || (i = e = "",
                t === (a = FX.CONST.FLOW_FAIL_CODE).FORWARD_CHARGER ? (e = i18next.t("form.submit.fail.charger"),
                    i = i18next.t("form.submit.fail.charger.desc")) : t === a.FORWARD_COND ? (e = i18next.t("form.submit.fail.cond"),
                    i = i18next.t("form.submit.fail.cond.desc")) : t === a.BACK && (e = i18next.t("form.submit.fail.back"),
                    i = i18next.t("form.submit.fail.charger.desc")),
            e && i && FX.Msg.alert({
                title: e,
                msg: i,
                text4Ok: i18next.t("iSee"),
                text4Cancel: null
            }))
        },
        setMultiTabColor: function(t) {
            this.multiTab && this.multiTab.setActiveTabColor(t)
        }
    }),
        m.shortcut("form", FX.Form)
}(jQuery),
function(o) {
    FX.DataMenu = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.DataMenu.superclass._defaultConfig.apply(), {
                baseCls: "fui-form-data-menu",
                data: null,
                dataCount: 10,
                dataIndex: 1,
                entryId: null,
                isPublicData: !1,
                publicDataUrlPrefix: "",
                canConfigPublicData: !1,
                hasShareBtn: !1,
                hasShowFieldsBtn: !1,
                allFields: null,
                showFields: null,
                formConfigManager: null,
                hasCopyBtn: !1,
                hasDeleteBtn: !1,
                hasEditBtn: !1,
                hasPrintBtn: !1,
                hasRecoverBtn: !1,
                hasSwitchBtn: !1,
                hasTransferBtn: !1,
                hasActivateBtn: !1,
                hasCloseBtn: !1,
                onCopyData: null,
                onDeleteData: null,
                onEditData: null,
                onPrint: null,
                onRecoverData: null,
                onSwitchData: null,
                onShowFieldsChange: null,
                title: ""
            })
        },
        _init: function() {
            FX.DataMenu.superclass._init.apply(this, arguments);
            var t = this.options;
            t.formConfigManager && (this.formConfig = t.formConfigManager.getConfig()),
                this._createEditPane()
        },
        _createEditPane: function() {
            var n = this
                , s = this.options;
            this.$editPane = o('<div class="edit-pane"/>').appendTo(this.element),
            s.hasShowFieldsBtn && (this.fieldItems = this._getFieldItems(),
                o('<a class="show-fields-btn"/>').append('<i class="icon-page-view"/>').click(function(t) {
                    n._showFieldsConfigPane(o(t.currentTarget))
                }).hover(function() {
                    FX.UI.showPopover({
                        position: "bottomLeft",
                        type: "dark",
                        anchor: o(this),
                        content: o("<span/>").text(i18next.t("field.show"))
                    })
                }, function() {
                    FX.UI.closePopover()
                }).toggleClass("active", !this._isAllFieldsSelected()).appendTo(this.$editPane)),
            s.hasShareBtn && o('<a class="share-btn"/>').append(o('<i class="icon-share"/>')).click(function() {
                n._showShareUrlPane()
            }).hover(function() {
                FX.UI.showPopover({
                    position: "bottomLeft",
                    type: "dark",
                    anchor: o(this),
                    content: o("<span/>").text(i18next.t("share"))
                })
            }, function() {
                FX.UI.closePopover()
            }).appendTo(this.$editPane),
            (s.hasShowFieldsBtn || s.hasShareBtn) && o('<div class="split-line"/>').appendTo(this.$editPane),
            s.hasPrintBtn && o('<a class="print-btn"><i class="icon-print"></i><span>' + i18next.t("print") + "</span></a>").click(function(t) {
                if (s.printList && s.printList.length) {
                    var e = s.printList || [];
                    if (1 === e.length)
                        return void FX.Utils.applyFunc(n, s.onPrint, [e[0].groupId, e[0].id], !1);
                    var i = o('<div class="print-template-select-pane"/>').on("click", function(t) {
                        var e = o(t.target).closest(".select-item");
                        e && e.length && (a.close(),
                            FX.Utils.applyFunc(n, s.onPrint, [e.data("groupId"), e.data("printId")], !1))
                    });
                    FX.Utils.forEach(e, function(t, e) {
                        o('<div class="select-item"/>').data("groupId", e.groupId).data("printId", e.id).text(e.name).appendTo(i)
                    });
                    var a = FX.Msg.bubble({
                        anchor: o(t.target).closest(".print-btn"),
                        contentHTML: i,
                        minWidth: 250,
                        hasTriangle: !1,
                        hAdjust: 100,
                        contentPadding: 0,
                        text4Cancel: null,
                        text4Ok: null
                    })
                } else
                    FX.Utils.applyFunc(n, s.onPrint, [], !1)
            }).appendTo(this.$editPane),
            s.hasCopyBtn && o('<a class="copy-btn"><i class="icon-copy"></i><span>' + i18next.t("copy") + "</span></a>").on("click", function() {
                FX.Utils.applyFunc(n, s.onCopyData, [], !1)
            }).appendTo(this.$editPane),
            s.hasEditBtn && o('<a class="edit-btn"/>').append(o('<i class="icon-flow-edit">')).append(o("<span/>").text(i18next.t("edit"))).click(function() {
                FX.Utils.applyFunc(n, s.onEditData, [], !1)
            }).appendTo(this.$editPane),
            s.hasDeleteBtn && o('<a class="delete-btn"/>').append(o('<i class="icon-trasho">')).append(o("<span/>").text(i18next.t("delete"))).click(function() {
                FX.Utils.applyFunc(n, s.onDeleteData, [], !1)
            }).appendTo(this.$editPane),
            s.hasRecoverBtn && (o('<a class="style-red"><i class="icon-trasho style-red"></i><span>' + i18next.t("delete.hard") + "</span></a>").click(function() {
                FX.Utils.applyFunc(n, s.onRecoverData, [s.data._id, !1], !1)
            }).appendTo(this.$editPane),
                o('<a ><i class="icon-recover"></i><span>' + i18next.t("recover") + "</span></a>").click(function() {
                    FX.Utils.applyFunc(n, s.onRecoverData, [s.data._id, !0], !1)
                }).appendTo(this.$editPane)),
            (s.hasActivateBtn || s.hasCloseBtn || s.hasTransferBtn) && o('<div class="split-line"/>').appendTo(this.$editPane),
            s.hasTransferBtn && o('<a class="transfer-btn"><i class="icon-member-normal"></i><span>' + i18next.t("flow.transfer") + "</span></a>").click(function() {
                FX.Utils.applyFunc(n, s.onTransfer, [], !1)
            }).appendTo(this.$editPane),
            s.hasActivateBtn && o('<a class="activate-btn"><i class="icon-flow-comment"></i><span>' + i18next.t("flow.activate") + "</span></a>").click(function() {
                FX.Utils.applyFunc(n, s.onActivate, [], !1)
            }).appendTo(this.$editPane),
            s.hasCloseBtn && o('<a class="close-btn"><i class="icon-flow-end style-red"></i><span>' + i18next.t("flow.close") + "</span></a>").click(function() {
                FX.Utils.applyFunc(n, s.onClose, [], !1)
            }).appendTo(this.$editPane),
            s.hasSwitchBtn && this._initSwitchBtn(this.element)
        },
        _getFieldItems: function() {
            var t = this.options
                , e = FX.LimitFields.dataManage.concat(["flowState", "chargers", "linkquery"])
                , i = FX.Utils.getShowFieldItems(t.showFields, t.allFields, e);
            return FX.Utils.addClsToSystemField(i, "field-system")
        },
        _showFieldsConfigPane: function(e) {
            var i = this.options
                , a = this;
            this.fieldCheck || (this.fieldCheck = new FX.ComboCheckBox({
                renderEl: e,
                items: this.fieldItems,
                width: null,
                height: null,
                onElementCreate: function() {
                    return !0
                },
                onAfterItemCreate: function(t, e, i) {
                    i.addClass(t.cls)
                },
                onStopEdit: function() {
                    var t = this.getValue();
                    t.length < a.fieldItems.length ? e.addClass("active") : e.removeClass("active"),
                        FX.Utils.applyFunc(a, i.onShowFieldsChange, [t], !1)
                }
            }),
                this.fieldCheck._onTriggerClick())
        },
        _isAllFieldsSelected: function() {
            var i = !0;
            return FX.Utils.forEach(this.fieldItems, function(t, e) {
                if (!e.selected)
                    return i = !1
            }),
                i
        },
        _showShareUrlPane: function() {
            var t = this.options
                , e = this
                , i = o('<div class="share-url-dialog"><div class="label"><div class="title">' + i18next.t("release.team") + '</div><div class="sub-title">' + i18next.t("release.team.link") + "</div></div></div>");
            new FX.ShareUrlPane({
                renderEl: o("<div/>").appendTo(i),
                url: FX.CONFIG.HOST.SITE_SHORT_HOST + FX.Utils.getApi(FX.API.entry.qr_link, t.appId, t.entryId, t.data._id),
                qrcodeName: t.title + "_" + t.data.label + "_" + i18next.t("share.member")
            });
            function a() {
                return new FX.ShareUrlPane({
                    renderEl: o("<div/>").appendTo(i),
                    url: t.publicDataUrlPrefix + "/d/" + t.data._id,
                    qrcodeName: t.title + "_" + t.data.label + "_" + i18next.t("share.public")
                })
            }
            var n, s, r = o('<div class="divider"/><div class="label"><div class="title">' + i18next.t("data.externalLink") + '</div><div class="sub-title">' + i18next.t("data.externalLink.subTitle") + "</div></div>");
            t.canConfigPublicData ? (r.appendTo(i),
                s = t.isPublicData,
            this.formConfig && (s = this.formConfig.formAttr.isPublicData,
            FX.Utils.isObjectEmpty(this.formConfig.formAttr.publicOptAuth) && (n = this._getDefaultPublicOptAuth(),
                FX.FormUtils.doSaveFormSet({
                    publicOptAuth: n
                }, function() {
                    e._updateFormConfigAttr({
                        publicOptAuth: n
                    })
                }))),
                new FX.Switch({
                    renderEl: o("<div/>").appendTo(i),
                    value: s,
                    onSwitch: function(t) {
                        FX.FormUtils.doSaveFormSet({
                            isPublicData: t
                        }, function() {
                            t ? e.dataLinkPane = a() : e.dataLinkPane && e.dataLinkPane.destroy(),
                                e._updateFormConfigAttr({
                                    isPublicData: t
                                })
                        })
                    }
                }),
            s && (this.dataLinkPane = a())) : t.isPublicData && (r.appendTo(i),
                a()),
                new FX.Dialog({
                    title: i18next.t("share"),
                    customCls: "",
                    width: 600,
                    height: 298,
                    hasPadding: !0,
                    onContentCreate: function(t) {
                        t.append(i)
                    }
                }).show()
        },
        _getDefaultPublicOptAuth: function() {
            var t = this.options
                , n = {};
            return FX.Utils.forEach(t.allFields, function(t, e) {
                var a = e.name;
                n[a] = FX.Utils.fieldAuthJson2Value({
                    visible: !0
                }),
                "subform" === e.type && FX.Utils.forEach(e.items, function(t, e) {
                    var i = [a, e.name].join(".");
                    n[i] = FX.Utils.fieldAuthJson2Value({
                        visible: !0
                    })
                })
            }),
                n
        },
        _initSwitchBtn: function(t) {
            var a = this
                , e = this.options;
            this.dataIndex = e.dataIndex;
            var i = o('<div class="switch-pane"><div class="switch-btn prev"><i class="icon-angleleft"/></div><div class="switch-num">' + e.dataIndex + "/" + e.dataCount + '</div><div class="switch-btn next"><i class="icon-angleright"/></div></div>').appendTo(t);
            e.dataIndex <= 1 && o(".prev", i).addClass("disabled"),
            e.dataIndex >= e.dataCount && o(".next", i).addClass("disabled"),
                o(".switch-btn", i).hover(function(t) {
                    var e, i, a = o(t.target).closest(".switch-btn");
                    a.hasClass("disabled") || (e = a.hasClass("prev"),
                        i = i18next.t("data.next.tip"),
                    e && (i = i18next.t("data.prev.tip")),
                        FX.UI.showPopover({
                            position: "bottomLeft",
                            anchor: a,
                            content: o("<span/>").text(i),
                            type: "dark",
                            animation: !1
                        }))
                }, function() {
                    FX.UI.closePopover()
                }),
                i.click(function(t) {
                    var e, i = o(t.target).closest(".switch-btn");
                    i.length && (e = i.hasClass("prev") ? a.dataIndex - 1 : a.dataIndex + 1,
                        a._switchData(e))
                }),
                o(document).one("keydown.ctrl_left.switch-shortcuts keydown.meta_left.switch-shortcuts", function() {
                    a._switchData(a.dataIndex - 1, !0)
                }),
                o(document).one("keydown.ctrl_right.switch-shortcuts keydown.meta_right.switch-shortcuts", function() {
                    a._switchData(a.dataIndex + 1, !0)
                }),
                o(document).one("keydown.left.switch-shortcuts", function() {
                    a._switchData(a.dataIndex - 1, !1)
                }),
                o(document).one("keydown.right.switch-shortcuts", function() {
                    a._switchData(a.dataIndex + 1, !1)
                })
        },
        destroy: function() {
            FX.DataMenu.superclass.destroy.apply(this, arguments),
                o(document).unbind(".switch-shortcuts")
        },
        _showSwitchTip: function(t, e) {
            var i, a = this.options, n = FX.Utils.createMask(), s = "";
            return t <= 0 ? s = i18next.t("data.first") : t > a.dataCount && (s = i18next.t("data.last")),
                FX.Utils.isEmpty(s) ? this.dataIndex < t ? (i = e ? i18next.t("data.edit.next") : i18next.t("data.view.next"),
                    o('<div class="switch-tip"><span>' + i + '</span><i class="next icon-arrow-right"/></div>').appendTo(n)) : (i = e ? i18next.t("data.edit.prev") : i18next.t("data.view.prev"),
                    o('<div class="switch-tip"><i class="prev icon-arrow-left"/><span>' + i + "</span></div>").appendTo(n)) : o('<div class="switch-tip widen"><span>' + s + "</span></div>").appendTo(n),
                n
        },
        _switchData: function(t, e) {
            var i, a = this.options;
            e && !a.hasEditBtn || (FX.UI.closePopover(),
                i = this._showSwitchTip(t, e),
                FX.Utils.applyFunc(this, a.onSwitchData, [t, e, i], !1),
            t < 1 || t > a.dataCount || (this.dataIndex = t))
        },
        _updateFormConfigAttr: function(t) {
            var e = this.options;
            this.formConfig && e.formConfigManager && (o.extend(this.formConfig.formAttr, t),
                e.formConfigManager.updateConfig(t))
        }
    }),
        o.shortcut("datamenu", FX.DataMenu)
}(jQuery),
function(f) {
    FX.FormData = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return f.extend(FX.FormData.superclass._defaultConfig.apply(), {
                baseCls: "fui-form-data",
                API: FX.API,
                authGroupId: null,
                comments: null,
                appId: null,
                data: null,
                entryId: null,
                flow: null,
                isMultiForm: !1,
                hasCustomPrint: !1,
                header: null,
                ignoreVisible: !0,
                layout: null,
                optAuth: null,
                title: "",
                tabs: [],
                hasSystemFields: !0,
                multiTabScrollElement: null,
                colorDisable: !1,
                needComputeFrozen: !1
            })
        },
        _init: function() {
            FX.FormData.superclass._init.apply(this, arguments);
            var t = this.options;
            this.showData = this._getShowData(t.header, t.data),
                this._createDataWrapper(),
                this.fullScreen = !1,
            this.formMultiTab && FX.Utils.fixFormMultiTab(t.multiTabScrollElement || this.$dataWrapper, f(".multi-tab-pane", this.$dataWrapper))
        },
        _getShowData: function(t, n) {
            var s = this
                , r = {};
            return FX.Utils.forEach(t, function(t, i) {
                if (i && i.widget && (i = FX.Utils.getFieldAttr(i)),
                    i) {
                    var e = i.tag || i.name;
                    switch (i.type) {
                        case "user":
                        case "usergroup":
                        case "dept":
                        case "deptgroup":
                            r[e] = s._getMemberShowValue(n[e]);
                            break;
                        case "flowState":
                            r[e] = FX.Utils.getFlowStateText(n[e]);
                            break;
                        case "subform":
                            var a = [];
                            FX.Utils.isObjectEmpty(n[e]) ? a.push(s._getShowData(i.items, {})) : FX.Utils.forEach(n[e], function(t, e) {
                                a.push(s._getShowData(i.items, e))
                            }),
                                r[e] = a;
                            break;
                        case "signature":
                            r[e] = n[e] || [];
                            break;
                        default:
                            r[e] = FX.Utils.formatData(i, n[e])
                    }
                }
            }),
                r
        },
        _getMemberShowValue: function(t) {
            var i, a = this;
            return FX.Utils.isNull(t) ? "" : FX.Utils.isArray(t) ? (i = [],
                FX.Utils.forEach(t, function(t, e) {
                    i.push(a._getMemberName(e))
                }),
                i) : this._getMemberName(t)
        },
        _getMemberName: function(t) {
            return f.isPlainObject(t) ? t.name : t
        },
        _isSystemField: function(t) {
            return this.options.hasSystemFields && -1 < FX.LimitFields.systemFields.indexOf(t.name)
        },
        _isWechatField: function(t) {
            return this.options.hasSystemFields && -1 < FX.LimitFields.wechatFields.indexOf(t.name)
        },
        _createDataWrapper: function() {
            var l = this.options
                , c = this;
            this.$dataWrapper = f('<div class="data-wrapper"/>').appendTo(this.element);
            var t, a, n, d = f("<ul/>").appendTo(this.$dataWrapper), u = [], h = [], p = [];
            this.concatMap = {},
                this.header = [],
                FX.Utils.forEach(l.header, function(t, e) {
                    var i = e.tab;
                    if (e.widget && (e = FX.Utils.getFieldAttr(e)),
                    e && "flowVer" !== e.name) {
                        var a, n = e.tag || e.name, s = c.showData[n], r = e.text, o = null;
                        if (l.ignoreVisible ? o = e : c._dealWidgetVisible(e, s) && "subform" === (o = e).type && (o = f.extend({}, e, {
                            items: []
                        }),
                            FX.Utils.forEach(e.items, function(t, e) {
                                !1 !== e.visible && o.items.push(e)
                            })),
                            !FX.Utils.isObjectEmpty(o)) {
                            if ("subform" === o.type && FX.Utils.isObjectEmpty(o.items))
                                return;
                            c.header.push(o),
                                !i || FX.Utils.isObjectEmpty(l.tabs) ? c._isSystemField(o) ? "chargers" === o.type ? h = h.concat({
                                    head: f.extend({
                                        show: "node"
                                    }, o),
                                    label: i18next.t("flow.node.current"),
                                    data: s
                                }, {
                                    head: f.extend({
                                        show: "user"
                                    }, o),
                                    label: i18next.t("flow.charger.current"),
                                    data: s
                                }) : h.push({
                                    head: o,
                                    label: r,
                                    data: s
                                }) : c._isWechatField(o) ? p.push({
                                    head: o,
                                    label: r,
                                    data: s
                                }) : (a = f('<li class="widget-data-view"/>').appendTo(d),
                                    c._createItem(o, r, s, a, !0)) : u.push({
                                    head: o,
                                    label: r,
                                    data: s,
                                    tab: i
                                })
                        }
                    }
                }),
            FX.Utils.isObjectEmpty(u) || (c.formMultiTab = new FX.FormMultiTab({
                renderEl: f('<div class="multi-tab-pane has-padding"/>').appendTo(this.$dataWrapper),
                items: u,
                tabs: FX.FormUtils.getNoEmptyTabs(u, l.tabs),
                onCreateTabItem: function(t) {
                    var e = f('<li class="widget-data-view widget-view"/>').data("tabName", t.tab);
                    return c._createItem(t.head, t.label, t.data, e, !0),
                        e
                },
                onTabClick: function() {
                    FX.Utils.multiTabScrollTop(c.$dataWrapper, l.multiTabScrollElement || c.$dataWrapper)
                }
            })),
            FX.Utils.isObjectEmpty(h.concat(p)) || (t = !FX.Utils.isObjectEmpty(p),
                l.hasSystemFields ? (t && ((a = f('<ul class="system-fields-wrapper ' + (l.hasSystemFields ? "grid-2" : "") + '"/>').appendTo(this.$dataWrapper)).append(f('<div class="system-fields-title">' + i18next.t("form.fields.wechat.title") + "</div>")),
                    FX.Utils.forEach(p, function(t, e) {
                        var i = f('<li class="widget-system-data"/>').appendTo(a);
                        c._createItem(e.head, e.label, e.data, i)
                    })),
                    n = f('<ul class="system-fields-wrapper ' + (l.hasSystemFields ? "grid-2" : "") + '"/>').appendTo(this.$dataWrapper),
                t && !FX.Utils.isObjectEmpty(h) && n.append(f('<div class="system-fields-title">' + i18next.t("form.fields.system.title") + "</div>")),
                    FX.Utils.forEach(h, function(t, e) {
                        var i = f('<li class="widget-system-data"/>').appendTo(n);
                        c._createItem(e.head, e.label, e.data, i)
                    })) : (t && (d.append(f('<div class="system-fields-title">' + i18next.t("form.fields.wechat.title") + "</div>")),
                    FX.Utils.forEach(p, function(t, e) {
                        var i = f('<li class="widget-data-view"/>').appendTo(d);
                        c._createItem(e.head, e.label, e.data, i)
                    }),
                FX.Utils.isObjectEmpty(h) || d.append(f('<div class="system-fields-title">' + i18next.t("form.fields.system.title") + "</div>"))),
                    FX.Utils.forEach(h, function(t, e) {
                        var i = f('<li class="widget-data-view"/>').appendTo(d);
                        c._createItem(e.head, e.label, e.data, i)
                    })))
        },
        _dealWidgetVisible: function(a, i) {
            var n = this
                , s = this.options;
            s.optAuth && (a.visible = s.optAuth[a.name] && s.optAuth[a.name].visible || !1,
            "subform" === a.type && FX.Utils.forEach(a.items, function(t, e) {
                var i = [a.name, e.name].join(".");
                e.visible = s.optAuth[i] && s.optAuth[i].visible || !1
            }));
            var r = {};
            return FX.Utils.forEach(a.items, function(t, e) {
                e.widgetsMap && (r[e.value] = !0,
                    e.value === i || e.isOther && i && !r[i] ? FX.Utils.forEach(e.widgetsMap, function(t, e) {
                        n.concatMap[e] = !0
                    }) : FX.Utils.forEach(e.widgetsMap, function(t, e) {
                        n.concatMap[e] || (n.concatMap[e] = !1)
                    }))
            }),
            !!a.visible && !1 !== this.concatMap[a.name]
        },
        _getShowFields: function() {
            var a = [];
            return FX.Utils.forEach(this.header, function(t, i) {
                "subform" === i.type ? FX.Utils.forEach(i.items, function(t, e) {
                    a.push([i.name, e.name].join(FX.CONST.FIELD.SUBFORM_DELIMITER))
                }) : a.push(i.name)
            }),
                a
        },
        _dealPrintField: function(i, t) {
            var a = this
                , e = i.name;
            i.tag && t && (e = t[i.tag]);
            var n = {};
            switch ((n[e] = i).type) {
                case "subform":
                    i.itemObj = {},
                        FX.Utils.forEach(i.items, function(t, e) {
                            f.extend(i.itemObj, a._dealPrintField(e))
                        });
                    break;
                case "linkdata":
                    i.linkObj = {},
                        FX.Utils.forEach(i.linkFields, function(t, e) {
                            f.extend(i.linkObj, a._dealPrintField(e))
                        })
            }
            return n
        },
        _dealPrintData: function(a, n, i) {
            var s = this
                , r = {};
            if (!i)
                return r;
            switch (i.type) {
                case "subform":
                    var o = {};
                    FX.Utils.forEach(n, function(t, e) {
                        FX.Utils.forEach(e, function(t, e) {
                            i.itemObj[t] && FX.Utils.forEach(s._dealPrintData(t, e, i.itemObj[t]), function(t, e) {
                                var i = [a, t].join(".");
                                o[i] ? o[i].push(e) : o[i] = [e]
                            })
                        })
                    }),
                        FX.Utils.forEach(o, function(t, e) {
                            r[t] = e
                        });
                    break;
                case "linkdata":
                    FX.Utils.forEach(i.linkObj, function(t, e) {
                        var i = e.name;
                        FX.Utils.forEach(s._dealPrintData(i, n[i], e), function(t, e) {
                            r[[a, t].join("->")] = e
                        })
                    });
                    break;
                case "location":
                    n && (r[a] = n.address + " " + n.lngLat);
                    break;
                case "phone":
                    n && (r[a] = n.phone);
                    break;
                default:
                    r[a] = n
            }
            return r
        },
        _doPrint: function(t, e, i) {
            var a, n, s = this, r = this.options;
            t && (r.comments = t),
            this.isPrinting || (r.hasCustomPrint ? (a = FX.Utils.isSupportPdf(),
                this.isPrinting = !0,
                n = setTimeout(function() {
                    s.closeMsg = FX.Msg.toast({
                        msg: i18next.t("data.print"),
                        type: "loading"
                    })
                }, 500),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(r.API.data.print),
                    data: {
                        appId: r.appId,
                        entryId: r.entryId,
                        showFields: this._getShowFields(),
                        formId: r.entryId,
                        isAttachment: !a && !window.DingTalkPC,
                        authGroupId: e || r.authGroupId,
                        printId: i || null,
                        flowId: r.flow && r.flow.flowId,
                        flowVer: r.flow && r.flow.version,
                        dataId: r.data._id
                    }
                }, function(t) {
                    "system" === t.printType ? s._doSystemPrint() : "template" === t.printType && (a ? new FX.Slider({
                        title: i18next.t("data.pdf"),
                        content: f('<embed src="' + t.url + '" width="100%" height="100%" style="position: absolute" type="application/pdf"/>')
                    }).show() : window.DingTalkPC ? window.DingTalkPC.biz.util.openLink({
                        url: t.url,
                        onFail: function() {
                            FX.Utils.redirectTo(t.url)
                        }
                    }) : FX.Utils.redirectTo(t.url))
                }, null, function() {
                    s.isPrinting = !1,
                        clearTimeout(n),
                    s.closeMsg && (s.closeMsg(),
                        s.closeMsg = null)
                })) : this._doSystemPrint())
        },
        _doSystemPrint: function() {
            var t, e = this.options;
            FX.Utils.isDingtalkPCAgent() ? FX.Msg.alert({
                title: i18next.t("corp.dingtalk.print.fail"),
                text4Ok: i18next.t("corp.dingtalk.print.ok"),
                text4Cancel: i18next.t("corp.dingtalk.print.cancel"),
                type: "query",
                onOk: function() {
                    FX.Utils.ajax({
                        url: FX.Utils.getApi(FX.API.sign.sso_jdy_token)
                    }, function(t) {
                        FX.Utils.openLink(window.location.href, t.token)
                    })
                }
            }) : (t = new FX.FormPrint({
                title: e.title,
                header: this.header,
                comments: e.comments,
                layout: e.layout,
                data: this.showData
            }),
                FX.Utils.doPrint(t.element))
        },
        _getLinkData: function(i, t, a) {
            var e, n, s = this.options;
            i.linkForm && t && t.id ? (e = {
                appId: s.appId,
                formId: t.entryId || i.linkForm,
                entryId: s.entryId,
                linkId: t.id
            },
            s.isMultiForm || (e.dataId = s.data._id),
            (n = t.appId || i.refAppId || i.appId) && n !== s.appId && (e.refAppId = n),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(s.API.data.read_link),
                    data: e
                }, function(t) {
                    var e = FX.Utils.getFieldsIntersection(t.fields, i.linkFields);
                    a && a(t.data, e)
                }, function() {
                    a && a({}, i.linkFields)
                })) : a && a({}, i.linkFields)
        },
        _getLinkQuery: function(t, e, i) {
            var a, n, s = this.options;
            t.linkForm ? (a = f.extend({
                appId: s.appId,
                formId: t.linkForm,
                entryId: s.entryId,
                widgetId: t.name,
                dataId: s.data._id,
                authGroupId: s.authGroupId,
                multi: t.multi
            }, e),
            (n = t.refAppId || t.appId) && n !== s.appId && (a.refAppId = n),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(s.API.data.read_link_query),
                    data: a
                }, function(t) {
                    i && i(t)
                }, function() {
                    i && i({})
                })) : i && i({})
        },
        _getLinkCount: function(t, e) {
            var i, a, n = this.options;
            t.linkForm ? (i = {
                appId: n.appId,
                formId: t.linkForm,
                entryId: n.entryId,
                widgetId: t.name,
                dataId: n.data._id,
                authGroupId: n.authGroupId,
                fields: t.fields,
                multi: t.multi,
                hasCount: !0,
                isCountOnly: !0
            },
            (a = t.refAppId || t.appId) && a !== n.appId && (i.refAppId = a),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(n.API.data.read_link_query),
                    data: i
                }, function(t) {
                    e && e(t.count)
                }, function() {
                    e && e()
                })) : e && e()
        },
        _dealWidgetData: function(i, t, e, a) {
            var n, s = this.options, r = f('<div class="widget-data"/>').appendTo(e);
            switch (i.type) {
                case "image":
                case "upload":
                    if (a)
                        this._createFileThumbList(t, r);
                    else if ("wx_avatar" === i.name) {
                        if (!FX.Utils.isArray(t) || !t.length)
                            break;
                        var o = t[0];
                        new FX.Avatar({
                            renderEl: r,
                            avatar: o.url,
                            size: "small"
                        })
                    } else
                        new FX.FileUpload({
                            mode: "preview",
                            renderEl: r,
                            files: t,
                            enable: !1
                        });
                    break;
                case "signature":
                    this._createSignatureItem(t, r);
                    break;
                case "subform":
                    var l = [];
                    FX.Utils.forEach(i.items, function(t, e) {
                        FX.Utils.isValueWidget(e.type) && (s.needComputeFrozen && i.pc_sticky_column && i.pc_sticky_column.enable && t < i.pc_sticky_column.limit && (e.frozen = !0),
                            l.push(e))
                    }),
                        this._createSubformItem(l, t, r);
                    break;
                case "textarea":
                    t && r.append(f("<pre/>").append(FX.Utils.replaceURL(t)));
                    break;
                case "text":
                    if (t = FX.Utils.isNull(t) ? "" : t,
                    i.regex && new RegExp(i.regex).test(t)) {
                        var c = FX.CONST.TEXT_TYPE_REGEXP;
                        if (i.regex === c.email) {
                            f("<a/>").attr("href", "mailto:" + t).text(t).appendTo(r);
                            break
                        }
                    }
                    r.append(FX.Utils.replaceURL(t));
                    break;
                case "chargers":
                    var d = {}
                        , u = {};
                    FX.Utils.forEach(t, function(t, e) {
                        e.flowName && (d[e.flowName] || (d[e.flowName] = !0),
                        u[e.userNickname] || (u[e.userNickname] = !0))
                    });
                    var h = [];
                    "node" === i.show ? FX.Utils.forEach(d, function(t) {
                        h.push(t)
                    }) : FX.Utils.forEach(u, function(t) {
                        h.push(t)
                    }),
                        r.text(h);
                    break;
                case "location":
                    FX.Utils.isObjectEmpty(t) || (t.address && r.text(t.address),
                    t.lngLat && f('<div class="widget-info">' + t.lngLat + "</div>").appendTo(e));
                    break;
                case "phone":
                    t && t.phone && (r.text(t.phone),
                    t.verified && f('<div class="phone-verified-tag"/>').text(i18next.t("widget.phone.validate.success")).appendTo(r));
                    break;
                case "checkboxgroup":
                case "combocheck":
                    !this.options.colorDisable && i.colorEnable ? (n = FX.Utils.getColorTagList({
                        field: i,
                        values: t,
                        tagCss: {
                            margin: "2px"
                        },
                        multiLine: !0
                    }),
                        r.append(n)) : r.text(t);
                    break;
                case "radiogroup":
                case "combo":
                    !this.options.colorDisable && i.colorEnable ? (n = FX.Utils.getColorTagList({
                        field: i,
                        values: [t],
                        tagCss: {
                            margin: "2px"
                        },
                        multiLine: !0
                    }),
                        r.append(n)) : r.text(t);
                    break;
                case "flowState":
                    r.append(FX.Utils.getFlowStateTag(t));
                    break;
                default:
                    t = FX.Utils.isNull(t) ? "" : t,
                        r.append(f("<span />").text(t))
            }
        },
        _dealLinkField: function(a, t, n) {
            var e = this.options
                , s = this
                , r = "";
            function o(t, e) {
                var i;
                n && n[e] && (t.colorEnable = !0,
                    i = [],
                    FX.Utils.forEach(n[e], function(t, e) {
                        i.push({
                            color: e,
                            text: t,
                            value: t
                        })
                    }),
                    t.items = i)
            }
            switch (t !== e.appId && (r = t),
                a.type) {
                case "subform":
                    FX.Utils.forEach(a.items, function(t, e) {
                        var i = a.name + "." + (e.name || e.widget && e.widget.widgetName);
                        s.options.colorDisable || o(e, i),
                            f.extend(e, FX.Utils.getFieldAttr(e)),
                        "linkdata" !== e.type && "linkquery" !== e.type || !r || e.refAppId || (e.refAppId = r),
                        "linkdata" === e.type && (e.mode = "preview")
                    });
                    break;
                default:
                    this.options.colorDisable || o(a, a.name)
            }
        },
        _isItemValid: function(t) {
            switch (t.type) {
                case "formula":
                case "flowState":
                case "chargers":
                case "linkquery":
                    return !0;
                default:
                    return FX.Utils.isValueWidget(t.type) || t.isJoined || /_join_/.test(t.name)
            }
        },
        _createItem: function(n, t, r, e, i) {
            var a, s, o, l = this, c = this.options;
            if (this._isItemValid(n)) {
                if ("linkquery" === n.type)
                    return n.multi ? (a = [],
                        FX.Utils.forEach(n.linkFilter, function(t, e) {
                            "self" === e.type && a.push(e.link)
                        }),
                        s = new FX.LinkTable({
                            renderEl: f("<div/>").appendTo(f('<div class="widget-data"/>').appendTo(e)),
                            API: c.API,
                            allowAdd: n.allowAdd,
                            appId: c.appId,
                            entryId: n.linkForm,
                            dataId: c.data._id,
                            linkDataFields: a,
                            linkEnable: !FX.Utils.isExternalLink() && !FX.STATIC.ISADMIN,
                            fieldName: n.name,
                            fields: n.linkFields,
                            refAppId: n.refAppId,
                            colorDisable: c.colorDisable,
                            onLoadData: function(t) {
                                if (!n.linkForm)
                                    return !1;
                                l._getLinkQuery(n, t, function(t) {
                                    var e = FX.Utils.getFieldsIntersection(t.fields, n.linkFields);
                                    s.reloadData(t, e)
                                })
                            },
                            onLoadCount: function(t) {
                                l._getLinkCount(n, t)
                            }
                        })) : (o = f("<ul/>").appendTo(e),
                        this._getLinkQuery(n, {}, function(t) {
                            var e = FX.Utils.getFieldsIntersection(t.fields, n.linkFields)
                                , a = l._getShowData(e, t.dataList && t.dataList[0] || {});
                            FX.Utils.forEach(e, function(t, e) {
                                var i = f("<li/>").appendTo(o);
                                l._dealLinkField(e, n.refAppId),
                                    l._createItem(e, e.text, a[e.name], i, !0)
                            })
                        })),
                        e;
                if (r && "linkdata" === n.type) {
                    var d = f("<ul/>").appendTo(e);
                    return this._getLinkData(n, r, function(n, s) {
                        f.extend(r, l._getShowData(s, n)),
                            FX.Utils.forEach(s, function(t, e) {
                                var i = f("<li/>").appendTo(d)
                                    , a = l._getColorMap(s);
                                l._dealLinkField(e, n.appId, a),
                                    l._createItem(e, e.text, r[e.name], i, !0)
                            })
                    }),
                        e
                }
                return t && f('<div class="widget-label"/>').appendTo(e).append(f('<span class="label-title"/>').text(t)),
                FX.Utils.isNull(r) && !i || this._dealWidgetData(n, r, e),
                    e
            }
        },
        _getColorMap: function(t) {
            var i;
            return FX.Utils.forEach(t, function(t, e) {
                i = i || {},
                    f.extend(i, FX.FormUtils.optionsWidgetConfig2ColorMap(e))
            }),
                i
        },
        _createSubformItem: function(c, t, e) {
            var d = this;
            e.addClass("subform-widget-data");
            var n, i = f('<table class="widget-subform"/>').appendTo(e), s = f("<tr/>").appendTo(f('<thead class="widget-label"/>').appendTo(i));
            f('<td class="widget-item fix-col-head fix-title-head"><div><i class="head-icon icon-expand"/><i class="head-icon icon-contract"/></div></td>').appendTo(s).on("click", function() {
                d.doFullScreen(e, a)
            }),
                FX.Utils.forEach(c, function(t, a) {
                    var e;
                    "linkdata" === a.type ? FX.Utils.forEach(a.linkFields, function(t, e) {
                        var i = f('<td class="widget-item"/>').css({
                            "min-width": d._getSubformWidgetWidth(e.type)
                        }).appendTo(s);
                        a.frozen && (i.addClass("frozen-item"),
                            n = i),
                            d._createItem(e, e.text, null, i)
                    }) : (e = f('<td class="widget-item"/>').css({
                        "min-width": d._getSubformWidgetWidth(a.type)
                    }).appendTo(s),
                    a.frozen && (e.addClass("frozen-item"),
                        n = e),
                        d._createItem(a, a.text, null, e))
                }),
            n && n.addClass("has-border");
            var a, r = f('<tbody class="widget-data"/>').appendTo(i);
            FX.Utils.forEach(t, function(t, n) {
                var o, l = f("<tr/>").appendTo(r);
                f('<td class="widget-item fix-col-head"/>').text(t + 1).appendTo(l),
                    FX.Utils.forEach(c, function(t, i) {
                        var s, r, a, e;
                        "linkdata" === i.type ? (s = {},
                            FX.Utils.forEach(i.linkFields, function(t, e) {
                                s[e.name] = f('<td class="widget-item"/>').appendTo(l),
                                i.frozen && (s[e.name].addClass("frozen-item"),
                                    o = s[e.name])
                            }),
                            r = n[i.name],
                            "preview" === i.mode ? (a = d._getShowData(i.linkFields, r),
                                FX.Utils.forEach(i.linkFields, function(t, e) {
                                    e.subform = c.name,
                                        d._dealWidgetData(e, a[e.name], s[e.name], !0)
                                })) : d._getLinkData(i, n[i.name], function(a, n) {
                                var t = d._getShowData(n, a);
                                f.extend(r, t),
                                    FX.Utils.forEach(n, function(t, e) {
                                        e.subform = c.name;
                                        var i = d._getColorMap(n);
                                        d._dealLinkField(e, a.appId, i),
                                            d._dealWidgetData(e, r[e.name], s[e.name], !0)
                                    })
                            })) : (e = f('<td class="widget-item"/>').appendTo(l),
                        i.frozen && (e.addClass("frozen-item"),
                            o = e),
                            i.subform = i.name,
                            d._dealWidgetData(i, n[i.name], e, !0))
                    }),
                o && o.addClass("has-border")
            }),
                e.off("mouseover.subform-data"),
                e.on("mouseover.subform-data", function() {
                    a || (a = new PerfectScrollbar(e[0]),
                        e[0].addEventListener("ps-scroll-y", function() {
                            i.children("thead").css(FX.Utils.formatTransform("translate3d(0," + f(this).scrollTop() + "px,1px)"))
                        }),
                        e[0].addEventListener("ps-scroll-x", function() {
                            i.find(".fix-col-head").css(FX.Utils.formatTransform("translateX(" + f(this).scrollLeft() + "px)")),
                                i.find(".frozen-item").css(FX.Utils.formatTransform("translateX(" + f(this).scrollLeft() + "px)"))
                        }))
                })
        },
        doFullScreen: function(t, e) {
            this.fullScreen = !this.fullScreen;
            var i = t.children(".ps__rail-x")
                , a = t.children(".ps__rail-y");
            t.toggleClass("full-screen", this.fullScreen),
                i.toggleClass("ps-background", this.fullScreen),
                e.update(),
                this.fullScreen ? "none" === i.css("display") && a.css("margin-right", f(window).outerWidth() - t.children(".widget-subform").outerWidth() + "px") : a.css("margin-right", 0)
        },
        _getSubformWidgetWidth: function(t) {
            var e = 146;
            switch (t) {
                case "user":
                case "usergroup":
                case "dept":
                case "deptgroup":
                case "radiogroup":
                case "checkboxgroup":
                    e = 180;
                    break;
                case "textarea":
                case "address":
                case "location":
                    e = 240
            }
            return e
        },
        _createSignatureItem: function(e, t) {
            var i;
            FX.Utils.isObjectEmpty(e) || (i = f('<div class="signature-item"/>').on("click", function(t) {
                f(t.target).hasClass("signature-image") && new FX.FilePreview({
                    files: [e]
                })
            }).appendTo(t),
                f('<img class="signature-image"/>').attr("src", e.thumbUrl).appendTo(i))
        },
        _createFileThumbList: function(t, e) {
            new FX.ThumbList({
                renderEl: f("<div/>").appendTo(e),
                files: t
            })
        },
        doResize: function() {
            FX.FormData.superclass.doResize.apply(this, arguments),
            this.formMultiTab && this.formMultiTab.rebuildTabList()
        }
    }),
        f.shortcut("formdata", FX.FormData)
}(jQuery),
function(u) {
    FX.MessageData = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return u.extend(FX.MessageData.superclass._defaultConfig.apply(), {
                baseCls: "fx_message_data",
                message: {}
            })
        },
        _init: function() {
            FX.MessageData.superclass._init.apply(this, arguments),
                this.$wrapper = u('<div class="widget-wrapper">').appendTo(this.element),
                this._createHeader(),
                this._createData()
        },
        _createHeader: function() {
            var t = this.options.message.formName
                , e = u('<div class="preview-title-pane"/>').append(u('<div class="preview-title"/>').text(t)).prependTo(this.element);
            new FX.ExpansionButton({
                renderEl: u("<div/>").appendTo(e),
                target: this.element
            })
        },
        _createData: function() {
            var t = this.options
                , a = this
                , e = t.message.form
                , n = t.message.data
                , i = e && e.items
                , s = u("<ul/>").appendTo(u('<div class="data-wrapper"/>').appendTo(this.$wrapper));
            FX.Utils.forEach(i, function(t, e) {
                var i;
                e.widget && (i = u('<li class="widget-data-view"/>').appendTo(s),
                    a._createItem(e.widget, e.label, n[e.widget.widgetName], i, !0))
            })
        },
        _createItem: function(t, e, i, a, n) {
            e && u('<div class="widget-label"/>').appendTo(a).append(u('<span class="label-title"/>').text(e)),
            (i || n) && this._dealWidgetData(t, i, a)
        },
        _dealWidgetData: function(t, e, i, a) {
            var n, s = FX.Utils.formatData(t, e), r = u('<div class="widget-data"/>').appendTo(i);
            switch (t.type) {
                case "location":
                    var o = FX.Utils.address2Str(e, "", "pcda");
                    r.text(o),
                        i.append('<div class="widget-info">' + FX.Utils.getLnglatText(e) + "</div>");
                    break;
                case "image":
                case "upload":
                    a ? this._createFileThumbList(e, r) : new FX.FileUpload({
                        mode: "preview",
                        renderEl: r,
                        files: e,
                        enable: !1
                    });
                    break;
                case "signature":
                    this._createSignatureItem(e, r);
                    break;
                case "subform":
                    var l = [];
                    FX.Utils.forEach(t.items, function(t, e) {
                        l.push(u.extend({}, e.widget, {
                            label: e.label,
                            name: e.widget.widgetName,
                            type: e.widget.type
                        }))
                    }),
                        this._createSubformItem(l, s, r);
                    break;
                case "textarea":
                    s && r.append(u("<pre/>").append(FX.Utils.replaceURL(s)));
                    break;
                case "text":
                    if (s = FX.Utils.isNull(s) ? "" : s,
                    t.regex && new RegExp(t.regex).test(s)) {
                        var c = FX.CONST.TEXT_TYPE_REGEXP;
                        if (t.regex === c.email) {
                            u("<a/>").attr("href", "mailto:" + e).text(e).appendTo(r);
                            break
                        }
                    }
                    r.append(FX.Utils.replaceURL(s));
                    break;
                case "user":
                case "dept":
                    r.text(s && s.name);
                    break;
                case "usergroup":
                case "deptgroup":
                    var d = [];
                    FX.Utils.forEach(s, function(t, e) {
                        e && d.push(e.name)
                    }),
                        r.text(d);
                    break;
                case "linkdata":
                    r.text(s && s.key);
                    break;
                case "phone":
                    s && s.phone && (r.text(s.phone),
                    s.verified && u('<div class="phone-verified-tag"/>').text(i18next.t("widget.phone.validate.success")).appendTo(r));
                    break;
                case "radiogroup":
                case "combo":
                    t.colorEnable ? (n = FX.Utils.getColorTagList({
                        field: t,
                        values: [s],
                        tagCss: {
                            margin: "2px"
                        },
                        multiLine: !0
                    }),
                        r.append(n)) : (s = FX.Utils.isNull(s) ? "" : s,
                        r.text(s));
                    break;
                case "combocheck":
                case "checkboxgroup":
                    t.colorEnable ? (n = FX.Utils.getColorTagList({
                        field: t,
                        values: s,
                        tagCss: {
                            margin: "2px"
                        },
                        multiLine: !0
                    }),
                        r.append(n && n.css("margin", "2px"))) : (s = FX.Utils.isNull(s) ? "" : s,
                        r.text(s));
                    break;
                default:
                    s = FX.Utils.isNull(s) ? "" : s,
                        r.text(s)
            }
        },
        _createSignatureItem: function(e, t) {
            var i;
            FX.Utils.isObjectEmpty(e) || (i = u('<div class="signature-item"/>').on("click", function(t) {
                u(t.target).hasClass("signature-image") && new FX.FilePreview({
                    files: [e]
                })
            }).appendTo(t),
                u('<img class="signature-image"/>').attr("src", e.thumbUrl).appendTo(i))
        },
        _createFileThumbList: function(t, e) {
            new FX.ThumbList({
                renderEl: u("<div/>").appendTo(e),
                files: t
            })
        },
        _getSubformWidgetWidth: function(t) {
            var e = 146;
            switch (t) {
                case "user":
                case "usergroup":
                case "dept":
                case "deptgroup":
                case "radiogroup":
                case "checkboxgroup":
                    e = 180;
                    break;
                case "textarea":
                case "address":
                case "location":
                    e = 240
            }
            return e
        },
        _createSubformItem: function(e, t, i) {
            var n = this;
            i.addClass("subform-widget-data");
            var a = u('<table class="widget-subform"/>').appendTo(i)
                , s = u("<tr/>").appendTo(u('<thead class="widget-label"/>').appendTo(a));
            FX.Utils.forEach(e, function(t, e) {
                n._createItem(e, e.label, null, u('<td class="widget-item"/>').css({
                    "min-width": n._getSubformWidgetWidth(e.type)
                }).appendTo(s))
            });
            var r = u('<tbody class="widget-data"/>').appendTo(a);
            FX.Utils.forEach(t, function(t, i) {
                var a = u("<tr/>").appendTo(r);
                FX.Utils.forEach(e, function(t, e) {
                    n._dealWidgetData(e, i[e.name], u('<td class="widget-item"/>').appendTo(a), !0)
                })
            })
        }
    })
}(jQuery),
function(o) {
    FX.Report = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.Report.superclass._defaultConfig.apply(), {
                baseCls: "fui-report",
                appId: null,
                entryId: null,
                supportExport: !0,
                hasLazyLoad: !1,
                scrollView: null,
                margin: 30
            })
        },
        _init: function() {
            FX.Report.superclass._init.apply(this, arguments);
            var n = this.options
                , s = this;
            FX.STATIC.ENTRYID = n.entryId,
                n.resultWidgets = {},
                this.widgetsMap = {},
                this.lastBottomHeight = 0;
            var t, e = this.element.width() - n.margin;
            this.$content = o('<div class="content"/>').width(e).appendTo(this.element),
            n.parameter && (t = o('<div class="parameter-content"/>').appendTo(this.$content),
                this.parameter = new FX.Parameter(o.extend({
                    renderEl: o("<div/>").appendTo(t),
                    onStopEdit: function(t) {
                        s._findWidgetByForm(t, function(t) {
                            t.reload()
                        })
                    }
                }, n.parameter))),
                this.$widgetWrapper = o('<div class="report-content"/>').appendTo(this.$content);
            var r = 1;
            n.layout && n.layout.width && (r = e / n.layout.width),
                FX.Utils.forEach(n.items, function(t, e) {
                    var i = o.extend({}, e, s._getSize(e, r));
                    i.renderEl = o("<div/>").css({
                        position: "absolute",
                        left: i.x,
                        top: i.y
                    }).appendTo(s.$widgetWrapper),
                        s.lastBottomHeight = Math.max(s.lastBottomHeight, i.height + i.y),
                        i.onAfterHeadCreate = function(t) {
                            this.createHeadTools()
                        }
                        ,
                        i.onItemClick = function(a) {
                            FX.Utils.forEach(this.options.linkWidgets, function(t, e) {
                                var i = s.getWidgetByName(e);
                                i && i.reload(a)
                            })
                        }
                        ,
                        i.onDataFilter = function() {
                            return s.parameter ? s.parameter.getValue() : null
                        }
                        ,
                    n.supportExport || (i.exportable = !1),
                        i.allowDataLoad = !n.hasLazyLoad,
                    "datatable" === e.type && (i.colorDisable = !0);
                    var a = FX.createWidget(i);
                    n.resultWidgets[i.widgetName] = a,
                        s.widgetsMap[t] = a
                }),
                this._bindLazyLoadEvt()
        },
        _getSize: function(t, e) {
            var i = t.y / t.x
                , a = t.height / t.width
                , n = t.width
                , s = t.x;
            return {
                x: Math.ceil(s * e),
                y: Math.ceil(s * e * i),
                width: Math.ceil(n * e),
                height: Math.ceil(n * e * a)
            }
        },
        _bindLazyLoadEvt: function() {
            var t, e = this.options, i = this;
            e.hasLazyLoad && (this.doLazyLoad(),
                t = this.element,
            e.scrollView && (t = o(e.scrollView)),
                t.unbind("scroll.lazy"),
                t.bind("scroll.lazy", function() {
                    i.doLazyLoad()
                }),
                o(window).unbind("resize.report_lazy_load"),
                o(window).bind("resize.report_lazy_load", function() {
                    i.lazyTimer && clearTimeout(i.lazyTimer),
                        i.lazyTimer = setTimeout(function() {
                            i && 0 < i.element.closest("body").length ? i.doLazyLoad() : o(window).unbind("resize.report_lazy_load")
                        }, 500)
                }))
        },
        doLazyLoad: function() {
            var t = this.options;
            t.hasLazyLoad && FX.Utils.forEach(t.resultWidgets, function(t, e) {
                e && (e.isAllowDataLoad() || o(e.element).offset().top <= document.body.clientHeight && (e.setAllowDataLoad(!0),
                    e.reload()))
            })
        },
        _findWidgetByForm: function(t, e) {
            if (!FX.Utils.isEmpty(t))
                for (var i in this.options.resultWidgets) {
                    var a = this.options.resultWidgets[i];
                    -1 < a.options.forms.indexOf(t) && e(a)
                }
        },
        updateComponentsPos: function() {
            var a = this
                , t = this.options
                , e = this.element.width() - t.margin;
            this.$content.width(e);
            var n = 1;
            t.layout && t.layout.width && (n = e / t.layout.width),
                FX.Utils.forEach(t.items, function(t, e) {
                    var i = a._getSize(e, n);
                    a.widgetsMap[t].element.css({
                        position: "absolute",
                        left: i.x,
                        top: i.y
                    }),
                        a.widgetsMap[t].doResize({
                            width: i.width,
                            height: i.height
                        }),
                        a.lastBottomHeight = Math.max(a.lastBottomHeight, i.height + i.y)
                })
        },
        doResize: function(t, e) {
            FX.Report.superclass.doResize.apply(this, arguments);
            var i = this.options;
            e && this.updateComponentsPos(),
            FX.Utils.isEmpty(i.height) && this.$widgetWrapper && this.$widgetWrapper.css({
                height: this.lastBottomHeight + 10
            })
        }
    }),
        o.shortcut("report", FX.Report)
}(jQuery),
function(a) {
    FX.DateLimit = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.DateLimit.superclass._defaultConfig.apply(), {
                baseCls: "fui_date_limit",
                format: "yyyy-MM-dd",
                wrap: !1,
                width4date: 150
            })
        },
        _init: function() {
            FX.DateLimit.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this
                , i = "limit-item";
            t.wrap && (i = "limit-wrap"),
                this.startDate = new FX.DateTime({
                    renderEl: a('<div class="' + i + '"/>').appendTo(this.element),
                    waterMark: t.wrap ? i18next.t("date.start") : "",
                    format: t.format,
                    defaultPickDate: (new Date).setHours(0, 0, 0, 0),
                    onStopEdit: function() {
                        e._setSingleValue("start", this.getValue()),
                            FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                    },
                    value: null,
                    width: t.width4date
                }),
            t.wrap || a('<div class="limit-item limit-to"/>').text("~").appendTo(this.element),
                this.endDate = new FX.DateTime({
                    waterMark: t.wrap ? i18next.t("date.end") : "",
                    renderEl: a('<div class="' + i + '"/>').appendTo(this.element),
                    format: t.format,
                    defaultPickDate: (new Date).setHours(0, 0, 0, 0),
                    onStopEdit: function() {
                        e._setSingleValue("end", this.getValue()),
                            FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                    },
                    value: null,
                    width: t.width4date
                })
        },
        _setSingleValue: function(t, e) {
            var i = this.getValue();
            "start" === t ? (this.endDate.options.startDate = FX.Utils.isNull(e) ? null : e,
                this.endDate.rebuild(),
                this.endDate.setValue(i.max)) : (this.startDate.options.endDate = FX.Utils.isNull(e) ? null : e,
                this.startDate.rebuild(),
                this.startDate.setValue(i.min))
        },
        setValue: function(t) {
            t ? (FX.Utils.isNull(t.max) ? this.endDate.setValue(null) : this.endDate.setValue(t.max),
                FX.Utils.isNull(t.min) ? this.startDate.setValue(null) : this.startDate.setValue(t.min)) : (this.endDate.setValue(null),
                this.startDate.setValue(null)),
                this._setSingleValue("start", t ? t.min : null),
                this._setSingleValue("end", t ? t.max : null)
        },
        getValue: function() {
            var t = this.startDate.getValue()
                , e = this.endDate.getValue()
                , i = {};
            return FX.Utils.isNull(t) || (i.min = t),
            FX.Utils.isNull(e) || (i.max = e),
                i
        }
    }),
        a.shortcut("datelimit", FX.DateLimit)
}(jQuery),
function(t) {
    FX.NumberLimit = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return t.extend(FX.NumberLimit.superclass._defaultConfig.apply(), {
                baseCls: "fui_number_limit",
                width: 300,
                width4number: 150
            })
        },
        _init: function() {
            FX.NumberLimit.superclass._init.apply(this, arguments);
            var i = this.options
                , a = this;
            this.minNumber = new FX.Number({
                renderEl: t('<div class="limit-item"/>').appendTo(this.element),
                waterMark: i18next.t("min"),
                height: i.height,
                allowDecimals: !0,
                onStopEdit: function(t, e) {
                    FX.Utils.applyFunc(a, i.onStopEdit, [t, e], !1)
                },
                width: i.width4number
            }),
                t('<div class="limit-item limit-to"/>').text("~").appendTo(this.element),
                this.maxNumber = new FX.Number({
                    renderEl: t('<div class="limit-item"/>').appendTo(this.element),
                    waterMark: i18next.t("max"),
                    allowDecimals: !0,
                    height: i.height,
                    onStopEdit: function(t, e) {
                        FX.Utils.applyFunc(a, i.onStopEdit, [t, e], !1)
                    },
                    width: i.width4number
                })
        },
        checkValidate: function() {
            return this.maxNumber.checkValidate() && this.minNumber.checkValidate()
        },
        setValue: function(t) {
            t ? (FX.Utils.isNull(t.max) ? this.maxNumber.setValue(null) : this.maxNumber.setValue(t.max),
                FX.Utils.isNull(t.min) ? this.minNumber.setValue(null) : this.minNumber.setValue(t.min)) : (this.maxNumber.setValue(null),
                this.minNumber.setValue(null))
        },
        getValue: function() {
            var t = this.maxNumber.getValue()
                , e = this.minNumber.getValue()
                , i = {};
            return FX.Utils.isNull(e) || (i.min = e),
            FX.Utils.isNull(t) || (i.max = t),
                i
        }
    }),
        t.shortcut("numberlimit", FX.NumberLimit)
}(jQuery),
function($) {
    FX.DomTree = FX.extend(FX.Widget, {
        setting: {
            treeId: "tree",
            treeObj: null,
            view: {
                addDiyDom: null,
                autoCancelSelected: !0,
                dblClickExpand: !1,
                expandSpeed: "fast",
                fontCss: {},
                nameIsHTML: !1,
                selectedMulti: !1,
                showIcon: !1,
                showLine: !1,
                showTitle: !0,
                txtSelectedEnable: !1
            },
            data: {
                key: {
                    children: "children",
                    name: "name",
                    title: "",
                    url: "url",
                    checked: "checked"
                },
                simpleData: {
                    enable: !1,
                    idKey: "id",
                    pIdKey: "pId",
                    rootPId: null
                },
                keep: {
                    parent: !1,
                    leaf: !1
                }
            },
            async: {
                enable: !1,
                contentType: "application/x-www-form-urlencoded",
                type: "post",
                dataType: "text",
                url: "",
                autoParam: [],
                otherParam: [],
                dataFilter: null
            },
            callback: {
                beforeAsync: null,
                beforeNodeCreate: null,
                beforeClick: null,
                beforeDblClick: null,
                beforeRightClick: null,
                beforeMouseDown: null,
                beforeMouseUp: null,
                beforeExpand: null,
                beforeCollapse: null,
                beforeRemove: null,
                beforeCheck: null,
                onAsyncError: null,
                onAsyncSuccess: null,
                onNodeCreated: null,
                onClick: null,
                onDblClick: null,
                onRightClick: null,
                onMouseDown: null,
                onMouseUp: null,
                onExpand: null,
                onCollapse: null,
                onRemove: null,
                onCheck: null
            },
            consts: {
                className: {
                    BUTTON: "button",
                    LEVEL: "level",
                    ICO_LOADING: "ico_loading",
                    SWITCH: "switch"
                },
                event: {
                    NODECREATED: "tree_nodeCreated",
                    CLICK: "tree_click",
                    EXPAND: "tree_expand",
                    COLLAPSE: "tree_collapse",
                    ASYNC_SUCCESS: "tree_async_success",
                    ASYNC_ERROR: "tree_async_error",
                    CHECK: "tree_check"
                },
                id: {
                    A: "_a",
                    ICON: "_ico",
                    SPAN: "_span",
                    SWITCH: "_switch",
                    UL: "_ul",
                    CHECK: "_check"
                },
                line: {
                    ROOT: "root",
                    ROOTS: "roots",
                    CENTER: "center",
                    BOTTOM: "bottom",
                    NOLINE: "noline",
                    LINE: "line"
                },
                folder: {
                    OPEN: "open",
                    CLOSE: "close",
                    DOCU: "docu"
                },
                node: {
                    CURSELECTED: "curSelectedNode"
                },
                checkbox: {
                    STYLE: "x-check",
                    DEFAULT: "x-tree-check",
                    DISABLED: "disable",
                    FALSE: "",
                    TRUE: "select",
                    FULL: "full",
                    PART: "part",
                    FOCUS: "focus"
                },
                radio: {
                    STYLE: "radio",
                    TYPE_ALL: "all",
                    TYPE_LEVEL: "level"
                }
            },
            check: {
                enable: !1,
                autoCheckTrigger: !1,
                chkStyle: "x-check",
                nocheckInherit: !1,
                chkDisabledInherit: !1,
                radioType: "level",
                chkboxType: {
                    Y: "ps",
                    N: "ps"
                }
            }
        },
        getDOMBySelector: function(t, e, i) {
            return e && "string" != typeof e && (i = e,
                e = ""),
                "string" == typeof t ? $(t, i ? i.treeObj.get(0).ownerDocument : null) : $("#" + t.tId + e, i ? i.treeObj : null)
        },
        makeUlLineClass: function(t, e) {
            return t.view.showLine && !e.isLastNode ? t.consts.line.LINE : ""
        },
        makeUlHtml: function(t, e, i, a) {
            i.push("<ul id='", e.tId, t.consts.id.UL, "' class='", t.consts.className.LEVEL, e.level, " ", this.makeUlLineClass(t, e), "' style='display:", e.open ? "block" : "none", "'>"),
                i.push(a),
                i.push("</ul>")
        },
        appendParentULDom: function(t, e) {
            var i = []
                , a = this.getDOMBySelector(e, t);
            !a.get(0) && e.parentTId && (this.appendParentULDom(t, e.getParentNode()),
                a = this.getDOMBySelector(e, t));
            var n = this.getDOMBySelector(e, t.consts.id.UL, t);
            n.get(0) && n.remove();
            var s = t.data.key.children
                , r = this.appendNodes(t, e.level + 1, e[s], e, !1, !0);
            this.makeUlHtml(t, e, i, r.join("")),
                a.append(i.join(""))
        },
        makeNodeIcoStyle: function(t, e) {
            var i = [];
            return e.isAjaxing || !1 !== t.view.showIcon && FX.Utils.applyFunc(this, t.view.showIcon, [e], !0) || i.push("width:0px;height:0px;"),
                i.join("")
        },
        makeNodeLineClass: function(t, e) {
            var i = []
                , a = t.consts;
            return t.view.showLine ? 0 === e.level && e.isFirstNode && e.isLastNode ? i.push(a.line.ROOT) : 0 === e.level && e.isFirstNode ? i.push(a.line.ROOTS) : e.isLastNode ? i.push(a.line.BOTTOM) : i.push(a.line.CENTER) : i.push(a.line.NOLINE),
                e.isParent ? i.push(e.open ? t.consts.folder.OPEN : t.consts.folder.CLOSE) : i.push(a.folder.DOCU),
            this.makeNodeLineClassEx(t, e) + i.join("_")
        },
        makeNodeLineClassEx: function(t, e) {
            return t.consts.className.BUTTON + " " + t.consts.className.LEVEL + e.level + " " + t.consts.className.SWITCH + " x-iconfont "
        },
        setNodeLineIcos: function(t, e) {
            var i, a, n, s;
            e && (i = this.getDOMBySelector(e, t.consts.id.SWITCH, t),
                a = this.getDOMBySelector(e, t.consts.id.UL, t),
                n = this.getDOMBySelector(e, t.consts.id.ICON, t),
                0 === (s = this.makeUlLineClass(t, e)).length ? a.removeClass(t.consts.line.LINE) : a.addClass(s),
                i.attr("class", this.makeNodeLineClass(t, e)),
                e.isParent ? i.removeAttr("disabled") : i.attr("disabled", "disabled"),
                n.removeAttr("style"),
                n.attr("style", this.makeNodeIcoStyle(t, e)),
                n.attr("class", this.makeNodeIcoClass(t, e)))
        },
        cancelPreSelectedNode: function(t, e) {
            for (var i = this.root.curSelectedList, a = i.length - 1; 0 <= a; a--)
                if ((!e || e === i[a]) && (this.getDOMBySelector(i[a], t.consts.id.A, t).removeClass(t.consts.node.CURSELECTED),
                    e)) {
                    this.removeSelectedNode(t, e);
                    break
                }
            e || (this.root.curSelectedList = [])
        },
        getNodeMainDom: function(t) {
            return $(t).parent("li").get(0) || $(t).parentsUntil("li").parent().get(0)
        },
        getMDom: function(t, e, i) {
            if (!e)
                return null;
            for (; e && e.id !== t.treeId; ) {
                for (var a = 0, n = i.length; e.tagName && a < n; a++)
                    if (e.tagName == i[a].tagName && null !== e.getAttribute(i[a].attrName))
                        return e;
                e = e.parentNode
            }
            return null
        },
        getNodeName: function(t, e) {
            return "" + e[t.data.key.name]
        },
        getNodeTitle: function(t, e) {
            var i = t.data.key.title;
            return i && e[i] || (i = t.data.key.name),
            "" + e[i]
        },
        makeDOMNodeIcon: function(t, e, i) {
            var a = this.getNodeName(e, i)
                , n = e.view.nameIsHTML ? a : a.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            t.push("<i id='", i.tId, e.consts.id.ICON, "' title='' treeNode", e.consts.id.ICON, " class='", this.makeNodeIcoClass(e, i), "' style='", this.makeNodeIcoStyle(e, i), "'></i><span id='", i.tId, e.consts.id.SPAN, "'>", n, "</span>")
        },
        makeDOMNodeLine: function(t, e, i) {
            t.push("<i id='", i.tId, e.consts.id.SWITCH, "' title='' class='", this.makeNodeLineClass(e, i), "' treeNode", e.consts.id.SWITCH, "></i>")
        },
        makeDOMNodeMainAfter: function(t, e, i) {
            t.push("</li>")
        },
        makeDOMNodeMainBefore: function(t, e, i) {
            t.push("<li id='", i.tId, "' class='", e.consts.className.LEVEL, i.level, "' tabindex='0' hidefocus='true' treenode>")
        },
        makeDOMNodeNameAfter: function(t, e, i) {
            t.push("</a>")
        },
        makeDOMNodeNameBefore: function(t, e, i) {
            var a = this.getNodeTitle(e, i)
                , n = this.makeNodeUrl(e, i)
                , s = this.makeNodeFontCss(e, i)
                , r = [];
            for (var o in s)
                r.push(o, ":", s[o], ";");
            t.push("<a id='", i.tId, e.consts.id.A, "' class='", e.consts.className.LEVEL, i.level, "' treeNode", e.consts.id.A, ' onclick="', i.click || "", '" ', null != n && 0 < n.length ? "href='" + n + "'" : "", " target='", this.makeNodeTarget(i), "' style='", r.join(""), "'"),
            FX.Utils.applyFunc(this, e.view.showTitle, [i], e.view.showTitle) && a && t.push("title='", a.replace(/'/g, "&#39;").replace(/</g, "&lt;").replace(/>/g, "&gt;"), "'"),
                t.push(">")
        },
        makeNodeFontCss: function(t, e) {
            var i = FX.Utils.applyFunc(this, t.view.fontCss, [e], t.view.fontCss);
            return i && "function" != typeof i ? i : {}
        },
        makeNodeIcoClass: function(t, e) {
            var i = ["ico"];
            return e.isAjaxing || (i[0] = (e.iconSkin ? e.iconSkin + "_" : "") + i[0],
                e.isParent ? i.push(e.open ? t.consts.folder.OPEN : t.consts.folder.CLOSE) : i.push(t.consts.folder.DOCU)),
            t.consts.className.BUTTON + " " + i.join("_") + " x-iconfont"
        },
        makeNodeTarget: function(t) {
            return t.target || "_blank"
        },
        makeNodeUrl: function(t, e) {
            var i = t.data.key.url;
            return e[i] ? e[i] : null
        },
        setFirstNode: function(t, e) {
            var i = t.data.key.children;
            0 < e[i].length && (e[i][0].isFirstNode = !0)
        },
        setLastNode: function(t, e) {
            var i = t.data.key.children
                , a = e[i].length;
            0 < a && (e[i][a - 1].isLastNode = !0)
        },
        removeNode: function(t, e) {
            var i = t.data.key.children
                , a = e.parentTId ? e.getParentNode() : null;
            if (e.isFirstNode = !1,
                e.isLastNode = !1,
                e.getPreNode = function() {
                    return null
                }
                ,
                e.getNextNode = function() {
                    return null
                }
                ,
                this.getNodeCache(e.tId)) {
                if (this.removeNodeCache(t, e),
                    this.removeSelectedNode(t, e),
                    a)
                    for (var n = 0, s = a[i].length; n < s; n++)
                        if (a[i][n].tId == e.tId) {
                            a[i].splice(n, 1);
                            break
                        }
                var r = this.getDOMBySelector(e, "");
                r && 0 < r.length && r.remove()
            }
        },
        replaceIcoClass: function(t, e, i) {
            if (e && !t.isAjaxing) {
                var a = e.attr("class");
                if (null != a) {
                    var n = a.split("_")
                        , s = this.options.setting;
                    switch (i) {
                        case s.consts.folder.OPEN:
                        case s.consts.folder.CLOSE:
                        case s.consts.folder.DOCU:
                            n[n.length - 1] = i
                    }
                    e.attr("class", n.join("_") + " x-iconfont")
                }
            }
        },
        replaceSwitchClass: function(t, e, i) {
            if (e) {
                var a = e.attr("class");
                if (null != a) {
                    var n = a.split("_")
                        , s = this.options.setting;
                    switch (i) {
                        case s.consts.line.ROOT:
                        case s.consts.line.ROOTS:
                        case s.consts.line.CENTER:
                        case s.consts.line.BOTTOM:
                        case s.consts.line.NOLINE:
                            n[0] = this.makeNodeLineClassEx(t) + i;
                            break;
                        case s.consts.folder.OPEN:
                        case s.consts.folder.CLOSE:
                        case s.consts.folder.DOCU:
                            n[1] = i
                    }
                    e.attr("class", n.join("_")),
                        i !== s.consts.folder.DOCU ? e.removeAttr("disabled") : e.attr("disabled", "disabled")
                }
            }
        },
        selectNode: function(t, e) {
            var i = this.options.setting;
            e || this.cancelPreSelectedNode(i),
                this.getDOMBySelector(t, i.consts.id.A, i).addClass(i.consts.node.CURSELECTED),
                this.addSelectedNode(i, t)
        },
        setNodeFontCss: function(t, e) {
            var i = this.getDOMBySelector(e, t.consts.id.A, t)
                , a = this.makeNodeFontCss(t, e);
            a && i.css(a)
        },
        setNodeName: function(t, e) {
            var i = this.getNodeTitle(t, e)
                , a = this.getDOMBySelector(e, t.consts.id.SPAN, t);
            a.empty(),
                t.view.nameIsHTML ? a.html(this.getNodeName(t, e)) : a.text(this.getNodeName(t, e)),
            FX.Utils.applyFunc(this, t.view.showTitle, [e], t.view.showTitle) && this.getDOMBySelector(e, t.consts.id.A, t).attr("title", i || "")
        },
        setNodeTarget: function(t, e) {
            this.getDOMBySelector(e, t.consts.id.A, t).attr("target", this.makeNodeTarget(e))
        },
        setNodeUrl: function(t, e) {
            var i = this.getDOMBySelector(e, t.consts.id.A, t)
                , a = this.makeNodeUrl(t, e);
            null == a || 0 === a.length ? i.removeAttr("href") : i.attr("href", a)
        },
        switchNode: function(t, e) {
            if (e.open || !this.canAsync(t, e))
                this.expandCollapseNode(t, e, !e.open);
            else if (t.async.enable) {
                if (!this.asyncNode(t, e))
                    return void this.expandCollapseNode(t, e, !e.open)
            } else
                e && this.expandCollapseNode(t, e, !e.open)
        }
    }),
        FX.EventTree = FX.extend(FX.DomTree, {
            bindTree: function(t) {
                var e = this.element
                    , a = this;
                t.view.txtSelectedEnable || e.bind("selectstart", function(t) {
                    var e = t.originalEvent.srcElement.nodeName.toLowerCase();
                    return "input" === e || "textarea" === e
                }).css({
                    "-mo-user-select": "-mo-none"
                });
                function i(t) {
                    var e = a.doProxy(t)
                        , i = !0;
                    return e && (e.nodeEventCallback && (i = e.nodeEventCallback.apply(a, [t, e.node]) && i),
                    e.treeEventCallback && (i = e.treeEventCallback.apply(a, [t, e.node]) && i)),
                        i
                }
                e.bind("click", i).bind("dblclick", i).bind("mouseover", i).bind("mouseout", i).bind("mousedown", i).bind("mouseup", i).bind("contextmenu", i)
            },
            doProxy: function(t) {
                var e = t.target
                    , i = this.options.setting
                    , a = ""
                    , n = null
                    , s = ""
                    , r = ""
                    , o = null
                    , l = null
                    , c = null;
                if ("mousedown" == t.type ? r = "mousedown" : "mouseup" == t.type ? r = "mouseup" : "contextmenu" == t.type ? r = "contextmenu" : "click" == t.type ? "I" != e.tagName && "SPAN" != e.tagName || null === e.getAttribute("treeNode" + i.consts.id.SWITCH) ? (c = this.getMDom(i, e, [{
                    tagName: "A",
                    attrName: "treeNode" + i.consts.id.A
                }])) && (a = this.getNodeMainDom(c).id,
                    s = "clickNode") : (a = this.getNodeMainDom(e).id,
                    s = "switchNode") : "dblclick" == t.type && (r = "dblclick",
                (c = this.getMDom(i, e, [{
                    tagName: "A",
                    attrName: "treeNode" + i.consts.id.A
                }])) && (a = this.getNodeMainDom(c).id,
                    s = "switchNode")),
                0 < r.length && 0 === a.length && (c = this.getMDom(i, e, [{
                    tagName: "A",
                    attrName: "treeNode" + i.consts.id.A
                }])) && (a = this.getNodeMainDom(c).id),
                0 < a.length)
                    switch (n = this.getNodeCache(a),
                        s) {
                        case "switchNode":
                            n.isParent && ("click" == t.type || "dblclick" == t.type && FX.Utils.applyFunc(this, i.view.dblClickExpand, [n], i.view.dblClickExpand)) ? o = this.onSwitchNode : s = "";
                            break;
                        case "clickNode":
                            o = this.onClickNode
                    }
                switch (r) {
                    case "mousedown":
                        l = this.onTreeMousedown;
                        break;
                    case "mouseup":
                        l = this.onTreeMouseup;
                        break;
                    case "dblclick":
                        l = this.onTreeDblclick;
                        break;
                    case "contextmenu":
                        l = this.onTreeContextmenu
                }
                return {
                    node: n,
                    nodeEventType: s,
                    nodeEventCallback: o,
                    treeEventType: r,
                    treeEventCallback: l
                }
            },
            bindEvent: function(s) {
                var t = this.element
                    , e = s.consts.event
                    , r = this;
                t.bind(e.NODECREATED, function(t, e) {
                    FX.Utils.applyFunc(r, s.callback.onNodeCreated, [t, e])
                }),
                    t.bind(e.CLICK, function(t, e, i, a) {
                        FX.Utils.applyFunc(r, s.callback.onClick, [e, i, a])
                    }),
                    t.bind(e.EXPAND, function(t, e) {
                        FX.Utils.applyFunc(r, s.callback.onExpand, [t, e])
                    }),
                    t.bind(e.COLLAPSE, function(t, e) {
                        FX.Utils.applyFunc(r, s.callback.onCollapse, [t, e])
                    }),
                    t.bind(e.ASYNC_SUCCESS, function(t, e, i) {
                        FX.Utils.applyFunc(r, s.callback.onAsyncSuccess, [t, e, i])
                    }),
                    t.bind(e.ASYNC_ERROR, function(t, e, i, a, n) {
                        FX.Utils.applyFunc(r, s.callback.onAsyncError, [t, e, i, a, n])
                    })
            },
            unbindTree: function() {
                var t = this.element
                    , e = this.options.setting.consts.event;
                t.unbind("click").unbind("dblclick").unbind("mouseover").unbind("mouseout").unbind("mousedown").unbind("mouseup").unbind("contextmenu").unbind(e.NODECREATED).unbind(e.CLICK).unbind(e.EXPAND).unbind(e.COLLAPSE).unbind(e.ASYNC_SUCCESS).unbind(e.ASYNC_ERROR).unbind(e.CHECK)
            },
            onSwitchNode: function(t, e) {
                var i = this.options.setting;
                if (e.open) {
                    if (!1 === FX.Utils.applyFunc(this, i.callback.beforeCollapse, [e], !0))
                        return !0
                } else if (!1 === FX.Utils.applyFunc(this, i.callback.beforeExpand, [e], !0))
                    return !0;
                return this.root.expandTriggerFlag = !0,
                    this.switchNode(i, e),
                    !0
            },
            onClickNode: function(t, e) {
                var i = this.options.setting
                    , a = i.view.autoCancelSelected && (t.ctrlKey || t.metaKey) && this.isSelectedNode(i, e) ? 0 : i.view.autoCancelSelected && (t.ctrlKey || t.metaKey) && i.view.selectedMulti ? 2 : 1;
                return !1 === FX.Utils.applyFunc(this, i.callback.beforeClick, [e, a], !0) || (0 == a ? this.cancelPreSelectedNode(i, e) : this.selectNode(e, 2 == a),
                    i.treeObj.trigger(i.consts.event.CLICK, [t, e, a])),
                    !0
            },
            onTreeMousedown: function(t, e) {
                var i = this.options.setting;
                return FX.Utils.applyFunc(this, i.callback.beforeMouseDown, [e], !0) && FX.Utils.applyFunc(this, i.callback.onMouseDown, [t, e]),
                    !0
            },
            onTreeMouseup: function(t, e) {
                var i = this.options.setting;
                return FX.Utils.applyFunc(this, i.callback.beforeMouseUp, [e], !0) && FX.Utils.applyFunc(this, i.callback.onMouseUp, [t, e]),
                    !0
            },
            onTreeDblclick: function(t, e) {
                var i = this.options.setting;
                return FX.Utils.applyFunc(this, i.callback.beforeDblClick, [e], !0) && FX.Utils.applyFunc(this, i.callback.onDblClick, [t, e]),
                    !0
            },
            onTreeContextmenu: function(t, e) {
                var i = this.options.setting;
                return FX.Utils.applyFunc(this, i.callback.beforeRightClick, [e], !0) && FX.Utils.applyFunc(this, i.callback.onRightClick, [t, e]),
                "function" != typeof i.callback.onRightClick
            },
            createNodeCallback: function(t) {
                if (t.callback.onNodeCreated || t.view.addDiyDom)
                    for (var e = this.root; 0 < e.createdNodes.length; ) {
                        var i = e.createdNodes.shift();
                        FX.Utils.applyFunc(this, t.view.addDiyDom, [i]),
                        t.callback.onNodeCreated && t.treeObj.trigger(t.consts.event.NODECREATED, [i])
                    }
            },
            getAfterA: function(t, e, i) {
                this.afterA && this.afterA.apply(this, arguments)
            },
            getBeforeA: function(t, e, i) {
                this.beforeA && this.beforeA.apply(this, arguments)
            },
            getInnerAfterA: function(t, e, i) {
                this.innerAfterA && this.innerAfterA.apply(this, arguments)
            },
            getInnerBeforeA: function(t, e, i) {
                this.innerBeforeA && this.innerBeforeA.apply(this, arguments)
            }
        }),
        FX.DataTree = FX.extend(FX.EventTree, {
            addNodeCache: function(t, e) {
                this.cache.nodes[this.getNodeCacheId(e.tId)] = e
            },
            getNodeCacheId: function(t) {
                return t.substring(t.lastIndexOf("_") + 1)
            },
            getNodeCache: function(t) {
                if (!t)
                    return null;
                var e = this.cache.nodes[this.getNodeCacheId(t)];
                return e || null
            },
            canAsync: function(t, e) {
                var i = t.data.key.children;
                return t.async.enable && e && e.isParent && !(e.Async || e[i] && 0 < e[i].length)
            },
            asyncNode: function(setting, node, isSilent, callback) {
                var i, l, self = this, icoObj;
                if (node && !node.isParent)
                    return FX.Utils.applyFunc(this, callback),
                        !1;
                if (node && node.isAjaxing)
                    return !1;
                if (!1 === FX.Utils.applyFunc(this, setting.callback.beforeasyncNode, [node], !0))
                    return FX.Utils.applyFunc(this, callback),
                        !1;
                node && (node.isAjaxing = !0,
                    icoObj = this.getDOMBySelector(node, setting.consts.id.ICON, setting),
                    icoObj.attr({
                        style: "",
                        class: setting.consts.className.BUTTON + " " + setting.consts.className.ICO_LOADING + " x-iconfont"
                    }));
                for (var tmpParam = {}, i = 0, l = setting.async.autoParam.length; node && i < l; i++) {
                    var pKey = setting.async.autoParam[i].split("=")
                        , spKey = pKey;
                    1 < pKey.length && (spKey = pKey[1],
                        pKey = pKey[0]),
                        tmpParam[spKey] = node[pKey]
                }
                if (FX.Utils.isArray(setting.async.otherParam))
                    for (i = 0,
                             l = setting.async.otherParam.length; i < l; i += 2)
                        tmpParam[setting.async.otherParam[i]] = setting.async.otherParam[i + 1];
                else
                    for (var p in setting.async.otherParam)
                        tmpParam[p] = setting.async.otherParam[p];
                var _tmpV = this.root._ver;
                return FX.Utils.ajax({
                    url: FX.Utils.applyFunc(this, setting.async.url, [node], setting.async.url),
                    data: tmpParam
                }, function(msg) {
                    if (_tmpV == self.root._ver) {
                        var newNodes = [];
                        try {
                            newNodes = msg && 0 !== msg.length ? "string" == typeof msg ? eval("(" + msg + ")") : msg : []
                        } catch (t) {
                            newNodes = msg
                        }
                        node && (node.isAjaxing = null,
                            node.Async = !0),
                            self.setNodeLineIcos(setting, node),
                            newNodes && "" !== newNodes ? (newNodes = FX.Utils.applyFunc(this, setting.async.dataFilter, [node, newNodes], newNodes),
                                self.addNodes(setting, node, newNodes ? newNodes.slice(0) : [], !!isSilent)) : self.addNodes(setting, node, [], !!isSilent),
                            setting.treeObj.trigger(setting.consts.event.ASYNC_SUCCESS, [node, msg]),
                            FX.Utils.applyFunc(this, callback)
                    }
                }, function(t, e, i) {
                    _tmpV == self.root._ver && (node && (node.isAjaxing = null),
                        self.setNodeLineIcos(setting, node),
                        setting.treeObj.trigger(setting.consts.event.ASYNC_ERROR, [node, t, e, i]))
                }),
                    !0
            },
            addNodesData: function(t, e, i) {
                var a = t.data.key.children;
                e[a] || (e[a] = []),
                0 < e[a].length && (e[a][e[a].length - 1].isLastNode = !1,
                    this.setNodeLineIcos(t, e[a][e[a].length - 1])),
                    e.isParent = !0,
                    e[a] = e[a].concat(i)
            },
            addSelectedNode: function(t, e) {
                var i = this.root;
                this.isSelectedNode(t, e) || i.curSelectedList.push(e)
            },
            addCreatedNode: function(t, e) {
                (t.callback.onNodeCreated || t.view.addDiyDom) && this.root.createdNodes.push(e)
            },
            fixPIdKeyValue: function(t, e) {
                t.data.simpleData.enable && (e[t.data.simpleData.pIdKey] = e.parentTId ? e.getParentNode()[t.data.simpleData.idKey] : t.data.simpleData.rootPId)
            },
            getNextNode: function(t, e) {
                if (!e)
                    return null;
                for (var i = t.data.key.children, a = e.parentTId ? e.getParentNode() : this.root, n = 0, s = a[i].length - 1; n <= s; n++)
                    if (a[i][n] === e)
                        return n == s ? null : a[i][n + 1];
                return null
            },
            getNodeByParam: function(t, e, i, a) {
                if (!e || !i)
                    return null;
                for (var n = t.data.key.children, s = 0, r = e.length; s < r; s++) {
                    if (e[s][i] == a)
                        return e[s];
                    var o = this.getNodeByParam(t, e[s][n], i, a);
                    if (o)
                        return o
                }
                return null
            },
            getNodesByParam: function(t, e, i, a) {
                if (!e || !i)
                    return [];
                for (var n = t.data.key.children, s = [], r = 0, o = e.length; r < o; r++)
                    e[r][i] == a && s.push(e[r]),
                        s = s.concat(this.getNodesByParam(t, e[r][n], i, a));
                return s
            },
            getNodes: function() {
                return this.root[this.options.setting.data.key.children]
            },
            getNodesByParamFuy: function(t, e, i, a) {
                if (!e || !i)
                    return [];
                var n = t.data.key.children
                    , s = [];
                a = a.toLowerCase();
                for (var r = 0, o = e.length; r < o; r++)
                    "string" == typeof e[r][i] && -1 < e[r][i].toLowerCase().indexOf(a) && s.push(e[r]),
                        s = s.concat(this.getNodesByParamFuy(t, e[r][n], i, a));
                return s
            },
            getNodesByFilter: function(t, e, i, a, n) {
                if (!e)
                    return a ? null : [];
                for (var s = t.data.key.children, r = a ? null : [], o = 0, l = e.length; o < l; o++) {
                    if (FX.Utils.applyFunc(this, i, [e[o], n], !1)) {
                        if (a)
                            return e[o];
                        r.push(e[o])
                    }
                    var c = this.getNodesByFilter(t, e[o][s], i, a, n);
                    if (a && c)
                        return c;
                    r = a ? c : r.concat(c)
                }
                return r
            },
            getPreNode: function(t, e) {
                if (!e)
                    return null;
                for (var i = t.data.key.children, a = e.parentTId ? e.getParentNode() : this.root, n = 0, s = a[i].length; n < s; n++)
                    if (a[i][n] === e)
                        return 0 === n ? null : a[i][n - 1];
                return null
            },
            isSelectedNode: function(t, e) {
                for (var i = this.root, a = 0, n = i.curSelectedList.length; a < n; a++)
                    if (e === i.curSelectedList[a])
                        return !0;
                return !1
            },
            removeNodeCache: function(t, e) {
                var i = t.data.key.children;
                if (e[i])
                    for (var a = 0, n = e[i].length; a < n; a++)
                        arguments.callee(t, e[i][a]);
                this.cache.nodes[this.getNodeCacheId(e.tId)] = null
            },
            removeSelectedNode: function(t, e) {
                for (var i = this.root, a = 0, n = i.curSelectedList.length; a < n; a++)
                    e !== i.curSelectedList[a] && this.getNodeCache(i.curSelectedList[a].tId) || (i.curSelectedList.splice(a, 1),
                        a--,
                        n--)
            },
            expandAll: function(t) {
                t = !!t;
                var e = this.options.setting;
                return this.expandCollapseSonNode(e, null, t, !0),
                    t
            },
            expandNode: function(t, e, i, a, n) {
                var s = this.options.setting;
                return t && t.isParent ? (!0 !== e && !1 !== e && (e = !t.open),
                    (n = !!n) && e && !1 === FX.Utils.applyFunc(this, s.callback.beforeExpand, [t], !0) || n && !e && !1 === FX.Utils.applyFunc(this, s.callback.beforeCollapse, [t], !0) ? null : (e && t.parentTId && this.expandCollapseParentNode(s, t.getParentNode(), e, !1),
                        e !== t.open || i ? (this.root.expandTriggerFlag = n,
                            !this.canAsync(s, t) && i ? this.expandCollapseSonNode(s, t, e, !0, function() {}) : (t.open = !e,
                                this.switchNode(this.options.setting, t)),
                            e) : null)) : null
            },
            getNodeByTId: function(t) {
                return this.getNodeCache(t)
            },
            getNodeIndex: function(t) {
                if (!t)
                    return null;
                for (var e = this.options.setting.data.key.children, i = t.parentTId ? t.getParentNode() : this.root, a = 0, n = i[e].length; a < n; a++)
                    if (i[e][a] == t)
                        return a;
                return -1
            },
            getSelectedNodes: function() {
                for (var t = [], e = this.root.curSelectedList, i = 0, a = e.length; i < a; i++)
                    t.push(e[i]);
                return t
            },
            reAsyncChildNodes: function(t, e, i) {
                if (this.options.setting.async.enable) {
                    var a = !t
                        , n = this.options.setting;
                    if (a && (t = this.root),
                    "refresh" == e) {
                        for (var s = this.options.setting.data.key.children, r = 0, o = t[s] ? t[s].length : 0; r < o; r++)
                            this.removeNodeCache(n, t[s][r]);
                        this.removeSelectedNode(n),
                            t[s] = [],
                            a ? this.options.setting.treeObj.empty() : this.getDOMBySelector(t, n.consts.id.UL, n).empty()
                    }
                    this.asyncNode(this.options.setting, a ? null : t, !!i)
                }
            },
            refresh: function() {
                this.options.setting.treeObj.empty();
                var t = this.root
                    , e = this.options.setting
                    , i = t[e.data.key.children];
                this.initRoot(e),
                    t[e.data.key.children] = i,
                    this.initCache(),
                    this.createNodes(e, 0, t[e.data.key.children])
            },
            updateNode: function(t, e) {
                var i;
                t && (i = this.options.setting,
                this.getDOMBySelector(t, i).get(0) && (this.setNodeName(i, t),
                    this.setNodeTarget(i, t),
                    this.setNodeUrl(i, t),
                    this.setNodeLineIcos(i, t),
                    this.setNodeFontCss(i, t)))
            },
            transformToArrayFormat: function(t, e) {
                if (!e)
                    return [];
                var i = t.data.key.children
                    , a = [];
                if (FX.Utils.isArray(e))
                    for (var n = 0, s = e.length; n < s; n++)
                        a.push(e[n]),
                        e[n][i] && (a = a.concat(this.transformToArrayFormat(t, e[n][i])));
                else
                    a.push(e),
                    e[i] && (a = a.concat(this.transformToArrayFormat(t, e[i])));
                return a
            },
            transformToTreeFormat: function(t, e) {
                var i = t.data.simpleData.idKey
                    , a = t.data.simpleData.pIdKey
                    , n = t.data.key.children;
                if (!i || "" == i || !e)
                    return [];
                if (FX.Utils.isArray(e)) {
                    for (var s = [], r = [], o = 0, l = e.length; o < l; o++)
                        r[e[o][i]] = e[o];
                    for (o = 0,
                             l = e.length; o < l; o++)
                        r[e[o][a]] && e[o][i] != e[o][a] ? (r[e[o][a]][n] || (r[e[o][a]][n] = []),
                        r[e[o][a]][n].indexOf(e[o]) < 0 && r[e[o][a]][n].push(e[o])) : s.push(e[o]);
                    return s
                }
                return [e]
            }
        }),
        FX.BaseTree = FX.extend(FX.DataTree, {
            _defaultConfig: function() {
                return $.extend(FX.BaseTree.superclass._defaultConfig.apply(), {
                    baseCls: "fui_tree"
                })
            },
            _init: function() {
                FX.BaseTree.superclass._init.apply(this, arguments);
                var t = this.options;
                t.setting = this._doSettingConfig(),
                    this._createRoot(t.setting);
                var e = t.setting;
                this.root = this.initRoot(e);
                var i = e.data.key.children
                    , a = [];
                t.Nodes && (a = FX.Utils.isArray(t.Nodes) ? t.Nodes.slice(0) : [t.Nodes].slice(0)),
                    t.setting.data.simpleData.enable ? this.root[i] = this.transformToTreeFormat(e, a) : this.root[i] = a,
                    this.initCache(),
                    this.bindTree(e),
                    this.bindEvent(e),
                    this.root[i] && 0 < this.root[i].length ? this.createNodes(e, 0, this.root[i]) : e.async.enable && e.async.url && "" !== e.async.url && this.asyncNode(e)
            },
            _doSettingConfig: function() {
                var t = this.options;
                return t.setting = $.extend(!0, {}, this.setting, t.setting),
                    t.setting
            },
            _createRoot: function(t) {
                var e = $('<ul id="' + t.treeId + '" class="tree"/>').appendTo(this.element);
                t.treeObj = e
            },
            initRoot: function(t) {
                var e = t ? this.root : null;
                return (e = e || {})[t.data.key.children] = [],
                    e.expandTriggerFlag = !1,
                    e.curSelectedList = [],
                    e.noSelection = !0,
                    e.createdNodes = [],
                    e.radioCheckedList = [],
                    e.Id = 0,
                    e._ver = (new Date).getTime(),
                    e
            },
            initCache: function() {
                this.cache = this.cache || {},
                    this.cache.nodes = [],
                    this.cache.doms = []
            },
            initNode: function(t, e, i, a, n, s, r) {
                var o, l, c;
                i && (o = this.root,
                    l = t.data.key.children,
                    c = this,
                    i.level = e,
                    i.tId = t.treeId + "_" + ++o.Id,
                    i.parentTId = a ? a.tId : null,
                    i.open = "string" == typeof i.open ? "true" == i.open.toLowerCase() : !!i.open,
                    i[l] && 0 < i[l].length ? (i.isParent = !0,
                        i.Async = !0) : (i.isParent = "string" == typeof i.isParent ? "true" == i.isParent.toLowerCase() : !!i.isParent,
                        i.open = !(!i.isParent || t.async.enable) && i.open,
                        i.Async = !i.isParent),
                    i.isFirstNode = n,
                    i.isLastNode = s,
                    i.getParentNode = function() {
                        return c.getNodeCache(i.parentTId)
                    }
                    ,
                    i.getPreNode = function() {
                        return c.getPreNode(t, i)
                    }
                    ,
                    i.getNextNode = function() {
                        return c.getNextNode(t, i)
                    }
                    ,
                    i.isAjaxing = !1,
                    this.fixPIdKeyValue(t, i))
            },
            addNodes: function(t, e, i, a) {
                var n, s, r;
                t.data.keep.leaf && e && !e.isParent || (FX.Utils.isArray(i) || (i = [i]),
                t.data.simpleData.enable && (i = this.transformToTreeFormat(t, i)),
                    e ? (n = this.getDOMBySelector(e, t.consts.id.SWITCH, t),
                        s = this.getDOMBySelector(e, t.consts.id.ICON, t),
                        r = this.getDOMBySelector(e, t.consts.id.UL, t),
                    e.open || (this.replaceSwitchClass(e, n, t.consts.folder.CLOSE),
                        this.replaceIcoClass(e, s, t.consts.folder.CLOSE),
                        e.open = !1,
                        r.css({
                            display: "none"
                        })),
                        this.addNodesData(t, e, i),
                        this.createNodes(t, e.level + 1, i, e),
                    a || this.expandCollapseParentNode(t, e, !0)) : (this.addNodesData(t, this.root, i),
                        this.createNodes(t, 0, i, null)))
            },
            appendNodes: function(t, e, i, a, n, s) {
                if (!i)
                    return [];
                for (var r = [], o = t.data.key.children, l = 0, c = i.length; l < c; l++) {
                    var d, u, h = i[l];
                    FX.Utils.applyFunc(this, t.callback.beforeNodeCreate, [h], !0),
                    n && (d = (a || this.root)[o].length == i.length && 0 === l,
                        u = l == i.length - 1,
                        this.initNode(t, e, h, a, d, u, s),
                        this.addNodeCache(t, h));
                    var p = [];
                    h[o] && 0 < h[o].length && (p = this.appendNodes(t, e + 1, h[o], h, n, s && h.open)),
                    s && (this.makeDOMNodeMainBefore(r, t, h),
                        this.getBeforeA(t, h, r),
                        this.makeDOMNodeNameBefore(r, t, h),
                        this.makeDOMNodeLine(r, t, h),
                        this.getInnerBeforeA(t, h, r),
                        this.makeDOMNodeIcon(r, t, h),
                        this.getInnerAfterA(t, h, r),
                        this.makeDOMNodeNameAfter(r, t, h),
                        this.getAfterA(t, h, r),
                    h.isParent && h.open && this.makeUlHtml(t, h, r, p.join("")),
                        this.makeDOMNodeMainAfter(r, t, h),
                        this.addCreatedNode(t, h))
                }
                return r
            },
            createNodes: function(t, e, i, a) {
                var n, s, r, o, l;
                i && 0 !== i.length && (n = this.root,
                    s = t.data.key.children,
                    r = !a || a.open || !!this.getDOMBySelector(a[s][0], t).get(0),
                    n.createdNodes = [],
                    o = this.appendNodes(t, e, i, a, !0, r),
                    a ? (l = this.getDOMBySelector(a, t.consts.id.UL, t)).get(0) && l.append(o.join("")) : t.treeObj.append(o.join("")),
                    this.createNodeCallback(t))
            },
            expandCollapseNode: function(t, e, i, a, n) {
                var s, r, o, l, c = this.root, d = t.data.key.children;
                e ? (c.expandTriggerFlag && (s = n,
                    n = function() {
                        s && s(),
                            e.open ? t.treeObj.trigger(t.consts.event.EXPAND, [e]) : t.treeObj.trigger(t.consts.event.COLLAPSE, [e])
                    }
                    ,
                    c.expandTriggerFlag = !1),
                !e.open && e.isParent && (!this.getDOMBySelector(e, t.consts.id.UL, t).get(0) || e[d] && 0 < e[d].length && !this.getDOMBySelector(e[d][0], t).get(0)) && (this.appendParentULDom(t, e),
                    this.createNodeCallback(t)),
                    e.open != i ? (r = this.getDOMBySelector(e, t.consts.id.UL, t),
                        o = this.getDOMBySelector(e, t.consts.id.SWITCH, t),
                        l = this.getDOMBySelector(e, t.consts.id.ICON, t),
                        e.isParent ? (e.open = !e.open,
                        e.iconOpen && e.iconClose && l.attr("style", this.makeNodeIcoStyle(t, e)),
                            e.open ? (this.replaceSwitchClass(e, o, t.consts.folder.OPEN),
                                this.replaceIcoClass(e, l, t.consts.folder.OPEN),
                                !1 !== a && "" != t.view.expandSpeed && e[d] && 0 < e[d].length ? r.slideDown(t.view.expandSpeed, n) : (r.show(),
                                    FX.Utils.applyFunc(this, n, []))) : (this.replaceSwitchClass(e, o, t.consts.folder.CLOSE),
                                this.replaceIcoClass(e, l, t.consts.folder.CLOSE),
                                !1 !== a && "" != t.view.expandSpeed && e[d] && 0 < e[d].length ? r.slideUp(t.view.expandSpeed, n) : (r.hide(),
                                    FX.Utils.applyFunc(this, n, [])))) : FX.Utils.applyFunc(this, n, [])) : FX.Utils.applyFunc(this, n, [])) : FX.Utils.applyFunc(this, n, [])
            },
            expandCollapseParentNode: function(t, e, i, a, n) {
                e && (e.parentTId ? (this.expandCollapseNode(t, e, i, a),
                e.parentTId && this.expandCollapseParentNode(t, e.getParentNode(), i, a, n)) : this.expandCollapseNode(t, e, i, a, n))
            },
            expandCollapseSonNode: function(t, e, i, a, n) {
                var s = t.data.key.children
                    , r = e ? e[s] : this.root[s]
                    , o = !e && a
                    , l = this.root.expandTriggerFlag;
                if (this.root.expandTriggerFlag = !1,
                    r)
                    for (var c = 0, d = r.length; c < d; c++)
                        r[c] && this.expandCollapseSonNode(t, r[c], i, o);
                this.root.expandTriggerFlag = l,
                    this.expandCollapseNode(t, e, i, a, n)
            },
            destroy: function(t) {
                t && (this.initCache(),
                    this.initRoot(t),
                    this.unbindTree(t),
                    t.treeObj.empty(),
                    t = void 0)
            }
        })
}(jQuery),
function(t) {
    FX.Tree = FX.extend(FX.BaseTree, {
        initRoot: function(t) {
            var e = FX.Tree.superclass.initRoot.apply(this, arguments);
            return e.radioCheckedList = [],
                e
        },
        bindEvent: function(a) {
            FX.Tree.superclass.bindEvent.apply(this, arguments);
            var t = this.element
                , e = a.consts.event
                , n = this;
            t.bind(e.CHECK, function(t, e, i) {
                FX.Utils.applyFunc(n, a.callback.onCheck, [e || t, i])
            })
        },
        unbindTree: function(t) {
            FX.Tree.superclass.unbindTree.apply(this, arguments);
            var e = this.element
                , i = this.options.setting.consts.event;
            e.unbind(i.CHECK)
        },
        doProxy: function(t) {
            var e = t.target.parentNode
                , i = this.options.setting
                , a = ""
                , n = null
                , s = ""
                , r = null;
            if (i.check.enable && ("mouseover" == t.type ? "SPAN" == e.tagName && null !== e.getAttribute("treeNode" + i.consts.id.CHECK) && (a = this.getNodeMainDom(e).id,
                s = "mouseoverCheck") : "mouseout" == t.type ? "SPAN" == e.tagName && null !== e.getAttribute("treeNode" + i.consts.id.CHECK) && (a = this.getNodeMainDom(e).id,
                s = "mouseoutCheck") : "click" == t.type && "SPAN" == e.tagName && null !== e.getAttribute("treeNode" + i.consts.id.CHECK) && (a = this.getNodeMainDom(e).id,
                s = "checkNode")),
            0 < a.length)
                switch (n = this.getNodeCache(a),
                    s) {
                    case "checkNode":
                        r = this.onCheckNode;
                        break;
                    case "mouseoverCheck":
                        r = this.onMouseoverCheck;
                        break;
                    case "mouseoutCheck":
                        r = this.onMouseoutCheck
                }
            return "" !== s ? {
                node: n,
                nodeEventType: s,
                nodeEventCallback: r,
                treeEventType: "",
                treeEventCallback: null
            } : FX.Tree.superclass.doProxy.apply(this, arguments)
        },
        initNode: function(t, e, i, a, n, s, r) {
            var o;
            FX.Tree.superclass.initNode.apply(this, arguments),
            i && (o = t.data.key.checked,
            "string" == typeof i[o] && (i[o] = "true" == i[o].toLowerCase()),
                i[o] = !!i[o],
                i.checkedOld = i[o],
            "string" == typeof i.nocheck && (i.nocheck = "true" == i.nocheck.toLowerCase()),
                i.nocheck = !!i.nocheck || t.check.nocheckInherit && a && !!a.nocheck,
            "string" == typeof i.chkDisabled && (i.chkDisabled = "true" == i.chkDisabled.toLowerCase()),
                i.chkDisabled = !!i.chkDisabled || t.check.chkDisabledInherit && a && !!a.chkDisabled,
            "string" == typeof i.halfCheck && (i.halfCheck = "true" == i.halfCheck.toLowerCase()),
                i.halfCheck = !!i.halfCheck,
                i.check_Child_State = -1,
                i.check_Focus = !1,
                i.getCheckStatus = function() {
                    return this.getCheckStatus(t, i)
                }
                ,
            t.check.chkStyle == t.consts.radio.STYLE && t.check.radioType == t.consts.radio.TYPE_ALL && i[o] && this.root.radioCheckedList.push(i))
        },
        makeDOMNodeLine: function(t, e, i) {
            FX.Tree.superclass.makeDOMNodeLine.apply(this, arguments),
            e.check.enable && (this.makeChkFlag(e, i),
                t.push("<span ID='", i.tId, e.consts.id.CHECK, "' class='", this.makeChkClass(e, i), "' treeNode", e.consts.id.CHECK, !0 === i.nocheck ? " style='display:none;'" : "", "><i class='x-iconfont'></i></span>"))
        },
        getRadioCheckedList: function(t) {
            for (var e = this.root.radioCheckedList, i = 0, a = e.length; i < a; i++)
                this.getNodeCache(t, e[i].tId) || (e.splice(i, 1),
                    i--,
                    a--);
            return e
        },
        getCheckStatus: function(t, e) {
            if (!t.check.enable || e.nocheck || e.chkDisabled)
                return null;
            var i = t.data.key.checked;
            return {
                checked: e[i],
                half: e.halfCheck ? e.halfCheck : t.check.chkStyle == t.consts.radio.STYLE ? 2 === e.check_Child_State : e[i] ? -1 < e.check_Child_State && e.check_Child_State < 2 : 0 < e.check_Child_State
            }
        },
        getTreeCheckedNodes: function(t, e, i, a) {
            if (!e)
                return [];
            var n = t.data.key.children
                , s = t.data.key.checked
                , r = i && t.check.chkStyle == t.consts.radio.STYLE && t.check.radioType == t.consts.radio.TYPE_ALL;
            a = a || [];
            for (var o = 0, l = e.length; o < l && (!0 === e[o].nocheck || !0 === e[o].chkDisabled || e[o][s] != i || (a.push(e[o]),
                !r)) && (this.getTreeCheckedNodes(t, e[o][n], i, a),
                !(r && 0 < a.length)); o++)
                ;
            return a
        },
        getTreeChangeCheckedNodes: function(t, e, i) {
            if (!e)
                return [];
            var a = t.data.key.children
                , n = t.data.key.checked;
            i = i || [];
            for (var s = 0, r = e.length; s < r; s++)
                !0 !== e[s].nocheck && !0 !== e[s].chkDisabled && e[s][n] != e[s].checkedOld && i.push(e[s]),
                    this.getTreeChangeCheckedNodes(t, e[s][a], i);
            return i
        },
        makeChkFlag: function(t, e) {
            if (e) {
                var i = t.data.key.children
                    , a = t.data.key.checked
                    , n = -1;
                if (e[i])
                    for (var s = 0, r = e[i].length; s < r; s++) {
                        var o = e[i][s]
                            , l = -1;
                        if (t.check.chkStyle == t.consts.radio.STYLE) {
                            if (2 === (l = !0 === o.nocheck || !0 === o.chkDisabled ? o.check_Child_State : !0 === o.halfCheck || o[a] || 0 < o.check_Child_State ? 2 : 0)) {
                                n = 2;
                                break
                            }
                            0 === l && (n = 0)
                        } else if (t.check.chkStyle == t.consts.checkbox.STYLE) {
                            if (1 === (l = !0 === o.nocheck || !0 === o.chkDisabled ? o.check_Child_State : !0 === o.halfCheck ? 1 : o[a] ? -1 === o.check_Child_State || 2 === o.check_Child_State ? 2 : 1 : 0 < o.check_Child_State ? 1 : 0)) {
                                n = 1;
                                break
                            }
                            if (2 === l && -1 < n && 0 < s && l !== n) {
                                n = 1;
                                break
                            }
                            if (2 === n && -1 < l && l < 2) {
                                n = 1;
                                break
                            }
                            -1 < l && (n = l)
                        }
                    }
                e.check_Child_State = n
            }
        },
        checkNode: function(t, e, i, a) {
            var n, s = this.options.setting, r = s.data.key.checked;
            !0 !== t.chkDisabled && (!0 !== e && !1 !== e && (e = !t[r]),
                a = !!a,
            t[r] === e && !i || a && !1 === FX.Utils.applyFunc(this, s.callback.beforeCheck, [t], !0) || s.check.enable && !0 !== t.nocheck && (t[r] = e,
                n = this.getDOMBySelector(t, s.consts.id.CHECK, s),
            !i && s.check.chkStyle !== s.consts.radio.STYLE || this.checkNodeRelation(s, t),
                this.setChkClass(s, n, t),
                this.repairParentChkClassWithSelf(s, t),
            a && s.treeObj.trigger(s.consts.event.CHECK, [null, t])))
        },
        checkAllNodes: function(t) {
            this.repairAllChk(this.options.setting, !!t)
        },
        getCheckedNodes: function(t) {
            var e = this.options.setting.data.key.children;
            return t = !1 !== t,
                this.getTreeCheckedNodes(this.options.setting, this.root[e], t)
        },
        getChangeCheckedNodes: function() {
            var t = this.options.setting.data.key.children;
            return this.getTreeChangeCheckedNodes(this.options.setting, this.root[t])
        },
        setChkDisabled: function(t, e, i, a) {
            e = !!e,
                i = !!i,
                a = !!a,
                this.repairSonChkDisabled(this.options.setting, t, e, a),
                this.repairParentChkDisabled(this.options.setting, t.getParentNode(), e, i)
        },
        onCheckNode: function(t, e) {
            if (!0 === e.chkDisabled)
                return !1;
            var i = this.options.setting
                , a = i.data.key.checked;
            if (!1 === FX.Utils.applyFunc(this, i.callback.beforeCheck, [e], !0))
                return !0;
            e[a] = !e[a],
                this.checkNodeRelation(i, e);
            var n = this.getDOMBySelector(e, i.consts.id.CHECK, i);
            return this.setChkClass(i, n, e),
                this.repairParentChkClassWithSelf(i, e),
                i.treeObj.trigger(i.consts.event.CHECK, [t, e]),
                !0
        },
        onMouseoverCheck: function(t, e) {
            if (!0 === e.chkDisabled)
                return !1;
            var i = this.options.setting
                , a = this.getDOMBySelector(e, i.consts.id.CHECK, i);
            return e.check_Focus = !0,
                this.setChkClass(i, a, e),
                !0
        },
        onMouseoutCheck: function(t, e) {
            if (!0 === e.chkDisabled)
                return !1;
            var i = this.options.setting
                , a = this.getDOMBySelector(e, i.consts.id.CHECK, i);
            return e.check_Focus = !1,
                this.setChkClass(i, a, e),
                !0
        },
        checkNodeRelation: function(t, e) {
            var i, a = t.data.key.children, n = t.data.key.checked, s = t.consts.radio;
            if (t.check.chkStyle == s.STYLE) {
                var r = this.getRadioCheckedList(t);
                if (e[n])
                    if (t.check.radioType == s.TYPE_ALL) {
                        for (l = r.length - 1; 0 <= l; l--)
                            (i = r[l])[n] = !1,
                                r.splice(l, 1),
                                this.setChkClass(t, this.getDOMBySelector(i, t.consts.id.CHECK, t), i),
                            i.parentTId != e.parentTId && this.repairParentChkClassWithSelf(t, i);
                        r.push(e)
                    } else
                        for (var o = e.parentTId ? e.getParentNode() : this.root, l = 0, c = o[a].length; l < c; l++)
                            (i = o[a][l])[n] && i != e && (i[n] = !1,
                                this.setChkClass(t, this.getDOMBySelector(i, t.consts.id.CHECK, t), i));
                else if (t.check.radioType == s.TYPE_ALL)
                    for (l = 0,
                             c = r.length; l < c; l++)
                        if (e == r[l]) {
                            r.splice(l, 1);
                            break
                        }
            } else
                e[n] && (!e[a] || 0 === e[a].length || -1 < t.check.chkboxType.Y.indexOf("s")) && this.setSonNodeCheckBox(t, e, !0),
                e[n] || e[a] && 0 !== e[a].length && !(-1 < t.check.chkboxType.N.indexOf("s")) || this.setSonNodeCheckBox(t, e, !1),
                e[n] && -1 < t.check.chkboxType.Y.indexOf("p") && this.setParentNodeCheckBox(t, e, !0),
                !e[n] && -1 < t.check.chkboxType.N.indexOf("p") && this.setParentNodeCheckBox(t, e, !1)
        },
        makeChkClass: function(t, e) {
            var i = t.data.key.checked
                , a = t.consts.checkbox
                , n = t.consts.radio
                , s = ""
                , s = !0 === e.chkDisabled ? a.DISABLED : e.halfCheck ? a.PART : t.check.chkStyle != n.STYLE && e[i] ? 2 === e.check_Child_State || -1 === e.check_Child_State ? a.FULL : a.PART : e.check_Child_State < 1 ? a.FULL : a.PART
                , r = t.check.chkStyle + " " + (e[i] ? a.TRUE : a.FALSE) + " " + s
                , r = e.check_Focus && !0 !== e.chkDisabled ? r + "_" + a.FOCUS : r;
            return t.consts.className.BUTTON + " " + a.DEFAULT + " " + r
        },
        repairAllChk: function(t, e) {
            if (t.check.enable && t.check.chkStyle === t.consts.checkbox.STYLE)
                for (var i = t.data.key.checked, a = t.data.key.children, n = this.root, s = 0, r = n[a].length; s < r; s++) {
                    var o = n[a][s];
                    !0 !== o.nocheck && !0 !== o.chkDisabled && (o[i] = e),
                        this.setSonNodeCheckBox(t, o, e)
                }
        },
        repairChkClass: function(t, e) {
            var i;
            e && (this.makeChkFlag(t, e),
            !0 !== e.nocheck && (i = this.getDOMBySelector(e, t.consts.id.CHECK, t),
                this.setChkClass(t, i, e)))
        },
        repairParentChkClass: function(t, e) {
            var i;
            e && e.parentTId && (i = e.getParentNode(),
                this.repairChkClass(t, i),
                this.repairParentChkClass(t, i))
        },
        repairParentChkClassWithSelf: function(t, e) {
            var i;
            e && (e[i = t.data.key.children] && 0 < e[i].length ? this.repairParentChkClass(t, e[i][0]) : this.repairParentChkClass(t, e))
        },
        repairSonChkDisabled: function(t, e, i, a) {
            if (e) {
                var n = t.data.key.children;
                if (e.chkDisabled != i && (e.chkDisabled = i),
                    this.repairChkClass(t, e),
                e[n] && a)
                    for (var s = 0, r = e[n].length; s < r; s++) {
                        var o = e[n][s];
                        this.repairSonChkDisabled(t, o, i, a)
                    }
            }
        },
        repairParentChkDisabled: function(t, e, i, a) {
            e && (e.chkDisabled != i && a && (e.chkDisabled = i),
                this.repairChkClass(t, e),
                this.repairParentChkDisabled(t, e.getParentNode(), i, a))
        },
        setChkClass: function(t, e, i) {
            e && (!0 === i.nocheck ? e.hide() : e.show(),
                e.removeClass(),
                e.addClass(this.makeChkClass(t, i)))
        },
        setParentNodeCheckBox: function(t, e, i, a) {
            var n = t.data.key.children
                , s = t.data.key.checked
                , r = this.getDOMBySelector(e, t.consts.id.CHECK, t);
            if (a = a || e,
                this.makeChkFlag(t, e),
            !0 !== e.nocheck && !0 !== e.chkDisabled && (e[s] = i,
                this.setChkClass(t, r, e),
            t.check.autoCheckTrigger && e != a && t.treeObj.trigger(t.consts.event.CHECK, [null, e])),
                e.parentTId) {
                var o = !0;
                if (!i)
                    for (var l = e.getParentNode()[n], c = 0, d = l.length; c < d; c++)
                        if (!0 !== l[c].nocheck && !0 !== l[c].chkDisabled && l[c][s] || (!0 === l[c].nocheck || !0 === l[c].chkDisabled) && 0 < l[c].check_Child_State) {
                            o = !1;
                            break
                        }
                o && this.setParentNodeCheckBox(t, e.getParentNode(), i, a)
            }
        },
        setSonNodeCheckBox: function(t, e, i, a) {
            if (e) {
                var n = t.data.key.children
                    , s = t.data.key.checked
                    , r = this.getDOMBySelector(e, t.consts.id.CHECK, t);
                a = a || e;
                var o = !1;
                if (e[n])
                    for (var l = 0, c = e[n].length; l < c && !0 !== e.chkDisabled; l++) {
                        var d = e[n][l];
                        this.setSonNodeCheckBox(t, d, i, a),
                        !0 === d.chkDisabled && (o = !0)
                    }
                e != this.root && !0 !== e.chkDisabled && (o && !0 !== e.nocheck && this.makeChkFlag(t, e),
                    !0 !== e.nocheck && !0 !== e.chkDisabled ? (e[s] = i,
                    o || (e.check_Child_State = e[n] && 0 < e[n].length ? i ? 2 : 0 : -1)) : e.check_Child_State = -1,
                    this.setChkClass(t, r, e),
                t.check.autoCheckTrigger && e != a && !0 !== e.nocheck && !0 !== e.chkDisabled && t.treeObj.trigger(t.consts.event.CHECK, [null, e]))
            }
        },
        updateNode: function(t, e) {
            FX.Tree.superclass.updateNode.apply(this, arguments);
            var i, a = this.options.setting;
            t && a.check.enable && this.getDOMBySelector(t, a).get(0) && (i = this.getDOMBySelector(t, a.consts.id.CHECK, a),
            !0 !== e && a.check.chkStyle !== a.consts.radio.STYLE || this.checkNodeRelation(a, t),
                this.setChkClass(a, i, t),
                this.repairParentChkClassWithSelf(a, t))
        },
        createNodes: function(t, e, i, a) {
            FX.Tree.superclass.createNodes.apply(this, arguments),
            i && this.repairParentChkClassWithSelf(t, a)
        },
        removeNode: function(t, e) {
            var i = e.getParentNode();
            FX.Tree.superclass.removeNode.apply(this, arguments),
            e && i && (this.repairChkClass(t, i),
                this.repairParentChkClass(t, i))
        },
        appendNodes: function(t, e, i, a, n, s) {
            var r = FX.Tree.superclass.appendNodes.apply(this, arguments);
            return a && this.makeChkFlag(t, a),
                r
        }
    }),
        t.shortcut("tree", FX.Tree)
}(jQuery),
function(s) {
    FX.Segment = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.Segment.superclass._defaultConfig.apply(), {
                baseCls: "fui_segment",
                onItemSelect: null,
                onAfterItemSelect: null,
                items: []
            })
        },
        _init: function() {
            FX.Segment.superclass._init.apply(this, arguments);
            for (var t = this.options, e = 0, i = t.items.length; e < i; e++) {
                var a = t.items[e]
                    , n = s('<div class="fui_segment_item"/>').data("item", a).append(s("<span/>").text(a.text)).appendTo(this.element);
                a.iconCls && n.prepend(s("<i/>").addClass(a.iconCls)),
                a.itemCls && n.addClass(a.itemCls),
                a.htmlContent && n.empty().addClass("segment-html-item").append(a.htmlContent)
            }
            this._bindEvts()
        },
        _bindEvts: function() {
            function t(t) {
                var e;
                !i.isEnabled() || (e = s(t.target).closest(".fui_segment_item")) && 0 < e.length && "click" === t.type && (!1 === FX.Utils.applyFunc(i, a.onItemSelect, [e, e.data("item")], !1) && (s(".selected", i.element).removeClass("selected"),
                    i._setItemSelected(e)),
                    FX.Utils.applyFunc(i, a.onAfterItemSelect, null, !1))
            }
            var i = this
                , a = this.options;
            this.element.unbind(),
                this.element.bind("click", t).bind("mouseout", t)
        },
        _setItemSelected: function(t) {
            var e, i = this.options;
            t && !t.hasClass("selected") && (t.addClass("selected"),
                e = t.data("item"),
                i.value = e.value,
                i.text = e.text)
        },
        checkValidate: function() {
            return !(!this.options.allowBlank && FX.Utils.isEmpty(this.getValue()))
        },
        getValue: function() {
            return this.options.value
        },
        getText: function() {
            return this.options.text
        },
        setValue: function(a) {
            var t = this.options
                , n = this;
            s(".selected", n.element).removeClass("selected"),
            FX.Utils.isNull(a) && (t.value = null,
                t.text = null),
            t.items && s.each(t.items, function(t, e) {
                var i;
                a == e.value && (i = n.element.children().eq(t),
                    n._setItemSelected(i))
            })
        },
        setText: function(a) {
            var t = this.options
                , n = this;
            s(".selected", n.element).removeClass("selected"),
            FX.Utils.isNull(a) && (t.value = null,
                t.text = null),
            t.items && s.each(t.items, function(t, e) {
                var i;
                a == e.text && (i = n.element.children().eq(t),
                    n._setItemSelected(i))
            })
        }
    }),
        s.shortcut("segment", FX.Segment)
}(jQuery),
function(r) {
    FX.MultiSegment = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return r.extend(FX.MultiSegment.superclass._defaultConfig.apply(), {
                baseCls: "fui_multi_segment",
                onAfterItemSelect: null,
                items: []
            })
        },
        _init: function() {
            FX.MultiSegment.superclass._init.apply(this, arguments);
            var t = this.options
                , a = this;
            FX.Utils.forEach(t.items, function(t, e) {
                var i = r('<div class="fui_segment_item"/>').data("item", e).append(r("<span/>").text(e.text)).appendTo(a.element);
                e.iconCls && i.prepend(r("<i/>").addClass(e.iconCls)),
                e.htmlContent && i.empty().addClass("segment-html-item").append(e.htmlContent)
            }),
                this._bindEvts()
        },
        _bindEvts: function() {
            var n = this
                , s = this.options;
            this.element.on("click", function(t) {
                var e, i, a;
                !n.isEnabled() || (e = r(t.target).closest(".fui_segment_item")) && 0 < e.length && (e.toggleClass("selected"),
                    i = e.data("item"),
                    a = e.hasClass("selected"),
                    FX.Utils.applyFunc(n, s.onAfterItemSelect, [e, i, a], !1))
            })
        },
        checkValidate: function() {
            return !(!this.options.allowBlank && FX.Utils.isObjectEmpty(this.getValue()))
        },
        getValue: function() {
            var t = [];
            return r(".selected", this.element).each(function() {
                t.push(r(this).data("item").value)
            }),
                t
        },
        setValue: function(t) {
            var e = r.makeArray(t);
            r(".selected", this.element).removeClass("selected"),
                r(".fui_segment_item", this.element).each(function() {
                    var t = r(this).data("item");
                    -1 < e.indexOf(t.value) && r(this).addClass("selected")
                })
        }
    }),
        r.shortcut("multisegment", FX.MultiSegment)
}(jQuery),
function(n) {
    FX.LoginName = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return n.extend(FX.LoginName.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_login_name",
                waterMark: "",
                height: 40,
                phoneDelimiter: "-",
                inputType: "phone",
                checkEmailValid: !0,
                onStopEdit: null,
                onValidateFail: null,
                onValidateSuccess: null
            })
        },
        _init: function() {
            FX.LoginName.superclass._init.apply(this, arguments);
            var i = this
                , a = this.options;
            this.chinaCode = FX.CONST.CHINA_CODE,
                this.$input = n('<input name="username" class="phone-input" placeholder="' + a.waterMark + '">').appendTo(this.element),
                this.$input.focus(function() {
                    i.$err && i.$err.hide()
                }).blur(function(t) {
                    var e = i.checkValidate();
                    e && FX.Utils.applyFunc(i, a.onStopEdit, [e, t], !1)
                }).on("input propertychange", function() {
                    var t = "multi";
                    i.isPhone() && (t = "phone"),
                        i.setValueType(t)
                }),
                this.$btn = n('<div class="phone-btn"/>').appendTo(this.element),
                this.$selectText = n('<div class="phone-code"/>').text(this.chinaCode).css({
                    height: a.height,
                    "line-height": a.height - 2 + "px"
                }).appendTo(this.$btn),
                this.$select = n('<select name="location" class="location-select" tabindex="-1"/>').appendTo(this.$btn),
                FX.Utils.forEach(FX.CONST.AREA_CODE, function(t, e) {
                    n('<option value="' + e.value + '" ' + (e.value === i.chinaCode ? "selected" : "") + ">" + e.text + " " + e.value + "</option>").appendTo(i.$select)
                }),
                n('<i class="icon-angledown"/>').css({
                    "line-height": a.height - 2 + "px"
                }).appendTo(this.$btn),
                this.$select.on("change", function(t) {
                    i.$selectText.text(t.target.value)
                }),
                this.setValueType(a.inputType)
        },
        showErrorMsg: function(t) {
            FX.Utils.isEmpty(t) || (this.$err || (this.$err = n('<span class="invalid-info"/>').appendTo(this.element)),
                this.$err.text(t).show())
        },
        getValue: function() {
            return "multi" === this.valueType ? this.$input.val() : this.$select.val() + this.options.phoneDelimiter + this.$input.val()
        },
        getValueType: function() {
            return this.valueType
        },
        setValueType: function(t) {
            "multi" === this.options.inputType ? (this.valueType = t,
                this.element.toggleClass("multi", "multi" === t)) : (this.valueType = "phone",
                this.element.toggleClass("multi", !1))
        },
        setValue: function(t) {
            var e, i, a, n = this.options;
            FX.Utils.isEmpty(t) || ("multi" === this.valueType ? this.$input.val(t) : (new RegExp(n.phoneDelimiter).test(t) || (t = n.phoneDelimiter + t),
            (e = t.split(n.phoneDelimiter)) && (i = e[0],
            FX.Utils.isEmpty(i) && (i = this.chinaCode),
                this.$select.val(i),
                this.$selectText.text(i),
            (a = e[1]) && this.$input.val(a))))
        },
        isPhone: function() {
            var t = this.$input.val().trim()
                , e = !0;
            try {
                e = new RegExp("^([0-9]{4,})$").test(t)
            } catch (t) {
                e = !1
            }
            return e
        },
        checkValidate: function() {
            var t = this.options
                , e = this.$input.val().trim()
                , i = !0;
            if ("phone" === this.valueType)
                try {
                    i = new RegExp("^\\d+$").test(e)
                } catch (t) {
                    i = !1
                }
            else if (t.checkEmailValid)
                try {
                    i = new RegExp(FX.CONST.TEXT_TYPE_REGEXP.email).test(e)
                } catch (t) {
                    i = !1
                }
            return i ? !1 === FX.Utils.applyFunc(this, t.onValidateSuccess, [e], !1) && this.$input.removeClass("x-input-error") : !1 === FX.Utils.applyFunc(this, t.onValidateFail, [e], !1) && this.$input.addClass("x-input-error"),
                i
        },
        setEnable: function(t) {
            FX.LoginName.superclass.setEnable.apply(this, arguments),
                t ? (this.$input.removeAttr("readOnly"),
                    this.$select.removeAttr("disabled")) : (this.$input.attr("readOnly", "readOnly"),
                    this.$select.attr("disabled", "disabled"))
        },
        setReadOnly: function() {
            this.$input.attr("readOnly", "readOnly")
        }
    }),
        n.shortcut("login_name", FX.LoginName)
}(jQuery),
function(e) {
    FX.Progress = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return e.extend(FX.Progress.superclass._defaultConfig.apply(), {
                baseCls: "fui_progress",
                width: 200,
                valueMin: 0,
                valueMax: 100,
                value: 0,
                style: "info",
                message: "",
                isAnimate: !0,
                isStriped: !0
            })
        },
        _init: function() {
            FX.Progress.superclass._init.apply(this, arguments);
            var t = this.options;
            this.$bar = e('<div class="progress-bar" />').addClass("progress-bar-" + t.style).appendTo(this.element),
            t.isAnimate && this.$bar.addClass("active"),
            t.isStriped && this.$bar.addClass("progress-bar-striped"),
                this.$message = e('<span class="progress-message" />').css({
                    "line-height": t.height + "px"
                }).appendTo(this.element),
                this.setValue(),
                this.setMessage()
        },
        setValue: function(t) {
            var e = this.options;
            FX.Utils.isNull(t) || (e.value = t);
            var i = parseInt(((e.value - e.valueMin) / (e.valueMax - e.valueMin) * 100).toFixed(2));
            60 < i ? this.$message.addClass("bright") : i <= 60 && this.$message.removeClass("bright"),
            100 === i && e.isAnimate && this.$bar.removeClass("active"),
                this.$bar.css({
                    width: i + "%"
                })
        },
        setMessage: function(t) {
            var e = this.options;
            FX.Utils.isBlank(t) || (e.message = t),
                this.$message.text(e.message)
        }
    }),
        e.shortcut("progress", FX.Progress)
}(jQuery),
function(l) {
    FX.FilePreview = FX.extend(FX.Widget, {
        ROTATE_DIRECTION: {
            UP: 0,
            RIGHT: 1,
            DOWN: 2,
            LEFT: 3
        },
        _defaultConfig: function() {
            return l.extend(FX.FilePreview.superclass._defaultConfig.apply(), {
                renderEl: l("<div/>").appendTo("body"),
                baseCls: "fui_file_preview",
                autoClose: !1,
                files: [],
                scale: 1.25,
                scaleWheel: 1.1,
                currentItem: 0,
                duration: 150,
                height4Head: 60,
                width4Side: 160,
                maxScale: 5,
                hasDownload: !0,
                autoPlay: !1,
                loop: !1,
                minScale: .18,
                otherExtTip: "https://hc.jiandaoyun.com/doc/9026#6-%E9%99%84%E4%BB%B6"
            })
        },
        _init: function() {
            FX.FilePreview.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.element.addClass("x-window-mask modal dark").css({
                "z-index": FX.STATIC.zIndex++
            }),
            t.autoClose && this.element.click(function(t) {
                l(t.target).hasClass("x-window-mask") && e.destroy()
            }),
                this._bindKeydownEvent(),
                this._createNaviBtns(),
                this.$fileWrapper = l('<div class="file-wrapper"/>').appendTo(this.element),
            t.files && (this.totalPage = t.files.length,
                FX.Utils.forEach(t.files, function() {
                    l('<div class="file-item"/>').appendTo(e.$fileWrapper)
                }),
                this.maxWidth = this.element.width() - 2 * t.width4Side,
                this.maxHeight = this.element.height() - t.height4Head,
                this._viewFileAt(t.currentItem))
        },
        _bindKeydownEvent: function() {
            var e = this;
            this.element.attr("tabindex", -1),
                this.element.focus(),
                this.element.bind("keydown", function(t) {
                    t.keyCode === FX.Keys.LEFT && 0 < e.currentPage && e._viewFileAt(e.currentPage - 1),
                    t.keyCode === FX.Keys.RIGHT && e.currentPage < e.totalPage - 1 && e._viewFileAt(e.currentPage + 1),
                        t.stopEvent()
                })
        },
        _viewFileAt: function(t) {
            var e = this.options;
            this.currentPage = t,
                this._refreshNav(t),
            this.$pageIndex && this.$pageIndex.text(t + 1 + " / " + this.totalPage);
            var i, a = e.files[t];
            a && (this.currentPlay && (this.currentPlay[0].pause && this.currentPlay[0].pause(),
                this.currentPlay = null),
                this.$fileName.text(a.name || ""),
                this.$currentView = this.$fileWrapper.children(".file-item").eq(t).show(),
                this.$currentView.siblings().hide(),
            this.$download && this.$download.attr("download-url", a.downloadUrl),
            this.$currentView.children() && 0 !== this.$currentView.children().length || (i = a.name ? a.name.split(".").pop() : "",
                FX.Utils.isImageExt(i) ? this._dealImagePreview(a, !1) : FX.Utils.isVideoExt(i) ? (this._dealVideoPreview(a),
                    this.$currentView.addClass("file-video")) : FX.Utils.isAudioExt(i) ? this._dealAudioPreview(a) : FX.Utils.isOfficeExt(i) ? this._dealBoxFilePreview(a, {
                    hideHeader: !0
                }) : FX.Utils.isPdfExt(i) ? this._dealBoxFilePreview(a, {
                    hideHeader: !1
                }) : this._dealOtherFile(i)))
        },
        _dealVideoPreview: function(t) {
            var e = this
                , i = this.options
                , a = l('<video class="preview-item" preload="metadata" controls="controls"/>').appendTo(this.$currentView);
            i.autoPlay && a.attr("autoplay", "autoplay"),
            i.loop && a.attr("loop", "loop"),
            t.downloadUrl && a.attr("src", t.downloadUrl).on("playing", function() {
                e.currentPlay = a
            })
        },
        _dealAudioPreview: function(t) {
            var e = this
                , i = this.options
                , a = l('<audio class="preview-item" controls="controls"/>').appendTo(this.$currentView);
            i.autoPlay && a.attr("autoplay", "autoplay"),
            i.loop && a.attr("loop", "loop"),
            t.downloadUrl && a.attr("src", t.downloadUrl).on("playing", function() {
                e.currentPlay = a
            })
        },
        _dealImagePreview: function(t, e) {
            var i, a, n, s, r = this, o = this.options;
            t.size >= FX.CONST.MAX_IMAGE_VIEW_SIZE ? l('<div class="file-unknown"/>').append(l('<div class="fui_file_thumb image size-normal"/>')).append(l('<div class="file-tip"/>').text(i18next.t("file.preview.imageMaximum", {
                num: FX.CONST.MAX_IMAGE_VIEW_SIZE / 1024 / 1024
            }))).appendTo(this.$currentView) : (i = FX.Utils.createLoadIcon(this.$currentView),
                a = l('<img draggable="false" class="x-ui-hidden"/>').data({
                    file: t,
                    useOriginUrl: e
                }).appendTo(this.$currentView),
                n = t.previewUrl,
            e && t.url && (n = t.url),
                a.attr("src", n),
                s = {
                    flag: !1
                },
                a.on("load", function() {
                    a.removeClass("x-ui-hidden"),
                        i.remove(),
                        r._createToolBar().appendTo(r.$currentView),
                        a.data("scale", 1),
                        r._adjustImg(a)
                }).on("mousedown", function(t) {
                    s.flag = !0,
                        s.oriX = t.clientX,
                        s.oriY = t.clientY,
                        s.marginLeft = parseInt(a.css("margin-left")),
                        s.marginTop = parseInt(a.css("margin-top"))
                }).on("wheel", function(t) {
                    0 < t.originalEvent.deltaY ? r._scaleImg(l(t.currentTarget), 1 / o.scaleWheel) : r._scaleImg(l(t.currentTarget), o.scaleWheel)
                }),
                this.element.off("mousemove.imgpreview"),
                this.element.on("mousemove.imgpreview", function(t) {
                    if (s.flag)
                        return a.css({
                            marginLeft: s.marginLeft + t.clientX - s.oriX,
                            marginTop: s.marginTop + t.clientY - s.oriY
                        }),
                            !1
                }),
                this.element.off("mouseup.imgpreview"),
                this.element.on("mouseup.imgpreview", function() {
                    s.flag = !1
                }))
        },
        _dealBoxFilePreview: function(t, e) {
            var i = l('<div class="iframe-wrapper"/>').appendTo(this.$currentView);
            e.hideHeader && i.addClass("hide-header"),
                l('<iframe class="file-box-preview" frameborder="0"/>').appendTo(i).attr("src", t.previewUrl)
        },
        _dealOtherFile: function(t) {
            var e = this.options;
            l('<div class="file-unknown"/>').append(FX.Utils.createFileThumb(t)).append(l('<div class="file-tip"/>').text(i18next.t("file.preview.noSupport"))).append(l('<a class="file-link" target="_blank"/>').text(i18next.t("file.preview.support")).attr("href", e.otherExtTip)).appendTo(this.$currentView)
        },
        _refreshNav: function(t) {
            var e = l(".file-nav.prev", this.element)
                , i = l(".file-nav.next", this.element);
            t === this.totalPage - 1 ? i.addClass("x-ui-hidden") : i.removeClass("x-ui-hidden"),
                0 === t ? e.addClass("x-ui-hidden") : e.removeClass("x-ui-hidden")
        },
        _adjustImg: function(t) {
            var e, i, a, n, s, r, o = this.options, l = t.data("scale");
            l && (e = t.width() / l,
                i = t.height() / l,
                a = {
                    width: t.width(),
                    height: t.height(),
                    marginLeft: (this.maxWidth - t.width()) / 2 + o.width4Side,
                    marginTop: (this.maxHeight - t.height()) / 2
                },
                n = this.maxWidth,
                s = this.maxHeight,
            -1 < [this.ROTATE_DIRECTION.LEFT, this.ROTATE_DIRECTION.RIGHT].indexOf(t.data("directionIdx") % 4) && (n = this.maxHeight,
                s = this.maxWidth),
            (n < e || s < i) && (r = Math.min(n / e, s / i),
                t.data("scale", r),
            r < o.minScale && (o.minScale = r),
                a.width = e * r,
                a.height = i * r,
                a.marginLeft = (this.maxWidth - a.width) / 2 + o.width4Side,
                a.marginTop = (this.maxHeight - a.height) / 2),
                t.css(a),
                this._refreshScaleVal(t))
        },
        _refreshScaleBtn: function(t) {
            var e = this.options
                , i = l("i.enlargement", this.$currentView)
                , a = l("i.narrow", this.$currentView)
                , n = !0;
            return t > e.maxScale ? (i.addClass("x-ui-disable"),
                n = !1) : i.removeClass("x-ui-disable"),
                t < e.minScale ? (a.addClass("x-ui-disable"),
                    n = !1) : a.removeClass("x-ui-disable"),
                n
        },
        _refreshScaleVal: function(t) {
            var e = parseInt(100 * t.data("scale"));
            l(".scale-val", this.$currentView).text(e + "%")
        },
        _createNaviBtns: function() {
            var e = this
                , t = this.options
                , i = l('<div class="file-header"/>').appendTo(this.element);
            l('<i class="icon-close-normal file-nav close">').click(function() {
                e.destroy()
            }).appendTo(i),
            t.hasDownload && (this.$download = l('<a target="_blank" class="file-nav download"/>').append(l('<i class="icon-vip-center-excel-import">')).append(l("<span />").text(i18next.t("download"))).click(function() {
                FX.Utils.fileDownload(e.$download.attr("download-url"))
            }).appendTo(i)),
                this.$pageIndex = l('<div class="file-counter"/>').appendTo(i),
            1 < this.options.files.length && (l('<div class="file-nav next"/>').append(l('<div class="nav-wrapper"><i class="icon-arrow-right"/></div>')).click(function(t) {
                e._viewFileAt(e.currentPage + 1)
            }).appendTo(this.element),
                l('<div class="file-nav prev"/>').append(l('<div class="nav-wrapper"><i class="icon-arrow-left"/></div>')).click(function() {
                    e._viewFileAt(e.currentPage - 1)
                }).appendTo(this.element)),
                this.$fileName = l('<div class="file-name"/>').appendTo(i)
        },
        _createToolBar: function() {
            var i = this
                , a = this.options
                , t = l('<div class="file-toolbar"/>');
            return l('<i class="icon-enlargement file-btn enlargement">').on("click", function(t) {
                var e;
                l(t.currentTarget).hasClass("x-ui-disable") || 0 < (e = i.$currentView.children("img")).length && i._scaleImg(e, a.scale)
            }).hover(function(t) {
                FX.UI.showPopover({
                    anchor: l(t.target),
                    content: l("<span />").text(i18next.t("zoomIn")),
                    type: "dark"
                })
            }, function() {
                FX.UI.closePopover()
            }).appendTo(t),
                l('<div class="scale-val"/>').appendTo(t),
                l('<i class="icon-narrow file-btn narrow">').on("click", function(t) {
                    var e;
                    l(t.currentTarget).hasClass("x-ui-disable") || 0 < (e = i.$currentView.children("img")).length && i._scaleImg(e, 1 / a.scale)
                }).hover(function(t) {
                    FX.UI.showPopover({
                        anchor: l(t.target),
                        content: l("<span />").text(i18next.t("zoomOut")),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                }).appendTo(t),
                l('<i class="icon-rotate file-btn rotate"/>').on("click", function() {
                    var t = i.$currentView.children("img");
                    0 < t.length && i._rotateImg(t)
                }).hover(function(t) {
                    FX.UI.showPopover({
                        anchor: l(t.target),
                        content: l("<span />").text(i18next.t("file.preview.rotateToRight")),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                }).appendTo(t),
                l('<i class="icon-origin-image file-btn origin"/>').on("click", function() {
                    var t = i.$currentView.children("img");
                    0 < t.length && (i._useOriginImg(t),
                        FX.UI.closePopover())
                }).hover(function(t) {
                    FX.UI.showPopover({
                        anchor: l(t.target),
                        content: l("<span />").text(i18next.t("file.preview.viewOriginImage")),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                }).appendTo(t),
                t
        },
        _scaleImg: function(t, e) {
            this.options;
            var i, a, n = t.width(), s = t.height(), r = t.data("scale");
            this._refreshScaleBtn(r * e) && (r *= e,
                t.data("scale", r),
                i = parseInt(t.css("margin-left")),
                a = parseInt(t.css("margin-top")),
                t.css({
                    width: n * e,
                    height: s * e,
                    marginLeft: i + n * (1 - e) / 2,
                    marginTop: a + s * (1 - e) / 2
                }),
                this._refreshScaleVal(t))
        },
        _rotateImg: function(t) {
            var e = t.data("directionIdx") || this.ROTATE_DIRECTION.UP;
            e++,
                t.data("directionIdx", e),
                t.css({
                    transform: "rotate(" + 90 * e + "deg)"
                }),
                this._adjustImg(t)
        },
        _useOriginImg: function(t) {
            var e = t.data("file");
            t.data("useOriginUrl") || (this.$currentView.empty(),
                this._dealImagePreview(e, !0))
        }
    }),
        l.shortcut("filepreview", FX.FilePreview)
}(jQuery),
function(l) {
    FX.ThumbList = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return l.extend(FX.ThumbList.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_thumb_list",
                files: [],
                hasTooltip: !0
            })
        },
        _init: function() {
            FX.ThumbList.superclass._init.apply(this, arguments);
            var i, r, o = this.options;
            FX.Utils.isObjectEmpty(o.files) || (i = l.makeArray(o.files),
                r = l('<div class="thumb-list"/>').click(function(t) {
                    var e = l(t.target).closest(".thumb-item");
                    new FX.FilePreview({
                        files: i,
                        currentItem: e.data("index"),
                        autoClose: !1
                    })
                }).appendTo(this.element),
                FX.Utils.forEach(i, function(t, e) {
                    var i = l('<div class="thumb-item"/>').data("index", t);
                    o.hasTooltip && i.hover(function() {
                        FX.UI.showPopover({
                            anchor: i,
                            content: l("<span/>").text(e.name),
                            type: "dark"
                        })
                    }, function() {
                        FX.UI.closePopover()
                    });
                    var a, n, s = e.name ? e.name.split(".").pop() : "";
                    FX.Utils.isImageExt(s) && e.size <= FX.CONST.MAX_IMAGE_VIEW_SIZE ? (a = l("<img/>").attr("src", e.thumbUrl),
                        i.append(a).appendTo(r)) : (n = FX.Utils.createFileThumb(s, "tiny"),
                        i.append(n).appendTo(r))
                }))
        }
    })
}(jQuery),
function(d) {
    FX.TimePicker = FX.extend(FX.Trigger, {
        _defaultConfig: function() {
            return d.extend(FX.TimePicker.superclass._defaultConfig.apply(this, arguments), {
                triggerIcon: "icon-caret-down",
                waterMark: i18next.t("widget.timepicker.placeholder"),
                edge: {
                    width: 240,
                    height: 280
                },
                format: "yyyy-MM-dd"
            })
        },
        _init: function() {
            FX.TimePicker.superclass._init.apply(this, arguments),
                this.state = {
                    start: {
                        time: null,
                        num: null,
                        unit: null
                    },
                    end: {
                        time: null,
                        num: null,
                        unit: null
                    },
                    viewMode: "start"
                },
                this.defaults = this._checkDefaultsByFormat(),
                this.clientList = {}
        },
        _istypeyearMonth: function() {
            return "yyyy-MM" === this.options.format
        },
        _checkDefaultsByFormat: function() {
            this.options;
            var t = {};
            return this._istypeyearMonth() ? t.value = {
                time: "present",
                num: 1,
                unit: "month"
            } : t.value = {
                time: "present",
                num: 1,
                unit: "day"
            },
                t.cols = {
                    present: {
                        text: i18next.t("current"),
                        cols: {
                            1: {
                                text: 1,
                                cols: this._createUnitCols()
                            }
                        }
                    },
                    past: {
                        text: i18next.t("past"),
                        cols: this._createCustomCols()
                    },
                    future: {
                        text: i18next.t("future"),
                        cols: this._createCustomCols()
                    }
                },
                t
        },
        _createUnitCols: function() {
            return this._istypeyearMonth() ? {
                month: {
                    text: i18next.t("month")
                }
            } : {
                day: {
                    text: i18next.t("days")
                },
                week: {
                    text: i18next.t("week")
                },
                month: {
                    text: i18next.t("month")
                }
            }
        },
        _createCustomCols: function() {
            for (var t = {}, e = 1; e < 100; e++)
                t[e] = {
                    text: e,
                    cols: this._createUnitCols()
                };
            return t
        },
        _onTriggerClick: function() {
            this._showTriggerView();
            var i = this;
            d(document).bind("mousedown.timepicker", function(t) {
                var e = t.target;
                d(e).closest(i.triggerView).length || i._hideTriggerView()
            })
        },
        _createEditComp: function() {
            return d('<input class="fui_trigger-input" onfocus="this.blur();"/>').attr("UNSELECTABLE", "on").appendTo(this.element)
        },
        _hideTriggerView: function() {
            this.triggerView && (d(document).unbind("mousedown.timepicker"),
                this.triggerView.detach())
        },
        _showTriggerView: function() {
            this.triggerView || (this.triggerView = d('<div class="x-dropdown"/>'),
                this.$content = d('<div class="fui_time_picker"/>').css("width", this.element.outerWidth()).appendTo(this.triggerView)),
                this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.$content.empty(),
                this._initContent()
        },
        _initContent: function() {
            this._createHead(),
                this._createBody(),
                this._createFoot(),
                this._listen("viewMode", this._switchMode),
                this._switchMode()
        },
        _createHead: function() {
            var s = this
                , t = d('<div class="head-tab"/>').on("click", function(t) {
                var e = d(t.target)
                    , i = e.closest(".clear-btn")
                    , a = e.closest(".tab-btn");
                if (i.length) {
                    var n = {};
                    return n[a.attr("role")] = {
                        time: null,
                        num: null,
                        unit: null
                    },
                        s._setState(n),
                        t.preventDefault(),
                        !1
                }
                a.length && s._setState({
                    viewMode: a.attr("role")
                })
            }).appendTo(this.$content);
            this.$btnStart = d('<div class="tab-btn" role="start"/>').appendTo(t),
                d('<div class="btn-text"  data-watermark="' + i18next.t("timeBegin") + '"/>').text(FX.Utils.getDataFilterText(s.state.start)).appendTo(this.$btnStart),
                d('<i class="icon-close-circle clear-btn"/>').appendTo(this.$btnStart),
                d('<div class="tab-separator">~</div>').appendTo(t),
                this._listen("start", function() {
                    d(".btn-text", s.$btnStart).text(FX.Utils.getDataFilterText(s.state.start))
                }),
                this.$btnEnd = d('<div class="tab-btn" role="end"/>').appendTo(t),
                d('<div class="btn-text"  data-watermark="' + i18next.t("timeEnd") + '"/>').text(FX.Utils.getDataFilterText(s.state.end)).appendTo(this.$btnEnd),
                d('<i class="icon-close-circle clear-btn"/>').appendTo(this.$btnEnd),
                this._listen("end", function() {
                    d(".btn-text", s.$btnEnd).text(FX.Utils.getDataFilterText(s.state.end))
                })
        },
        _listen: function(t, e) {
            this.clientList[t] || (this.clientList[t] = []),
                this.clientList[t].push(e)
        },
        _switchMode: function() {
            switch (this.state.viewMode) {
                case "start":
                    this.$btnStart.addClass("select").siblings().removeClass("select");
                    break;
                case "end":
                    this.$btnEnd.addClass("select").siblings().removeClass("select")
            }
            this._createBody()
        },
        _createBody: function() {
            var a = this
                , n = this.state
                , i = d(".body", this.$content);
            i.length || (i = d('<div class="body"/>').appendTo(this.$content)),
                i.empty();
            var t = this._getColValue("time")
                , e = this._getColValue("num")
                , s = this._getColValue("unit")
                , r = this.defaults
                , o = [{
                key: "time",
                items: this._getColItems(r.cols),
                value: t,
                onColChange: function(t) {
                    var e = {};
                    e[n.viewMode] = {
                        time: t.value
                    },
                        a._setState(e);
                    var i = {};
                    i[n.viewMode] = {
                        num: l.num.getSelectItem().value,
                        unit: l.unit.getSelectItem().value
                    },
                        a._setState(i)
                }
            }, {
                key: "num",
                items: this._getColItems(r.cols[t].cols),
                value: e,
                onColChange: function(t) {
                    var e = {};
                    e[n.viewMode] = {
                        num: t.value,
                        time: l.time.getSelectItem().value,
                        unit: l.unit.getSelectItem().value
                    },
                        a._setState(e)
                }
            }, {
                key: "unit",
                value: s,
                items: this._getColItems(r.cols[t].cols[e].cols),
                onColChange: function(t) {
                    var e = {};
                    e[n.viewMode] = {
                        unit: t.value,
                        time: l.time.getSelectItem().value,
                        num: l.num.getSelectItem().value
                    },
                        a._setState(e)
                }
            }]
                , l = {};
            FX.Utils.forEach(o, function(t, e) {
                l[e.key] = a._renderCol(e, i)
            }),
                this._listen("start.time|end.time", function() {
                    var t = a._getColItems(r.cols[a._getColValue("time")].cols);
                    l.num.replaceColItems(t, n[n.viewMode].num);
                    var e = a._getColItems(r.cols);
                    l.time.replaceColItems(e, n[n.viewMode].time)
                }),
                this._listen("start.unit|end.unit", function() {
                    var t = a._getColItems(r.cols[a._getColValue("time")].cols[a._getColValue("num")].cols);
                    l.unit.replaceColItems(t, n[n.viewMode].unit)
                })
        },
        _getColValue: function(t) {
            var e = this.state
                , i = this.defaults.value;
            return e[e.viewMode][t] || i[t]
        },
        _getColItems: function(t) {
            var i = [];
            return FX.Utils.forEach(t, function(t, e) {
                i.push({
                    text: e.text,
                    value: t
                })
            }),
                i
        },
        _renderCol: function(i, t) {
            function e(t, a) {
                c.empty();
                var n = 0;
                FX.Utils.forEach(t, function(t, e) {
                    var i = d('<div class="col-item"/>').data("item", e).appendTo(c);
                    d('<div class="item-wrapper"/>').text(e.text).appendTo(i),
                    a === e.value && (n = t)
                }),
                    s = d(".col-item", c),
                    o = c.outerHeight(),
                    r = {
                        max: 64,
                        min: -(o - 96)
                    },
                    n = Math.min(n, t.length - 1),
                    s.eq(n).addClass("select").siblings().removeClass("select");
                var e = d(".col-item.select", c).index();
                o <= r.max && c.removeClass("transition"),
                    c.css(FX.Utils.formatTransform("translate(0," + (64 - 32 * e) + "px)"))
            }
            var s, r, o, n = FX.Utils.debounce(function() {
                a(i.onColChange)
            }, 200, this), a = function(t) {
                c.removeClass("scrolling").addClass("transition");
                var e = d(".col-item.select", c);
                c.css(FX.Utils.formatTransform("translate(0," + (64 - 32 * e.index()) + "px)")),
                t && t(e.data("item"))
            }, l = d('<div class="body-col"/>').on({
                wheel: function(t) {
                    c.addClass("scrolling").removeClass("transition");
                    var e = t.originalEvent.deltaY
                        , i = c.offset().top - l.offset().top - e
                        , i = Math.min(r.max, i)
                        , a = 0;
                    0 < (i = Math.max(r.min, i)) ? a = 2 - Math.round(i / 32) : i < 0 ? a = -(Math.round(i / 32) - 2) : 0 === i && (a = 2),
                        s.eq(a).addClass("select").siblings().removeClass("select"),
                        c.css(FX.Utils.formatTransform("translate(0," + i + "px)")),
                        n()
                },
                click: function(t) {
                    var e = d(t.target).closest(".col-item");
                    if (!e.length)
                        return !1;
                    e.addClass("select").siblings().removeClass("select"),
                        a(i.onColChange)
                }
            }).appendTo(t), c = d('<div class="col-wrapper"/>').appendTo(l);
            return e(i.items, i.value),
                {
                    replaceColItems: e,
                    getSelectItem: function() {
                        return d(".col-item.select", c).data("item")
                    }
                }
        },
        _createFoot: function() {
            var t = this
                , e = this.options
                , i = d('<div class="foot"/>').appendTo(this.$content)
                , a = d('<div class="btn-group"/>').appendTo(i);
            d('<div class="group-btn"/>').text(i18next.t("clear")).on("click", function() {
                t._setState({
                    start: {
                        time: null,
                        num: null,
                        unit: null
                    },
                    end: {
                        time: null,
                        num: null,
                        unit: null
                    }
                }),
                    t.editComp.val(""),
                    FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
            }).appendTo(a),
                d('<div class="group-btn style-green"/>').text(i18next.t("ok")).on("click", function() {
                    t._hideTriggerView(),
                        t._setEditCompText(),
                        FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                }).appendTo(a)
        },
        _setEditCompText: function() {
            var t = FX.Utils.getDataFilterText(this.state.start)
                , e = FX.Utils.getDataFilterText(this.state.end)
                , i = t ? t + " ~" : "";
            e && (i += /~/g.test(i) ? " " + e : "~ " + e),
                this.editComp.val(i)
        },
        _trigger: function() {
            var i = Array.prototype.slice.call(arguments)
                , a = i.shift()
                , n = this;
            FX.Utils.forEach(Object.keys(this.clientList), function(t, e) {
                if (new RegExp(e).test(a)) {
                    if (!n.clientList[e])
                        return;
                    FX.Utils.forEach(n.clientList[e], function(t, e) {
                        FX.Utils.applyFunc(n, e, [i], !1)
                    })
                }
            })
        },
        _setState: function(t) {
            var a = this
                , n = this.state;
            FX.Utils.forEach(t, function(i, t) {
                switch (i) {
                    case "start":
                    case "end":
                        FX.Utils.forEach(t, function(t, e) {
                            n[i][t] !== e && (n[i][t] = e,
                                a._trigger(i + "." + t, e))
                        });
                        break;
                    case "viewMode":
                        n[i] = t
                }
                a._trigger(i, t)
            })
        },
        _getFormatValue: function(t) {
            var e = {
                present: "",
                future: "+",
                past: "-",
                week: "w",
                day: "d",
                month: "M"
            };
            return t.time && t.num && t.unit ? e[t.time] + t.num + e[t.unit] : null
        },
        getValue: function() {
            var t = FX.Utils.pick(this.state, ["start", "end"]);
            return [this._getFormatValue(t.start), this._getFormatValue(t.end)]
        },
        setValue: function(t) {
            this._setState({
                start: FX.Utils.setDataFormatValue(t && t[0]),
                end: FX.Utils.setDataFormatValue(t && t[1])
            }),
                this._setEditCompText()
        }
    }),
        d.shortcut("timepicker", FX.TimePicker)
}(jQuery),
function(n) {
    FX.InputGroup = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return n.extend(FX.InputGroup.superclass._defaultConfig.apply(), {
                baseCls: "fui-input-group",
                prevEl: null,
                inputEl: {
                    type: "text"
                },
                nextEl: null,
                height: 30
            })
        },
        _init: function() {
            FX.InputGroup.superclass._init.apply(this, arguments);
            var t, e = this.options;
            e.prevEl && (t = n('<div class="addon" />').appendTo(this.element),
                FX.createWidget(n.extend({}, e.prevEl, {
                    renderEl: t,
                    customCls: "mask"
                })));
            var i, a = n('<div class="addon" />').appendTo(this.element);
            this.inputEl = FX.createWidget(n.extend({}, e.inputEl, {
                renderEl: a,
                height: e.height
            })),
            e.nextEl && (i = n('<div class="addon" />').appendTo(this.element),
                FX.createWidget(n.extend({}, e.nextEl, {
                    renderEl: i,
                    customCls: "mask"
                })))
        },
        getValue: function() {
            return this.inputEl.getValue()
        },
        setValue: function(t) {
            this.inputEl.setValue(t)
        },
        checkValidate: function() {
            return this.inputEl.checkValidate()
        },
        showErrorMsg: function(t) {
            this.inputEl.showErrorMsg(t)
        }
    }),
        n.shortcut("inputgroup", FX.InputGroup)
}(jQuery),
function(s) {
    FX.DeptSelect = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.DeptSelect.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_dept_select",
                API: FX._API,
                width: 240,
                height: 30,
                value: {
                    items: []
                },
                hasSelectEmpty: !0,
                dynamicType: "select",
                emptyId: "0",
                limit: {},
                onStopEdit: null,
                edge: {
                    width: 300,
                    height: 300
                }
            })
        },
        _init: function() {
            FX.DeptSelect.superclass._init.apply(this, arguments);
            var t = this.options;
            this.value = t.value || {
                items: []
            },
                this._initData()
        },
        _initData: function() {
            var e = this;
            if (FX.Utils.isObjectEmpty(this.value.items))
                return this.items = [],
                    void this._initSelectPane();
            var a = FX.Utils.createMask(this.element, {
                isLight: !0,
                hasLoader: !0
            });
            FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.corp.list_member_name),
                data: {
                    isDepartmentOnly: !0,
                    members: this.value.items
                }
            }, function(t) {
                var i = [];
                FX.Utils.forEach(t.departments, function(t, e) {
                    i.push({
                        _id: e._id,
                        name: e.name
                    })
                }),
                    e.items = i,
                    e._initSelectPane(),
                    a.remove()
            })
        },
        _getDynamicFields: function() {
            var t = this.options
                , e = [];
            return "set" === t.dynamicType && e.push({
                _id: FX.CONST.DEPT_ID.CURRENT,
                name: i18next.t("dept.current")
            }),
            t.hasSelectEmpty && e.push({
                _id: t.emptyId,
                name: i18next.t("unfilled")
            }),
                e
        },
        _initSelectPane: function() {
            var t = this.options
                , n = this;
            if (this.value.hasEmpty && this.items.unshift({
                _id: t.emptyId,
                name: i18next.t("unfilled")
            }),
                this.value.hasCurrentDept) {
                if ("set" !== t.dynamicType)
                    return void FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.current_departments)
                    }, function(t) {
                        var a = [];
                        FX.Utils.forEach(t.departmentList, function(t, e) {
                            var i = {
                                _id: e._id,
                                name: e.name
                            };
                            a.push(i),
                                n._updateValue(i, !0)
                        }),
                            n.items = a.concat(n.items),
                            n.value.hasCurrentDept = void 0,
                            n._createSelectList(),
                            n._bindEditEvent()
                    });
                this.items.unshift({
                    _id: FX.CONST.DEPT_ID.CURRENT,
                    name: i18next.t("dept.current")
                })
            }
            this._createSelectList(),
                this._bindEditEvent()
        },
        _bindEditEvent: function() {
            var n = this;
            this.$selectList.unbind("click"),
                this.$selectList.bind("click", function(t) {
                    var e;
                    0 < s(t.target).closest(".remove-btn").length && ((e = s(t.target).closest(".select-item").data("item")) && n._removeSelectItem(e)),
                    n.$selectPane || (n.$selectPane = s('<div class="dept-select-pane x-dropdown"/>').appendTo("body")),
                        n._createSelectPane(),
                        n._showSelectPane(),
                        n.$input.children("input").focus()
                }),
                this.$input.unbind("keydown"),
                this.$input.bind("keydown", function(t) {
                    if (FX.Utils.isEmpty(n.$input.children("input").val())) {
                        switch (t.keyCode) {
                            case 37:
                                var e = n.$input.prev(".select-item");
                                0 < e.length && n.$input.insertBefore(e);
                                break;
                            case 39:
                                var i = n.$input.next(".select-item");
                                0 < i.length && n.$input.insertAfter(i);
                                break;
                            case 8:
                                var a = n.$input.prev(".select-item");
                                0 < a.length && n._removeSelectItem(a.data("item"))
                        }
                        n.$input.children("input").focus()
                    }
                }),
                this.$input.unbind("keyup"),
                this.$input.bind("keyup", function() {
                    var t = n.$input.children("input").val();
                    n._createSelectPane(t)
                })
        },
        _createSelectPane: function(t) {
            var e = this
                , i = this.options;
            this.$selectPane.children(".select-search").remove(),
                this._createDynamicList(),
                FX.Utils.isEmpty(t) ? this.departmentTree ? this.departmentTree.setVisible(!0) : FX.Utils.dataAjax({
                    url: FX.Utils.getApi(i.API.data.departments)
                }, function(t) {
                    e.departments = s.extend(!0, [], t.departments),
                    e.departments[0] && !e.departments[0]._id && e.departments.shift(),
                        e._createDepartmentList()
                }) : (this.departmentTree && this.departmentTree.setVisible(!1),
                    this._createSearchList(t))
        },
        _calSelectPanePos: function() {
            var t = {
                "z-Index": FX.STATIC.zIndex++
            }
                , e = this.element.offset()
                , i = this.options.edge
                , a = document.body.clientWidth - e.left;
            return a < i.width ? (t.right = a - this.element.outerWidth(),
                t.left = "auto") : (t.right = "auto",
                t.left = e.left),
                document.body.clientHeight + document.body.scrollTop - e.top - this.element.outerHeight() < i.height ? (t.top = "auto",
                    t.bottom = document.body.clientHeight - e.top) : (t.top = e.top + this.element.outerHeight(),
                    t.bottom = "auto"),
                t
        },
        _showSelectPane: function() {
            var e = this;
            this.$selectPane.is(":visible") || (this.$selectPane.css(this._calSelectPanePos()),
                this.$selectPane.slideDown("fast"),
                s(document).bind("mousedown.hide", function(t) {
                    0 < s(t.target).closest(".dept-select-pane,.fx_dept_select").length || e._hideSelectPane()
                }))
        },
        _hideSelectPane: function() {
            var t = this.options;
            this.$input.children("input").val(""),
                this.$selectPane.slideUp("fast"),
                s(document).unbind("mousedown.hide"),
                FX.Utils.applyFunc(this, t.onStopEdit, [], !1)
        },
        _createSelectList: function() {
            var i = this;
            this.$selectList ? this.$selectList.empty() : this.$selectList = s('<ul class="select-list"/>').appendTo(this.element),
                this.$input = s('<li class="select-input"/>').append('<input placeholder="' + i18next.t("search") + '"/>').appendTo(this.$selectList),
                FX.Utils.forEach(this.items, function(t, e) {
                    i._createSelectItem(e)
                })
        },
        _addSelectItem: function(t) {
            this._createSelectItem(t),
                this._updateValue(t, !0),
                this.refresh()
        },
        _removeSelectItem: function(t) {
            s("#" + t._id, this.$selectList).remove(),
                this._updateValue(t, !1),
                this.refresh()
        },
        _updateValue: function(t, e) {
            var i = this.options;
            switch (t._id) {
                case i.emptyId:
                    this.value.hasEmpty = e;
                    break;
                case FX.CONST.DEPT_ID.CURRENT:
                    this.value.hasCurrentDept = e;
                    break;
                default:
                    var a = this.value.items.indexOf(t._id);
                    a < 0 && e && this.value.items.push(t._id),
                    -1 < a && !e && this.value.items.splice(a, 1)
            }
        },
        _createSelectItem: function(t) {
            if (t) {
                if (0 < s("#" + t._id, this.$selectList).length)
                    return;
                s('<li class="select-item"><i class="select-icon icon-department"/><span>' + t.name + '</span><span class="remove-btn"><i class="icon-close-normal"/></span></li>').attr("id", t._id).data("item", t).insertBefore(this.$input)
            }
        },
        _doSelectItem: function(t) {
            var e;
            this._checkLimit(t) && (e = {
                name: t.name,
                _id: t._id
            },
                -1 < this.value.items.indexOf(e._id) ? this._removeSelectItem(e) : this._addSelectItem(e))
        },
        _createDepartmentList: function() {
            var i = this;
            this.departmentTree = new FX.DepartmentsTree({
                renderEl: s("<div/>").appendTo(this.$selectPane),
                customCls: "x-department-tree select-department",
                Nodes: s.extend(!0, [], this.departments),
                setting: {
                    view: {
                        expandSpeed: 100
                    },
                    data: {
                        simpleData: {
                            enable: !0,
                            idKey: "departmentId",
                            pIdKey: "parentId"
                        }
                    },
                    callback: {
                        onCheck: function(t, e) {
                            i._doSelectItem(e)
                        },
                        onClick: function(t, e) {
                            i._doSelectItem(e)
                        },
                        beforeNodeCreate: function(t) {
                            i._checkLimit(t) || (t.nocheck = !0),
                                t.checked = i._checkSelectState(t)
                        },
                        onNodeCreated: function(t, e) {
                            e.isParent && !e.open && e.level < 1 && this.expandNode(e, !0),
                            e.departmentId == i.currentDepartment && this.selectNode(e)
                        }
                    },
                    check: {
                        enable: !0,
                        chkboxType: {
                            Y: "",
                            N: ""
                        }
                    }
                }
            })
        },
        _createDepartmentItem: function(t) {
            var i = this
                , a = s("<li/>").append(s("<span/>").text(t.name)).append(s('<div class="select-btn x-check"/>').append(s('<i class="icon-blank"/>'))).data("item", t).click(function() {
                var t, e = a.children(".select-btn");
                e.hasClass("select") ? (e.removeClass("select"),
                    i._removeSelectItem(a.data("item"))) : (e.addClass("select"),
                    t = a.data("item"),
                    i._addSelectItem(t))
            });
            return this._checkSelectState(t) && a.children(".select-btn").addClass("select"),
                a
        },
        _checkSelectState: function(t) {
            var e = this.options;
            switch (t._id) {
                case e.emptyId:
                    return this.value.hasEmpty;
                case FX.CONST.DEPT_ID.CURRENT:
                    return this.value.hasCurrentDept;
                default:
                    return -1 < this.value.items.indexOf(t._id)
            }
        },
        _createDynamicList: function() {
            var i = this;
            this.options;
            this.$dynamicList ? this.$dynamicList.show() : (this.$dynamicList = s('<ul class="department-list"/>').appendTo(this.$selectPane),
                FX.Utils.forEach(this._getDynamicFields(), function(t, e) {
                    i.$dynamicList.append(i._createDepartmentItem(e))
                }))
        },
        _createSearchList: function(t) {
            var i = this
                , a = []
                , e = s('<div class="select-search"/>').appendTo(this.$selectPane)
                , n = new RegExp(FX.Utils.escapeRegexp(t),"i");
            FX.Utils.forEach(this.departments, function(t, e) {
                n.test(e.name) && a.push(e)
            }),
                a.length <= 0 ? e.append(s('<div class="search-empty"/>').text(i18next.t("dept.empty"))) : (this.$searchList = s('<ul class="department-list"/>').appendTo(e),
                    FX.Utils.forEach(a, function(t, e) {
                        i._checkLimit(e) && i.$searchList.append(i._createDepartmentItem(e))
                    }))
        },
        _checkLimit: function() {
            return !0
        },
        getItems: function() {
            var i = [];
            return s(".select-item", this.$selectList).each(function(t, e) {
                i.push(s(e).data("item"))
            }),
                i
        },
        setValue: function(t) {
            this.value = t || {
                items: []
            },
                this._initData()
        },
        getValue: function() {
            return this.value
        },
        _refreshDepartmentList: function(t) {
            var a = this;
            s("li", t).each(function(t, e) {
                var i = s(e).data("item");
                i && (a._checkSelectState(i) ? s(e).children(".select-btn").addClass("select") : s(e).children(".select-btn").removeClass("select"))
            })
        },
        refresh: function() {
            this.departmentTree && this.departmentTree.refresh(),
            this.$dynamicList && this._refreshDepartmentList(this.$dynamicList),
            this.$searchList && this._refreshDepartmentList(this.$searchList)
        },
        rebuild: function(t) {
            this.setValue(t),
                this.refresh()
        }
    }),
        s.shortcut("deptselect", FX.DeptSelect)
}(jQuery),
function(s) {
    FX.Slider = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.Slider.superclass._defaultConfig.apply(this, arguments), {
                renderEl: s("<div />").appendTo("body"),
                baseCls: "x-slider",
                title: "",
                contentWidget: {},
                content: null,
                position: "bottom",
                contentWidth: "100%",
                contentTop: 45,
                onCreate: null,
                onBeforeClose: null,
                onClose: null,
                onShow: null,
                btn4Left: null,
                animateDuration: 218,
                autoClose: !1,
                onContentCreate: null,
                onHeaderCreate: null
            })
        },
        _init: function() {
            FX.Slider.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.element.css({
                "z-index": FX.STATIC.zIndex++
            }),
            t.position && this.element.addClass(t.position);
            var i = s('<div class="slider-body"/>').appendTo(this.element).css({
                width: t.contentWidth
            });
            "bottom" === t.position && i.css("top", t.contentTop);
            var a = s('<div class="slider-header"/>').appendTo(i);
            !1 === FX.Utils.applyFunc(this, t.onHeaderCreate, [a], !1) && a.append(s('<span class="title"/>').text(t.title)),
            FX.Utils.isNull(t.btn4Left) || s('<div class="header-btn"/>').text(t.btn4Left.text).on("click", function() {
                FX.Utils.applyFunc(this, t.btn4Left.onClick, [], !1)
            }).appendTo(a),
                s('<i class="icon-close-normal"/>').click(function() {
                    e._doClose()
                }).appendTo(a);
            var n = s('<div class="slider-main"/>').appendTo(i);
            this._createContent(n),
                this._bindEvent()
        },
        _createContent: function(t) {
            var e = this.options;
            !1 === FX.Utils.applyFunc(this, e.onContentCreate, [t], !1) && (FX.Utils.isObjectEmpty(e.contentWidget) ? t.append(e.content) : this.contentWidget = FX.createWidget(s.extend({
                renderEl: s("<div/>").appendTo(t)
            }, e.contentWidget)))
        },
        getContentWidget: function() {
            return this.contentWidget
        },
        _doClose: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onBeforeClose, null, !0) && this.close()
        },
        show: function() {
            var i = this.options
                , a = this;
            setTimeout(function() {
                a.element.addClass("fadein"),
                    setTimeout(function() {
                        var t = s(".slider-header", a.element)
                            , e = s(".slider-main", a.element);
                        FX.Utils.applyFunc(a, i.onShow, [t, e], !1)
                    }, i.animateDuration)
            }, 0)
        },
        close: function() {
            var t = this.options
                , e = this;
            this.element.removeClass("fadein"),
                setTimeout(function() {
                    e.element.remove(),
                        FX.Utils.applyFunc(e, t.onClose, [], !1)
                }, t.animateDuration)
        },
        _bindEvent: function() {
            var e = this
                , i = this.options;
            i.autoClose && this.element.click(function(t) {
                s(t.target).hasClass(i.baseCls) && e._doClose()
            })
        }
    })
}(jQuery),
function(i) {
    FX.Alert = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return i.extend(FX.Button.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-alert",
                type: "error",
                closable: !1,
                messageContent: "",
                onClose: null
            })
        },
        _init: function() {
            FX.Alert.superclass._init.apply(this, arguments);
            var t = this
                , e = this.options;
            e.type && this.element.addClass("alert-" + e.type),
            e.messageContent && i('<div class="alert-message" />').html(e.messageContent).appendTo(this.element),
            e.closable && (i('<i class="icon-close-normal alert-close" />').appendTo(this.element).click(function() {
                t.element.fadeOut(function() {
                    FX.Utils.applyFunc(t, e.onClose, [], !1)
                })
            }),
                this.element.addClass("has-close-btn"))
        }
    })
}(jQuery),
function(r) {
    FX.Pagination = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return r.extend(FX.Button.superclass._defaultConfig.apply(), {
                baseCls: "x-pagination",
                limit: 10,
                count: null,
                totalCount: 1,
                curPage: 1,
                showCount: !1,
                hasMore: !1,
                hasTurnLast: !1,
                hasJumpPage: !0,
                fetchCount: null,
                onChangePage: null,
                onLimitChange: null
            })
        },
        _init: function() {
            FX.Pagination.superclass._init.apply(this, arguments);
            var t = this.options;
            t.showCount && this._createCount().appendTo(this.element),
                this.curPage = t.curPage;
            var e = r('<div class="page-turn"/>').appendTo(this.element);
            this.$pre = r('<button class="page-btn pre" />').data("op", "pre").append('<i class="icon-angleleft" />').appendTo(e),
                this.$next = r('<button class="page-btn next" />').data("op", "next").append('<i class="icon-angleright" />').appendTo(e),
            FX.Utils.isNull(t.count) || this._createJumpPage(),
            t.hasTurnLast && (this.$first = r('<button class="page-btn first" />').data("op", "first").append('<i class="icon-firstpage" />').prependTo(e),
            !FX.Utils.isNull(t.count) && t.hasJumpPage && (this.$last = r('<button class="page-btn last" />').data("op", "last").append('<i class="icon-lastpage" />').appendTo(e))),
                this._checkPageBtn(),
                this._bindEvents()
        },
        _createCount: function() {
            var i = this
                , a = this.options
                , t = r('<div class="page-count"/>');
            return new FX.ComboBox({
                renderEl: r("<div />").appendTo(t),
                customCls: "count-sel",
                width: 116,
                height: 30,
                searchable: !1,
                allowBlank: !1,
                items: [{
                    value: 20,
                    text: i18next.t("pagination.limit", {
                        limit: "20"
                    })
                }, {
                    value: 50,
                    text: i18next.t("pagination.limit", {
                        limit: "50"
                    })
                }, {
                    value: 100,
                    text: i18next.t("pagination.limit", {
                        limit: "100"
                    })
                }],
                value: a.limit,
                onAfterItemSelect: function(t, e) {
                    FX.Utils.applyFunc(i, a.onLimitChange, [e.value], null)
                }
            }),
                FX.Utils.isNull(a.count) ? r('<span class="btn-count page-btn"/>').data("op", "count").append('<i class="icon-async"/>').append(r("<span />").text(i18next.t("data.doCount"))).appendTo(t) : r("<span />").text(this._getCountText()).appendTo(t),
                t
        },
        _getCountText: function() {
            var t = this.options;
            return t.hasTotalCount ? i18next.t("pagination.count.filtered", {
                count: t.count
            }) + " / " + i18next.t("pagination.count", {
                count: t.totalCount
            }) : i18next.t("pagination.count", {
                count: t.count
            })
        },
        _bindEvents: function() {
            var n = this
                , s = this.options;
            this.element.off(".pagination"),
                this.element.on("click.pagination", ".page-btn", function(t) {
                    var e = r(t.currentTarget)
                        , i = e.data("op");
                    if (!e.hasClass("disabled"))
                        switch (i) {
                            case "next":
                                n._turnPage(n.curPage + 1);
                                break;
                            case "pre":
                                n._turnPage(n.curPage - 1);
                                break;
                            case "first":
                                n._turnPage(1);
                                break;
                            case "last":
                                n._turnPage(Math.ceil(s.count / s.limit) || 1);
                                break;
                            case "count":
                                var a = n.element.find(".btn-count");
                                a.removeClass("page-btn").addClass("counting"),
                                    a.find("span").text(i18next.t("data.counting")),
                                    FX.Utils.applyFunc(n, s.fetchCount, [n._doCount], null)
                        }
                })
        },
        _createJumpPage: function() {
            var t, i, a = this, n = this.options;
            n.hasJumpPage && (t = r('<div class="page-jump" />').appendTo(this.element),
                i = Math.ceil(n.count / n.limit) || 1,
                a.$pageInput = new FX.Number({
                    renderEl: r('<div class="page-input" />').keyup(function(t) {
                        (t.keyCode || t.which) === FX.Keys.ENTER && r(this).children(".x-input-focus").blur()
                    }).appendTo(t),
                    value: this.curPage,
                    width: 35,
                    onStopEdit: function(t) {
                        var e;
                        t && ((e = this.getValue()) < 1 || i < e ? this.setState(FX.States.ERROR) : (a.curPage = e,
                            FX.Utils.applyFunc(a, n.onChangePage, [a.curPage, n.limit], !1)))
                    }
                }),
                r('<span class="total"/>').text(" / " + i).appendTo(t))
        },
        _doCount: function(t, e) {
            var i = this.options
                , a = this.element.find(".btn-count");
            a.removeClass(),
                FX.Utils.isNull(t) ? a.addClass("count-tip").text(i18next.t("data.doCount.timeout")) : (i.count = t,
                    i.totalCount = e,
                    a.text(this._getCountText()),
                    this._createJumpPage())
        },
        _turnPage: function(t) {
            var e = this.options;
            this.curPage = t,
            this.$pageInput && this.$pageInput.setValue(t),
                this._checkPageBtn(),
                FX.Utils.applyFunc(this, e.onChangePage, [t, e.limit], null)
        },
        _checkPageBtn: function() {
            var t = this.options
                , e = Math.ceil(t.count / t.limit) || 1;
            r(".page-btn", this.element).removeClass("disabled"),
            1 === this.curPage && (this.$pre.addClass("disabled"),
            this.$first && this.$first.addClass("disabled")),
            (FX.Utils.isNull(t.count) ? t.hasMore : this.curPage < e) || (this.$next.addClass("disabled"),
            this.$last && this.$last.addClass("disabled"))
        }
    })
}(jQuery),
function(o) {
    FX.FlowNodes = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.FlowNodes.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_flow_nodes",
                title: "",
                items: [],
                currentMenuId: null,
                onMenuClick: null,
                enable: !0,
                menuKey: null
            })
        },
        _init: function() {
            FX.FlowNodes.superclass._init.apply(this, arguments),
                this._createMenuName()
        },
        _createMenuName: function() {
            var i, t = this, a = this.options, e = a.title, n = o('<div class="menu-name"/>').appendTo(this.element);
            a.items.length && (i = a.items[0],
                FX.Utils.forEach(a.items, function(t, e) {
                    e.flowId === a.currentMenuId && (i = e)
                }),
            i && (a.currentMenuId = i.flowId),
                e = [e, i.name].join("  ")),
                n.append(o('<span class="menu-title"/>').text(e)),
            1 < a.items.length && n.append('<i class="menu-icon icon-caret-down"/>').on("click", function() {
                t._createMenuList(n)
            })
        },
        _createMenuList: function(t) {
            var a = this
                , n = this.options
                , s = o('<div class="fx_flow_nodes_list"/>').appendTo(this.element);
            FX.Utils.forEach(n.items, function(t, e) {
                var i = [n.title, e.name].join("  ")
                    , a = o('<div class="menu-item"/>').append('<i class="select-icon icon-ok"/>').append(o("<span/>").text(i)).appendTo(s).data("id", e.flowId);
                n.currentMenuId === e.flowId && a.addClass("select")
            }),
                s.on("click", ".menu-item", function(t) {
                    var e = o(t.currentTarget)
                        , i = e.data("id");
                    e.hasClass("select") || FX.Utils.applyFunc(a, n.onMenuClick, [i], !1),
                        r.close()
                });
            var r = FX.Msg.bubble({
                anchor: t,
                text4Ok: null,
                text4Cancel: null,
                minWidth: 230,
                contentHTML: s,
                hAdjust: t.width() / 2 - 28,
                contentPadding: 0,
                hasTriangle: !1
            })
        },
        refresh: function(t) {
            o(this.element).empty(),
                this.options = o.extend(this.options, t),
                this._createMenuName()
        }
    })
}(jQuery),
function(c) {
    FX.FlowBtn = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.FlowBtn.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_flow_btn",
                flow: {},
                maxShowNum: 4,
                onSubmit: null,
                submitEnable: !0,
                backFlowEmptyTip: i18next.t("flow.back.tip"),
                candidateEmptyTip: i18next.t("flow.candidate.tip")
            })
        },
        _init: function() {
            FX.FlowBtn.superclass._init.apply(this, arguments),
                this._initBtn()
        },
        _initBtn: function() {
            var e = this.options
                , i = this
                , t = e.flow.btn
                , a = []
                , n = [];
            t.print && a.push({
                text: t.print.text,
                style: "green",
                onClick: function() {
                    FX.Utils.applyFunc(i, e.onSubmit, ["print", !0], !1)
                }
            }),
            t.forward && a.push({
                text: t.forward.text,
                style: "green",
                enable: e.submitEnable,
                onClick: function() {
                    FX.Utils.applyFunc(i, e.onSubmit, ["forward", !0], !1)
                }
            }),
            t.save && a.push({
                text: t.save.text,
                enable: e.submitEnable,
                onClick: function() {
                    FX.Utils.applyFunc(i, e.onSubmit, ["save"], !1)
                }
            }),
            t.revoke && a.push({
                text: t.revoke.text,
                style: "white",
                onClick: function() {
                    FX.Utils.applyFunc(i, e.onSubmit, ["revoke"], !1)
                }
            }),
            t.back && a.push({
                text: t.back.text,
                style: "white",
                onClick: function() {
                    var t = e.flow.backNodes || [];
                    0 === t.length ? FX.Utils.applyFunc(i, e.onSubmit, ["back"], !1) : 1 === t.length ? FX.Utils.applyFunc(i, e.onSubmit, ["back", !1, {
                        backFlowIds: t
                    }], !1) : i._createBackDialog()
                }
            }),
            t.transfer && a.push({
                text: t.transfer.text,
                style: "white",
                onClick: function() {
                    i._createTransferDialog()
                }
            }),
            t.close && a.push({
                text: t.close.text,
                style: "white",
                onClick: function() {
                    FX.Msg.alert({
                        title: i18next.t("flow.close.confirm"),
                        msg: i18next.t("flow.close.desc"),
                        onOk: function() {
                            FX.Utils.applyFunc(i, e.onSubmit, ["close"], !1)
                        }
                    })
                }
            }),
            a.length > e.maxShowNum && (n = a.splice(e.maxShowNum - 1)),
                FX.Utils.forEach(a, function(t, e) {
                    i._appendBtn(e)
                }),
            0 < n.length && this._createMoreBtn(n)
        },
        _appendBtn: function(t, e) {
            e = e || c('<div class="flow-btn"/>').appendTo(this.element);
            this.options;
            new FX.Button(c.extend({
                renderEl: e,
                width: 118
            }, t))
        },
        _createMoreBtn: function(e) {
            var i = this;
            this._appendBtn({
                text: i18next.t("more"),
                customCls: "show-more-btn",
                style: "white",
                onClick: function() {
                    var t = FX.Msg.bubble({
                        customCls: "flow-more-btn-bubble",
                        anchor: c(".show-more-btn", i.element),
                        contentHTML: i._getMoreBtnContent(e, function() {
                            t.close()
                        }),
                        text4Cancel: null,
                        text4Ok: null,
                        hasTriangle: !1,
                        contentPadding: 0,
                        minWidth: 118,
                        hAdjust: 53,
                        vAdjust: 7
                    })
                }
            })
        },
        _getMoreBtnContent: function(t, i) {
            var a = c('<ul class="more-btn-content"/>');
            return FX.Utils.forEach(t, function(t, e) {
                c('<li class="btn-item"/>').text(e.text).prependTo(a).click(function() {
                    e.onClick(),
                    i && i()
                })
            }),
                a
        },
        _createTransferDialog: function() {
            var o = this
                , l = this.options
                , e = new FX.ConfirmDialog({
                customCls: "flow-transfer-dlg",
                title: l.flow.btn.transfer.text,
                text4Ok: i18next.t("ok"),
                width: 460,
                onOk: function() {
                    var t = o._getSelectedItem("user");
                    if (FX.Utils.isEmpty(t))
                        return FX.Msg.toast({
                            msg: i18next.t("flow.charger.select"),
                            type: "warning"
                        });
                    FX.Utils.applyFunc(o, l.onSubmit, ["transfer", !1, {
                        candidateId: t
                    }], !1),
                        e.close()
                },
                onContentCreate: function(t) {
                    var e = c('<div class="user-list-wrapper"/>').appendTo(t)
                        , i = c('<div class="list-title"/>').text(i18next.t("flow.charger.select")).appendTo(e)
                        , a = c('<div class="list-search"><i class="icon-search"></i></div>').appendTo(i)
                        , n = c('<input class="search-input" placeholder="' + i18next.t("form.search.placeholder") + '"/>').appendTo(a).on("input propertychange", FX.Utils.debounce(function() {
                        var t;
                        o.candidates && ((t = n.val().trim()) ? s.show() : s.hide(),
                            o._transferDlgFilter(t))
                    }, 500, o))
                        , s = c('<i class="icon-close-normal"></i>').appendTo(a).hide().on("click", function() {
                        n.val(""),
                            s.hide(),
                            o._transferDlgFilter("")
                    });
                    o.$userList = c('<div class="radio-list"/>').append(c('<div class="list-head"/>').text(i18next.t("flow.charger.name"))).appendTo(e),
                        o.$radioContainer = c("<div/>").appendTo(o.$userList);
                    var r = FX.Utils.createMask(o.$userList, {
                        isLight: !0,
                        hasLoader: !0
                    });
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(FX.API.data.allow_transfer_users),
                        data: {
                            appId: l.appId,
                            flowId: l.flow.flowId,
                            entryId: l.entryId,
                            dataId: l.flow.dataId
                        }
                    }, function(t) {
                        o.candidates = t.candidates,
                            FX.Utils.forEach(o.candidates, function(t, e) {
                                e.nickname = FX.Utils.escapeHtmlSpecialChar(e.nickname)
                            }),
                            o._createRadioList("transfer", o.candidates, o.$radioContainer, l.candidateEmptyTip)
                    }, null, function() {
                        r.remove()
                    })
                }
            });
            e.show()
        },
        _transferDlgFilter: function(t) {
            this._clearTransferDlg();
            var e, i = this.candidates;
            t && (e = FX.Utils.escapeHtmlSpecialChar(FX.Utils.escapeRegexp(t)),
                i = this._getFilterCandidates(e)),
                this._createRadioList("transfer", i, this.$radioContainer, i18next.t("form.search.empty"))
        },
        _clearTransferDlg: function() {
            this.$radioContainer.empty()
        },
        _getFilterCandidates: function(i) {
            var t = c.extend(!0, [], this.candidates)
                , a = [];
            return FX.Utils.forEach(t, function(t, e) {
                e.nickname && e.nickname.match(i) && (e.nickname = e.nickname.replace(new RegExp(i,"g"), '<span class="high-light">' + i + "</span>"),
                    a.push(e))
            }),
                a
        },
        _createBackDialog: function() {
            var a = this
                , n = this.options
                , e = new FX.ConfirmDialog({
                customCls: "flow-back-dlg",
                title: n.flow.btn.back.text,
                text4Ok: i18next.t("ok"),
                width: 460,
                onOk: function() {
                    var t = a._getSelectedItem("flow");
                    if (FX.Utils.isEmpty(t))
                        return FX.Msg.toast({
                            msg: i18next.t("flow.node.select"),
                            type: "warning"
                        });
                    FX.Utils.applyFunc(a, n.onSubmit, ["back", !1, {
                        backFlowIds: [t]
                    }], !1),
                        e.close()
                },
                onContentCreate: function(t) {
                    var e = c('<div class="flow-list-wrapper">').appendTo(t);
                    c('<div class="list-title"/>').text(i18next.t("flow.node.select")).appendTo(e),
                        a.$flowList = c('<div class="radio-list"/>').append(c('<div class="list-head"/>').text(i18next.t("flow.node.name"))).appendTo(e);
                    var i = FX.Utils.createMask(a.$flowList, {
                        isLight: !0,
                        hasLoader: !0
                    });
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(FX.API.data.allow_back_nodes),
                        data: {
                            appId: n.appId,
                            flowId: n.flow.flowId,
                            entryId: n.entryId,
                            dataId: n.flow.dataId
                        }
                    }, function(t) {
                        FX.Utils.forEach(t.flowNodes, function(t, e) {
                            e.name = FX.Utils.escapeHtmlSpecialChar(e.name)
                        }),
                            a._createRadioList("back", t.flowNodes, a.$flowList, n.backFlowEmptyTip)
                    }, null, function() {
                        i.remove()
                    })
                }
            });
            e.show()
        },
        _createRadioList: function(t, e, a, i) {
            var n = "transfer" === t ? "_id" : "flowId"
                , s = this;
            FX.Utils.forEach(e, function(t, e) {
                var i = c('<div class="radio-item x-radio"/>').data("dataId", e[n]).append(c('<i class="icon-blank"/>')).append(c('<span class="data-name"/>').html(e.nickname || e.name)).appendTo(a);
                e[n] === s.currentTransferId && (i.hasClass("select") || i.addClass("select").siblings().removeClass("select"))
            }),
            0 === c(".radio-item", a).length && c('<div class="empty-tip"/>').text(i).appendTo(a),
                a.on("click", ".radio-item", function(t) {
                    var e = c(t.currentTarget);
                    s.currentTransferId = c(this).data("dataId"),
                    e.hasClass("x-ui-disable") || e.hasClass("select") || e.addClass("select").siblings().removeClass("select")
                })
        },
        _getSelectedItem: function(t) {
            var e = ""
                , i = "flow" === t ? this.$flowList : this.$userList
                , a = c(".radio-item.select", i)
                , n = a.data("dataId");
            return 0 < a.length && (e = "flow" === t ? parseInt(n) : n),
                e
        }
    }),
        c.shortcut("flowbtn", FX.FlowBtn)
}(jQuery),
function(a) {
    FX.Tip = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.Tip.superclass._defaultConfig.apply(), {
                baseCls: "x-tip",
                msgType: "",
                msg: ""
            })
        },
        _init: function() {
            FX.Tip.superclass._init.apply(this, arguments);
            var t = this.options
                , e = a('<div class="tip-message">' + t.msg + "</div>").appendTo(this.element.css({
                "z-index": FX.STATIC.zIndex++
            }));
            t.msgType && e.addClass(t.msgType)
        },
        doResize: function(t) {
            var e = this.options
                , i = a.extend({}, FX.Utils.pick(e, ["width", "height"]));
            i.height && (i["line-height"] = i.height - 2 + "px"),
                this.element.css(i)
        }
    }),
        a.shortcut("tip", FX.Tip)
}(jQuery),
function(t) {
    FX.TextTag = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return t.extend(FX.TextTag.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui-text-tag",
                size: "middle",
                bgColor: "",
                fontColor: "",
                fontSize: "",
                maxWidth: "",
                borderColor: "",
                multiLine: !1,
                text: "",
                html: null,
                borderRadius: ""
            })
        },
        _init: function() {
            FX.TextTag.superclass._init.apply(this, arguments);
            var t, e = this.options, i = e.fontColor;
            !i && e.bgColor && (t = FX.Utils.hexToRgbJson(e.bgColor),
                i = FX.Utils.isDarkColor(t.r, t.g, t.b) ? "#fff" : "#333");
            var a = e.borderColor || e.bgColor || "#D9D9D9"
                , n = {
                "background-color": e.bgColor,
                color: i,
                "max-width": e.maxWidth,
                border: "1px solid " + a,
                "border-radius": e.borderRadius,
                "font-size": e.fontSize
            };
            this.element.addClass(e.size),
                this.element.addClass(e.multiLine ? "multi-line" : "single-line"),
                this.element.css(n),
                e.html ? this.element.append(e.html) : e.text ? this.element.text(e.text) : this.element.remove()
        }
    }),
        t.shortcut("texttag", FX.TextTag)
}(jQuery),
function(a) {
    FX.Tag = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.Tag.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_tag",
                text: "",
                subText: "",
                closable: !0,
                style: "green",
                iconCls: "icon-angledown",
                customIcon: "",
                height: 24,
                onClose: null,
                onClick: null
            })
        },
        _init: function() {
            FX.Tag.superclass._init.apply(this, arguments);
            var e = this
                , t = this.options;
            this.$tagWrapper = a('<div class="tag-wrapper"/>').appendTo(this.element),
            t.iconCls && a('<i class="tag-icon"/>').addClass(t.iconCls).appendTo(this.$tagWrapper),
            t.customIcon && a('<i class="tag-icon custom-icon"/>').addClass(t.customIcon).appendTo(this.$tagWrapper),
            FX.Utils.isEmpty(t.style) || this.$tagWrapper.addClass("style-" + t.style);
            var i = a('<div class="text-wrapper"/>').appendTo(this.$tagWrapper);
            this.$tag = a('<span class="tag-text"/>').appendTo(i),
                this.$subText = a('<span class="sub-text"/>').text(t.subText).appendTo(i),
            this.isEnabled() && (this.element.click(function() {
                FX.Utils.applyFunc(e, t.onClick, [e.$tag], !1)
            }),
            t.closable && (this.element.addClass("closable"),
                this.$deleteIcon = a('<i class="icon-close-circle"/>').on("click", function(t) {
                    e.close(),
                        t.stopEvent()
                }).appendTo(this.$tagWrapper)))
        },
        close: function() {
            var t = this.options;
            !1 === FX.Utils.applyFunc(this, t.onClose, [], !1) && this.destroy()
        },
        doResize: function(t) {
            var e = this.options;
            FX.Tag.superclass.doResize.apply(this, arguments),
            FX.Utils.isEmpty(e.height) || this.element.css({
                "line-height": e.height + "px"
            })
        },
        setSubText: function(t) {
            t = FX.Utils.isNull(t) ? "" : t,
                this.$subText.text(t)
        },
        setCustomIcon: function(t) {
            a(".custom-icon", this.element).remove(),
            t && a(".text-wrapper", this.element).before('<i class="tag-icon custom-icon ' + t + '"/>')
        },
        setText: function(t) {
            t = FX.Utils.isNull(t) ? "" : t,
                this.$tag.text(t)
        },
        setValue: function(t) {
            this.setText(t)
        }
    }),
        a.shortcut("tag", FX.Tag)
}(jQuery),
function(a) {
    FX.Empty = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.Empty.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_empty",
                image: "",
                imageHeight: 140,
                title: "",
                description: "",
                extra: null,
                onCreateExtra: null
            })
        },
        _init: function() {
            FX.Empty.superclass._init.apply(this, arguments);
            var t, e, i = this.options;
            i.image && (t = a('<div class="empty-img"/>').appendTo(this.element),
                FX.Utils.isString(i.image) ? (i.imageHeight && t.height(i.imageHeight),
                    a('<img src="' + i.image + '"/>').appendTo(t)) : t.append(i.image)),
            i.title && a('<div class="empty-title"/>').append(i.title).appendTo(this.element),
            i.description && a('<div class="empty-description">').append(i.description).appendTo(this.element),
            (i.extra || i.onCreateExtra) && (e = a('<div class="empty-extra"/>').appendTo(this.element),
                i.extra ? e.append(e) : FX.Utils.applyFunc(this, i.onCreateExtra, [e], !1))
        }
    })
}(jQuery),
function(n) {
    FX.I18nPhone = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return n.extend(FX.I18nPhone.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fui_i18n_phone",
                inputCls: "x-input",
                waterMark: "",
                height: 40,
                phoneDelimiter: "-",
                onAfterValidate: null,
                onBeforeEdit: null,
                onStopEdit: null,
                allowBlank: !1
            })
        },
        _init: function() {
            FX.I18nPhone.superclass._init.apply(this, arguments);
            var i = this
                , a = this.options;
            this.chinaCode = FX.CONST.CHINA_CODE,
                this.$input = n('<input class="phone-input" placeholder="' + a.waterMark + '"type="number" >').appendTo(this.element),
                this.$input.blur(function(t) {
                    var e;
                    i.isEnabled() && (i.$input.removeClass(a.inputCls + "-focus"),
                    (e = i.checkValidate()) && FX.Utils.applyFunc(i, a.onStopEdit, [e, t], !1))
                }).focus(function(t) {
                    i.isEnabled() && (i.$input.addClass(a.inputCls + "-focus"),
                        FX.Utils.applyFunc(i, a.onBeforeEdit, [t], !1))
                }),
                this.$btn = n('<div class="phone-btn"/>').appendTo(this.element),
                this.$selectText = n('<div class="phone-code"/>').text(this.chinaCode).css({
                    height: a.height,
                    "line-height": a.height - 2 + "px"
                }).appendTo(this.$btn),
                this.$select = n('<select name="location" class="location-select" tabindex="-1"/>').appendTo(this.$btn),
                FX.Utils.forEach(FX.CONST.AREA_CODE, function(t, e) {
                    n('<option value="' + e.value + '" ' + (e.value === i.chinaCode ? "selected" : "") + ">" + e.text + " " + e.value + "</option>").appendTo(i.$select)
                }),
                n('<i class="icon-angledown"/>').css({
                    "line-height": a.height - 2 + "px"
                }).appendTo(this.$btn),
                this.$select.on("change", function(t) {
                    i.$selectText.text(t.target.value)
                }),
                this.state = FX.States.NORMAL
        },
        getValue: function() {
            return FX.Utils.isEmpty(this.$input.val()) ? "" : this.$select.val() + this.options.phoneDelimiter + this.$input.val()
        },
        setValue: function(t) {
            var e, i, a, n = this.options;
            FX.Utils.isEmpty(t) ? this.$input.val("") : (t = FX.Utils.formatInterMobile(t, n.phoneDelimiter),
            new RegExp(n.phoneDelimiter).test(t) || (t = n.phoneDelimiter + t),
            (e = t.split(n.phoneDelimiter)) && (i = e[0],
            FX.Utils.isEmpty(i) && (i = this.chinaCode),
                this.$select.val(i),
                this.$selectText.text(i),
            (a = e[1]) && this.$input.val(a)))
        },
        setState: function(t) {
            var e = this.options
                , i = e.inputCls + "-error " + e.inputCls + "-success " + e.inputCls + "-warning";
            switch (this.state = t) {
                case FX.States.SUCCESS:
                    this.$input.removeClass(i).addClass(e.inputCls + "-success");
                    break;
                case FX.States.ERROR:
                    this.$input.removeClass(i).addClass(e.inputCls + "-error");
                    break;
                case FX.States.WARNING:
                    this.$input.removeClass(i).addClass(e.inputCls + "-warning");
                    break;
                default:
                    this.$input.removeClass(i)
            }
        },
        getState: function() {
            return this.state
        },
        checkValidate: function() {
            var t = this.options
                , e = this.$input.val().trim()
                , i = !0;
            if (FX.Utils.isEmpty(e))
                i = t.allowBlank;
            else
                try {
                    i = new RegExp("^\\d+$").test(e)
                } catch (t) {
                    i = !1
                }
            return i ? this.setState(FX.States.NORMAL) : this.setState(FX.States.ERROR),
                FX.Utils.applyFunc(this, t.onAfterValidate, [e, i], !1),
                i
        },
        setEnable: function(t) {
            FX.I18nPhone.superclass.setEnable.apply(this, arguments),
                t ? (this.$input.removeAttr("readOnly"),
                    this.$select.removeAttr("disabled")) : (this.$input.attr("readOnly", "readOnly"),
                    this.$select.attr("disabled", "disabled"))
        },
        select: function() {
            this.$input && (this.$input.select(),
                this.$input.focus())
        }
    }),
        n.shortcut("i18nphone", FX.I18nPhone)
}(jQuery),
function(l) {
    FX.Cascader = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return l.extend(FX.Cascader.superclass._defaultConfig.apply(this, arguments), {
                renderEl: l("<div/>").appendTo("body"),
                baseCls: "fui_cascader",
                anchor: null,
                items: [],
                colWidth: 160,
                hAdjust: 0,
                autoClose: !0,
                onItemCreate: null,
                onItemClick: null,
                onItemHover: null,
                onItemHoverOut: null,
                onBeforeHide: null
            })
        },
        _init: function() {
            FX.Cascader.superclass._init.apply(this, arguments);
            var t = this.options;
            this.$ul = l('<ul class="cs-list"/>').css({
                width: t.colWidth
            }).appendTo(this.element),
                this._createItemList(this.$ul, t.items),
                this._initListPos(t.anchor),
                this._bindEvents()
        },
        _createItemList: function(a, t) {
            var n = this.options
                , s = this;
            FX.Utils.forEach(t, function(t, e) {
                var i = l('<li class="cs-item"/>').data("item", e).hover(function() {
                    var t = s.getItemPath(i);
                    FX.Utils.applyFunc(s, n.onItemHover, [i, e, t], !1)
                }, function() {
                    var t = s.getItemPath(i);
                    FX.Utils.applyFunc(s, n.onItemHoverOut, [i, e, t], !1)
                }).appendTo(a);
                !1 === FX.Utils.applyFunc(s, n.onItemCreate, [i, e], !1) && s._createItem(i, e)
            })
        },
        _createItem: function(t, e) {
            var i, a, n, s, r, o = this.options;
            t && e && (i = !FX.Utils.isObjectEmpty(e.children),
                a = e.text || e.value || "",
                n = l('<a class="cs-text">').attr("title", a).text(a).appendTo(t),
                s = l('<i class="cs-item-icon"/>').appendTo(n),
            e.withLine && t.addClass("cs-item-line"),
            e.disabled && t.addClass("cs-item-disable"),
            e.selected && !i && t.addClass("cs-item-selected"),
                i ? (t.addClass("cs-item-expand"),
                    s.addClass("icon-arrow-right"),
                    r = l('<ul class="cs-list cs-sub-list"/>').css({
                        width: o.colWidth
                    }).appendTo(t),
                    this._createItemList(r, e.children)) : s.addClass("icon-ok"))
        },
        _initListPos: function(t) {
            var e, i, a, n, s;
            t && (e = this.options,
                i = t.offset(),
                a = t.outerHeight(),
                n = {
                    "z-index": FX.STATIC.zIndex++,
                    left: i.left + e.hAdjust,
                    top: i.top + a
                },
            (s = document.body.clientHeight - i.top - a) < this.element.outerHeight() && (n.bottom = s + a,
                n.top = "auto"),
                this.element.css(n))
        },
        _bindEvents: function() {
            var n = this.options
                , s = this;
            this.$ul.on("click", function(t) {
                var e = l(t.target).closest(".cs-item");
                if (e.length) {
                    var i = e.data("item")
                        , a = s.getItemPath(e);
                    if (FX.Utils.applyFunc(s, i.click, [i], !1),
                    !1 === FX.Utils.applyFunc(s, n.onItemClick, [e, i, a], !1)) {
                        if (i.disabled || !FX.Utils.isObjectEmpty(i.children))
                            return;
                        s.setItemSelected(e, i),
                            s.hideList()
                    }
                }
            }),
            n.autoClose && (l(document).off("mousedown.cs"),
                l(document).on("mousedown.cs", function(t) {
                    l(t.target).closest(s.element).length || s.hideList()
                }))
        },
        getItemPath: function(t) {
            var a = []
                , e = t.data("item");
            return e && a.unshift(e.value),
                FX.Utils.forEach(t.parents(".cs-item"), function(t, e) {
                    var i = l(e).data("item");
                    i && a.unshift(i.value)
                }),
                a
        },
        setItemSelected: function(t, e) {
            !e.disabled && FX.Utils.isObjectEmpty(e.children) && (t.siblings().removeClass("cs-item-selected"),
                t.addClass("cs-item-selected"))
        },
        hideList: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onBeforeHide, [], !1),
                this.destroy()
        }
    })
}(jQuery),
function(C) {
    FX.Calendar = FX.extend(FX.Widget, {
        CONSTS: {
            VIEWMODE: {
                MONTH: 0,
                WEEK: 1
            },
            MINYEAR: 1900,
            MAXYEAR: 2999,
            NAV: {
                prevm: 2,
                nextm: 3,
                title: 4,
                clear: 5,
                today: 6,
                to_week: 14,
                dok: 7,
                prevy: 8,
                nexty: 9,
                cancel: 10,
                mok: 11,
                plus: 12,
                minus: 13,
                current: 15,
                prevw: 16,
                nextw: 17,
                title_week: 18,
                day: 100,
                month: 200,
                year: 300
            }
        },
        _TT: {
            TODAY: i18next.t("today"),
            TO_WEEK: i18next.t("date.thisWeek"),
            MONTH: i18next.t("month"),
            DAY: i18next.t("day"),
            DAY_SHORT: i18next.t("day.short"),
            WEEK: i18next.t("week")
        },
        _defaultConfig: function() {
            return C.extend(FX.Calendar.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "x-calendar",
                viewMode: this.CONSTS.VIEWMODE.MONTH,
                onBlockContentCreate: null,
                onWeekContentCreate: null,
                date: new Date,
                pointDays: [],
                maxCellHeight: 60
            })
        },
        _init: function() {
            FX.Calendar.superclass._init.apply(this, arguments),
                this.cache = {
                    showYear: null,
                    showMonth: null
                },
                this.vm = this.options.viewMode;
            var t = C('<div class="calendar-header"/>').appendTo(this.element);
            C('<div class="calendar-body"/>').appendTo(this.element),
                this._createHead(t),
                this._initView(),
                this._bindEvts()
        },
        _initView: function() {
            var t = this.CONSTS.VIEWMODE;
            switch (this.vm) {
                case t.MONTH:
                    this.$weekView && this.$weekView.hide(),
                        this.$monthView ? (this.$monthView.show(),
                            this._loadDateData(this.$dateTable, new Date(this.options.date))) : this.$monthView = this._createMonthView();
                    break;
                case t.WEEK:
                    this.$monthView && this.$monthView.hide(),
                        this.$weekView ? (this.$weekView.show(),
                            this._loadWeekData(this.$weekView, new Date(this.options.date))) : this.$weekView = this._createWeekView()
            }
            this._initNav()
        },
        _initNav: function() {
            var t = this.CONSTS.VIEWMODE
                , e = this.CONSTS.NAV;
            switch (this.vm) {
                case t.MONTH:
                    this.$tBtn.data("nav", e.today).text(this._TT.TODAY),
                        this.$prev.data("nav", e.prevm),
                        this.$next.data("nav", e.nextm),
                        this.$title.data("nav", e.title);
                    break;
                case t.WEEK:
                    this.$tBtn.data("nav", e.to_week).text(this._TT.TO_WEEK),
                        this.$prev.data("nav", e.prevw),
                        this.$next.data("nav", e.nextw),
                        this.$title.data("nav", e.title_week)
            }
        },
        _createHead: function(t) {
            var e = this
                , i = C('<div class="nav left"/>').appendTo(t)
                , a = C('<div class="menu"/>').appendTo(i);
            this.$prev = C('<div class="btn menu-btn icon-btn"><i class="icon-angleleft"></i></div>').appendTo(a),
                this.$title = C('<div class="btn menu-btn text-btn"/>').appendTo(a),
                this.$next = C('<div class="btn menu-btn icon-btn"><i class="icon-angleright"></i></div>').appendTo(a),
                this.$tBtn = C('<div class="menu-btn t-btn btn"/>').appendTo(a);
            var n = C('<div class="nav right"/>').appendTo(t);
            new FX.Segment({
                renderEl: C("<div/>").appendTo(n),
                customCls: "calendar-segment",
                items: [{
                    text: this._TT.WEEK,
                    value: this.CONSTS.VIEWMODE.WEEK
                }, {
                    text: this._TT.MONTH,
                    value: this.CONSTS.VIEWMODE.MONTH
                }],
                value: this.vm,
                height: 25,
                onAfterItemSelect: function() {
                    var t = this.getValue();
                    t !== e.vm && (e.vm = t,
                        e._initView(),
                        e._bindEvts())
                }
            })
        },
        _createMonthView: function() {
            var t = this.options
                , e = C(".calendar-body", this.element)
                , i = C('<div class="full-body"/>').appendTo(e)
                , a = C('<div class="day-body"/>').appendTo(i)
                , n = C('<div class="block-body"/>').appendTo(i);
            return this.$dateTable = this._createDatePicker().appendTo(a),
                this.$monthTable = this._createMonthPicker(),
            !1 === FX.Utils.applyFunc(this, t.onBlockContentCreate, [n], !1) && (n.remove(),
                this.$dateTable.addClass("full-body")),
                this._loadDateData(this.$dateTable, new Date(t.date)),
                i
        },
        _createWeekView: function() {
            for (var t = C(".calendar-body", this.element), e = C('<div class="full-body week-body"/>').appendTo(t), i = C('<div class="body-menu"/>').appendTo(e), a = C('<div class="body-wrapper"/>').appendTo(e), n = C('<div class="wrapper-content"/>').appendTo(a), s = 0; s < 7; s++)
                C('<div class="menu-label"/>').appendTo(i),
                    C('<div class="wrapper-line"/>').appendTo(n);
            return this._loadWeekData(e, new Date(this.options.date)),
                e
        },
        _createMonthPicker: function() {
            var t = this.CONSTS.NAV
                , e = C("<div/>").addClass(this.options.baseCls)
                , i = C('<div class="calendar-header custom"/>').appendTo(e)
                , a = C('<div class="nav left"/>').appendTo(i)
                , n = C('<div class="menu"/>').appendTo(a);
            this.$prevy = C('<div class="btn menu-btn icon-btn"><i class="icon-angleleft"></i></div>').data("nav", t.prevy).appendTo(n),
                this.$titley = C('<div class="nav left custom"/>').appendTo(i);
            var s = C('<div class="nav right"/>').appendTo(i)
                , r = C('<div class="menu"/>').appendTo(s);
            this.$nexty = C('<div class="btn menu-btn icon-btn"><i class="icon-angleright"></i></div>').data("nav", t.nexty).appendTo(r);
            for (var o = C('<table cellspacing = "2px" cellpadding = "0" />').appendTo(e), l = C('<tbody onselectstart="return false"/>').appendTo(o), c = 2; 0 < c; c--)
                for (var d = C("<tr/>").appendTo(l), u = 0; u < 6; u++)
                    C('<td class="btn custom"/>').appendTo(d);
            return e
        },
        _createDatePicker: function() {
            for (var t = C('<table cellspacing = "2px" cellpadding = "0" />'), e = C("<thead/>").appendTo(t), i = C("<tr/>").appendTo(e), a = 0; a < 7; a++) {
                var n = a + 1 === 7 ? 0 : a + 1;
                C('<td class="day name"/>').text(FX.Utils.getDateSDN()[n]).appendTo(i)
            }
            for (var s = C('<tbody onselectstart="return false"/>').appendTo(t), a = 6; 0 < a; a--)
                for (var i = C("<tr/>").appendTo(s), r = 0; r < 7; r++)
                    C('<td class="btn"/>').appendTo(i);
            return t
        },
        _loadWeekData: function(t, e) {
            var i = this.options
                , a = e.getDay() || 7
                , n = e.getDate()
                , s = []
                , r = [];
            e.setDate(n - a);
            for (var o = C(".body-wrapper", t).outerHeight(), l = C(".body-menu > .menu-label", t), c = C(".body-wrapper > .wrapper-content", t), d = C(".wrapper-line", c), u = {}, h = 0; h < 7; h++) {
                e.setDate(e.getDate() + 1),
                    l.eq(h).text(e.getDate() + " " + FX.Utils.getCustomDateSDN()[h]);
                var p = d.eq(h);
                p.empty(),
                    s.push(new Date(e));
                var f = C('<div class="line-content"/>').appendTo(p);
                r.push(f),
                    o = Math.max(o, f.outerHeight()),
                    u[FX.Utils.date2Str(e)] = f
            }
            var m = s.shift()
                , g = s.pop();
            this.$title.text(FX.Utils.getDateMNShort()[m.getMonth()] + m.getDate() + this._TT.DAY_SHORT + "-" + FX.Utils.getDateMNShort()[g.getMonth()] + g.getDate() + this._TT.DAY_SHORT),
                FX.Utils.forEach(r, function(t, e) {
                    e.css("min-height", o)
                }),
                FX.Utils.applyFunc(this, i.onWeekContentCreate, [u, c], !1)
        },
        _loadMonthData: function(t, e, i) {
            var a = e.getFullYear()
                , n = e.getMonth();
            this.$titley.text(a);
            var s, r, o, l, c = this.options, d = c.endDate, u = c.startDate;
            d && d && a === (s = d.getFullYear()) && (r = d.getMonth()),
            (!s || s > this.CONSTS.MAXYEAR) && (s = this.CONSTS.MAXYEAR),
            u && u && a === (o = u.getFullYear()) && (l = u.getMonth()),
            (!o || o < this.CONSTS.MINYEAR) && (o = this.CONSTS.MINYEAR);
            for (var h = t.find("tbody").children().eq(0), p = 0; p < 2; p++) {
                if (!h.length)
                    return;
                for (var f = h.children(), m = 0; m < 6; m++) {
                    var g = f.eq(m)
                        , _ = 6 * p + m;
                    if (g.removeClass().data("month", _).data("nav", this.CONSTS.NAV.month),
                        !g.length)
                        return;
                    g.empty().append(C('<div class="day-wrapper"/>').append(C('<div class="day-item"/>').text(FX.Utils.getDateMNShort()[_]))),
                    _ === n && (this.cache.selectedMonth && this.cache.selectedMonth.removeClass("selected"),
                        g.addClass("selected"),
                        this.cache.selectedMonth = g),
                        !FX.Utils.isEmpty(l) && _ < l || !FX.Utils.isEmpty(r) && r < _ ? g.addClass("disabled").data("disabled", !0) : g.removeClass("disabled").addClass("day btn custom").data("disabled", !1)
                }
                h = h.next()
            }
            this.$prevy.removeClass("disabled").data("disabled", !1),
            a <= o && this.$prevy.addClass("disabled").data("disabled", !0),
                this.$nexty.removeClass("disabled").data("disabled", !1),
            s <= a && this.$nexty.addClass("disabled").data("disabled", !0),
            (i = !1 !== i) && FX.Msg.bubble({
                anchor: this.$title,
                text4Cancel: "",
                text4Ok: "",
                contentPadding: 15,
                hAdjust: 60,
                contentHTML: t,
                onClose: function() {
                    return t.detach(),
                        !1
                }
            })
        },
        _loadDateData: function(t, e) {
            var i = this.options;
            if (e) {
                var a = e.getFullYear()
                    , n = e.getMonth()
                    , s = e.getDate()
                    , r = new Date
                    , o = r.getFullYear()
                    , l = r.getMonth()
                    , c = r.getDate();
                this.cache.showYear = a,
                    this.cache.showMonth = n,
                    this.$title.text(FX.Utils.getDateMN()[n] + "" + a);
                var d = this.options.startDate
                    , u = this.options.endDate
                    , h = new Date(e);
                h.setDate(FX.Utils.getMonthDays(a, n) + 1),
                    u && u < h || h.getFullYear() > this.CONSTS.MAXYEAR ? this.$next.addClass("disabled").data("disabled", !0) : this.$next.removeClass("disabled").data("disabled", !1);
                var p = new Date(e);
                p.setDate(0),
                    d && p < d || p.getFullYear() < this.CONSTS.MINYEAR ? this.$prev.addClass("disabled").data("disabled", !0) : this.$prev.removeClass("disabled").data("disabled", !1),
                    e.setDate(1);
                var f = 7 & e.getDay() || 7;
                e.setDate(1 - f),
                    e.setDate(e.getDate() + 1);
                for (var m = t.find("tbody").children().eq(0), g = 0; g < 6; g++) {
                    if (!m.length)
                        return;
                    for (var _, v = m.children(), F = 0; F < 7; F++,
                        e.setDate(_ + 1)) {
                        var y = v.eq(F);
                        if (y.removeClass().data("nav", this.CONSTS.NAV.day),
                            !y.length)
                            return;
                        _ = e.getDate(),
                            y.empty().append(C('<div class="day-wrapper"><div class="day-item">' + _ + "</div></div>"));
                        var b, T = e.getMonth() === n;
                        T ? (b = !1,
                            b = null !== d && e < d || null !== u && u < e ? (y.addClass("day disabled"),
                                !0) : (y.addClass("day btn"),
                                !1),
                            y.data("disabled", b),
                        -1 < i.pointDays.indexOf(e.getDate()) && y.addClass("has-point"),
                        b || (T && _ === s && (this.cache.selectedDate && this.cache.selectedDate.removeClass("selected"),
                            y.addClass("selected"),
                            this.cache.selectedDate = y,
                            this.cache.showDay = _),
                        e.getFullYear() === o && e.getMonth() === l && _ === c && y.addClass("today"))) : y.addClass("oday").data("disabled", !0)
                    }
                    m = m.next()
                }
                FX.Utils.applyFunc(this, i.onDateUpdate, [], !1)
            }
        },
        _bindEvts: function() {
            function t(t) {
                var e, i = t.target, a = C(i).closest(".btn"), n = a.data("nav");
                if (!a.data("disabled") && 0 !== a.length && n)
                    switch (o.options.date || (o.options.date = new Date),
                        n) {
                        case c.prevm:
                            o._toPrevMonth(),
                                o._loadDateData(o.$dateTable, new Date(o.options.date));
                            break;
                        case c.nextm:
                            o._toNextMonth(),
                                o._loadDateData(o.$dateTable, new Date(o.options.date));
                            break;
                        case c.prevw:
                            (e = l.date).setDate(e.getDate() - 7),
                                o._loadWeekData(o.$weekView, new Date(e));
                            break;
                        case c.nextw:
                            (e = l.date).setDate(e.getDate() + 7),
                                o._loadWeekData(o.$weekView, new Date(e));
                            break;
                        case c.title:
                            o._loadMonthData(o.$monthTable, new Date(o.options.date));
                            break;
                        case c.title_week:
                            var s = C("<div/>");
                            new FX.DatetimePicker({
                                renderEl: s,
                                startDate: l.startData,
                                endDate: l.endDate,
                                date: l.date,
                                hasFooterBtn: !1,
                                onDateUpdate: function() {
                                    l.date = new Date(this.getValue()),
                                        o._loadWeekData(o.$weekView, new Date(l.date))
                                }
                            }),
                                FX.Msg.bubble({
                                    anchor: o.$title,
                                    text4Cancel: "",
                                    text4Ok: "",
                                    contentHTML: s,
                                    contentPadding: 0,
                                    hAdjust: 80
                                });
                            break;
                        case c.to_week:
                            var r = new Date;
                            if (o.options.startDate && r < o.options.startDate || o.options.endDate && r > o.options.endDate)
                                return;
                            o.options.date = r,
                                o._loadWeekData(o.$weekView, new Date(l.date));
                            break;
                        case c.today:
                            r = new Date;
                            if (o.options.startDate && r < o.options.startDate || o.options.endDate && r > o.options.endDate)
                                return;
                            o.options.date = r,
                            o.cache.selectedDate && o.cache.selectedDate.removeClass("selected"),
                                o.cache.selectedDate = o.$dateTable.find("td.today").addClass("selected"),
                                o._loadDateData(o.$dateTable, new Date(l.date)),
                                FX.Utils.applyFunc(o, l.onToday, arguments);
                            break;
                        case c.prevy:
                            o._toPrevYear(),
                                o._loadMonthData(o.$monthTable, new Date(l.date), !1),
                                o._loadDateData(o.$dateTable, new Date(l.date));
                            break;
                        case c.nexty:
                            o._toNextYear(),
                                o._loadMonthData(o.$monthTable, new Date(l.date), !1),
                                o._loadDateData(o.$dateTable, new Date(l.date));
                            break;
                        case c.month:
                            o.cache.selectedMonth && o.cache.selectedMonth.removeClass("selected"),
                                o.cache.selectedMonth = a.addClass("selected"),
                                o.options.date.setMonth(a.data("month")),
                                o._loadDateData(o.$dateTable, new Date(l.date));
                            break;
                        case c.day:
                            o.cache.selectedDate && o.cache.selectedDate.removeClass("selected"),
                                o.cache.selectedDate = a.addClass("selected"),
                                (e = o.options.date).setFullYear(o.cache.showYear),
                                e.setMonth(o.cache.showMonth),
                                e.setDate(C(".day-item", a).text()),
                                FX.Utils.applyFunc(o, l.onDateUpdate, arguments)
                    }
            }
            var o = this
                , l = this.options
                , c = this.CONSTS.NAV;
            this.element.off("click.calendar"),
                this.element.on("click.calendar", t),
            this.$monthTable && (this.$monthTable.off("click.calendar"),
                this.$monthTable.on("click.calendar", t))
        },
        _toPrevYear: function() {
            var t, e, i = this.options.startDate, a = this.options.date, n = a.getFullYear() - 1, s = a.getMonth();
            i && n === (e = i.getFullYear()) && (t = i.getMonth()),
            (!e || e < this.CONSTS.MINYEAR) && (e = this.CONSTS.MINYEAR),
                n < e ? (a.setFullYear(e),
                s < t && a.setMonth(t)) : a.setFullYear(n)
        },
        _toNextYear: function() {
            var t, e, i = this.options.endDate, a = this.options.date, n = a.getFullYear() + 1, s = a.getMonth();
            i && n === (e = i.getFullYear()) && (t = i.getMonth()),
            (!e || e > this.CONSTS.MAXYEAR) && (e = this.CONSTS.MAXYEAR),
                e < n ? (a.setFullYear(e),
                s < t && a.setMonth(t)) : a.setFullYear(n)
        },
        _toPrevMonth: function() {
            var t = this.options.startDate
                , e = this.options.date
                , i = this.cache.showMonth
                , a = this.cache.showYear;
            !t || a > t.getFullYear() ? 0 < i ? this._setMonth(i - 1) : (e.setFullYear(a - 1),
                this._setMonth(11)) : a === t.getFullYear() && i > t.getMonth() && 0 < i && (this._setMonth(i - 1),
            e < t && (e = new Date(t)))
        },
        _toNextMonth: function() {
            var t = this.options.endDate
                , e = this.options.date
                , i = this.cache.showMonth
                , a = this.cache.showYear;
            !t || a < t.getFullYear() ? i < 11 ? this._setMonth(i + 1) : (e.setFullYear(a + 1),
                this._setMonth(0)) : a === t.getFullYear() && i < t.getMonth() && (this._setMonth(i + 1),
            t < e && (e = new Date(t)))
        },
        _setMonth: function(t) {
            var e = this.options.date
                , i = e.getDate()
                , a = e.getFullYear()
                , n = this.options.endDate
                , s = this.options.startDate
                , r = FX.Utils.getMonthDays(a, t);
            r < i && e.setDate(r),
                e.setMonth(t),
            n && n < e && e.setDate(n.getDate()),
            s && e < s && e.setDate(s.getDate())
        },
        getViewMode: function() {
            return this.vm
        },
        setPointDays: function(t) {
            this.options.pointDays = t || [],
                this._loadDateData(this.$dateTable, new Date(this.options.date))
        },
        doResize: function(t) {
            FX.Calendar.superclass.doResize.apply(this, arguments);
            var e, i, a, n, s, r = t && t.width || this.options.width, o = t && t.height || this.options.height, l = C(".day-body", this.element);
            FX.Utils.isEmpty(r) || (e = l.outerWidth() - 20,
                a = C("tbody", this.$dateTable)[0],
                i = parseInt(e / 7),
                C("td", a).css("width", i)),
            FX.Utils.isEmpty(o) || (a = C("tbody", this.$dateTable)[0],
                n = l.outerHeight() - 20 - C("thead", this.$dateTable).outerHeight(),
            0 < (s = parseInt(n / 6) - 2) && C("td", a).css("height", Math.min(s, this.options.maxCellHeight)))
        },
        getValue: function() {
            return this.options.date
        },
        setValue: function(t) {
            this.options.date = t
        }
    }),
        C.shortcut("calendar", FX.Calendar)
}(jQuery),
function(d) {
    FX.CityPicker = FX.extend(FX.Trigger, {
        _defaultConfig: function() {
            return d.extend(FX.CityPicker.superclass._defaultConfig.apply(this, arguments), {
                triggerIcon: "icon-caret-down",
                width: 184,
                region: "country",
                addressSourceUrl: FX.CONFIG.HOST.GEOJSON_SITE + "/districts.json",
                regionArea: {
                    province: [],
                    city: [],
                    adcode: []
                }
            })
        },
        _init: function() {
            FX.CityPicker.superclass._init.apply(this, arguments);
            var t = this.options;
            this.value = {
                model: t.region,
                province: t.regionArea.province[0] || "",
                city: t.regionArea.city[0] || ""
            },
                this._setEditCompText()
        },
        _onTriggerClick: function() {
            var i = this
                , t = this.options;
            this.ADDRESS_DATA ? this._showTriggerView() : d.getJSON(t.addressSourceUrl, function(t) {
                i.ADDRESS_DATA = t,
                    i._showTriggerView()
            }),
                d(document).bind("mousedown.citypicker", function(t) {
                    var e = t.target;
                    d(e).closest(i.triggerView).length || i._hideTriggerView()
                })
        },
        _hideTriggerView: function() {
            this.triggerView && (d(document).unbind("mousedown.citypicker"),
                this.triggerView.detach())
        },
        _showTriggerView: function() {
            this.triggerView || (this.triggerView = d('<div class="x-dropdown"/>'),
                this.$content = d('<div class="fui_city_picker"/>').css("width", this.element.outerWidth()).appendTo(this.triggerView)),
                this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
                this.$content.empty(),
                this._createBody(),
                this._createFoot()
        },
        _createBody: function() {
            var a = this
                , i = d(".body", this.$content);
            i.length || (i = d('<div class="body"/>').appendTo(this.$content)),
                i.empty();
            var t = [{
                key: "model",
                items: [{
                    text: this._getModelText("country"),
                    value: "country"
                }, {
                    text: this._getModelText("province"),
                    value: "province"
                }, {
                    text: this._getModelText("city"),
                    value: "city"
                }],
                value: this.value.model,
                onColChange: function(t) {
                    a.value.model = t.value;
                    var e = a._getProvinces();
                    switch (t.value) {
                        case "country":
                            a.value.province = "",
                                a.value.city = "";
                            break;
                        case "province":
                            a.value.province = a.value.province || e[0].value,
                                a.value.city = "";
                            break;
                        case "city":
                            a.value.province = a.value.province || e[0].value;
                            var i = a._getCities();
                            a.value.city = i[0].value
                    }
                    n.province.replaceColItems(e, a.value.province),
                        n.city.replaceColItems(a._getCities(), a.value.city)
                }
            }, {
                key: "province",
                items: this._getProvinces(),
                value: this.value.province,
                onColChange: function(t) {
                    a.value.province = t.value;
                    var e = a._getCities();
                    a.value.city = e[0] && e[0].value || "",
                        n.city.replaceColItems(e, a.value.city)
                }
            }, {
                key: "city",
                value: this.value.city,
                items: this._getCities(),
                onColChange: function(t) {
                    a.value.city = t.value
                }
            }]
                , n = {};
            FX.Utils.forEach(t, function(t, e) {
                n[e.key] = a._renderCol(e, i)
            })
        },
        _getModelText: function(t) {
            return {
                country: "",
                province: "",
                city: ""
            }[t]
        },
        _renderCol: function(i, t) {
            function e(t, a) {
                c.empty();
                var n = 0;
                FX.Utils.forEach(t, function(t, e) {
                    var i = d('<div class="col-item"/>').data("item", e).appendTo(c);
                    d('<div class="item-wrapper"/>').attr("title", e.text).text(e.text).appendTo(i),
                    a === e.value && (n = t)
                }),
                    s = d(".col-item", c),
                    o = c.outerHeight(),
                    r = {
                        max: 64,
                        min: -(o - 96)
                    },
                    n = Math.min(n, t.length - 1),
                    s.eq(n).addClass("select").siblings().removeClass("select");
                var e = d(".col-item.select", c).index();
                o <= r.max && c.removeClass("transition"),
                    c.css(FX.Utils.formatTransform("translate(0," + (64 - 32 * e) + "px)"))
            }
            var s, r, o, n = FX.Utils.debounce(function() {
                a(i.onColChange)
            }, 200, this), a = function(t) {
                c.removeClass("scrolling").addClass("transition");
                var e = d(".col-item.select", c);
                c.css(FX.Utils.formatTransform("translate(0," + (64 - 32 * e.index()) + "px)")),
                t && t(e.data("item"))
            }, l = d('<div class="body-col"/>').on({
                wheel: function(t) {
                    var e, i, a;
                    s && s.length && (c.addClass("scrolling").removeClass("transition"),
                        e = t.originalEvent.deltaY,
                    t.originalEvent.wheelDelta && (e = -.025 * t.originalEvent.wheelDelta),
                        i = c.offset().top - l.offset().top - 32 * e,
                        i = Math.min(r.max, i),
                        (a = 0) < (i = Math.max(r.min, i)) ? a = 2 - Math.round(i / 32) : i < 0 ? a = -(Math.round(i / 32) - 2) : 0 === i && (a = 2),
                        s.eq(a).addClass("select").siblings().removeClass("select"),
                        c.css(FX.Utils.formatTransform("translate(0," + i + "px)")),
                        n())
                },
                click: function(t) {
                    var e = d(t.target).closest(".col-item");
                    if (!e.length)
                        return !1;
                    e.addClass("select").siblings().removeClass("select"),
                        a(i.onColChange)
                }
            }).appendTo(t), c = d('<div class="col-wrapper"/>').appendTo(l);
            return e(i.items, i.value),
                {
                    replaceColItems: e,
                    getSelectItem: function() {
                        return d(".col-item.select", c).data("item")
                    }
                }
        },
        _getProvinces: function() {
            if ("country" === this.value.model)
                return [];
            var e = [];
            return FX.Utils.forEach(this.ADDRESS_DATA, function(t) {
                e.push({
                    text: t,
                    value: t
                })
            }),
                e
        },
        _getCities: function() {
            if ("city" !== this.value.model)
                return [];
            var e = [];
            return FX.Utils.forEach(this.ADDRESS_DATA[this.value.province].districts, function(t) {
                e.push({
                    text: t,
                    value: t
                })
            }),
                e
        },
        _createFoot: function() {
            var t = this
                , e = this.options
                , i = d('<div class="foot"/>').appendTo(this.$content)
                , a = d('<div class="btn-group"/>').appendTo(i);
            d('<div class="group-btn"/>').text(i18next.t("cancel")).on("click", function() {
                t._hideTriggerView()
            }).appendTo(a),
                d('<div class="group-btn style-green"/>').text(i18next.t("ok")).on("click", function() {
                    t._hideTriggerView(),
                        t._setEditCompText(),
                        FX.Utils.applyFunc(t, e.onStopEdit, [], !1)
                }).appendTo(a)
        },
        _setEditCompText: function() {
            var t = "";
            switch (this.value.model) {
                case "country":
                    t = this._getModelText(this.value.model);
                    break;
                case "province":
                    t = this.value.province;
                    break;
                case "city":
                    t = this.value.province + " " + this.value.city
            }
            this.editComp.val(t)
        },
        getValue: function() {
            var t = [];
            switch (this.value.model) {
                case "province":
                    t.push(this.ADDRESS_DATA[this.value.province].adcode);
                    break;
                case "city":
                    t.push(this.ADDRESS_DATA[this.value.province].districts[this.value.city].adcode)
            }
            return {
                region: this.value.model,
                regionArea: {
                    province: [this.value.province],
                    city: [this.value.city],
                    adcode: t
                }
            }
        }
    }),
        d.shortcut("citypicker", FX.CityPicker)
}(jQuery),
function(n) {
    FX.XCheckBoxGroup = FX.extend(FX.CheckBoxGroup, {
        _defaultConfig: function() {
            return n.extend(FX.XCheckBoxGroup.superclass._defaultConfig.apply(), {
                hasSelectAll: !1,
                selectAllText: i18next.t("selectAll")
            })
        },
        _getItems: function() {
            var t = this.options;
            if (t.hasSelectAll && t.items && 0 < t.items.length) {
                var i = !0;
                return FX.Utils.forEach(t.items, function(t, e) {
                    if (!e.selected)
                        return i = !1
                }),
                    [{
                        value: "all",
                        text: t.selectAllText,
                        selected: i,
                        isSelectAll: !0
                    }].concat(t.items)
            }
            return t.items
        },
        _createItemDOM: function(t) {
            var e = FX.XCheckBoxGroup.superclass._createItemDOM.apply(this, arguments);
            return this.isSelectAllItem(t) && e.addClass("check-item-all"),
                e
        },
        _dealItemClick: function(t, e) {
            this.isSelectAllItem(t) ? n(".group_item", this.element).toggleClass("select", e) : this._dealSelectAllValue()
        },
        _dealSelectAllValue: function() {
            var t = this.options
                , e = n(".select:not(.check-item-all)", this.element);
            n(".check-item-all", this.element).toggleClass("select", e.length === t.items.length)
        },
        isSelectAllItem: function(t) {
            return !!t.isSelectAll
        },
        setValue: function(t) {
            FX.XCheckBoxGroup.superclass.setValue.apply(this, arguments),
                this._dealSelectAllValue()
        },
        getValue: function() {
            var a = []
                , t = n(".select:not(.check-item-all)", this.element);
            return FX.Utils.forEach(t, function(t, e) {
                var i = n(e).data("item");
                a.push(i.value)
            }),
                a
        },
        setText: function(t) {
            FX.XCheckBoxGroup.superclass.setText.apply(this, arguments),
                this._dealSelectAllValue()
        },
        getText: function() {
            var a = []
                , t = n(".select:not(.check-item-all)", this.element);
            return FX.Utils.forEach(t, function(t, e) {
                var i = n(e).data("item");
                a.push(i.text)
            }),
                a
        }
    }),
        n.shortcut("xcheckboxgroup", FX.XCheckBoxGroup)
}(jQuery),
function(x) {
    FX.Msg = {
        bubble: function(t) {
            var e = x.extend({
                customCls: "",
                anchor: null,
                msg: "",
                minWidth: null,
                contentWidget: null,
                contentHTML: null,
                contentPadding: 10,
                onCancel: null,
                onOk: null,
                type: "info",
                width4Btn: 100,
                text4Cancel: i18next.t("cancel"),
                text4Ok: i18next.t("ok"),
                dockPosition: "left",
                edge: 150,
                onShow: null,
                onClose: null,
                animation: !0,
                scrollObj: null,
                hasTriangle: !0,
                autoClose: !0,
                hAdjust: 0,
                vAdjust: 0,
                zoom: 1
            }, t);
            if (e.anchor) {
                var i = x('<div class="x-msg-bubble"/>').addClass(e.type);
                e.customCls && i.addClass(e.customCls),
                e.animation && i.addClass("animation");
                var a, n, s = e.hAdjust || 0;
                e.minWidth && (i.css({
                    "min-width": e.minWidth
                }),
                    a = e.anchor.offset().left,
                    n = e.anchor.width() / 2,
                    "left" === e.dockPosition && e.minWidth + n + a - s >= document.body.clientWidth ? e.dockPosition = "right" : "right" === e.dockPosition && e.minWidth >= a + n + s && (e.dockPosition = "left")),
                e.maxHeight && i.css({
                    "max-height": e.maxHeight
                });
                var r, o = x('<div class="content"/>').css({
                    padding: e.contentPadding
                }).appendTo(i);
                FX.Utils.isEmpty(e.msg) ? e.contentWidget ? (e.contentWidget.renderEl = x("<div/>").appendTo(o),
                    r = FX.createWidget(e.contentWidget)) : e.contentHTML && e.contentHTML.appendTo(o) : x("<span/>").text(e.msg).appendTo(o);
                var l, c, d = !1;
                e.text4Cancel && (d = !0,
                    new FX.Button({
                        renderEl: x("<div/>").appendTo(i),
                        customCls: "navi-btn-cancel",
                        style: "white",
                        text: e.text4Cancel,
                        width: e.width4Btn,
                        onClick: function(t) {
                            !1 !== FX.Utils.applyFunc(this, e.onCancel, [r, t], !0) && C()
                        }
                    })),
                e.text4Ok && (d = !0,
                    l = "green",
                "error" === e.type && (l = "border-red"),
                    new FX.Button({
                        renderEl: x("<div/>").appendTo(i),
                        customCls: "navi-btn-ok",
                        style: l,
                        text: e.text4Ok,
                        width: e.width4Btn,
                        onClick: function(t) {
                            !1 !== FX.Utils.applyFunc(this, e.onOk, [r, t], !0) && C()
                        }
                    })),
                d && o.css({
                    "padding-bottom": e.contentPadding + 50
                });
                var u = 6;
                e.hasTriangle && (u = 8,
                    c = x('<div class="triangle-up"/>').appendTo(i));
                var h = e.anchor.offset()
                    , p = h.top + e.anchor.height() + u - x("body").offset().top + e.vAdjust
                    , f = {
                    "z-index": FX.STATIC.zIndex++
                }
                    , m = Math.min(e.edge, document.body.clientHeight / 2);
                switch (document.body.clientHeight + document.body.scrollTop - p <= m ? (f.top = "auto",
                    f.bottom = document.body.clientHeight - h.top + u + e.vAdjust,
                    i.addClass("dock-bottom")) : (f.top = p,
                    f.bottom = "auto",
                    i.addClass("dock-top")),
                    e.dockPosition) {
                    case "left":
                        i.addClass("dock-left");
                        var g = h.left + e.anchor.outerWidth() / 2 - u - s
                            , _ = Math.max(0, g);
                        f.left = _,
                        c && c.css({
                            left: s
                        });
                        break;
                    case "right":
                        i.addClass("dock-right");
                        var v = document.body.clientWidth - h.left - e.anchor.outerWidth() / 2 - u - s
                            , F = Math.max(0, v);
                        f.right = F,
                        c && c.css({
                            right: s
                        });
                        break;
                    case "leftAlign":
                        var y = h.left - u - s
                            , b = Math.max(0, y);
                        f.left = b,
                        c && c.css({
                            left: s
                        })
                }
                e.zoom && (f.zoom = e.zoom);
                var T = "bubble-" + FX.STATIC.IDBase++
                    , C = function() {
                    !1 === FX.Utils.applyFunc(this, e.onClose, arguments, !1) && (i.removeClass("active"),
                        x(document).unbind("mousedown." + T),
                    e.scrollObj && x(e.scrollObj).unbind("scroll." + T),
                        setTimeout(function() {
                            i.remove()
                        }, e.animation ? 500 : 0))
                };
                return i.css(f).appendTo("body"),
                    setTimeout(function() {
                        i.addClass("active"),
                            FX.Utils.applyFunc(this, e.onShow, [r], !1);
                        function t(t) {
                            0 === x(t.target).closest(".x-msg-bubble,.x-dropdown").length && C()
                        }
                        e.autoClose && (x(document).bind("mousedown." + T, t),
                        e.scrollObj && x(e.scrollObj).bind("scroll." + T, t))
                    }, 0),
                    {
                        close: C
                    }
            }
        },
        toast: function(i) {
            var a = this
                , n = x.extend({
                msg: "",
                type: "success",
                onShow: null,
                onClose: null,
                timeout: 300
            }, i);
            if (!FX.Utils.isEmpty(n.msg)) {
                var s, t = "";
                switch (n.type) {
                    case "success":
                        t = "icon-select";
                        break;
                    case "warning":
                        t = "icon-warning-circle";
                        break;
                    case "error":
                        t = "icon-close-circle"
                }
                s = 0 < x(".x-msg-toast-wrapper").length ? x(".x-msg-toast-wrapper") : x('<div class="x-msg-toast-wrapper"/>').appendTo("body"),
                2 < x(".x-msg-toast").length && x(".x-msg-toast").first().remove();
                var r = x('<div class="x-msg-toast"/>').appendTo(s)
                    , e = x('<div class="content"/>').addClass(n.type).appendTo(r);
                x('<div class="toast-icon"/>').append(x('<i class="icon-toast-type"/>').addClass(t)).appendTo(e);
                x("<div/>").text(n.msg).appendTo(e);
                function o() {
                    r.fadeOut(n.timeout, function() {
                        r.remove(),
                        s.children().length < 1 && s.remove(),
                            FX.Utils.applyFunc(a, i.onClose, [], !1)
                    });
                    var t = r.outerHeight(!0)
                        , e = x(r).nextAll();
                    e.animate({
                        top: "-" + t + "px"
                    }, n.timeout, function() {
                        e.css("top", "0")
                    })
                }
                var l = "success" === n.type ? 2e3 : "loading" === n.type ? 0 : 4e3;
                return r.fadeIn(n.timeout, function() {
                    var t;
                    0 < l && (t = setTimeout(o, l)),
                        r.click(function() {
                            clearTimeout(t),
                                o()
                        })
                }),
                    o
            }
        },
        alert: function(t) {
            var e = x.extend({
                title: "",
                msg: "",
                onCreateMsg: null,
                tip: null,
                type: "warning",
                text4Ok: i18next.t("ok"),
                text4Cancel: i18next.t("cancel"),
                height4Btn: 30,
                onOk: null,
                onCancel: null,
                enable4Ok: !0,
                enable4Cancel: !0
            }, t);
            if (!(0 < x(".x-msg-alert").length)) {
                function i() {
                    a.fadeOut(function() {
                        a.remove()
                    }),
                        n.removeClass("showAlert"),
                        n.addClass("hideAlert"),
                        n.remove()
                }
                var a = x('<div class="x-window-mask modal light" tabIndex="-1"/>').css({
                    "z-index": 9999
                }).appendTo("body")
                    , n = x('<div class="x-msg-alert"/>').appendTo(a)
                    , s = x('<div class="icon"/>').append(x('<i class="icon-toast-type"/>')).appendTo(n)
                    , r = x('<div class="alert-body"/>').appendTo(n);
                s.addClass(e.type),
                e.title && r.append(x('<div class="title" />').text(e.title)),
                    e.msg ? r.append(x('<div class="text" />').html(e.msg)) : e.onCreateMsg && FX.Utils.applyFunc(null, e.onCreateMsg, [r], !1);
                var o, l, c, d = x('<div class="alert-footer"/>').appendTo(n), u = x('<div class="btn-container"/>').appendTo(d);
                return e.tip && d.append(x('<div class="alert-tip"/>').append(e.tip)),
                e.text4Ok && (c = "green",
                "error" !== e.type && "warning" !== e.type || (c = "border-red"),
                    o = new FX.Button({
                        renderEl: x("<div/>").appendTo(u),
                        customCls: "navi-btn-ok",
                        style: c,
                        text: e.text4Ok,
                        height: e.height4Btn,
                        enable: e.enable4Ok,
                        onClick: function() {
                            !1 !== FX.Utils.applyFunc(this, e.onOk, [], !0) && i()
                        }
                    })),
                e.text4Cancel && (l = new FX.Button({
                    renderEl: x("<div/>").appendTo(u),
                    customCls: "navi-btn-cancel",
                    style: "white",
                    text: e.text4Cancel,
                    height: e.height4Btn,
                    enable: e.enable4Cancel,
                    onClick: function() {
                        !1 !== FX.Utils.applyFunc(this, e.onCancel, [], !0) && i()
                    }
                })),
                    n.addClass("showAlert"),
                    a.fadeIn(),
                    n.show(),
                    {
                        okBtn: o,
                        cancelBtn: l,
                        close: i
                    }
            }
        },
        prompt: function(t) {
            var e = x.extend({
                title: "",
                waterMark: "",
                input: "",
                text4Cancel: i18next.t("cancel"),
                text4Ok: i18next.t("ok"),
                height4Btn: 30,
                onCancel: null,
                onOk: null
            }, t);
            if (!(0 < x(".x-msg-prompt").length)) {
                function i() {
                    a.addClass("fadeout").removeClass("fadein"),
                        setTimeout(function() {
                            a.remove()
                        }, 300)
                }
                var a = x('<div class="x-window-mask modal light fadeout" tabIndex="-1"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body")
                    , n = x('<div class="x-msg-prompt"/>').appendTo(a);
                x('<div class="prompt-title"/>').text(e.title).appendTo(n);
                var s = new FX.TextEditor({
                    renderEl: x("<div />").appendTo(n),
                    customCls: "prompt-input",
                    value: e.input,
                    width: "100%",
                    height: 36,
                    waterMark: e.waterMark
                });
                s.select();
                var r = x('<div class="btn-container"/>').appendTo(n);
                return new FX.Button({
                    renderEl: x("<div />").appendTo(r),
                    style: "green",
                    text: e.text4Ok,
                    customCls: "btn-ok",
                    height: e.height4Btn,
                    onClick: function() {
                        !1 !== FX.Utils.applyFunc(this, e.onOk, [s.getValue()], !0) && i()
                    }
                }),
                    new FX.Button({
                        renderEl: x("<div />").appendTo(r),
                        style: "white",
                        text: e.text4Cancel,
                        customCls: "btn-cancel",
                        height: e.height4Btn,
                        onClick: function() {
                            !1 !== FX.Utils.applyFunc(this, e.onCancel, [], !0) && i()
                        }
                    }),
                    setTimeout(function() {
                        a.addClass("fadein").removeClass("fadeout")
                    }, 0),
                    {
                        close: i,
                        setState: function(t) {
                            s.setState(t)
                        }
                    }
            }
        },
        broadcast: function(t) {
            var e, i, a, n = x.extend({
                msg: "",
                url: "",
                text4Ok: "",
                onOk: null,
                onClose: null,
                customCls: null,
                innerExtraContent: "",
                blank: !1,
                url4Btn: !1
            }, t), s = this;
            0 < x(".x-msg-broadcast").length || FX.Utils.isEmpty(n.msg) || (x("html").addClass("broadcast-html"),
                e = x('<div class="x-msg-broadcast"/>').prependTo("body"),
            n.customCls && e.addClass(n.customCls),
                setTimeout(function() {
                    e.addClass("translate-in"),
                        x("html").addClass("translate-in"),
                    n.customCls && x("html").addClass(n.customCls)
                }),
            n.innerExtraContent && e.html(n.innerExtraContent),
                i = x('<a class="broadcast-content"/>').text(n.msg).appendTo(e),
            n.url && !n.url4Btn && (i.attr("href", n.url),
            n.blank && i.attr("target", "_blank")),
            n.text4Ok && (a = x('<a class="broadcast-btn"/>').text(n.text4Ok).on("click", function() {
                FX.Utils.applyFunc(this, t.onOk, [], !1)
            }).appendTo(e),
            n.url && n.url4Btn && (a.attr("href", n.url),
            n.blank && a.attr("target", "_blank"))),
                x('<i class="icon-close-normal"/>').on("click", function() {
                    s.closeBroadcast(),
                        FX.Utils.applyFunc(this, t.onClose, [], !1)
                }).appendTo(e))
        },
        closeBroadcast: function() {
            var t = x(".x-msg-broadcast");
            0 < t.length && (t.removeClass("translate-in"),
                x("html").removeClass("translate-in"),
                setTimeout(function() {
                    x("html").removeClass("broadcast-html"),
                        t.remove()
                }, 218))
        },
        notice: function(t) {
            var e = x.extend({
                position: "top-right",
                title: "",
                type: "",
                content: null,
                onClose: null,
                width: 340,
                duration: 0
            }, t)
                , i = x(".x-msg-container", "body");
            i.length || (i = x('<div class="x-msg-container"/>').addClass(e.position).appendTo("body"));
            var a = x(".x-msg-notice", i);
            2 < a.length && a.eq(0).remove();
            var n = x('<div class="x-msg-notice" />').appendTo(i);
            if (e.type) {
                n.addClass(e.type);
                var s = x('<i class="icon-msg-notice"/>').appendTo(n);
                switch (e.type) {
                    case "error":
                        s.addClass("icon-close-circle");
                        break;
                    case "success":
                        s.addClass("icon-select");
                        break;
                    case "async":
                        s.addClass("icon-async")
                }
            }
            function r() {
                FX.Utils.applyFunc(this, e.onClose, [], !1),
                    n.removeClass("fade-in"),
                    setTimeout(function() {
                        n.remove()
                    }, 218)
            }
            x('<i class="icon-close-normal" />').on("click", function() {
                r()
            }).appendTo(n),
            e.width && n.css({
                width: e.width
            }),
                e.title ? n.append(x('<span class="title" />').text(e.title)) : FX.Utils.applyFunc(this, e.onTitleCreate, [x('<div class="title"/>').appendTo(n)], !1);
            var o = x('<div class="content"/>').appendTo(n);
            return o.on("click", function(t) {
                var e = x(t.target).closest("a");
                e && 0 < e.length && r()
            }),
                e.content ? o.append(e.content) : n.addClass("only-title"),
                n.addClass("fade-in"),
            0 < e.duration && setTimeout(function() {
                r()
            }, e.duration),
                {
                    close: r
                }
        },
        dotGuide: function(t) {
            var s;
            t.hasMask && (s = x('<div class="x-window-mask modal"/>').css({
                "z-index": FX.STATIC.zIndex++,
                "background-color": "rgba(240, 240, 240, 0.25)"
            }).appendTo("body"));
            function r() {
                s && s.remove(),
                    l.remove(),
                    FX.Utils.applyFunc(this, o.onEnd, [], !1)
            }
            var o = x.extend({
                position: "bottom",
                title: "",
                msg: "",
                onClose: null,
                onNext: null,
                onEnd: null,
                width: null,
                anchor: null,
                hAdjust: -10,
                vAdjust: -10,
                index: null,
                total: null,
                delay: null,
                isStepGuide: !1,
                isCircleEnable: !0,
                isCircleVisible: !0,
                isTriangleVisible: !1,
                isGuideTipVisible: !0,
                trianglePos: "",
                style4Circle: null,
                text4End: i18next.t("iSee")
            }, t)
                , e = "";
            FX.Utils.isNull(o.index) ? e += '<div class="footer"><span class="tip-end">' + o.text4End + "</span></div>" : o.index === o.total ? e += '<div class="footer"><span class="step">' + o.index + "/" + o.total + '</span><span class="tip-end">' + i18next.t("vip.use.start") + "</span></div>" : e += '<div class="footer"><span class="step">' + o.index + "/" + o.total + '</span><span class="tip-close">' + i18next.t("msg.dotGuide.closeGuide") + '</span><span class="tip-next">' + i18next.t("nextStep") + "</span></div>";
            var i, a, l = x('<div class="x-msg-dot-guide ' + o.position + '"><div class="circle-group"><div class="circle4"></div><div class="circle3"></div><div class="circle2"></div><div class="circle1"></div></div><div class="guide-tip"><div class="content"><div class="title">' + o.title + '</div><div class="msg">' + o.msg + "</div></div>" + e + '</div><div class="triangle-up"></div></div>').click(function(t) {
                var e = x(t.target).closest(".circle-group")
                    , i = x(t.target).closest(".tip-end")
                    , a = x(t.target).closest(".tip-next")
                    , n = x(t.target).closest(".tip-close");
                o.isCircleEnable && e.length || a.length ? function() {
                    s && s.remove(),
                        l.remove(),
                        FX.Utils.applyFunc(this, o.onNext, [], !1)
                }() : n.length ? function() {
                    s && s.remove(),
                        l.remove(),
                        FX.Utils.applyFunc(this, o.onClose, [], !1)
                }() : (o.isCircleEnable && e.length || i.length) && r()
            });
            return o.anchor ? (i = x("body").offset(),
                a = o.anchor.offset(),
                l.css({
                    left: a.left + o.anchor.width() + o.hAdjust - i.left,
                    top: a.top + o.anchor.height() + o.vAdjust - i.top
                })) : l.css({
                left: o.hAdjust,
                top: o.vAdjust
            }),
                l.css({
                    "z-index": FX.STATIC.zIndex++
                }),
            o.width && l.children(".guide-tip").width(o.width),
                o.isStepGuide ? o.delay ? setTimeout(function() {
                    l.addClass("zoomIn").appendTo("body")
                }, o.delay) : l.addClass("zoomIn").appendTo("body") : l.appendTo("body"),
            o.style4Circle && l.addClass(o.style4Circle),
            o.isGuideTipVisible || x(".guide-tip", l).addClass("x-ui-hidden"),
            o.isCircleVisible || x(".circle-group", l).addClass("x-ui-hidden"),
            o.isTriangleVisible || x(".triangle-up", l).addClass("x-ui-hidden"),
            o.trianglePos && l.addClass(o.trianglePos),
                {
                    close: r
                }
        }
    }
}(jQuery),
FX.CombinedTableProcessor = function(t, e) {
    this.table = t,
        this.page = 1,
        this.chunkSize = e.chunkSize,
        this.top = e.top,
        this.thresholds = e.thresholds,
        this.rowCount = 0,
        this.process()
}
,
FX.CombinedTableProcessor.prototype = {
    process: function() {
        var t = this.table;
        this.tableHead = [],
            this.tableRowHead = [],
            this.tableData = [],
            this.colDataArr = [],
            this.rowDataArr = [],
            this.rowHeadTitleCols = Math.max(1, t.xFields.length);
        for (var e = t.yFields.length + 1, i = 0; i < e; i++)
            this.tableHead.push([]);
        this._createColHeadTitle(),
            this._createRowHeadTitle(),
            this._createRowHead(t),
            this._createColHeadAndData(t),
            this.rowCount = this.tableData.length,
            this._chunkTable()
    },
    _shouldShowSummaryRow: function() {
        return !(this.top && this.top.enable && this.top.limit)
    },
    _chunkTable: function() {
        var s = this;
        this.rowHeadChunks = [],
            FX.Utils.forEach(this.tableRowHead, function(t, e) {
                var n = null
                    , i = FX.Utils.chunkArray(e, s.chunkSize);
                FX.Utils.forEach(i, function(t, e) {
                    n && n.rowspan && (e[0] = n);
                    for (var i = e.length - 1; 0 <= i; i--) {
                        var a = e[i];
                        if (a) {
                            a.rowspan >= e.length - i && (n = $.extend({}, a),
                                a.rowspan = e.length - i,
                                n.rowspan -= a.rowspan);
                            break
                        }
                    }
                    s.rowHeadChunks[t] = s.rowHeadChunks[t] || [],
                        s.rowHeadChunks[t].push(e)
                })
            }),
            this.dataChunks = FX.Utils.chunkArray(this.tableData, this.chunkSize)
    },
    _createColHeadTitle: function() {
        var i = this;
        FX.Utils.forEach(this.table.yFields, function(t, e) {
            i.tableHead[t].push({
                rowspan: 1,
                colspan: i.rowHeadTitleCols,
                text: e.title,
                cls: "group-head"
            })
        })
    },
    _createRowHeadTitle: function() {
        var t = this.table
            , i = this.tableHead[t.yFields.length]
            , a = 1;
        this.table.xFields.length < this.rowHeadTitleCols && (a = this.rowHeadTitleCols),
        t.xFields.length || i.push({
            colspan: this.rowHeadTitleCols,
            cls: "group-head"
        }),
            FX.Utils.forEach(t.xFields, function(t, e) {
                i.push({
                    colspan: a,
                    text: e.title,
                    cls: "group-head"
                })
            })
    },
    _createColHeadAndData: function(r) {
        for (var o = this, l = r.data.val, t = l[0].data.length, c = this.tableHead, d = this.tableData, e = 0; e < t; e++)
            d.push([]);
        var i = [];
        this._shouldShowSummaryRow() && d.push(i);
        var u = null;
        this._initValueFieldMap(),
            FX.Utils.forEach(l, function(a, n) {
                n.is_summary_col && r.yFields.length && (u ? u.colspan += 1 : (u = {
                    text: i18next.t("gather"),
                    rowspan: r.yFields.length,
                    colspan: 1
                },
                    c[0].push(u)));
                var t, s = !0;
                FX.Utils.forEach(n.y, function(t, e) {
                    var i = o._getLastCell(c[t]);
                    (s = 0 !== a && (s && o._compareCell(l[a - 1].y[t], e))) ? i.colspan += 1 : c[t].push({
                        colspan: 1,
                        text: o._getGroupText(e, r.yFields[t], r),
                        data: {
                            id: o._getColHeadCellData(n.y, t)
                        },
                        cls: "clickable"
                    })
                }),
                    c[r.yFields.length].push({
                        text: o._getMetricTitle(r.metrics, n.tag)
                    }),
                    FX.Utils.forEach(n.data, function(t, e) {
                        var i = {}
                            , i = FX.Utils.isNull(e) ? {
                            text: "-",
                            cls: "h-right"
                        } : {
                            field: n.tag,
                            text: o._getFormattedText(e, n.tag),
                            cls: "h-right clickable" + (FX.DashUtils.checkThresholdAlert(e, n, o.thresholds) ? " show-alert" : ""),
                            data: {
                                id: o._getCellData(r, t, a)
                            }
                        };
                        d[t].push(i)
                    }),
                o._shouldShowSummaryRow() && (t = o._getFormattedText(n.sum, n.tag),
                o.valueFieldMap[n.tag].growth && (t = ""),
                    i.push({
                        field: n.tag,
                        text: t,
                        cls: "h-right clickable",
                        data: {
                            id: o._getColHeadCellData(n.y, n.y.length - 1)
                        }
                    }))
            })
    },
    _initValueFieldMap: function() {
        var i = this
            , t = this.table;
        this.valueFieldMap = {},
            FX.Utils.forEach(t.metrics, function(t, e) {
                i.valueFieldMap[e.tag] = e
            })
    },
    _getFormattedText: function(t, e) {
        var i = FX.Utils.fixDecimalPrecision(t)
            , a = this.valueFieldMap[e];
        return a && a.format && (i = FX.Utils.num2Str(i, a.format) || "_"),
            i
    },
    _compareCell: function(i, a) {
        var n = i === a;
        return $.isPlainObject(i) && $.isPlainObject(a) && (n = !0,
            FX.Utils.forEach(i, function(t, e) {
                if (e !== a[t])
                    return n = !1
            }),
        n && FX.Utils.forEach(a, function(t, e) {
            if (e !== i[t])
                return n = !1
        })),
            n
    },
    _getMetricTitle: function(t, i) {
        var a = "";
        return FX.Utils.forEach(t, function(t, e) {
            if (e.tag === i)
                return a = e.title,
                    !1
        }),
            a
    },
    _getColHeadCellData: function(t, e) {
        for (var i = this.table, a = {}, n = 0; n <= e; n++) {
            var s = i.yFields[n];
            a[s.groupName || s.tag] = t[n]
        }
        return a
    },
    _getRowHeadCellData: function(t, e, i) {
        for (var a = this.table, n = {}, s = 0, r = 0; r <= i; r++) {
            var o = a.xFields[r]
                , s = r;
            "f_row_order" === o.tag && (s = t.length - 1,
                o = a.xFields[s]),
                n[o.groupName || o.tag || o.name] = t[s].data[e]
        }
        return n
    },
    _getCellData: function(t, e, i) {
        var a = this.colDataArr[i]
            , n = this.rowDataArr[e];
        return a || (a = this._getColHeadCellData(t.data.val[i].y, t.yFields.length - 1),
            this.colDataArr[i] = a),
        n || (n = this._getRowHeadCellData(t.data.x, e, t.xFields.length - 1),
            this.rowDataArr[e] = n),
            $.extend({}, n, a)
    },
    _createRowHead: function(o) {
        var l = this
            , c = o.data.x
            , d = this.tableRowHead;
        if (c.length)
            for (var t = 0; t < c.length; t++)
                d.push([]);
        else
            d.push([]);
        FX.Utils.forEach(c, function(n, s) {
            var r = null;
            FX.Utils.forEach(s.data, function(t, e) {
                var i, a = !1;
                0 < t && (a = l._compareCell(s.data[t - 1], e),
                0 < n && (a = a && FX.Utils.isNull(d[n - 1][t]))),
                    a ? (r.rowspan += 1,
                        d[n].push(null)) : (i = 1,
                    o.xFields.length < l.rowHeadTitleCols && (i = l.rowHeadTitleCols),
                        r = {
                            colspan: i,
                            rowspan: 1,
                            text: l._getGroupText(e, o.xFields[n], o),
                            data: {
                                id: l._getRowHeadCellData(c, t, n)
                            },
                            cls: "clickable"
                        },
                        d[n].push(r))
            })
        }),
        this._shouldShowSummaryRow() && d[0].push({
            text: i18next.t("gather"),
            colspan: this.rowHeadTitleCols
        })
    },
    _getGroupText: function(i, t, e) {
        var a = i;
        switch (t.type) {
            case "user":
            case "usergroup":
                var n = e.user[i]
                    , a = n ? n.nickname : i;
                break;
            case "dept":
            case "deptgroup":
                var s = e.department[i];
                a = s ? s.name : i;
                break;
            case "datetime":
                a = FX.Utils.date2GroupStr(i, t.groupRule || "year");
                break;
            case "location":
            case "address":
                a = "";
                var r = t.groupRule.split("_");
                FX.Utils.forEach(r, function(t, e) {
                    FX.Utils.isEmpty(i[e]) || (a += i[e])
                });
                break;
            case "flowState":
                a = FX.Utils.getFlowStateText(a)
        }
        return a
    },
    _getLastCell: function(t) {
        return t.length ? t[t.length - 1] : null
    },
    turnPage: function(t) {
        this.page = t
    },
    getPage: function() {
        return this.page
    },
    getCount: function() {
        return this.rowCount
    },
    getTable: function() {
        return {
            tableHead: this.tableHead,
            tableRowHead: this.rowHeadChunks[this.page - 1],
            tableData: this.dataChunks[this.page - 1]
        }
    }
},
function(m) {
    FX.DataTableProcessor = function(t) {
        var i = this;
        this.header = [],
            FX.Utils.forEach(t.header, function(t, e) {
                e.detailOnly || i.header.push(e)
            }),
            this.data = t.data,
            this.sort = t.sort || [],
            this.supportFormulaSort = t.supportFormulaSort,
            this.showNoAuthCell = t.showNoAuthCell,
            this.onHeadCellCreate = t.onHeadCellCreate,
            this.dataHasCheck = t.dataHasCheck,
            this.supportSortFieldsList = t.supportSortFieldsList || FX.LimitFields.sort,
            this.resizable = t.resizable,
            this.colSizeMap = t.colSizeMap,
            this.checkColSize = 35,
            this.stickyColLimit = t.stickyColLimit || 0,
            this.colorDisable = t.colorDisable,
            this._process(),
        t.hasCheck && this.setHasCheck(t.hasCheck)
    }
        ,
        FX.DataTableProcessor.prototype = {
            _process: function() {
                this._processHeader(this.header),
                    this._processData(this.data)
            },
            _processData: function(t) {
                var h = this
                    , i = [];
                this.dataIdxArr = this.dataIdxArr || [],
                    FX.Utils.forEach(t, function(t, c) {
                        for (var d = [], u = h._getDataRowCount(c), e = 0; e < u; e++)
                            d.push([]);
                        FX.Utils.forEach(h.columns, function(n, s) {
                            if (h.tableRowHead[n] || (h.tableRowHead[n] = []),
                                s.subform) {
                                var r = h._getRealColIndex(s.subform) < h.stickyColLimit
                                    , t = c[s.subform] || [];
                                if (FX.Utils.forEach(t, function(t, e) {
                                    var i = h._getFieldAuth(c, s.subform + "." + s.field)
                                        , a = h.showNoAuthCell && !i.visible ? h._createNoAuthCell() : h._createDataCell(e[s.field], s);
                                    r ? h.tableRowHead[n].push(a) : d[t].push(a)
                                }),
                                t.length < u)
                                    for (var e = t.length; e < u; e++) {
                                        var i = h._createDataCell(null);
                                        r ? h.tableRowHead[n].push(i) : d[e].push(i)
                                    }
                            } else {
                                var r = h._getRealColIndex(s.field) < h.stickyColLimit
                                    , a = h._getFieldAuth(c, s.field)
                                    , o = h.showNoAuthCell && !a.visible ? h._createNoAuthCell() : h._createDataCell(c[s.field], s);
                                if (o.rowspan = u,
                                "label" === s.field || r) {
                                    h.tableRowHead[n].push(o);
                                    for (var l = 1; l < u; l++)
                                        h.tableRowHead[n].push(null);
                                    return
                                }
                                d[0].push(o)
                            }
                        }),
                            FX.Utils.forEach(d, function() {
                                h.dataIdxArr.push(t)
                            }),
                            i = i.concat(d)
                    }),
                this.resizable && FX.Utils.forEach(i, function(t, e) {
                    e.push({
                        cls: "blank-cell"
                    })
                }),
                    this.tableData = i
            },
            _getRealColIndex: function(i) {
                var a;
                return FX.Utils.forEach(this.header, function(t, e) {
                    if (e.tag === i || e.name === i)
                        return a = t,
                            !1
                }),
                    a
            },
            _getColumns: function() {
                var s, r = this, o = [];
                return this.hasCheck && o.push({
                    name: "rowCheck",
                    width: this.checkColSize,
                    isSticky: !0
                }),
                    FX.Utils.forEach(this.header, function(t, e) {
                        var i, a, n = t < r.stickyColLimit;
                        "subform" === e.type ? (i = r._getFieldName(e),
                            FX.Utils.forEach(e.items, function(t, e) {
                                s = [i, r._getFieldName(e)].join("."),
                                    o.push({
                                        name: s,
                                        width: r._getColSize(s, e),
                                        isSticky: n
                                    })
                            })) : "chargers" === e.name ? (s = e.name + ".node",
                            o.push({
                                name: s,
                                width: r._getColSize(s, e),
                                isSticky: n
                            }),
                            s = e.name + ".charger",
                            o.push({
                                name: s,
                                width: r._getColSize(s, e),
                                isSticky: n
                            })) : (a = {
                            name: s = r._getFieldName(e),
                            width: r._getColSize(s, e)
                        },
                        "label" !== s && !n || (a.isSticky = !0),
                            o.push(a))
                    }),
                    o
            },
            _getColSize: function(t, e) {
                var i = e.type
                    , a = "f_row_order" === t ? 60 : 150;
                return this.colSizeMap[t] || e.width || {
                    textarea: 300,
                    address: 300,
                    location: 300,
                    image: 100,
                    upload: 100,
                    signature: 100,
                    usergroup: 250,
                    deptgroup: 250,
                    combocheck: 300,
                    checkboxgroup: 300
                }[i] || a
            },
            _getFieldAuth: function(t, e) {
                if ("label" === e)
                    return {
                        visible: !0
                    };
                var i = (t._optAuth || {})[e] || 0;
                return FX.Utils.fieldAuthValue2Json(i)
            },
            _createNoAuthCell: function() {
                return {
                    cls: "cell-no-auth",
                    text: i18next.t("field.no_view_auth")
                }
            },
            _createDataCell: function(t, e) {
                var i, a = this, n = {
                    text: ""
                };
                if (FX.Utils.isObjectEmpty(t))
                    return n;
                switch (e.type) {
                    case "checkboxgroup":
                    case "combocheck":
                    case "array":
                        !this.colorDisable && e.colorEnable ? (i = FX.Utils.getColorTagList({
                            field: e,
                            values: t,
                            tagCss: {
                                margin: "2px 4px 2px 0"
                            },
                            multiLine: !0,
                            className: "table-tag-list"
                        }),
                            n.html = i) : n.text = FX.Utils.isNull(t) ? "" : t.join(", ");
                        break;
                    case "radiogroup":
                    case "combo":
                        !this.colorDisable && e.colorEnable ? (i = FX.Utils.getColorTagList({
                            field: e,
                            values: [t],
                            tagCss: {
                                margin: "2px 4px 2px 0"
                            },
                            multiLine: !0,
                            className: "table-tag-list"
                        }),
                            n.html = i) : n.text = t;
                        break;
                    case "string":
                    case "text":
                        if ("creator" === e.field) {
                            n.text = this._getTextFromUserCell(t);
                            break
                        }
                        if (e.regex && new RegExp(e.regex).test(t)) {
                            var s = FX.CONST.TEXT_TYPE_REGEXP;
                            if (e.regex === s.email) {
                                n.html = '<a href="mailto:' + t + '">' + t + "</a>";
                                break
                            }
                        }
                        n.html = m("<span />").append(FX.Utils.replaceURL(t));
                        break;
                    case "id":
                    case "did":
                    case "user":
                    case "dept":
                        n.text = this._getTextFromUserCell(t);
                        break;
                    case "usergroup":
                    case "deptgroup":
                        var r = [];
                        FX.Utils.forEach(t, function(t, e) {
                            r.push(a._getTextFromUserCell(e))
                        }),
                            n.text = r.join(",");
                        break;
                    case "formula":
                    case "number":
                        var o = FX.Utils.fixDecimalPrecision(t);
                        n.text = FX.Utils.num2Str(o, e.format),
                            n.cls = "h-right",
                        e.isOrderCol && (n.cls = "h-left");
                        break;
                    case "address":
                        var l = [];
                        t.province && (l.push(t.province),
                        t.city && t.province !== t.city && l.push(t.city),
                        t.district && l.push(t.district)),
                        t.detail && l.push(t.detail),
                            n.text = FX.Utils.address2Str(t, l.join(""), e.format);
                        break;
                    case "location":
                        n.text = FX.Utils.address2Str(t, "", "pcda");
                        break;
                    case "image":
                    case "upload":
                    case "signature":
                        var c = m('<div class="table-file-thumb"/>').data("op", "file");
                        new FX.ThumbList({
                            renderEl: m('<div class="table-op-btn"/>').appendTo(c),
                            files: t,
                            hasTooltip: "signature" !== e.type
                        }),
                            n.html = c;
                        break;
                    case "textarea":
                        n = {
                            html: t ? m("<pre/>").append(FX.Utils.replaceURL(t)) : ""
                        };
                        break;
                    case "datetime":
                        n.text = FX.Utils.date2Str(new Date(t), e.format);
                        break;
                    case "linkdata":
                        var d = t && t.key;
                        if (FX.Utils.isNull(d))
                            break;
                        "datetime" === e.linkType ? n.text = FX.Utils.date2Str(new Date(d), "yyyy-MM-dd") : n.text = d;
                        break;
                    case "flowState":
                        n.html = m('<div class="table-tag-list"/>').append(FX.Utils.getFlowStateTag(t));
                        break;
                    case "chargers":
                        var u = {}
                            , h = {};
                        FX.Utils.forEach(t, function(t, e) {
                            e.flowName && (u[e.flowName] || (u[e.flowName] = !0),
                            h[e.userNickname] || (h[e.userNickname] = !0))
                        });
                        var p = [];
                        "node" === e.show ? FX.Utils.forEach(u, function(t) {
                            p.push(t)
                        }) : FX.Utils.forEach(h, function(t) {
                            p.push(t)
                        }),
                            n.text = p.join(",");
                        break;
                    case "phone":
                        var f = m("<div/>");
                        t && t.phone && (f.text(t.phone),
                        t.verified && m('<i class="phone-verified-icon icon-verified"/>').appendTo(f)),
                            n.html = f;
                        break;
                    default:
                        n.text = t
                }
                return n
            },
            _getTextFromUserCell: function(t) {
                return m.isPlainObject(t) ? t.name : t
            },
            _getDataRowCount: function(t) {
                var i = this
                    , a = 1;
                return FX.Utils.forEach(t, function(t, e) {
                    "subform" === (i.fieldMap[t] || {}).type && e && (a = Math.max(e.length, a))
                }),
                    a
            },
            _processHeader: function(t) {
                var s = this;
                this.headRowCount = this._getHeadRowCount(t);
                for (var r = [], o = [], l = {}, e = 0; e < this.headRowCount; e++)
                    r.push([]);
                FX.Utils.forEach(t, function(a, t) {
                    var e, i, n = s._getFieldName(t);
                    if ("subform" === (l[n] = t).type) {
                        if (FX.Utils.isObjectEmpty(t.items))
                            return;
                        r[0].push({
                            text: t.title || t.text,
                            colspan: t.items.length,
                            cls: a < s.stickyColLimit ? "combined-col group-head" : "combined-col"
                        }),
                            FX.Utils.forEach(t.items, function(t, e) {
                                var i = [n, s._getFieldName(e)].join(".");
                                l[i] = e,
                                    r[1].push(s._createHeadCell(e, s.headRowCount, n, a)),
                                    o.push(s._createHeadCol(e, n))
                            })
                    } else {
                        "chargers" === t.type ? (e = m.extend({}, t, {
                            show: "node",
                            text: i18next.t("flow.node.current")
                        }),
                            r[0].push(s._createHeadCell(e, s.headRowCount, null, a)),
                            o.push(s._createHeadCol(e)),
                            i = m.extend({}, t, {
                                show: "charger",
                                text: i18next.t("flow.charger.current")
                            }),
                            r[0].push(s._createHeadCell(i, s.headRowCount, null, a)),
                            o.push(s._createHeadCol(i))) : (r[0].push(s._createHeadCell(t, s.headRowCount, null, a)),
                            o.push(s._createHeadCol(t)))
                    }
                }),
                this.resizable && (r[0].push({
                    rowspan: s.headRowCount,
                    cls: "blank-cell"
                }),
                    this.cols = this._getColumns()),
                    this.tableHead = r,
                    this.columns = o,
                    this.fieldMap = l,
                    this.tableRowHead = []
            },
            _createHeadCell: function(t, e, i, a) {
                var n, s = this._getFieldName(t), r = {
                    text: t.title || t.text,
                    cls: t.type + "-col",
                    data: {}
                };
                return i ? s = [i, s].join(".") : r.rowspan = e,
                    r.data.field = s,
                "chargers" === t.type && (r.data.field = [s, t.show].join("."),
                    "node" === t.show ? r.text = i18next.t("flow.node.current") : "charger" === t.show && (r.text = i18next.t("flow.charger.current"))),
                    FX.Utils.forEach(this.sort, function(t, e) {
                        e[s] && (n = e[s])
                    }),
                n && (n === FX.CONST.SORT.ASC ? r.cls += " sort sort-asc" : r.cls += " sort sort-desc"),
                !i && this._isFieldSortable(t) && (r.cls += " clickable sortable"),
                ("label" === t.name || a < this.stickyColLimit) && (r.cls += " group-head"),
                    FX.Utils.applyFunc(this, this.onHeadCellCreate, [r, t], null),
                    r
            },
            _isFieldSortable: function(t) {
                return "label" !== t.name && -1 < this.supportSortFieldsList.indexOf(t.type) && !t.isOrderCol || !("formula" !== t.type || !this.supportFormulaSort)
            },
            _createHeadCol: function(t, e) {
                var i = this._getFieldName(t)
                    , a = {
                    type: t.type,
                    field: i,
                    items: t.items
                };
                return t.colorEnable && (a.colorEnable = t.colorEnable),
                t.format && (a.format = t.format),
                t.cellFmt && (a.format = t.cellFmt.data),
                e && (a.subform = e),
                t.regex && (a.regex = t.regex),
                "linkdata" === t.type && (a.linkType = t.linkType),
                t.show && (a.show = t.show),
                FX.Utils.isNull(t.isOrderCol) || (a.isOrderCol = t.isOrderCol),
                    a
            },
            _getHeadRowCount: function(t) {
                var i = 1;
                return FX.Utils.forEach(t, function(t, e) {
                    if ("subform" === e.type)
                        return !(i = 2)
                }),
                    i
            },
            _getFieldName: function(t) {
                return t.tag || t.name
            },
            getTable: function() {
                var t = {
                    tableHead: this.tableHead,
                    tableData: this.tableData,
                    tableRowHead: this.tableRowHead
                };
                return this.resizable && (t.cols = this.cols),
                    t
            },
            getDataIdxByRow: function(t) {
                return this.dataIdxArr[t]
            },
            getDataCount: function() {
                return this.data.length
            },
            getDataByIdx: function(t) {
                return this.data[t]
            },
            setHasCheck: function(t) {
                var n, s, r = this;
                t !== this.hasCheck && (this.hasCheck = t,
                    this.hasCheck ? (this.tableHead[0].unshift({
                        rowspan: this.headRowCount,
                        cls: "table-op-btn-cell group-head",
                        html: m('<div class="x-check table-op-btn check-all" data-op="check"><i class="icon-blank"/></div>')
                    }),
                        n = -1,
                        s = [],
                        this.tableRowHead.unshift(s),
                        FX.Utils.forEach(this.dataIdxArr, function(t, e) {
                            var i, a;
                            e !== n ? (n = e,
                                i = r.getDataByIdx(e),
                                a = FX.Utils.applyFunc(r, r.dataHasCheck, [i], !0),
                                s.push({
                                    cls: "table-op-btn-cell",
                                    data: {
                                        dataId: r.getDataByIdx(e)._id
                                    },
                                    rowspan: r._getDataRowCount(i),
                                    html: m('<div class="x-check table-op-btn" data-op="check"><i class="icon-blank"/></div>').toggleClass("x-ui-disable", !a)
                                })) : s.push(null)
                        })) : (this.tableHead[0].shift(),
                        this.tableRowHead.shift()),
                this.resizable && this.cols.unshift({
                    name: "rowCheck",
                    width: this.checkColSize,
                    isSticky: !0
                }))
            }
        }
}(jQuery),
function(d) {
    FX.FormEditPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return d.extend(FX.FormEditPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_form_edit_pane",
                appId: null,
                dataId: null,
                entryId: null,
                flowType: null,
                flowId: null,
                width: 1080,
                onSuccess: null,
                onFail: null,
                onCancel: null,
                hasFlowBtn: !0,
                onLoadForm: null,
                onFlowDone: null
            })
        },
        _init: function() {
            FX.FormEditPane.superclass._init.apply(this, arguments);
            var t = this.options;
            this._fetchForm(t.dataId, t.entryId, t.flowType, t.flowId)
        },
        _fetchForm: function(s, r, o, t) {
            var l = this
                , c = this.options;
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(FX.API.data.read),
                data: {
                    appId: c.appId,
                    entryId: r,
                    formId: r,
                    dataId: s,
                    flowId: t
                }
            }, function(t) {
                FX.Utils.applyFunc(l, c.onLoadForm, [t.formName], !1);
                var e = t.currentFlowId
                    , i = o;
                "transactors" !== o && "ccUsers" !== o || (i = "part");
                var a, n = FX.Utils.getFlowOption(t, i);
                n.isEditable ? (a = l._createOpt({
                    res: t,
                    flow: n,
                    flowId: e,
                    title: t.formName,
                    dataId: s,
                    entryId: r,
                    flowType: o,
                    comment: t.formComment
                }),
                    l.form = new FX.Form(a)) : (n.flowType = o,
                    l._showFormData(t, n))
            }, function(t) {
                var e = t.responseJSON || {};
                if (4010 === e.code)
                    FX.Utils.applyFunc(l, c.onFlowDone, !1);
                else if (e.code === FX.CONST.FLOW_FAIL_CODE.TODO_TASK_INVALID)
                    new FX.Empty({
                        renderEl: d("<div/>").appendTo(d('<div class="flow-todo-empty-con"/>').appendTo(l.element.empty())),
                        customCls: "flow-todo-empty",
                        image: FX.Utils.getAssetUrl("/resources/images/empty_status/flow_todo.png"),
                        title: i18next.t("error.5028"),
                        onCreateExtra: function(t) {
                            new FX.Button({
                                renderEl: d("<div/>").appendTo(t),
                                text: i18next.t("iSee"),
                                style: "green",
                                onClick: function() {
                                    FX.Utils.redirectTo("/dashboard")
                                }
                            })
                        }
                    });
                else if (!FX.Utils.applyFunc(l, c.onFail, [e], !1))
                    return !1
            })
        },
        _showFormData: function(t, e, i) {
            var a = this
                , n = this.options
                , s = [].concat(t.form.items || [])
                , r = t.data
                , o = FX.Utils.getFormLayout(t.form && t.form.layout, s);
            new FX.FlowFormDataPane({
                renderEl: d("<div/>").appendTo(this.element.empty()),
                appId: r.appId,
                entryId: r.entryId,
                formId: r.entryId,
                comment: t.formComment,
                hasDataLog: n.hasDataLog,
                width: n.width,
                height: n.height,
                title: [t.formName, t.flowName].join("  "),
                entryName: t.formName,
                layout: o,
                header: s,
                data: r,
                flow: e,
                optAuth: t.optAuth,
                hasFlowBtn: n.hasFlowBtn && e.hasLogView && !i,
                hasFooter: !0,
                hasCustomPrint: !0,
                ignoreVisible: !1,
                tabs: t.tabs,
                onClose: function(t) {
                    i ? i() : t ? FX.Utils.applyFunc(a, n.onSuccess, [], !1) : a._doClose()
                },
                onFlowNodeClick: function(t, e, i) {
                    a._fetchForm(e, t, n.flowType, i)
                }
            })
        },
        _createOpt: function(n) {
            var s = this
                , t = this.options;
            return d.extend(n.res.form, {
                renderEl: d("<div/>").appendTo(this.element.empty()),
                appId: t.appId,
                entryId: n.entryId,
                dataId: n.dataId,
                comment: n.comment,
                submitUrl: FX.Utils.getApi(FX.API.data.update),
                submitData: {
                    dataId: n.dataId,
                    flowId: n.flowId
                },
                title: n.title,
                width: t.width,
                height: t.height,
                widgetOptAuth: n.res.optAuth,
                buttonPosition: "middle",
                editValue: n.res.data,
                mode: "edit",
                flow: n.flow,
                multiTabs: n.res.tabs,
                formEvents: n.res.formEvents,
                onSuccess: function(t, e, i) {
                    var a;
                    i ? ((a = FX.Utils.getFlowOption(t, "print")).flowId = n.flow.flowId,
                        s._showFormData(d.extend(n.res, t), a, function() {
                            s._handleSubmitSuccess(d.extend(n, {
                                flowAction: e
                            }))
                        })) : s._handleSubmitSuccess(d.extend(n, {
                        flowAction: e
                    }))
                },
                onAfterCancel: function() {
                    s._doClose()
                },
                onFlowNodeClick: function(t, e, i) {
                    s._fetchForm(e, t, n.flowType, i)
                },
                onFlowDone: function() {
                    FX.Utils.applyFunc(s, t.onFlowDone, [], !1)
                }
            })
        },
        _doClose: function() {
            var t = this.options;
            FX.Utils.applyFunc(this, t.onCancel, [], !1)
        },
        _handleSubmitSuccess: function(a) {
            var n, t = this.options;
            switch (a.flowAction) {
                case "forward":
                case "save":
                case "back":
                case "transfer":
                    !(1 < a.flow.flowNodes.length) || a.flow.flowNodes.slice(-1)[0].flowId === a.flowId ? FX.Utils.applyFunc(this, t.onSuccess, [], !1) : (n = "",
                        FX.Utils.forEach(a.flow.flowNodes, function(t, e) {
                            var i;
                            e.flowId === a.flowId && (i = a.flow.flowNodes[t + 1],
                                n = i ? i.flowId : a.flow.flowNodes[t - 1].flowId)
                        }),
                        this._fetchForm(a.dataId, a.entryId, a.flowType, n));
                    break;
                case "close":
                    FX.Utils.applyFunc(this, t.onSuccess, [], !1);
                    break;
                default:
                    FX.Utils.applyFunc(this, t.onCancel, [], !1)
            }
        },
        doResize: function(t) {
            this.form && this.form.doResize(t)
        }
    })
}(jQuery),
function(l) {
    FX.DataCommentPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return l.extend(FX.DataCommentPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_data_comment",
                API: FX.API,
                perPage: 20,
                dataId: null,
                appId: null,
                entryId: null,
                allowComment: !0,
                authGroupId: null
            })
        },
        _init: function() {
            FX.DataCommentPane.superclass._init.apply(this, arguments),
                this.pageNow = 1,
                this._createContent(),
                this._bindEvent()
        },
        _createContent: function(t) {
            this.count = 0,
                this.$main = l('<div class="main-content"/>').appendTo(this.element),
                this.$wrapper = l('<div class="main-wrapper"/>').appendTo(this.$main),
                this._fetch(t),
                this._renderFooter()
        },
        _fetch: function(t) {
            var e = this
                , i = this.options
                , a = l.extend({
                skip: (this.pageNow - 1) * i.perPage,
                limit: i.perPage,
                dataId: i.dataId,
                entryId: i.entryId,
                appId: i.appId,
                authGroupId: i.authGroupId,
                formId: i.formId,
                flowId: i.flowId
            }, t);
            FX.Utils.ajax({
                url: FX.Utils.getApi(i.API.data.comment_list),
                data: a
            }, function(t) {
                t.logs && 0 < t.logs.length ? (e.count += t.logs.length,
                    e._render(t)) : e._renderEmpty(),
                    e.couldLoad = !0
            })
        },
        _render: function(t) {
            var i = this
                , e = this.options;
            FX.Utils.forEach(t.logs, function(t, e) {
                i._renderItem(e)
            }),
                t.logs.length === e.perPage ? this._renderLoadMore() : this._removeLoadMore()
        },
        _renderEmpty: function() {
            0 === this.count && l('<div class="empty-box"><div class="box-content"></div><div class="box-text">' + i18next.t("data.comment.empty") + "</div></div>").appendTo(this.element)
        },
        _renderLoadMore: function() {
            var t = this
                , e = l(".load-more-btn", this.element);
            e && e.length || (this.couldLoad = !0,
                l('<div class="load-more-btn">' + i18next.t("loadMore") + "</div>").on("click", function() {
                    t.couldLoad && (t.couldLoad = !1,
                        t.pageNow++,
                        t._fetch())
                }).appendTo(this.$main))
        },
        _removeLoadMore: function() {
            l(".load-more-btn", this.element).remove()
        },
        _renderItem: function(t) {
            var e, i, a, n, s, r, o;
            t && (e = t.operator || {
                name: i18next.t("widget.user.anonymous"),
                isCorpMember: !1
            },
                i = l('<div class="comment-item"/>').data("operator", e).appendTo(this.$wrapper),
                new FX.Avatar({
                    renderEl: l('<div class="content-thumb"/>').appendTo(i),
                    avatar: e.avatar,
                    name: e.name,
                    size: "small"
                }),
                a = t.mentioned.users,
                n = t.comment,
                s = "",
                FX.Utils.forEach(a, function(t, e) {
                    var i = FX.Utils.escapeHtmlSpecialChar(e.nickname);
                    s += '<span class="item-style-green">@' + i + "</span>"
                }),
                r = l('<div class="item-content"><div class="content-main"></div></div>').appendTo(i),
                l('<div class="main-info"/>').text(n).appendTo(l(".content-main", r)),
                (o = l('<div class="main-title"/>').append(l("<span/>").text(e.name)).append(s).append(l('<div class="sub"/>').text(FX.Utils.format2ThumbDate(t.createTime))).prependTo(l(".content-main", r))).css("padding-right", l(".sub", o).outerWidth(!0)))
        },
        _refresh: function() {
            var t = this.options;
            this.element.empty(),
                this._createContent({
                    skip: 0,
                    limit: this.pageNow * t.perPage
                }),
                this._bindEvent()
        },
        _createComment: function(a) {
            var t = this.options
                , e = this
                , n = [];
            FX.Utils.forEach(this.commentUserMap, function(t, e) {
                var i = "@" + e;
                0 <= a.indexOf(i) && n.push(t)
            }),
                FX.Utils.ajax({
                    url: FX.Utils.getApi(t.API.data.comment_create),
                    data: {
                        dataId: t.dataId,
                        appId: t.appId,
                        entryId: t.entryId,
                        comment: a,
                        authGroupId: t.authGroupId,
                        flowId: t.flowId,
                        mentioned: {
                            users: n
                        }
                    }
                }, function(t) {
                    e._refresh()
                })
        },
        _renderFooter: function() {
            var t, e, a, i, n, s, r = this, o = this.options;
            this.$footer = l('<div class="comment-wrapper"/>').appendTo(this.element),
                o.allowComment ? (this.commentUserMap = {},
                    l('<div class="content-tip">' + i18next.t("data.comment.publish") + "</div>").on("click", function() {
                        r._showComment(a.val())
                    }).appendTo(this.$footer),
                    (t = l('<div class="comment-footer-content"/>').appendTo(this.$footer)).hide(),
                    e = l('<div class="content-area"/>').appendTo(t),
                    a = l("<textarea></textarea>").on("keyup", function() {
                        r.pubActive === FX.Utils.isEmpty(l(this).val()) && (r.pubActive = !r.pubActive,
                            s.toggleClass("x-ui-disable", !r.pubActive))
                    }).appendTo(e),
                    i = l('<div class="content-footer"/>').appendTo(t),
                    n = l('<div class="btn-left"/>').on("click", function() {
                        r._unBindClickOutSide()
                    }).appendTo(i),
                    new FX.UserGroup({
                        renderEl: n,
                        msg: "@",
                        width: 20,
                        height: 30,
                        onStopEdit: function() {
                            var t = this.getItems()
                                , i = "";
                            FX.Utils.forEach(t, function(t, e) {
                                r.commentUserMap[e.id] = e.name,
                                    i += "@" + e.name + " "
                            });
                            var e = a.val();
                            a.val(i + e).focus(),
                            i && s.removeClass("x-ui-disable"),
                                l(".select-list", this.element).html('<div class="select-empty">@</div>'),
                                this.setValue([])
                        },
                        onClose: function() {
                            r._bindClickOutSide()
                        }
                    }),
                    this.pubActive = !1,
                    s = l('<div class="btn-right x-btn style-green x-ui-disable">' + i18next.t("send") + "</div>").on("click", function() {
                        var t = a.val();
                        FX.Utils.isEmpty(t) || (r._createComment(t),
                            FX.Utils.applyFunc(r, o.onCommentCreate, [t], !1))
                    }).appendTo(i)) : l('<div class="not-allowed-tip">' + i18next.t("data.comment.noSupport.tip") + "</div>").appendTo(this.$footer)
        },
        _showComment: function(t, e) {
            var i = l(".content-tip", this.$footer)
                , a = l(".comment-footer-content", this.$footer)
                , n = l("textarea", a);
            i.hide(),
                this.$footer.addClass("for-comment"),
                a.show(),
                n.val(t).attr("placeholder", e || "").focus();
            var s = l(".content-footer > .btn-right", a);
            FX.Utils.isEmpty(t) ? s.addClass("x-ui-disable") : s.removeClass("x-ui-disable"),
                this._bindClickOutSide()
        },
        _bindEvent: function() {
            var a = this;
            this.$main.on("click", function(t) {
                var e = l(t.target).closest(".comment-item");
                if (e.length) {
                    var i = e.data("operator");
                    return i ? (a.commentUserMap = {},
                        i.isCorpMember ? (a.commentUserMap[i._id] = i.name,
                            a._showComment("@" + i.name)) : a._showComment(null, i18next.t("data.comment.memEmpty")),
                        !1) : !1
                }
            })
        },
        _bindClickOutSide: function() {
            var a = this;
            l(document).on("click.comment", function(t) {
                var e = l(".content-tip", a.$footer)
                    , i = l(".comment-footer-content", a.$footer);
                if (!l(t.target).closest(".comment-wrapper").length)
                    return i.hide(),
                        e.show(),
                        a.$footer.removeClass("for-comment"),
                        a._unBindClickOutSide(),
                        t.preventDefault(),
                        !1
            })
        },
        _unBindClickOutSide: function() {
            l(document).off("click.comment")
        }
    })
}(jQuery),
function(r) {
    FX.DataDynamicPane = FX.extend(FX.Widget, {
        CONST: {
            TYPE: {
                create: i18next.t("new"),
                update: i18next.t("modify"),
                remove: i18next.t("delete"),
                recover: i18next.t("recover")
            }
        },
        _defaultConfig: function() {
            return r.extend(FX.DataDynamicPane.superclass._defaultConfig.apply(), {
                baseCls: "fx_data_dynamic",
                API: FX.API,
                perPage: 20,
                dataId: null,
                appId: null,
                entryId: null,
                authGroupId: null
            })
        },
        _init: function() {
            FX.DataDynamicPane.superclass._init.apply(this, arguments),
                this.pageNow = 1,
                this.count = 0,
                this.$main = r('<div class="main-content"/>').appendTo(this.element),
                this.$wrapper = r('<div class="main-wrapper"/>').appendTo(this.$main),
                this._fetch()
        },
        _fetch: function(t) {
            var e = this
                , i = this.options
                , a = r.extend({
                skip: (this.pageNow - 1) * i.perPage,
                limit: i.perPage,
                dataId: i.dataId,
                appId: i.appId,
                entryId: i.entryId,
                authGroupId: i.authGroupId,
                formId: i.formId
            }, t);
            FX.Utils.ajax({
                url: FX.Utils.getApi(i.API.data.log_list),
                data: a
            }, function(t) {
                t.logs && 0 < t.logs.length ? (e.count += t.logs.length,
                    e._render(t)) : e._renderEmpty(),
                    e.couldLoad = !0
            })
        },
        _render: function(t) {
            var i = this
                , e = this.options;
            FX.Utils.forEach(t.logs, function(t, e) {
                i._createItem(e)
            }),
                t.logs.length === e.perPage ? this._renderLoadMore() : this._removeLoadMore()
        },
        _renderEmpty: function() {
            0 === this.count && r('<div class="empty-box"><div class="box-content"></div><div class="box-text">' + i18next.t("data.log.empty") + "</div></div>").appendTo(this.element)
        },
        _renderLoadMore: function() {
            var t = this
                , e = r(".btn-more", this.element);
            e && e.length || (this.couldLoad = !0,
                r('<div class="btn-more">' + i18next.t("loadMore") + "</div>").on("click", function() {
                    t.couldLoad && (t.couldLoad = !1,
                        t.pageNow++,
                        t._fetch())
                }).appendTo(this.$main))
        },
        _removeLoadMore: function() {
            r(".btn-more", this.element).remove()
        },
        _createItem: function(t) {
            var e, i, a, n, s;
            t && (e = t.operator || {
                name: i18next.t("widget.user.anonymous")
            },
                i = r('<div class="comment-item"/>').appendTo(this.$wrapper),
                new FX.Avatar({
                    renderEl: r('<div class="content-thumb"/>').appendTo(i),
                    avatar: e.avatar,
                    name: e.name,
                    size: "small"
                }),
                a = "update" === t.op ? t.diff && t.diff.length ? this._formatFormData(t) : ["" + i18next.t("data.current") + ""] : [t.data_label || "" + i18next.t("data.current") + ""],
                n = r('<div class="item-content"/>').append(r('<div class="content-main"/>').append(r('<div class="main-title"/>').append(r('<div class="sub-name"/>').text(e.name)).append(r('<div class="sub-info"/>').text(this.CONST.TYPE[t.op] || "")).append(r('<div class="sub-text"/>').text(FX.Utils.format2ThumbDate(t.createTime))))).appendTo(i),
                s = r('<div class="main-info"/>').appendTo(n),
                FX.Utils.forEach(a, function(t, e) {
                    r('<div class="info-line"/>').text(e).appendTo(s)
                }))
        },
        _formatFormData: function(t) {
            var c = [];
            return FX.Utils.forEach(t.diff, function(t, e) {
                var i = e.cellFmt && e.cellFmt.data || e.format
                    , a = e.value
                    , n = "";
                switch (e.type) {
                    case "subform":
                        break;
                    case "datetime":
                        (i = i || "yyyy-MM-dd") && a && (n = FX.Utils.date2Str(new Date(a), i));
                        break;
                    case "address":
                        i = i || "pcda",
                            n = FX.Utils.address2Str(a, "", i);
                        break;
                    case "location":
                        var s = FX.Utils.formatData({
                            lnglatVisible: !0,
                            type: e.type
                        }, a);
                        s.address && (n = s.address),
                        s.lngLat && (n += " " + s.lngLat);
                        break;
                    case "number":
                        i = i || "",
                            n = FX.Utils.num2Str(a, i);
                        break;
                    case "checkboxgroup":
                    case "combocheck":
                        n = a.join(",");
                        break;
                    case "upload":
                    case "image":
                        var r = [];
                        FX.Utils.forEach(a, function(t, e) {
                            r.push(e.name)
                        }),
                            n = r.join(",");
                        break;
                    case "signature":
                        break;
                    case "user":
                    case "dept":
                        n = a && a.name;
                        break;
                    case "usergroup":
                    case "deptgroup":
                        var o = [];
                        FX.Utils.forEach(a, function(t, e) {
                            o.push(e.name)
                        }),
                            n = o.join(",");
                        break;
                    case "linkdata":
                        n = a && a.key;
                        break;
                    default:
                        n = a
                }
                var l = [e.label];
                "subform" !== e.type && "signature" !== e.type && l.push(FX.Utils.isEmpty(n) ? i18next.t("empty") : n),
                    c.push(l.join(""))
            }),
                c
        }
    }),
        r.shortcut("DataDynamic", FX.DataDynamicPane)
}(jQuery),
function(a) {
    FX.FormDataInfoPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.FormDataInfoPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_form_data_info",
                API: FX.API,
                data: {},
                entryId: null,
                authGroupId: null
            })
        },
        _init: function() {
            FX.FormDataInfoPane.superclass._init.apply(this, arguments),
                this._createHead(),
                this._createMain()
        },
        _createHead: function() {
            this.$menu = a('<div class="log-menu"/>').appendTo(this.element),
                a('<div class="menu-text">' + i18next.t("dynamic") + "</div>").appendTo(this.$menu)
        },
        _createHeadBtn: function(t) {
            if (t)
                return a('<div class="menu-btn"><i class="icon-flowchart"/><span>' + t.text + "</span></div>").on("click", function() {
                    t.onClick && t.onClick()
                }).appendTo(this.$menu)
        },
        _createMain: function() {
            var i = this
                , t = a('<div class="log-main"/>').appendTo(this.element);
            this.$mainHead = a('<div class="main-head"/>').on("click", ".head-btn", function(t) {
                var e = a(t.currentTarget);
                if (e.hasClass("select"))
                    return !1;
                i._switchTab(e.attr("role"))
            }).appendTo(t),
                this.$body = a('<div class="main-body"/>').appendTo(t),
                FX.Utils.forEach(this._getMainBtns(), function(t, e) {
                    a('<div class="head-btn" role="' + e.role + '"/>').text(e.text).appendTo(i.$mainHead),
                    e.select && i._switchTab(e.role)
                })
        },
        _createBodyWrapper: function(t) {
            if (t)
                return a('<div class="body-wrapper" role="' + t + '"/>').appendTo(this.$body)
        },
        _getMainBtns: function() {
            return []
        },
        _switchTab: function(t) {
            a(".head-btn[role=" + t + "]", this.$mainHead).addClass("select").siblings().removeClass("select"),
                a(".body-wrapper[role=" + t + "]", this.$main).removeClass("x-ui-hidden").siblings().addClass("x-ui-hidden")
        }
    })
}(jQuery),
function(e) {
    FX.FormDataFLowInfoPane = FX.extend(FX.FormDataInfoPane, {
        _defaultConfig: function() {
            return e.extend(FX.FormDataFLowInfoPane.superclass._defaultConfig.apply(this, arguments), {
                flowStateContainer: null
            })
        },
        _init: function() {
            FX.FormDataFLowInfoPane.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            t.hasLog && this._createHeadBtn({
                text: i18next.t("chart"),
                onClick: function() {
                    e._createFlowStatePane()
                }
            })
        },
        _getMainBtns: function() {
            var t = this.options
                , e = [];
            return t.hasFlowComment && e.push({
                text: i18next.t("form.comment"),
                role: "flowComment"
            }),
            t.hasLog && e.push({
                text: i18next.t("flow.log"),
                role: "flowLog"
            }),
            t.hasDataLog && e.push({
                text: i18next.t("data.log"),
                role: "dynamic"
            }),
            t.hasDataComment && e.push({
                text: i18next.t("comment"),
                role: "dataComment"
            }),
            e.length && (e[0].select = !0),
                e
        },
        _switchTab: function(t) {
            var e = this.options;
            switch (t) {
                case "flowLog":
                    this.flowLogPane || (this.flowLogPane = new FX.FlowLogPane({
                        renderEl: this._createBodyWrapper(t),
                        API: e.API,
                        entryId: e.entryId,
                        dataId: e.dataId,
                        authGroupId: e.authGroupId,
                        formId: e.formId,
                        appId: e.appId
                    }));
                    break;
                case "flowComment":
                    this.flowCommentPane || (this.flowCommentPane = new FX.FlowCommentPane({
                        renderEl: this._createBodyWrapper(t),
                        API: e.API,
                        entryId: e.entryId,
                        dataId: e.dataId,
                        authGroupId: e.authGroupId,
                        formId: e.formId,
                        appId: e.appId
                    }));
                    break;
                case "dataComment":
                    this.dataCommentPane || (this.dataCommentPane = new FX.DataCommentPane({
                        renderEl: this._createBodyWrapper(t),
                        API: e.API,
                        dataId: e.dataId,
                        appId: e.appId,
                        entryId: e.entryId,
                        allowComment: e.allowComment,
                        authGroupId: e.authGroupId,
                        formId: e.formId,
                        flowId: e.flow && e.flow.flowId,
                        onCommentCreate: function() {
                            FX.Utils.dt(FX.CONST.TRACKER.FLOW_FORM_COMMENT_CREATE)
                        }
                    }));
                    break;
                case "dynamic":
                    this.dataDynamic || (this.dataDynamic = new FX.DataDynamicPane({
                        renderEl: this._createBodyWrapper(t),
                        API: e.API,
                        dataId: e.dataId,
                        appId: e.appId,
                        entryId: e.entryId,
                        authGroupId: e.authGroupId,
                        formId: e.formId
                    }))
            }
            FX.FormDataFLowInfoPane.superclass._switchTab.apply(this, arguments)
        },
        _createFlowStatePane: function() {
            var t = this.options;
            new FX.FlowStatePane({
                renderEl: e('<div class="flow-state"/>').appendTo(t.flowStateContainer || this.element),
                API: t.API,
                appId: t.appId,
                entryId: t.entryId,
                dataId: t.dataId,
                authGroupId: t.authGroupId,
                flow: t.flow,
                formId: t.formId
            })
        },
        getFlowLogs: function() {
            return this.flowCommentPane ? this.flowCommentPane.getLogs() : []
        },
        setFlowState: function(t) {
            this.options.flow = t
        }
    })
}(jQuery),
jQuery,
FX.FormDataCoopInfoPane = FX.extend(FX.FormDataInfoPane, {
    _getMainBtns: function() {
        var t = this.options
            , e = [{
            text: i18next.t("data.log"),
            role: "dynamic",
            select: !0
        }];
        return t.hasDataComment && e.push({
            text: i18next.t("comment"),
            role: "comment"
        }),
            e
    },
    _switchTab: function(t) {
        var e = this.options;
        switch (t) {
            case "dynamic":
                this.dataDynamic || (this.dataDynamic = new FX.DataDynamicPane({
                    renderEl: this._createBodyWrapper(t),
                    API: e.API,
                    dataId: e.dataId,
                    appId: e.appId,
                    entryId: e.formId,
                    authGroupId: e.authGroupId,
                    formId: e.formId
                }));
                break;
            case "comment":
                this.dataComment || (this.dataComment = new FX.DataCommentPane({
                    renderEl: this._createBodyWrapper(t),
                    API: e.API,
                    dataId: e.dataId,
                    appId: e.appId,
                    entryId: e.formId,
                    allowComment: e.allowComment,
                    authGroupId: e.authGroupId,
                    formId: e.formId,
                    onCommentCreate: function() {
                        FX.Utils.dt(FX.CONST.TRACKER.FORM_COMMENT_CREATE)
                    }
                }))
        }
        FX.FormDataCoopInfoPane.superclass._switchTab.apply(this, arguments)
    }
}),
function(r) {
    FX.CoopFormDataPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return r.extend(FX.CoopFormDataPane.superclass._defaultConfig.apply(), {
                baseCls: "fx-coop-form-data",
                API: FX.API,
                allowComment: !0,
                appId: null,
                authGroupId: null,
                data: null,
                dataCount: 10,
                dataId: null,
                dataIndex: 1,
                editValue: null,
                formId: null,
                printList: [],
                isPublicData: !1,
                publicDataUrlPrefix: "",
                hasShareBtn: !1,
                needFetchViewData: !1,
                formConfigManager: null,
                hasCopyBtn: !1,
                hasCustomPrint: !1,
                hasDeleteBtn: !1,
                hasEditBtn: !1,
                hasHeader: !0,
                hasPrintBtn: !1,
                hasRecoverBtn: !1,
                hasSwitchBtn: !1,
                header: null,
                height: null,
                ignoreOptAuth: !1,
                ignoreValidate: !1,
                ignoreVisible: !0,
                layout: null,
                optAuth: null,
                title: "",
                tabs: [],
                widgetOptAuth: null,
                onAfterCancel: null,
                onAfterCopyData: null,
                onAfterDeleteData: null,
                onAfterEditData: null,
                onAfterLoadData: null,
                onClose: null,
                onDeleteData: null,
                onEditData: null,
                onRecoverData: null,
                onSwitchData: null
            })
        },
        _init: function() {
            var e = this.options
                , i = this;
            FX.CoopFormDataPane.superclass._init.apply(this, arguments),
                e.dataId = e.dataId || e.data._id,
                this._createHeader();
            var t = r('<div class="form-data-container"/>').appendTo(this.element);
            this.$wrapper = r('<div class="widget-wrapper">').appendTo(t),
                this._fetchViewData(function() {
                    i.showFieldsKey = FX.Store.getKey("formDataShowFields", {
                        appId: FX.STATIC.APPID,
                        entryId: e.formId,
                        groupId: e.authGroupId
                    });
                    var t = FX.Store.get(i.showFieldsKey);
                    i.showFields = e.needFetchViewData ? FX.Utils.getShowFieldsByNames(e.header, t) : e.header,
                        i._createEditPane(),
                        i._createFormData(),
                        FX.Utils.applyFunc(i, e.onAfterLoadData, [], !1)
                }),
                this._createDataLog(t)
        },
        _fetchViewData: function(e) {
            var i = this.options;
            if (!i.needFetchViewData)
                return e && e();
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(i.API.data.view),
                data: {
                    appId: i.appId,
                    entryId: i.entryId,
                    formId: i.formId,
                    dataId: i.dataId,
                    authGroupId: i.authGroupId
                }
            }, function(t) {
                i.data = t.data,
                    i.header = t.fields,
                    FX.Utils.forEach(i.header, function(t, i) {
                        "subform" === i.type && FX.Utils.forEach(i.items, function(t, e) {
                            i.pc_sticky_column && i.pc_sticky_column.enable && t < i.pc_sticky_column.limit && (e.frozen = !0)
                        })
                    }),
                    i.printList = t.printList,
                    i.tabs = t.form.tabs,
                e && e()
            })
        },
        _createHeader: function() {
            var t, e, i = this, a = this.options;
            a.hasHeader && (t = r('<div class="preview-title-pane"/>').prependTo(this.element),
                e = a.data && a.data.label || i18next.t("unnamedData"),
                t.append(r('<div class="preview-title"/>').text(e)),
                this.expansionButton = new FX.ExpansionButton({
                    renderEl: r("<div/>").appendTo(t),
                    target: this.element
                }),
            a.onClose && r('<i class="icon-close-normal form-data-exit-icon">').click(function() {
                i.editFormPane && i.editFormPane.doClose(),
                    FX.Utils.applyFunc(i, a.onClose, [], !1)
            }).appendTo(t))
        },
        _createEditPane: function() {
            var a = this
                , n = this.options;
            a._hasEditPane() && (this.dataMenu = new FX.DataMenu({
                renderEl: r('<div class="preview-edit-pane"/>').appendTo(this.$wrapper),
                appId: n.appId,
                entryId: n.formId,
                data: n.data,
                dataCount: n.dataCount,
                dataIndex: n.dataIndex,
                isPublicData: n.isPublicData,
                publicDataUrlPrefix: n.publicDataUrlPrefix,
                canConfigPublicData: n.ignoreOptAuth,
                hasCopyBtn: n.hasCopyBtn,
                hasShareBtn: n.hasShareBtn,
                hasDeleteBtn: n.hasDeleteBtn,
                hasEditBtn: n.hasEditBtn,
                hasPrintBtn: n.hasPrintBtn,
                hasRecoverBtn: n.hasRecoverBtn,
                hasSwitchBtn: n.hasSwitchBtn,
                hasShowFieldsBtn: n.hasShowFieldsBtn || n.needFetchViewData,
                allFields: n.header,
                showFields: this.showFields,
                authGroupId: n.authGroupId,
                printList: n.printList,
                formConfigManager: n.formConfigManager,
                title: n.title,
                onCopyData: function() {
                    a._doCopyData()
                },
                onDeleteData: function() {
                    FX.Utils.applyFunc(a, n.onDeleteData, [], !1),
                        a._doDeleteData()
                },
                onEditData: function() {
                    a._doEditData()
                },
                onPrint: function(t, e) {
                    a.formData._doPrint(null, t, e)
                },
                onRecoverData: n.onRecoverData,
                onSwitchData: function(t, e, i) {
                    r(".x-window-mask", a.element).remove(),
                        i.css({
                            "z-index": FX.STATIC.zIndex++
                        }).appendTo(a.element),
                    a.switchinterval && clearTimeout(a.switchinterval),
                        a.switchinterval = setTimeout(function() {
                            i.fadeOut(300, function() {
                                FX.Utils.applyFunc(a, n.onSwitchData, [t, e], !1)
                            })
                        }, 500)
                },
                onShowFieldsChange: function(t) {
                    FX.Store.set(a.showFieldsKey, t),
                        a.showFields = FX.Utils.getShowFieldsByNames(n.header, t),
                        a.formData.element.remove(),
                        a._createFormData()
                }
            }))
        },
        _hasEditPane: function() {
            var t = this.options;
            return t.hasEditBtn || t.hasDeleteBtn || t.hasSwitchBtn || t.hasPrintBtn || t.hasRecoverBtn || t.hasShareBtn
        },
        _createFormData: function() {
            var t = this.options;
            this.formData = new FX.FormData({
                renderEl: r("<div class='x-shadow-content'/>").appendTo(this.$wrapper),
                API: t.API,
                appId: t.appId,
                authGroupId: t.authGroupId,
                data: t.data,
                entryId: t.formId,
                hasCustomPrint: t.hasCustomPrint,
                header: this.showFields,
                ignoreVisible: t.ignoreVisible,
                layout: t.layout,
                optAuth: t.optAuth,
                title: t.title,
                tabs: t.tabs
            }),
            this.expansionButton && this.expansionButton.setWidget(this.formData)
        },
        _createDataLog: function(t) {
            var e = this.options;
            new FX.FormDataCoopInfoPane({
                renderEl: r('<div class="log-wrapper"/>').appendTo(t),
                API: e.API,
                dataId: e.dataId,
                appId: e.appId,
                entryId: e.formId,
                allowComment: e.allowComment,
                authGroupId: e.authGroupId,
                formId: e.formId,
                hasDataComment: !!e.comment && e.comment.enable
            })
        },
        _doCopyData: function() {
            var n = this.options
                , s = this;
            FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.form.get, n.appId, n.entryId)
            }, function(t) {
                var e = t.entry
                    , i = r('<div class="x-window-mask modal light"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body")
                    , a = FX.Utils.getSubmitFormDataKey(n.appId, n.entryId);
                new FX.Form(r.extend(e.content, {
                    renderEl: r('<div class="x-shadow-content"/>').appendTo(i),
                    appId: n.appId,
                    entryId: n.entryId,
                    authGroupId: n.authGroupId,
                    ignoreOptAuth: n.ignoreOptAuth,
                    ignoreValidate: n.ignoreValidate,
                    buttonPosition: "middle",
                    height: "100%",
                    submitText: i18next.t("submit"),
                    title: e.name,
                    multiTabs: e.tabs,
                    formEvents: e.formEvents,
                    cacheEnable: !1,
                    updateTime: e.updateTime,
                    copyValue: n.data,
                    isCopyMode: !0,
                    hasLastContent: e.submit_prompt.hasLastContent,
                    onAfterCancel: function() {
                        i.remove()
                    },
                    onSuccess: function(t) {
                        FX.Utils.dealSubmitFormData(this.hasContentCheck, a, t.data),
                            FX.Msg.toast({
                                type: "success",
                                msg: i18next.t("submit.success")
                            }),
                            FX.Utils.applyFunc(s, n.onAfterCopyData, [], !1),
                            i.remove()
                    }
                }))
            })
        },
        _doEditData: function() {
            var e = this
                , i = this.options;
            this.dataMenu && this.dataMenu.destroy(),
                this.dataMenu = null,
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(i.API.data.read),
                    data: {
                        appId: i.appId,
                        entryId: i.entryId,
                        formId: i.formId,
                        dataId: i.dataId,
                        authGroupId: i.authGroupId
                    }
                }, function(t) {
                    e.editFormPane = new FX.Form(r.extend({}, t.form, {
                        renderEl: r("<div/>").appendTo(e.$wrapper.empty()),
                        API: i.API,
                        customCls: "more-btn",
                        authGroupId: i.authGroupId,
                        buttonPosition: "middle",
                        appId: i.appId,
                        dataId: i.dataId,
                        entryId: i.formId,
                        width: "100%",
                        height: "100%",
                        ignoreOptAuth: i.ignoreOptAuth,
                        ignoreValidate: i.ignoreValidate,
                        mode: "edit",
                        submitData: {
                            dataId: i.dataId
                        },
                        submitText: i18next.t("submit"),
                        submitUrl: FX.Utils.getApi(i.API.data.update),
                        cancelText: i18next.t("cancel"),
                        hasHeader: !1,
                        editValue: t.data,
                        widgetOptAuth: i.optAuth || t.optAuth,
                        multiTabs: t.tabs,
                        formEvents: t.formEvents,
                        onSuccess: function(t) {
                            e.element.remove(),
                                FX.Utils.applyFunc(e, i.onAfterEditData, [t], !1)
                        },
                        onAfterCancel: function() {
                            e.$wrapper.empty(),
                                e.editFormPane = null,
                                e._createEditPane(),
                                e._createFormData()
                        }
                    })),
                    e.expansionButton && e.expansionButton.setWidget(e.editFormPane)
                })
        },
        _doDeleteData: function() {
            var t, e, i = this, a = this.options, n = i18next.t("form.data.select", {
                length: '<span class="text warning">1</span>',
                interpolation: {
                    escapeValue: !1
                }
            });
            FX.Vip.hasDataBackup() ? t = n + i18next.t("form.data.recover") : (t = n + i18next.t("form.data.canNotRecover"),
                e = r('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                FX.Msg.alert({
                    title: i18next.t("dataTable.deleteAllSelectDataTip"),
                    msg: t,
                    tip: e,
                    type: "warning",
                    onOk: function() {
                        FX.Utils.dataAjax({
                            url: FX.Utils.getApi(a.API.data.remove),
                            data: {
                                appId: a.appId,
                                entryId: a.entryId,
                                formId: a.formId,
                                idList: [a.dataId],
                                authGroupId: a.authGroupId
                            }
                        }, function(t) {
                            FX.Utils.applyFunc(i, a.onAfterDeleteData, [t.count], !1)
                        }, function(t) {
                            var e = t.responseJSON || {};
                            FX.Msg.toast({
                                type: "warning",
                                msg: FX.Utils.dealServerErrMsg(e)
                            })
                        })
                    }
                })
        },
        doResize: function() {
            FX.CoopFormDataPane.superclass.doResize.apply(this, arguments);
            var t = this.options;
            FX.Utils.isEmpty(t.height) && this.element.addClass("relative-height")
        }
    }),
        r.shortcut("CoopFormData", FX.CoopFormDataPane)
}(jQuery),
function(o) {
    FX.FlowFormDataPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.FlowFormDataPane.superclass._defaultConfig.apply(), {
                baseCls: "fx-flow-form-data",
                API: FX.API,
                appId: null,
                authGroupId: null,
                comments: null,
                data: null,
                dataCount: 10,
                dataId: null,
                dataIndex: 1,
                dataPerms: {},
                flow: null,
                formId: null,
                printList: [],
                hasCopyBtn: !1,
                hasCustomPrint: !1,
                hasFlow: !0,
                hasFlowBtn: !0,
                hasFlowComment: !0,
                hasHeader: !0,
                hasActivateBtn: !1,
                hasCloseBtn: !1,
                hasTransferBtn: !1,
                hasPrintBtn: !1,
                hasRecoverBtn: !1,
                hasShareBtn: !1,
                hasSwitchBtn: !1,
                header: null,
                height: null,
                ignoreOptAuth: !1,
                ignoreValidate: !1,
                ignoreVisible: !0,
                isPrint: !1,
                layout: null,
                nodeType: ["done", "doing", "undone"],
                optAuth: null,
                title: "",
                entryName: "",
                tabs: [],
                needFetchViewData: !1,
                formConfigManager: null,
                onAfterCancel: null,
                onAfterCopyData: null,
                onAfterDeleteData: null,
                onAfterEditData: null,
                onAfterFlowChange: null,
                onAfterLoadData: null,
                onClose: null,
                onDeleteData: null,
                onEditData: null,
                onFlowNodeClick: null,
                onRecoverData: null,
                onSwitchData: null
            })
        },
        _init: function() {
            var t = this
                , e = this.options;
            FX.FlowFormDataPane.superclass._init.apply(this, arguments),
                e.dataId = e.dataId || e.data._id,
                this._createHeader(),
                this.$container = o('<div class="form-data-container"/>').appendTo(this.element),
                this.$wrapper = o('<div class="widget-wrapper">').appendTo(this.$container),
                e.hasFlow ? this.$logWrapper = o('<div class="log-wrapper"/>').appendTo(this.$container) : e.flow = {},
            this._hasEditPane() && (this.$editPane = o('<div class="preview-edit-pane"/>').appendTo(this.$wrapper)),
                this._createFlowInfo(),
                e.needFetchViewData ? this._fetchViewData(function() {
                    t._initContent()
                }) : this._getFlow(function() {
                    t._initContent()
                })
        },
        _initContent: function() {
            var t = this.options;
            this.showFieldsKey = FX.Store.getKey("formDataShowFields", {
                appId: t.appId,
                entryId: t.formId,
                groupId: t.authGroupId
            });
            var e = FX.Store.get(this.showFieldsKey);
            this.showFields = t.needFetchViewData ? FX.Utils.getShowFieldsByNames(t.header, e) : t.header,
                this._createEditPane(),
                this._createFormData(),
                this._createFooter(),
            this.flowInfoPane && this.flowInfoPane.setFlowState(t.flow),
                FX.Utils.applyFunc(self, t.onAfterLoadData, [], !1)
        },
        _fetchViewData: function(e) {
            var i = this.options;
            if (!i.needFetchViewData)
                return e && e();
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(i.API.data.view),
                data: {
                    appId: i.appId,
                    entryId: i.entryId,
                    formId: i.formId,
                    dataId: i.dataId,
                    authGroupId: i.authGroupId
                }
            }, function(t) {
                i.data = t.data,
                    i.header = t.fields,
                    FX.Utils.forEach(i.header, function(t, i) {
                        "subform" === i.type && FX.Utils.forEach(i.items, function(t, e) {
                            i.pc_sticky_column && i.pc_sticky_column.enable && t < i.pc_sticky_column.limit && (e.frozen = !0)
                        })
                    }),
                    i.flow = FX.Utils.getFlowOption(t, "part"),
                    i.printList = t.printList,
                    i.tabs = t.form.tabs,
                e && e()
            })
        },
        _createHeader: function() {
            var t, e, i = this, a = this.options;
            a.hasHeader && (t = o('<div class="preview-title-pane"/>').prependTo(this.element),
                e = a.data && a.data.label || i18next.t("unnamedData"),
                t.append(o('<div class="preview-title"/>').text(e)),
            a.flow && FX.Utils.isArray(a.flow.flowNodes) && 1 < a.flow.flowNodes.length && ("transactors" === a.flow.flowType || "ccUsers" === a.flow.flowType) && new FX.FlowNodes({
                renderEl: o('<div class="flow-nodes"/>').appendTo(t.empty()),
                title: a.entryName,
                items: a.flow.flowNodes,
                currentMenuId: a.flow.flowId,
                onMenuClick: function(t) {
                    FX.Utils.applyFunc(i, a.onFlowNodeClick, [a.formId, a.dataId, t], !1)
                }
            }),
                this.expansionButton = new FX.ExpansionButton({
                    renderEl: o("<div/>").appendTo(t),
                    target: this.element
                }),
            a.onClose && o('<i class="icon-close-normal form-data-exit-icon">').click(function() {
                i.editFormPane && i.editFormPane.doClose(),
                    FX.Utils.applyFunc(i, a.onClose, [i.stateChanged], !1)
            }).appendTo(t))
        },
        _createFlowInfo: function() {
            var t = this.options;
            t.hasFlow && (this.element.addClass("has-log"),
                this.flowInfoPane = new FX.FormDataFLowInfoPane({
                    renderEl: this.$logWrapper.empty(),
                    flowStateContainer: this.$container,
                    API: t.API,
                    flow: t.flow,
                    data: t.data,
                    appId: t.appId,
                    dataId: t.dataId,
                    entryId: t.formId,
                    authGroupId: t.authGroupId,
                    flowId: t.flowId,
                    hasLog: t.hasFlowBtn,
                    formId: t.formId,
                    hasDataComment: !!t.comment && t.comment.enable,
                    hasDataLog: t.hasDataLog,
                    allowComment: t.allowComment,
                    hasFlowComment: t.hasFlowComment
                }))
        },
        _createFooter: function() {
            var e = this
                , i = this.options;
            i.hasFooter && i.flow && !FX.Utils.isObjectEmpty(i.flow.btn) && (this.$footer = o('<div class="footer"/>').appendTo(this.$wrapper),
                new FX.FlowBtn({
                    appId: i.appId,
                    entryId: i.entryId,
                    renderEl: o('<div class="btn-pane"/>').appendTo(this.$footer),
                    flow: i.flow,
                    onSubmit: function(t) {
                        "print" !== t ? FX.Utils.dataAjax({
                            url: FX.Utils.getApi(i.API.data.flow_change),
                            data: {
                                appId: i.appId,
                                entryId: i.formId,
                                formId: i.formId,
                                dataId: i.flow.dataId,
                                flowId: i.flow.flowId,
                                flowAction: t
                            }
                        }, function() {
                            FX.Utils.applyFunc(e, i.onClose, [!0], !1)
                        }) : e.formData._doPrint(e.flowInfoPane.getFlowLogs())
                    }
                }))
        },
        _createEditPane: function() {
            var t, a = this, n = this.options;
            a._hasEditPane() && a.showFields && n.flow && (t = FX.CONST.WORKFLOW.FLOWSTATE,
            FX.Utils.isNull(n.flow.flowState) || ([t.COMPLETE, t.CLOSE].indexOf(n.flow.flowState) < 0 ? (n.hasTransferBtn = n.dataPerms.flow_transfer,
                n.hasCloseBtn = n.dataPerms.flow_close,
                n.hasActivateBtn = !1) : (n.hasActivateBtn = n.dataPerms.flow_activate,
                n.hasTransferBtn = !1,
                n.hasCloseBtn = !1)),
            this.$editPane || (this.$editPane = o('<div class="preview-edit-pane"/>').appendTo(this.$wrapper)),
                this.dataMenu = new FX.DataMenu({
                    renderEl: this.$editPane.empty(),
                    data: n.data,
                    dataCount: n.dataCount,
                    dataIndex: n.dataIndex,
                    appId: n.appId,
                    entryId: n.formId,
                    hasCopyBtn: n.hasCopyBtn,
                    hasShareBtn: n.hasShareBtn,
                    hasDeleteBtn: n.hasDeleteBtn,
                    hasEditBtn: n.hasEditBtn,
                    hasPrintBtn: n.hasPrintBtn,
                    hasRecoverBtn: n.hasRecoverBtn,
                    hasSwitchBtn: n.hasSwitchBtn,
                    hasTransferBtn: n.hasTransferBtn,
                    hasActivateBtn: n.hasActivateBtn,
                    hasCloseBtn: n.hasCloseBtn,
                    hasShowFieldsBtn: n.hasShowFieldsBtn || n.needFetchViewData,
                    allFields: n.header,
                    showFields: this.showFields,
                    authGroupId: n.authGroupId,
                    printList: n.printList,
                    formConfigManager: n.formConfigManager,
                    title: n.title,
                    onCopyData: function() {
                        a._doCopyData()
                    },
                    onDeleteData: function() {
                        FX.Utils.applyFunc(a, n.onDeleteData, [], !1),
                            a._doDeleteData()
                    },
                    onEditData: function() {
                        a._doEditData()
                    },
                    onPrint: function(t, e) {
                        a.formData._doPrint(a.flowInfoPane && a.flowInfoPane.getFlowLogs(), t, e)
                    },
                    onRecoverData: n.onRecoverData,
                    onSwitchData: function(t, e, i) {
                        o(".x-window-mask", a.element).remove(),
                            i.css({
                                "z-index": FX.STATIC.zIndex++
                            }).appendTo(a.element),
                        a.switchinterval && clearTimeout(a.switchinterval),
                            a.switchinterval = setTimeout(function() {
                                i.fadeOut(300, function() {
                                    FX.Utils.applyFunc(a, n.onSwitchData, [t, e], !1)
                                })
                            }, 500)
                    },
                    onTransfer: function() {
                        a._showTransferPane("transfer")
                    },
                    onActivate: function() {
                        a._showTransferPane("activate")
                    },
                    onClose: function() {
                        a._closeFlow()
                    },
                    onShowFieldsChange: function(t) {
                        FX.Store.set(a.showFieldsKey, t),
                            a.showFields = FX.Utils.getShowFieldsByNames(n.header, t),
                            a.formData.element.remove(),
                            a._createFormData()
                    }
                }))
        },
        _hasEditPane: function() {
            var t = this.options;
            return t.hasEditBtn || t.hasDeleteBtn || t.hasSwitchBtn || t.hasPrintBtn
        },
        _createFormData: function() {
            var t = this.options;
            this.formData = new FX.FormData({
                renderEl: o("<div/>").appendTo(this.$wrapper),
                API: t.API,
                appId: t.appId,
                authGroupId: t.authGroupId,
                data: t.data,
                entryId: t.formId,
                flow: t.flow,
                hasCustomPrint: t.hasCustomPrint,
                header: this.showFields,
                ignoreVisible: t.ignoreVisible,
                layout: t.layout,
                optAuth: t.optAuth,
                title: t.title,
                tabs: t.tabs
            }),
            this.expansionButton && this.expansionButton.setWidget(this.formData)
        },
        _doEditData: function() {
            var e = this
                , i = this.options;
            this.dataMenu && this.dataMenu.destroy(),
                this.dataMenu = null,
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(i.API.data.read),
                    data: {
                        appId: i.appId,
                        entryId: i.entryId,
                        formId: i.formId,
                        dataId: i.dataId,
                        authGroupId: i.authGroupId
                    }
                }, function(t) {
                    e.editFormPane = new FX.Form(o.extend({}, t.form, {
                        renderEl: o("<div/>").appendTo(e.$wrapper.empty()),
                        API: i.API,
                        customCls: "more-btn",
                        authGroupId: i.authGroupId,
                        buttonPosition: "middle",
                        appId: i.appId,
                        dataId: i.dataId,
                        entryId: i.formId,
                        width: "100%",
                        height: "100%",
                        ignoreOptAuth: i.ignoreOptAuth,
                        ignoreValidate: i.ignoreValidate,
                        mode: "edit",
                        submitData: {
                            dataId: i.dataId
                        },
                        submitText: i18next.t("submit"),
                        submitUrl: FX.Utils.getApi(i.API.data.update),
                        cancelText: i18next.t("cancel"),
                        hasHeader: !1,
                        editValue: t.data,
                        widgetOptAuth: i.optAuth || t.optAuth,
                        multiTabs: t.tabs,
                        formEvents: t.formEvents,
                        onSuccess: function(t) {
                            e.element.remove(),
                                FX.Utils.applyFunc(e, i.onAfterEditData, [t], !1)
                        },
                        onAfterCancel: function() {
                            e.$wrapper.empty(),
                                e.$editPane = null,
                                e.editFormPane = null,
                                e._createEditPane(),
                                e._createFormData()
                        }
                    })),
                    e.expansionButton && e.expansionButton.setWidget(e.editFormPane)
                })
        },
        _doCopyData: function() {
            var n = this.options
                , s = this;
            FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.form.get, n.appId, n.entryId)
            }, function(t) {
                var e = t.entry
                    , i = o('<div class="x-window-mask modal light"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body")
                    , a = FX.Utils.getSubmitFormDataKey(n.appId, n.entryId);
                new FX.Form(o.extend(e.content, {
                    renderEl: o('<div class="x-shadow-content"/>').appendTo(i),
                    appId: n.appId,
                    entryId: n.entryId,
                    authGroupId: n.authGroupId,
                    ignoreOptAuth: n.ignoreOptAuth,
                    ignoreValidate: n.ignoreValidate,
                    buttonPosition: "middle",
                    height: "100%",
                    submitText: i18next.t("flow.action.forward"),
                    submitData: n.ignoreOptAuth ? {
                        skipFlow: !0
                    } : {},
                    title: e.name,
                    multiTabs: e.tabs,
                    formEvents: e.formEvents,
                    cacheEnable: !1,
                    updateTime: e.updateTime,
                    copyValue: n.data,
                    isCopyMode: !0,
                    hasLastContent: e.submit_prompt.hasLastContent,
                    onAfterCancel: function() {
                        i.remove()
                    },
                    onSuccess: function(t) {
                        FX.Utils.dealSubmitFormData(this.hasContentCheck, a, t.data),
                            FX.Msg.toast({
                                type: "success",
                                msg: i18next.t("submit.success")
                            }),
                            FX.Utils.applyFunc(s, n.onAfterCopyData, [t], !1),
                            i.remove()
                    }
                }))
            })
        },
        _doDeleteData: function() {
            var t, e, i = this.options, a = i18next.t("form.data.select", {
                length: '<span class="text warning">1</span>',
                interpolation: {
                    escapeValue: !1
                }
            });
            FX.Vip.hasDataBackup() ? t = a + i18next.t("form.data.recover") : (t = a + i18next.t("form.data.canNotRecover"),
                e = o('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                FX.Msg.alert({
                    title: i18next.t("dataTable.deleteAllSelectDataTip"),
                    msg: t,
                    tip: e,
                    type: "warning",
                    onOk: function() {
                        FX.Utils.dataAjax({
                            url: FX.Utils.getApi(i.API.data.remove),
                            data: {
                                appId: i.appId,
                                entryId: i.entryId,
                                formId: i.formId,
                                idList: [i.dataId],
                                authGroupId: i.authGroupId
                            }
                        }, function(t) {
                            FX.Utils.applyFunc(self, i.onAfterDeleteData, [t.count], !1)
                        }, function(t) {
                            var e = t.responseJSON || {};
                            FX.Msg.toast({
                                type: "warning",
                                msg: FX.Utils.dealServerErrMsg(e)
                            })
                        })
                    }
                })
        },
        _closeFlow: function() {
            var e = this.options
                , i = this;
            FX.Msg.alert({
                msg: i18next.t("flow.close.tip"),
                title: i18next.t("flow.close"),
                onOk: function() {
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(e.API.data.flow_change),
                        data: {
                            flowAction: "close",
                            appId: e.appId,
                            entryId: e.formId,
                            dataId: e.dataId,
                            authGroupId: e.authGroupId
                        }
                    }, function(t) {
                        !(i.stateChanged = !0) === FX.Utils.applyFunc(i, e.onAfterFlowChange, [], !1) && i.reload(t)
                    })
                }
            })
        },
        _showTransferPane: function(e) {
            var s = this.options
                , r = this
                , t = {};
            t.url = "transfer" === e ? FX.Utils.getApi(s.API.data.flow_chargers) : FX.Utils.getApi(s.API.data.allow_activate_nodes),
                t.data = {
                    appId: s.appId,
                    entryId: s.entryId,
                    dataId: s.dataId
                },
            s.ignoreOptAuth || (t.data.authGroupId = s.authGroupId),
                FX.Utils.dataAjax(t, function(t) {
                    var i = []
                        , a = {}
                        , n = [];
                    "transfer" === e ? FX.Utils.forEach(t.flowNodes, function(t, e) {
                        i.push({
                            value: e.flowId,
                            text: e.name
                        }),
                            a[e.flowId] = e.chargers
                    }) : FX.Utils.forEach(t.flowNodes, function(t, e) {
                        n.push({
                            value: e.flowId,
                            text: e.name
                        })
                    }),
                        new FX.FlowTransferPane({
                            renderEl: o('<div class="flow-info-pane"/>').appendTo(r.element),
                            API: s.API,
                            appId: s.appId,
                            chargersMap: a,
                            transactNodes: n,
                            chargeNodes: i,
                            flowState: s.flow.flowState,
                            dataId: s.flow.dataId,
                            authGroupId: s.authGroupId,
                            entryId: s.entryId,
                            onAfterClose: function(t) {
                                !(r.stateChanged = !0) === FX.Utils.applyFunc(r, s.onAfterFlowChange, [], !1) && r.reload(t)
                            }
                        })
                })
        },
        _getFlow: function(e) {
            var i = this.options
                , a = this;
            if (i.flow)
                return FX.Utils.applyFunc(a, e, [], !1);
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(i.API.data.read),
                data: {
                    appId: i.appId,
                    entryId: i.entryId,
                    formId: i.formId,
                    dataId: i.dataId,
                    authGroupId: i.authGroupId
                }
            }, function(t) {
                i.flow = FX.Utils.getFlowOption(t, "part"),
                    FX.Utils.applyFunc(a, e, [], !1)
            })
        },
        reload: function(t) {
            var e;
            t && (e = this.options,
                o.extend(e.data, {
                    flowState: t.data.flowState,
                    chargers: t.data.chargers,
                    updateTime: t.data.updateTime
                }),
                this.formData.destroy(),
                this._createFormData(),
                this._createFlowInfo(),
                e.flow = FX.Utils.getFlowOption(t, "part"),
                this._createEditPane(),
                this._createFooter(),
                this.flowInfoPane.setFlowState(e.flow))
        },
        doResize: function() {
            FX.FlowFormDataPane.superclass.doResize.apply(this, arguments);
            var t = this.options;
            FX.Utils.isEmpty(t.height) ? this.element.addClass("relative-height") : t.hasFooter && this.$footer && this.formData.element.css({
                bottom: this.$footer.outerHeight()
            })
        }
    }),
        o.shortcut("FlowFormData", FX.FlowFormDataPane)
}(jQuery),
function(s) {
    FX.ReportFormDataPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.ReportFormDataPane.superclass._defaultConfig.apply(), {
                baseCls: "fx-report-form-data",
                appId: null,
                data: null,
                dataCount: 10,
                dataId: null,
                dataIndex: 1,
                entryId: null,
                formId: null,
                isMultiForm: !1,
                hasCustomPrint: !1,
                hasDeleteBtn: !1,
                hasEditBtn: !1,
                hasHeader: !0,
                hasPrintBtn: !1,
                hasSwitchBtn: !1,
                header: null,
                height: null,
                ignoreVisible: !0,
                layout: null,
                title: "",
                widgetId: "",
                tabs: [],
                onAfterCancel: null,
                onAfterDeleteData: null,
                onAfterEditData: null,
                onClose: null,
                onDeleteData: null,
                onEditData: null,
                onSwitchData: null,
                colorDisable: !1
            })
        },
        _init: function() {
            var t = this.options;
            FX.ReportFormDataPane.superclass._init.apply(this, arguments),
                t.dataId = t.dataId || t.data._id,
                this._createHeader(),
                this.$wrapper = s('<div class="widget-wrapper">').appendTo(this.element),
                this._createEditPane(),
                this._createFormData()
        },
        _createHeader: function() {
            var t, e = this, i = this.options;
            i.hasHeader && ((t = s('<div class="preview-title-pane"/>').prependTo(this.element)).append(s('<div class="preview-title"/>').text(i.title)),
                new FX.ExpansionButton({
                    renderEl: s("<div/>").appendTo(t),
                    target: this.element
                }),
            i.onClose && s('<i class="icon-close-normal form-data-exit-icon">').click(function() {
                FX.Utils.applyFunc(e, i.onClose, [], !1)
            }).appendTo(t))
        },
        _createEditPane: function() {
            var a = this
                , n = this.options;
            a._hasEditPane() && (this.dataMenu = new FX.DataMenu({
                renderEl: s('<div class="preview-edit-pane"/>').appendTo(this.$wrapper),
                appId: n.appId,
                data: n.data,
                dataCount: n.dataCount,
                dataIndex: n.dataIndex,
                entryId: n.entryId,
                hasDeleteBtn: n.hasDeleteBtn,
                hasEditBtn: n.hasEditBtn,
                hasPrintBtn: n.hasPrintBtn,
                hasSwitchBtn: n.hasSwitchBtn,
                onDeleteData: function() {
                    a._doDeleteData()
                },
                onEditData: function() {
                    FX.Utils.applyFunc(a, n.onEditData, [], !1),
                        a._doEditData()
                },
                onPrint: function() {
                    a.formData._doPrint()
                },
                onSwitchData: function(t, e, i) {
                    s(".x-window-mask", a.element).remove(),
                        i.css({
                            "z-index": FX.STATIC.zIndex++
                        }).appendTo(a.element),
                    a.switchinterval && clearTimeout(a.switchinterval),
                        a.switchinterval = setTimeout(function() {
                            i.fadeOut(300, function() {
                                FX.Utils.applyFunc(a, n.onSwitchData, [t, e], !1)
                            })
                        }, 500)
                }
            }))
        },
        _hasEditPane: function() {
            var t = this.options;
            return t.hasEditBtn || t.hasDeleteBtn || t.hasSwitchBtn || t.hasPrintBtn
        },
        _createFormData: function() {
            var t = this.options;
            this.formData = new FX.FormData({
                renderEl: s("<div class='x-shadow-content'/>").appendTo(this.$wrapper),
                appId: t.appId,
                authGroupId: t.authGroupId,
                data: t.data,
                entryId: t.entryId,
                isMultiForm: t.isMultiForm,
                hasCustomPrint: t.hasCustomPrint,
                header: t.header,
                ignoreVisible: t.ignoreVisible,
                layout: t.layout,
                title: t.title,
                tabs: t.tabs,
                hasSystemFields: !1,
                colorDisable: t.colorDisable,
                needComputeFrozen: !0
            })
        },
        _doEditData: function() {
            var e = this
                , i = this.options;
            this.dataMenu && this.dataMenu.destroy(),
                this.dataMenu = null;
            var a = s('<div class="x-window-mask modal light"/>').css({
                "z-index": FX.STATIC.zIndex++
            }).appendTo("body");
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(FX.API.data.read),
                data: {
                    appId: i.appId,
                    entryId: i.entryId,
                    formId: i.formId,
                    dataId: i.dataId
                }
            }, function(t) {
                new FX.Form(s.extend(t.form, {
                    renderEl: s("<div class='x-shadow-content'/>").appendTo(a),
                    customCls: "more-btn",
                    buttonPosition: "middle",
                    appId: i.appId,
                    dataId: i.dataId,
                    editValue: t.data,
                    entryId: i.entryId,
                    formId: i.formId,
                    height: "100%",
                    mode: "edit",
                    submitData: {
                        dataId: i.dataId
                    },
                    submitText: i18next.t("submit"),
                    submitUrl: FX.Utils.getApi(FX.API.data.update),
                    title: t.formName,
                    widgetOptAuth: t.optAuth,
                    formEvents: t.formEvents,
                    onSuccess: function(t) {
                        a.remove(),
                            e.element.remove(),
                            FX.Utils.applyFunc(e, i.onAfterEditData, [t], !1)
                    },
                    onAfterCancel: function() {
                        a.remove(),
                            FX.Utils.applyFunc(e, i.onAfterCancel, [], !1)
                    }
                }))
            })
        },
        _doDeleteData: function() {
            var t, e, i = this, a = this.options, n = i18next.t("form.data.select", {
                length: '<span class="text warning">1</span>',
                interpolation: {
                    escapeValue: !1
                }
            });
            FX.Vip.hasDataBackup() ? t = n + i18next.t("form.data.recover") : (t = n + i18next.t("form.data.canNotRecover"),
                e = s('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                FX.Msg.alert({
                    title: i18next.t("dataTable.deleteAllSelectDataTip"),
                    msg: t,
                    tip: e,
                    type: "warning",
                    onOk: function() {
                        FX.Utils.dataAjax({
                            url: FX.Utils.getApi(FX.API.data.report_remove),
                            data: {
                                appId: a.appId,
                                entryId: a.entryId,
                                formId: a.formId,
                                widgetId: a.widgetId,
                                idList: [a.dataId]
                            }
                        }, function(t) {
                            FX.Utils.applyFunc(i, a.onAfterDeleteData, [t.count], !1)
                        }, function(t) {
                            var e = t.responseJSON || {};
                            FX.Msg.toast({
                                type: "warning",
                                msg: FX.Utils.dealServerErrMsg(e)
                            })
                        })
                    }
                })
        },
        doResize: function() {
            FX.ReportFormDataPane.superclass.doResize.apply(this, arguments);
            var t = this.options;
            FX.Utils.isEmpty(t.height) && this.element.addClass("relative-height")
        }
    }),
        s.shortcut("ReportFormData", FX.ReportFormDataPane)
}(jQuery),
function(a) {
    FX.ShareUrlPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return a.extend(FX.ShareUrlPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_share_url",
                url: "",
                $url: null,
                hasDownload: !1,
                hasCopy: !0,
                hasOpen: !0,
                hasQrcode: !0,
                onCopy: null,
                onQrcode: null,
                qrcodeName: ""
            })
        },
        _init: function() {
            FX.ShareUrlPane.superclass._init.apply(this, arguments),
                this.url = this.options.url,
                this._createShareContent()
        },
        _createShareContent: function() {
            var t = this.options
                , e = this;
            t.$url ? this.element.append(t.$url) : this.editComp = new FX.TextEditor({
                renderEl: a('<div class="url-wrapper"/>').appendTo(this.element),
                enable: !1,
                height: 28,
                value: this.url
            });
            var i = a('<div class="btn-wrapper"/>').appendTo(this.element);
            t.hasCopy && a('<div class="btn copy">' + i18next.t("copy") + "</div>").click(function() {
                FX.Utils.copyToClipboard(e.url, function() {
                    FX.Msg.toast({
                        type: "success",
                        msg: i18next.t("link.copySuccess")
                    }),
                        FX.Utils.applyFunc(e, t.onCopy, [], !1)
                })
            }).appendTo(i),
            t.hasOpen && (this.$open = a('<a class="btn open" target="_blank">' + i18next.t("open") + "</a>").attr("href", this.url).attr("title", i18next.t("openLink")).appendTo(i)),
            t.hasDownload && a('<div class="btn download">' + i18next.t("download") + "</div>").click(function() {
                window.location.href = e.url
            }).appendTo(i),
            t.hasQrcode && (this.$qrcode = a('<div class="btn qr-code"/>').append(FX.Utils.createQrcodeBtn(this.url, "", function() {
                FX.Utils.applyFunc(e, t.onQrcode, [], !1)
            }, t.qrcodeName)).appendTo(i))
        },
        setUrl: function(t, e) {
            this.url = t,
            this.editComp && this.editComp.setValue(this.url),
            this.$open && this.$open.attr("href", this.url),
            this.$qrcode && this.$qrcode.empty().append(FX.Utils.createQrcodeBtn(this.url, void 0, void 0, e))
        }
    }),
        a.shortcut("shareurlpane", FX.ShareUrlPane)
}(jQuery),
function(s) {
    FX.DashSortPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.DashSortPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_dash_sort_pane",
                sorts: [],
                fields: []
            })
        },
        _init: function() {
            FX.DashSortPane.superclass._init.apply(this, arguments);
            var r, t = this.options, n = this;
            this.dashSort = new FX.DashSort({
                sorts: t.sorts.slice(0),
                onChange: function() {
                    n._renderContent(),
                        n._setRemoveBtnEnable()
                },
                onFail: function(t) {
                    t === FX.CONST.DASH_SORT_ERROR.MAX_COUNT && FX.Msg.toast({
                        type: "warning",
                        msg: i18next.t("dash.sort.maxCount.tip", {
                            count: FX.CONST.MAX_DASH_SORT_COUNT
                        })
                    })
                }
            }),
                this._renderTitle(),
                this._renderContent(),
                this.$content.sortable({
                    handle: ".line-text , .line-head-icon",
                    onDragStart: function(t, e, i, a) {
                        var n = t.offset()
                            , s = e.rootGroup.pointer;
                        r = s.top - n.top,
                            i(t)
                    },
                    onDrag: function(t, e, i, a) {
                        e.left = t.offset().left,
                            e.top -= r,
                            i(t, e)
                    },
                    onDrop: function(t, e, i, a) {
                        i(t),
                            n._resetSorts()
                    }
                })
        },
        _renderTitle: function() {
            var i = this
                , t = s('<div class="pane-title"/>').on("click", function(t) {
                var e = s(t.target).closest(".title-btn");
                if (e && e.length && !e.hasClass("disable"))
                    switch (e.data("action")) {
                        case "add":
                            i._renderFieldSelect(e);
                            break;
                        case "remove":
                            i.dashSort.reset([])
                    }
            }).appendTo(this.element);
            s('<div class="title-btn left"><i class="icon-add"></i><span>' + i18next.t("dash.sort.add") + "</span></div>").data("action", "add").appendTo(t),
                this.$removeBtn = s('<div class="title-btn right">' + i18next.t("delete.all") + "</div>").data("action", "remove").appendTo(t),
                this._setRemoveBtnEnable()
        },
        _setRemoveBtnEnable: function() {
            this.options;
            0 < this.dashSort.getSorts().length ? this.$removeBtn.removeClass("disable") : this.$removeBtn.addClass("disable")
        },
        _renderFieldSelect: function(t) {
            var i = this
                , e = this._getSortFields()
                , a = s('<div class="fx_dash_sort_bubble"/>').on("click", function(t) {
                var e = s(t.target).closest(".content-line");
                e.length && !e.hasClass("select") && i.dashSort.updateSort(e.data("tag"), FX.CONST.SORT.ASC) && e.addClass("select")
            });
            e.length ? FX.Utils.forEach(e, function(t, e) {
                s('<div class="content-line"/>').toggleClass("select", e.select).data("tag", e.tag).text(e.text).appendTo(a)
            }) : s('<div class="content-empty"/>').text(i18next.t("dash.sort.field.empty")).appendTo(a),
                FX.Msg.bubble({
                    anchor: t,
                    text4Ok: null,
                    minWidth: 180,
                    text4Cancel: null,
                    contentHTML: a,
                    contentPadding: 0,
                    hasTriangle: !1,
                    hAdjust: 48
                })
        },
        _renderContent: function() {
            var a = this;
            this.$content || (this.$content = s('<ul class="pane-content"/>').appendTo(this.element)),
                this.$content.empty();
            var t = this.dashSort.getSorts();
            t.length ? (this._removeEmpty(),
                FX.Utils.forEach(t, function(t, e) {
                    var i = a._getFieldBySort(e);
                    a._renderSort({
                        text: i.title,
                        value: e[i.tag],
                        tag: i.tag
                    })
                })) : this._renderEmpty()
        },
        _renderEmpty: function() {
            s(".empty-msg", this.$content) && s('<li class="empty-msg">' + i18next.t("dash.sort.empty") + "</li>").appendTo(this.$content)
        },
        _removeEmpty: function() {
            s(".empty-msg", this.$content).remove()
        },
        _renderSort: function(i) {
            var a = this
                , t = FX.CONST.SORT
                , e = s("<li/>").data("sort", i).appendTo(this.$content)
                , n = s('<div class="content-line"><i class="line-head-icon icon-drag-menu"></i><i class="line-remove-icon icon-trasho"></i></div>').on("click", function(t) {
                var e = s(t.target).closest(".line-remove-icon");
                e && e.length && a.dashSort.updateSort(i.tag, FX.CONST.SORT.DEFAULT)
            }).append(s('<div class="line-text"/>').text(i.text)).appendTo(e);
            new FX.Segment({
                renderEl: s('<div class="line-btn-wrapper custom-segment"/>').appendTo(n),
                items: [{
                    text: i18next.t("ascending"),
                    value: t.ASC
                }, {
                    text: i18next.t("descending"),
                    value: t.DESC
                }],
                value: i.value,
                height: 30,
                onAfterItemSelect: function() {
                    a.dashSort.updateSort(i.tag, this.getValue())
                }
            })
        },
        _getSortFields: function() {
            var i = []
                , t = this.options
                , a = this;
            return FX.Utils.forEach(t.fields, function(t, e) {
                a._isSupportSort(e) && i.push({
                    tag: e.tag,
                    text: e.title,
                    select: !!a.dashSort.getSortValueByTag(e.tag)
                })
            }),
                i
        },
        _isSupportSort: function(t) {
            var e = t.type;
            return -1 < FX.LimitFields.dashSort.indexOf(e)
        },
        _getFieldBySort: function(i) {
            var a, t = this.options;
            return FX.Utils.forEach(t.fields, function(t, e) {
                if (i[e.tag])
                    return a = e,
                        !1
            }),
                a
        },
        _resetSorts: function() {
            var i = [];
            FX.Utils.forEach(s("li", this.$content), function() {
                var t = s(this).data("sort")
                    , e = {};
                e[t.tag] = t.value,
                    i.push(e)
            }),
                this.dashSort.reset(i)
        },
        getSorts: function() {
            return this.dashSort.getSorts()
        }
    })
}(jQuery),
function(c) {
    FX.DashChartSortPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.DashChartSortPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_dash_chart_sort_pane",
                sorts: [],
                fields: [],
                dimensionFields: [],
                incompatibleTags: [],
                maxCount: FX.CONST.MAX_DASH_SORT_COUNT,
                maxCustomSortCount: FX.CONST.MAX_DASH_CUSTOM_SORT_COUNT,
                widgetId: "",
                hideCustomSort: !1,
                onGetFilter: null
            })
        },
        _init: function() {
            FX.DashChartSortPane.superclass._init.apply(this, arguments);
            var t = this.options
                , i = this;
            this.customSortMap = {},
                this.dashSort = new FX.DashSort({
                    maxCount: t.maxCount,
                    maxCustomSortCount: t.maxCustomSortCount,
                    sorts: t.sorts,
                    onChange: function() {
                        var t = this.getCustomSorts();
                        FX.Utils.forEach(t, function(t, e) {
                            c.extend(i.customSortMap, e)
                        })
                    }
                }),
                this._initContent()
        },
        _initContent: function() {
            var s, r = this.options, o = this, l = FX.CONST.SORT;
            this.resultWidgets = {},
                FX.Utils.isObjectEmpty(r.fields) ? c('<div class="empty-tip">' + i18next.t("dash.chart.sort.empty") + "</div>").appendTo(this.element) : (s = c('<div class="sort-list"/>').appendTo(this.element),
                    FX.Utils.forEach(r.fields, function(t, a) {
                        var e, i, n = o.dashSort.getSortValueByTag(a.tag) || l.DEFAULT;
                        r.hideCustomSort && FX.DashUtils.isCustomSort(n) || (e = c('<div class="sort-item"/>').appendTo(s),
                            c('<div class="label"/>').text(a.title).appendTo(e),
                            i = [{
                                text: i18next.t("default"),
                                value: l.DEFAULT
                            }, {
                                text: i18next.t("ascending"),
                                value: l.ASC
                            }, {
                                text: i18next.t("descending"),
                                value: l.DESC
                            }],
                        !r.hideCustomSort && -1 < FX.LimitFields.dashCustomSort.indexOf(a.type) && -1 < r.dimensionFields.indexOf(a.tag) && i.push({
                            text: i18next.t("custom"),
                            itemCls: "custom-sort-item",
                            value: "custom"
                        }),
                            o.resultWidgets[a.tag] = new FX.Segment({
                                renderEl: c('<div class="select-segment"/>').appendTo(e),
                                items: i,
                                value: FX.DashUtils.isCustomSort(n) ? "custom" : n,
                                onItemSelect: function(t, e) {
                                    var i = this;
                                    return "custom" === e.value ? (FX.Utils.dt(FX.CONST.TRACKER.DASH_CUSTOM_SORT_CLICK),
                                        t.hasClass("selected") || o.dashSort.getCustomSortsCount() !== r.maxCustomSortCount ? o._showCustomSortPane(c.extend({
                                            sort: n
                                        }, a), function() {
                                            i.setValue("custom")
                                        }) : FX.Msg.toast({
                                            type: "warning",
                                            msg: i18next.t("dash.sort.maxCustomSortCount.tip", {
                                                count: FX.CONST.MAX_DASH_CUSTOM_SORT_COUNT
                                            })
                                        }),
                                        !0) : (o._updateSort(a.tag, e.value),
                                        !1)
                                }
                            }))
                    }))
        },
        _showCustomSortPane: function(e, i) {
            var a;
            FX.Utils.isObjectEmpty(e) || (a = this)._getCustomSortItems(e, function(t) {
                new FX.DashCustomSortDialog({
                    items: t,
                    onOk: function(t) {
                        a._updateSort(e.tag, t),
                        i && i()
                    }
                }).show()
            })
        },
        _getCustomSortItems: function(t, e) {
            var i = this.options
                , a = FX.Utils.getFieldInfoById(t.form)
                , n = this.customSortMap[t.tag] || t.sort
                , s = {
                appId: a.appId,
                entryId: a.entryId,
                formId: a.entryId,
                field: t.name,
                type: "text",
                hasLimit: !0
            };
            FX.DashUtils.isCustomSort(n) && (s.customSort = n),
            i.onGetFilter && (s.filter = i.onGetFilter()),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(FX._API.data.distinct),
                    data: s
                }, function(t) {
                    e && e(t.items)
                })
        },
        _updateSort: function(a, t) {
            var n, s, e, r = this.options, o = this;
            -1 < r.incompatibleTags.indexOf(a) ? (n = this.dashSort.getSortedTags(),
                s = null,
                FX.Utils.forEach(r.incompatibleTags, function(t, e) {
                    if (e !== a) {
                        if (r.hideCustomSort) {
                            var i = o.dashSort.getSortValueByTag(e);
                            if (FX.DashUtils.isCustomSort(i))
                                return
                        }
                        return -1 < n.indexOf(e) ? (s = e,
                            !1) : void 0
                    }
                }),
                o.dashSort.updateSort(a, t, s),
            (e = this.resultWidgets[s]) && e.setValue(FX.CONST.SORT.DEFAULT)) : o.dashSort.updateSort(a, t)
        },
        getSorts: function() {
            var n = this.options
                , s = this
                , r = []
                , o = [];
            return FX.Utils.forEach(n.fields, function(t, e) {
                var i, a = s.dashSort.getSortValueByTag(e.tag);
                a && ((i = {})[e.tag] = a,
                    n.hideCustomSort && FX.DashUtils.isCustomSort(a) ? o.push(i) : r.push(i))
            }),
                r.concat(o)
        }
    })
}(jQuery),
function(o) {
    FX.MenuTree = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.MenuTree.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fs-menutree",
                nodes: [],
                indent: 0,
                hasFlow: !1,
                onNodeClick: null,
                onNodeCreate: null,
                onNodeExpand: null,
                onNodeCollapse: null,
                onDisplayNodes: null,
                onFlowMangerCreate: null
            })
        },
        _init: function() {
            FX.MenuTree.superclass._init.apply(this, arguments);
            var t, e = this.options, i = {
                type: "group",
                child: e.nodes,
                level: 0
            };
            e.hasFlow && (t = this._createFlowManager().appendTo(this.element),
                FX.Utils.applyFunc(this, e.onFlowMangerCreate, [t], null));
            var a = o('<div class="entry-search"/>').appendTo(this.element);
            this.expandNode(i, null, this.element),
                this._renderSearch(a),
                this._bindEvts()
        },
        _createFlowManager: function() {
            var i = o('<div class="flow-manage"/>')
                , t = [{
                id: "todo",
                type: "flow",
                listType: "todo",
                icon: "icon-alarm",
                text: i18next.t("flow.todo")
            }, {
                id: "create",
                type: "flow",
                listType: "create",
                icon: "icon-note",
                text: i18next.t("flow.create")
            }, {
                id: "transactors",
                type: "flow",
                listType: "transactors",
                icon: "icon-transactor-my",
                text: i18next.t("flow.transactor.my")
            }, {
                id: "ccusers",
                type: "flow",
                listType: "ccUsers",
                icon: "icon-plane",
                text: i18next.t("flow.ccuser.my")
            }];
            return FX.Utils.forEach(t, function(t, e) {
                o('<a class="menutree-node fs-menu-item node-flow"/>').attr("data-id", e.id).data("NODE", e).append('<i class="tree-icon ' + e.icon + '"/>').append('<span class="menutree-text">' + e.text + "</span>").appendTo(i)
            }),
                this._bindFlowEvents(i),
                i
        },
        _bindFlowEvents: function(t) {
            var i = this;
            this.options;
            t.on("click", ".menutree-node", function(t) {
                var e = o(t.currentTarget);
                i.clickNode(e.data("NODE"), e)
            })
        },
        _renderSearch: function(t) {
            var a = this
                , e = this.options;
            new FX.SearchInput({
                renderEl: o('<div class=""/>').appendTo(t),
                size: "small",
                items: this._reSortNodes(e.nodes),
                onAfterItemCreate: function(t, e) {
                    var i = this;
                    o('<i class="entry-icon"/>').addClass(t.icon).prependTo(e),
                        e.on("click", function() {
                            a.clickNode(t, e),
                                i.clearSearch()
                        })
                },
                onReturn: function(t) {
                    var e = o('[data-id="' + t.id + '"]');
                    a.clickNode(t, e),
                        this.clearSearch()
                },
                onSearch: function() {
                    FX.Utils.dt(FX.CONST.TRACKER.APP_SEARCH)
                }
            })
        },
        _getNodeType: function(t) {
            return "form" === t.type ? t.hasCoop ? "coop" : "flow" : t.type
        },
        _reSortNodes: function(t) {
            var a = {
                flow: [],
                coop: [],
                dash: [],
                report: [],
                group: []
            }
                , n = this;
            return FX.Utils.forEach(t, function(t, e) {
                var i = n._getNodeType(e);
                a[i].push(e),
                e.child && FX.Utils.forEach(e.child, function(t, e) {
                    i = n._getNodeType(e),
                        a[i].push(e)
                })
            }),
                [].concat(a.flow, a.coop, a.dash, a.report)
        },
        _bindEvts: function() {
            function t(t) {
                var e, i, a = t.target, n = o(a).closest("a.menutree-node");
                n && 0 < n.length && ("mouseover" === (e = t.type) ? n.addClass("fui-seb fui-fht") : "mouseout" === e ? n.hasClass("select") || n.removeClass("fui-seb fui-fht") : "click" === e && (i = n.data("NODE"),
                    s.clickNode(i, n)))
            }
            var s = this;
            this.element.bind("mouseover", t).bind("mouseout", t).bind("click", t)
        },
        createIconFont: function(t) {
            return o("<i/>").addClass(t).addClass("entry-icon")
        },
        _onNodeCreate: function(t, e) {
            var i = this.options
                , a = o('<a class="menutree-node"/>').data("NODE", t).attr("data-id", t.id);
            return !1 === FX.Utils.applyFunc(this, i.onNodeCreate, [t, a, e], !1) ? ("group" === t.type ? (a.addClass("fs-menu-item").attr("title", t.text).appendTo(e),
                this.createIconFont("icon-tree-group").appendTo(a)) : this._isGroupNode(t) ? (a.addClass("fs-menu-item").attr("title", t.text).appendTo(e),
                this.createIconFont(t.icon).appendTo(a)) : (a.addClass("fs-menu-item menutree-child").attr("title", t.text).appendTo(e),
            i.indent && a.css({
                "padding-left": (t.level - 1) * i.indent + 20
            }),
                o('<i class="tree-icon"/>').addClass("icon-tree-leaf " + t.icon).appendTo(a)),
                o('<span class="menutree-text"/>').text(t.text).appendTo(a)) : e.remove(),
                a
        },
        _isGroupNode: function(t) {
            return -1 < ["group", "refApp", "etlTable", "aggregateTable"].indexOf(t.type)
        },
        clickNode: function(t, e) {
            var i = this.options
                , a = e.parent("li");
            !1 === FX.Utils.applyFunc(this, i.onNodeClick, [t, e, a], !1) && (this.selectNode(e),
            this._isGroupNode(t) && (t.isexpand ? this.collapseNode(t, e, a) : this.expandNode(t, e, a)))
        },
        selectNode: function(t) {
            var e = t.data("NODE");
            e && this._isGroupNode(e) || (o(".fs-menu-item.select", this.element).removeClass("select fui-seb fui-fht"),
                t.addClass("select fui-seb fui-fht"))
        },
        expandNode: function(n, t, e) {
            var s, r = this, i = this.options;
            n.level;
            !1 === FX.Utils.applyFunc(this, i.onNodeExpand, [n, t, e], !1) && this._isGroupNode(n) && (n.isLoaded ? e.children("ul").slideDown("fast") : (s = o("<ul/>").appendTo(e),
                FX.Utils.forEach(n.child, function(t, e) {
                    e.level = n.level + 1,
                        e.parent = n;
                    var i = o("<li/>").appendTo(s)
                        , a = r._onNodeCreate(e, i);
                    e.isexpand && r.expandNode(e, a, i)
                }),
                n.isLoaded = !0),
                e.addClass("group-open")),
                n.isexpand = !0,
                FX.Utils.applyFunc(this, i.onAfterNodeExpand, [n, t, e], !1)
        },
        collapseNode: function(t, e, i) {
            var a = this.options;
            !1 === FX.Utils.applyFunc(this, a.onNodeCollapse, [t, e, i], !1) && (i.children("ul").slideUp("fast"),
                i.removeClass("group-open")),
                t.isexpand = !1
        },
        loadNode: function(n, t) {
            var s = this
                , e = this.options
                , r = o('a[data-id="' + n + '"]', this.element);
            0 === r.length && FX.Utils.forEach(e.nodes, function(t, a) {
                s._isGroupNode(a) && FX.Utils.forEach(a.child, function(t, e) {
                    if (e.id === n) {
                        var i = o('a[data-id="' + a.id + '"]', s.element);
                        return s.expandNode(i.data("NODE"), i, i.closest("li")),
                            r = o('a[data-id="' + n + '"]', s.element),
                            !1
                    }
                })
            }),
                this.selectNode(r);
            var i = r.data("NODE");
            return FX.Utils.applyFunc(s, t, [i, r], !1),
                r
        }
    })
}(jQuery),
function(l) {
    FX.Platform = FX.extend(FX.Widget, {
        CONSTS: {},
        THEME: {
            config4frame: {
                resizable: !0,
                north: {
                    visible: !0
                },
                south: {
                    visible: !1
                },
                east: {}
            },
            config4Gallery: {
                region: null
            },
            config4MenuTree: {
                region: "west"
            },
            config4tabPane: {
                style: "alpha",
                region: "east",
                isCollapsible: !1,
                hasHomepageBtn: !0
            }
        },
        _defaultConfig: function() {
            return l.extend(FX.Platform.superclass._defaultConfig.apply(), {
                baseCls: "fui_platform",
                appId: "",
                onMenuSelect: null,
                cacheEnable: !1,
                onAfterLoad: null,
                onLoadFail: null
            })
        },
        _init: function() {
            FX.Platform.superclass._init.apply(this, arguments);
            var t = this.options;
            FX.STATIC.APPID = t.appId,
                this._initFrame(this.THEME.config4frame),
                this._initMenu()
        },
        _initMenu: function() {
            var i = this
                , a = this.options;
            FX.Utils.dataAjax({
                url: FX.Utils.getApi(FX.API.app.get, FX.STATIC.APPID)
            }, function(t) {
                FX.Vip.showUpgradeTip(t.bufferState, !0),
                    i.isOwner = t.isOwner,
                    i.entryMap = t.entryMap,
                    i.treeNodes = i._sortEntryList(t.entryList, i.entryMap),
                    i.hasFlow = t.hasFlowManager,
                    i.appName = t.name,
                    i.hasFlow = t.hasFlowManager,
                    FX.Utils.setPageTitle(i.appName),
                    i._initEmptyTip(),
                    i._initMenuTree(i.THEME.config4MenuTree),
                    FX.Utils.applyFunc(i, a.onAfterLoad, [t.name, t.isAppManager], !1)
            }, function(t) {
                var e = t.responseJSON || {};
                FX.Utils.applyFunc(i, a.onLoadFail, [e], !1)
            })
        },
        _initFrame: function() {
            this.$body = l('<div class="fs-frame-body"/>').appendTo(this.element),
                this.$menu = l('<div class="fs-frame-menu"/>').appendTo(this.$body),
                this.$content = l('<div class="fs-frame-content"/>').appendTo(this.$body),
                this.CONSTS.Regions = {
                    west: this.$menu,
                    east: this.$content
                }
        },
        _initEmptyTip: function() {
            var t = '<div class="content-empty"><div class="empty-img"/><div class="empty-title">' + i18next.t("platform.empty") + "</div>";
            this.isOwner ? t += "<span>" + i18next.t("platform.empty.tip1") + "</span>" : t += "<span>" + i18next.t("platform.empty.tip2") + "</span>",
                l(t += "</div>").appendTo(this.$content)
        },
        _sortEntryList: function(t, o) {
            return t.sort(function(t, e) {
                var i = o[t.id] && o[t.id].seq
                    , a = o[e.id] && o[e.id].seq;
                if (i !== a)
                    return i - a;
                var n = o[t.id] && o[t.id]._id
                    , s = o[e.id] && o[e.id]._id
                    , r = 0;
                return s < n ? r = 1 : n < s && (r = -1),
                    r
            }),
                t
        },
        _initMenuTree: function(t) {
            var a, e, i, n;
            FX.Utils.isEmpty(t.region) || (e = (a = this).CONSTS.Regions[t.region],
                i = this.options,
                n = l('<div class="fs-frame-scroll"/>').appendTo(e),
                this.menu = new FX.MenuTree(l.extend({
                    renderEl: l("<div/>").appendTo(n),
                    indent: 20,
                    nodes: this._getTreeNodes(),
                    hasFlow: this.hasFlow,
                    onNodeClick: function(t, e) {
                        return FX.Utils.applyFunc(a, i.onMenuSelect, [t], !0) && (t && "flow" === t.type ? a.loadContentByFlow(t, e) : a.loadContentByEntry(t)),
                            !1
                    },
                    onFlowMangerCreate: function(i) {
                        a._loadFlowTodoCount(function(t) {
                            var e = l('a[data-id="todo"]', i);
                            l(".flow-count", e).remove(),
                            0 < t && e.append(l('<div class="flow-count"/>').text(a._formatFlowCount(t)))
                        })
                    },
                    onNodeCreate: function(t) {
                        return a.hasFlow || a.selectedNode || (t.child && 0 < t.child.length ? t.isexpand = !0 : a.selectedNode = t),
                            !1
                    }
                }, t)),
            a.hasFlow && !a.selectedNode && (a.selectedNode = {
                id: "todo",
                type: "flow"
            }),
                a.selectedNode ? a.loadNode(a.selectedNode.id, a.selectedNode.type) : l(".content-empty").show())
        },
        _getTreeNodes: function() {
            var a = []
                , n = this.entryMap;
            return FX.Utils.forEach(this.treeNodes, function(t, e) {
                var i = l.extend({}, e, n[e.id]);
                i.icon = FX.Utils.getIconByEntry(i),
                    a.push(i),
                i.child && FX.Utils.forEach(i.child, function(t, e) {
                    l.extend(e, n[e.id]),
                        e.icon = FX.Utils.getIconByEntry(e)
                })
            }),
                a
        },
        _loadFlowTodoCount: function(e) {
            var i = this
                , t = this.options;
            FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.flow.query_data_count, t.appId),
                data: {
                    type: "todo"
                }
            }, function(t) {
                FX.Utils.applyFunc(i, e, [t.count], !1)
            })
        },
        loadNode: function(t, i) {
            var a = this;
            this.treeNodes ? this.menu.loadNode(t, function(t, e) {
                t && ("flow" === i ? a.loadContentByFlow(t, e) : a.loadContentByEntry(t),
                    FX.Utils.setPageTitle([t.text, a.appName].join("-")))
            }) : this.selectedNode = {
                id: t,
                type: i
            }
        },
        loadContentByFlow: function(s, r) {
            var o = this;
            this.$content.empty(),
                this._createHeader(s),
                this.flowList = new FX.FlowListPane({
                    renderEl: l('<div class="flow-pane"/>').appendTo(this.$content),
                    itemsPerPage: 20,
                    listType: s.listType,
                    listFilterType: s.filterType,
                    loadMoreTrigger: "scroll",
                    listStyle: "line-list",
                    onBatchEditEnd: function() {
                        this.rebuildWithOption({
                            isBatchEditMode: !1
                        }),
                        o.$batchForwardBtn && o.$batchForwardBtn.show()
                    },
                    onAsyncSuccess: function(t, e) {
                        var i = l(".filter-num", o.$header)
                            , a = o._formatFlowCount(this.totalCount)
                            , n = o._formatFlowCount(t.count);
                        "todo" === s.listType && (r.children(".flow-count").remove(),
                            r.append(l('<div class="flow-count"/>').text(0 < this.totalCount ? a : ""))),
                            e ? i.text(i18next.t("platform.filter.count", {
                                filterCount: n,
                                totalCount: a
                            })) : i.text(i18next.t("platform.filter.totalCount", {
                                totalCount: a
                            }))
                    }
                })
        },
        _formatFlowCount: function(t) {
            return t <= FX.CONST.MAX_TODO_COUNT ? t + "" : FX.CONST.MAX_TODO_COUNT + "+"
        },
        loadContentByEntry: function(t) {
            var e, i, a = this, n = this.options;
            t && "group" !== t.type && (e = t.type,
                i = FX.STATIC.APPID,
            "group" !== e && (this.$content.empty(),
                new FX.EntryView({
                    renderEl: l("<div/>").appendTo(this.$content),
                    appId: i,
                    entryId: t.entryId,
                    entryType: e,
                    hasBreadCrumb: !0,
                    hasEntryTitle: !1,
                    hasQrCode: !1,
                    cacheEnable: n.cacheEnable,
                    onToggleMenu: function(t) {
                        a.element.toggleClass("hide-menu", t)
                    },
                    publicDataUrlPrefix: FX.CONFIG.HOST.SITE_SHORT_HOST + "/l/" + t._id
                })))
        },
        _createHeader: function(e) {
            var i = this;
            this.$header = l('<div class="platform-header"/>').appendTo(this.$content);
            var t = !1;
            this.icon = l('<i class="icon-sidebar"/>'),
                this.$sidebar = l('<div class="sidebar-container"/>').append(l('<div class="icon-container"/>').append(this.icon).on("click", function() {
                    t = !t,
                        l(i.icon).toggleClass("icon-rotate", t),
                        i.element.toggleClass("hide-menu", t)
                })).append(l("<span/>").text(e.text)).appendTo(this.$header),
                l('<span class="filter-num"/>').appendTo(this.$sidebar),
            "todo" !== e.listType && "create" !== e.listType || new FX.FlowSort({
                renderEl: l('<span class="flow-operation-btn sort"/>').prependTo(this.$header),
                flowType: e.listType,
                onSort: function(t) {
                    i.flowList.options.sort = t,
                        i.flowList.rebuild()
                }
            }),
                this.flowFilterPane = null,
                l('<a class="flow-operation-btn filter"><i class="operation-icon icon-filter-o"/><span class="operation-text">' + i18next.t("filter.condition") + "</span></a>").click(function(t) {
                    i._showFlowFilter(l(t.currentTarget), e.listType)
                }).prependTo(this.$header),
            "todo" === e.listType && (this.$batchForwardBtn = l('<a class="flow-operation-btn batch-forward"><i class="operation-icon icon-batch-edit"/><span class="operation-text">' + i18next.t("flow.action.batchForward") + "</span></a>").click(function() {
                i._doBatchForward()
            }).prependTo(this.$header))
        },
        _doBatchForward: function() {
            this.flowList && (this.$batchForwardBtn.hide(),
                this.flowList.rebuildWithOption({
                    isBatchEditMode: !0
                }))
        },
        _showFlowFilter: function(i, t) {
            var a = this;
            this.flowFilterPane ? this.flowFilterPane.show() : this.flowFilterPane = new FX.FilterWrapperPane({
                anchor: i,
                hasRelation: !1,
                hasFlowFilters: !0,
                colorEnable: !0,
                flowType: t,
                selectPaneEmptyTip: i18next.t("platform.flow.currentNode.select"),
                text4add: i18next.t("platform.flow.filter.add"),
                onStopEdit: function(t) {
                    var e = FX.Utils.getValidFilters(t);
                    0 < e.cond.length ? i.addClass("active") : i.removeClass("active"),
                        a.flowList.options.filter = e,
                        a.flowList.rebuild()
                }
            })
        },
        getAppId: function() {
            return this.options.appId
        }
    })
}(jQuery),
function(u) {
    FX.EntryView = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return u.extend(FX.EntryView.superclass._defaultConfig.apply(), {
                baseCls: "fui-entry-view",
                appId: "",
                entryId: "",
                entryType: "",
                mode: "platform",
                embed: !1,
                teamLinkUrl: "",
                cacheEnable: !1,
                onToggleMenu: null,
                publicDataUrlPrefix: ""
            })
        },
        _init: function() {
            FX.EntryView.superclass._init.apply(this, arguments);
            var e = this
                , t = this.options;
            FX.Utils.ajax({
                url: FX.Utils.getApi(this._getUrl(), t.appId, t.entryId)
            }, function(t) {
                e.data = t,
                    FX.STATIC.APPID = t.entry && t.entry.appId,
                    e._initEntryView()
            }),
                u(window).off("resize"),
                u(window).on("resize", FX.Utils.debounce(function() {
                    e.content && e.content.doResize(null, !0)
                }, 200, this))
        },
        _getUrl: function() {
            var t = "";
            switch (this.options.entryType) {
                case "report":
                    t = FX.API.report.get;
                    break;
                case "dash":
                    t = FX.API.dash.get;
                    break;
                default:
                    t = FX.API.form.get
            }
            return t
        },
        _initEntryView: function() {
            this.$view = this.element,
            this._isShowHeader() && this._createHeader(),
                this._createContent()
        },
        _createHeader: function() {
            var t = this
                , e = this.options
                , i = this.data.entry;
            if (this.$header = u('<div class="header"/>').appendTo(this.$view),
            "teamlink" === e.mode) {
                this.$header.addClass("team-link-header");
                var a, n = u('<div class="title"/>').appendTo(this.$header);
                if (this._isEmbed())
                    this.$header.addClass("is-embed");
                else {
                    switch (this._getEntryType()) {
                        case "coop":
                        case "flow":
                            o = FX.Utils.getIconByEntry(i);
                            break;
                        case "report":
                            o = "icon-report";
                            break;
                        case "dash":
                            o = FX.Utils.getIconByEntry(i)
                    }
                    n.prepend(u("<i/>").addClass(o))
                }
                FX.Utils.createQrcode(e.teamLinkUrl, 148, 148, function(t) {
                    a = t
                });
                var s = u('<div class="qrcode-btn"/>').append('<i class="icon-qrcode"/>').click(function() {
                    var t = u('<div class="qrcode-dropdown"/>');
                    u("<img/>").attr("src", a).appendTo(t),
                        u("<div/>").text(i18next.t("msg.qrCode")).appendTo(t),
                        FX.Msg.bubble({
                            anchor: s,
                            text4Ok: null,
                            text4Cancel: null,
                            contentHTML: t,
                            minWidth: 150,
                            dockPosition: "right"
                        })
                }).prependTo(this.$header)
            } else {
                var r = !1
                    , o = u('<i class="icon-sidebar"/>');
                u('<div class="sidebar-container"/>').append(u('<div class="icon-container"/>').append(o).on("click", function() {
                    r = !r,
                        u(o).toggleClass("icon-rotate", r),
                        FX.Utils.applyFunc(t, e.onToggleMenu, [r], !1),
                        setTimeout(function() {
                            t.content && t.content.doResize(null, !0)
                        }, 600)
                })).prependTo(this.$header)
            }
        },
        _setEntryName: function() {
            var t;
            this.$header && this.data && this.data.entry && (t = this.data.entry.name,
                this.$header.append(u('<div class="entry-name"/>').text(t)))
        },
        _createContent: function() {
            var t = this.options;
            this.$entryContent = u('<div class="entry-content"/>').appendTo(this.$view),
            "teamlink" === t.mode && this.$entryContent.addClass("team-link-content"),
            this._isEmbed() && this.$entryContent.addClass("is-embed"),
            this._isShowHeader() || this.$entryContent.addClass("header-hidden");
            var e = this.data.entry;
            switch (e.type) {
                case "form":
                    this._createFormViewSelector(u.extend({}, e, {
                        flowConf: this.data.flow
                    }), this.data.authGroups);
                    break;
                case "report":
                    var i = u('<div class="scroll-layer">').appendTo(this.$entryContent)
                        , a = e.content;
                    this.content = new FX.Report(u.extend(a, {
                        renderEl: u('<div class="report scrollable"/>').appendTo(i),
                        appId: e.appId,
                        entryId: e.entryId,
                        width: "100%",
                        height: "100%",
                        hasLazyLoad: !0
                    })),
                        this._setEntryName();
                    break;
                case "dash":
                    FX.Utils.dt(FX.CONST.TRACKER.DASH_VISIT),
                        this.content = new FX.Dash(u.extend(e, {
                            renderEl: u('<div class="dash"/>').appendTo(this.$entryContent),
                            appId: e.appId,
                            entryId: e.entryId,
                            width: "100%",
                            height: "100%",
                            hasLazyLoad: !0,
                            minWidth: this._isEmbed() ? 720 : 900
                        })),
                        this._setEntryName()
            }
        },
        _createFormViewSelector: function(t, e) {
            var a, i, n, s, r, o, l;
            FX.Utils.isObjectEmpty(e) ? this._createFormView(t) : (a = {},
                i = [],
                FX.Utils.forEach(e, function(t, e) {
                    0 <= e.groupId && i.push({
                        text: e.name,
                        value: e.groupId
                    }),
                        a[e.groupId] = e
                }),
                n = [],
                s = t.hasCoop ? FX.CONST.AUTH_GROUP_CONTENT : FX.CONST.FLOW_AUTH_GROUP_CONTENT,
                FX.Utils.forEach(s, function(t, e) {
                    var i = a[e.groupId];
                    FX.Utils.isNull(i) || n.push({
                        text: i.name,
                        value: i.groupId
                    })
                }),
                r = (i = n.concat(i))[0].value,
                o = FX.Store.getKey("authGroup", {
                    appId: FX.STATIC.APPID,
                    entryId: t.entryId
                }),
                l = FX.Store.get(o),
            FX.Utils.isNull(l) || (a[l] ? r = l : FX.Store.remove(o)),
                this._setFormView(r, a, t),
                i.length <= 1 ? this._setEntryName() : this._createAuthSelect({
                    value: r,
                    items: i,
                    authGroupMap: a,
                    attr: t,
                    groupIdKey: o
                }))
        },
        _createAuthSelect: function(t) {
            var n = this
                , e = t.items
                , s = t.value
                , r = t.authGroupMap
                , o = t.attr
                , l = t.groupIdKey
                , c = u('<div class="form-view-selector"/>').on("click", function() {
                var i = u('<div class="fui-entry-view-bubble"/>').on("click", function(t) {
                    var e, i = u(t.target).closest(".combo-item");
                    i && i.length && !i.hasClass("select") && (i.addClass("select").siblings().removeClass("select"),
                        e = i.data("item"),
                        s = e.value,
                        a.close(),
                        d.text(e.text),
                        n._setFormView(s, r, o),
                        FX.Store.set(l, s),
                    s === FX.CONST.DEFAULT_AUTH_GROUP && FX.Utils.dt(FX.CONST.TRACKER.AUTH_GROUP_DEFAULT_VISIT))
                });
                FX.Utils.forEach(e, function(t, e) {
                    u('<div class="combo-item"/>').text(e.text).toggleClass("select", e.value === s).toggleClass("with-separator", e.value === FX.CONST.DEFAULT_AUTH_GROUP).data("item", e).append('<div class="item-icon"><i class="icon-ok"/></div>').appendTo(i)
                });
                var a = FX.Msg.bubble({
                    anchor: c,
                    contentHTML: i,
                    minWidth: 240,
                    hasTriangle: !1,
                    hAdjust: c.outerWidth() / 2 - 6,
                    contentPadding: 0,
                    text4Cancel: null,
                    text4Ok: null
                })
            }).appendTo(this.$header)
                , d = u('<div class="name-text"/>').text(r[s].name).appendTo(c);
            u('<div class="icon-wrapper"><i class="icon-angledown"/></div>').appendTo(c)
        },
        _setFormView: function(t, e, i) {
            var a = this
                , n = this.options;
            switch (this.$dataLimitTip && this.$dataLimitTip.remove(),
                t) {
                case FX.CONST.AUTH_GROUP.SUBMIT:
                    this.form = a._createFormView(i, t),
                    FX.Vip.isDataCreateLimit() && (this.$dataLimitTip = u('<div class="data-limit-tip"/>'),
                        "teamlink" === n.mode ? FX.Vip.showDataLimitTip({
                            msg: FX.CONST.DATA_LIMIT_TIP.ACCOUNT,
                            renderEl: this.$dataLimitTip.insertBefore(this.$entryContent),
                            customCls: "team-link-tip"
                        }) : FX.Vip.showDataLimitTip({
                            msg: FX.CONST.DATA_LIMIT_TIP.ACCOUNT,
                            renderEl: this.$dataLimitTip.prependTo(this.$entryContent)
                        }));
                    break;
                default:
                    var s = e[t];
                    if (!s)
                        return;
                    this._removeStashRecord(),
                    this.form && this.form.saveFormData();
                    var r = FX.Store.getKey("showFields", {
                        appId: FX.STATIC.APPID,
                        entryId: i.entryId,
                        groupId: t
                    })
                        , o = FX.Store.getKey("metaFields", {
                        appId: FX.STATIC.APPID,
                        entryId: i.entryId,
                        groupId: t
                    });
                    this.content = new FX.DataManagePane({
                        renderEl: u('<div class="data-manage"/>').appendTo(a.$entryContent.empty()),
                        appId: i.appId,
                        entryId: i.entryId,
                        formName: i.name,
                        formItems: i.content.items,
                        comment: i.comment,
                        formAttr: {
                            submitRule: i.content.submitRule,
                            layout: i.content.layout,
                            validators: i.content.validators,
                            updateTime: i.updateTime
                        },
                        flowConf: i.flowConf,
                        hasFlowPrint: i.hasFlowPrint,
                        hasExtParams: i.hasExtParams,
                        hasLastContent: i.submit_prompt.hasLastContent,
                        hasCoop: i.hasCoop,
                        dataPerms: s.dataPerms,
                        optAuth: s.optAuth,
                        authGroupId: t,
                        isPublicData: i.isPublicData,
                        publicDataUrlPrefix: n.publicDataUrlPrefix,
                        printId: s.printId,
                        prints: s.prints,
                        showFields: FX.Store.get(r),
                        showFieldsMeta: FX.Store.get(o),
                        cacheEnable: n.cacheEnable && i.hasCache,
                        tabs: i.tabs,
                        formEvents: i.formEvents,
                        wxEnhanceMax: i.wx_enhance_max,
                        mode: "visit",
                        onDataFieldSelect: function(t) {
                            FX.Store.set(r, t)
                        },
                        onDataFieldMetaChange: function(t) {
                            FX.Store.set(o, t)
                        },
                        onDataPrint: function(t) {
                            a._showFormPrint(t)
                        }
                    })
            }
        },
        _createFormView: function(a, n) {
            var s = this
                , t = this.options;
            FX.STATIC.ENTRYID = a.entryId;
            var e = {}
                , i = !FX.Utils.isEmpty(a.flow && a.flow.flowVer);
            a.hasFlow && i && (e.forward = {
                text: FX.Utils.getFlowActionText("forward", a.flowConf)
            },
            a.flowConf.allowSave && (e.save = {
                text: FX.Utils.getFlowActionText("save", a.flowConf)
            }),
            a.hasFlowPrint && (e.print = {
                text: FX.Utils.getFlowActionText("print", a.flowConf)
            }),
                this._createStashRecord(a));
            var r = a.submit_prompt.hasLastContent
                , o = FX.Utils.getSubmitFormDataKey(t.appId, t.entryId)
                , l = FX.Utils.getSaveContentCheckKey(t.appId, t.entryId)
                , c = {
                renderEl: u('<div class="form"/>').appendTo(this.$entryContent.empty()),
                appId: a.appId,
                entryId: a.entryId,
                authGroupId: n,
                cacheEnable: t.cacheEnable && a.hasCache,
                updateTime: a.updateTime,
                width: "100%",
                height: "100%",
                hasHeader: !1,
                hasFlowHeader: !1,
                flow: FX.Utils.isObjectEmpty(e) ? null : {
                    btn: e
                },
                submitText: i18next.t("flow.action.forward"),
                buttonPosition: "left",
                multiTabs: a.tabs,
                formEvents: a.formEvents,
                copyValue: FX.Utils.getCopyValue(r, o, l),
                hasLastContent: r,
                embed: t.embed,
                onSuccess: function(t, e, i) {
                    s.$entryContent.empty(),
                        t && t.flowFailureCode ? s._createFormView(a, n) : (FX.Utils.dealSubmitFormData(this.hasContentCheck, o, t.data),
                            s.showSuccessInfo(s.$entryContent, t, e, function() {
                                s._createFormView(a, n)
                            })),
                    i && s._showFormPrint(t.data)
                }
            };
            return "teamlink" === t.mode && u.extend(c, {
                width: 780,
                height: null,
                buttonPosition: "middle",
                title: a.name,
                hasHeader: !0,
                multiTabScrollElement: this.$entryContent,
                onGetScrollContainer: function() {
                    return s.$entryContent
                }
            }),
                this.content = new FX.Form(u.extend({}, a.content, c)),
                this.content
        },
        _showFormPrint: function(t) {
            var e = FX.Utils.createMask(u("body"), {
                isLight: !0,
                isModal: !0
            });
            new FX.FormEditPane({
                renderEl: u('<div class="x-shadow-content"/>').appendTo(e),
                height: "100%",
                appId: t.appId,
                dataId: t._id,
                entryId: t.entryId,
                flowType: "print",
                flowId: 0,
                hasFlowBtn: !1,
                hasDataLog: !1,
                onCancel: function() {
                    e.remove()
                }
            })
        },
        _getEntryType: function() {
            var t = this.data.entry;
            if (t) {
                var e = "form" === t.type ? t.hasCoop ? "coop" : "flow" : "dash" === t.type ? "dash" : "report";
                return e
            }
        },
        _removeStashRecord: function() {
            this.$stashRecord && this.$stashRecord.remove()
        },
        _createStashRecord: function(a) {
            var n = this;
            this.options.cacheEnable && a.hasFlow && FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.flow.stash_data_count, a.appId),
                data: {
                    entryId: a.entryId
                }
            }, function(t) {
                var i;
                n._removeStashRecord(),
                t.count <= 0 || (i = FX.STATIC.ENTRYID,
                    n.$stashRecord = u('<div class="stash-record" />').append(u("<span />").text(i18next.t("flow.action.save"))).append(u('<span class="stash-count"/>').text(t.count)).on("click", function() {
                        var e = new FX.Slider({
                            contentWidth: 350,
                            title: i18next.t("flow.save.log"),
                            position: "right",
                            autoClose: !0,
                            onClose: function() {
                                FX.STATIC.ENTRYID = i,
                                    n._createStashRecord(a)
                            },
                            contentWidget: {
                                type: "flowlistpane",
                                entryId: a.entryId,
                                itemsPerPage: 10,
                                listType: "stash",
                                loadMoreTrigger: "click",
                                listStyle: "card-list",
                                onAsyncSuccess: function(t) {
                                    t.count <= 0 && e.close()
                                }
                            }
                        });
                        e.show()
                    }).prependTo(n.$header))
            })
        },
        showSuccessInfo: function(t, e, i, a) {
            var n, s = this;
            e && e.data && (n = e.data.submitPrompt);
            var r, o, l, c = u('<div class="success-wrapper"/>').appendTo(t), d = u('<div class="success-pane"/>').appendTo(c);
            n && "custom" === n.mode ? d.addClass("custom-pane x-subhtml").html(n.content) : (r = i18next.t("submit.success"),
                o = "data-create-success-icon",
            i && "forward" !== i && (r = i18next.t("operationSuccess"),
                o = "data-update-success-icon"),
                u("<div/>").append(u('<i class="' + o + '"/>')).appendTo(d),
                u('<div class="msg-title"/>').text(r).appendTo(d)),
            e.check_code && new FX.Tip({
                msg: FX.Utils.getErrMsg({
                    code: e.check_code
                }),
                msgType: "warning",
                height: 45,
                renderEl: u("<div/>").insertBefore(c),
                customCls: "data-limit-tip"
            }),
            a && (!n || n && ("custom" === n.mode && n.hasAddBtn || "system" === n.mode)) && (l = u('<div class="button-pane"/>').appendTo(d),
                new FX.Button({
                    renderEl: u("<div />").appendTo(l),
                    text: i18next.t("form.submit.continue"),
                    width: 160,
                    style: "green",
                    onClick: function() {
                        FX.Utils.applyFunc(s, a, [], !1)
                    }
                }))
        },
        _isEmbed: function() {
            return !!this.options.embed
        },
        _isShowHeader: function() {
            return !this._isEmbed() || this._isShowAuthSelect()
        },
        _isShowAuthSelect: function() {
            var t = this.data.entry
                , e = this.data.authGroups
                , a = {}
                , i = t.hasCoop ? FX.CONST.AUTH_GROUP_CONTENT : FX.CONST.FLOW_AUTH_GROUP_CONTENT
                , n = 0;
            return "form" === t.type && !FX.Utils.isObjectEmpty(e) && (FX.Utils.forEach(e, function(t, e) {
                0 <= e.groupId && n++,
                    a[e.groupId] = e
            }),
            1 < n || (FX.Utils.forEach(i, function(t, e) {
                var i = a[e.groupId];
                FX.Utils.isNull(i) || n++
            }),
            1 < n))
        }
    })
}(jQuery),
function(u) {
    FX.FormPrint = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return u.extend(FX.FormPrint.superclass._defaultConfig.apply(), {
                baseCls: "fx_system_print_pane",
                title: "",
                header: [],
                data: {},
                comments: null,
                layout: null,
                MAX_SUBFORM_COLS: 7
            })
        },
        _init: function() {
            FX.FormPrint.superclass._init.apply(this, arguments);
            var a = this
                , n = this.options
                , t = n.header
                , s = ["creator", "createTime", "updateTime"];
            this.wxFields = [],
                this.systemFields = [],
                FX.Utils.forEach(t, function(t, e) {
                    -1 < FX.LimitFields.wechatFields.indexOf(e.name) && a.wxFields.push(e.name),
                    -1 < s.indexOf(e.name) && a.systemFields.push(e.name)
                }),
                this._createMetaInfo(),
                this._appendTable(),
                this._setCursor(u("<tr />").appendTo(this.$table), u("<tr />").appendTo(this.$table), 0),
                FX.Utils.forEach(t, function(t, e) {
                    var i;
                    e.widget && (e = FX.Utils.getFieldAttr(e)),
                    e && s.concat(FX.LimitFields.wechatFields).indexOf(e.name) < 0 && (i = e.tag || e.name,
                        a._dealWidget(e, n.data[i]))
                }),
                this._appendComments(n.comments),
                this._processLastRow()
        },
        _createMetaInfo: function() {
            var s = this.options
                , r = s.data
                , t = this.systemFields;
            u('<div class="print-title"/>').text(s.title).appendTo(this.element);
            var e = !!this.wxFields.length;
            e && (this._createWXInfo(),
            this.systemFields.length && u('<div class="system-info-title" />').appendTo(this.element).text(i18next.t("form.fields.system.title")));
            var o = u('<div class="' + (e ? "print-info has-wx-info" : "print-info") + '" />').appendTo(this.element)
                , l = 0;
            FX.Utils.forEach(t, function(t, i) {
                var a, e, n;
                FX.Utils.forEach(s.header, function(t, e) {
                    if (e.name === i)
                        return a = e,
                            !1
                }),
                a && (e = a.tag || a.name,
                    n = r[e],
                    u('<div class="info-item" />').append(u('<span class="info-label" />').text(a.text)).append(u('<span class="info-text" />').text(n)).appendTo(o),
                    l++)
            }),
                o.addClass("with-item-" + l)
        },
        _createWXInfo: function() {
            var r = this.options
                , o = r.data;
            u('<div class="system-info-title" />').appendTo(this.element).text(i18next.t("form.fields.wechat.title"));
            var l = u('<div class="print-info has-wx-info" />').appendTo(this.element);
            FX.Utils.forEach(this.wxFields, function(t, i) {
                var a, e, n, s;
                FX.Utils.forEach(r.header, function(t, e) {
                    if (e.name === i)
                        return a = e,
                            !1
                }),
                a && (e = a.tag || a.name,
                    n = o[e],
                    "wx_avatar" === e ? (s = null,
                    FX.Utils.isArray(n) && n.length && (s = new FX.Avatar({
                        avatar: n[0].url,
                        size: "small"
                    })),
                        u('<div class="info-item" />').append(u('<span class="info-label" />').text(a.text)).append(u('<span class="info-text" />').append(s && s.element)).appendTo(l)) : u('<div class="info-item" />').append(u('<span class="info-label" />').text(a.text)).append(u('<span class="info-text" />').text(n)).appendTo(l))
            })
        },
        _dealWidget: function(i, a, t) {
            var n = this;
            if (this._isWidgetValid(i))
                switch (i.type) {
                    case "linkdata":
                        FX.Utils.forEach(i.linkFields, function(t, e) {
                            n._dealWidget(e, a && a[e.name], i)
                        });
                        break;
                    case "subform":
                        this._appendSubform(i, a);
                        break;
                    case "chargers":
                        this._appendChargers(i, a);
                        break;
                    default:
                        var e = u("<td />").text(i.text)
                            , s = this._createDataCell(i, a);
                        this._appendWidget(e, s, i.name, t && t.name)
                }
        },
        _appendWidget: function(t, e, i, a) {
            var n = this.options.layout
                , s = this.$table
                , r = this.cursor;
            n ? 12 === (a ? n[a] : n[i]) ? (r.colspan < 4 && this._processLastRow(),
                this._appendWidget2NewRow(t, e, 4)) : r.colspan <= 2 ? (r.$tr1.append(t.attr("colspan", 2)),
                r.$tr2.append(e.attr("colspan", 2)),
                r.colspan += 2) : this._appendWidget2NewRow(t, e, 2) : u("<tr />").append(t.attr("colspan", 1)).append(e.attr("colspan", 3)).appendTo(s)
        },
        _appendWidget2NewRow: function(t, e, i) {
            var a = this.cursor
                , n = this.$table;
            a.$tr1 = u("<tr />").appendTo(n),
                a.$tr2 = u("<tr />").appendTo(n),
                a.$tr1.append(t.attr("colspan", i)),
                a.$tr2.append(e.attr("colspan", i)),
                a.colspan = i
        },
        _createDataCell: function(t, e) {
            var i, a = u("<td />").attr("colspan", 1);
            switch (t.type) {
                case "image":
                case "upload":
                    FX.Utils.isEmpty(e) && (e = []),
                        new FX.FileUpload({
                            renderEl: a,
                            mode: "print",
                            files: u.makeArray(e),
                            enable: !1
                        });
                    break;
                case "signature":
                    e && a.append('<img src="' + e.thumbUrl + '"/>');
                    break;
                case "textarea":
                    e && a.append(u("<pre />").text(e));
                    break;
                case "address":
                    e && (FX.Utils.isString(e) ? a.text(e) : a.text(FX.Utils.formatData(t, e)));
                    break;
                case "location":
                    e && (i = e.address ? e : FX.Utils.formatData(t, e),
                        a.text(i.address + " " + i.lngLat));
                    break;
                case "phone":
                    e && a.text(e.phone);
                    break;
                default:
                    FX.Utils.isNull(e) && (e = ""),
                        a.text(e)
            }
            return a
        },
        _isWidgetValid: function(t) {
            return -1 < ["formula", "flowState", "chargers"].indexOf(t.type) || (FX.Utils.isValueWidget(t.type) || t.isJoined || /_join_/.test(t.name))
        },
        _appendSubform: function(s, r) {
            var o, l = this, c = this.options;
            this._processLastRow();
            var d = [];
            FX.Utils.forEach(s.items, function(t, a) {
                a.widget && (a = FX.Utils.getFieldAttr(a)),
                    "linkdata" === a.type ? FX.Utils.forEach(a.linkFields, function(t, e) {
                        var i = u.extend({}, e);
                        i.linkField = a.name,
                            d.push(i)
                    }) : "linkquery" !== a.type && d.push(a)
            });
            var t = l._chunkSubform(d);
            FX.Utils.forEach(t, function(t, e) {
                var i, a = l._appendTable(!0);
                0 === t && (i = Math.min(d.length, c.MAX_SUBFORM_COLS),
                    u("<tr />").append(u('<td class="print-center" />').attr("colspan", i).text(s.text)).appendTo(a));
                var n = u("<tr />").appendTo(a);
                FX.Utils.forEach(e, function(t, e) {
                    n.append(u("<td />").text(e.text))
                }),
                    FX.Utils.forEach(r, function(t, n) {
                        o = u("<tr />").appendTo(a),
                            FX.Utils.forEach(e, function(t, e) {
                                var i = e.linkField ? n[e.linkField] && n[e.linkField][e.name] : n[e.name]
                                    , a = l._createDataCell(e, i);
                                o.append(a)
                            })
                    })
            }),
                this._appendTable(),
                this._setCursor(u("<tr />").appendTo(this.$table), u("<tr />").appendTo(this.$table), 0)
        },
        _chunkSubform: function(t) {
            var i = []
                , e = FX.Utils.chunkArray(t, 14);
            return FX.Utils.forEach(e, function(t, e) {
                e.length <= 7 || (e.length <= 11 ? i.push(e.splice(0, e.length - 4)) : i.push(e.splice(0, 7))),
                    i.push(e)
            }),
                i
        },
        _appendTable: function(t) {
            return this.$table = u("<table />").appendTo(this.element),
            t || this.$table.addClass("print-body"),
                this.$table
        },
        _appendChargers: function(t, e) {
            var i = {}
                , a = {}
                , n = []
                , s = [];
            FX.Utils.forEach(e, function(t, e) {
                i[e.userNickname] = !0,
                    a[e.flowName] = !0
            }),
                FX.Utils.forEach(i, function(t) {
                    n.push(t)
                }),
                FX.Utils.forEach(a, function(t) {
                    s.push(t)
                }),
                this._appendWidget(u("<td />").text(i18next.t("flow.node.current")), u("<td />").text(s.join(", "))),
                this._appendWidget(u("<td />").text(i18next.t("flow.charger.current")), u("<td />").text(n.join(", ")))
        },
        _appendComments: function(t) {
            var a = this
                , n = !1;
            a._processLastRow(),
                FX.Utils.forEach(t, function(t, e) {
                    var i;
                    (e.comment || e.signature) && (n || (u("<div>" + i18next.t("form.comment") + "</div>").appendTo(a.element),
                        a._appendTable(!0),
                        n = !0),
                        i = FX.Utils.resolveUsername(e.operator, "name") + " (" + FX.Utils.date2Str(new Date(e.createTime), "yyyy-MM-dd HH:mm") + ")",
                    e.comment && (i += e.comment),
                    e.signature && (i += '<img src="' + e.signature.previewUrl + '"/>'),
                        u("<tr />").append(u('<td class="comment-label"/>').text(e.flowName)).append(u('<td class="comment-text">' + i + "</div>")).appendTo(a.$table))
                })
        },
        _processLastRow: function() {
            var t, e, i = this.cursor, a = i.$tr1.find("td"), n = i.$tr2.find("td");
            a.length && (t = u(a[a.length - 1]),
                e = parseInt(t.attr("colspan") || 1) + (4 - i.colspan),
                t.attr("colspan", e),
                (t = u(n[n.length - 1])).attr("colspan", e),
                i.colspan = 4)
        },
        _setCursor: function(t, e, i) {
            this.cursor = {
                $tr1: t,
                $tr2: e,
                colspan: i
            }
        }
    })
}(jQuery),
function(p) {
    FX.ManageTablePane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return p.extend(FX.ManageTablePane.superclass._defaultConfig.apply(), {
                baseCls: "fx_manage_table",
                API: FX.API,
                appId: "",
                entryId: "",
                formId: "",
                isAdmin: !1,
                title: "",
                dataPerms: {},
                itemPrintable: !0,
                isPublicData: !1,
                isSticky: !0,
                publicDataUrlPrefix: "",
                hasShareBtn: !1,
                hasRecoverBtn: !1,
                hasCoop: !1,
                hasFlow: !0,
                dataEditable: !0,
                resizable: !0,
                itemsPerPage: 20,
                optAuth: null,
                fields: [],
                formLayout: {},
                showFields: [],
                availableParamFields: [],
                showFieldsMeta: {},
                authGroupId: null,
                height: "100%",
                rowHeight: 32,
                cls4FullScreen: "block-fullscreen",
                tableClass: "main-table",
                needFetchViewData: !1,
                onAfterShowFieldsSelected: null,
                onAfterShowFieldsMetaChange: null,
                onRecoverData: null,
                onShowData: null,
                onLoadSuccess: null,
                allowDataView: !0,
                formConfigManager: null,
                colorEnable: !1
            })
        },
        _init: function() {
            FX.ManageTablePane.superclass._init.apply(this, arguments);
            var t = this.options;
            this.sort = [],
                this.page = 0,
                this.count = null,
                this.itemsPerPage = this._getItemsPerPage(),
                this.isBackUp = !FX.Utils.isNull(t.onRecoverData),
                FX.Utils.isObjectEmpty(t.filterParam) ? this.filter = FX.Utils.getValidFilters(this._getFilterValue()) : this.filter = t.filterParam,
            t.isSticky && this.element.addClass("has-sticky-head");
            var e = p('<div class="table-wrapper"/>').appendTo(this.element);
            this.element.addClass("has-header"),
                this._createHead().appendTo(e);
            var i = p('<div class="manage-table-body"/>').appendTo(e);
            this.$wrapper = p('<div class="fui_table-wrapper has-menu"/>').appendTo(i),
                this.$menu = p('<div class="fui-table-menu"/>').appendTo(i),
                this._initDataTable(),
                this._setEvent()
        },
        _getItemsPerPageKey: function() {
            var t = this.options
                , e = {
                appId: t.appId,
                entryId: t.formId
            };
            return FX.Utils.isNull(t.authGroupId) || (e.groupId = t.authGroupId),
            this.isBackUp && (e.ext = "dataRecycle"),
                FX.Store.getKey("itemsPerPage", e)
        },
        _getItemsPerPage: function() {
            var t = FX.Store.get(this._getItemsPerPageKey());
            return FX.Utils.isNull(t) && (t = this.options.itemsPerPage),
                t
        },
        _createHead: function() {
            var t = this.options;
            return this.$head = p('<div class="manage-table-head"/>'),
                FX.Utils.applyFunc(this, t.onAfterHeadCreate, [this.$head], !1),
                this.$head
        },
        createLoadingMask: function() {
            return FX.Utils.createMask(this.$wrapper, {
                hasLoader: !0,
                isLight: !0
            })
        },
        _initDataTable: function(t) {
            var e = this;
            FX.Utils.isObjectEmpty(t) || (this.filter = t),
                this._loadData(function() {
                    e.createTable()
                })
        },
        _hasFilter: function() {
            return this.filter && !FX.Utils.isObjectEmpty(this.filter.cond)
        },
        createTable: function() {
            var t = this
                , e = this.options;
            this.processor = this._createProcessor();
            var i = this.processor.getTable();
            this.tableHead = i.tableHead,
                this.tableData = i.tableData,
                this.tableRowHead = i.tableRowHead,
                this.tableHead[0].push({
                    rowspan: this._getHeaderRowCount(),
                    cls: "blank-cell"
                }),
                FX.Utils.forEach(this.tableData, function(t, e) {
                    e.push({
                        cls: "blank-cell"
                    })
                }),
                this._initColSizeMap(this._getColumns()),
            e.resizable && this._initColumnResizer(),
                this.$tableScroller = p('<div class="table-scroller"/>').scroll(function() {
                    t._scrollStickyHead()
                }).appendTo(this.$wrapper),
                this.$table = p('<table cellpadding="0" cellspacing="0" class="' + e.tableClass + ' x-table-bordered x-table-striped t-main"/>');
            var a = this._createColGroup(this._getColumns());
            this.tableWidth = a.data("totalWidth"),
                this.$table.append(a).width(Math.max(this.tableWidth, this.$wrapper.width())).append(this._createTableHead()).append(this._createTableBody()).appendTo(this.$tableScroller),
                this._createStickyHead(),
                this._loadCount(function() {
                    t._createPagination(),
                    0 === t.totalCount && e.isAdmin && t._createEmpty().appendTo(t.$tableScroller)
                })
        },
        _createProcessor: function() {
            var i = this
                , t = this.options;
            return new FX.DataTableProcessor({
                header: this.header,
                data: this.data,
                sort: this.sort,
                showNoAuthCell: !FX.Utils.isNull(t.authGroupId),
                hasCheck: this.hasCheck,
                onHeadCellCreate: function(t, e) {
                    "subform" !== e.type && (t.data.resizeCol = i._getFieldName(e))
                },
                dataHasCheck: function(t) {
                    return "delete" !== i.checkType || FX.Utils.isNull(t._dataPerms) ? !("edit" === i.checkType && !FX.Utils.isNull(t._dataPerms)) || (t._dataPerms.batch_update || t._dataPerms.flow_batch_update) : t._dataPerms.delete || t._dataPerms.flow_delete
                }
            })
        },
        _createTableHead: function() {
            var a = this
                , n = p('<thead class="t-head"/>');
            return FX.Utils.forEach(this.tableHead, function(t, e) {
                var i = p('<tr class="t-row th-row"/>').appendTo(n);
                FX.Utils.forEach(e, function(t, e) {
                    a._createCell(e, {
                        tag: "th",
                        cls: "th-cell"
                    }).appendTo(i)
                })
            }),
                n
        },
        _createTableBody: function() {
            var s = this
                , i = p('<tbody class="t-body"/>');
            return FX.Utils.forEach(this.tableData, function(a, t) {
                var e = a % 2 == 0 ? "odd" : "even"
                    , n = p('<tr class="t-row tb-row"/>').addClass(e).appendTo(i);
                n.attr("data-idx", s.processor.getDataIdxByRow(a)),
                    FX.Utils.forEach(s.tableRowHead, function(t, e) {
                        var i = e[a];
                        i && s._createCell(i, {
                            tag: "th",
                            cls: "rh-cell"
                        }).appendTo(n)
                    }),
                    FX.Utils.forEach(t, function(t, e) {
                        e.row = a,
                            e.col = t,
                            s._createCell(e, {
                                tag: "td",
                                cls: "td-cell"
                            }).appendTo(n)
                    })
            }),
                i
        },
        _initColSizeMap: function(t) {
            var a = this.options;
            this.columnSizeMap = this.columnSizeMap || {};
            var n = this.columnSizeMap;
            n.rowCheck = 35;
            var s = {
                textarea: 300,
                address: 300,
                location: 300,
                image: 100,
                upload: 100,
                signature: 100,
                usergroup: 250,
                deptgroup: 250,
                combocheck: 300,
                checkboxgroup: 300
            };
            FX.Utils.forEach(t, function(t, e) {
                var i = a.showFieldsMeta[e.name] && a.showFieldsMeta[e.name].width;
                n[e.name] = n[e.name] || i || s[e.type] || 150
            }),
                this.columnSizeMap = n
        },
        _getColumns: function() {
            var i, a = this, n = [];
            return this.hasCheck && n.push({
                name: "rowCheck"
            }),
                FX.Utils.forEach(this.header, function(t, e) {
                    "subform" === e.type ? FX.Utils.forEach(e.items, function(t, e) {
                        i = a._getFieldName(e),
                            n.push({
                                name: i,
                                type: e.type
                            })
                    }) : "chargers" === e.name ? (i = e.name + ".node",
                        n.push({
                            name: i
                        }),
                        i = e.name + ".charger",
                        n.push({
                            name: i
                        })) : n.push({
                        name: a._getFieldName(e),
                        type: e.type
                    })
                }),
                n
        },
        _getStickyColumns: function() {
            var t = [];
            return this.hasCheck && t.push({
                name: "rowCheck"
            }),
            this.header[0] && "label" === this.header[0].name && t.push({
                name: "label",
                type: "text"
            }),
                t
        },
        _createColGroup: function(t) {
            var i = this
                , a = p("<colgroup />")
                , n = 0
                , s = 0;
            return FX.Utils.forEach(t, function(t, e) {
                n = i.columnSizeMap[e.name],
                    p("<col />").attr("col", e.name).width(n).appendTo(a),
                    s += n
            }),
                a.data("totalWidth", s)
        },
        _getHeaderRowCount: function() {
            var t = this.header
                , i = 1;
            return FX.Utils.forEach(t, function(t, e) {
                if ("subform" === e.type)
                    return !(i = 2)
            }),
                i
        },
        _loadData: function(e) {
            var t, i = this, a = this.options;
            this.isLoading || (this.isLoading = !0,
                t = this.createLoadingMask(),
                FX.Utils.dataAjax({
                    url: FX.Utils.getApi(a.API.data.find),
                    data: {
                        fields: a.fields,
                        sort: this.sort,
                        skip: this.page * this.itemsPerPage,
                        limit: this.itemsPerPage,
                        filter: this.filter,
                        authGroupId: a.authGroupId,
                        entryId: a.entryId,
                        appId: a.appId
                    }
                }, function(t) {
                    i.header = t.header,
                        i.data = t.data,
                        FX.Utils.applyFunc(i, e, [], !1),
                        FX.Utils.applyFunc(i, a.onLoadSuccess, [t], !1)
                }, null, function() {
                    i.isLoading = !1,
                        t.remove()
                }))
        },
        rebuildStickyHead: function() {
            p(".table-sticky-head", this.$wrapper).remove(),
                p(".table-sticky-row-head", this.$wrapper).remove(),
                p(".table-sticky-intersect", this.$wrapper).remove(),
                this._createStickyHead()
        },
        getSortedFieldIdx: function(i) {
            var a = -1;
            return FX.Utils.forEach(this.sort, function(t, e) {
                if (e)
                    return e[i] ? (a = t,
                        !1) : void 0
            }),
                a
        },
        _getFieldName: function(t) {
            var e = t.tag || t.name;
            return "chargers" === e ? [e, t.show].join(".") : t.subform ? [t.subform, e].join(".") : e
        },
        _initColumnResizer: function() {
            var s = this
                , i = this.options;
            this.$columnResizerLine || (this.$columnResizerLine = p('<div class="column-resizer-line"/>').appendTo(this.element)),
            this.$columnResizer || (this.$columnResizer = p('<div class="column-resizer"/>').appendTo(this.element)),
                this.element.unbind("mouseover.resize"),
                this.element.bind("mouseover.resize", function(t) {
                    var e, i;
                    s.pressed || (e = p(t.target).closest(".th-cell")).length && e.data("resizeCol") && !e.hasClass("combined-col") && (i = (s.$currentTH = e).offset(),
                        s.$columnResizer.css({
                            left: i.left + e.outerWidth() - s.$columnResizer.outerWidth(),
                            top: i.top,
                            height: e.height()
                        }))
                }),
                this.element.unbind("mousedown.resize"),
                this.element.on("mousedown.resize", function(t) {
                    var e, i, a, n = p(t.target);
                    n.hasClass("column-resizer") && (s.element.addClass("unselectable"),
                        s.pressed = !0,
                        e = s.$currentTH,
                        i = n.offset(),
                        a = s.element.offset(),
                        s.$columnResizerLine.css({
                            left: i.left + 10,
                            top: a.top + 50,
                            height: s.element.height() - 100
                        }).addClass("active"),
                        s.startLeft = i.left,
                        s.currentField = e.data("resizeCol"),
                        s.startX = t.pageX,
                        s.startWidth = parseInt(e.outerWidth()))
                }),
                this.element.unbind("mousemove.resize"),
                this.element.on("mousemove.resize", function(t) {
                    if (s.pressed) {
                        var e = Math.max(t.pageX, s.startLeft - s.startWidth + 45);
                        return s.$columnResizerLine.css({
                            left: e
                        }),
                            s.$columnResizer.css({
                                left: e - 5
                            }),
                            !1
                    }
                }),
                this.element.unbind("mouseup.resize"),
                this.element.on("mouseup.resize", function(t) {
                    var e;
                    s.element.removeClass("unselectable"),
                        s.$columnResizerLine.removeClass("active"),
                    s.pressed && (s.pressed = !1,
                        s.$columnResizerLine.removeClass("active"),
                    s.$currentTH && s.currentField && (e = s.$currentTH.offset(),
                        s.tableWidth -= s.columnSizeMap[s.currentField],
                        s.columnSizeMap[s.currentField] = Math.max(s.startWidth + t.pageX - s.startX, 35),
                        s.$columnResizer.css({
                            left: e.left + s.$currentTH.outerWidth() - 10
                        }),
                        s.tableWidth += s.columnSizeMap[s.currentField],
                        s.$table.width(Math.max(s.tableWidth, s.$wrapper.width())),
                        p('colgroup col[col="' + s.currentField + '"]', s.$table).width(s.columnSizeMap[s.currentField]),
                        s.currentField = null,
                        s.rebuildStickyHead(),
                        s._initColumnResizer(),
                        s.$table.scroll(),
                        FX.Utils.applyFunc(s, i.onAfterShowFieldsMetaChange, [s.columnSizeMap], !1)))
                })
        },
        _createCell: function(t, e) {
            var i = e || {
                tag: "td"
            };
            i.cls && t.cls && (t.cls = i.cls + " " + t.cls);
            var a = p.extend(i, t.text || t.html || !FX.Utils.isString(t) ? t : {
                text: t
            })
                , n = p("<" + a.tag + ' class="t-cell"/>');
            switch (n.attr({
                row: a.row,
                col: a.col
            }),
                a.hasOwnProperty("html") ? n.html(a.html).attr("title", p(a.html).text()) : n.text(a.text).attr("title", a.text),
                a.align) {
                case "center":
                    n.addClass("h-center");
                    break;
                case "right":
                    n.addClass("h-right")
            }
            if (a.data)
                for (var s in a.data)
                    a.data.hasOwnProperty(s) && n.data(s, a.data[s]);
            return a.cls && n.addClass(a.cls),
            a.colspan && n.attr("colspan", a.colspan),
            a.rowspan && n.attr("rowspan", a.rowspan),
                n
        },
        _loadCount: function(t) {
            var e = this
                , i = this.options;
            FX.Utils.isNull(this.count) ? FX.Utils.dataAjax({
                url: FX.Utils.getApi(i.API.data.count),
                data: {
                    appId: i.appId,
                    entryId: i.entryId,
                    authGroupId: i.authGroupId,
                    filter: this.filter,
                    hasLimit: !0,
                    hasTotalCount: this._hasFilter() && FX.Utils.isNull(this.totalCount)
                },
                timeout: FX.CONST.DATA_COUNT_TIMEOUT
            }, function(t) {
                e.count = t.count,
                    e._hasFilter() ? FX.Utils.isNull(e.totalCount) && (e.totalCount = t.totalCount) : e.totalCount = t.count
            }, function() {}, function() {
                FX.Utils.applyFunc(e, t, [], !1)
            }) : FX.Utils.applyFunc(e, t, [], !1)
        },
        _createPagination: function() {
            var a = this
                , t = this.options
                , e = this.data && this.data.length >= this.itemsPerPage;
            new FX.Pagination({
                renderEl: p("<div />").appendTo(this.$menu),
                count: this.count,
                hasTotalCount: this._hasFilter(),
                totalCount: this.totalCount,
                limit: this.itemsPerPage,
                curPage: this.page + 1,
                hasMore: e,
                showCount: !0,
                onChangePage: function(t) {
                    a.turnPage(t - 1)
                },
                onLimitChange: function(t) {
                    a.itemsPerPage = t,
                        FX.Store.set(a._getItemsPerPageKey(), t),
                        a.page = 0,
                        a._reloadWithoutCount(a.filter)
                },
                fetchCount: function(e) {
                    var i = this;
                    FX.Utils.dataAjax({
                        url: FX.Utils.getApi(t.API.data.count),
                        data: {
                            filter: a.filter,
                            authGroupId: t.authGroupId,
                            hasLimit: !1,
                            hasTotalCount: a._hasFilter() && FX.Utils.isNull(a.totalCount)
                        }
                    }, function(t) {
                        a.count = t.count,
                            a._hasFilter() ? FX.Utils.isNull(a.totalCount) && (a.totalCount = t.totalCount) : a.totalCount = t.count,
                            FX.Utils.applyFunc(i, e, [t.count, a.totalCount], null)
                    }, function() {
                        FX.Utils.applyFunc(i, e, [], null)
                    })
                }
            })
        },
        _createEmpty: function() {
            var t = this.options
                , e = p('<div class="empty-wrapper"/>');
            p('<div class="empty-img"/>').appendTo(e),
                p('<div class="empty-tip"/>').text(i18next.t("data.empty.publish.tip")).appendTo(e);
            var i = p('<div class="pub-btn"/>').appendTo(e);
            return FX.Utils.applyFunc(this, t.onCreateEntryShare, [i], !1),
                e
        },
        _isDataEditable: function(t) {
            var e = this.options;
            return e.hasCoop ? e.dataEditable && t.update : e.dataEditable && t.flow_update
        },
        _doShowData: function(e, t) {
            var i, a, n, s, r, o, l, c = this.data[e];
            c && (i = this.options,
            !1 === FX.Utils.applyFunc(this, i.onShowData, [c], !1) && (a = this,
                n = c._id,
                s = this.header,
                this._switchCurrentRow(e),
                r = p('<div class="x-window-mask modal light scrollable"/>').css({
                    "z-index": FX.STATIC.zIndex++
                }).appendTo("body"),
                p(document).bind("keydown.left keydown.right", function(t) {
                    return p(".x-window-mask", "body").length ? (t.preventDefault(),
                        !1) : void p(document).unbind("keydown.left keydown.right")
                }),
                o = c._dataPerms || i.dataPerms,
                l = this._getOptAuth(c),
                i.formDataConfig = {
                    API: i.API,
                    appId: i.appId,
                    comment: i.comment,
                    entryId: i.formId,
                    renderEl: p("<div class='x-shadow-content'/>").appendTo(r),
                    formId: i.formId,
                    authGroupId: i.authGroupId,
                    header: s,
                    layout: i.formLayout,
                    data: c,
                    dataId: n,
                    dataPerms: o,
                    height: "100%",
                    optAuth: l,
                    hasCopyBtn: o.copy || o.flow_copy,
                    hasPrintBtn: i.itemPrintable,
                    hasEditBtn: this._isDataEditable(o),
                    hasDeleteBtn: o.delete || o.flow_delete,
                    hasRecoverBtn: i.hasRecoverBtn,
                    hasShareBtn: i.hasShareBtn,
                    hasSwitchBtn: !0,
                    hasCustomPrint: i.isAdmin || !FX.Utils.isNull(i.authGroupId),
                    dataIndex: e + 1,
                    dataCount: a.data.length,
                    ignoreOptAuth: i.isAdmin,
                    ignoreValidate: i.isAdmin,
                    title: i.title,
                    needFetchViewData: i.needFetchViewData,
                    formConfigManager: i.formConfigManager,
                    onRecoverData: function(t, e) {
                        FX.Utils.applyFunc(a, i.onRecoverData, [t, e, r], !1)
                    },
                    onAfterLoadData: function() {
                        t && a.formData._doEditData()
                    },
                    onAfterCopyData: function(t) {
                        a.updateTotalCount(1),
                            a.reload(null, !0),
                            r.remove()
                    },
                    onAfterEditData: function(t) {
                        r.remove();
                        a._reloadWithoutCount(a.filter, !0),
                            a._updateTableData(e, t.data),
                            a._doShowData(e)
                    },
                    onSwitchData: function(t, e) {
                        a.data[t - 1] && r.parent().length && (r.remove(),
                            a._doShowData(t - 1, e))
                    },
                    onAfterDeleteData: function(t) {
                        a.updateTotalCount(-1 * t),
                            a.reload(),
                            r.remove()
                    },
                    onAfterCancel: function() {
                        r.remove(),
                            a._doShowData(e)
                    },
                    onClose: function(t) {
                        r.remove(),
                        t && a.reload(this.filter, !0)
                    }
                },
                this.formData = a._createFormDataPane()))
        },
        _getOptAuth: function(t) {
            var e = this.options;
            if (!t._optAuth)
                return e.optAuth;
            var i = {};
            return FX.Utils.forEach(t._optAuth, function(t, e) {
                i[t] = FX.Utils.fieldAuthValue2Json(e)
            }),
                i
        },
        _switchCurrentRow: function(t) {
            p("tbody > tr", this.element).removeClass("current-row"),
                p('tbody > tr[data-idx="' + t + '"]', this.element).addClass("current-row")
        },
        _createFormDataPane: function() {
            var t = this.options;
            return t.hasCoop ? (p.extend(t.formDataConfig, {
                allowComment: t.dataEditable,
                isPublicData: t.isPublicData,
                publicDataUrlPrefix: t.publicDataUrlPrefix
            }),
                new FX.CoopFormDataPane(t.formDataConfig)) : (p.extend(t.formDataConfig, {
                allowComment: t.dataEditable,
                hasFlow: t.hasFlow,
                flow: t.flow,
                onFlowNodeClick: t.onFlowNodeClick,
                hasDataLog: !0,
                hasFlowBtn: t.hasFlowBtn,
                hasFlowComment: t.hasFlowComment
            }),
                new FX.FlowFormDataPane(t.formDataConfig))
        },
        _updateTableData: function(t, a) {
            var n, e = this.options;
            this.data[t] && (n = {},
                FX.Utils.forEach(e.fields, function(t, e) {
                    switch (e.type) {
                        case "user":
                        case "dept":
                            FX.Utils.isObjectEmpty(a[e.name]) ? n[e.name] = a[e.name] : n[e.name] = a[e.name].name;
                            break;
                        case "usergroup":
                        case "deptgroup":
                            var i = [];
                            FX.Utils.forEach(a[e.name], function(t, e) {
                                i.push(e.name)
                            }),
                                n[e.name] = i;
                            break;
                        default:
                            "creator" !== e.name || FX.Utils.isObjectEmpty(a[e.name]) ? n[e.name] = a[e.name] : n[e.name] = a[e.name].name
                    }
                }),
                p.extend(this.data[t], n))
        },
        _setEvent: function() {
            var u = this
                , h = this.options;
            this.$wrapper.off(".data-table"),
                this.$wrapper.on("click.data-table", function(t) {
                    var e = t.target
                        , i = t.type
                        , a = p(e).closest("tr");
                    if (a && 0 < a.length)
                        if (a.hasClass("th-row")) {
                            var n = p(e).closest(".th-cell");
                            if (n && 0 < n.length && "click" === i) {
                                var s = n.data("field");
                                if (s) {
                                    if (!n.hasClass("sortable"))
                                        return;
                                    var r = {}
                                        , o = -1;
                                    n.hasClass("sort-asc") ? (n.removeClass("sort-asc").addClass("sort-desc"),
                                        (r[s] = -1) < (o = u.getSortedFieldIdx(s)) ? u.sort[o] = r : u.sort.push(r)) : n.hasClass("sort-desc") ? (n.removeClass("sort sort-desc"),
                                    -1 < (o = u.getSortedFieldIdx(s)) && u.sort.splice(o, 1)) : (n.removeClass("sort-desc").addClass("sort sort-asc"),
                                        o = u.getSortedFieldIdx(s),
                                        -(r[s] = 1) < o ? u.sort[o] = r : u.sort.push(r)),
                                        u.page = 0,
                                        u._reloadWithoutCount()
                                }
                                var l = n.find(".x-check");
                                l && 0 < l.length && (l.toggleClass("select"),
                                    l.hasClass("select") ? u.setRemoveCheckResult(!0) : u.setRemoveCheckResult(!1))
                            }
                        } else if (a.hasClass("tb-row")) {
                            var c = p(e).closest(".table-op-btn");
                            if ("click" === i)
                                if (c && 0 < c.length) {
                                    var d = c.data("op");
                                    if (c.hasClass("x-ui-disable"))
                                        return;
                                    "check" === d && (c.hasClass("select") && u.setRemoveCheckSelectAll(!1),
                                        c.toggleClass("select"))
                                } else {
                                    if (!FX.Utils.isEmpty(FX.Utils.getSelectionText()))
                                        return;
                                    if (p(e).closest("a[href]").length)
                                        return;
                                    h.allowDataView && u._doShowData(parseInt(a.attr("data-idx")))
                                }
                        }
                }),
                this.$wrapper.on("mouseover.data-table", function(t) {
                    var e = p(t.target).closest("tr").attr("data-idx");
                    FX.Utils.isNull(e) || p('tbody > tr[data-idx="' + e + '"]', u.element).addClass("hover")
                }),
                this.$wrapper.on("mouseout.data-table", function(t) {
                    var e = p(t.target).closest("tr").attr("data-idx");
                    FX.Utils.isNull(e) || p('tbody > tr[data-idx="' + e + '"]', u.element).removeClass("hover")
                }),
                this.$wrapper.on("mouseenter.data-table", ".table-op-btn", function(t) {
                    var e, i = p(t.currentTarget);
                    "check" === i.data("op") && i.hasClass("x-ui-disable") && (e = "",
                        "delete" === u.checkType ? e = p("<span/>").text(i18next.t("data.delete.noAuth.tip")) : "edit" === u.checkType && (e = p("<span/>").text(i18next.t("data.edit.noAuth.tip"))),
                        FX.UI.showPopover({
                            position: "topLeft",
                            anchor: i,
                            content: e
                        }))
                }),
                this.$wrapper.on("mouseleave.data-table", ".table-op-btn", function(t) {
                    var e = p(t.currentTarget);
                    "check" === e.data("op") && e.hasClass("x-ui-disable") && FX.UI.closePopover()
                }),
                this.$wrapper.on("wheel", ".table-sticky-row-head", function(t) {
                    var e = t.originalEvent
                        , i = u.$tableScroller.scrollTop()
                        , a = e.deltaY;
                    1 === e.deltaMode && (a *= h.rowHeight),
                        u.$tableScroller.scrollTop(i + a),
                        t.preventDefault()
                })
        },
        turnPage: function(t) {
            this.page = t,
                this._removeTable(),
                this._initDataTable()
        },
        reload: function(t, e, i) {
            this._removeTable(),
            e || (this.page = 0),
            i || (this.count = null),
                this._initDataTable(t)
        },
        updateTotalCount: function(t) {
            this.totalCount = this.totalCount || 0,
                this.totalCount += t
        },
        _reloadWithoutCount: function(t, e) {
            this.reload(t, e, !0)
        },
        doResize: function(t) {
            FX.ManageTablePane.superclass.doResize.apply(this, arguments),
            this.$table && (this.$table.width(Math.max(this.tableWidth, this.$wrapper.width())),
                this.rebuildStickyHead(),
                this._scrollStickyHead())
        },
        refresh: function() {
            this.tableRowHead = [],
                this._removeTable(),
                this.createTable()
        },
        setHasCheck: function(t, e) {
            this.hasCheck = t,
            FX.Utils.isNull(e) || (this.checkType = e)
        },
        setRemoveCheckSelectAll: function(t) {
            t || this.$stickyRowHead.children(".t-head").find(".x-check").removeClass("select")
        },
        setRemoveCheckResult: function(t) {
            t ? this.$stickyRowHead.find(".x-check:not(.x-ui-disable)").each(function(t, e) {
                p(e).addClass("select")
            }) : this.$stickyRowHead.find(".x-check:not(.x-ui-disable)").each(function(t, e) {
                p(e).removeClass("select")
            })
        },
        getCheckResult: function() {
            var i = [];
            return this.$stickyRowHead.find(".t-body .x-check").each(function(t, e) {
                p(e).hasClass("select") && i.push(p(e).closest(".table-op-btn-cell").data("dataId"))
            }),
                i
        },
        getFilterData: function() {
            return this.filter
        },
        getSortData: function() {
            return this.sort
        },
        createHeadTools: function() {
            var t = this
                , e = this.options
                , i = i18next.t("fullScreen")
                , a = p("<a />").append('<i class="icon-enlarge">');
            t.element.hasClass(e.cls4FullScreen) && (a = p("<a />").append('<i class="icon-shrink">'),
                i = i18next.t("zoomOut")),
            this.fieldItems || (this.fieldItems = this._getShowFieldItems()),
                a.appendTo(this.$head).click(function() {
                    i = t.doFullScreen() ? (a.children("i").removeClass().addClass("icon-shrink"),
                        i18next.t("zoomOut")) : (a.children("i").removeClass().addClass("icon-enlarge"),
                        i18next.t("fullScreen"))
                }).hover(function() {
                    FX.UI.showPopover({
                        position: "bottomLeft",
                        anchor: p(this).children("i"),
                        content: p("<span/>").text(i),
                        type: "dark"
                    })
                }, function() {
                    FX.UI.closePopover()
                }),
                p('<div class="separator-vertical"/>').appendTo(this.$head);
            var n = p('<a class="data-config-btn"/>').append('<i class="icon-page-view">').append(p("<span />").text(i18next.t("field.show"))).appendTo(this.$head).click(function() {
                t.doShowFields(n)
            });
            n.toggleClass("active", !this._isAllFieldsShow()),
                this._setFilterSticky(this._isFilterSticky(), !0)
        },
        _isFilterSticky: function() {
            var t, e = this.options;
            return this.filterStickyKey || (t = {
                appId: e.appId,
                entryId: e.formId
            },
            FX.Utils.isNull(e.authGroupId) || (t.groupId = e.authGroupId),
            this.isBackUp && (t.ext = "dataRecycle"),
                this.filterStickyKey = FX.Store.getKey("filterSticky", t)),
                FX.Store.get(this.filterStickyKey)
        },
        _getFilterValue: function() {
            var t, e = this.options;
            this.filterValueKey || (t = {
                appId: e.appId,
                entryId: e.formId
            },
            FX.Utils.isNull(e.authGroupId) || (t.groupId = e.authGroupId),
            this.isBackUp && (t.ext = "dataRecycle"),
                this.filterValueKey = FX.Store.getKey("filterValue", t));
            var i = {
                cond: [],
                rel: FX.CONST.FILTER_RELATION.AND
            };
            return this.isBackUp && (i.cond.push({
                entryId: e.formId,
                field: "deleter",
                type: "user"
            }),
                i.cond.push({
                    entryId: e.formId,
                    field: "deleteTime",
                    type: "datetime"
                })),
            FX.Store.get(this.filterValueKey) || i
        },
        _setFilterSticky: function(t, e) {
            var i, a, n, s = this;
            this.options;
            this.filterPane && (this.filterPane.destroy(),
                this.filterPane = null,
            e && FX.Store.set(this.filterStickyKey, t)),
                t ? (this.element.addClass("has-sticky-filter"),
                (i = p(".filter-wrapper", this.element)).length || (i = p('<div class="filter-wrapper"/>').appendTo(this.element)),
                    this.filterPane = this._createFilterPane({
                        renderEl: i,
                        sticky: t,
                        onStopEdit: function(t) {
                            FX.Store.set(s.filterValueKey, t),
                                s.reload(FX.Utils.getValidFilters(t))
                        }
                    })) : (this.element.removeClass("has-sticky-filter"),
                (a = p(".filter-btn", this.$head)).length || (a = p('<a class="data-config-btn filter-btn"/>').append(p('<i class="icon-filter-o"/>')).append(p("<span />").text(i18next.t("filter.condition"))).appendTo(this.$head).on("click", function(t) {
                    s._showFieldFilter(p(t.currentTarget))
                })),
                    n = this._getFilterValue(),
                    FX.Utils.isObjectEmpty(FX.Utils.getValidFilters(n).cond) ? a.removeClass("active") : a.addClass("active")),
            this.$stickyHead && this.rebuildStickyHead()
        },
        _createFilterPane: function(t) {
            var e = this
                , i = this.options
                , a = this._getFilterValue()
                , n = p.extend({
                API: i.API,
                formId: i.formId,
                fields: a.cond,
                relation: a.rel,
                availableFields: i.availableParamFields,
                authGroupId: i.authGroupId,
                hasPinBtn: !0,
                colorEnable: i.colorEnable,
                onPin: function(t) {
                    e._setFilterSticky(t, !0)
                }
            }, t);
            return new FX.FilterWrapperPane(n)
        },
        _isAllFieldsShow: function() {
            var i = !0;
            return FX.Utils.forEach(this.fieldItems, function(t, e) {
                if (!e.selected)
                    return i = !1
            }),
                i
        },
        _showFieldFilter: function(i) {
            var a = this
                , t = this.options;
            this.filterPane ? this.filterPane.show() : this.filterPane = this._createFilterPane({
                anchor: i,
                sticky: !1,
                hasPinBtn: !this.element.hasClass(t.cls4FullScreen),
                onStopEdit: function(t) {
                    var e = FX.Utils.getValidFilters(t);
                    0 < e.cond.length ? i.addClass("active") : i.removeClass("active"),
                        FX.Store.set(a.filterValueKey, t),
                        a.reload(e)
                }
            })
        },
        deleteCheckResult: function(n, t, s) {
            var e, i, r = this, o = this.options;
            FX.Vip.hasDataBackup() ? e = n ? o.authGroupId === FX.CONST.DEFAULT_AUTH_GROUP ? i18next.t("dataTable.deleteAllTip.mergeAuth") : i18next.t("dataTable.deleteAllTip") : i18next.t("dataTable.deleteTip", {
                length: '<span class="text warning" >' + t + "</span>"
            }) : (e = n ? o.authGroupId === FX.CONST.DEFAULT_AUTH_GROUP ? i18next.t("dataTable.deleteAllTip.mergeAuth") : i18next.t("dataTable.deleteAllTipForFree") : i18next.t("dataTable.deleteTipForFree", {
                length: '<span class="text warning" >' + t + "</span>"
            }),
                i = p('<a target="jdy_doc"/>').text(i18next.t("dataTable.dataRecover")).attr("href", FX.CONFIG.HOST.HELP_DOC_HOST + "/9136")),
                FX.Msg.alert({
                    title: n ? i18next.t("dataTable.deleteAllDataTip") : i18next.t("dataTable.deleteAllSelectDataTip"),
                    msg: e,
                    tip: i,
                    type: "warning",
                    onOk: function() {
                        var t, e, i = {
                            formId: o.formId,
                            authGroupId: o.authGroupId
                        }, a = !0;
                        n ? (i.clearAll = !0,
                            i.filter = r.filter,
                        o.isAdmin || FX.Utils.dt(FX.CONST.TRACKER.DATA_DELETE_ALL)) : (t = r.getCheckResult()) && 0 < t.length ? i.idList = t : a = !1,
                        a && (e = function(t) {
                            !1 === FX.Utils.applyFunc(r, s, [t.count], !1) && (r.setHasCheck(!1),
                                r.createHeadTools(),
                                r.reload())
                        }
                            ,
                            FX.Socket.onBatchRemoveDataDone(e),
                            FX.Utils.dataAjax({
                                url: FX.Utils.getApi(o.API.data.remove),
                                data: i
                            }, function(t) {
                                t.hasAsyncTask || e(t)
                            }, function(t) {
                                var e = t.responseJSON || {};
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: FX.Utils.dealServerErrMsg(e)
                                })
                            }))
                    }
                })
        },
        _getShowFieldItems: function() {
            var t = this.options;
            return FX.Utils.getShowFieldItems(t.fields, t.showFields)
        },
        _createStickyHead: function() {
            var s = this
                , t = this.options;
            this.$stickyHead = p("<table />").addClass(t.tableClass + " x-table-bordered x-table-striped"),
                this.$stickyRowHead = p("<table />").addClass(t.tableClass + " x-table-bordered x-table-striped"),
                this.$stickyIntersect = p("<table />").addClass(t.tableClass + " x-table-bordered x-table-striped");
            var r = p('<thead class="t-head"/>').appendTo(s.$stickyHead)
                , o = p('<thead class="t-head"/>').appendTo(s.$stickyRowHead)
                , l = p('<thead class="t-head"/>').appendTo(s.$stickyIntersect);
            FX.Utils.forEach(this.tableHead, function(t, e) {
                var i = p('<tr class="t-row th-row"/>').appendTo(r)
                    , a = p('<tr class="t-row th-row"/>').appendTo(o)
                    , n = p('<tr class="t-row th-row"/>').appendTo(l);
                FX.Utils.forEach(e, function(t, e) {
                    s._createCell(e, {
                        tag: "th",
                        cls: "th-cell"
                    }).appendTo(i),
                    -1 < e.cls.indexOf("group-head") && (s._createCell(e, {
                        tag: "th",
                        cls: "th-cell"
                    }).appendTo(a),
                        s._createCell(e, {
                            tag: "th",
                            cls: "th-cell"
                        }).appendTo(n))
                })
            });
            var e = this._createColGroup(this._getColumns())
                , i = this._createColGroup(this._getStickyColumns())
                , c = p('<tbody class="t-body" />').appendTo(this.$stickyRowHead);
            FX.Utils.forEach(this.tableData, function(a) {
                var t = a % 2 == 0 ? "odd" : "even"
                    , n = p('<tr class="t-row tb-row" />').addClass(t).attr("data-idx", s.processor.getDataIdxByRow(a)).appendTo(c);
                FX.Utils.forEach(s.tableRowHead, function(t, e) {
                    var i = e[a];
                    i && s._createCell(i, {
                        tag: "td",
                        cls: "rh-cell"
                    }).appendTo(n)
                })
            }),
                this.$stickyHead.prepend(e).width(Math.max(this.tableWidth, this.$wrapper.width())),
                this.$stickyRowHead.prepend(i).width(i.data("totalWidth")),
                this.$stickyIntersect.prepend(i.clone()).width(i.data("totalWidth")),
                p('<div class="table-sticky-head"/>').width(this.$tableScroller[0].clientWidth).append(this.$stickyHead).appendTo(this.$wrapper),
                p('<div class="table-sticky-row-head"/>').height(this.$tableScroller[0].clientHeight).append(this.$stickyRowHead).appendTo(this.$wrapper),
                p('<div class="table-sticky-intersect"/>').append(this.$stickyIntersect).appendTo(this.$wrapper)
        },
        _scrollStickyHead: function() {
            var t = this.options
                , e = this.$tableScroller.scrollTop()
                , i = this.$tableScroller.scrollLeft();
            !1 === FX.Utils.applyFunc(this, t.onScroll, [i, e], !1) && (this.$stickyHead && this.$stickyHead.css({
                "margin-left": -i
            }),
            this.$stickyRowHead && this.$stickyRowHead.css({
                "margin-top": -e
            }))
        },
        _removeTable: function() {
            this.$wrapper.children().remove(),
            this.$menu && this.$menu.children().remove()
        },
        doFullScreen: function() {
            var t = this.options;
            if (this.element.hasClass(t.cls4FullScreen))
                return this.element.removeClass(t.cls4FullScreen),
                    this._setFilterSticky(this._isFilterSticky(), !1),
                    this.doResize({
                        width: FX.Utils.isEmpty(this.originStyle.w) ? "auto" : this.originStyle.w,
                        height: FX.Utils.isEmpty(this.originStyle.h) ? "auto" : this.originStyle.h
                    }),
                    !1;
            var e = this.element[0].style;
            return this.originStyle = {
                w: e.width,
                h: e.height
            },
                this.element.addClass(t.cls4FullScreen),
                this._setFilterSticky(!1, !1),
                this.doResize({
                    width: document.body.clientWidth,
                    height: document.body.clientHeight
                }),
                !0
        },
        setFields: function(t, e) {
            var i = this.options;
            i.fields = FX.Utils.getShowFieldsByNames(i.showFields, t);
            var a = FX.Utils.getFlatLengthByFields(i.fields) === FX.Utils.getFlatLengthByFields(i.showFields);
            e.toggleClass("active", !a);
            this._reloadWithoutCount(null, !0)
        },
        doShowFields: function(t) {
            var e = this.options
                , i = this;
            this.fieldCheck || (this.fieldItems = FX.Utils.addClsToSystemField(this.fieldItems, "field-system"),
                this.fieldCheck = new FX.ComboCheckBox({
                    renderEl: t,
                    items: this.fieldItems,
                    width: null,
                    height: null,
                    onStopEdit: function() {
                        i.setFields(this.getValue(), t)
                    },
                    onAfterTriggerHide: function() {
                        FX.Utils.applyFunc(i, e.onAfterShowFieldsSelected, [this.getValue()], !1)
                    },
                    onElementCreate: function() {
                        return !0
                    },
                    onAfterItemCreate: function(t, e, i) {
                        i.addClass(t.cls)
                    }
                }),
                this.fieldCheck._onTriggerClick())
        }
    })
}(jQuery),
FX.LangSwitchPane = FX.extend(FX.Widget, {
    _defaultConfig: function() {
        return $.extend(FX.LangSwitchPane.superclass._defaultConfig.apply(), {
            baseCls: "fx_lang_switch_pane",
            languages: {
                zh_cn: FX.CONST.LANG.CN,
                zh_tw: FX.CONST.LANG.TW,
                en_us: FX.CONST.LANG.EN
            },
            defaultLang: "zh_cn",
            mobileWidth: 768
        })
    },
    _init: function() {
        FX.LangSwitchPane.superclass._init.apply(this, arguments);
        var t = this.options;
        this.currentLang = FX.Cookie.get(FX.CONST.COOKIE.FX_LANG.KEY) || t.defaultLang,
            $('<i class="icon-cover-language"/><span class="lang-name">' + t.languages[this.currentLang] + '</span><i class="icon-angledown switch-btn"/>').appendTo(this.element),
            this._bindEvent()
    },
    _createLangItem: function(t, e, i) {
        return '<li class="lang-item ' + i + '" lang="' + t + '"><div class="lang-name">' + e + '</div><i class="icon-ok select-tick"/></li>'
    },
    _bindEvent: function() {
        var n = this
            , e = this.options;
        this.element.click(function() {
            var t, a = $('<ul class="fx_lang_switch_bubble"/>').on("click", ".lang-item", function(t) {
                var e = $(t.currentTarget).attr("lang");
                e !== FX.Cookie.get(FX.CONST.COOKIE.FX_LANG.KEY) && (FX.Cookie.set(FX.CONST.COOKIE.FX_LANG.KEY, e, {
                    expires: FX.CONST.COOKIE.FX_LANG.EXPIRES
                }),
                    window.location.reload())
            });
            FX.Utils.forEach(e.languages, function(t, e) {
                var i = t === n.currentLang ? "select" : "";
                a.append(n._createLangItem(t, e, i))
            }),
                window.innerWidth < e.mobileWidth ? t = $('<div class="fx_lang_switch_mask"/>').on("click", function() {
                    t.remove()
                }).append(a).appendTo("body") : new FX.Msg.bubble({
                    anchor: n.element.children(".switch-btn"),
                    contentHTML: a,
                    minWidth: 125,
                    hAdjust: 100,
                    contentPadding: 0,
                    text4Cancel: null,
                    text4Ok: null
                })
        })
    }
}),
FX.ExternalFormPane = FX.extend(FX.Widget, {
    _defaultConfig: function() {
        return $.extend(FX.ExternalFormPane.superclass._defaultConfig.apply(), {
            baseCls: "fx_external_form",
            form: {},
            theme: {},
            tabs: [],
            formEvents: [],
            hasLogo: !0,
            hasCustomTheme: !1,
            mode: "create",
            abuseReportUrl: "",
            defaultTheme: FX.THEME.DEFAULT_SYSTEM_THEME,
            token: "",
            hasLastContent: !1
        })
    },
    _init: function() {
        FX.ExternalFormPane.superclass._init.apply(this, arguments);
        var t = this.options;
        this.theme = t.theme || {},
            this.form = t.form || {},
            this.$content = $('<div class="form-content"/>').appendTo(this.element),
            this._renderFormContent(),
            this._renderLogo(),
            this._renderQRCode()
    },
    _renderFormContent: function() {
        this._renderHead(),
            this._renderBody(),
        this.form && this.form.wx_enhance_enable || (this._renderFoot(),
            this.setTheme(this.theme))
    },
    _renderHead: function() {
        this.$head = $('<div class="form-head"><div class="head-banner"></div><div class="head-title">' + this.form.title + "</div></div>").appendTo(this.$content),
            $("<div/>")
    },
    _renderBody: function() {
        var t = this.options
            , e = $('<div class="form-body"/>').appendTo(this.$content);
        t.content ? e.append(t.content) : this.formWidget = this._renderForm(e)
    },
    _renderForm: function(i) {
        if (this.options.form && this.options.form.wx_enhance_enable)
            return i.addClass("wx-enhance__body"),
                void FX.Utils.createQrcode(window.location.href, 148, 148, function(t) {
                    var e = $('<div class="qr-container"/>').appendTo(i);
                    $('<i class="icon-wechat"></i><div class="desc">' + i18next.t("wechat.enhance.scan.fill") + "</div>").appendTo(e),
                        $('<img class="wx-enhance-qrcode" />').attr("src", t).appendTo(e)
                });
        var t = this.options
            , a = this
            , n = FX.Utils.getSubmitFormDataKey(t.form.appId, t.form.entryId)
            , e = FX.Utils.getSaveContentCheckKey(t.form.appId, t.form.entryId);
        return new FX.Form($.extend({
            renderEl: $("<div/>").appendTo(i),
            hasFooter: !1,
            hasHeader: !1,
            multiTabs: t.tabs,
            formEvents: t.formEvents,
            copyValue: FX.Utils.getCopyValue(t.hasLastContent, n, e),
            hasLastContent: t.hasLastContent,
            multiTabScrollElement: a.element,
            onGetScrollContainer: function() {
                return a.element
            },
            onSuccess: function(t) {
                var e = a.$content.empty();
                t.flowFailureCode ? a._showFlowFailInfo(e.addClass("flow-fail"), t.flowFailureCode) : (FX.Utils.dealSubmitFormData(a.hasContentCheck, n, t.data),
                    a._showSuccessInfo(e.addClass("form-success"), t, function() {
                        a.$content.removeClass("form-success").empty(),
                            a._renderFormContent()
                    }))
            }
        }, this.form))
    },
    _renderFoot: function() {
        var e, t, i, a = this, n = this.options, s = FX.Vip.isDataCreateLimit(), r = "foot-btn";
        s && (r += " disable"),
            this.$foot = $('<div class="form-foot"><div class="' + r + '">' + n.form.submitText + "</div></div>").appendTo(this.$content),
        "create" !== n.mode || s || this.$foot.children(".foot-btn").on("click", function() {
            a.formWidget && a.formWidget.doVerifyAndSubmit()
        }),
        "create" === n.mode && n.hasLastContent && (e = FX.Utils.getSaveContentCheckKey(n.form.appId, n.form.entryId),
            this.$foot.addClass("has-save-content"),
            t = void 0 === FX.Store.get(e) || FX.Store.get(e),
            i = new FX.CheckBox({
                renderEl: $('<div class="last-content-check"/>').appendTo(this.$foot),
                text: i18next.t("form.submit.lastContent"),
                value: t,
                onStateChange: function() {
                    var t = this.getValue();
                    a.hasContentCheck = t,
                        FX.Store.set(e, t)
                }
            }),
            a.hasContentCheck = i.getValue())
    },
    _renderLogo: function() {
        var t = this.options
            , e = FX.CONFIG.HOST.SITE_SHORT_HOST + "/register_guide?utm_src=wailian";
        t.hasLogo && FX.STATIC.FTOKEN && this.element.append('<div class="x-public-thumbnail"><img src="' + FX.Utils.getAssetUrl("/resources/images/form_thumbnail.png") + '"/></div><div class="x-public-logo"><a>' + i18next.t("external.link.tip") + '</a><a class="abuse-report" ' + (t.abuseReportUrl ? 'href="' + t.abuseReportUrl + '" ' : "") + '" target="_blank">' + i18next.t("abuseReport") + '</a><a class="right" href=' + e + '><div class="text">Powered by</div><div class="text"><i class="icon-jdy"/></div></a></div></div>')
    },
    _showSuccessInfo: function(t, e, i) {
        var a, n = this;
        e && e.data && (a = e.data.submitPrompt);
        var s, r = $('<div class="success-pane"/>').appendTo(t);
        a && "custom" === a.mode ? r.addClass("custom-pane x-subhtml").html(a.content) : ($("<div/>").append($('<i class="data-create-success-icon"/>')).appendTo(r),
            $('<div class="msg-title"/>').text(i18next.t("submit.success")).appendTo(r)),
        e.check_code && new FX.Tip({
            msg: FX.Utils.getErrMsg({
                code: e.check_code
            }),
            msgType: "warning",
            height: 45,
            renderEl: $("<div/>").prependTo("body"),
            customCls: "data-limit-tip"
        }),
        i && (!a || a && ("custom" === a.mode && a.hasAddBtn || "system" === a.mode)) && (s = $('<div class="button-pane"/>').appendTo(r),
            new FX.Button({
                renderEl: $("<div />").appendTo(s),
                text: i18next.t("form.submit.continue"),
                width: 160,
                style: "green",
                onClick: function() {
                    FX.Utils.applyFunc(n, i, [], !1)
                }
            }))
    },
    _renderQRCode: function() {
        var e, i, a = this, t = this.options;
        FX.Utils.isEmpty(t.token) || (e = $('<div class="external-qrcode"><i class="icon-qrcode"/></div>').appendTo(this.element),
            FX.Utils.createQrcode(window.location.href, 148, 148, function(t) {
                i = t
            }),
            e.click(function() {
                var t = $('<div class="qrcode-dropdown"/>');
                $("<img/>").attr("src", i).appendTo(t),
                    $("<div/>").text(i18next.t("external.link.scan")).appendTo(t),
                    FX.Msg.bubble({
                        anchor: e,
                        dockPosition: "right",
                        text4Ok: null,
                        minWidth: 150,
                        text4Cancel: null,
                        contentHTML: t,
                        scrollObj: a.element,
                        hAdjust: 15
                    })
            }),
            this.$qrcode = e)
    },
    _showFlowFailInfo: function(t, e) {
        var i = i18next.t("flow.fail.hint.reason")
            , a = FX.CONST.FLOW_FAIL_CODE;
        e === a.FORWARD_CHARGER ? i += i18next.t("flow.fail.hint.charger") : e === a.FORWARD_COND && (i += i18next.t("flow.fail.hint.cond")),
            $('<div class="fail-content"><div class="fail-icon"><i class="icon-sad-face"/></div><div class="fail-title">' + i18next.t("flow.fail.hint.title") + '</div><div class="fail-detail">' + i + '</div><div class="fail-detail">' + i18next.t("flow.fail.hint.detail") + "</div></div>").appendTo(t)
    },
    setTheme: function(t) {
        var e = this.options
            , i = {};
        "system" === t.mode && t.system && (i = FX.THEME.EXTERNAL_FORM_THEME[t.system]),
        e.hasCustomTheme && "custom" === t.mode && t.custom && $.extend(i, t.custom),
        FX.Utils.isObjectEmpty(i) && (i = FX.THEME.EXTERNAL_FORM_THEME[e.defaultTheme]);
        var a = i.background;
        if (a)
            switch (a.mode) {
                case "color":
                    this.element.css({
                        "background-color": a.color,
                        "background-image": "none"
                    });
                    var n = FX.Utils.hexToRgbJson(a.color)
                        , s = FX.Utils.isDarkColor(n.r, n.g, n.b);
                    this.$qrcode && this.$qrcode.css({
                        "background-color": s ? "rgba(255, 255, 255, 0.5)" : "rgba(0, 0, 0, 0.1)"
                    }),
                    e.hasLogo && s && $(".x-public-logo", this.element).addClass("dark-mode");
                    break;
                case "image":
                    this.element.css({
                        "background-color": a.image ? "transparent" : "",
                        "background-image": a.image ? "url(" + a.image + ")" : ""
                    })
            }
        var r = i.banner;
        if (r) {
            var o = this.$head.children(".head-banner").empty();
            switch (r.mode) {
                case "color":
                    o.css({
                        "background-color": r.color
                    });
                    break;
                case "image":
                    o.css({
                        "background-color": r.image ? "transparent" : ""
                    }),
                    r.image && o.append('<img src="' + r.image + '"/>')
            }
        }
        var l, c = i.title;
        c && (l = FX.THEME.DEFAULT_FORM_THEME.title,
            this.$head.children(".head-title").css({
                color: c.color,
                "font-size": c["font-size"] || l["font-size"],
                "text-align": c["text-align"] || l["text-align"],
                "text-decoration": c["text-decoration"] ? c["text-decoration"].join("") : "",
                "font-style": c["font-style"] || l["font-style"],
                "font-weight": c["font-weight"] || l["font-weight"]
            }));
        var d = i.submit_btn;
        d && !FX.Vip.isDataCreateLimit() && (this.$foot.children(".foot-btn").css({
            "background-color": d["background-color"]
        }),
        this.formWidget && this.formWidget.setMultiTabColor(d["background-color"]))
    }
}),
function(o) {
    FX.SwitchCorp = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.SwitchCorp.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_switch_corp_pane",
                corps: [],
                allowCreateCorp: !0,
                onAfterCreateCorp: null,
                onAfterSwitchCorp: null,
                onCreateCorpMenu: null
            })
        },
        _init: function() {
            FX.SwitchCorp.superclass._init.apply(this, arguments);
            var e = this.options
                , i = this
                , a = {}
                , n = null
                , s = [];
            FX.Utils.forEach(e.corps, function(t, e) {
                a[e.id] = e.name,
                    e.id === FX.CorpUser.getUserCorpId() ? n = e : s.push(e)
            });
            var r = o('<div class="team-switch"/>').append(o('<div class="corp-name"/>').text(a[FX.CorpUser.getCurrentCorpId()])).appendTo(this.element);
            this._hasDropdown() && (r.addClass("has-dropdown").append(o('<i class="right icon-caret-down"/>')),
                r.click(function() {
                    if (!i.isEnabled())
                        return !1;
                    var t = o('<div class="corp-dropdown"/>');
                    !1 === FX.Utils.applyFunc(i, e.onCreateCorpMenu, [t, a, n, s], !1) && t.append(i._createCorpMenu(n, s)),
                        i.bubble = FX.Msg.bubble({
                            anchor: r,
                            text4Ok: null,
                            text4Cancel: null,
                            minWidth: 230,
                            contentHTML: t,
                            hAdjust: 108,
                            contentPadding: 0,
                            hasTriangle: !1
                        })
                }))
        },
        _hasCreateCorp: function() {
            var t = this.options;
            return !FX.CorpUser.getUserCorpId() && !FX.CorpUser.isSyncMember() && t.allowCreateCorp
        },
        _hasDropdown: function() {
            var t = this.options;
            return 1 < t.corps.length || this._hasCreateCorp() || 1 === t.corps.length && t.corps[0] !== FX.CorpUser.getCurrentCorpId()
        },
        _createCorpMenu: function(t, e) {
            var a = this
                , n = this.options
                , i = o('<ul class="switch-corp-menu-pane"/>');
            return t && (o('<li class="menu-desc"/>').text(i18next.t("corp.owned")).appendTo(i),
                this._createCorpMenuItem(t, !0).appendTo(i)),
            0 < e.length && (o('<li class="menu-desc"/>').text(i18next.t("corp.joined")).appendTo(i),
                FX.Utils.forEach(e, function(t, e) {
                    a._createCorpMenuItem(e).appendTo(i)
                })),
            this._hasCreateCorp() && i.append(o('<li class="split-line"/><li class="menu-item menu-corp menu-add" id="new"><i class="icon-add"/><span>' + i18next.t("corp.create") + "</span></li>")),
                i.on("click", function(t) {
                    var e = o(t.target).closest(".menu-item")
                        , i = e.attr("id");
                    e.length <= 0 || !i || e.hasClass("select") || ("new" === i ? FX.CorpUser.createCorp(function() {
                        FX.Utils.applyFunc(a, n.onAfterCreateCorp, [], !1)
                    }) : (FX.CorpUser.switchCorp(i, function() {
                        FX.Utils.applyFunc(a, n.onAfterSwitchCorp, [], !1)
                    }),
                    a.bubble && a.bubble.close()))
                }),
                i
        },
        _createCorpMenuItem: function(t, e) {
            var i = o('<li class="menu-item menu-corp" />').append(o('<div class="corp-name"/>').text(t.name)).append(o('<i class="icon-ok select-tick"/>')).attr("id", t.id);
            return e ? i.prepend(o('<i class="icon-widget-usergroup corp-own"/>')) : i.prepend(o('<i class="icon-widget-user corp-part"/>')),
            t.id === FX.CorpUser.getCurrentCorpId() && i.addClass("select"),
                i
        }
    })
}(jQuery),
function(t) {
    FX.DepartmentsTree = FX.extend(FX.Tree, {
        _init: function() {
            this.options.Nodes.sort(function(t, e) {
                return t.order - e.order
            }),
                FX.Tree.superclass._init.apply(this, arguments)
        }
    }),
        t.shortcut("departmentstree", FX.DepartmentsTree)
}(jQuery),
function(s) {
    FX.Tooltip = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return s.extend(FX.Tooltip.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_tooltip_pane",
                style: "info",
                text: "",
                content: "",
                tipWidth: 200,
                animation: !0,
                mouseDelay: 200,
                hasIcon: !0,
                onPopContentCreate: null,
                onPopMouseenter: null,
                onPopMouseleave: null
            })
        },
        _init: function() {
            FX.Tooltip.superclass._init.apply(this, arguments);
            var e = this.options
                , i = this
                , t = "icon-help";
            switch (e.style) {
                case "info":
                    t = "icon-help";
                    break;
                case "warning":
                    t = "icon-warning-circle warning";
                    break;
                case "error":
                    t = "icon-warning-circle error";
                    break;
                case "tip":
                    t = "icon-warning-circle"
            }
            this.element.addClass(e.style);
            var a = this.element
                , n = e.anchor;
            e.hasIcon && (a = s('<i class="tip-icon ' + t + '"/>').appendTo(this.element),
                n = a),
                a.hover(function() {
                    var t;
                    i.shouldClose = !1,
                    i.$popover || (t = s('<div class="fx_tooltip_popover"/>'),
                    e.text && s("<span/>").text(e.text).appendTo(t),
                    e.content && e.content.appendTo(t),
                        FX.Utils.applyFunc(i, e.onPopContentCreate, [t], !1),
                        i.$popover = FX.UI.showPopover({
                            position: e.position,
                            anchor: n,
                            maxWidth: e.tipWidth,
                            animation: e.animation,
                            content: t,
                            customCls: e.popCustomCls
                        }),
                        i.$popover.hover(function() {
                            i.shouldClose = !1,
                                FX.Utils.applyFunc(i, e.onPopMouseenter, [], !1)
                        }, function() {
                            i._closePopover(),
                                FX.Utils.applyFunc(i, e.onPopMouseleave, [], !1)
                        }))
                }, function() {
                    i._closePopover()
                }),
            e.height && this.element.css("line-height", e.height + "px")
        },
        _closePopover: function() {
            var t = this
                , e = this.options;
            this.shouldClose = !0,
            this.timeInterval && clearTimeout(this.timeInterval),
                this.timeInterval = setTimeout(function() {
                    t.shouldClose && t.$popover && (t.$popover.remove(),
                        t.$popover = null)
                }, e.mouseDelay)
        }
    }),
        s.shortcut("tooltippane", FX.Tooltip)
}(jQuery),
function(l) {
    FX.AppEntrySelector = FX.extend(FX.Trigger, {
        _defaultConfig: function() {
            return l.extend(FX.AppEntrySelector.superclass._defaultConfig.apply(), {
                baseCls: "fx_appentryselector",
                triggerIcon: "icon-caret-down",
                triggerList: "entryselector-list",
                customTriggerCls: "",
                items: null,
                allowBlank: !0,
                searchable: !0,
                onAfterNodeClick: null,
                placeholder: ""
            })
        },
        _init: function() {
            FX.AppEntrySelector.superclass._init.apply(this, arguments),
                this.value = {},
                this.text = ""
        },
        _createEditComp: function() {
            var t = this.options
                , e = l('<div class="trigger-wrapper"/>');
            return l('<input class="trigger-input" placeholder="' + t.placeholder + '" readonly="readonly"/>').appendTo(e),
                e.appendTo(this.element)
        },
        _onTriggerClick: function(t) {
            var i;
            this.isEnabled() && ((i = this)._showTriggerView(),
                l(document).bind("mousedown.treeview", function(t) {
                    var e = t.target;
                    0 === l(e).closest(i.triggerView).length && i._hideTriggerView()
                }))
        },
        _createTreeView: function() {
            var e = this.options
                , a = this;
            this.triggerView = l('<div class="x-dropdown fx_appentryselector_trigger"/>'),
            e.customTriggerCls && this.triggerView.addClass(e.customTriggerCls),
            e.searchable && new FX.SearchInput({
                renderEl: l('<div class="app-search"/>').appendTo(this.triggerView),
                async: {
                    url: FX.Utils.getApi(FX.API.app.search),
                    data: {
                        corpId: FX.CorpUser.getCurrentCorpId(),
                        entryType: ["form", "dash", "report"]
                    }
                },
                onAsyncSuccess: function(t) {
                    var i = [];
                    FX.Utils.forEach(t.list, function(t, e) {
                        "report" !== e.type && i.push(e)
                    }),
                        this.items = i,
                        l(".entryselector-list", a.triggerView).hide()
                },
                onAfterItemCreate: function(t, e) {
                    "app" === t.type ? new FX.AppIcon({
                        renderEl: l("<div/>").prependTo(e),
                        customCls: "entry-icon",
                        app: t,
                        size: "small"
                    }) : l('<i class="entry-icon"/>').addClass(FX.Utils.getIconByEntry(t)).prependTo(e)
                },
                onEmptyInput: function() {
                    l(".entryselector-list", a.triggerView).show()
                },
                onItemClick: function(t) {
                    "app" === t.type && (t.appId = t._id),
                        a._setValue(t),
                        FX.Utils.applyFunc(a, e.onAfterNodeClick, [a.value], !1),
                        a._hideTriggerView()
                },
                onSearch: function() {
                    l(".entryselector-list", a.triggerView).hide()
                }
            }),
                this.treeView = l('<div class="x-dropdown-list"/>').addClass(e.triggerList).appendTo(this.triggerView),
                this._createTreeList(e.items)
        },
        _createTreeList: function(t) {
            var s = this.options
                , r = this
                , o = l('<div class="tree-wrapper"/>').appendTo(this.treeView);
            FX.Utils.forEach(t, function(t, i) {
                var e = l('<div class="tree-item"/>').click(function() {
                    i.appId = i._id,
                        r._setValue(i),
                        FX.Utils.applyFunc(r, s.onAfterNodeClick, [r.value], !1),
                        r._hideTriggerView()
                }).append(l('<div class="item-name"/>').text(i.name)).appendTo(o)
                    , a = (new FX.AppIcon({
                    renderEl: l('<div class="item-icon"/>').prependTo(e),
                    app: i,
                    size: "middle",
                    id: i._id + "_cusIcon"
                }),
                    l('<div class="child-wrapper"/>'))
                    , n = l('<div class="item-switch"><i class="icon-caret-right"/></div>').click(function(t) {
                    t.stopPropagation(),
                        n.hasClass("expanded") ? (n.empty(),
                            n.append('<i class="icon-caret-right"/>'),
                            a.hide(),
                            n.removeClass("expanded")) : (n.empty(),
                            n.append('<i class="icon-caret-down"/>'),
                            n.hasClass("loaded") ? a.show() : s.onTreeSwitchClick(i, function(t) {
                                t && 0 < t.length && (e.after(a),
                                    FX.Utils.forEach(t, function(t, e) {
                                        l('<div class="tree-item child-item"><div class="item-icon"><i class="' + FX.Utils.getIconByEntry(e) + '"/></div></div>').click(function() {
                                            e.appId = i._id,
                                                r._setValue(e),
                                                FX.Utils.applyFunc(r, s.onAfterNodeClick, [r.value], !1),
                                                r._hideTriggerView()
                                        }).append(l('<div class="item-name"/>').text(e.name)).appendTo(a)
                                    })),
                                n.hasClass("loaded") || n.addClass("loaded")
                            }),
                            n.addClass("expanded"))
                }).prependTo(e)
            })
        },
        _setValue: function(t) {
            t && (this.value = t,
                this.text = t.name,
                this.editComp.text(t.name))
        },
        _hideTriggerView: function() {
            this.triggerView && (l(document).unbind("mousedown.treeview"),
                this.triggerView.detach())
        },
        _showTriggerView: function() {
            this.options;
            null == this.triggerView && this._createTreeView(),
                this.triggerView.appendTo("body").css(this._calTriggerViewPos()).show(),
            this.options.searchable && this.triggerView.find("input").focus()
        },
        checkValidate: function() {
            return !(!this.options.allowBlank && FX.Utils.isObjectEmpty(this.getValue()))
        },
        getValue: function() {
            return this.value
        },
        getText: function() {
            return this.text
        }
    })
}(jQuery),
function(r) {
    FX.WeChatContactsAuthDialog = FX.extend(FX.ConfirmDialog, {
        _defaultConfig: function() {
            return r.extend(FX.WeChatContactsAuthDialog.superclass._defaultConfig.apply(this, arguments), {
                customCls: "fx_wechat_auth_dialog",
                title: i18next.t("weChat.contacts.auth.title"),
                hasSeparator: !0,
                width: 526,
                onSuccess: null
            })
        },
        _createContent: function(t) {
            var e = FX.CONFIG.HOST.HELP_DOC_HOST + "/11978"
                , i = r('<div><div class="auth-description">' + i18next.t("weChat.contacts.auth.description") + '<a class="help-doc-btn" href="' + e + '" target="_blank">' + i18next.t("nav.doc") + "</a></div></div></div>").appendTo(t);
            this.agentIdInput = this._createInputEditor(i, "agent_id", i18next.t("weChat.contacts.agentId.notEmpty")),
                this.agentSecretInput = this._createInputEditor(i, "agent_secret", i18next.t("weChat.contacts.agentSecret.notEmpty"))
        },
        _createInputEditor: function(t, e, i) {
            var a = r('<div class="auth-input-editor"/>').appendTo(t);
            r('<div class="input-label"/>').text(e).appendTo(a);
            var n = new FX.TextEditor({
                renderEl: r("<div/>").appendTo(a),
                width: "100%",
                allowBlank: !1,
                onAfterValidate: function(t, e) {
                    e ? s.hide() : s.show()
                }
            })
                , s = r('<div class="error-tip"/>').text(i).appendTo(a).hide();
            return n
        },
        _handleOk: function() {
            var t = this
                , e = this.options
                , i = this.agentIdInput.checkValidate()
                , a = this.agentSecretInput.checkValidate();
            i && a && FX.Utils.ajax({
                url: FX.Utils.getApi(FX.API.profile.update_corp),
                data: {
                    cp_auth: {
                        agent_id: this.agentIdInput.getValue(),
                        corp_secret: this.agentSecretInput.getValue()
                    }
                }
            }, function() {
                FX.Msg.toast({
                    type: "success",
                    msg: i18next.t("weChat.contacts.auth.success")
                }),
                    t.close(),
                    FX.Utils.applyFunc(t, e.onSuccess, [], !1)
            }, function(t) {
                var e = t.responseJSON || {}
                    , i = i18next.t("weChat.contacts.auth.fail");
                8230 === e.code && (i = i18next.t("weChat.contacts.auth.repeat")),
                    FX.Msg.toast({
                        type: "warning",
                        msg: i
                    })
            })
        }
    })
}(jQuery),
function(t) {
    FX.WxEnhancePane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return t.extend(FX.WxEnhancePane.superclass._defaultConfig.apply(), {
                baseCls: "fx_wx_enhance_panel",
                wx_enhance_enable: !1,
                wx_enhance_lvl: 1
            })
        },
        _init: function() {
            FX.WxEnhancePane.superclass._init.apply(this, arguments),
                this._initContent()
        },
        _initContent: function() {
            var i = this.options
                , a = this;
            this.element.append(t('<span class="enhance-title"/>').text(i18next.t("wechat.enhance.title"))).append(t('<span class="enhance-desc"/>').text(i18next.t("wechat.enhance.desc"))),
                new FX.Switch({
                    renderEl: t('<div class="switch"/>').appendTo(this.element),
                    width: 44,
                    height: 22,
                    value: !!i.wx_enhance_enable,
                    onSwitch: function(t) {
                        t && FX.Utils.dt(FX.CONST.TRACKER.WECHAT_ENHANCE),
                            e[t ? "slideDown" : "slideUp"]("fast"),
                            FX.Utils.applyFunc(a, i.onSwitch, [t], !1)
                    }
                });
            var e = t('<div class="content"/>').appendTo(this.element);
            i.wx_enhance_enable || e.hide(),
                e.append(t('<div class="enhance-desc"/>').text(i18next.t("wechat.enhance.getEditorInfo"))),
                new FX.RadioGroup({
                    renderEl: t('<div class="format-btn"/>').appendTo(e),
                    items: [{
                        value: FX.CONST.WX_ENHANCE_LEVEL.SILENCE,
                        text: i18next.t("wechat.enhance.get.automatic")
                    }, {
                        value: FX.CONST.WX_ENHANCE_LEVEL.POPUPS,
                        text: i18next.t("wechat.enhance.get.fromDialog")
                    }],
                    value: i.wx_enhance_lvl || FX.CONST.WX_ENHANCE_LEVEL.SILENCE,
                    allowDeselect: !1,
                    onAfterItemSelect: function(t, e) {
                        FX.Utils.applyFunc(a, i.onAfterItemSelect, [e], !1)
                    },
                    onItemCreate: function(t, e) {
                        new FX.Tooltip({
                            renderEl: e,
                            text: i18next.t(t.value === FX.CONST.WX_ENHANCE_LEVEL.SILENCE ? "wechat.enhance.get.automatic.tooltip" : "wechat.enhance.get.fromDialog.tooltip"),
                            style: "info",
                            tipWidth: 250
                        })
                    }
                }),
                e.append(t('<div class="enhance-desc"/>').text(i18next.t("wechat.enhance.notice")))
        }
    }),
        t.shortcut("wxenhancepane", FX.WxEnhancePane)
}(jQuery),
function() {
    this.CodeMirror = function() {
        "use strict";
        var p = /gecko\/\d/i.test(navigator.userAgent)
            , t = /MSIE \d/.test(navigator.userAgent)
            , e = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent)
            , y = t || e
            , b = y && (t ? document.documentMode || 6 : e[1])
            , f = /WebKit\//.test(navigator.userAgent)
            , i = f && /Qt\/\d+\.\d+/.test(navigator.userAgent)
            , a = /Chrome\//.test(navigator.userAgent)
            , m = /Opera\//.test(navigator.userAgent)
            , n = /Apple Computer/.test(navigator.vendor)
            , s = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent)
            , r = /PhantomJS/.test(navigator.userAgent)
            , o = /AppleWebKit/.test(navigator.userAgent) && /Mobile\/\w+/.test(navigator.userAgent)
            , l = o || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent)
            , g = o || /Mac/.test(navigator.platform)
            , c = /win/i.test(navigator.platform)
            , d = m && navigator.userAgent.match(/Version\/(\d*\.\d*)/);
        if (d)
            d = Number(d[1]);
        if (d && d >= 15) {
            m = false;
            f = true
        }
        var u = g && (i || m && (d == null || d < 12.11))
            , _ = p || y && b >= 9
            , h = false
            , v = false;
        function F(t, e) {
            if (!(this instanceof F))
                return new F(t,e);
            this.options = e = e ? sr(e) : {};
            sr(xa, e, false);
            O(e);
            F.keywords = e.keywords || [];
            var i = e.value;
            if (typeof i == "string")
                i = new Zn(i,e.mode);
            this.doc = i;
            var a = new F.inputStyles[e.inputStyle](this);
            var n = this.display = new T(t,i,a);
            n.wrapper.CodeMirror = this;
            k(this);
            I(this);
            if (e.lineWrapping)
                this.display.wrapper.className += " CodeMirror-wrap";
            if (e.autofocus && !l)
                n.input.focus();
            P(this);
            this.state = {
                keyMaps: [],
                overlays: [],
                modeGen: 0,
                overwrite: false,
                delayingBlurEvent: false,
                focused: false,
                suppressEdits: false,
                pasteIncoming: false,
                cutIncoming: false,
                draggingText: false,
                highlight: new Ys,
                keySeq: null,
                specialChars: null
            };
            var s = this;
            if (y && b < 11)
                setTimeout(function() {
                    s.display.input.reset(true)
                }, 20);
            _i(this);
            wr();
            Ke(this);
            this.curOp.forceUpdate = true;
            as(this, i);
            if (e.autofocus && !l || s.hasFocus())
                setTimeout(rr(Ki, this), 20);
            else
                Qi(this);
            for (var r in wa)
                if (wa.hasOwnProperty(r))
                    wa[r](this, e[r], Xa);
            W(this);
            if (e.finishInit)
                e.finishInit(this);
            for (var o = 0; o < Ua.length; ++o)
                Ua[o](this);
            qe(this);
            if (f && e.lineWrapping && getComputedStyle(n.lineDiv).textRendering == "optimizelegibility")
                n.lineDiv.style.textRendering = "auto"
        }
        function T(t, e, i) {
            var a = this;
            this.input = i;
            a.scrollbarFiller = fr("div", null, "CodeMirror-scrollbar-filler");
            a.scrollbarFiller.setAttribute("cm-not-content", "true");
            a.gutterFiller = fr("div", null, "CodeMirror-gutter-filler");
            a.gutterFiller.setAttribute("cm-not-content", "true");
            a.lineDiv = fr("div", null, "CodeMirror-code");
            a.selectionDiv = fr("div", null, null, "position: relative; z-index: 1");
            a.cursorDiv = fr("div", null, "CodeMirror-cursors");
            a.measure = fr("div", null, "CodeMirror-measure");
            a.lineMeasure = fr("div", null, "CodeMirror-measure");
            a.lineSpace = fr("div", [a.measure, a.lineMeasure, a.selectionDiv, a.cursorDiv, a.lineDiv], null, "position: relative; outline: none");
            a.mover = fr("div", [fr("div", [a.lineSpace], "CodeMirror-lines")], null, "position: relative");
            a.sizer = fr("div", [a.mover], "CodeMirror-sizer");
            a.sizerWidth = null;
            a.heightForcer = fr("div", null, null, "position: absolute; height: " + Ws + "px; width: 1px;");
            a.gutters = fr("div", null, "CodeMirror-gutters");
            a.lineGutter = null;
            a.scroller = fr("div", [a.sizer, a.heightForcer, a.gutters], "CodeMirror-scroll");
            a.scroller.setAttribute("tabIndex", "-1");
            a.wrapper = fr("div", [a.scrollbarFiller, a.gutterFiller, a.scroller], "CodeMirror");
            if (y && b < 8) {
                a.gutters.style.zIndex = -1;
                a.scroller.style.paddingRight = 0
            }
            if (!f && !(p && l))
                a.scroller.draggable = true;
            if (t) {
                if (t.appendChild)
                    t.appendChild(a.wrapper);
                else
                    t(a.wrapper)
            }
            a.viewFrom = a.viewTo = e.first;
            a.reportedViewFrom = a.reportedViewTo = e.first;
            a.view = [];
            a.renderedView = null;
            a.externalMeasured = null;
            a.viewOffset = 0;
            a.lastWrapHeight = a.lastWrapWidth = 0;
            a.updateLineNumbers = null;
            a.nativeBarWidth = a.barHeight = a.barWidth = 0;
            a.scrollbarsClipped = false;
            a.lineNumWidth = a.lineNumInnerWidth = a.lineNumChars = null;
            a.alignWidgets = false;
            a.cachedCharWidth = a.cachedTextHeight = a.cachedPaddingH = null;
            a.maxLine = null;
            a.maxLineLength = 0;
            a.maxLineChanged = false;
            a.wheelDX = a.wheelDY = a.wheelStartX = a.wheelStartY = null;
            a.shift = false;
            a.selForContextMenu = null;
            a.activeTouch = null;
            i.init(a)
        }
        function C(t) {
            t.doc.mode = F.getMode(t.options, t.doc.modeOption);
            x(t)
        }
        function x(t) {
            t.doc.iter(function(t) {
                if (t.stateAfter)
                    t.stateAfter = null;
                if (t.styles)
                    t.styles = null
            });
            t.doc.frontier = t.doc.first;
            le(t, 100);
            t.state.modeGen++;
            if (t.curOp)
                di(t)
        }
        function w(t) {
            if (t.options.lineWrapping) {
                br(t.display.wrapper, "CodeMirror-wrap");
                t.display.sizer.style.minWidth = "";
                t.display.sizerWidth = null
            } else {
                yr(t.display.wrapper, "CodeMirror-wrap");
                A(t)
            }
            X(t);
            di(t);
            De(t);
            setTimeout(function() {
                R(t)
            }, 100)
        }
        function E(a) {
            var n = We(a.display)
                , s = a.options.lineWrapping;
            var r = s && Math.max(5, a.display.scroller.clientWidth / Be(a.display) - 3);
            return function(t) {
                if (bn(a.doc, t))
                    return 0;
                var e = 0;
                if (t.widgets)
                    for (var i = 0; i < t.widgets.length; i++) {
                        if (t.widgets[i].height)
                            e += t.widgets[i].height
                    }
                if (s)
                    return e + (Math.ceil(t.text.length / r) || 1) * n;
                else
                    return e + n
            }
        }
        function X(t) {
            var e = t.doc
                , i = E(t);
            e.iter(function(t) {
                var e = i(t);
                if (e != t.height)
                    os(t, e)
            })
        }
        function I(t) {
            t.display.wrapper.className = t.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + t.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
            De(t)
        }
        function S(t) {
            k(t);
            di(t);
            setTimeout(function() {
                H(t)
            }, 20)
        }
        function k(t) {
            var e = t.display.gutters
                , i = t.options.gutters;
            mr(e);
            for (var a = 0; a < i.length; ++a) {
                var n = i[a];
                var s = e.appendChild(fr("div", null, "CodeMirror-gutter " + n));
                if (n == "CodeMirror-linenumbers") {
                    t.display.lineGutter = s;
                    s.style.width = (t.display.lineNumWidth || 1) + "px"
                }
            }
            e.style.display = a ? "" : "none";
            U(t)
        }
        function U(t) {
            var e = t.display.gutters.offsetWidth;
            t.display.sizer.style.marginLeft = e + "px"
        }
        function D(t) {
            if (t.height == 0)
                return 0;
            var e = t.text.length, i, a = t;
            while (i = fn(a)) {
                var n = i.find(0, true);
                a = n.from.line;
                e += n.from.ch - n.to.ch
            }
            a = t;
            while (i = mn(a)) {
                var n = i.find(0, true);
                e -= a.text.length - n.from.ch;
                a = n.to.line;
                e += a.text.length - n.to.ch
            }
            return e
        }
        function A(t) {
            var i = t.display
                , e = t.doc;
            i.maxLine = ns(e, e.first);
            i.maxLineLength = D(i.maxLine);
            i.maxLineChanged = true;
            e.iter(function(t) {
                var e = D(t);
                if (e > i.maxLineLength) {
                    i.maxLineLength = e;
                    i.maxLine = t
                }
            })
        }
        function O(t) {
            var e = er(t.gutters, "CodeMirror-linenumbers");
            if (e == -1 && t.lineNumbers) {
                t.gutters = t.gutters.concat(["CodeMirror-linenumbers"])
            } else if (e > -1 && !t.lineNumbers) {
                t.gutters = t.gutters.slice(0);
                t.gutters.splice(e, 1)
            }
        }
        function N(t) {
            var e = t.display
                , i = e.gutters.offsetWidth;
            var a = Math.round(t.doc.height + pe(t.display));
            return {
                clientHeight: e.scroller.clientHeight,
                viewHeight: e.wrapper.clientHeight,
                scrollWidth: e.scroller.scrollWidth,
                clientWidth: e.scroller.clientWidth,
                viewWidth: e.wrapper.clientWidth,
                barLeft: t.options.fixedGutter ? i : 0,
                docHeight: a,
                scrollHeight: a + me(t) + e.barHeight,
                nativeBarWidth: e.nativeBarWidth,
                gutterWidth: i
            }
        }
        function L(t, e, i) {
            this.cm = i;
            var a = this.vert = fr("div", [fr("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
            var n = this.horiz = fr("div", [fr("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
            t(a);
            t(n);
            As(a, "scroll", function() {
                if (a.clientHeight)
                    e(a.scrollTop, "vertical")
            });
            As(n, "scroll", function() {
                if (n.clientWidth)
                    e(n.scrollLeft, "horizontal")
            });
            this.checkedOverlay = false;
            if (y && b < 8)
                this.horiz.style.minHeight = this.vert.style.minWidth = "18px"
        }
        function M() {}
        function P(i) {
            if (i.display.scrollbars) {
                i.display.scrollbars.clear();
                if (i.display.scrollbars.addClass)
                    yr(i.display.wrapper, i.display.scrollbars.addClass)
            }
            i.display.scrollbars = new F.scrollbarModel[i.options.scrollbarStyle](function(t) {
                    i.display.wrapper.insertBefore(t, i.display.scrollbarFiller);
                    As(t, "mousedown", function() {
                        if (i.state.focused)
                            setTimeout(function() {
                                i.display.input.focus()
                            }, 0)
                    });
                    t.setAttribute("cm-not-content", "true")
                }
                ,function(t, e) {
                    if (e == "horizontal")
                        Di(i, t);
                    else
                        Ui(i, t)
                }
                ,i);
            if (i.display.scrollbars.addClass)
                br(i.display.wrapper, i.display.scrollbars.addClass)
        }
        function R(t, e) {
            if (!e)
                e = N(t);
            var i = t.display.barWidth
                , a = t.display.barHeight;
            V(t, e);
            for (var n = 0; n < 4 && i != t.display.barWidth || a != t.display.barHeight; n++) {
                if (i != t.display.barWidth && t.options.lineWrapping)
                    J(t);
                V(t, N(t));
                i = t.display.barWidth;
                a = t.display.barHeight
            }
        }
        function V(t, e) {
            var i = t.display;
            var a = i.scrollbars.update(e);
            i.sizer.style.paddingRight = (i.barWidth = a.right) + "px";
            i.sizer.style.paddingBottom = (i.barHeight = a.bottom) + "px";
            if (a.right && a.bottom) {
                i.scrollbarFiller.style.display = "block";
                i.scrollbarFiller.style.height = a.bottom + "px";
                i.scrollbarFiller.style.width = a.right + "px"
            } else
                i.scrollbarFiller.style.display = "";
            if (a.bottom && t.options.coverGutterNextToScrollbar && t.options.fixedGutter) {
                i.gutterFiller.style.display = "block";
                i.gutterFiller.style.height = a.bottom + "px";
                i.gutterFiller.style.width = e.gutterWidth + "px"
            } else
                i.gutterFiller.style.display = ""
        }
        function $(t, e, i) {
            var a = i && i.top != null ? Math.max(0, i.top) : t.scroller.scrollTop;
            a = Math.floor(a - he(t));
            var n = i && i.bottom != null ? i.bottom : a + t.wrapper.clientHeight;
            var s = cs(e, a)
                , r = cs(e, n);
            if (i && i.ensure) {
                var o = i.ensure.from.line
                    , l = i.ensure.to.line;
                if (o < s) {
                    s = o;
                    r = cs(e, ds(ns(e, o)) + t.wrapper.clientHeight)
                } else if (Math.min(l, e.lastLine()) >= r) {
                    s = cs(e, ds(ns(e, l)) - t.wrapper.clientHeight);
                    r = l
                }
            }
            return {
                from: s,
                to: Math.max(r, s + 1)
            }
        }
        function H(t) {
            var e = t.display
                , i = e.view;
            if (!e.alignWidgets && (!e.gutters.firstChild || !t.options.fixedGutter))
                return;
            var a = j(e) - e.scroller.scrollLeft + t.doc.scrollLeft;
            var n = e.gutters.offsetWidth
                , s = a + "px";
            for (var r = 0; r < i.length; r++)
                if (!i[r].hidden) {
                    if (t.options.fixedGutter && i[r].gutter)
                        i[r].gutter.style.left = s;
                    var o = i[r].alignable;
                    if (o)
                        for (var l = 0; l < o.length; l++)
                            o[l].style.left = s
                }
            if (t.options.fixedGutter)
                e.gutters.style.left = a + n + "px"
        }
        function W(t) {
            if (!t.options.lineNumbers)
                return false;
            var e = t.doc
                , i = B(t.options, e.first + e.size - 1)
                , a = t.display;
            if (i.length != a.lineNumChars) {
                var n = a.measure.appendChild(fr("div", [fr("div", i)], "CodeMirror-linenumber CodeMirror-gutter-elt"));
                var s = n.firstChild.offsetWidth
                    , r = n.offsetWidth - s;
                a.lineGutter.style.width = "";
                a.lineNumInnerWidth = Math.max(s, a.lineGutter.offsetWidth - r) + 1;
                a.lineNumWidth = a.lineNumInnerWidth + r;
                a.lineNumChars = a.lineNumInnerWidth ? i.length : -1;
                a.lineGutter.style.width = a.lineNumWidth + "px";
                U(t);
                return true
            }
            return false
        }
        function B(t, e) {
            return String(t.lineNumberFormatter(e + t.firstLineNumber))
        }
        function j(t) {
            return t.scroller.getBoundingClientRect().left - t.sizer.getBoundingClientRect().left
        }
        function G(t, e, i) {
            var a = t.display;
            this.viewport = e;
            this.visible = $(a, t.doc, e);
            this.editorIsHidden = !a.wrapper.offsetWidth;
            this.wrapperHeight = a.wrapper.clientHeight;
            this.wrapperWidth = a.wrapper.clientWidth;
            this.oldDisplayWidth = ge(t);
            this.force = i;
            this.dims = tt(t);
            this.events = []
        }
        function z(t) {
            var e = t.display;
            if (!e.scrollbarsClipped && e.scroller.offsetWidth) {
                e.nativeBarWidth = e.scroller.offsetWidth - e.scroller.clientWidth;
                e.heightForcer.style.height = me(t) + "px";
                e.sizer.style.marginBottom = -e.nativeBarWidth + "px";
                e.sizer.style.borderRightWidth = me(t) + "px";
                e.scrollbarsClipped = true
            }
        }
        function Y(t, e) {
            var i = t.display
                , a = t.doc;
            if (e.editorIsHidden) {
                hi(t);
                return false
            }
            if (!e.force && e.visible.from >= i.viewFrom && e.visible.to <= i.viewTo && (i.updateLineNumbers == null || i.updateLineNumbers >= i.viewTo) && i.renderedView == i.view && gi(t) == 0)
                return false;
            if (W(t)) {
                hi(t);
                e.dims = tt(t)
            }
            var n = a.first + a.size;
            var s = Math.max(e.visible.from - t.options.viewportMargin, a.first);
            var r = Math.min(n, e.visible.to + t.options.viewportMargin);
            if (i.viewFrom < s && s - i.viewFrom < 20)
                s = Math.max(a.first, i.viewFrom);
            if (i.viewTo > r && i.viewTo - r < 20)
                r = Math.min(n, i.viewTo);
            if (v) {
                s = Fn(t.doc, s);
                r = yn(t.doc, r)
            }
            var o = s != i.viewFrom || r != i.viewTo || i.lastWrapHeight != e.wrapperHeight || i.lastWrapWidth != e.wrapperWidth;
            mi(t, s, r);
            i.viewOffset = ds(ns(t.doc, i.viewFrom));
            t.display.mover.style.top = i.viewOffset + "px";
            var l = gi(t);
            if (!o && l == 0 && !e.force && i.renderedView == i.view && (i.updateLineNumbers == null || i.updateLineNumbers >= i.viewTo))
                return false;
            var c = vr();
            if (l > 4)
                i.lineDiv.style.display = "none";
            et(t, i.updateLineNumbers, e.dims);
            if (l > 4)
                i.lineDiv.style.display = "";
            i.renderedView = i.view;
            if (c && vr() != c && c.offsetHeight)
                c.focus();
            mr(i.cursorDiv);
            mr(i.selectionDiv);
            i.gutters.style.height = 0;
            if (o) {
                i.lastWrapHeight = e.wrapperHeight;
                i.lastWrapWidth = e.wrapperWidth;
                le(t, 400)
            }
            i.updateLineNumbers = null;
            return true
        }
        function K(t, e) {
            var i = e.viewport;
            for (var a = true; ; a = false) {
                if (!a || !t.options.lineWrapping || e.oldDisplayWidth == ge(t)) {
                    if (i && i.top != null)
                        i = {
                            top: Math.min(t.doc.height + pe(t.display) - _e(t), i.top)
                        };
                    e.visible = $(t.display, t.doc, i);
                    if (e.visible.from >= t.display.viewFrom && e.visible.to <= t.display.viewTo)
                        break
                }
                if (!Y(t, e))
                    break;
                J(t);
                var n = N(t);
                ae(t);
                q(t, n);
                R(t, n)
            }
            e.signal(t, "update", t);
            if (t.display.viewFrom != t.display.reportedViewFrom || t.display.viewTo != t.display.reportedViewTo) {
                e.signal(t, "viewportChange", t, t.display.viewFrom, t.display.viewTo);
                t.display.reportedViewFrom = t.display.viewFrom;
                t.display.reportedViewTo = t.display.viewTo
            }
        }
        function Q(t, e) {
            var i = new G(t,e);
            if (Y(t, i)) {
                J(t);
                K(t, i);
                var a = N(t);
                ae(t);
                q(t, a);
                R(t, a);
                i.finish()
            }
        }
        function q(t, e) {
            t.display.sizer.style.minHeight = e.docHeight + "px";
            var i = e.docHeight + t.display.barHeight;
            t.display.heightForcer.style.top = i + "px";
            t.display.gutters.style.height = Math.max(i + me(t), e.clientHeight) + "px"
        }
        function J(t) {
            var e = t.display;
            var i = e.lineDiv.offsetTop;
            for (var a = 0; a < e.view.length; a++) {
                var n = e.view[a], s;
                if (n.hidden)
                    continue;
                if (y && b < 8) {
                    var r = n.node.offsetTop + n.node.offsetHeight;
                    s = r - i;
                    i = r
                } else {
                    var o = n.node.getBoundingClientRect();
                    s = o.bottom - o.top
                }
                var l = n.line.height - s;
                if (s < 2)
                    s = We(e);
                if (l > .001 || l < -.001) {
                    os(n.line, s);
                    Z(n.line);
                    if (n.rest)
                        for (var c = 0; c < n.rest.length; c++)
                            Z(n.rest[c])
                }
            }
        }
        function Z(t) {
            if (t.widgets)
                for (var e = 0; e < t.widgets.length; ++e)
                    t.widgets[e].height = t.widgets[e].node.offsetHeight
        }
        function tt(t) {
            var e = t.display
                , i = {}
                , a = {};
            var n = e.gutters.clientLeft;
            for (var s = e.gutters.firstChild, r = 0; s; s = s.nextSibling,
                ++r) {
                i[t.options.gutters[r]] = s.offsetLeft + s.clientLeft + n;
                a[t.options.gutters[r]] = s.clientWidth
            }
            return {
                fixedPos: j(e),
                gutterTotalWidth: e.gutters.offsetWidth,
                gutterLeft: i,
                gutterWidth: a,
                wrapperWidth: e.wrapper.clientWidth
            }
        }
        function et(i, t, e) {
            var a = i.display
                , n = i.options.lineNumbers;
            var s = a.lineDiv
                , r = s.firstChild;
            function o(t) {
                var e = t.nextSibling;
                if (f && g && i.display.currentWheelTarget == t)
                    t.style.display = "none";
                else
                    t.parentNode.removeChild(t);
                return e
            }
            var l = a.view
                , c = a.viewFrom;
            for (var d = 0; d < l.length; d++) {
                var u = l[d];
                if (u.hidden) {} else if (!u.node || u.node.parentNode != s) {
                    var h = dt(i, u, c, e);
                    s.insertBefore(h, r)
                } else {
                    while (r != u.node)
                        r = o(r);
                    var p = n && t != null && t <= c && u.lineNumber;
                    if (u.changes) {
                        if (er(u.changes, "gutter") > -1)
                            p = false;
                        it(i, u, c, e)
                    }
                    if (p) {
                        mr(u.lineNumber);
                        u.lineNumber.appendChild(document.createTextNode(B(i.options, c)))
                    }
                    r = u.node.nextSibling
                }
                c += u.size
            }
            while (r)
                r = o(r)
        }
        function it(t, e, i, a) {
            for (var n = 0; n < e.changes.length; n++) {
                var s = e.changes[n];
                if (s == "text")
                    rt(t, e);
                else if (s == "gutter")
                    lt(t, e, i, a);
                else if (s == "class")
                    ot(e);
                else if (s == "widget")
                    ct(t, e, a)
            }
            e.changes = null
        }
        function at(t) {
            if (t.node == t.text) {
                t.node = fr("div", null, null, "position: relative");
                if (t.text.parentNode)
                    t.text.parentNode.replaceChild(t.node, t.text);
                t.node.appendChild(t.text);
                if (y && b < 8)
                    t.node.style.zIndex = 2
            }
            return t.node
        }
        function nt(t) {
            var e = t.bgClass ? t.bgClass + " " + (t.line.bgClass || "") : t.line.bgClass;
            if (e)
                e += " CodeMirror-linebackground";
            if (t.background) {
                if (e)
                    t.background.className = e;
                else {
                    t.background.parentNode.removeChild(t.background);
                    t.background = null
                }
            } else if (e) {
                var i = at(t);
                t.background = i.insertBefore(fr("div", null, e), i.firstChild)
            }
        }
        function st(t, e) {
            var i = t.display.externalMeasured;
            if (i && i.line == e.line) {
                t.display.externalMeasured = null;
                e.measure = i.measure;
                return i.built
            }
            return $n(t, e)
        }
        function rt(t, e) {
            var i = e.text.className;
            var a = st(t, e);
            if (e.text == e.node)
                e.node = a.pre;
            e.text.parentNode.replaceChild(a.pre, e.text);
            e.text = a.pre;
            if (a.bgClass != e.bgClass || a.textClass != e.textClass) {
                e.bgClass = a.bgClass;
                e.textClass = a.textClass;
                ot(e)
            } else if (i) {
                e.text.className = i
            }
        }
        function ot(t) {
            nt(t);
            if (t.line.wrapClass)
                at(t).className = t.line.wrapClass;
            else if (t.node != t.text)
                t.node.className = "";
            var e = t.textClass ? t.textClass + " " + (t.line.textClass || "") : t.line.textClass;
            t.text.className = e || ""
        }
        function lt(t, e, i, a) {
            if (e.gutter) {
                e.node.removeChild(e.gutter);
                e.gutter = null
            }
            var n = e.line.gutterMarkers;
            if (t.options.lineNumbers || n) {
                var s = at(e);
                var r = e.gutter = fr("div", null, "CodeMirror-gutter-wrapper", "left: " + (t.options.fixedGutter ? a.fixedPos : -a.gutterTotalWidth) + "px; width: " + a.gutterTotalWidth + "px");
                t.display.input.setUneditable(r);
                s.insertBefore(r, e.text);
                if (e.line.gutterClass)
                    r.className += " " + e.line.gutterClass;
                if (t.options.lineNumbers && (!n || !n["CodeMirror-linenumbers"]))
                    e.lineNumber = r.appendChild(fr("div", B(t.options, i), "CodeMirror-linenumber CodeMirror-gutter-elt", "left: " + a.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + t.display.lineNumInnerWidth + "px"));
                if (n)
                    for (var o = 0; o < t.options.gutters.length; ++o) {
                        var l = t.options.gutters[o]
                            , c = n.hasOwnProperty(l) && n[l];
                        if (c)
                            r.appendChild(fr("div", [c], "CodeMirror-gutter-elt", "left: " + a.gutterLeft[l] + "px; width: " + a.gutterWidth[l] + "px"))
                    }
            }
        }
        function ct(t, e, i) {
            if (e.alignable)
                e.alignable = null;
            for (var a = e.node.firstChild, n; a; a = n) {
                var n = a.nextSibling;
                if (a.className == "CodeMirror-linewidget")
                    e.node.removeChild(a)
            }
            ut(t, e, i)
        }
        function dt(t, e, i, a) {
            var n = st(t, e);
            e.text = e.node = n.pre;
            if (n.bgClass)
                e.bgClass = n.bgClass;
            if (n.textClass)
                e.textClass = n.textClass;
            ot(e);
            lt(t, e, i, a);
            ut(t, e, a);
            return e.node
        }
        function ut(t, e, i) {
            ht(t, e.line, e, i, true);
            if (e.rest)
                for (var a = 0; a < e.rest.length; a++)
                    ht(t, e.rest[a], e, i, false)
        }
        function ht(t, e, i, a, n) {
            if (!e.widgets)
                return;
            var s = at(i);
            for (var r = 0, o = e.widgets; r < o.length; ++r) {
                var l = o[r]
                    , c = fr("div", [l.node], "CodeMirror-linewidget");
                if (!l.handleMouseEvents)
                    c.setAttribute("cm-ignore-events", "true");
                pt(l, c, i, a);
                t.display.input.setUneditable(c);
                if (n && l.above)
                    s.insertBefore(c, i.gutter || i.text);
                else
                    s.appendChild(c);
                Ms(l, "redraw")
            }
        }
        function pt(t, e, i, a) {
            if (t.noHScroll) {
                (i.alignable || (i.alignable = [])).push(e);
                var n = a.wrapperWidth;
                e.style.left = a.fixedPos + "px";
                if (!t.coverGutter) {
                    n -= a.gutterTotalWidth;
                    e.style.paddingLeft = a.gutterTotalWidth + "px"
                }
                e.style.width = n + "px"
            }
            if (t.coverGutter) {
                e.style.zIndex = 5;
                e.style.position = "relative";
                if (!t.noHScroll)
                    e.style.marginLeft = -a.gutterTotalWidth + "px"
            }
        }
        L.prototype = sr({
            update: function(t) {
                var e = t.scrollWidth > t.clientWidth + 1;
                var i = t.scrollHeight > t.clientHeight + 1;
                var a = t.nativeBarWidth;
                if (i) {
                    this.vert.style.display = "block";
                    this.vert.style.bottom = e ? a + "px" : "0";
                    var n = t.viewHeight - (e ? a : 0);
                    this.vert.firstChild.style.height = Math.max(0, t.scrollHeight - t.clientHeight + n) + "px"
                } else {
                    this.vert.style.display = "";
                    this.vert.firstChild.style.height = "0"
                }
                if (e) {
                    this.horiz.style.display = "block";
                    this.horiz.style.right = i ? a + "px" : "0";
                    this.horiz.style.left = t.barLeft + "px";
                    var s = t.viewWidth - t.barLeft - (i ? a : 0);
                    this.horiz.firstChild.style.width = t.scrollWidth - t.clientWidth + s + "px"
                } else {
                    this.horiz.style.display = "";
                    this.horiz.firstChild.style.width = "0"
                }
                if (!this.checkedOverlay && t.clientHeight > 0) {
                    if (a == 0)
                        this.overlayHack();
                    this.checkedOverlay = true
                }
                return {
                    right: i ? a : 0,
                    bottom: e ? a : 0
                }
            },
            setScrollLeft: function(t) {
                if (this.horiz.scrollLeft != t)
                    this.horiz.scrollLeft = t
            },
            setScrollTop: function(t) {
                if (this.vert.scrollTop != t)
                    this.vert.scrollTop = t
            },
            overlayHack: function() {
                var t = g && !s ? "12px" : "18px";
                this.horiz.style.minHeight = this.vert.style.minWidth = t;
                var e = this;
                var i = function(t) {
                    if (Us(t) != e.vert && Us(t) != e.horiz)
                        si(e.cm, Ti)(t)
                };
                As(this.vert, "mousedown", i);
                As(this.horiz, "mousedown", i)
            },
            clear: function() {
                var t = this.horiz.parentNode;
                t.removeChild(this.horiz);
                t.removeChild(this.vert)
            }
        }, L.prototype),
            M.prototype = sr({
                update: function() {
                    return {
                        bottom: 0,
                        right: 0
                    }
                },
                setScrollLeft: function() {},
                setScrollTop: function() {},
                clear: function() {}
            }, M.prototype),
            F.scrollbarModel = {
                native: L,
                null: M
            },
            G.prototype.signal = function(t, e) {
                if ($s(t, e))
                    this.events.push(arguments)
            }
            ,
            G.prototype.finish = function() {
                for (var t = 0; t < this.events.length; t++)
                    Ns.apply(null, this.events[t])
            }
        ;
        var ft = F.Pos = function(t, e) {
                if (!(this instanceof ft))
                    return new ft(t,e);
                this.line = t;
                this.ch = e
            }
            , mt = F.cmpPos = function(t, e) {
                return t.line - e.line || t.ch - e.ch
            }
        ;
        function gt(t) {
            return ft(t.line, t.ch)
        }
        function _t(t, e) {
            return mt(t, e) < 0 ? e : t
        }
        function vt(t, e) {
            return mt(t, e) < 0 ? t : e
        }
        function Ft(t) {
            if (!t.state.focused) {
                t.display.input.focus();
                Ki(t)
            }
        }
        function yt(t) {
            return t.options.readOnly || t.doc.cantEdit
        }
        var bt = null;
        function Tt(t, e, i, a, n) {
            var s = t.doc;
            t.display.shift = false;
            if (!a)
                a = s.sel;
            var r = t.state.pasteIncoming || n == "paste";
            var o = Dr(e)
                , l = null;
            if (r && a.ranges.length > 1) {
                if (bt && bt.join("\n") == e)
                    l = a.ranges.length % bt.length == 0 && ir(bt, Dr);
                else if (o.length == a.ranges.length)
                    l = ir(o, function(t) {
                        return [t]
                    })
            }
            for (var c = a.ranges.length - 1; c >= 0; c--) {
                var d = a.ranges[c];
                var u = d.from()
                    , h = d.to();
                if (d.empty()) {
                    if (i && i > 0)
                        u = ft(u.line, u.ch - i);
                    else if (t.state.overwrite && !r)
                        h = ft(h.line, Math.min(ns(s, h.line).text.length, h.ch + Zs(o).length))
                }
                var p = t.curOp.updateInput;
                var f = {
                    from: u,
                    to: h,
                    text: l ? l[c % l.length] : o,
                    origin: n || (r ? "paste" : t.state.cutIncoming ? "cut" : "+input")
                };
                sa(t.doc, f);
                Ms(t, "inputRead", t, f)
            }
            if (e && !r)
                xt(t, e);
            _a(t);
            t.curOp.updateInput = p;
            t.curOp.typing = true;
            t.state.pasteIncoming = t.state.cutIncoming = false
        }
        function Ct(t, e) {
            var i = t.clipboardData && t.clipboardData.getData("text/plain");
            if (i) {
                t.preventDefault();
                ni(e, function() {
                    Tt(e, i, 0, null, "paste")
                });
                return true
            }
        }
        function xt(t, e) {
            if (!t.options.electricChars || !t.options.smartIndent)
                return;
            var i = t.doc.sel;
            for (var a = i.ranges.length - 1; a >= 0; a--) {
                var n = i.ranges[a];
                if (n.head.ch > 100 || a && i.ranges[a - 1].head.line == n.head.line)
                    continue;
                var s = t.getModeAt(n.head);
                var r = false;
                if (s.electricChars) {
                    for (var o = 0; o < s.electricChars.length; o++)
                        if (e.indexOf(s.electricChars.charAt(o)) > -1) {
                            r = Fa(t, n.head.line, "smart");
                            break
                        }
                } else if (s.electricInput) {
                    if (s.electricInput.test(ns(t.doc, n.head.line).text.slice(0, n.head.ch)))
                        r = Fa(t, n.head.line, "smart")
                }
                if (r)
                    Ms(t, "electricInput", t, n.head.line)
            }
        }
        function wt(t) {
            var e = []
                , i = [];
            for (var a = 0; a < t.doc.sel.ranges.length; a++) {
                var n = t.doc.sel.ranges[a].head.line;
                var s = {
                    anchor: ft(n, 0),
                    head: ft(n + 1, 0)
                };
                i.push(s);
                e.push(t.getRange(s.anchor, s.head))
            }
            return {
                text: e,
                ranges: i
            }
        }
        function Et(t) {
            t.setAttribute("autocorrect", "off");
            t.setAttribute("autocapitalize", "off");
            t.setAttribute("spellcheck", "false")
        }
        function Xt(t) {
            this.cm = t;
            this.prevInput = "";
            this.pollingFast = false;
            this.polling = new Ys;
            this.inaccurateSelection = false;
            this.hasSelection = false;
            this.composing = null
        }
        function It() {
            var t = fr("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none");
            var e = fr("div", [t], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
            if (f)
                t.style.width = "1000px";
            else
                t.setAttribute("wrap", "off");
            if (o)
                t.style.border = "1px solid black";
            Et(t);
            return e
        }
        function St(t) {
            this.cm = t;
            this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;
            this.polling = new Ys;
            this.gracePeriod = false
        }
        function kt(t, e) {
            var i = Te(t, e.line);
            if (!i || i.hidden)
                return null;
            var a = ns(t.doc, e.line);
            var n = Fe(i, a, e.line);
            var s = us(a)
                , r = "left";
            if (s) {
                var o = Yr(s, e.ch);
                r = o % 2 ? "right" : "left"
            }
            var l = Xe(n.map, e.ch, r);
            l.offset = l.collapse == "right" ? l.end : l.start;
            return l
        }
        function Ut(t, e) {
            if (e)
                t.bad = true;
            return t
        }
        function Dt(t, e, i) {
            var a;
            if (e == t.display.lineDiv) {
                a = t.display.lineDiv.childNodes[i];
                if (!a)
                    return Ut(t.clipPos(ft(t.display.viewTo - 1)), true);
                e = null;
                i = 0
            } else {
                for (a = e; ; a = a.parentNode) {
                    if (!a || a == t.display.lineDiv)
                        return null;
                    if (a.parentNode && a.parentNode == t.display.lineDiv)
                        break
                }
            }
            for (var n = 0; n < t.display.view.length; n++) {
                var s = t.display.view[n];
                if (s.node == a)
                    return At(s, e, i)
            }
        }
        function At(c, t, e) {
            var i = c.text.firstChild
                , a = false;
            if (!t || !_r(i, t))
                return Ut(ft(ls(c.line), 0), true);
            if (t == i) {
                a = true;
                t = i.childNodes[e];
                e = 0;
                if (!t) {
                    var n = c.rest ? Zs(c.rest) : c.line;
                    return Ut(ft(ls(n), n.text.length), a)
                }
            }
            var s = t.nodeType == 3 ? t : null
                , r = t;
            if (!s && t.childNodes.length == 1 && t.firstChild.nodeType == 3) {
                s = t.firstChild;
                if (e)
                    e = s.nodeValue.length
            }
            while (r.parentNode != i)
                r = r.parentNode;
            var d = c.measure
                , u = d.maps;
            function o(t, e, i) {
                for (var a = -1; a < (u ? u.length : 0); a++) {
                    var n = a < 0 ? d.map : u[a];
                    for (var s = 0; s < n.length; s += 3) {
                        var r = n[s + 2];
                        if (r == t || r == e) {
                            var o = ls(a < 0 ? c.line : c.rest[a]);
                            var l = n[s] + i;
                            if (i < 0 || r != t)
                                l = n[s + (i ? 1 : 0)];
                            return ft(o, l)
                        }
                    }
                }
            }
            var l = o(s, r, e);
            if (l)
                return Ut(l, a);
            for (var h = r.nextSibling, p = s ? s.nodeValue.length - e : 0; h; h = h.nextSibling) {
                l = o(h, h.firstChild, 0);
                if (l)
                    return Ut(ft(l.line, l.ch - p), a);
                else
                    p += h.textContent.length
            }
            for (var f = r.previousSibling, p = e; f; f = f.previousSibling) {
                l = o(f, f.firstChild, -1);
                if (l)
                    return Ut(ft(l.line, l.ch + p), a);
                else
                    p += h.textContent.length
            }
        }
        function Ot(o, t, e, l, c) {
            var d = ""
                , u = false;
            function h(e) {
                return function(t) {
                    return t.id == e
                }
            }
            function p(t) {
                if (t.nodeType == 1) {
                    var e = t.getAttribute("cm-text");
                    if (e != null) {
                        if (e == "")
                            e = t.textContent.replace(/\u200b/g, "");
                        d += e;
                        return
                    }
                    var i = t.getAttribute("cm-marker"), a;
                    if (i) {
                        var n = o.findMarks(ft(l, 0), ft(c + 1, 0), h(+i));
                        if (n.length && (a = n[0].find()))
                            d += ss(o.doc, a.from, a.to).join("\n");
                        return
                    }
                    if (t.getAttribute("contenteditable") == "false")
                        return;
                    for (var s = 0; s < t.childNodes.length; s++)
                        p(t.childNodes[s]);
                    if (/^(pre|div|p)$/i.test(t.nodeName))
                        u = true
                } else if (t.nodeType == 3) {
                    var r = t.nodeValue;
                    if (!r)
                        return;
                    if (u) {
                        d += "\n";
                        u = false
                    }
                    d += r
                }
            }
            for (; ; ) {
                p(t);
                if (t == e)
                    break;
                t = t.nextSibling
            }
            return d
        }
        function Nt(t, e) {
            this.ranges = t;
            this.primIndex = e
        }
        function Lt(t, e) {
            this.anchor = t;
            this.head = e
        }
        function Mt(t, e) {
            var i = t[e];
            t.sort(function(t, e) {
                return mt(t.from(), e.from())
            });
            e = er(t, i);
            for (var a = 1; a < t.length; a++) {
                var n = t[a]
                    , s = t[a - 1];
                if (mt(s.to(), n.from()) >= 0) {
                    var r = vt(s.from(), n.from())
                        , o = _t(s.to(), n.to());
                    var l = s.empty() ? n.from() == n.head : s.from() == s.head;
                    if (a <= e)
                        --e;
                    t.splice(--a, 2, new Lt(l ? o : r,l ? r : o))
                }
            }
            return new Nt(t,e)
        }
        function Pt(t, e) {
            return new Nt([new Lt(t,e || t)],0)
        }
        function Rt(t, e) {
            return Math.max(t.first, Math.min(e, t.first + t.size - 1))
        }
        function Vt(t, e) {
            if (e.line < t.first)
                return ft(t.first, 0);
            var i = t.first + t.size - 1;
            if (e.line > i)
                return ft(i, ns(t, i).text.length);
            return $t(e, ns(t, e.line).text.length)
        }
        function $t(t, e) {
            var i = t.ch;
            if (i == null || i > e)
                return ft(t.line, e);
            else if (i < 0)
                return ft(t.line, 0);
            else
                return t
        }
        function Ht(t, e) {
            return e >= t.first && e < t.first + t.size
        }
        function Wt(t, e) {
            for (var i = [], a = 0; a < e.length; a++)
                i[a] = Vt(t, e[a]);
            return i
        }
        function Bt(t, e, i, a) {
            if (t.cm && t.cm.display.shift || t.extend) {
                var n = e.anchor;
                if (a) {
                    var s = mt(i, n) < 0;
                    if (s != mt(a, n) < 0) {
                        n = i;
                        i = a
                    } else if (s != mt(i, a) < 0) {
                        i = a
                    }
                }
                return new Lt(n,i)
            } else {
                return new Lt(a || i,i)
            }
        }
        function jt(t, e, i, a) {
            qt(t, new Nt([Bt(t, t.sel.primary(), e, i)],0), a)
        }
        function Gt(t, e, i) {
            for (var a = [], n = 0; n < t.sel.ranges.length; n++)
                a[n] = Bt(t, t.sel.ranges[n], e[n], null);
            var s = Mt(a, t.sel.primIndex);
            qt(t, s, i)
        }
        function zt(t, e, i, a) {
            var n = t.sel.ranges.slice(0);
            n[e] = i;
            qt(t, Mt(n, t.sel.primIndex), a)
        }
        function Yt(t, e, i, a) {
            qt(t, Pt(e, i), a)
        }
        function Kt(i, t) {
            var e = {
                ranges: t.ranges,
                update: function(t) {
                    this.ranges = [];
                    for (var e = 0; e < t.length; e++)
                        this.ranges[e] = new Lt(Vt(i, t[e].anchor),Vt(i, t[e].head))
                }
            };
            Ns(i, "beforeSelectionChange", i, e);
            if (i.cm)
                Ns(i.cm, "beforeSelectionChange", i.cm, e);
            if (e.ranges != t.ranges)
                return Mt(e.ranges, e.ranges.length - 1);
            else
                return t
        }
        function Qt(t, e, i) {
            var a = t.history.done
                , n = Zs(a);
            if (n && n.ranges) {
                a[a.length - 1] = e;
                Jt(t, e, i)
            } else {
                qt(t, e, i)
            }
        }
        function qt(t, e, i) {
            Jt(t, e, i);
            vs(t, t.sel, t.cm ? t.cm.curOp.id : NaN, i)
        }
        function Jt(t, e, i) {
            if ($s(t, "beforeSelectionChange") || t.cm && $s(t.cm, "beforeSelectionChange"))
                e = Kt(t, e);
            var a = i && i.bias || (mt(e.primary().head, t.sel.primary().head) < 0 ? -1 : 1);
            Zt(t, ee(t, e, a, true));
            if (!(i && i.scroll === false) && t.cm)
                _a(t.cm)
        }
        function Zt(t, e) {
            if (e.equals(t.sel))
                return;
            t.sel = e;
            if (t.cm) {
                t.cm.curOp.updateInput = t.cm.curOp.selectionChanged = true;
                Vs(t.cm)
            }
            Ms(t, "cursorActivity", t)
        }
        function te(t) {
            Zt(t, ee(t, t.sel, null, false), js)
        }
        function ee(t, e, i, a) {
            var n;
            for (var s = 0; s < e.ranges.length; s++) {
                var r = e.ranges[s];
                var o = ie(t, r.anchor, i, a);
                var l = ie(t, r.head, i, a);
                if (n || o != r.anchor || l != r.head) {
                    if (!n)
                        n = e.ranges.slice(0, s);
                    n[s] = new Lt(o,l)
                }
            }
            return n ? Mt(n, e.primIndex) : e
        }
        function ie(t, e, i, a) {
            var n = false
                , s = e;
            var r = i || 1;
            t.cantEdit = false;
            t: for (; ; ) {
                var o = ns(t, s.line);
                if (o.markedSpans) {
                    for (var l = 0; l < o.markedSpans.length; ++l) {
                        var c = o.markedSpans[l]
                            , d = c.marker;
                        if ((c.from == null || (d.inclusiveLeft ? c.from <= s.ch : c.from < s.ch)) && (c.to == null || (d.inclusiveRight ? c.to >= s.ch : c.to > s.ch))) {
                            if (a) {
                                Ns(d, "beforeCursorEnter");
                                if (d.explicitlyCleared) {
                                    if (!o.markedSpans)
                                        break;
                                    else {
                                        --l;
                                        continue
                                    }
                                }
                            }
                            if (!d.atomic)
                                continue;
                            var u = d.find(r < 0 ? -1 : 1);
                            if (mt(u, s) == 0) {
                                u.ch += r;
                                if (u.ch < 0) {
                                    if (u.line > t.first)
                                        u = Vt(t, ft(u.line - 1));
                                    else
                                        u = null
                                } else if (u.ch > o.text.length) {
                                    if (u.line < t.first + t.size - 1)
                                        u = ft(u.line + 1, 0);
                                    else
                                        u = null
                                }
                                if (!u) {
                                    if (n) {
                                        if (!a)
                                            return ie(t, e, i, true);
                                        t.cantEdit = true;
                                        return ft(t.first, 0)
                                    }
                                    n = true;
                                    u = e;
                                    r = -r
                                }
                            }
                            s = u;
                            continue t
                        }
                    }
                }
                return s
            }
        }
        function ae(t) {
            t.display.input.showSelection(t.display.input.prepareSelection())
        }
        function ne(t, e) {
            var i = t.doc
                , a = {};
            var n = a.cursors = document.createDocumentFragment();
            var s = a.selection = document.createDocumentFragment();
            for (var r = 0; r < i.sel.ranges.length; r++) {
                if (e === false && r == i.sel.primIndex)
                    continue;
                var o = i.sel.ranges[r];
                var l = o.empty();
                if (l || t.options.showCursorWhenSelecting)
                    se(t, o, n);
                if (!l)
                    re(t, o, s)
            }
            return a
        }
        function se(t, e, i) {
            var a = Pe(t, e.head, "div", null, null, !t.options.singleCursorHeightPerLine);
            var n = i.appendChild(fr("div", "", "CodeMirror-cursor"));
            n.style.left = a.left + "px";
            n.style.top = a.top + "px";
            n.style.height = Math.max(0, a.bottom - a.top) * t.options.cursorHeight + "px";
            if (a.other) {
                var s = i.appendChild(fr("div", "", "CodeMirror-cursor CodeMirror-secondarycursor"));
                s.style.display = "";
                s.style.left = a.other.left + "px";
                s.style.top = a.other.top + "px";
                s.style.height = (a.other.bottom - a.other.top) * .85 + "px"
            }
        }
        function re(n, t, e) {
            var i = n.display
                , s = n.doc;
            var r = document.createDocumentFragment();
            var a = fe(n.display)
                , f = a.left;
            var m = Math.max(i.sizerWidth, ge(n) - i.sizer.offsetLeft) - a.right;
            function g(t, e, i, a) {
                if (e < 0)
                    e = 0;
                e = Math.round(e);
                a = Math.round(a);
                r.appendChild(fr("div", null, "CodeMirror-selected", "position: absolute; left: " + t + "px; top: " + e + "px; width: " + (i == null ? m - t : i) + "px; height: " + (a - e) + "px"))
            }
            function o(i, l, c) {
                var a = ns(s, i);
                var d = a.text.length;
                var u, h;
                function p(t, e) {
                    return Me(n, ft(i, t), "div", a, e)
                }
                Rr(us(a), l || 0, c == null ? d : c, function(t, e, i) {
                    var a = p(t, "left"), n, s, r;
                    if (t == e) {
                        n = a;
                        s = r = a.left
                    } else {
                        n = p(e - 1, "right");
                        if (i == "rtl") {
                            var o = a;
                            a = n;
                            n = o
                        }
                        s = a.left;
                        r = n.right
                    }
                    if (l == null && t == 0)
                        s = f;
                    if (n.top - a.top > 3) {
                        g(s, a.top, null, a.bottom);
                        s = f;
                        if (a.bottom < n.top)
                            g(s, a.bottom, null, n.top)
                    }
                    if (c == null && e == d)
                        r = m;
                    if (!u || a.top < u.top || a.top == u.top && a.left < u.left)
                        u = a;
                    if (!h || n.bottom > h.bottom || n.bottom == h.bottom && n.right > h.right)
                        h = n;
                    if (s < f + 1)
                        s = f;
                    g(s, n.top, r - s, n.bottom)
                });
                return {
                    start: u,
                    end: h
                }
            }
            var l = t.from()
                , c = t.to();
            if (l.line == c.line) {
                o(l.line, l.ch, c.ch)
            } else {
                var d = ns(s, l.line)
                    , u = ns(s, c.line);
                var h = _n(d) == _n(u);
                var p = o(l.line, l.ch, h ? d.text.length + 1 : null).end;
                var _ = o(c.line, h ? 0 : null, c.ch).start;
                if (h) {
                    if (p.top < _.top - 2) {
                        g(p.right, p.top, null, p.bottom);
                        g(f, _.top, _.left, _.bottom)
                    } else {
                        g(p.right, p.top, _.left - p.right, p.bottom)
                    }
                }
                if (p.bottom < _.top)
                    g(f, p.bottom, null, _.top)
            }
            e.appendChild(r)
        }
        function oe(t) {
            if (!t.state.focused)
                return;
            var e = t.display;
            clearInterval(e.blinker);
            var i = true;
            e.cursorDiv.style.visibility = "";
            if (t.options.cursorBlinkRate > 0)
                e.blinker = setInterval(function() {
                    e.cursorDiv.style.visibility = (i = !i) ? "" : "hidden"
                }, t.options.cursorBlinkRate);
            else if (t.options.cursorBlinkRate < 0)
                e.cursorDiv.style.visibility = "hidden"
        }
        function le(t, e) {
            if (t.doc.mode.startState && t.doc.frontier < t.display.viewTo)
                t.state.highlight.set(e, rr(ce, t))
        }
        function ce(o) {
            var l = o.doc;
            if (l.frontier < l.first)
                l.frontier = l.first;
            if (l.frontier >= o.display.viewTo)
                return;
            var c = +new Date + o.options.workTime;
            var d = Aa(l.mode, ue(o, l.frontier));
            var u = [];
            l.iter(l.frontier, Math.min(l.first + l.size, o.display.viewTo + 500), function(t) {
                if (l.frontier >= o.display.viewFrom) {
                    var e = t.styles;
                    var i = Nn(o, t, d, true);
                    t.styles = i.styles;
                    var a = t.styleClasses
                        , n = i.classes;
                    if (n)
                        t.styleClasses = n;
                    else if (a)
                        t.styleClasses = null;
                    var s = !e || e.length != t.styles.length || a != n && (!a || !n || a.bgClass != n.bgClass || a.textClass != n.textClass);
                    for (var r = 0; !s && r < e.length; ++r)
                        s = e[r] != t.styles[r];
                    if (s)
                        u.push(l.frontier);
                    t.stateAfter = Aa(l.mode, d)
                } else {
                    Mn(o, t.text, d);
                    t.stateAfter = l.frontier % 5 == 0 ? Aa(l.mode, d) : null
                }
                ++l.frontier;
                if (+new Date > c) {
                    le(o, o.options.workDelay);
                    return true
                }
            });
            if (u.length)
                ni(o, function() {
                    for (var t = 0; t < u.length; t++)
                        ui(o, u[t], "text")
                })
        }
        function de(t, e, i) {
            var a, n, s = t.doc;
            var r = i ? -1 : e - (t.doc.mode.innerMode ? 1e3 : 100);
            for (var o = e; o > r; --o) {
                if (o <= s.first)
                    return s.first;
                var l = ns(s, o - 1);
                if (l.stateAfter && (!i || o <= s.frontier))
                    return o;
                var c = Ks(l.text, null, t.options.tabSize);
                if (n == null || a > c) {
                    n = o - 1;
                    a = c
                }
            }
            return n
        }
        function ue(i, a, t) {
            var n = i.doc
                , s = i.display;
            if (!n.mode.startState)
                return true;
            var r = de(i, a, t)
                , o = r > n.first && ns(n, r - 1).stateAfter;
            if (!o)
                o = Oa(n.mode);
            else
                o = Aa(n.mode, o);
            n.iter(r, a, function(t) {
                Mn(i, t.text, o);
                var e = r == a - 1 || r % 5 == 0 || r >= s.viewFrom && r < s.viewTo;
                t.stateAfter = e ? Aa(n.mode, o) : null;
                ++r
            });
            if (t)
                n.frontier = r;
            return o
        }
        function he(t) {
            return t.lineSpace.offsetTop
        }
        function pe(t) {
            return t.mover.offsetHeight - t.lineSpace.offsetHeight
        }
        function fe(t) {
            if (t.cachedPaddingH)
                return t.cachedPaddingH;
            var e = gr(t.measure, fr("pre", "x"));
            var i = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;
            var a = {
                left: parseInt(i.paddingLeft),
                right: parseInt(i.paddingRight)
            };
            if (!isNaN(a.left) && !isNaN(a.right))
                t.cachedPaddingH = a;
            return a
        }
        function me(t) {
            return Ws - t.display.nativeBarWidth
        }
        function ge(t) {
            return t.display.scroller.clientWidth - me(t) - t.display.barWidth
        }
        function _e(t) {
            return t.display.scroller.clientHeight - me(t) - t.display.barHeight
        }
        function ve(t, e, i) {
            var a = t.options.lineWrapping;
            var n = a && ge(t);
            if (!e.measure.heights || a && e.measure.width != n) {
                var s = e.measure.heights = [];
                if (a) {
                    e.measure.width = n;
                    var r = e.text.firstChild.getClientRects();
                    for (var o = 0; o < r.length - 1; o++) {
                        var l = r[o]
                            , c = r[o + 1];
                        if (Math.abs(l.bottom - c.bottom) > 2)
                            s.push((l.bottom + c.top) / 2 - i.top)
                    }
                }
                s.push(i.bottom - i.top)
            }
        }
        function Fe(t, e, i) {
            if (t.line == e)
                return {
                    map: t.measure.map,
                    cache: t.measure.cache
                };
            for (var a = 0; a < t.rest.length; a++)
                if (t.rest[a] == e)
                    return {
                        map: t.measure.maps[a],
                        cache: t.measure.caches[a]
                    };
            for (var a = 0; a < t.rest.length; a++)
                if (ls(t.rest[a]) > i)
                    return {
                        map: t.measure.maps[a],
                        cache: t.measure.caches[a],
                        before: true
                    }
        }
        function ye(t, e) {
            e = _n(e);
            var i = ls(e);
            var a = t.display.externalMeasured = new li(t.doc,e,i);
            a.lineN = i;
            var n = a.built = $n(t, a);
            a.text = n.pre;
            gr(t.display.lineMeasure, n.pre);
            return a
        }
        function be(t, e, i, a) {
            return xe(t, Ce(t, e), i, a)
        }
        function Te(t, e) {
            if (e >= t.display.viewFrom && e < t.display.viewTo)
                return t.display.view[pi(t, e)];
            var i = t.display.externalMeasured;
            if (i && e >= i.lineN && e < i.lineN + i.size)
                return i
        }
        function Ce(t, e) {
            var i = ls(e);
            var a = Te(t, i);
            if (a && !a.text)
                a = null;
            else if (a && a.changes)
                it(t, a, i, tt(t));
            if (!a)
                a = ye(t, e);
            var n = Fe(a, e, i);
            return {
                line: e,
                view: a,
                rect: null,
                map: n.map,
                cache: n.cache,
                before: n.before,
                hasHeights: false
            }
        }
        function xe(t, e, i, a, n) {
            if (e.before)
                i = -1;
            var s = i + (a || ""), r;
            if (e.cache.hasOwnProperty(s)) {
                r = e.cache[s]
            } else {
                if (!e.rect)
                    e.rect = e.view.text.getBoundingClientRect();
                if (!e.hasHeights) {
                    ve(t, e.view, e.rect);
                    e.hasHeights = true
                }
                r = Ie(t, e, i, a);
                if (!r.bogus)
                    e.cache[s] = r
            }
            return {
                left: r.left,
                right: r.right,
                top: n ? r.rtop : r.top,
                bottom: n ? r.rbottom : r.bottom
            }
        }
        Xt.prototype = sr({
            init: function(e) {
                var i = this
                    , a = this.cm;
                var t = this.wrapper = It();
                var n = this.textarea = t.firstChild;
                e.wrapper.insertBefore(t, e.wrapper.firstChild);
                if (o)
                    n.style.width = "0px";
                As(n, "input", function() {
                    if (y && b >= 9 && i.hasSelection)
                        i.hasSelection = null;
                    i.poll()
                });
                As(n, "paste", function(t) {
                    if (Ct(t, a))
                        return true;
                    a.state.pasteIncoming = true;
                    i.fastPoll()
                });
                function s(t) {
                    if (a.somethingSelected()) {
                        bt = a.getSelections();
                        if (i.inaccurateSelection) {
                            i.prevInput = "";
                            i.inaccurateSelection = false;
                            n.value = bt.join("\n");
                            tr(n)
                        }
                    } else if (!a.options.lineWiseCopyCut) {
                        return
                    } else {
                        var e = wt(a);
                        bt = e.text;
                        if (t.type == "cut") {
                            a.setSelections(e.ranges, null, js)
                        } else {
                            i.prevInput = "";
                            n.value = e.text.join("\n");
                            tr(n)
                        }
                    }
                    if (t.type == "cut")
                        a.state.cutIncoming = true
                }
                As(n, "cut", s);
                As(n, "copy", s);
                As(e.scroller, "paste", function(t) {
                    if (yi(e, t))
                        return;
                    a.state.pasteIncoming = true;
                    i.focus()
                });
                As(e.lineSpace, "selectstart", function(t) {
                    if (!yi(e, t))
                        Xs(t)
                });
                As(n, "compositionstart", function() {
                    var t = a.getCursor("from");
                    i.composing = {
                        start: t,
                        range: a.markText(t, a.getCursor("to"), {
                            className: "CodeMirror-composing"
                        })
                    }
                });
                As(n, "compositionend", function() {
                    if (i.composing) {
                        i.poll();
                        i.composing.range.clear();
                        i.composing = null
                    }
                })
            },
            prepareSelection: function() {
                var t = this.cm
                    , e = t.display
                    , i = t.doc;
                var a = ne(t);
                if (t.options.moveInputWithCursor) {
                    var n = Pe(t, i.sel.primary().head, "div");
                    var s = e.wrapper.getBoundingClientRect()
                        , r = e.lineDiv.getBoundingClientRect();
                    a.teTop = Math.max(0, Math.min(e.wrapper.clientHeight - 10, n.top + r.top - s.top));
                    a.teLeft = Math.max(0, Math.min(e.wrapper.clientWidth - 10, n.left + r.left - s.left))
                }
                return a
            },
            showSelection: function(t) {
                var e = this.cm
                    , i = e.display;
                gr(i.cursorDiv, t.cursors);
                gr(i.selectionDiv, t.selection);
                if (t.teTop != null) {
                    this.wrapper.style.top = t.teTop + "px";
                    this.wrapper.style.left = t.teLeft + "px"
                }
            },
            reset: function(t) {
                if (this.contextMenuPending)
                    return;
                var e, i, a = this.cm, n = a.doc;
                if (a.somethingSelected()) {
                    this.prevInput = "";
                    var s = n.sel.primary();
                    e = Or && (s.to().line - s.from().line > 100 || (i = a.getSelection()).length > 1e3);
                    var r = e ? "-" : i || a.getSelection();
                    this.textarea.value = r;
                    if (a.state.focused)
                        tr(this.textarea);
                    if (y && b >= 9)
                        this.hasSelection = r
                } else if (!t) {
                    this.prevInput = this.textarea.value = "";
                    if (y && b >= 9)
                        this.hasSelection = null
                }
                this.inaccurateSelection = e
            },
            getField: function() {
                return this.textarea
            },
            supportsTouch: function() {
                return false
            },
            focus: function() {
                if (this.cm.options.readOnly != "nocursor" && (!l || vr() != this.textarea)) {
                    try {
                        this.textarea.focus()
                    } catch (t) {}
                }
            },
            blur: function() {
                this.textarea.blur()
            },
            resetPosition: function() {
                this.wrapper.style.top = this.wrapper.style.left = 0
            },
            receivedFocus: function() {
                this.slowPoll()
            },
            slowPoll: function() {
                var t = this;
                if (t.pollingFast)
                    return;
                t.polling.set(this.cm.options.pollInterval, function() {
                    t.poll();
                    if (t.cm.state.focused)
                        t.slowPoll()
                })
            },
            fastPoll: function() {
                var e = false
                    , i = this;
                i.pollingFast = true;
                function a() {
                    var t = i.poll();
                    if (!t && !e) {
                        e = true;
                        i.polling.set(60, a)
                    } else {
                        i.pollingFast = false;
                        i.slowPoll()
                    }
                }
                i.polling.set(20, a)
            },
            poll: function() {
                var t = this.cm
                    , e = this.textarea
                    , i = this.prevInput;
                if (this.contextMenuPending || !t.state.focused || Ar(e) && !i || yt(t) || t.options.disableInput || t.state.keySeq)
                    return false;
                var a = e.value;
                if (a == i && !t.somethingSelected())
                    return false;
                if (y && b >= 9 && this.hasSelection === a || g && /[\uf700-\uf7ff]/.test(a)) {
                    t.display.input.reset();
                    return false
                }
                if (t.doc.sel == t.display.selForContextMenu) {
                    var n = a.charCodeAt(0);
                    if (n == 8203 && !i)
                        i = "";
                    if (n == 8666) {
                        this.reset();
                        return this.cm.execCommand("undo")
                    }
                }
                var s = 0
                    , r = Math.min(i.length, a.length);
                while (s < r && i.charCodeAt(s) == a.charCodeAt(s))
                    ++s;
                var o = this;
                ni(t, function() {
                    Tt(t, a.slice(s), i.length - s, null, o.composing ? "*compose" : null);
                    if (a.length > 1e3 || a.indexOf("\n") > -1)
                        e.value = o.prevInput = "";
                    else
                        o.prevInput = a;
                    if (o.composing) {
                        o.composing.range.clear();
                        o.composing.range = t.markText(o.composing.start, t.getCursor("to"), {
                            className: "CodeMirror-composing"
                        })
                    }
                });
                return true
            },
            ensurePolled: function() {
                if (this.pollingFast && this.poll())
                    this.pollingFast = false
            },
            onKeyPress: function() {
                if (y && b >= 9)
                    this.hasSelection = null;
                this.fastPoll()
            },
            onContextMenu: function(t) {
                var i = this
                    , a = i.cm
                    , n = a.display
                    , s = i.textarea;
                var e = bi(a, t)
                    , r = n.scroller.scrollTop;
                if (!e || m)
                    return;
                var o = a.options.resetSelectionOnContextMenu;
                if (o && a.doc.sel.contains(e) == -1)
                    si(a, qt)(a.doc, Pt(e), js);
                var l = s.style.cssText;
                i.wrapper.style.position = "absolute";
                s.style.cssText = "position: fixed; width: 30px; height: 30px; top: " + (t.clientY - 5) + "px; left: " + (t.clientX - 5) + "px; z-index: 1000; background: " + (y ? "rgba(255, 255, 255, .05)" : "transparent") + "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
                if (f)
                    var c = window.scrollY;
                n.input.focus();
                if (f)
                    window.scrollTo(null, c);
                n.input.reset();
                if (!a.somethingSelected())
                    s.value = i.prevInput = " ";
                i.contextMenuPending = true;
                n.selForContextMenu = a.doc.sel;
                clearTimeout(n.detectingSelectAll);
                function d() {
                    if (s.selectionStart != null) {
                        var t = a.somethingSelected();
                        var e = "" + (t ? s.value : "");
                        s.value = "";
                        s.value = e;
                        i.prevInput = t ? "" : "";
                        s.selectionStart = 1;
                        s.selectionEnd = e.length;
                        n.selForContextMenu = a.doc.sel
                    }
                }
                function u() {
                    i.contextMenuPending = false;
                    i.wrapper.style.position = "relative";
                    s.style.cssText = l;
                    if (y && b < 9)
                        n.scrollbars.setScrollTop(n.scroller.scrollTop = r);
                    if (s.selectionStart != null) {
                        if (!y || y && b < 9)
                            d();
                        var t = 0
                            , e = function() {
                            if (n.selForContextMenu == a.doc.sel && s.selectionStart == 0 && s.selectionEnd > 0 && i.prevInput == "")
                                si(a, Na.selectAll)(a);
                            else if (t++ < 10)
                                n.detectingSelectAll = setTimeout(e, 500);
                            else
                                n.input.reset()
                        };
                        n.detectingSelectAll = setTimeout(e, 200)
                    }
                }
                if (y && b >= 9)
                    d();
                if (_) {
                    ks(t);
                    var h = function() {
                        Os(window, "mouseup", h);
                        setTimeout(u, 20)
                    };
                    As(window, "mouseup", h)
                } else {
                    setTimeout(u, 50)
                }
            },
            setUneditable: ar,
            needsContentAttribute: false
        }, Xt.prototype),
            St.prototype = sr({
                init: function(t) {
                    var s = this
                        , r = s.cm;
                    var e = s.div = t.lineDiv;
                    e.contentEditable = "true";
                    Et(e);
                    As(e, "paste", function(t) {
                        Ct(t, r)
                    });
                    As(e, "compositionstart", function(t) {
                        var e = t.data;
                        s.composing = {
                            sel: r.doc.sel,
                            data: e,
                            startData: e
                        };
                        if (!e)
                            return;
                        var i = r.doc.sel.primary();
                        var a = r.getLine(i.head.line);
                        var n = a.indexOf(e, Math.max(0, i.head.ch - e.length));
                        if (n > -1 && n <= i.head.ch)
                            s.composing.sel = Pt(ft(i.head.line, n), ft(i.head.line, n + e.length))
                    });
                    As(e, "compositionupdate", function(t) {
                        s.composing.data = t.data
                    });
                    As(e, "compositionend", function(t) {
                        var e = s.composing;
                        if (!e)
                            return;
                        if (t.data != e.startData && !/\u200b/.test(t.data))
                            e.data = t.data;
                        setTimeout(function() {
                            if (!e.handled)
                                s.applyComposition(e);
                            if (s.composing == e)
                                s.composing = null
                        }, 50)
                    });
                    As(e, "touchstart", function() {
                        s.forceCompositionEnd()
                    });
                    As(e, "input", function() {
                        if (s.composing)
                            return;
                        if (!s.pollContent())
                            ni(s.cm, function() {
                                di(r)
                            })
                    });
                    function i(t) {
                        if (r.somethingSelected()) {
                            bt = r.getSelections();
                            if (t.type == "cut")
                                r.replaceSelection("", null, "cut")
                        } else if (!r.options.lineWiseCopyCut) {
                            return
                        } else {
                            var e = wt(r);
                            bt = e.text;
                            if (t.type == "cut") {
                                r.operation(function() {
                                    r.setSelections(e.ranges, 0, js);
                                    r.replaceSelection("", null, "cut")
                                })
                            }
                        }
                        if (t.clipboardData && !o) {
                            t.preventDefault();
                            t.clipboardData.clearData();
                            t.clipboardData.setData("text/plain", bt.join("\n"))
                        } else {
                            var i = It()
                                , a = i.firstChild;
                            r.display.lineSpace.insertBefore(i, r.display.lineSpace.firstChild);
                            a.value = bt.join("\n");
                            var n = document.activeElement;
                            tr(a);
                            setTimeout(function() {
                                r.display.lineSpace.removeChild(i);
                                n.focus()
                            }, 50)
                        }
                    }
                    As(e, "copy", i);
                    As(e, "cut", i)
                },
                prepareSelection: function() {
                    var t = ne(this.cm, false);
                    t.focus = this.cm.state.focused;
                    return t
                },
                showSelection: function(t) {
                    if (!t || !this.cm.display.view.length)
                        return;
                    if (t.focus)
                        this.showPrimarySelection();
                    this.showMultipleSelections(t)
                },
                showPrimarySelection: function() {
                    var t = window.getSelection()
                        , e = this.cm.doc.sel.primary();
                    var i = Dt(this.cm, t.anchorNode, t.anchorOffset);
                    var a = Dt(this.cm, t.focusNode, t.focusOffset);
                    if (i && !i.bad && a && !a.bad && mt(vt(i, a), e.from()) == 0 && mt(_t(i, a), e.to()) == 0)
                        return;
                    var n = kt(this.cm, e.from());
                    var s = kt(this.cm, e.to());
                    if (!n && !s)
                        return;
                    var r = this.cm.display.view;
                    var o = t.rangeCount && t.getRangeAt(0);
                    if (!n) {
                        n = {
                            node: r[0].measure.map[2],
                            offset: 0
                        }
                    } else if (!s) {
                        var l = r[r.length - 1].measure;
                        var c = l.maps ? l.maps[l.maps.length - 1] : l.map;
                        s = {
                            node: c[c.length - 1],
                            offset: c[c.length - 2] - c[c.length - 3]
                        }
                    }
                    try {
                        var d = hr(n.node, n.offset, s.offset, s.node)
                    } catch (t) {}
                    if (d) {
                        t.removeAllRanges();
                        t.addRange(d);
                        if (o && t.anchorNode == null)
                            t.addRange(o);
                        else if (p)
                            this.startGracePeriod()
                    }
                    this.rememberSelection()
                },
                startGracePeriod: function() {
                    var t = this;
                    clearTimeout(this.gracePeriod);
                    this.gracePeriod = setTimeout(function() {
                        t.gracePeriod = false;
                        if (t.selectionChanged())
                            t.cm.operation(function() {
                                t.cm.curOp.selectionChanged = true
                            })
                    }, 20)
                },
                showMultipleSelections: function(t) {
                    gr(this.cm.display.cursorDiv, t.cursors);
                    gr(this.cm.display.selectionDiv, t.selection)
                },
                rememberSelection: function() {
                    var t = window.getSelection();
                    this.lastAnchorNode = t.anchorNode;
                    this.lastAnchorOffset = t.anchorOffset;
                    this.lastFocusNode = t.focusNode;
                    this.lastFocusOffset = t.focusOffset
                },
                selectionInEditor: function() {
                    var t = window.getSelection();
                    if (!t.rangeCount)
                        return false;
                    var e = t.getRangeAt(0).commonAncestorContainer;
                    return _r(this.div, e)
                },
                focus: function() {
                    if (this.cm.options.readOnly != "nocursor")
                        this.div.focus()
                },
                blur: function() {
                    this.div.blur()
                },
                getField: function() {
                    return this.div
                },
                supportsTouch: function() {
                    return true
                },
                receivedFocus: function() {
                    var t = this;
                    if (this.selectionInEditor())
                        this.pollSelection();
                    else
                        ni(this.cm, function() {
                            t.cm.curOp.selectionChanged = true
                        });
                    function e() {
                        if (t.cm.state.focused) {
                            t.pollSelection();
                            t.polling.set(t.cm.options.pollInterval, e)
                        }
                    }
                    this.polling.set(this.cm.options.pollInterval, e)
                },
                selectionChanged: function() {
                    var t = window.getSelection();
                    return t.anchorNode != this.lastAnchorNode || t.anchorOffset != this.lastAnchorOffset || t.focusNode != this.lastFocusNode || t.focusOffset != this.lastFocusOffset
                },
                pollSelection: function() {
                    if (!this.composing && !this.gracePeriod && this.selectionChanged()) {
                        var t = window.getSelection()
                            , e = this.cm;
                        this.rememberSelection();
                        var i = Dt(e, t.anchorNode, t.anchorOffset);
                        var a = Dt(e, t.focusNode, t.focusOffset);
                        if (i && a)
                            ni(e, function() {
                                qt(e.doc, Pt(i, a), js);
                                if (i.bad || a.bad)
                                    e.curOp.selectionChanged = true
                            })
                    }
                },
                pollContent: function() {
                    var t = this.cm
                        , e = t.display
                        , i = t.doc.sel.primary();
                    var a = i.from()
                        , n = i.to();
                    if (a.line < e.viewFrom || n.line > e.viewTo - 1)
                        return false;
                    var s;
                    if (a.line == e.viewFrom || (s = pi(t, a.line)) == 0) {
                        var r = ls(e.view[0].line);
                        var o = e.view[0].node
                    } else {
                        var r = ls(e.view[s].line);
                        var o = e.view[s - 1].node.nextSibling
                    }
                    var l = pi(t, n.line);
                    if (l == e.view.length - 1) {
                        var c = e.viewTo - 1;
                        var d = e.lineDiv.lastChild
                    } else {
                        var c = ls(e.view[l + 1].line) - 1;
                        var d = e.view[l + 1].node.previousSibling
                    }
                    var u = Dr(Ot(t, o, d, r, c));
                    var h = ss(t.doc, ft(r, 0), ft(c, ns(t.doc, c).text.length));
                    while (u.length > 1 && h.length > 1) {
                        if (Zs(u) == Zs(h)) {
                            u.pop();
                            h.pop();
                            c--
                        } else if (u[0] == h[0]) {
                            u.shift();
                            h.shift();
                            r++
                        } else
                            break
                    }
                    var p = 0
                        , f = 0;
                    var m = u[0]
                        , g = h[0]
                        , _ = Math.min(m.length, g.length);
                    while (p < _ && m.charCodeAt(p) == g.charCodeAt(p))
                        ++p;
                    var v = Zs(u)
                        , F = Zs(h);
                    var y = Math.min(v.length - (u.length == 1 ? p : 0), F.length - (h.length == 1 ? p : 0));
                    while (f < y && v.charCodeAt(v.length - f - 1) == F.charCodeAt(F.length - f - 1))
                        ++f;
                    u[u.length - 1] = v.slice(0, v.length - f);
                    u[0] = u[0].slice(p);
                    var b = ft(r, p);
                    var T = ft(c, h.length ? Zs(h).length - f : 0);
                    if (u.length > 1 || u[0] || mt(b, T)) {
                        ua(t.doc, u, b, T, "+input");
                        return true
                    }
                },
                ensurePolled: function() {
                    this.forceCompositionEnd()
                },
                reset: function() {
                    this.forceCompositionEnd()
                },
                forceCompositionEnd: function() {
                    if (!this.composing || this.composing.handled)
                        return;
                    this.applyComposition(this.composing);
                    this.composing.handled = true;
                    this.div.blur();
                    this.div.focus()
                },
                applyComposition: function(t) {
                    if (t.data && t.data != t.startData)
                        si(this.cm, Tt)(this.cm, t.data, 0, t.sel)
                },
                setUneditable: function(t) {
                    t.setAttribute("contenteditable", "false")
                },
                onKeyPress: function(t) {
                    t.preventDefault();
                    si(this.cm, Tt)(this.cm, String.fromCharCode(t.charCode == null ? t.keyCode : t.charCode), 0)
                },
                onContextMenu: ar,
                resetPosition: ar,
                needsContentAttribute: true
            }, St.prototype),
            F.inputStyles = {
                textarea: Xt,
                contenteditable: St
            },
            Nt.prototype = {
                primary: function() {
                    return this.ranges[this.primIndex]
                },
                equals: function(t) {
                    if (t == this)
                        return true;
                    if (t.primIndex != this.primIndex || t.ranges.length != this.ranges.length)
                        return false;
                    for (var e = 0; e < this.ranges.length; e++) {
                        var i = this.ranges[e]
                            , a = t.ranges[e];
                        if (mt(i.anchor, a.anchor) != 0 || mt(i.head, a.head) != 0)
                            return false
                    }
                    return true
                },
                deepCopy: function() {
                    for (var t = [], e = 0; e < this.ranges.length; e++)
                        t[e] = new Lt(gt(this.ranges[e].anchor),gt(this.ranges[e].head));
                    return new Nt(t,this.primIndex)
                },
                somethingSelected: function() {
                    for (var t = 0; t < this.ranges.length; t++)
                        if (!this.ranges[t].empty())
                            return true;
                    return false
                },
                contains: function(t, e) {
                    if (!e)
                        e = t;
                    for (var i = 0; i < this.ranges.length; i++) {
                        var a = this.ranges[i];
                        if (mt(e, a.from()) >= 0 && mt(t, a.to()) <= 0)
                            return i
                    }
                    return -1
                }
            },
            Lt.prototype = {
                from: function() {
                    return vt(this.anchor, this.head)
                },
                to: function() {
                    return _t(this.anchor, this.head)
                },
                empty: function() {
                    return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch
                }
            };
        var we = {
            left: 0,
            right: 0,
            top: 0,
            bottom: 0
        }, Ee;
        function Xe(t, e, i) {
            var a, n, s, r;
            for (var o = 0; o < t.length; o += 3) {
                var l = t[o]
                    , c = t[o + 1];
                if (e < l) {
                    n = 0;
                    s = 1;
                    r = "left"
                } else if (e < c) {
                    n = e - l;
                    s = n + 1
                } else if (o == t.length - 3 || e == c && t[o + 3] > e) {
                    s = c - l;
                    n = s - 1;
                    if (e >= c)
                        r = "right"
                }
                if (n != null) {
                    a = t[o + 2];
                    if (l == c && i == (a.insertLeft ? "left" : "right"))
                        r = i;
                    if (i == "left" && n == 0)
                        while (o && t[o - 2] == t[o - 3] && t[o - 1].insertLeft) {
                            a = t[(o -= 3) + 2];
                            r = "left"
                        }
                    if (i == "right" && n == c - l)
                        while (o < t.length - 3 && t[o + 3] == t[o + 4] && !t[o + 5].insertLeft) {
                            a = t[(o += 3) + 2];
                            r = "right"
                        }
                    break
                }
            }
            return {
                node: a,
                start: n,
                end: s,
                collapse: r,
                coverStart: l,
                coverEnd: c
            }
        }
        function Ie(t, e, i, a) {
            var n = Xe(e.map, i, a);
            var s = n.node
                , r = n.start
                , o = n.end
                , l = n.collapse;
            var c;
            if (s.nodeType == 3) {
                for (var d = 0; d < 4; d++) {
                    while (r && pr(e.line.text.charAt(n.coverStart + r)))
                        --r;
                    while (n.coverStart + o < n.coverEnd && pr(e.line.text.charAt(n.coverStart + o)))
                        ++o;
                    if (y && b < 9 && r == 0 && o == n.coverEnd - n.coverStart) {
                        c = s.parentNode.getBoundingClientRect()
                    } else if (y && t.options.lineWrapping) {
                        var u = hr(s, r, o).getClientRects();
                        if (u.length)
                            c = u[a == "right" ? u.length - 1 : 0];
                        else
                            c = we
                    } else {
                        c = hr(s, r, o).getBoundingClientRect() || we
                    }
                    if (c.left || c.right || r == 0)
                        break;
                    o = r;
                    r = r - 1;
                    l = "right"
                }
                if (y && b < 11)
                    c = Se(t.display.measure, c)
            } else {
                if (r > 0)
                    l = a = "right";
                var u;
                if (t.options.lineWrapping && (u = s.getClientRects()).length > 1)
                    c = u[a == "right" ? u.length - 1 : 0];
                else
                    c = s.getBoundingClientRect()
            }
            if (y && b < 9 && !r && (!c || !c.left && !c.right)) {
                var h = s.parentNode.getClientRects()[0];
                if (h)
                    c = {
                        left: h.left,
                        right: h.left + Be(t.display),
                        top: h.top,
                        bottom: h.bottom
                    };
                else
                    c = we
            }
            var p = c.top - e.rect.top
                , f = c.bottom - e.rect.top;
            var m = (p + f) / 2;
            var g = e.view.measure.heights;
            for (var d = 0; d < g.length - 1; d++)
                if (m < g[d])
                    break;
            var _ = d ? g[d - 1] : 0
                , v = g[d];
            var F = {
                left: (l == "right" ? c.right : c.left) - e.rect.left,
                right: (l == "left" ? c.left : c.right) - e.rect.left,
                top: _,
                bottom: v
            };
            if (!c.left && !c.right)
                F.bogus = true;
            if (!t.options.singleCursorHeightPerLine) {
                F.rtop = p;
                F.rbottom = f
            }
            return F
        }
        function Se(t, e) {
            if (!window.screen || screen.logicalXDPI == null || screen.logicalXDPI == screen.deviceXDPI || !Lr(t))
                return e;
            var i = screen.logicalXDPI / screen.deviceXDPI;
            var a = screen.logicalYDPI / screen.deviceYDPI;
            return {
                left: e.left * i,
                right: e.right * i,
                top: e.top * a,
                bottom: e.bottom * a
            }
        }
        function ke(t) {
            if (t.measure) {
                t.measure.cache = {};
                t.measure.heights = null;
                if (t.rest)
                    for (var e = 0; e < t.rest.length; e++)
                        t.measure.caches[e] = {}
            }
        }
        function Ue(t) {
            t.display.externalMeasure = null;
            mr(t.display.lineMeasure);
            for (var e = 0; e < t.display.view.length; e++)
                ke(t.display.view[e])
        }
        function De(t) {
            Ue(t);
            t.display.cachedCharWidth = t.display.cachedTextHeight = t.display.cachedPaddingH = null;
            if (!t.options.lineWrapping)
                t.display.maxLineChanged = true;
            t.display.lineNumChars = null
        }
        function Ae() {
            return window.pageXOffset || (document.documentElement || document.body).scrollLeft
        }
        function Oe() {
            return window.pageYOffset || (document.documentElement || document.body).scrollTop
        }
        function Ne(t, e, i, a) {
            if (e.widgets)
                for (var n = 0; n < e.widgets.length; ++n)
                    if (e.widgets[n].above) {
                        var s = wn(e.widgets[n]);
                        i.top += s;
                        i.bottom += s
                    }
            if (a == "line")
                return i;
            if (!a)
                a = "local";
            var r = ds(e);
            if (a == "local")
                r += he(t.display);
            else
                r -= t.display.viewOffset;
            if (a == "page" || a == "window") {
                var o = t.display.lineSpace.getBoundingClientRect();
                r += o.top + (a == "window" ? 0 : Oe());
                var l = o.left + (a == "window" ? 0 : Ae());
                i.left += l;
                i.right += l
            }
            i.top += r;
            i.bottom += r;
            return i
        }
        function Le(t, e, i) {
            if (i == "div")
                return e;
            var a = e.left
                , n = e.top;
            if (i == "page") {
                a -= Ae();
                n -= Oe()
            } else if (i == "local" || !i) {
                var s = t.display.sizer.getBoundingClientRect();
                a += s.left;
                n += s.top
            }
            var r = t.display.lineSpace.getBoundingClientRect();
            return {
                left: a - r.left,
                top: n - r.top
            }
        }
        function Me(t, e, i, a, n) {
            if (!a)
                a = ns(t.doc, e.line);
            return Ne(t, a, be(t, a, e.ch, n), i)
        }
        function Pe(a, t, n, s, r, o) {
            s = s || ns(a.doc, t.line);
            if (!r)
                r = Ce(a, s);
            function l(t, e) {
                var i = xe(a, r, t, e ? "right" : "left", o);
                if (e)
                    i.left = i.right;
                else
                    i.right = i.left;
                return Ne(a, s, i, n)
            }
            function e(t, e) {
                var i = c[e]
                    , a = i.level % 2;
                if (t == Vr(i) && e && i.level < c[e - 1].level) {
                    i = c[--e];
                    t = $r(i) - (i.level % 2 ? 0 : 1);
                    a = true
                } else if (t == $r(i) && e < c.length - 1 && i.level < c[e + 1].level) {
                    i = c[++e];
                    t = Vr(i) - i.level % 2;
                    a = false
                }
                if (a && t == i.to && t > i.from)
                    return l(t - 1);
                return l(t, a)
            }
            var c = us(s)
                , i = t.ch;
            if (!c)
                return l(i);
            var d = Yr(c, i);
            var u = e(i, d);
            if (Pr != null)
                u.other = e(i, Pr);
            return u
        }
        function Re(t, e) {
            var i = 0
                , e = Vt(t.doc, e);
            if (!t.options.lineWrapping)
                i = Be(t.display) * e.ch;
            var a = ns(t.doc, e.line);
            var n = ds(a) + he(t.display);
            return {
                left: i,
                right: i,
                top: n,
                bottom: n + a.height
            }
        }
        function Ve(t, e, i, a) {
            var n = ft(t, e);
            n.xRel = a;
            if (i)
                n.outside = true;
            return n
        }
        function $e(t, e, i) {
            var a = t.doc;
            i += t.display.viewOffset;
            if (i < 0)
                return Ve(a.first, 0, true, -1);
            var n = cs(a, i)
                , s = a.first + a.size - 1;
            if (n > s)
                return Ve(a.first + a.size - 1, ns(a, s).text.length, true, 1);
            if (e < 0)
                e = 0;
            var r = ns(a, n);
            for (; ; ) {
                var o = He(t, r, n, e, i);
                var l = mn(r);
                var c = l && l.find(0, true);
                if (l && (o.ch > c.from.ch || o.ch == c.from.ch && o.xRel > 0))
                    n = ls(r = c.to.line);
                else
                    return o
            }
        }
        function He(i, a, n, t, e) {
            var s = e - ds(a);
            var r = false
                , o = 2 * i.display.wrapper.clientWidth;
            var l = Ce(i, a);
            function c(t) {
                var e = Pe(i, ft(n, t), "line", a, l);
                r = true;
                if (s > e.bottom)
                    return e.left - o;
                else if (s < e.top)
                    return e.left + o;
                else
                    r = false;
                return e.left
            }
            var d = us(a)
                , u = a.text.length;
            var h = Hr(a)
                , p = Wr(a);
            var f = c(h)
                , m = r
                , g = c(p)
                , _ = r;
            if (t > g)
                return Ve(n, p, _, 1);
            for (; ; ) {
                if (d ? p == h || p == Qr(a, h, 1) : p - h <= 1) {
                    var v = t < f || t - f <= g - t ? h : p;
                    var F = t - (v == h ? f : g);
                    while (pr(a.text.charAt(v)))
                        ++v;
                    var y = Ve(n, v, v == h ? m : _, F < -1 ? -1 : F > 1 ? 1 : 0);
                    return y
                }
                var b = Math.ceil(u / 2)
                    , T = h + b;
                if (d) {
                    T = h;
                    for (var C = 0; C < b; ++C)
                        T = Qr(a, T, 1)
                }
                var x = c(T);
                if (x > t) {
                    p = T;
                    g = x;
                    if (_ = r)
                        g += 1e3;
                    u = b
                } else {
                    h = T;
                    f = x;
                    m = r;
                    u -= b
                }
            }
        }
        function We(t) {
            if (t.cachedTextHeight != null)
                return t.cachedTextHeight;
            if (Ee == null) {
                Ee = fr("pre");
                for (var e = 0; e < 49; ++e) {
                    Ee.appendChild(document.createTextNode("x"));
                    Ee.appendChild(fr("br"))
                }
                Ee.appendChild(document.createTextNode("x"))
            }
            gr(t.measure, Ee);
            var i = Ee.offsetHeight / 50;
            if (i > 3)
                t.cachedTextHeight = i;
            mr(t.measure);
            return i || 1
        }
        function Be(t) {
            if (t.cachedCharWidth != null)
                return t.cachedCharWidth;
            var e = fr("span", "xxxxxxxxxx");
            var i = fr("pre", [e]);
            gr(t.measure, i);
            var a = e.getBoundingClientRect()
                , n = (a.right - a.left) / 10;
            if (n > 2)
                t.cachedCharWidth = n;
            return n || 10
        }
        var je = null, Ge = 0, ze, Ye;
        function Ke(t) {
            t.curOp = {
                cm: t,
                viewChanged: false,
                startHeight: t.doc.height,
                forceUpdate: false,
                updateInput: null,
                typing: false,
                changeObjs: null,
                cursorActivityHandlers: null,
                cursorActivityCalled: 0,
                selectionChanged: false,
                updateMaxLine: false,
                scrollLeft: null,
                scrollTop: null,
                scrollToPos: null,
                focus: false,
                id: ++Ge
            };
            if (je) {
                je.ops.push(t.curOp)
            } else {
                t.curOp.ownsGroup = je = {
                    ops: [t.curOp],
                    delayedCallbacks: []
                }
            }
        }
        function Qe(t) {
            var e = t.delayedCallbacks
                , i = 0;
            do {
                for (; i < e.length; i++)
                    e[i]();
                for (var a = 0; a < t.ops.length; a++) {
                    var n = t.ops[a];
                    if (n.cursorActivityHandlers)
                        while (n.cursorActivityCalled < n.cursorActivityHandlers.length)
                            n.cursorActivityHandlers[n.cursorActivityCalled++](n.cm)
                }
            } while (i < e.length)
        }
        function qe(t) {
            var e = t.curOp
                , i = e.ownsGroup;
            if (!i)
                return;
            try {
                Qe(i)
            } finally {
                je = null;
                for (var a = 0; a < i.ops.length; a++)
                    i.ops[a].cm.curOp = null;
                Je(i)
            }
        }
        function Je(t) {
            var e = t.ops;
            for (var i = 0; i < e.length; i++)
                Ze(e[i]);
            for (var i = 0; i < e.length; i++)
                ti(e[i]);
            for (var i = 0; i < e.length; i++)
                ei(e[i]);
            for (var i = 0; i < e.length; i++)
                ii(e[i]);
            for (var i = 0; i < e.length; i++)
                ai(e[i])
        }
        function Ze(t) {
            var e = t.cm
                , i = e.display;
            z(e);
            if (t.updateMaxLine)
                A(e);
            t.mustUpdate = t.viewChanged || t.forceUpdate || t.scrollTop != null || t.scrollToPos && (t.scrollToPos.from.line < i.viewFrom || t.scrollToPos.to.line >= i.viewTo) || i.maxLineChanged && e.options.lineWrapping;
            t.update = t.mustUpdate && new G(e,t.mustUpdate && {
                top: t.scrollTop,
                ensure: t.scrollToPos
            },t.forceUpdate)
        }
        function ti(t) {
            t.updatedDisplay = t.mustUpdate && Y(t.cm, t.update)
        }
        function ei(t) {
            var e = t.cm
                , i = e.display;
            if (t.updatedDisplay)
                J(e);
            t.barMeasure = N(e);
            if (i.maxLineChanged && !e.options.lineWrapping) {
                t.adjustWidthTo = be(e, i.maxLine, i.maxLine.text.length).left + 3;
                e.display.sizerWidth = t.adjustWidthTo;
                t.barMeasure.scrollWidth = Math.max(i.scroller.clientWidth, i.sizer.offsetLeft + t.adjustWidthTo + me(e) + e.display.barWidth);
                t.maxScrollLeft = Math.max(0, i.sizer.offsetLeft + t.adjustWidthTo - ge(e))
            }
            if (t.updatedDisplay || t.selectionChanged)
                t.preparedSelection = i.input.prepareSelection()
        }
        function ii(t) {
            var e = t.cm;
            if (t.adjustWidthTo != null) {
                e.display.sizer.style.minWidth = t.adjustWidthTo + "px";
                if (t.maxScrollLeft < e.doc.scrollLeft)
                    Di(e, Math.min(e.display.scroller.scrollLeft, t.maxScrollLeft), true);
                e.display.maxLineChanged = false
            }
            if (t.preparedSelection)
                e.display.input.showSelection(t.preparedSelection);
            if (t.updatedDisplay)
                q(e, t.barMeasure);
            if (t.updatedDisplay || t.startHeight != e.doc.height)
                R(e, t.barMeasure);
            if (t.selectionChanged)
                oe(e);
            if (e.state.focused && t.updateInput)
                e.display.input.reset(t.typing);
            if (t.focus && t.focus == vr())
                Ft(t.cm)
        }
        function ai(t) {
            var e = t.cm
                , i = e.display
                , a = e.doc;
            if (t.updatedDisplay)
                K(e, t.update);
            if (i.wheelStartX != null && (t.scrollTop != null || t.scrollLeft != null || t.scrollToPos))
                i.wheelStartX = i.wheelStartY = null;
            if (t.scrollTop != null && (i.scroller.scrollTop != t.scrollTop || t.forceScroll)) {
                a.scrollTop = Math.max(0, Math.min(i.scroller.scrollHeight - i.scroller.clientHeight, t.scrollTop));
                i.scrollbars.setScrollTop(a.scrollTop);
                i.scroller.scrollTop = a.scrollTop
            }
            if (t.scrollLeft != null && (i.scroller.scrollLeft != t.scrollLeft || t.forceScroll)) {
                a.scrollLeft = Math.max(0, Math.min(i.scroller.scrollWidth - ge(e), t.scrollLeft));
                i.scrollbars.setScrollLeft(a.scrollLeft);
                i.scroller.scrollLeft = a.scrollLeft;
                H(e)
            }
            if (t.scrollToPos) {
                var n = pa(e, Vt(a, t.scrollToPos.from), Vt(a, t.scrollToPos.to), t.scrollToPos.margin);
                if (t.scrollToPos.isCursor && e.state.focused)
                    ha(e, n)
            }
            var s = t.maybeHiddenMarkers
                , r = t.maybeUnhiddenMarkers;
            if (s)
                for (var o = 0; o < s.length; ++o)
                    if (!s[o].lines.length)
                        Ns(s[o], "hide");
            if (r)
                for (var o = 0; o < r.length; ++o)
                    if (r[o].lines.length)
                        Ns(r[o], "unhide");
            if (i.wrapper.offsetHeight)
                a.scrollTop = e.display.scroller.scrollTop;
            if (t.changeObjs)
                Ns(e, "changes", e, t.changeObjs);
            if (t.update)
                t.update.finish()
        }
        function ni(t, e) {
            if (t.curOp)
                return e();
            Ke(t);
            try {
                return e()
            } finally {
                qe(t)
            }
        }
        function si(t, e) {
            return function() {
                if (t.curOp)
                    return e.apply(t, arguments);
                Ke(t);
                try {
                    return e.apply(t, arguments)
                } finally {
                    qe(t)
                }
            }
        }
        function ri(t) {
            return function() {
                if (this.curOp)
                    return t.apply(this, arguments);
                Ke(this);
                try {
                    return t.apply(this, arguments)
                } finally {
                    qe(this)
                }
            }
        }
        function oi(e) {
            return function() {
                var t = this.cm;
                if (!t || t.curOp)
                    return e.apply(this, arguments);
                Ke(t);
                try {
                    return e.apply(this, arguments)
                } finally {
                    qe(t)
                }
            }
        }
        function li(t, e, i) {
            this.line = e;
            this.rest = vn(e);
            this.size = this.rest ? ls(Zs(this.rest)) - i + 1 : 1;
            this.node = this.text = null;
            this.hidden = bn(t, e)
        }
        function ci(t, e, i) {
            var a = [], n;
            for (var s = e; s < i; s = n) {
                var r = new li(t.doc,ns(t.doc, s),s);
                n = s + r.size;
                a.push(r)
            }
            return a
        }
        function di(t, e, i, a) {
            if (e == null)
                e = t.doc.first;
            if (i == null)
                i = t.doc.first + t.doc.size;
            if (!a)
                a = 0;
            var n = t.display;
            if (a && i < n.viewTo && (n.updateLineNumbers == null || n.updateLineNumbers > e))
                n.updateLineNumbers = e;
            t.curOp.viewChanged = true;
            if (e >= n.viewTo) {
                if (v && Fn(t.doc, e) < n.viewTo)
                    hi(t)
            } else if (i <= n.viewFrom) {
                if (v && yn(t.doc, i + a) > n.viewFrom) {
                    hi(t)
                } else {
                    n.viewFrom += a;
                    n.viewTo += a
                }
            } else if (e <= n.viewFrom && i >= n.viewTo) {
                hi(t)
            } else if (e <= n.viewFrom) {
                var s = fi(t, i, i + a, 1);
                if (s) {
                    n.view = n.view.slice(s.index);
                    n.viewFrom = s.lineN;
                    n.viewTo += a
                } else {
                    hi(t)
                }
            } else if (i >= n.viewTo) {
                var s = fi(t, e, e, -1);
                if (s) {
                    n.view = n.view.slice(0, s.index);
                    n.viewTo = s.lineN
                } else {
                    hi(t)
                }
            } else {
                var r = fi(t, e, e, -1);
                var o = fi(t, i, i + a, 1);
                if (r && o) {
                    n.view = n.view.slice(0, r.index).concat(ci(t, r.lineN, o.lineN)).concat(n.view.slice(o.index));
                    n.viewTo += a
                } else {
                    hi(t)
                }
            }
            var l = n.externalMeasured;
            if (l) {
                if (i < l.lineN)
                    l.lineN += a;
                else if (e < l.lineN + l.size)
                    n.externalMeasured = null
            }
        }
        function ui(t, e, i) {
            t.curOp.viewChanged = true;
            var a = t.display
                , n = t.display.externalMeasured;
            if (n && e >= n.lineN && e < n.lineN + n.size)
                a.externalMeasured = null;
            if (e < a.viewFrom || e >= a.viewTo)
                return;
            var s = a.view[pi(t, e)];
            if (s.node == null)
                return;
            var r = s.changes || (s.changes = []);
            if (er(r, i) == -1)
                r.push(i)
        }
        function hi(t) {
            t.display.viewFrom = t.display.viewTo = t.doc.first;
            t.display.view = [];
            t.display.viewOffset = 0
        }
        function pi(t, e) {
            if (e >= t.display.viewTo)
                return null;
            e -= t.display.viewFrom;
            if (e < 0)
                return null;
            var i = t.display.view;
            for (var a = 0; a < i.length; a++) {
                e -= i[a].size;
                if (e < 0)
                    return a
            }
        }
        function fi(t, e, i, a) {
            var n = pi(t, e), s, r = t.display.view;
            if (!v || i == t.doc.first + t.doc.size)
                return {
                    index: n,
                    lineN: i
                };
            for (var o = 0, l = t.display.viewFrom; o < n; o++)
                l += r[o].size;
            if (l != e) {
                if (a > 0) {
                    if (n == r.length - 1)
                        return null;
                    s = l + r[n].size - e;
                    n++
                } else {
                    s = l - e
                }
                e += s;
                i += s
            }
            while (Fn(t.doc, i) != i) {
                if (n == (a < 0 ? 0 : r.length - 1))
                    return null;
                i += a * r[n - (a < 0 ? 1 : 0)].size;
                n += a
            }
            return {
                index: n,
                lineN: i
            }
        }
        function mi(t, e, i) {
            var a = t.display
                , n = a.view;
            if (n.length == 0 || e >= a.viewTo || i <= a.viewFrom) {
                a.view = ci(t, e, i);
                a.viewFrom = e
            } else {
                if (a.viewFrom > e)
                    a.view = ci(t, e, a.viewFrom).concat(a.view);
                else if (a.viewFrom < e)
                    a.view = a.view.slice(pi(t, e));
                a.viewFrom = e;
                if (a.viewTo < i)
                    a.view = a.view.concat(ci(t, a.viewTo, i));
                else if (a.viewTo > i)
                    a.view = a.view.slice(0, pi(t, i))
            }
            a.viewTo = i
        }
        function gi(t) {
            var e = t.display.view
                , i = 0;
            for (var a = 0; a < e.length; a++) {
                var n = e[a];
                if (!n.hidden && (!n.node || n.changes))
                    ++i
            }
            return i
        }
        function _i(n) {
            var s = n.display;
            As(s.scroller, "mousedown", si(n, Ti));
            if (y && b < 11)
                As(s.scroller, "dblclick", si(n, function(t) {
                    if (Rs(n, t))
                        return;
                    var e = bi(n, t);
                    if (!e || Xi(n, t) || yi(n.display, t))
                        return;
                    Xs(t);
                    var i = n.findWordAt(e);
                    jt(n.doc, i.anchor, i.head)
                }));
            else
                As(s.scroller, "dblclick", function(t) {
                    Rs(n, t) || Xs(t)
                });
            if (!_)
                As(s.scroller, "contextmenu", function(t) {
                    qi(n, t)
                });
            var i, a = {
                end: 0
            };
            function r() {
                if (s.activeTouch) {
                    i = setTimeout(function() {
                        s.activeTouch = null
                    }, 1e3);
                    a = s.activeTouch;
                    a.end = +new Date
                }
            }
            function o(t) {
                if (t.touches.length != 1)
                    return false;
                var e = t.touches[0];
                return e.radiusX <= 1 && e.radiusY <= 1
            }
            function l(t, e) {
                if (e.left == null)
                    return true;
                var i = e.left - t.left
                    , a = e.top - t.top;
                return i * i + a * a > 20 * 20
            }
            As(s.scroller, "touchstart", function(t) {
                if (!o(t)) {
                    clearTimeout(i);
                    var e = +new Date;
                    s.activeTouch = {
                        start: e,
                        moved: false,
                        prev: e - a.end <= 300 ? a : null
                    };
                    if (t.touches.length == 1) {
                        s.activeTouch.left = t.touches[0].pageX;
                        s.activeTouch.top = t.touches[0].pageY
                    }
                }
            });
            As(s.scroller, "touchmove", function() {
                if (s.activeTouch)
                    s.activeTouch.moved = true
            });
            As(s.scroller, "touchend", function(t) {
                var e = s.activeTouch;
                if (e && !yi(s, t) && e.left != null && !e.moved && new Date - e.start < 300) {
                    var i = n.coordsChar(s.activeTouch, "page"), a;
                    if (!e.prev || l(e, e.prev))
                        a = new Lt(i,i);
                    else if (!e.prev.prev || l(e, e.prev.prev))
                        a = n.findWordAt(i);
                    else
                        a = new Lt(ft(i.line, 0),Vt(n.doc, ft(i.line + 1, 0)));
                    n.setSelection(a.anchor, a.head);
                    n.focus();
                    Xs(t)
                }
                r()
            });
            As(s.scroller, "touchcancel", r);
            As(s.scroller, "scroll", function() {
                if (s.scroller.clientHeight) {
                    Ui(n, s.scroller.scrollTop);
                    Di(n, s.scroller.scrollLeft, true);
                    Ns(n, "scroll", n)
                }
            });
            As(s.scroller, "mousewheel", function(t) {
                Li(n, t)
            });
            As(s.scroller, "DOMMouseScroll", function(t) {
                Li(n, t)
            });
            As(s.wrapper, "scroll", function() {
                s.wrapper.scrollTop = s.wrapper.scrollLeft = 0
            });
            s.dragFunctions = {
                simple: function(t) {
                    if (!Rs(n, t))
                        ks(t)
                },
                start: function(t) {
                    ki(n, t)
                },
                drop: si(n, Si)
            };
            var t = s.input.getField();
            As(t, "keyup", function(t) {
                Gi.call(n, t)
            });
            As(t, "keydown", si(n, Bi));
            As(t, "keypress", si(n, zi));
            As(t, "focus", rr(Ki, n));
            As(t, "blur", rr(Qi, n))
        }
        function vi(t, e, i) {
            var a = i && i != F.Init;
            if (!e != !a) {
                var n = t.display.dragFunctions;
                var s = e ? As : Os;
                s(t.display.scroller, "dragstart", n.start);
                s(t.display.scroller, "dragenter", n.simple);
                s(t.display.scroller, "dragover", n.simple);
                s(t.display.scroller, "drop", n.drop)
            }
        }
        function Fi(t) {
            var e = t.display;
            if (e.lastWrapHeight == e.wrapper.clientHeight && e.lastWrapWidth == e.wrapper.clientWidth)
                return;
            e.cachedCharWidth = e.cachedTextHeight = e.cachedPaddingH = null;
            e.scrollbarsClipped = false;
            t.setSize()
        }
        function yi(t, e) {
            for (var i = Us(e); i != t.wrapper; i = i.parentNode) {
                if (!i || i.nodeType == 1 && i.getAttribute("cm-ignore-events") == "true" || i.parentNode == t.sizer && i != t.mover)
                    return true
            }
        }
        function bi(t, e, i, a) {
            var n = t.display;
            if (!i && Us(e).getAttribute("cm-not-content") == "true")
                return null;
            var s, r, o = n.lineSpace.getBoundingClientRect();
            try {
                s = e.clientX - o.left;
                r = e.clientY - o.top
            } catch (e) {
                return null
            }
            var l = $e(t, s, r), c;
            if (a && l.xRel == 1 && (c = ns(t.doc, l.line).text).length == l.ch) {
                var d = Ks(c, c.length, t.options.tabSize) - c.length;
                l = ft(l.line, Math.max(0, Math.round((s - fe(t.display).left) / Be(t.display)) - d))
            }
            return l
        }
        function Ti(t) {
            var e = this
                , i = e.display;
            if (i.activeTouch && i.input.supportsTouch() || Rs(e, t))
                return;
            i.shift = t.shiftKey;
            if (yi(i, t)) {
                if (!f) {
                    i.scroller.draggable = false;
                    setTimeout(function() {
                        i.scroller.draggable = true
                    }, 100)
                }
                return
            }
            if (Xi(e, t))
                return;
            var a = bi(e, t);
            window.focus();
            switch (Ds(t)) {
                case 1:
                    if (a)
                        Ci(e, t, a);
                    else if (Us(t) == i.scroller)
                        Xs(t);
                    break;
                case 2:
                    if (f)
                        e.state.lastMiddleDown = +new Date;
                    if (a)
                        jt(e.doc, a);
                    setTimeout(function() {
                        i.input.focus()
                    }, 20);
                    Xs(t);
                    break;
                case 3:
                    if (_)
                        qi(e, t);
                    else
                        Yi(e);
                    break
            }
        }
        function Ci(t, e, i) {
            if (y)
                setTimeout(rr(Ft, t), 0);
            else
                t.curOp.focus = vr();
            var a = +new Date, n;
            if (Ye && Ye.time > a - 400 && mt(Ye.pos, i) == 0) {
                n = "triple"
            } else if (ze && ze.time > a - 400 && mt(ze.pos, i) == 0) {
                n = "double";
                Ye = {
                    time: a,
                    pos: i
                }
            } else {
                n = "single";
                ze = {
                    time: a,
                    pos: i
                }
            }
            var s = t.doc.sel, r = g ? e.metaKey : e.ctrlKey, o;
            if (t.options.dragDrop && Xr && !yt(t) && n == "single" && (o = s.contains(i)) > -1 && (mt((o = s.ranges[o]).from(), i) < 0 || i.xRel > 0) && (mt(o.to(), i) > 0 || i.xRel < 0))
                xi(t, e, i, r);
            else
                wi(t, e, i, n, r)
        }
        function xi(e, i, a, n) {
            var s = e.display
                , r = +new Date;
            var o = si(e, function(t) {
                if (f)
                    s.scroller.draggable = false;
                e.state.draggingText = false;
                Os(document, "mouseup", o);
                Os(s.scroller, "drop", o);
                if (Math.abs(i.clientX - t.clientX) + Math.abs(i.clientY - t.clientY) < 10) {
                    Xs(t);
                    if (!n && +new Date - 200 < r)
                        jt(e.doc, a);
                    if (f || y && b == 9)
                        setTimeout(function() {
                            document.body.focus();
                            s.input.focus()
                        }, 20);
                    else
                        s.input.focus()
                }
            });
            if (f)
                s.scroller.draggable = true;
            e.state.draggingText = o;
            if (s.scroller.dragDrop)
                s.scroller.dragDrop();
            As(document, "mouseup", o);
            As(s.scroller, "drop", o)
        }
        function wi(m, t, g, _, e) {
            var s = m.display
                , v = m.doc;
            Xs(t);
            var F, y, b = v.sel, i = b.ranges;
            if (e && !t.shiftKey) {
                y = v.sel.contains(g);
                if (y > -1)
                    F = i[y];
                else
                    F = new Lt(g,g)
            } else {
                F = v.sel.primary();
                y = v.sel.primIndex
            }
            if (t.altKey) {
                _ = "rect";
                if (!e)
                    F = new Lt(g,g);
                g = bi(m, t, true, true);
                y = -1
            } else if (_ == "double") {
                var a = m.findWordAt(g);
                if (m.display.shift || v.extend)
                    F = Bt(v, F, a.anchor, a.head);
                else
                    F = a
            } else if (_ == "triple") {
                var n = new Lt(ft(g.line, 0),Vt(v, ft(g.line + 1, 0)));
                if (m.display.shift || v.extend)
                    F = Bt(v, F, n.anchor, n.head);
                else
                    F = n
            } else {
                F = Bt(v, F, g)
            }
            if (!e) {
                y = 0;
                qt(v, new Nt([F],0), Gs);
                b = v.sel
            } else if (y == -1) {
                y = i.length;
                qt(v, Mt(i.concat([F]), y), {
                    scroll: false,
                    origin: "*mouse"
                })
            } else if (i.length > 1 && i[y].empty() && _ == "single" && !t.shiftKey) {
                qt(v, Mt(i.slice(0, y).concat(i.slice(y + 1)), 0));
                b = v.sel
            } else {
                zt(v, y, F, Gs)
            }
            var T = g;
            function r(t) {
                if (mt(T, t) == 0)
                    return;
                T = t;
                if (_ == "rect") {
                    var e = []
                        , i = m.options.tabSize;
                    var a = Ks(ns(v, g.line).text, g.ch, i);
                    var n = Ks(ns(v, t.line).text, t.ch, i);
                    var s = Math.min(a, n)
                        , r = Math.max(a, n);
                    for (var o = Math.min(g.line, t.line), l = Math.min(m.lastLine(), Math.max(g.line, t.line)); o <= l; o++) {
                        var c = ns(v, o).text
                            , d = Qs(c, s, i);
                        if (s == r)
                            e.push(new Lt(ft(o, d),ft(o, d)));
                        else if (c.length > d)
                            e.push(new Lt(ft(o, d),ft(o, Qs(c, r, i))))
                    }
                    if (!e.length)
                        e.push(new Lt(g,g));
                    qt(v, Mt(b.ranges.slice(0, y).concat(e), y), {
                        origin: "*mouse",
                        scroll: false
                    });
                    m.scrollIntoView(t)
                } else {
                    var u = F;
                    var h = u.anchor
                        , p = t;
                    if (_ != "single") {
                        if (_ == "double")
                            var f = m.findWordAt(t);
                        else
                            var f = new Lt(ft(t.line, 0),Vt(v, ft(t.line + 1, 0)));
                        if (mt(f.anchor, h) > 0) {
                            p = f.head;
                            h = vt(u.from(), f.anchor)
                        } else {
                            p = f.anchor;
                            h = _t(u.to(), f.head)
                        }
                    }
                    var e = b.ranges.slice(0);
                    e[y] = new Lt(Vt(v, h),p);
                    qt(v, Mt(e, y), Gs)
                }
            }
            var o = s.wrapper.getBoundingClientRect();
            var l = 0;
            function c(t) {
                var e = ++l;
                var i = bi(m, t, true, _ == "rect");
                if (!i)
                    return;
                if (mt(i, T) != 0) {
                    m.curOp.focus = vr();
                    r(i);
                    var a = $(s, v);
                    if (i.line >= a.to || i.line < a.from)
                        setTimeout(si(m, function() {
                            if (l == e)
                                c(t)
                        }), 150)
                } else {
                    var n = t.clientY < o.top ? -20 : t.clientY > o.bottom ? 20 : 0;
                    if (n)
                        setTimeout(si(m, function() {
                            if (l != e)
                                return;
                            s.scroller.scrollTop += n;
                            c(t)
                        }), 50)
                }
            }
            function d(t) {
                l = Infinity;
                Xs(t);
                s.input.focus();
                Os(document, "mousemove", u);
                Os(document, "mouseup", h);
                v.history.lastSelOrigin = null
            }
            var u = si(m, function(t) {
                if (!Ds(t))
                    d(t);
                else
                    c(t)
            });
            var h = si(m, d);
            As(document, "mousemove", u);
            As(document, "mouseup", h)
        }
        function Ei(t, e, i, a, n) {
            try {
                var s = e.clientX
                    , r = e.clientY
            } catch (e) {
                return false
            }
            if (s >= Math.floor(t.display.gutters.getBoundingClientRect().right))
                return false;
            if (a)
                Xs(e);
            var o = t.display;
            var l = o.lineDiv.getBoundingClientRect();
            if (r > l.bottom || !$s(t, i))
                return Ss(e);
            r -= l.top - o.viewOffset;
            for (var c = 0; c < t.options.gutters.length; ++c) {
                var d = o.gutters.childNodes[c];
                if (d && d.getBoundingClientRect().right >= s) {
                    var u = cs(t.doc, r);
                    var h = t.options.gutters[c];
                    n(t, i, t, u, h, e);
                    return Ss(e)
                }
            }
        }
        function Xi(t, e) {
            return Ei(t, e, "gutterClick", true, Ms)
        }
        var Ii = 0;
        function Si(t) {
            var a = this;
            if (Rs(a, t) || yi(a.display, t))
                return;
            Xs(t);
            if (y)
                Ii = +new Date;
            var n = bi(a, t, true)
                , e = t.dataTransfer.files;
            if (!n || yt(a))
                return;
            if (e && e.length && window.FileReader && window.File) {
                var s = e.length
                    , r = Array(s)
                    , o = 0;
                var i = function(t, e) {
                    var i = new FileReader;
                    i.onload = si(a, function() {
                        r[e] = i.result;
                        if (++o == s) {
                            n = Vt(a.doc, n);
                            var t = {
                                from: n,
                                to: n,
                                text: Dr(r.join("\n")),
                                origin: "paste"
                            };
                            sa(a.doc, t);
                            Qt(a.doc, Pt(n, Zi(t)))
                        }
                    });
                    i.readAsText(t)
                };
                for (var l = 0; l < s; ++l)
                    i(e[l], l)
            } else {
                if (a.state.draggingText && a.doc.sel.contains(n) > -1) {
                    a.state.draggingText(t);
                    setTimeout(function() {
                        a.display.input.focus()
                    }, 20);
                    return
                }
                try {
                    var r = t.dataTransfer.getData("Text");
                    if (r) {
                        if (a.state.draggingText && !(g ? t.altKey : t.ctrlKey))
                            var c = a.listSelections();
                        Jt(a.doc, Pt(n, n));
                        if (c)
                            for (var l = 0; l < c.length; ++l)
                                ua(a.doc, "", c[l].anchor, c[l].head, "drag");
                        a.replaceSelection(r, "around", "paste");
                        a.display.input.focus()
                    }
                } catch (t) {}
            }
        }
        function ki(t, e) {
            if (y && (!t.state.draggingText || +new Date - Ii < 100)) {
                ks(e);
                return
            }
            if (Rs(t, e) || yi(t.display, e))
                return;
            e.dataTransfer.setData("Text", t.getSelection());
            if (e.dataTransfer.setDragImage && !n) {
                var i = fr("img", null, null, "position: fixed; left: 0; top: 0;");
                i.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
                if (m) {
                    i.width = i.height = 1;
                    t.display.wrapper.appendChild(i);
                    i._top = i.offsetTop
                }
                e.dataTransfer.setDragImage(i, 0, 0);
                if (m)
                    i.parentNode.removeChild(i)
            }
        }
        function Ui(t, e) {
            if (Math.abs(t.doc.scrollTop - e) < 2)
                return;
            t.doc.scrollTop = e;
            if (!p)
                Q(t, {
                    top: e
                });
            if (t.display.scroller.scrollTop != e)
                t.display.scroller.scrollTop = e;
            t.display.scrollbars.setScrollTop(e);
            if (p)
                Q(t);
            le(t, 100)
        }
        function Di(t, e, i) {
            if (i ? e == t.doc.scrollLeft : Math.abs(t.doc.scrollLeft - e) < 2)
                return;
            e = Math.min(e, t.display.scroller.scrollWidth - t.display.scroller.clientWidth);
            t.doc.scrollLeft = e;
            H(t);
            if (t.display.scroller.scrollLeft != e)
                t.display.scroller.scrollLeft = e;
            t.display.scrollbars.setScrollLeft(e)
        }
        var Ai = 0
            , Oi = null;
        if (y)
            Oi = -.53;
        else if (p)
            Oi = 15;
        else if (a)
            Oi = -.7;
        else if (n)
            Oi = -1 / 3;
        var Ni = function(t) {
            var e = t.wheelDeltaX
                , i = t.wheelDeltaY;
            if (e == null && t.detail && t.axis == t.HORIZONTAL_AXIS)
                e = t.detail;
            if (i == null && t.detail && t.axis == t.VERTICAL_AXIS)
                i = t.detail;
            else if (i == null)
                i = t.wheelDelta;
            return {
                x: e,
                y: i
            }
        };
        function Li(t, e) {
            var i = Ni(e)
                , a = i.x
                , n = i.y;
            var s = t.display
                , r = s.scroller;
            if (!(a && r.scrollWidth > r.clientWidth || n && r.scrollHeight > r.clientHeight))
                return;
            if (n && g && f) {
                t: for (var o = e.target, l = s.view; o != r; o = o.parentNode) {
                    for (var c = 0; c < l.length; c++) {
                        if (l[c].node == o) {
                            t.display.currentWheelTarget = o;
                            break t
                        }
                    }
                }
            }
            if (a && !p && !m && Oi != null) {
                if (n)
                    Ui(t, Math.max(0, Math.min(r.scrollTop + n * Oi, r.scrollHeight - r.clientHeight)));
                Di(t, Math.max(0, Math.min(r.scrollLeft + a * Oi, r.scrollWidth - r.clientWidth)));
                Xs(e);
                s.wheelStartX = null;
                return
            }
            if (n && Oi != null) {
                var d = n * Oi;
                var u = t.doc.scrollTop
                    , h = u + s.wrapper.clientHeight;
                if (d < 0)
                    u = Math.max(0, u + d - 50);
                else
                    h = Math.min(t.doc.height, h + d + 50);
                Q(t, {
                    top: u,
                    bottom: h
                })
            }
            if (Ai < 20) {
                if (s.wheelStartX == null) {
                    s.wheelStartX = r.scrollLeft;
                    s.wheelStartY = r.scrollTop;
                    s.wheelDX = a;
                    s.wheelDY = n;
                    setTimeout(function() {
                        if (s.wheelStartX == null)
                            return;
                        var t = r.scrollLeft - s.wheelStartX;
                        var e = r.scrollTop - s.wheelStartY;
                        var i = e && s.wheelDY && e / s.wheelDY || t && s.wheelDX && t / s.wheelDX;
                        s.wheelStartX = s.wheelStartY = null;
                        if (!i)
                            return;
                        Oi = (Oi * Ai + i) / (Ai + 1);
                        ++Ai
                    }, 200)
                } else {
                    s.wheelDX += a;
                    s.wheelDY += n
                }
            }
        }
        function Mi(t, e, i) {
            if (typeof e == "string") {
                e = Na[e];
                if (!e)
                    return false
            }
            t.display.input.ensurePolled();
            var a = t.display.shift
                , n = false;
            try {
                if (yt(t))
                    t.state.suppressEdits = true;
                if (i)
                    t.display.shift = false;
                n = e(t) != Bs
            } finally {
                t.display.shift = a;
                t.state.suppressEdits = false
            }
            return n
        }
        function Pi(t, e, i) {
            for (var a = 0; a < t.state.keyMaps.length; a++) {
                var n = Pa(e, t.state.keyMaps[a], i, t);
                if (n)
                    return n
            }
            return t.options.extraKeys && Pa(e, t.options.extraKeys, i, t) || Pa(e, t.options.keyMap, i, t)
        }
        F.wheelEventPixels = function(t) {
            var e = Ni(t);
            e.x *= Oi;
            e.y *= Oi;
            return e
        }
        ;
        var Ri = new Ys;
        function Vi(t, e, i, a) {
            var n = t.state.keySeq;
            if (n) {
                if (Ra(e))
                    return "handled";
                Ri.set(50, function() {
                    if (t.state.keySeq == n) {
                        t.state.keySeq = null;
                        t.display.input.reset()
                    }
                });
                e = n + " " + e
            }
            var s = Pi(t, e, a);
            if (s == "multi")
                t.state.keySeq = e;
            if (s == "handled")
                Ms(t, "keyHandled", t, e, i);
            if (s == "handled" || s == "multi") {
                Xs(i);
                oe(t)
            }
            if (n && !s && /\'$/.test(e)) {
                Xs(i);
                return true
            }
            return !!s
        }
        function $i(e, t) {
            var i = Va(t, true);
            if (!i)
                return false;
            if (t.shiftKey && !e.state.keySeq) {
                return Vi(e, "Shift-" + i, t, function(t) {
                    return Mi(e, t, true)
                }) || Vi(e, i, t, function(t) {
                    if (typeof t == "string" ? /^go[A-Z]/.test(t) : t.motion)
                        return Mi(e, t)
                })
            } else {
                return Vi(e, i, t, function(t) {
                    return Mi(e, t)
                })
            }
        }
        function Hi(e, t, i) {
            return Vi(e, "'" + i + "'", t, function(t) {
                return Mi(e, t, true)
            })
        }
        var Wi = null;
        function Bi(t) {
            var e = this;
            e.curOp.focus = vr();
            if (Rs(e, t))
                return;
            if (y && b < 11 && t.keyCode == 27)
                t.returnValue = false;
            var i = t.keyCode;
            e.display.shift = i == 16 || t.shiftKey;
            var a = $i(e, t);
            if (m) {
                Wi = a ? i : null;
                if (!a && i == 88 && !Or && (g ? t.metaKey : t.ctrlKey))
                    e.replaceSelection("", null, "cut")
            }
            if (i == 18 && !/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className))
                ji(e)
        }
        function ji(t) {
            var e = t.display.lineDiv;
            br(e, "CodeMirror-crosshair");
            function i(t) {
                if (t.keyCode == 18 || !t.altKey) {
                    yr(e, "CodeMirror-crosshair");
                    Os(document, "keyup", i);
                    Os(document, "mouseover", i)
                }
            }
            As(document, "keyup", i);
            As(document, "mouseover", i)
        }
        function Gi(t) {
            if (t.keyCode == 16)
                this.doc.sel.shift = false;
            Rs(this, t)
        }
        function zi(t) {
            var e = this;
            if (yi(e.display, t) || Rs(e, t) || t.ctrlKey && !t.altKey || g && t.metaKey)
                return;
            var i = t.keyCode
                , a = t.charCode;
            if (m && i == Wi) {
                Wi = null;
                Xs(t);
                return
            }
            if (m && (!t.which || t.which < 10) && $i(e, t))
                return;
            var n = String.fromCharCode(a == null ? i : a);
            if (Hi(e, t, n))
                return;
            e.display.input.onKeyPress(t)
        }
        function Yi(t) {
            t.state.delayingBlurEvent = true;
            setTimeout(function() {
                if (t.state.delayingBlurEvent) {
                    t.state.delayingBlurEvent = false;
                    Qi(t)
                }
            }, 100)
        }
        function Ki(t) {
            if (t.state.delayingBlurEvent)
                t.state.delayingBlurEvent = false;
            if (t.options.readOnly == "nocursor")
                return;
            if (!t.state.focused) {
                Ns(t, "focus", t);
                t.state.focused = true;
                br(t.display.wrapper, "CodeMirror-focused");
                if (!t.curOp && t.display.selForContextMenu != t.doc.sel) {
                    t.display.input.reset();
                    if (f)
                        setTimeout(function() {
                            t.display.input.reset(true)
                        }, 20)
                }
                t.display.input.receivedFocus()
            }
            oe(t)
        }
        function Qi(t) {
            if (t.state.delayingBlurEvent)
                return;
            if (t.state.focused) {
                Ns(t, "blur", t);
                t.state.focused = false;
                yr(t.display.wrapper, "CodeMirror-focused")
            }
            clearInterval(t.display.blinker);
            setTimeout(function() {
                if (!t.state.focused)
                    t.display.shift = false
            }, 150)
        }
        function qi(t, e) {
            if (yi(t.display, e) || Ji(t, e))
                return;
            t.display.input.onContextMenu(e)
        }
        function Ji(t, e) {
            if (!$s(t, "gutterContextMenu"))
                return false;
            return Ei(t, e, "gutterContextMenu", false, Ns)
        }
        var Zi = F.changeEnd = function(t) {
                if (!t.text)
                    return t.to;
                return ft(t.from.line + t.text.length - 1, Zs(t.text).length + (t.text.length == 1 ? t.from.ch : 0))
            }
        ;
        function ta(t, e) {
            if (mt(t, e.from) < 0)
                return t;
            if (mt(t, e.to) <= 0)
                return Zi(e);
            var i = t.line + e.text.length - (e.to.line - e.from.line) - 1
                , a = t.ch;
            if (t.line == e.to.line)
                a += Zi(e).ch - e.to.ch;
            return ft(i, a)
        }
        function ea(t, e) {
            var i = [];
            for (var a = 0; a < t.sel.ranges.length; a++) {
                var n = t.sel.ranges[a];
                i.push(new Lt(ta(n.anchor, e),ta(n.head, e)))
            }
            return Mt(i, t.sel.primIndex)
        }
        function ia(t, e, i) {
            if (t.line == e.line)
                return ft(i.line, t.ch - e.ch + i.ch);
            else
                return ft(i.line + (t.line - e.line), t.ch)
        }
        function aa(t, e, i) {
            var a = [];
            var n = ft(t.first, 0)
                , s = n;
            for (var r = 0; r < e.length; r++) {
                var o = e[r];
                var l = ia(o.from, n, s);
                var c = ia(Zi(o), n, s);
                n = o.to;
                s = c;
                if (i == "around") {
                    var d = t.sel.ranges[r]
                        , u = mt(d.head, d.anchor) < 0;
                    a[r] = new Lt(u ? c : l,u ? l : c)
                } else {
                    a[r] = new Lt(l,l)
                }
            }
            return new Nt(a,t.sel.primIndex)
        }
        function na(n, t, e) {
            var i = {
                canceled: false,
                from: t.from,
                to: t.to,
                text: t.text,
                origin: t.origin,
                cancel: function() {
                    this.canceled = true
                }
            };
            if (e)
                i.update = function(t, e, i, a) {
                    if (t)
                        this.from = Vt(n, t);
                    if (e)
                        this.to = Vt(n, e);
                    if (i)
                        this.text = i;
                    if (a !== undefined)
                        this.origin = a
                }
                ;
            Ns(n, "beforeChange", n, i);
            if (n.cm)
                Ns(n.cm, "beforeChange", n.cm, i);
            if (i.canceled)
                return null;
            return {
                from: i.from,
                to: i.to,
                text: i.text,
                origin: i.origin
            }
        }
        function sa(t, e, i) {
            if (t.cm) {
                if (!t.cm.curOp)
                    return si(t.cm, sa)(t, e, i);
                if (t.cm.state.suppressEdits)
                    return
            }
            if ($s(t, "beforeChange") || t.cm && $s(t.cm, "beforeChange")) {
                e = na(t, e, true);
                if (!e)
                    return
            }
            var a = h && !i && on(t, e.from, e.to);
            if (a) {
                for (var n = a.length - 1; n >= 0; --n)
                    ra(t, {
                        from: a[n].from,
                        to: a[n].to,
                        text: n ? [""] : e.text
                    })
            } else {
                ra(t, e)
            }
        }
        function ra(t, i) {
            if (i.text.length == 1 && i.text[0] == "" && mt(i.from, i.to) == 0)
                return;
            var e = ea(t, i);
            gs(t, i, e, t.cm ? t.cm.curOp.id : NaN);
            ca(t, i, e, nn(t, i));
            var a = [];
            is(t, function(t, e) {
                if (!e && er(a, t.history) == -1) {
                    Es(t.history, i);
                    a.push(t.history)
                }
                ca(t, i, null, nn(t, i))
            })
        }
        function oa(t, e, i) {
            if (t.cm && t.cm.state.suppressEdits)
                return;
            var a = t.history, n, s = t.sel;
            var r = e == "undo" ? a.done : a.undone
                , o = e == "undo" ? a.undone : a.done;
            for (var l = 0; l < r.length; l++) {
                n = r[l];
                if (i ? n.ranges && !n.equals(t.sel) : !n.ranges)
                    break
            }
            if (l == r.length)
                return;
            a.lastOrigin = a.lastSelOrigin = null;
            for (; ; ) {
                n = r.pop();
                if (n.ranges) {
                    Fs(n, o);
                    if (i && !n.equals(t.sel)) {
                        qt(t, n, {
                            clearRedo: false
                        });
                        return
                    }
                    s = n
                } else
                    break
            }
            var c = [];
            Fs(s, o);
            o.push({
                changes: c,
                generation: a.generation
            });
            a.generation = n.generation || ++a.maxGeneration;
            var d = $s(t, "beforeChange") || t.cm && $s(t.cm, "beforeChange");
            for (var l = n.changes.length - 1; l >= 0; --l) {
                var u = n.changes[l];
                u.origin = e;
                if (d && !na(t, u, false)) {
                    r.length = 0;
                    return
                }
                c.push(ps(t, u));
                var h = l ? ea(t, u) : Zs(r);
                ca(t, u, h, rn(t, u));
                if (!l && t.cm)
                    t.cm.scrollIntoView({
                        from: u.from,
                        to: Zi(u)
                    });
                var p = [];
                is(t, function(t, e) {
                    if (!e && er(p, t.history) == -1) {
                        Es(t.history, u);
                        p.push(t.history)
                    }
                    ca(t, u, null, rn(t, u))
                })
            }
        }
        function la(t, e) {
            if (e == 0)
                return;
            t.first += e;
            t.sel = new Nt(ir(t.sel.ranges, function(t) {
                return new Lt(ft(t.anchor.line + e, t.anchor.ch),ft(t.head.line + e, t.head.ch))
            }),t.sel.primIndex);
            if (t.cm) {
                di(t.cm, t.first, t.first - e, e);
                for (var i = t.cm.display, a = i.viewFrom; a < i.viewTo; a++)
                    ui(t.cm, a, "gutter")
            }
        }
        function ca(t, e, i, a) {
            if (t.cm && !t.cm.curOp)
                return si(t.cm, ca)(t, e, i, a);
            if (e.to.line < t.first) {
                la(t, e.text.length - 1 - (e.to.line - e.from.line));
                return
            }
            if (e.from.line > t.lastLine())
                return;
            if (e.from.line < t.first) {
                var n = e.text.length - 1 - (t.first - e.from.line);
                la(t, n);
                e = {
                    from: ft(t.first, 0),
                    to: ft(e.to.line + n, e.to.ch),
                    text: [Zs(e.text)],
                    origin: e.origin
                }
            }
            var s = t.lastLine();
            if (e.to.line > s) {
                e = {
                    from: e.from,
                    to: ft(s, ns(t, s).text.length),
                    text: [e.text[0]],
                    origin: e.origin
                }
            }
            e.removed = ss(t, e.from, e.to);
            if (!i)
                i = ea(t, e);
            if (t.cm)
                da(t.cm, e, a);
            else
                Kn(t, e, a);
            Jt(t, i, js)
        }
        function da(t, e, i) {
            var a = t.doc
                , n = t.display
                , s = e.from
                , r = e.to;
            var o = false
                , l = s.line;
            if (!t.options.lineWrapping) {
                l = ls(_n(ns(a, s.line)));
                a.iter(l, r.line + 1, function(t) {
                    if (t == n.maxLine) {
                        o = true;
                        return true
                    }
                })
            }
            if (a.sel.contains(e.from, e.to) > -1)
                Vs(t);
            Kn(a, e, i, E(t));
            if (!t.options.lineWrapping) {
                a.iter(l, s.line + e.text.length, function(t) {
                    var e = D(t);
                    if (e > n.maxLineLength) {
                        n.maxLine = t;
                        n.maxLineLength = e;
                        n.maxLineChanged = true;
                        o = false
                    }
                });
                if (o)
                    t.curOp.updateMaxLine = true
            }
            a.frontier = Math.min(a.frontier, s.line);
            le(t, 400);
            var c = e.text.length - (r.line - s.line) - 1;
            if (e.full)
                di(t);
            else if (s.line == r.line && e.text.length == 1 && !Yn(t.doc, e))
                ui(t, s.line, "text");
            else
                di(t, s.line, r.line + 1, c);
            var d = $s(t, "changes")
                , u = $s(t, "change");
            if (u || d) {
                var h = {
                    from: s,
                    to: r,
                    text: e.text,
                    removed: e.removed,
                    origin: e.origin
                };
                if (u)
                    Ms(t, "change", t, h);
                if (d)
                    (t.curOp.changeObjs || (t.curOp.changeObjs = [])).push(h)
            }
            t.display.selForContextMenu = null
        }
        function ua(t, e, i, a, n) {
            if (!a)
                a = i;
            if (mt(a, i) < 0) {
                var s = a;
                a = i;
                i = s
            }
            if (typeof e == "string")
                e = Dr(e);
            sa(t, {
                from: i,
                to: a,
                text: e,
                origin: n
            })
        }
        function ha(t, e) {
            if (Rs(t, "scrollCursorIntoView"))
                return;
            var i = t.display
                , a = i.sizer.getBoundingClientRect()
                , n = null;
            if (e.top + a.top < 0)
                n = true;
            else if (e.bottom + a.top > (window.innerHeight || document.documentElement.clientHeight))
                n = false;
            if (n != null && !r) {
                var s = fr("div", "", null, "position: absolute; top: " + (e.top - i.viewOffset - he(t.display)) + "px; height: " + (e.bottom - e.top + me(t) + i.barHeight) + "px; left: " + e.left + "px; width: 2px;");
                t.display.lineSpace.appendChild(s);
                s.scrollIntoView(n);
                t.display.lineSpace.removeChild(s)
            }
        }
        function pa(t, e, i, a) {
            if (a == null)
                a = 0;
            for (var n = 0; n < 5; n++) {
                var s = false
                    , r = Pe(t, e);
                var o = !i || i == e ? r : Pe(t, i);
                var l = ma(t, Math.min(r.left, o.left), Math.min(r.top, o.top) - a, Math.max(r.left, o.left), Math.max(r.bottom, o.bottom) + a);
                var c = t.doc.scrollTop
                    , d = t.doc.scrollLeft;
                if (l.scrollTop != null) {
                    Ui(t, l.scrollTop);
                    if (Math.abs(t.doc.scrollTop - c) > 1)
                        s = true
                }
                if (l.scrollLeft != null) {
                    Di(t, l.scrollLeft);
                    if (Math.abs(t.doc.scrollLeft - d) > 1)
                        s = true
                }
                if (!s)
                    break
            }
            return r
        }
        function fa(t, e, i, a, n) {
            var s = ma(t, e, i, a, n);
            if (s.scrollTop != null)
                Ui(t, s.scrollTop);
            if (s.scrollLeft != null)
                Di(t, s.scrollLeft)
        }
        function ma(t, e, i, a, n) {
            var s = t.display
                , r = We(t.display);
            if (i < 0)
                i = 0;
            var o = t.curOp && t.curOp.scrollTop != null ? t.curOp.scrollTop : s.scroller.scrollTop;
            var l = _e(t)
                , c = {};
            if (n - i > l)
                n = i + l;
            var d = t.doc.height + pe(s);
            var u = i < r
                , h = n > d - r;
            if (i < o) {
                c.scrollTop = u ? 0 : i
            } else if (n > o + l) {
                var p = Math.min(i, (h ? d : n) - l);
                if (p != o)
                    c.scrollTop = p
            }
            var f = t.curOp && t.curOp.scrollLeft != null ? t.curOp.scrollLeft : s.scroller.scrollLeft;
            var m = ge(t) - (t.options.fixedGutter ? s.gutters.offsetWidth : 0);
            var g = a - e > m;
            if (g)
                a = e + m;
            if (e < 10)
                c.scrollLeft = 0;
            else if (e < f)
                c.scrollLeft = Math.max(0, e - (g ? 0 : 10));
            else if (a > m + f - 3)
                c.scrollLeft = a + (g ? 0 : 10) - m;
            return c
        }
        function ga(t, e, i) {
            if (e != null || i != null)
                va(t);
            if (e != null)
                t.curOp.scrollLeft = (t.curOp.scrollLeft == null ? t.doc.scrollLeft : t.curOp.scrollLeft) + e;
            if (i != null)
                t.curOp.scrollTop = (t.curOp.scrollTop == null ? t.doc.scrollTop : t.curOp.scrollTop) + i
        }
        function _a(t) {
            va(t);
            var e = t.getCursor()
                , i = e
                , a = e;
            if (!t.options.lineWrapping) {
                i = e.ch ? ft(e.line, e.ch - 1) : e;
                a = ft(e.line, e.ch + 1)
            }
            t.curOp.scrollToPos = {
                from: i,
                to: a,
                margin: t.options.cursorScrollMargin,
                isCursor: true
            }
        }
        function va(t) {
            var e = t.curOp.scrollToPos;
            if (e) {
                t.curOp.scrollToPos = null;
                var i = Re(t, e.from)
                    , a = Re(t, e.to);
                var n = ma(t, Math.min(i.left, a.left), Math.min(i.top, a.top) - e.margin, Math.max(i.right, a.right), Math.max(i.bottom, a.bottom) + e.margin);
                t.scrollTo(n.scrollLeft, n.scrollTop)
            }
        }
        function Fa(t, e, i, a) {
            var n = t.doc, s;
            if (i == null)
                i = "add";
            if (i == "smart") {
                if (!n.mode.indent)
                    i = "prev";
                else
                    s = ue(t, e)
            }
            var r = t.options.tabSize;
            var o = ns(n, e)
                , l = Ks(o.text, null, r);
            if (o.stateAfter)
                o.stateAfter = null;
            var c = o.text.match(/^\s*/)[0], d;
            if (!a && !/\S/.test(o.text)) {
                d = 0;
                i = "not"
            } else if (i == "smart") {
                d = n.mode.indent(s, o.text.slice(c.length), o.text);
                if (d == Bs || d > 150) {
                    if (!a)
                        return;
                    i = "prev"
                }
            }
            if (i == "prev") {
                if (e > n.first)
                    d = Ks(ns(n, e - 1).text, null, r);
                else
                    d = 0
            } else if (i == "add") {
                d = l + t.options.indentUnit
            } else if (i == "subtract") {
                d = l - t.options.indentUnit
            } else if (typeof i == "number") {
                d = l + i
            }
            d = Math.max(0, d);
            var u = ""
                , h = 0;
            if (t.options.indentWithTabs)
                for (var p = Math.floor(d / r); p; --p) {
                    h += r;
                    u += "\t"
                }
            if (h < d)
                u += Js(d - h);
            if (u != c) {
                ua(n, u, ft(e, 0), ft(e, c.length), "+input");
                o.stateAfter = null;
                return true
            } else {
                for (var p = 0; p < n.sel.ranges.length; p++) {
                    var f = n.sel.ranges[p];
                    if (f.head.line == e && f.head.ch < c.length) {
                        var h = ft(e, c.length);
                        zt(n, p, new Lt(h,h));
                        break
                    }
                }
            }
        }
        function ya(t, e, i, a) {
            var n = e
                , s = e;
            if (typeof e == "number")
                s = ns(t, Rt(t, e));
            else
                n = ls(e);
            if (n == null)
                return null;
            if (a(s, n) && t.cm)
                ui(t.cm, n, i);
            return s
        }
        function ba(e, t) {
            var i = e.doc.sel.ranges
                , a = [];
            for (var n = 0; n < i.length; n++) {
                var s = t(i[n]);
                while (a.length && mt(s.from, Zs(a).to) <= 0) {
                    var r = a.pop();
                    if (mt(r.from, s.from) < 0) {
                        s.from = r.from;
                        break
                    }
                }
                a.push(s)
            }
            ni(e, function() {
                for (var t = a.length - 1; t >= 0; t--)
                    ua(e.doc, "", a[t].from, a[t].to, "+delete");
                _a(e)
            })
        }
        function Ta(e, t, i, a, n) {
            var s = t.line
                , r = t.ch
                , o = i;
            var l = ns(e, s);
            var c = true;
            function d() {
                var t = s + i;
                if (t < e.first || t >= e.first + e.size)
                    return c = false;
                s = t;
                return l = ns(e, t)
            }
            function u(t) {
                var e = (n ? Qr : qr)(l, r, i, true);
                if (e == null) {
                    if (!t && d()) {
                        if (n)
                            r = (i < 0 ? Wr : Hr)(l);
                        else
                            r = i < 0 ? l.text.length : 0
                    } else
                        return c = false
                } else
                    r = e;
                return true
            }
            if (a == "char")
                u();
            else if (a == "column")
                u(true);
            else if (a == "word" || a == "group") {
                var h = null
                    , p = a == "group";
                var f = e.cm && e.cm.getHelper(t, "wordChars");
                for (var m = true; ; m = false) {
                    if (i < 0 && !u(!m))
                        break;
                    var g = l.text.charAt(r) || "\n";
                    var _ = cr(g, f) ? "w" : p && g == "\n" ? "n" : !p || /\s/.test(g) ? null : "p";
                    if (p && !m && !_)
                        _ = "s";
                    if (h && h != _) {
                        if (i < 0) {
                            i = 1;
                            u()
                        }
                        break
                    }
                    if (_)
                        h = _;
                    if (i > 0 && !u(!m))
                        break
                }
            }
            var v = ie(e, ft(s, r), o, true);
            if (!c)
                v.hitSide = true;
            return v
        }
        function Ca(t, e, i, a) {
            var n = t.doc, s = e.left, r;
            if (a == "page") {
                var o = Math.min(t.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
                r = e.top + i * (o - (i < 0 ? 1.5 : .5) * We(t.display))
            } else if (a == "line") {
                r = i > 0 ? e.bottom + 3 : e.top - 3
            }
            for (; ; ) {
                var l = $e(t, s, r);
                if (!l.outside)
                    break;
                if (i < 0 ? r <= 0 : r >= n.height) {
                    l.hitSide = true;
                    break
                }
                r += i * 5
            }
            return l
        }
        F.prototype = {
            constructor: F,
            focus: function() {
                window.focus();
                this.display.input.focus()
            },
            setOption: function(t, e) {
                var i = this.options
                    , a = i[t];
                if (i[t] == e && t != "mode")
                    return;
                i[t] = e;
                if (wa.hasOwnProperty(t))
                    si(this, wa[t])(this, e, a)
            },
            getOption: function(t) {
                return this.options[t]
            },
            getDoc: function() {
                return this.doc
            },
            addKeyMap: function(t, e) {
                this.state.keyMaps[e ? "push" : "unshift"]($a(t))
            },
            removeKeyMap: function(t) {
                var e = this.state.keyMaps;
                for (var i = 0; i < e.length; ++i)
                    if (e[i] == t || e[i].name == t) {
                        e.splice(i, 1);
                        return true
                    }
            },
            addOverlay: ri(function(t, e) {
                var i = t.token ? t : F.getMode(this.options, t);
                if (i.startState)
                    throw new Error("Overlays may not be stateful.");
                this.state.overlays.push({
                    mode: i,
                    modeSpec: t,
                    opaque: e && e.opaque
                });
                this.state.modeGen++;
                di(this)
            }),
            removeOverlay: ri(function(t) {
                var e = this.state.overlays;
                for (var i = 0; i < e.length; ++i) {
                    var a = e[i].modeSpec;
                    if (a == t || typeof t == "string" && a.name == t) {
                        e.splice(i, 1);
                        this.state.modeGen++;
                        di(this);
                        return
                    }
                }
            }),
            indentLine: ri(function(t, e, i) {
                if (typeof e != "string" && typeof e != "number") {
                    if (e == null)
                        e = this.options.smartIndent ? "smart" : "prev";
                    else
                        e = e ? "add" : "subtract"
                }
                if (Ht(this.doc, t))
                    Fa(this, t, e, i)
            }),
            indentSelection: ri(function(t) {
                var e = this.doc.sel.ranges
                    , i = -1;
                for (var a = 0; a < e.length; a++) {
                    var n = e[a];
                    if (!n.empty()) {
                        var s = n.from()
                            , r = n.to();
                        var o = Math.max(i, s.line);
                        i = Math.min(this.lastLine(), r.line - (r.ch ? 0 : 1)) + 1;
                        for (var l = o; l < i; ++l)
                            Fa(this, l, t);
                        var c = this.doc.sel.ranges;
                        if (s.ch == 0 && e.length == c.length && c[a].from().ch > 0)
                            zt(this.doc, a, new Lt(s,c[a].to()), js)
                    } else if (n.head.line > i) {
                        Fa(this, n.head.line, t, true);
                        i = n.head.line;
                        if (a == this.doc.sel.primIndex)
                            _a(this)
                    }
                }
            }),
            getTokenAt: function(t, e) {
                return An(this, t, e)
            },
            getLineTokens: function(t, e) {
                return An(this, ft(t), e, true)
            },
            getTokenTypeAt: function(t) {
                t = Vt(this.doc, t);
                var e = Ln(this, ns(this.doc, t.line));
                var i = 0
                    , a = (e.length - 1) / 2
                    , n = t.ch;
                var s;
                if (n == 0)
                    s = e[2];
                else
                    for (; ; ) {
                        var r = i + a >> 1;
                        if ((r ? e[r * 2 - 1] : 0) >= n)
                            a = r;
                        else if (e[r * 2 + 1] < n)
                            i = r + 1;
                        else {
                            s = e[r * 2 + 2];
                            break
                        }
                    }
                var o = s ? s.indexOf("cm-overlay ") : -1;
                return o < 0 ? s : o == 0 ? null : s.slice(0, o - 1)
            },
            getModeAt: function(t) {
                var e = this.doc.mode;
                if (!e.innerMode)
                    return e;
                return F.innerMode(e, this.getTokenAt(t).state).mode
            },
            getHelper: function(t, e) {
                return this.getHelpers(t, e)[0]
            },
            getHelpers: function(t, e) {
                var i = [];
                if (!Da.hasOwnProperty(e))
                    return i;
                var a = Da[e]
                    , n = this.getModeAt(t);
                if (typeof n[e] == "string") {
                    if (a[n[e]])
                        i.push(a[n[e]])
                } else if (n[e]) {
                    for (var s = 0; s < n[e].length; s++) {
                        var r = a[n[e][s]];
                        if (r)
                            i.push(r)
                    }
                } else if (n.helperType && a[n.helperType]) {
                    i.push(a[n.helperType])
                } else if (a[n.name]) {
                    i.push(a[n.name])
                }
                for (var s = 0; s < a._global.length; s++) {
                    var o = a._global[s];
                    if (o.pred(n, this) && er(i, o.val) == -1)
                        i.push(o.val)
                }
                return i
            },
            getStateAfter: function(t, e) {
                var i = this.doc;
                t = Rt(i, t == null ? i.first + i.size - 1 : t);
                return ue(this, t + 1, e)
            },
            cursorCoords: function(t, e) {
                var i, a = this.doc.sel.primary();
                if (t == null)
                    i = a.head;
                else if (typeof t == "object")
                    i = Vt(this.doc, t);
                else
                    i = t ? a.from() : a.to();
                return Pe(this, i, e || "page")
            },
            charCoords: function(t, e) {
                return Me(this, Vt(this.doc, t), e || "page")
            },
            coordsChar: function(t, e) {
                t = Le(this, t, e || "page");
                return $e(this, t.left, t.top)
            },
            lineAtHeight: function(t, e) {
                t = Le(this, {
                    top: t,
                    left: 0
                }, e || "page").top;
                return cs(this.doc, t + this.display.viewOffset)
            },
            heightAtLine: function(t, e) {
                var i = false, a;
                if (typeof t == "number") {
                    var n = this.doc.first + this.doc.size - 1;
                    if (t < this.doc.first)
                        t = this.doc.first;
                    else if (t > n) {
                        t = n;
                        i = true
                    }
                    a = ns(this.doc, t)
                } else {
                    a = t
                }
                return Ne(this, a, {
                    top: 0,
                    left: 0
                }, e || "page").top + (i ? this.doc.height - ds(a) : 0)
            },
            defaultTextHeight: function() {
                return We(this.display)
            },
            defaultCharWidth: function() {
                return Be(this.display)
            },
            setGutterMarker: ri(function(t, i, a) {
                return ya(this.doc, t, "gutter", function(t) {
                    var e = t.gutterMarkers || (t.gutterMarkers = {});
                    e[i] = a;
                    if (!a && dr(e))
                        t.gutterMarkers = null;
                    return true
                })
            }),
            clearGutter: ri(function(e) {
                var i = this
                    , t = i.doc
                    , a = t.first;
                t.iter(function(t) {
                    if (t.gutterMarkers && t.gutterMarkers[e]) {
                        t.gutterMarkers[e] = null;
                        ui(i, a, "gutter");
                        if (dr(t.gutterMarkers))
                            t.gutterMarkers = null
                    }
                    ++a
                })
            }),
            lineInfo: function(t) {
                if (typeof t == "number") {
                    if (!Ht(this.doc, t))
                        return null;
                    var e = t;
                    t = ns(this.doc, t);
                    if (!t)
                        return null
                } else {
                    var e = ls(t);
                    if (e == null)
                        return null
                }
                return {
                    line: e,
                    handle: t,
                    text: t.text,
                    gutterMarkers: t.gutterMarkers,
                    textClass: t.textClass,
                    bgClass: t.bgClass,
                    wrapClass: t.wrapClass,
                    widgets: t.widgets
                }
            },
            getViewport: function() {
                return {
                    from: this.display.viewFrom,
                    to: this.display.viewTo
                }
            },
            addWidget: function(t, e, i, a, n) {
                var s = this.display;
                t = Pe(this, Vt(this.doc, t));
                var r = t.bottom
                    , o = t.left;
                e.style.position = "absolute";
                e.setAttribute("cm-ignore-events", "true");
                this.display.input.setUneditable(e);
                s.sizer.appendChild(e);
                if (a == "over") {
                    r = t.top
                } else if (a == "above" || a == "near") {
                    var l = Math.max(s.wrapper.clientHeight, this.doc.height)
                        , c = Math.max(s.sizer.clientWidth, s.lineSpace.clientWidth);
                    if ((a == "above" || t.bottom + e.offsetHeight > l) && t.top > e.offsetHeight)
                        r = t.top - e.offsetHeight;
                    else if (t.bottom + e.offsetHeight <= l)
                        r = t.bottom;
                    if (o + e.offsetWidth > c)
                        o = c - e.offsetWidth
                }
                e.style.top = r + "px";
                e.style.left = e.style.right = "";
                if (n == "right") {
                    o = s.sizer.clientWidth - e.offsetWidth;
                    e.style.right = "0px"
                } else {
                    if (n == "left")
                        o = 0;
                    else if (n == "middle")
                        o = (s.sizer.clientWidth - e.offsetWidth) / 2;
                    e.style.left = o + "px"
                }
                if (i)
                    fa(this, o, r, o + e.offsetWidth, r + e.offsetHeight)
            },
            triggerOnKeyDown: ri(Bi),
            triggerOnKeyPress: ri(zi),
            triggerOnKeyUp: Gi,
            execCommand: function(t) {
                if (Na.hasOwnProperty(t))
                    return Na[t](this)
            },
            triggerElectric: ri(function(t) {
                xt(this, t)
            }),
            findPosH: function(t, e, i, a) {
                var n = 1;
                if (e < 0) {
                    n = -1;
                    e = -e
                }
                for (var s = 0, r = Vt(this.doc, t); s < e; ++s) {
                    r = Ta(this.doc, r, n, i, a);
                    if (r.hitSide)
                        break
                }
                return r
            },
            moveH: ri(function(e, i) {
                var a = this;
                a.extendSelectionsBy(function(t) {
                    if (a.display.shift || a.doc.extend || t.empty())
                        return Ta(a.doc, t.head, e, i, a.options.rtlMoveVisually);
                    else
                        return e < 0 ? t.from() : t.to()
                }, zs)
            }),
            deleteH: ri(function(i, a) {
                var t = this.doc.sel
                    , n = this.doc;
                if (t.somethingSelected())
                    n.replaceSelection("", null, "+delete");
                else
                    ba(this, function(t) {
                        var e = Ta(n, t.head, i, a, false);
                        return i < 0 ? {
                            from: e,
                            to: t.head
                        } : {
                            from: t.head,
                            to: e
                        }
                    })
            }),
            findPosV: function(t, e, i, a) {
                var n = 1
                    , s = a;
                if (e < 0) {
                    n = -1;
                    e = -e
                }
                for (var r = 0, o = Vt(this.doc, t); r < e; ++r) {
                    var l = Pe(this, o, "div");
                    if (s == null)
                        s = l.left;
                    else
                        l.left = s;
                    o = Ca(this, l, n, i);
                    if (o.hitSide)
                        break
                }
                return o
            },
            moveV: ri(function(a, n) {
                var s = this
                    , r = this.doc
                    , o = [];
                var l = !s.display.shift && !r.extend && r.sel.somethingSelected();
                r.extendSelectionsBy(function(t) {
                    if (l)
                        return a < 0 ? t.from() : t.to();
                    var e = Pe(s, t.head, "div");
                    if (t.goalColumn != null)
                        e.left = t.goalColumn;
                    o.push(e.left);
                    var i = Ca(s, e, a, n);
                    if (n == "page" && t == r.sel.primary())
                        ga(s, null, Me(s, i, "div").top - e.top);
                    return i
                }, zs);
                if (o.length)
                    for (var t = 0; t < r.sel.ranges.length; t++)
                        r.sel.ranges[t].goalColumn = o[t]
            }),
            findWordAt: function(t) {
                var e = this.doc
                    , i = ns(e, t.line).text;
                var a = t.ch
                    , n = t.ch;
                if (i) {
                    var s = this.getHelper(t, "wordChars");
                    if ((t.xRel < 0 || n == i.length) && a)
                        --a;
                    else
                        ++n;
                    var r = i.charAt(a);
                    var o = cr(r, s) ? function(t) {
                            return cr(t, s)
                        }
                        : /\s/.test(r) ? function(t) {
                                return /\s/.test(t)
                            }
                            : function(t) {
                                return !/\s/.test(t) && !cr(t)
                            }
                    ;
                    while (a > 0 && o(i.charAt(a - 1)))
                        --a;
                    while (n < i.length && o(i.charAt(n)))
                        ++n
                }
                return new Lt(ft(t.line, a),ft(t.line, n))
            },
            toggleOverwrite: function(t) {
                if (t != null && t == this.state.overwrite)
                    return;
                if (this.state.overwrite = !this.state.overwrite)
                    br(this.display.cursorDiv, "CodeMirror-overwrite");
                else
                    yr(this.display.cursorDiv, "CodeMirror-overwrite");
                Ns(this, "overwriteToggle", this, this.state.overwrite)
            },
            hasFocus: function() {
                return this.display.input.getField() == vr()
            },
            scrollTo: ri(function(t, e) {
                if (t != null || e != null)
                    va(this);
                if (t != null)
                    this.curOp.scrollLeft = t;
                if (e != null)
                    this.curOp.scrollTop = e
            }),
            getScrollInfo: function() {
                var t = this.display.scroller;
                return {
                    left: t.scrollLeft,
                    top: t.scrollTop,
                    height: t.scrollHeight - me(this) - this.display.barHeight,
                    width: t.scrollWidth - me(this) - this.display.barWidth,
                    clientHeight: _e(this),
                    clientWidth: ge(this)
                }
            },
            scrollIntoView: ri(function(t, e) {
                if (t == null) {
                    t = {
                        from: this.doc.sel.primary().head,
                        to: null
                    };
                    if (e == null)
                        e = this.options.cursorScrollMargin
                } else if (typeof t == "number") {
                    t = {
                        from: ft(t, 0),
                        to: null
                    }
                } else if (t.from == null) {
                    t = {
                        from: t,
                        to: null
                    }
                }
                if (!t.to)
                    t.to = t.from;
                t.margin = e || 0;
                if (t.from.line != null) {
                    va(this);
                    this.curOp.scrollToPos = t
                } else {
                    var i = ma(this, Math.min(t.from.left, t.to.left), Math.min(t.from.top, t.to.top) - t.margin, Math.max(t.from.right, t.to.right), Math.max(t.from.bottom, t.to.bottom) + t.margin);
                    this.scrollTo(i.scrollLeft, i.scrollTop)
                }
            }),
            setSize: ri(function(t, e) {
                var i = this;
                function a(t) {
                    return typeof t == "number" || /^\d+$/.test(String(t)) ? t + "px" : t
                }
                if (t != null)
                    i.display.wrapper.style.width = a(t);
                if (e != null)
                    i.display.wrapper.style.height = a(e);
                if (i.options.lineWrapping)
                    Ue(this);
                var n = i.display.viewFrom;
                i.doc.iter(n, i.display.viewTo, function(t) {
                    if (t.widgets)
                        for (var e = 0; e < t.widgets.length; e++)
                            if (t.widgets[e].noHScroll) {
                                ui(i, n, "widget");
                                break
                            }
                    ++n
                });
                i.curOp.forceUpdate = true;
                Ns(i, "refresh", this)
            }),
            operation: function(t) {
                return ni(this, t)
            },
            refresh: ri(function() {
                var t = this.display.cachedTextHeight;
                di(this);
                this.curOp.forceUpdate = true;
                De(this);
                this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);
                U(this);
                if (t == null || Math.abs(t - We(this.display)) > .5)
                    X(this);
                Ns(this, "refresh", this)
            }),
            swapDoc: ri(function(t) {
                var e = this.doc;
                e.cm = null;
                as(this, t);
                De(this);
                this.display.input.reset();
                this.scrollTo(t.scrollLeft, t.scrollTop);
                this.curOp.forceScroll = true;
                Ms(this, "swapDoc", this, e);
                return e
            }),
            getInputField: function() {
                return this.display.input.getField()
            },
            getWrapperElement: function() {
                return this.display.wrapper
            },
            getScrollerElement: function() {
                return this.display.scroller
            },
            getGutterElement: function() {
                return this.display.gutters
            }
        },
            Hs(F);
        var xa = F.defaults = {}
            , wa = F.optionHandlers = {};
        function Ea(t, e, a, i) {
            F.defaults[t] = e;
            if (a)
                wa[t] = i ? function(t, e, i) {
                        if (i != Xa)
                            a(t, e, i)
                    }
                    : a
        }
        var Xa = F.Init = {
            toString: function() {
                return "CodeMirror.Init"
            }
        };
        Ea("value", "", function(t, e) {
            t.setValue(e)
        }, true),
            Ea("mode", null, function(t, e) {
                t.doc.modeOption = e;
                C(t)
            }, true),
            Ea("indentUnit", 2, C, true),
            Ea("indentWithTabs", false),
            Ea("smartIndent", true),
            Ea("tabSize", 4, function(t) {
                x(t);
                De(t);
                di(t)
            }, true),
            Ea("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function(t, e, i) {
                t.state.specialChars = new RegExp(e.source + (e.test("\t") ? "" : "|\t"),"g");
                if (i != F.Init)
                    t.refresh()
            }),
            Ea("specialCharPlaceholder", Hn, function(t) {
                t.refresh()
            }, true),
            Ea("electricChars", true),
            Ea("inputStyle", l ? "contenteditable" : "textarea", function() {
                throw new Error("inputStyle can not (yet) be changed in a running editor")
            }, true),
            Ea("rtlMoveVisually", !c),
            Ea("wholeLineUpdateBefore", true),
            Ea("theme", "default", function(t) {
                I(t);
                S(t)
            }, true),
            Ea("keyMap", "default", function(t, e, i) {
                var a = $a(e);
                var n = i != F.Init && $a(i);
                if (n && n.detach)
                    n.detach(t, a);
                if (a.attach)
                    a.attach(t, n || null)
            }),
            Ea("extraKeys", null),
            Ea("lineWrapping", false, w, true),
            Ea("gutters", [], function(t) {
                O(t.options);
                S(t)
            }, true),
            Ea("fixedGutter", true, function(t, e) {
                t.display.gutters.style.left = e ? j(t.display) + "px" : "0";
                t.refresh()
            }, true),
            Ea("coverGutterNextToScrollbar", false, function(t) {
                R(t)
            }, true),
            Ea("scrollbarStyle", "native", function(t) {
                P(t);
                R(t);
                t.display.scrollbars.setScrollTop(t.doc.scrollTop);
                t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)
            }, true),
            Ea("lineNumbers", false, function(t) {
                O(t.options);
                S(t)
            }, true),
            Ea("firstLineNumber", 1, S, true),
            Ea("lineNumberFormatter", function(t) {
                return t
            }, S, true),
            Ea("showCursorWhenSelecting", false, ae, true),
            Ea("resetSelectionOnContextMenu", true),
            Ea("lineWiseCopyCut", true),
            Ea("readOnly", false, function(t, e) {
                if (e == "nocursor") {
                    Qi(t);
                    t.display.input.blur();
                    t.display.disabled = true
                } else {
                    t.display.disabled = false;
                    if (!e)
                        t.display.input.reset()
                }
            }),
            Ea("disableInput", false, function(t, e) {
                if (!e)
                    t.display.input.reset()
            }, true),
            Ea("dragDrop", true, vi),
            Ea("cursorBlinkRate", 530),
            Ea("cursorScrollMargin", 0),
            Ea("cursorHeight", 1, ae, true),
            Ea("singleCursorHeightPerLine", true, ae, true),
            Ea("workTime", 100),
            Ea("workDelay", 100),
            Ea("flattenSpans", true, x, true),
            Ea("addModeClass", false, x, true),
            Ea("pollInterval", 100),
            Ea("undoDepth", 200, function(t, e) {
                t.doc.history.undoDepth = e
            }),
            Ea("historyEventDelay", 1250),
            Ea("viewportMargin", 10, function(t) {
                t.refresh()
            }, true),
            Ea("maxHighlightLength", 1e4, x, true),
            Ea("moveInputWithCursor", true, function(t, e) {
                if (!e)
                    t.display.input.resetPosition()
            }),
            Ea("tabindex", null, function(t, e) {
                t.display.input.getField().tabIndex = e || ""
            }),
            Ea("autofocus", null);
        var Ia = F.modes = {}
            , Sa = F.mimeModes = {};
        F.defineMode = function(t, e) {
            if (!F.defaults.mode && t != "null")
                F.defaults.mode = t;
            if (arguments.length > 2)
                e.dependencies = Array.prototype.slice.call(arguments, 2);
            Ia[t] = e
        }
            ,
            F.defineMIME = function(t, e) {
                Sa[t] = e
            }
            ,
            F.resolveMode = function(t) {
                if (typeof t == "string" && Sa.hasOwnProperty(t)) {
                    t = Sa[t]
                } else if (t && typeof t.name == "string" && Sa.hasOwnProperty(t.name)) {
                    var e = Sa[t.name];
                    if (typeof e == "string")
                        e = {
                            name: e
                        };
                    t = nr(e, t);
                    t.name = e.name
                } else if (typeof t == "string" && /^[\w\-]+\/[\w\-]+\+xml$/.test(t)) {
                    return F.resolveMode("application/xml")
                }
                if (typeof t == "string")
                    return {
                        name: t
                    };
                else
                    return t || {
                        name: "null"
                    }
            }
            ,
            F.getMode = function(t, e) {
                var e = F.resolveMode(e);
                var i = Ia[e.name];
                if (!i)
                    return F.getMode(t, "text/plain");
                var a = i(t, e);
                if (ka.hasOwnProperty(e.name)) {
                    var n = ka[e.name];
                    for (var s in n) {
                        if (!n.hasOwnProperty(s))
                            continue;
                        if (a.hasOwnProperty(s))
                            a["_" + s] = a[s];
                        a[s] = n[s]
                    }
                }
                a.name = e.name;
                if (e.helperType)
                    a.helperType = e.helperType;
                if (e.modeProps)
                    for (var s in e.modeProps)
                        a[s] = e.modeProps[s];
                return a
            }
            ,
            F.defineMode("null", function() {
                return {
                    token: function(t) {
                        t.skipToEnd()
                    }
                }
            }),
            F.defineMIME("text/plain", "null");
        var ka = F.modeExtensions = {};
        F.extendMode = function(t, e) {
            var i = ka.hasOwnProperty(t) ? ka[t] : ka[t] = {};
            sr(e, i)
        }
            ,
            F.defineExtension = function(t, e) {
                F.prototype[t] = e
            }
            ,
            F.defineDocExtension = function(t, e) {
                Zn.prototype[t] = e
            }
            ,
            F.defineOption = Ea;
        var Ua = [];
        F.defineInitHook = function(t) {
            Ua.push(t)
        }
        ;
        var Da = F.helpers = {};
        F.registerHelper = function(t, e, i) {
            if (!Da.hasOwnProperty(t))
                Da[t] = F[t] = {
                    _global: []
                };
            Da[t][e] = i
        }
            ,
            F.registerGlobalHelper = function(t, e, i, a) {
                F.registerHelper(t, e, a);
                Da[t]._global.push({
                    pred: i,
                    val: a
                })
            }
        ;
        var Aa = F.copyState = function(t, e) {
                if (e === true)
                    return e;
                if (t.copyState)
                    return t.copyState(e);
                var i = {};
                for (var a in e) {
                    var n = e[a];
                    if (n instanceof Array)
                        n = n.concat([]);
                    i[a] = n
                }
                return i
            }
            , Oa = F.startState = function(t, e, i) {
                return t.startState ? t.startState(e, i) : true
            }
        ;
        F.innerMode = function(t, e) {
            while (t.innerMode) {
                var i = t.innerMode(e);
                if (!i || i.mode == t)
                    break;
                e = i.state;
                t = i.mode
            }
            return i || {
                mode: t,
                state: e
            }
        }
        ;
        var Na = F.commands = {
            selectAll: function(t) {
                t.setSelection(ft(t.firstLine(), 0), ft(t.lastLine()), js)
            },
            singleSelection: function(t) {
                t.setSelection(t.getCursor("anchor"), t.getCursor("head"), js)
            },
            killLine: function(i) {
                ba(i, function(t) {
                    if (t.empty()) {
                        var e = ns(i.doc, t.head.line).text.length;
                        if (t.head.ch == e && t.head.line < i.lastLine())
                            return {
                                from: t.head,
                                to: ft(t.head.line + 1, 0)
                            };
                        else
                            return {
                                from: t.head,
                                to: ft(t.head.line, e)
                            }
                    } else {
                        return {
                            from: t.from(),
                            to: t.to()
                        }
                    }
                })
            },
            deleteLine: function(e) {
                ba(e, function(t) {
                    return {
                        from: ft(t.from().line, 0),
                        to: Vt(e.doc, ft(t.to().line + 1, 0))
                    }
                })
            },
            delLineLeft: function(t) {
                ba(t, function(t) {
                    return {
                        from: ft(t.from().line, 0),
                        to: t.from()
                    }
                })
            },
            delWrappedLineLeft: function(a) {
                ba(a, function(t) {
                    var e = a.charCoords(t.head, "div").top + 5;
                    var i = a.coordsChar({
                        left: 0,
                        top: e
                    }, "div");
                    return {
                        from: i,
                        to: t.from()
                    }
                })
            },
            delWrappedLineRight: function(a) {
                ba(a, function(t) {
                    var e = a.charCoords(t.head, "div").top + 5;
                    var i = a.coordsChar({
                        left: a.display.lineDiv.offsetWidth + 100,
                        top: e
                    }, "div");
                    return {
                        from: t.from(),
                        to: i
                    }
                })
            },
            undo: function(t) {
                t.undo()
            },
            redo: function(t) {
                t.redo()
            },
            undoSelection: function(t) {
                t.undoSelection()
            },
            redoSelection: function(t) {
                t.redoSelection()
            },
            goDocStart: function(t) {
                t.extendSelection(ft(t.firstLine(), 0))
            },
            goDocEnd: function(t) {
                t.extendSelection(ft(t.lastLine()))
            },
            goLineStart: function(e) {
                e.extendSelectionsBy(function(t) {
                    return Br(e, t.head.line)
                }, {
                    origin: "+move",
                    bias: 1
                })
            },
            goLineStartSmart: function(e) {
                e.extendSelectionsBy(function(t) {
                    return Gr(e, t.head)
                }, {
                    origin: "+move",
                    bias: 1
                })
            },
            goLineEnd: function(e) {
                e.extendSelectionsBy(function(t) {
                    return jr(e, t.head.line)
                }, {
                    origin: "+move",
                    bias: -1
                })
            },
            goLineRight: function(i) {
                i.extendSelectionsBy(function(t) {
                    var e = i.charCoords(t.head, "div").top + 5;
                    return i.coordsChar({
                        left: i.display.lineDiv.offsetWidth + 100,
                        top: e
                    }, "div")
                }, zs)
            },
            goLineLeft: function(i) {
                i.extendSelectionsBy(function(t) {
                    var e = i.charCoords(t.head, "div").top + 5;
                    return i.coordsChar({
                        left: 0,
                        top: e
                    }, "div")
                }, zs)
            },
            goLineLeftSmart: function(a) {
                a.extendSelectionsBy(function(t) {
                    var e = a.charCoords(t.head, "div").top + 5;
                    var i = a.coordsChar({
                        left: 0,
                        top: e
                    }, "div");
                    if (i.ch < a.getLine(i.line).search(/\S/))
                        return Gr(a, t.head);
                    return i
                }, zs)
            },
            goLineUp: function(t) {
                t.moveV(-1, "line")
            },
            goLineDown: function(t) {
                t.moveV(1, "line")
            },
            goPageUp: function(t) {
                t.moveV(-1, "page")
            },
            goPageDown: function(t) {
                t.moveV(1, "page")
            },
            goCharLeft: function(t) {
                t.moveH(-1, "char")
            },
            goCharRight: function(t) {
                t.moveH(1, "char")
            },
            goColumnLeft: function(t) {
                t.moveH(-1, "column")
            },
            goColumnRight: function(t) {
                t.moveH(1, "column")
            },
            goWordLeft: function(t) {
                t.moveH(-1, "word")
            },
            goGroupRight: function(t) {
                t.moveH(1, "group")
            },
            goGroupLeft: function(t) {
                t.moveH(-1, "group")
            },
            goWordRight: function(t) {
                t.moveH(1, "word")
            },
            delCharBefore: function(t) {
                t.deleteH(-1, "char")
            },
            delCharAfter: function(t) {
                t.deleteH(1, "char")
            },
            delWordBefore: function(t) {
                t.deleteH(-1, "word")
            },
            delWordAfter: function(t) {
                t.deleteH(1, "word")
            },
            delGroupBefore: function(t) {
                t.deleteH(-1, "group")
            },
            delGroupAfter: function(t) {
                t.deleteH(1, "group")
            },
            indentAuto: function(t) {
                t.indentSelection("smart")
            },
            indentMore: function(t) {
                t.indentSelection("add")
            },
            indentLess: function(t) {
                t.indentSelection("subtract")
            },
            insertTab: function(t) {
                t.replaceSelection("\t")
            },
            insertSoftTab: function(t) {
                var e = []
                    , i = t.listSelections()
                    , a = t.options.tabSize;
                for (var n = 0; n < i.length; n++) {
                    var s = i[n].from();
                    var r = Ks(t.getLine(s.line), s.ch, a);
                    e.push(new Array(a - r % a + 1).join(" "))
                }
                t.replaceSelections(e)
            },
            defaultTab: function(t) {
                if (t.somethingSelected())
                    t.indentSelection("add");
                else
                    t.execCommand("insertTab")
            },
            transposeChars: function(r) {
                ni(r, function() {
                    var t = r.listSelections()
                        , e = [];
                    for (var i = 0; i < t.length; i++) {
                        var a = t[i].head
                            , n = ns(r.doc, a.line).text;
                        if (n) {
                            if (a.ch == n.length)
                                a = new ft(a.line,a.ch - 1);
                            if (a.ch > 0) {
                                a = new ft(a.line,a.ch + 1);
                                r.replaceRange(n.charAt(a.ch - 1) + n.charAt(a.ch - 2), ft(a.line, a.ch - 2), a, "+transpose")
                            } else if (a.line > r.doc.first) {
                                var s = ns(r.doc, a.line - 1).text;
                                if (s)
                                    r.replaceRange(n.charAt(0) + "\n" + s.charAt(s.length - 1), ft(a.line - 1, s.length - 1), ft(a.line, 1), "+transpose")
                            }
                        }
                        e.push(new Lt(a,a))
                    }
                    r.setSelections(e)
                })
            },
            newlineAndIndent: function(a) {
                ni(a, function() {
                    var t = a.listSelections().length;
                    for (var e = 0; e < t; e++) {
                        var i = a.listSelections()[e];
                        a.replaceRange("\n", i.anchor, i.head, "+input");
                        a.indentLine(i.from().line + 1, null, true);
                        _a(a)
                    }
                })
            },
            toggleOverwrite: function(t) {
                t.toggleOverwrite()
            }
        }
            , La = F.keyMap = {};
        function Ma(t) {
            var e = t.split(/-(?!$)/)
                , t = e[e.length - 1];
            var i, a, n, s;
            for (var r = 0; r < e.length - 1; r++) {
                var o = e[r];
                if (/^(cmd|meta|m)$/i.test(o))
                    s = true;
                else if (/^a(lt)?$/i.test(o))
                    i = true;
                else if (/^(c|ctrl|control)$/i.test(o))
                    a = true;
                else if (/^s(hift)$/i.test(o))
                    n = true;
                else
                    throw new Error("Unrecognized modifier name: " + o)
            }
            if (i)
                t = "Alt-" + t;
            if (a)
                t = "Ctrl-" + t;
            if (s)
                t = "Cmd-" + t;
            if (n)
                t = "Shift-" + t;
            return t
        }
        La.basic = {
            Left: "goCharLeft",
            Right: "goCharRight",
            Up: "goLineUp",
            Down: "goLineDown",
            End: "goLineEnd",
            Home: "goLineStartSmart",
            PageUp: "goPageUp",
            PageDown: "goPageDown",
            Delete: "delCharAfter",
            Backspace: "delCharBefore",
            "Shift-Backspace": "delCharBefore",
            Tab: "defaultTab",
            "Shift-Tab": "indentAuto",
            Enter: "newlineAndIndent",
            Insert: "toggleOverwrite",
            Esc: "singleSelection"
        },
            La.pcDefault = {
                "Ctrl-A": "selectAll",
                "Ctrl-D": "deleteLine",
                "Ctrl-Z": "undo",
                "Shift-Ctrl-Z": "redo",
                "Ctrl-Y": "redo",
                "Ctrl-Home": "goDocStart",
                "Ctrl-End": "goDocEnd",
                "Ctrl-Up": "goLineUp",
                "Ctrl-Down": "goLineDown",
                "Ctrl-Left": "goGroupLeft",
                "Ctrl-Right": "goGroupRight",
                "Alt-Left": "goLineStart",
                "Alt-Right": "goLineEnd",
                "Ctrl-Backspace": "delGroupBefore",
                "Ctrl-Delete": "delGroupAfter",
                "Ctrl-S": "save",
                "Ctrl-F": "find",
                "Ctrl-G": "findNext",
                "Shift-Ctrl-G": "findPrev",
                "Shift-Ctrl-F": "replace",
                "Shift-Ctrl-R": "replaceAll",
                "Ctrl-[": "indentLess",
                "Ctrl-]": "indentMore",
                "Ctrl-U": "undoSelection",
                "Shift-Ctrl-U": "redoSelection",
                "Alt-U": "redoSelection",
                fallthrough: "basic"
            },
            La.emacsy = {
                "Ctrl-F": "goCharRight",
                "Ctrl-B": "goCharLeft",
                "Ctrl-P": "goLineUp",
                "Ctrl-N": "goLineDown",
                "Alt-F": "goWordRight",
                "Alt-B": "goWordLeft",
                "Ctrl-A": "goLineStart",
                "Ctrl-E": "goLineEnd",
                "Ctrl-V": "goPageDown",
                "Shift-Ctrl-V": "goPageUp",
                "Ctrl-D": "delCharAfter",
                "Ctrl-H": "delCharBefore",
                "Alt-D": "delWordAfter",
                "Alt-Backspace": "delWordBefore",
                "Ctrl-K": "killLine",
                "Ctrl-T": "transposeChars"
            },
            La.macDefault = {
                "Cmd-A": "selectAll",
                "Cmd-D": "deleteLine",
                "Cmd-Z": "undo",
                "Shift-Cmd-Z": "redo",
                "Cmd-Y": "redo",
                "Cmd-Home": "goDocStart",
                "Cmd-Up": "goDocStart",
                "Cmd-End": "goDocEnd",
                "Cmd-Down": "goDocEnd",
                "Alt-Left": "goGroupLeft",
                "Alt-Right": "goGroupRight",
                "Cmd-Left": "goLineLeft",
                "Cmd-Right": "goLineRight",
                "Alt-Backspace": "delGroupBefore",
                "Ctrl-Alt-Backspace": "delGroupAfter",
                "Alt-Delete": "delGroupAfter",
                "Cmd-S": "save",
                "Cmd-F": "find",
                "Cmd-G": "findNext",
                "Shift-Cmd-G": "findPrev",
                "Cmd-Alt-F": "replace",
                "Shift-Cmd-Alt-F": "replaceAll",
                "Cmd-[": "indentLess",
                "Cmd-]": "indentMore",
                "Cmd-Backspace": "delWrappedLineLeft",
                "Cmd-Delete": "delWrappedLineRight",
                "Cmd-U": "undoSelection",
                "Shift-Cmd-U": "redoSelection",
                "Ctrl-Up": "goDocStart",
                "Ctrl-Down": "goDocEnd",
                fallthrough: ["basic", "emacsy"]
            },
            La["default"] = g ? La.macDefault : La.pcDefault,
            F.normalizeKeyMap = function(t) {
                var e = {};
                for (var i in t)
                    if (t.hasOwnProperty(i)) {
                        var a = t[i];
                        if (/^(name|fallthrough|(de|at)tach)$/.test(i))
                            continue;
                        if (a == "...") {
                            delete t[i];
                            continue
                        }
                        var n = ir(i.split(" "), Ma);
                        for (var s = 0; s < n.length; s++) {
                            var r, o;
                            if (s == n.length - 1) {
                                o = n.join(" ");
                                r = a
                            } else {
                                o = n.slice(0, s + 1).join(" ");
                                r = "..."
                            }
                            var l = e[o];
                            if (!l)
                                e[o] = r;
                            else if (l != r)
                                throw new Error("Inconsistent bindings for " + o)
                        }
                        delete t[i]
                    }
                for (var c in e)
                    t[c] = e[c];
                return t
            }
        ;
        var Pa = F.lookupKey = function(t, e, i, a) {
                e = $a(e);
                var n = e.call ? e.call(t, a) : e[t];
                if (n === false)
                    return "nothing";
                if (n === "...")
                    return "multi";
                if (n != null && i(n))
                    return "handled";
                if (e.fallthrough) {
                    if (Object.prototype.toString.call(e.fallthrough) != "[object Array]")
                        return Pa(t, e.fallthrough, i, a);
                    for (var s = 0; s < e.fallthrough.length; s++) {
                        var r = Pa(t, e.fallthrough[s], i, a);
                        if (r)
                            return r
                    }
                }
            }
            , Ra = F.isModifierKey = function(t) {
                var e = typeof t == "string" ? t : Mr[t.keyCode];
                return e == "Ctrl" || e == "Alt" || e == "Shift" || e == "Mod"
            }
            , Va = F.keyName = function(t, e) {
                if (m && t.keyCode == 34 && t["char"])
                    return false;
                var i = Mr[t.keyCode]
                    , a = i;
                if (a == null || t.altGraphKey)
                    return false;
                if (t.altKey && i != "Alt")
                    a = "Alt-" + a;
                if ((u ? t.metaKey : t.ctrlKey) && i != "Ctrl")
                    a = "Ctrl-" + a;
                if ((u ? t.ctrlKey : t.metaKey) && i != "Cmd")
                    a = "Cmd-" + a;
                if (!e && t.shiftKey && i != "Shift")
                    a = "Shift-" + a;
                return a
            }
        ;
        function $a(t) {
            return typeof t == "string" ? La[t] : t
        }
        F.fromTextArea = function(e, t) {
            t = t ? sr(t) : {};
            t.value = e.value;
            if (!t.tabindex && e.tabIndex)
                t.tabindex = e.tabIndex;
            if (!t.placeholder && e.placeholder)
                t.placeholder = e.placeholder;
            if (t.autofocus == null) {
                var i = vr();
                t.autofocus = i == e || e.getAttribute("autofocus") != null && i == document.body
            }
            function a() {
                e.value = o.getValue()
            }
            if (e.form) {
                As(e.form, "submit", a);
                if (!t.leaveSubmitMethodAlone) {
                    var n = e.form
                        , s = n.submit;
                    try {
                        var r = n.submit = function() {
                            a();
                            n.submit = s;
                            n.submit();
                            n.submit = r
                        }
                    } catch (t) {}
                }
            }
            t.finishInit = function(t) {
                t.save = a;
                t.getTextArea = function() {
                    return e
                }
                ;
                t.toTextArea = function() {
                    t.toTextArea = isNaN;
                    a();
                    e.parentNode.removeChild(t.getWrapperElement());
                    e.style.display = "";
                    if (e.form) {
                        Os(e.form, "submit", a);
                        if (typeof e.form.submit == "function")
                            e.form.submit = s
                    }
                }
            }
            ;
            e.style.display = "none";
            var o = F(function(t) {
                e.parentNode.insertBefore(t, e.nextSibling)
            }, t);
            return o
        }
        ;
        var Ha = F.StringStream = function(t, e) {
                this.pos = this.start = 0;
                this.string = t;
                this.tabSize = e || 8;
                this.lastColumnPos = this.lastColumnValue = 0;
                this.lineStart = 0
            }
        ;
        Ha.prototype = {
            eol: function() {
                return this.pos >= this.string.length
            },
            sol: function() {
                return this.pos == this.lineStart
            },
            peek: function() {
                return this.string.charAt(this.pos) || undefined
            },
            next: function() {
                if (this.pos < this.string.length)
                    return this.string.charAt(this.pos++)
            },
            eat: function(t) {
                var e = this.string.charAt(this.pos);
                if (typeof t == "string")
                    var i = e == t;
                else
                    var i = e && (t.test ? t.test(e) : t(e));
                if (i) {
                    ++this.pos;
                    return e
                }
            },
            eatWhile: function(t) {
                var e = this.pos;
                while (this.eat(t)) {}
                return this.pos > e
            },
            eatSpace: function() {
                var t = this.pos;
                while (/[\s\u00a0]/.test(this.string.charAt(this.pos)))
                    ++this.pos;
                return this.pos > t
            },
            skipToEnd: function() {
                this.pos = this.string.length
            },
            skipTo: function(t) {
                var e = this.string.indexOf(t, this.pos);
                if (e > -1) {
                    this.pos = e;
                    return true
                }
            },
            backUp: function(t) {
                this.pos -= t
            },
            column: function() {
                if (this.lastColumnPos < this.start) {
                    this.lastColumnValue = Ks(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
                    this.lastColumnPos = this.start
                }
                return this.lastColumnValue - (this.lineStart ? Ks(this.string, this.lineStart, this.tabSize) : 0)
            },
            indentation: function() {
                return Ks(this.string, null, this.tabSize) - (this.lineStart ? Ks(this.string, this.lineStart, this.tabSize) : 0)
            },
            match: function(t, e, i) {
                if (typeof t == "string") {
                    var a = function(t) {
                        return i ? t.toLowerCase() : t
                    };
                    var n = this.string.substr(this.pos, t.length);
                    if (a(n) == a(t)) {
                        if (e !== false)
                            this.pos += t.length;
                        return true
                    }
                } else {
                    var s = this.string.slice(this.pos).match(t);
                    if (s && s.index > 0)
                        return null;
                    if (s && e !== false)
                        this.pos += s[0].length;
                    return s
                }
            },
            current: function() {
                return this.string.slice(this.start, this.pos)
            },
            hideFirstChars: function(t, e) {
                this.lineStart += t;
                try {
                    return e()
                } finally {
                    this.lineStart -= t
                }
            }
        };
        var Wa = 0
            , Ba = F.TextMarker = function(t, e) {
                this.lines = [];
                this.type = e;
                this.doc = t;
                this.id = ++Wa
            }
        ;
        Hs(Ba),
            Ba.prototype.clear = function() {
                if (this.explicitlyCleared)
                    return;
                var t = this.doc.cm
                    , e = t && !t.curOp;
                if (e)
                    Ke(t);
                if ($s(this, "clear")) {
                    var i = this.find();
                    if (i)
                        Ms(this, "clear", i.from, i.to)
                }
                var a = null
                    , n = null;
                for (var s = 0; s < this.lines.length; ++s) {
                    var r = this.lines[s];
                    var o = Ja(r.markedSpans, this);
                    if (t && !this.collapsed)
                        ui(t, ls(r), "text");
                    else if (t) {
                        if (o.to != null)
                            n = ls(r);
                        if (o.from != null)
                            a = ls(r)
                    }
                    r.markedSpans = Za(r.markedSpans, o);
                    if (o.from == null && this.collapsed && !bn(this.doc, r) && t)
                        os(r, We(t.display))
                }
                if (t && this.collapsed && !t.options.lineWrapping)
                    for (var s = 0; s < this.lines.length; ++s) {
                        var l = _n(this.lines[s])
                            , c = D(l);
                        if (c > t.display.maxLineLength) {
                            t.display.maxLine = l;
                            t.display.maxLineLength = c;
                            t.display.maxLineChanged = true
                        }
                    }
                if (a != null && t && this.collapsed)
                    di(t, a, n + 1);
                this.lines.length = 0;
                this.explicitlyCleared = true;
                if (this.atomic && this.doc.cantEdit) {
                    this.doc.cantEdit = false;
                    if (t)
                        te(t.doc)
                }
                if (t)
                    Ms(t, "markerCleared", t, this);
                if (e)
                    qe(t);
                if (this.parent)
                    this.parent.clear()
            }
            ,
            Ba.prototype.find = function(t, e) {
                if (t == null && this.type == "bookmark")
                    t = 1;
                var i, a;
                for (var n = 0; n < this.lines.length; ++n) {
                    var s = this.lines[n];
                    var r = Ja(s.markedSpans, this);
                    if (r.from != null) {
                        i = ft(e ? s : ls(s), r.from);
                        if (t == -1)
                            return i
                    }
                    if (r.to != null) {
                        a = ft(e ? s : ls(s), r.to);
                        if (t == 1)
                            return a
                    }
                }
                return i && {
                    from: i,
                    to: a
                }
            }
            ,
            Ba.prototype.changed = function() {
                var s = this.find(-1, true)
                    , r = this
                    , o = this.doc.cm;
                if (!s || !o)
                    return;
                ni(o, function() {
                    var t = s.line
                        , e = ls(s.line);
                    var i = Te(o, e);
                    if (i) {
                        ke(i);
                        o.curOp.selectionChanged = o.curOp.forceUpdate = true
                    }
                    o.curOp.updateMaxLine = true;
                    if (!bn(r.doc, t) && r.height != null) {
                        var a = r.height;
                        r.height = null;
                        var n = wn(r) - a;
                        if (n)
                            os(t, t.height + n)
                    }
                })
            }
            ,
            Ba.prototype.attachLine = function(t) {
                if (!this.lines.length && this.doc.cm) {
                    var e = this.doc.cm.curOp;
                    if (!e.maybeHiddenMarkers || er(e.maybeHiddenMarkers, this) == -1)
                        (e.maybeUnhiddenMarkers || (e.maybeUnhiddenMarkers = [])).push(this)
                }
                this.lines.push(t)
            }
            ,
            Ba.prototype.detachLine = function(t) {
                this.lines.splice(er(this.lines, t), 1);
                if (!this.lines.length && this.doc.cm) {
                    var e = this.doc.cm.curOp;
                    (e.maybeHiddenMarkers || (e.maybeHiddenMarkers = [])).push(this)
                }
            }
        ;
        var Wa = 0;
        function ja(e, i, a, t, n) {
            if (t && t.shared)
                return za(e, i, a, t, n);
            if (e.cm && !e.cm.curOp)
                return si(e.cm, ja)(e, i, a, t, n);
            var s = new Ba(e,n)
                , r = mt(i, a);
            if (t)
                sr(t, s, false);
            if (r > 0 || r == 0 && s.clearWhenEmpty !== false)
                return s;
            if (s.replacedWith) {
                s.collapsed = true;
                s.widgetNode = fr("span", [s.replacedWith], "CodeMirror-widget");
                if (!t.handleMouseEvents)
                    s.widgetNode.setAttribute("cm-ignore-events", "true");
                if (t.insertLeft)
                    s.widgetNode.insertLeft = true
            }
            if (s.collapsed) {
                if (gn(e, i.line, i, a, s) || i.line != a.line && gn(e, a.line, i, a, s))
                    throw new Error("Inserting collapsed marker partially overlapping an existing one");
                v = true
            }
            if (s.addToHistory)
                gs(e, {
                    from: i,
                    to: a,
                    origin: "markText"
                }, e.sel, NaN);
            var o = i.line, l = e.cm, c;
            e.iter(o, a.line + 1, function(t) {
                if (l && s.collapsed && !l.options.lineWrapping && _n(t) == l.display.maxLine)
                    c = true;
                if (s.collapsed && o != i.line)
                    os(t, 0);
                tn(t, new qa(s,o == i.line ? i.ch : null,o == a.line ? a.ch : null));
                ++o
            });
            if (s.collapsed)
                e.iter(i.line, a.line + 1, function(t) {
                    if (bn(e, t))
                        os(t, 0)
                });
            if (s.clearOnEnter)
                As(s, "beforeCursorEnter", function() {
                    s.clear()
                });
            if (s.readOnly) {
                h = true;
                if (e.history.done.length || e.history.undone.length)
                    e.clearHistory()
            }
            if (s.collapsed) {
                s.id = ++Wa;
                s.atomic = true
            }
            if (l) {
                if (c)
                    l.curOp.updateMaxLine = true;
                if (s.collapsed)
                    di(l, i.line, a.line + 1);
                else if (s.className || s.title || s.startStyle || s.endStyle || s.css)
                    for (var d = i.line; d <= a.line; d++)
                        ui(l, d, "text");
                if (s.atomic)
                    te(l.doc);
                Ms(l, "markerAdded", l, s)
            }
            return s
        }
        var Ga = F.SharedTextMarker = function(t, e) {
                this.markers = t;
                this.primary = e;
                for (var i = 0; i < t.length; ++i)
                    t[i].parent = this
            }
        ;
        function za(t, i, a, n, s) {
            n = sr(n);
            n.shared = false;
            var r = [ja(t, i, a, n, s)]
                , o = r[0];
            var l = n.widgetNode;
            is(t, function(t) {
                if (l)
                    n.widgetNode = l.cloneNode(true);
                r.push(ja(t, Vt(t, i), Vt(t, a), n, s));
                for (var e = 0; e < t.linked.length; ++e)
                    if (t.linked[e].isParent)
                        return;
                o = Zs(r)
            });
            return new Ga(r,o)
        }
        function Ya(t) {
            return t.findMarks(ft(t.first, 0), t.clipPos(ft(t.lastLine())), function(t) {
                return t.parent
            })
        }
        function Ka(t, e) {
            for (var i = 0; i < e.length; i++) {
                var a = e[i]
                    , n = a.find();
                var s = t.clipPos(n.from)
                    , r = t.clipPos(n.to);
                if (mt(s, r)) {
                    var o = ja(t, s, r, a.primary, a.primary.type);
                    a.markers.push(o);
                    o.parent = a
                }
            }
        }
        function Qa(t) {
            for (var e = 0; e < t.length; e++) {
                var i = t[e]
                    , a = [i.primary.doc];
                is(i.primary.doc, function(t) {
                    a.push(t)
                });
                for (var n = 0; n < i.markers.length; n++) {
                    var s = i.markers[n];
                    if (er(a, s.doc) == -1) {
                        s.parent = null;
                        i.markers.splice(n--, 1)
                    }
                }
            }
        }
        function qa(t, e, i) {
            this.marker = t;
            this.from = e;
            this.to = i
        }
        function Ja(t, e) {
            if (t)
                for (var i = 0; i < t.length; ++i) {
                    var a = t[i];
                    if (a.marker == e)
                        return a
                }
        }
        function Za(t, e) {
            for (var i, a = 0; a < t.length; ++a)
                if (t[a] != e)
                    (i || (i = [])).push(t[a]);
            return i
        }
        function tn(t, e) {
            t.markedSpans = t.markedSpans ? t.markedSpans.concat([e]) : [e];
            e.marker.attachLine(t)
        }
        function en(t, e, i) {
            if (t)
                for (var a = 0, n; a < t.length; ++a) {
                    var s = t[a]
                        , r = s.marker;
                    var o = s.from == null || (r.inclusiveLeft ? s.from <= e : s.from < e);
                    if (o || s.from == e && r.type == "bookmark" && (!i || !s.marker.insertLeft)) {
                        var l = s.to == null || (r.inclusiveRight ? s.to >= e : s.to > e);
                        (n || (n = [])).push(new qa(r,s.from,l ? null : s.to))
                    }
                }
            return n
        }
        function an(t, e, i) {
            if (t)
                for (var a = 0, n; a < t.length; ++a) {
                    var s = t[a]
                        , r = s.marker;
                    var o = s.to == null || (r.inclusiveRight ? s.to >= e : s.to > e);
                    if (o || s.from == e && r.type == "bookmark" && (!i || s.marker.insertLeft)) {
                        var l = s.from == null || (r.inclusiveLeft ? s.from <= e : s.from < e);
                        (n || (n = [])).push(new qa(r,l ? null : s.from - e,s.to == null ? null : s.to - e))
                    }
                }
            return n
        }
        function nn(t, e) {
            if (e.full)
                return null;
            var i = Ht(t, e.from.line) && ns(t, e.from.line).markedSpans;
            var a = Ht(t, e.to.line) && ns(t, e.to.line).markedSpans;
            if (!i && !a)
                return null;
            var n = e.from.ch
                , s = e.to.ch
                , r = mt(e.from, e.to) == 0;
            var o = en(i, n, r);
            var l = an(a, s, r);
            var c = e.text.length == 1
                , d = Zs(e.text).length + (c ? n : 0);
            if (o) {
                for (var u = 0; u < o.length; ++u) {
                    var h = o[u];
                    if (h.to == null) {
                        var p = Ja(l, h.marker);
                        if (!p)
                            h.to = n;
                        else if (c)
                            h.to = p.to == null ? null : p.to + d
                    }
                }
            }
            if (l) {
                for (var u = 0; u < l.length; ++u) {
                    var h = l[u];
                    if (h.to != null)
                        h.to += d;
                    if (h.from == null) {
                        var p = Ja(o, h.marker);
                        if (!p) {
                            h.from = d;
                            if (c)
                                (o || (o = [])).push(h)
                        }
                    } else {
                        h.from += d;
                        if (c)
                            (o || (o = [])).push(h)
                    }
                }
            }
            if (o)
                o = sn(o);
            if (l && l != o)
                l = sn(l);
            var f = [o];
            if (!c) {
                var m = e.text.length - 2, g;
                if (m > 0 && o)
                    for (var u = 0; u < o.length; ++u)
                        if (o[u].to == null)
                            (g || (g = [])).push(new qa(o[u].marker,null,null));
                for (var u = 0; u < m; ++u)
                    f.push(g);
                f.push(l)
            }
            return f
        }
        function sn(t) {
            for (var e = 0; e < t.length; ++e) {
                var i = t[e];
                if (i.from != null && i.from == i.to && i.marker.clearWhenEmpty !== false)
                    t.splice(e--, 1)
            }
            if (!t.length)
                return null;
            return t
        }
        function rn(t, e) {
            var i = Ts(t, e);
            var a = nn(t, e);
            if (!i)
                return a;
            if (!a)
                return i;
            for (var n = 0; n < i.length; ++n) {
                var s = i[n]
                    , r = a[n];
                if (s && r) {
                    t: for (var o = 0; o < r.length; ++o) {
                        var l = r[o];
                        for (var c = 0; c < s.length; ++c)
                            if (s[c].marker == l.marker)
                                continue t;
                        s.push(l)
                    }
                } else if (r) {
                    i[n] = r
                }
            }
            return i
        }
        function on(t, e, i) {
            var a = null;
            t.iter(e.line, i.line + 1, function(t) {
                if (t.markedSpans)
                    for (var e = 0; e < t.markedSpans.length; ++e) {
                        var i = t.markedSpans[e].marker;
                        if (i.readOnly && (!a || er(a, i) == -1))
                            (a || (a = [])).push(i)
                    }
            });
            if (!a)
                return null;
            var n = [{
                from: e,
                to: i
            }];
            for (var s = 0; s < a.length; ++s) {
                var r = a[s]
                    , o = r.find(0);
                for (var l = 0; l < n.length; ++l) {
                    var c = n[l];
                    if (mt(c.to, o.from) < 0 || mt(c.from, o.to) > 0)
                        continue;
                    var d = [l, 1]
                        , u = mt(c.from, o.from)
                        , h = mt(c.to, o.to);
                    if (u < 0 || !r.inclusiveLeft && !u)
                        d.push({
                            from: c.from,
                            to: o.from
                        });
                    if (h > 0 || !r.inclusiveRight && !h)
                        d.push({
                            from: o.to,
                            to: c.to
                        });
                    n.splice.apply(n, d);
                    l += d.length - 1
                }
            }
            return n
        }
        function ln(t) {
            var e = t.markedSpans;
            if (!e)
                return;
            for (var i = 0; i < e.length; ++i)
                e[i].marker.detachLine(t);
            t.markedSpans = null
        }
        function cn(t, e) {
            if (!e)
                return;
            for (var i = 0; i < e.length; ++i)
                e[i].marker.attachLine(t);
            t.markedSpans = e
        }
        function dn(t) {
            return t.inclusiveLeft ? -1 : 0
        }
        function un(t) {
            return t.inclusiveRight ? 1 : 0
        }
        function hn(t, e) {
            var i = t.lines.length - e.lines.length;
            if (i != 0)
                return i;
            var a = t.find()
                , n = e.find();
            var s = mt(a.from, n.from) || dn(t) - dn(e);
            if (s)
                return -s;
            var r = mt(a.to, n.to) || un(t) - un(e);
            if (r)
                return r;
            return e.id - t.id
        }
        function pn(t, e) {
            var i = v && t.markedSpans, a;
            if (i)
                for (var n, s = 0; s < i.length; ++s) {
                    n = i[s];
                    if (n.marker.collapsed && (e ? n.from : n.to) == null && (!a || hn(a, n.marker) < 0))
                        a = n.marker
                }
            return a
        }
        function fn(t) {
            return pn(t, true)
        }
        function mn(t) {
            return pn(t, false)
        }
        function gn(t, e, i, a, n) {
            var s = ns(t, e);
            var r = v && s.markedSpans;
            if (r)
                for (var o = 0; o < r.length; ++o) {
                    var l = r[o];
                    if (!l.marker.collapsed)
                        continue;
                    var c = l.marker.find(0);
                    var d = mt(c.from, i) || dn(l.marker) - dn(n);
                    var u = mt(c.to, a) || un(l.marker) - un(n);
                    if (d >= 0 && u <= 0 || d <= 0 && u >= 0)
                        continue;
                    if (d <= 0 && (mt(c.to, i) > 0 || l.marker.inclusiveRight && n.inclusiveLeft) || d >= 0 && (mt(c.from, a) < 0 || l.marker.inclusiveLeft && n.inclusiveRight))
                        return true
                }
        }
        function _n(t) {
            var e;
            while (e = fn(t))
                t = e.find(-1, true).line;
            return t
        }
        function vn(t) {
            var e, i;
            while (e = mn(t)) {
                t = e.find(1, true).line;
                (i || (i = [])).push(t)
            }
            return i
        }
        function Fn(t, e) {
            var i = ns(t, e)
                , a = _n(i);
            if (i == a)
                return e;
            return ls(a)
        }
        function yn(t, e) {
            if (e > t.lastLine())
                return e;
            var i = ns(t, e), a;
            if (!bn(t, i))
                return e;
            while (a = mn(i))
                i = a.find(1, true).line;
            return ls(i) + 1
        }
        function bn(t, e) {
            var i = v && e.markedSpans;
            if (i)
                for (var a, n = 0; n < i.length; ++n) {
                    a = i[n];
                    if (!a.marker.collapsed)
                        continue;
                    if (a.from == null)
                        return true;
                    if (a.marker.widgetNode)
                        continue;
                    if (a.from == 0 && a.marker.inclusiveLeft && Tn(t, e, a))
                        return true
                }
        }
        function Tn(t, e, i) {
            if (i.to == null) {
                var a = i.marker.find(1, true);
                return Tn(t, a.line, Ja(a.line.markedSpans, i.marker))
            }
            if (i.marker.inclusiveRight && i.to == e.text.length)
                return true;
            for (var n, s = 0; s < e.markedSpans.length; ++s) {
                n = e.markedSpans[s];
                if (n.marker.collapsed && !n.marker.widgetNode && n.from == i.to && (n.to == null || n.to != i.from) && (n.marker.inclusiveLeft || i.marker.inclusiveRight) && Tn(t, e, n))
                    return true
            }
        }
        Hs(Ga),
            Ga.prototype.clear = function() {
                if (this.explicitlyCleared)
                    return;
                this.explicitlyCleared = true;
                for (var t = 0; t < this.markers.length; ++t)
                    this.markers[t].clear();
                Ms(this, "clear")
            }
            ,
            Ga.prototype.find = function(t, e) {
                return this.primary.find(t, e)
            }
        ;
        var Cn = F.LineWidget = function(t, e, i) {
                if (i)
                    for (var a in i)
                        if (i.hasOwnProperty(a))
                            this[a] = i[a];
                this.doc = t;
                this.node = e
            }
        ;
        function xn(t, e, i) {
            if (ds(e) < (t.curOp && t.curOp.scrollTop || t.doc.scrollTop))
                ga(t, null, i)
        }
        function wn(t) {
            if (t.height != null)
                return t.height;
            var e = t.doc.cm;
            if (!e)
                return 0;
            if (!_r(document.body, t.node)) {
                var i = "position: relative;";
                if (t.coverGutter)
                    i += "margin-left: -" + e.display.gutters.offsetWidth + "px;";
                if (t.noHScroll)
                    i += "width: " + e.display.wrapper.clientWidth + "px;";
                gr(e.display.measure, fr("div", [t.node], null, i))
            }
            return t.height = t.node.offsetHeight
        }
        function En(a, t, e, i) {
            var n = new Cn(a,e,i);
            var s = a.cm;
            if (s && n.noHScroll)
                s.display.alignWidgets = true;
            ya(a, t, "widget", function(t) {
                var e = t.widgets || (t.widgets = []);
                if (n.insertAt == null)
                    e.push(n);
                else
                    e.splice(Math.min(e.length - 1, Math.max(0, n.insertAt)), 0, n);
                n.line = t;
                if (s && !bn(a, t)) {
                    var i = ds(t) < a.scrollTop;
                    os(t, t.height + wn(n));
                    if (i)
                        ga(s, null, n.height);
                    s.curOp.forceUpdate = true
                }
                return true
            });
            return n
        }
        Hs(Cn),
            Cn.prototype.clear = function() {
                var t = this.doc.cm
                    , e = this.line.widgets
                    , i = this.line
                    , a = ls(i);
                if (a == null || !e)
                    return;
                for (var n = 0; n < e.length; ++n)
                    if (e[n] == this)
                        e.splice(n--, 1);
                if (!e.length)
                    i.widgets = null;
                var s = wn(this);
                os(i, Math.max(0, i.height - s));
                if (t)
                    ni(t, function() {
                        xn(t, i, -s);
                        ui(t, a, "widget")
                    })
            }
            ,
            Cn.prototype.changed = function() {
                var t = this.height
                    , e = this.doc.cm
                    , i = this.line;
                this.height = null;
                var a = wn(this) - t;
                if (!a)
                    return;
                os(i, i.height + a);
                if (e)
                    ni(e, function() {
                        e.curOp.forceUpdate = true;
                        xn(e, i, a)
                    })
            }
        ;
        var Xn = F.Line = function(t, e, i) {
                this.text = t;
                cn(this, e);
                this.height = i ? i(this) : 1
            }
        ;
        function In(t, e, i, a) {
            t.text = e;
            if (t.stateAfter)
                t.stateAfter = null;
            if (t.styles)
                t.styles = null;
            if (t.order != null)
                t.order = null;
            ln(t);
            cn(t, i);
            var n = a ? a(t) : 1;
            if (n != t.height)
                os(t, n)
        }
        function Sn(t) {
            t.parent = null;
            ln(t)
        }
        function kn(t, e) {
            if (t)
                for (; ; ) {
                    var i = t.match(/(?:^|\s+)line-(background-)?(\S+)/);
                    if (!i)
                        break;
                    t = t.slice(0, i.index) + t.slice(i.index + i[0].length);
                    var a = i[1] ? "bgClass" : "textClass";
                    if (e[a] == null)
                        e[a] = i[2];
                    else if (!new RegExp("(?:^|s)" + i[2] + "(?:$|s)").test(e[a]))
                        e[a] += " " + i[2]
                }
            return t
        }
        function Un(t, e) {
            if (t.blankLine)
                return t.blankLine(e);
            if (!t.innerMode)
                return;
            var i = F.innerMode(t, e);
            if (i.mode.blankLine)
                return i.mode.blankLine(i.state)
        }
        function Dn(t, e, i, a) {
            for (var n = 0; n < 10; n++) {
                if (a)
                    a[0] = F.innerMode(t, i).mode;
                var s = t.token(e, i);
                if (e.pos > e.start)
                    return s
            }
            throw new Error("Mode " + t.name + " failed to advance stream.")
        }
        function An(t, e, i, a) {
            function n(t) {
                return {
                    start: d.start,
                    end: d.pos,
                    string: d.current(),
                    type: o || null,
                    state: t ? Aa(s.mode, c) : c
                }
            }
            var s = t.doc, r = s.mode, o;
            e = Vt(s, e);
            var l = ns(s, e.line)
                , c = ue(t, e.line, i);
            var d = new Ha(l.text,t.options.tabSize), u;
            if (a)
                u = [];
            while ((a || d.pos < e.ch) && !d.eol()) {
                d.start = d.pos;
                o = Dn(r, d, c);
                if (a)
                    u.push(n(true))
            }
            return a ? u : n()
        }
        function On(t, e, i, a, n, s, r) {
            var o = i.flattenSpans;
            if (o == null)
                o = t.options.flattenSpans;
            var l = 0
                , c = null;
            var d = new Ha(e,t.options.tabSize), u;
            var h = t.options.addModeClass && [null];
            if (e == "")
                kn(Un(i, a), s);
            while (!d.eol()) {
                if (d.pos > t.options.maxHighlightLength) {
                    o = false;
                    if (r)
                        Mn(t, e, a, d.pos);
                    d.pos = e.length;
                    u = null
                } else {
                    u = kn(Dn(i, d, a, h), s)
                }
                if (h) {
                    var p = h[0].name;
                    if (p)
                        u = "m-" + (u ? p + " " + u : p)
                }
                if (!o || c != u) {
                    while (l < d.start) {
                        l = Math.min(d.start, l + 5e4);
                        n(l, c)
                    }
                    c = u
                }
                d.start = d.pos
            }
            while (l < d.pos) {
                var f = Math.min(d.pos, l + 5e4);
                n(f, c);
                l = f
            }
        }
        function Nn(t, e, i, a) {
            var s = [t.state.modeGen]
                , n = {};
            On(t, e.text, t.doc.mode, i, function(t, e) {
                s.push(t, e)
            }, n, a);
            for (var r = 0; r < t.state.overlays.length; ++r) {
                var o = t.state.overlays[r]
                    , l = 1
                    , c = 0;
                On(t, e.text, o.mode, true, function(t, e) {
                    var i = l;
                    while (c < t) {
                        var a = s[l];
                        if (a > t)
                            s.splice(l, 1, t, s[l + 1], a);
                        l += 2;
                        c = Math.min(t, a)
                    }
                    if (!e)
                        return;
                    if (o.opaque) {
                        s.splice(i, l - i, t, "cm-overlay " + e);
                        l = i + 2
                    } else {
                        for (; i < l; i += 2) {
                            var n = s[i + 1];
                            s[i + 1] = (n ? n + " " : "") + "cm-overlay " + e
                        }
                    }
                }, n)
            }
            return {
                styles: s,
                classes: n.bgClass || n.textClass ? n : null
            }
        }
        function Ln(t, e, i) {
            if (!e.styles || e.styles[0] != t.state.modeGen) {
                var a = Nn(t, e, e.stateAfter = ue(t, ls(e)));
                e.styles = a.styles;
                if (a.classes)
                    e.styleClasses = a.classes;
                else if (e.styleClasses)
                    e.styleClasses = null;
                if (i === t.doc.frontier)
                    t.doc.frontier++
            }
            return e.styles
        }
        function Mn(t, e, i, a) {
            var n = t.doc.mode;
            var s = new Ha(e,t.options.tabSize);
            s.start = s.pos = a || 0;
            if (e == "")
                Un(n, i);
            while (!s.eol() && s.pos <= t.options.maxHighlightLength) {
                Dn(n, s, i);
                s.start = s.pos
            }
        }
        Hs(Xn),
            Xn.prototype.lineNo = function() {
                return ls(this)
            }
        ;
        var Pn = {}
            , Rn = {};
        function Vn(t, e) {
            if (!t || /^\s*$/.test(t))
                return null;
            var i = e.addModeClass ? Rn : Pn;
            return i[t] || (i[t] = t.replace(/\S+/g, "cm-$&"))
        }
        function $n(t, e) {
            var i = fr("span", null, "CodeMirror-line-content", f ? "padding-right: .1px" : null);
            var a = {
                pre: fr("pre", [i], "CodeMirror-line"),
                content: i,
                col: 0,
                pos: 0,
                cm: t,
                splitSpaces: (y || f) && t.getOption("lineWrapping")
            };
            e.measure = {};
            for (var n = 0; n <= (e.rest ? e.rest.length : 0); n++) {
                var s = n ? e.rest[n - 1] : e.line, r;
                a.pos = 0;
                a.addToken = Wn;
                if (Ur(t.display.measure) && (r = us(s)))
                    a.addToken = jn(a.addToken, r);
                a.map = [];
                var o = e != t.display.externalMeasured && ls(s);
                zn(s, a, Ln(t, s, o));
                if (s.styleClasses) {
                    if (s.styleClasses.bgClass)
                        a.bgClass = Tr(s.styleClasses.bgClass, a.bgClass || "");
                    if (s.styleClasses.textClass)
                        a.textClass = Tr(s.styleClasses.textClass, a.textClass || "")
                }
                if (a.map.length == 0)
                    a.map.push(0, 0, a.content.appendChild(kr(t.display.measure)));
                if (n == 0) {
                    e.measure.map = a.map;
                    e.measure.cache = {}
                } else {
                    (e.measure.maps || (e.measure.maps = [])).push(a.map);
                    (e.measure.caches || (e.measure.caches = [])).push({})
                }
            }
            if (f && /\bcm-tab\b/.test(a.content.lastChild.className))
                a.content.className = "cm-tab-wrap-hack";
            Ns(t, "renderLine", t, e.line, a.pre);
            if (a.pre.className)
                a.textClass = Tr(a.pre.className, a.textClass || "");
            return a
        }
        function Hn(t) {
            var e = fr("span", "", "cm-invalidchar");
            e.title = "\\u" + t.charCodeAt(0).toString(16);
            e.setAttribute("aria-label", e.title);
            return e
        }
        function Wn(t, e, i, a, n, s, r, o) {
            if (!e)
                return;
            var l = t.splitSpaces ? e.replace(/ {3,}/g, Bn) : e;
            var c = t.cm.state.specialChars
                , d = false;
            if (!c.test(e)) {
                t.col += e.length;
                var u = document.createTextNode(l);
                t.map.push(t.pos, t.pos + e.length, u);
                if (y && b < 9)
                    d = true;
                t.pos += e.length
            } else {
                var u = document.createDocumentFragment()
                    , h = 0;
                while (true) {
                    c.lastIndex = h;
                    var p = c.exec(e);
                    var f = p ? p.index - h : e.length - h;
                    if (f) {
                        var m = document.createTextNode(l.slice(h, h + f));
                        if (y && b < 9)
                            u.appendChild(fr("span", [m]));
                        else
                            u.appendChild(m);
                        t.map.push(t.pos, t.pos + f, m);
                        t.col += f;
                        t.pos += f
                    }
                    if (!p)
                        break;
                    h += f + 1;
                    if (p[0] == "\t") {
                        var g = t.cm.options.tabSize
                            , _ = g - t.col % g;
                        var m = u.appendChild(fr("span", Js(_), "cm-tab"));
                        m.setAttribute("role", "presentation");
                        m.setAttribute("cm-text", "\t");
                        t.col += _
                    } else {
                        var m = t.cm.options.specialCharPlaceholder(p[0]);
                        m.setAttribute("cm-text", p[0]);
                        if (y && b < 9)
                            u.appendChild(fr("span", [m]));
                        else
                            u.appendChild(m);
                        t.col += 1
                    }
                    t.map.push(t.pos, t.pos + 1, m);
                    t.pos++
                }
            }
            if (i || a || n || d || r || o) {
                var v = i || "";
                if (a)
                    v += a;
                if (n)
                    v += n;
                var F = fr("span", [u], v, r, o);
                if (s)
                    F.title = s;
                return t.content.appendChild(F)
            }
            t.content.appendChild(u)
        }
        function Bn(t) {
            var e = " ";
            for (var i = 0; i < t.length - 2; ++i)
                e += i % 2 ? " " : "";
            e += " ";
            return e
        }
        function jn(u, h) {
            return function(t, e, i, a, n, s, r) {
                i = i ? i + " cm-force-border" : "cm-force-border";
                var o = t.pos
                    , l = o + e.length;
                for (; ; ) {
                    for (var c = 0; c < h.length; c++) {
                        var d = h[c];
                        if (d.to > o && d.from <= o)
                            break
                    }
                    if (d.to >= l)
                        return u(t, e, i, a, n, s, r);
                    u(t, e.slice(0, d.to - o), i, a, null, s, r);
                    a = null;
                    e = e.slice(d.to - o);
                    o = d.to
                }
            }
        }
        function Gn(t, e, i, a) {
            var n = !a && i.widgetNode;
            if (n)
                t.map.push(t.pos, t.pos + e, n);
            if (!a && t.cm.display.input.needsContentAttribute) {
                if (!n)
                    n = t.content.appendChild(document.createElement("span"));
                n.setAttribute("cm-marker", i.id)
            }
            if (n) {
                t.cm.display.input.setUneditable(n);
                t.content.appendChild(n)
            }
            t.pos += e
        }
        function zn(t, e, i) {
            var a = t.markedSpans
                , n = t.text
                , s = 0;
            if (!a) {
                for (var r = 1; r < i.length; r += 2)
                    e.addToken(e, n.slice(s, s = i[r]), Vn(i[r + 1], e.cm.options));
                return
            }
            var o = n.length, l = 0, r = 1, c = "", d, u, h;
            var p = 0, f, m, g, _, v;
            for (; ; ) {
                if (p == l) {
                    f = m = g = _ = u = "";
                    h = null;
                    v = null;
                    p = Infinity;
                    var F = [];
                    for (var y = 0; y < a.length; ++y) {
                        var b = a[y]
                            , T = b.marker;
                        if (T.type == "bookmark" && b.from == l && T.widgetNode) {
                            F.push(T)
                        } else if (b.from <= l && (b.to == null || b.to > l || T.collapsed && b.to == l && b.from == l)) {
                            if (b.to != null && b.to != l && p > b.to) {
                                p = b.to;
                                m = ""
                            }
                            if (T.className)
                                f += " " + T.className;
                            if (T.attr)
                                h = T.attr;
                            if (T.css)
                                u = T.css;
                            if (T.startStyle && b.from == l)
                                g += " " + T.startStyle;
                            if (T.endStyle && b.to == p)
                                m += " " + T.endStyle;
                            if (T.title && !_)
                                _ = T.title;
                            if (T.collapsed && (!v || hn(v.marker, T) < 0))
                                v = b
                        } else if (b.from > l && p > b.from) {
                            p = b.from
                        }
                    }
                    if (v && (v.from || 0) == l) {
                        Gn(e, (v.to == null ? o + 1 : v.to) - l, v.marker, v.from == null);
                        if (v.to == null)
                            return;
                        if (v.to == l)
                            v = false
                    }
                    if (!v && F.length)
                        for (var y = 0; y < F.length; ++y)
                            Gn(e, 0, F[y])
                }
                if (l >= o)
                    break;
                var C = Math.min(o, p);
                while (true) {
                    if (c) {
                        var x = l + c.length;
                        if (!v) {
                            var w = x > C ? c.slice(0, C - l) : c;
                            e.addToken(e, w, d ? d + f : f, g, l + w.length == p ? m : "", _, u, h)
                        }
                        if (x >= C) {
                            c = c.slice(C - l);
                            l = C;
                            break
                        }
                        l = x;
                        g = ""
                    }
                    c = n.slice(s, s = i[r++]);
                    d = Vn(i[r++], e.cm.options)
                }
            }
        }
        function Yn(t, e) {
            return e.from.ch == 0 && e.to.ch == 0 && Zs(e.text) == "" && (!t.cm || t.cm.options.wholeLineUpdateBefore)
        }
        function Kn(t, a, e, n) {
            function s(t) {
                return e ? e[t] : null
            }
            function i(t, e, i) {
                In(t, e, i, n);
                Ms(t, "change", t, a)
            }
            function r(t, e) {
                for (var i = t, a = []; i < e; ++i)
                    a.push(new Xn(c[i],s(i),n));
                return a
            }
            var o = a.from
                , l = a.to
                , c = a.text;
            var d = ns(t, o.line)
                , u = ns(t, l.line);
            var h = Zs(c)
                , p = s(c.length - 1)
                , f = l.line - o.line;
            if (a.full) {
                t.insert(0, r(0, c.length));
                t.remove(c.length, t.size - c.length)
            } else if (Yn(t, a)) {
                var m = r(0, c.length - 1);
                i(u, u.text, p);
                if (f)
                    t.remove(o.line, f);
                if (m.length)
                    t.insert(o.line, m)
            } else if (d == u) {
                if (c.length == 1) {
                    i(d, d.text.slice(0, o.ch) + h + d.text.slice(l.ch), p)
                } else {
                    var m = r(1, c.length - 1);
                    m.push(new Xn(h + d.text.slice(l.ch),p,n));
                    i(d, d.text.slice(0, o.ch) + c[0], s(0));
                    t.insert(o.line + 1, m)
                }
            } else if (c.length == 1) {
                i(d, d.text.slice(0, o.ch) + c[0] + u.text.slice(l.ch), s(0));
                t.remove(o.line + 1, f)
            } else {
                i(d, d.text.slice(0, o.ch) + c[0], s(0));
                i(u, h + u.text.slice(l.ch), p);
                var m = r(1, c.length - 1);
                if (f > 1)
                    t.remove(o.line + 1, f - 1);
                t.insert(o.line + 1, m)
            }
            Ms(t, "change", t, a)
        }
        function Qn(t) {
            this.lines = t;
            this.parent = null;
            for (var e = 0, i = 0; e < t.length; ++e) {
                t[e].parent = this;
                i += t[e].height
            }
            this.height = i
        }
        function qn(t) {
            this.children = t;
            var e = 0
                , i = 0;
            for (var a = 0; a < t.length; ++a) {
                var n = t[a];
                e += n.chunkSize();
                i += n.height;
                n.parent = this
            }
            this.size = e;
            this.height = i;
            this.parent = null
        }
        Qn.prototype = {
            chunkSize: function() {
                return this.lines.length
            },
            removeInner: function(t, e) {
                for (var i = t, a = t + e; i < a; ++i) {
                    var n = this.lines[i];
                    this.height -= n.height;
                    Sn(n);
                    Ms(n, "delete")
                }
                this.lines.splice(t, e)
            },
            collapse: function(t) {
                t.push.apply(t, this.lines)
            },
            insertInner: function(t, e, i) {
                this.height += i;
                this.lines = this.lines.slice(0, t).concat(e).concat(this.lines.slice(t));
                for (var a = 0; a < e.length; ++a)
                    e[a].parent = this
            },
            iterN: function(t, e, i) {
                for (var a = t + e; t < a; ++t)
                    if (i(this.lines[t]))
                        return true
            }
        },
            qn.prototype = {
                chunkSize: function() {
                    return this.size
                },
                removeInner: function(t, e) {
                    this.size -= e;
                    for (var i = 0; i < this.children.length; ++i) {
                        var a = this.children[i]
                            , n = a.chunkSize();
                        if (t < n) {
                            var s = Math.min(e, n - t)
                                , r = a.height;
                            a.removeInner(t, s);
                            this.height -= r - a.height;
                            if (n == s) {
                                this.children.splice(i--, 1);
                                a.parent = null
                            }
                            if ((e -= s) == 0)
                                break;
                            t = 0
                        } else
                            t -= n
                    }
                    if (this.size - e < 25 && (this.children.length > 1 || !(this.children[0]instanceof Qn))) {
                        var o = [];
                        this.collapse(o);
                        this.children = [new Qn(o)];
                        this.children[0].parent = this
                    }
                },
                collapse: function(t) {
                    for (var e = 0; e < this.children.length; ++e)
                        this.children[e].collapse(t)
                },
                insertInner: function(t, e, i) {
                    this.size += e.length;
                    this.height += i;
                    for (var a = 0; a < this.children.length; ++a) {
                        var n = this.children[a]
                            , s = n.chunkSize();
                        if (t <= s) {
                            n.insertInner(t, e, i);
                            if (n.lines && n.lines.length > 50) {
                                while (n.lines.length > 50) {
                                    var r = n.lines.splice(n.lines.length - 25, 25);
                                    var o = new Qn(r);
                                    n.height -= o.height;
                                    this.children.splice(a + 1, 0, o);
                                    o.parent = this
                                }
                                this.maybeSpill()
                            }
                            break
                        }
                        t -= s
                    }
                },
                maybeSpill: function() {
                    if (this.children.length <= 10)
                        return;
                    var t = this;
                    do {
                        var e = t.children.splice(t.children.length - 5, 5);
                        var i = new qn(e);
                        if (!t.parent) {
                            var a = new qn(t.children);
                            a.parent = t;
                            t.children = [a, i];
                            t = a
                        } else {
                            t.size -= i.size;
                            t.height -= i.height;
                            var n = er(t.parent.children, t);
                            t.parent.children.splice(n + 1, 0, i)
                        }
                        i.parent = t.parent
                    } while (t.children.length > 10);t.parent.maybeSpill()
                },
                iterN: function(t, e, i) {
                    for (var a = 0; a < this.children.length; ++a) {
                        var n = this.children[a]
                            , s = n.chunkSize();
                        if (t < s) {
                            var r = Math.min(e, s - t);
                            if (n.iterN(t, r, i))
                                return true;
                            if ((e -= r) == 0)
                                break;
                            t = 0
                        } else
                            t -= s
                    }
                }
            };
        var Jn = 0
            , Zn = F.Doc = function(t, e, i) {
                if (!(this instanceof Zn))
                    return new Zn(t,e,i);
                if (i == null)
                    i = 0;
                qn.call(this, [new Qn([new Xn("",null)])]);
                this.first = i;
                this.scrollTop = this.scrollLeft = 0;
                this.cantEdit = false;
                this.cleanGeneration = 1;
                this.frontier = i;
                var a = ft(i, 0);
                this.sel = Pt(a);
                this.history = new hs(null);
                this.id = ++Jn;
                this.modeOption = e;
                if (typeof t == "string")
                    t = Dr(t);
                Kn(this, {
                    from: a,
                    to: a,
                    text: t
                });
                qt(this, Pt(a), js)
            }
        ;
        Zn.prototype = nr(qn.prototype, {
            constructor: Zn,
            iter: function(t, e, i) {
                if (i)
                    this.iterN(t - this.first, e - t, i);
                else
                    this.iterN(this.first, this.first + this.size, t)
            },
            insert: function(t, e) {
                var i = 0;
                for (var a = 0; a < e.length; ++a)
                    i += e[a].height;
                this.insertInner(t - this.first, e, i)
            },
            remove: function(t, e) {
                this.removeInner(t - this.first, e)
            },
            getValue: function(t) {
                var e = rs(this, this.first, this.first + this.size);
                if (t === false)
                    return e;
                return e.join(t || "\n")
            },
            setValue: oi(function(t) {
                var e = ft(this.first, 0)
                    , i = this.first + this.size - 1;
                sa(this, {
                    from: e,
                    to: ft(i, ns(this, i).text.length),
                    text: Dr(t),
                    origin: "setValue",
                    full: true
                }, true);
                qt(this, Pt(e))
            }),
            replaceRange: function(t, e, i, a) {
                e = Vt(this, e);
                i = i ? Vt(this, i) : e;
                ua(this, t, e, i, a)
            },
            getRange: function(t, e, i) {
                var a = ss(this, Vt(this, t), Vt(this, e));
                if (i === false)
                    return a;
                return a.join(i || "\n")
            },
            getLine: function(t) {
                var e = this.getLineHandle(t);
                return e && e.text
            },
            getLineHandle: function(t) {
                if (Ht(this, t))
                    return ns(this, t)
            },
            getLineNumber: function(t) {
                return ls(t)
            },
            getLineHandleVisualStart: function(t) {
                if (typeof t == "number")
                    t = ns(this, t);
                return _n(t)
            },
            lineCount: function() {
                return this.size
            },
            firstLine: function() {
                return this.first
            },
            lastLine: function() {
                return this.first + this.size - 1
            },
            clipPos: function(t) {
                return Vt(this, t)
            },
            getCursor: function(t) {
                var e = this.sel.primary(), i;
                if (t == null || t == "head")
                    i = e.head;
                else if (t == "anchor")
                    i = e.anchor;
                else if (t == "end" || t == "to" || t === false)
                    i = e.to();
                else
                    i = e.from();
                return i
            },
            listSelections: function() {
                return this.sel.ranges
            },
            somethingSelected: function() {
                return this.sel.somethingSelected()
            },
            setCursor: oi(function(t, e, i) {
                Yt(this, Vt(this, typeof t == "number" ? ft(t, e || 0) : t), null, i)
            }),
            setSelection: oi(function(t, e, i) {
                Yt(this, Vt(this, t), Vt(this, e || t), i)
            }),
            extendSelection: oi(function(t, e, i) {
                jt(this, Vt(this, t), e && Vt(this, e), i)
            }),
            extendSelections: oi(function(t, e) {
                Gt(this, Wt(this, t, e))
            }),
            extendSelectionsBy: oi(function(t, e) {
                Gt(this, ir(this.sel.ranges, t), e)
            }),
            setSelections: oi(function(t, e, i) {
                if (!t.length)
                    return;
                for (var a = 0, n = []; a < t.length; a++)
                    n[a] = new Lt(Vt(this, t[a].anchor),Vt(this, t[a].head));
                if (e == null)
                    e = Math.min(t.length - 1, this.sel.primIndex);
                qt(this, Mt(n, e), i)
            }),
            addSelection: oi(function(t, e, i) {
                var a = this.sel.ranges.slice(0);
                a.push(new Lt(Vt(this, t),Vt(this, e || t)));
                qt(this, Mt(a, a.length - 1), i)
            }),
            getSelection: function(t) {
                var e = this.sel.ranges, i;
                for (var a = 0; a < e.length; a++) {
                    var n = ss(this, e[a].from(), e[a].to());
                    i = i ? i.concat(n) : n
                }
                if (t === false)
                    return i;
                else
                    return i.join(t || "\n")
            },
            getSelections: function(t) {
                var e = []
                    , i = this.sel.ranges;
                for (var a = 0; a < i.length; a++) {
                    var n = ss(this, i[a].from(), i[a].to());
                    if (t !== false)
                        n = n.join(t || "\n");
                    e[a] = n
                }
                return e
            },
            replaceSelection: function(t, e, i) {
                var a = [];
                for (var n = 0; n < this.sel.ranges.length; n++)
                    a[n] = t;
                this.replaceSelections(a, e, i || "+input")
            },
            replaceSelections: oi(function(t, e, i) {
                var a = []
                    , n = this.sel;
                for (var s = 0; s < n.ranges.length; s++) {
                    var r = n.ranges[s];
                    a[s] = {
                        from: r.from(),
                        to: r.to(),
                        text: Dr(t[s]),
                        origin: i
                    }
                }
                var o = e && e != "end" && aa(this, a, e);
                for (var s = a.length - 1; s >= 0; s--)
                    sa(this, a[s]);
                if (o)
                    Qt(this, o);
                else if (this.cm)
                    _a(this.cm)
            }),
            undo: oi(function() {
                oa(this, "undo")
            }),
            redo: oi(function() {
                oa(this, "redo")
            }),
            undoSelection: oi(function() {
                oa(this, "undo", true)
            }),
            redoSelection: oi(function() {
                oa(this, "redo", true)
            }),
            setExtending: function(t) {
                this.extend = t
            },
            getExtending: function() {
                return this.extend
            },
            historySize: function() {
                var t = this.history
                    , e = 0
                    , i = 0;
                for (var a = 0; a < t.done.length; a++)
                    if (!t.done[a].ranges)
                        ++e;
                for (var a = 0; a < t.undone.length; a++)
                    if (!t.undone[a].ranges)
                        ++i;
                return {
                    undo: e,
                    redo: i
                }
            },
            clearHistory: function() {
                this.history = new hs(this.history.maxGeneration)
            },
            markClean: function() {
                this.cleanGeneration = this.changeGeneration(true)
            },
            changeGeneration: function(t) {
                if (t)
                    this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;
                return this.history.generation
            },
            isClean: function(t) {
                return this.history.generation == (t || this.cleanGeneration)
            },
            getHistory: function() {
                return {
                    done: Cs(this.history.done),
                    undone: Cs(this.history.undone)
                }
            },
            setHistory: function(t) {
                var e = this.history = new hs(this.history.maxGeneration);
                e.done = Cs(t.done.slice(0), null, true);
                e.undone = Cs(t.undone.slice(0), null, true)
            },
            addLineClass: oi(function(t, i, a) {
                return ya(this, t, i == "gutter" ? "gutter" : "class", function(t) {
                    var e = i == "text" ? "textClass" : i == "background" ? "bgClass" : i == "gutter" ? "gutterClass" : "wrapClass";
                    if (!t[e])
                        t[e] = a;
                    else if (Fr(a).test(t[e]))
                        return false;
                    else
                        t[e] += " " + a;
                    return true
                })
            }),
            removeLineClass: oi(function(t, s, r) {
                return ya(this, t, s == "gutter" ? "gutter" : "class", function(t) {
                    var e = s == "text" ? "textClass" : s == "background" ? "bgClass" : s == "gutter" ? "gutterClass" : "wrapClass";
                    var i = t[e];
                    if (!i)
                        return false;
                    else if (r == null)
                        t[e] = null;
                    else {
                        var a = i.match(Fr(r));
                        if (!a)
                            return false;
                        var n = a.index + a[0].length;
                        t[e] = i.slice(0, a.index) + (!a.index || n == i.length ? "" : " ") + i.slice(n) || null
                    }
                    return true
                })
            }),
            addLineWidget: oi(function(t, e, i) {
                return En(this, t, e, i)
            }),
            removeLineWidget: function(t) {
                t.clear()
            },
            markText: function(t, e, i) {
                return ja(this, Vt(this, t), Vt(this, e), i, "range")
            },
            setBookmark: function(t, e) {
                var i = {
                    replacedWith: e && (e.nodeType == null ? e.widget : e),
                    insertLeft: e && e.insertLeft,
                    clearWhenEmpty: false,
                    shared: e && e.shared,
                    handleMouseEvents: e && e.handleMouseEvents
                };
                t = Vt(this, t);
                return ja(this, t, t, i, "bookmark")
            },
            findMarksAt: function(t) {
                t = Vt(this, t);
                var e = []
                    , i = ns(this, t.line).markedSpans;
                if (i)
                    for (var a = 0; a < i.length; ++a) {
                        var n = i[a];
                        if ((n.from == null || n.from <= t.ch) && (n.to == null || n.to >= t.ch))
                            e.push(n.marker.parent || n.marker)
                    }
                return e
            },
            findMarks: function(n, s, r) {
                n = Vt(this, n);
                s = Vt(this, s);
                var o = []
                    , l = n.line;
                this.iter(n.line, s.line + 1, function(t) {
                    var e = t.markedSpans;
                    if (e)
                        for (var i = 0; i < e.length; i++) {
                            var a = e[i];
                            if (!(l == n.line && n.ch > a.to || a.from == null && l != n.line || l == s.line && a.from > s.ch) && (!r || r(a.marker)))
                                o.push(a.marker.parent || a.marker)
                        }
                    ++l
                });
                return o
            },
            getAllMarks: function() {
                var a = [];
                this.iter(function(t) {
                    var e = t.markedSpans;
                    if (e)
                        for (var i = 0; i < e.length; ++i)
                            if (e[i].from != null)
                                a.push(e[i].marker)
                });
                return a
            },
            posFromIndex: function(i) {
                var a, n = this.first;
                this.iter(function(t) {
                    var e = t.text.length + 1;
                    if (e > i) {
                        a = i;
                        return true
                    }
                    i -= e;
                    ++n
                });
                return Vt(this, ft(n, a))
            },
            indexFromPos: function(t) {
                t = Vt(this, t);
                var e = t.ch;
                if (t.line < this.first || t.ch < 0)
                    return 0;
                this.iter(this.first, t.line, function(t) {
                    e += t.text.length + 1
                });
                return e
            },
            copy: function(t) {
                var e = new Zn(rs(this, this.first, this.first + this.size),this.modeOption,this.first);
                e.scrollTop = this.scrollTop;
                e.scrollLeft = this.scrollLeft;
                e.sel = this.sel;
                e.extend = false;
                if (t) {
                    e.history.undoDepth = this.history.undoDepth;
                    e.setHistory(this.getHistory())
                }
                return e
            },
            linkedDoc: function(t) {
                if (!t)
                    t = {};
                var e = this.first
                    , i = this.first + this.size;
                if (t.from != null && t.from > e)
                    e = t.from;
                if (t.to != null && t.to < i)
                    i = t.to;
                var a = new Zn(rs(this, e, i),t.mode || this.modeOption,e);
                if (t.sharedHist)
                    a.history = this.history;
                (this.linked || (this.linked = [])).push({
                    doc: a,
                    sharedHist: t.sharedHist
                });
                a.linked = [{
                    doc: this,
                    isParent: true,
                    sharedHist: t.sharedHist
                }];
                Ka(a, Ya(this));
                return a
            },
            unlinkDoc: function(t) {
                if (t instanceof F)
                    t = t.doc;
                if (this.linked)
                    for (var e = 0; e < this.linked.length; ++e) {
                        var i = this.linked[e];
                        if (i.doc != t)
                            continue;
                        this.linked.splice(e, 1);
                        t.unlinkDoc(this);
                        Qa(Ya(this));
                        break
                    }
                if (t.history == this.history) {
                    var a = [t.id];
                    is(t, function(t) {
                        a.push(t.id)
                    }, true);
                    t.history = new hs(null);
                    t.history.done = Cs(this.history.done, a);
                    t.history.undone = Cs(this.history.undone, a)
                }
            },
            iterLinkedDocs: function(t) {
                is(this, t)
            },
            getMode: function() {
                return this.mode
            },
            getEditor: function() {
                return this.cm
            }
        }),
            Zn.prototype.eachLine = Zn.prototype.iter;
        var ts = "iter insert remove copy getEditor constructor".split(" ");
        for (var es in Zn.prototype)
            if (Zn.prototype.hasOwnProperty(es) && er(ts, es) < 0)
                F.prototype[es] = function(t) {
                    return function() {
                        return t.apply(this.doc, arguments)
                    }
                }(Zn.prototype[es]);
        function is(t, r, o) {
            function l(t, e, i) {
                if (t.linked)
                    for (var a = 0; a < t.linked.length; ++a) {
                        var n = t.linked[a];
                        if (n.doc == e)
                            continue;
                        var s = i && n.sharedHist;
                        if (o && !s)
                            continue;
                        r(n.doc, s);
                        l(n.doc, t, s)
                    }
            }
            l(t, null, true)
        }
        function as(t, e) {
            if (e.cm)
                throw new Error("This document is already in use.");
            t.doc = e;
            e.cm = t;
            X(t);
            C(t);
            if (!t.options.lineWrapping)
                A(t);
            t.options.mode = e.modeOption;
            di(t)
        }
        function ns(t, e) {
            e -= t.first;
            if (e < 0 || e >= t.size)
                throw new Error("There is no line " + (e + t.first) + " in the document.");
            for (var i = t; !i.lines; ) {
                for (var a = 0; ; ++a) {
                    var n = i.children[a]
                        , s = n.chunkSize();
                    if (e < s) {
                        i = n;
                        break
                    }
                    e -= s
                }
            }
            return i.lines[e]
        }
        function ss(t, i, a) {
            var n = []
                , s = i.line;
            t.iter(i.line, a.line + 1, function(t) {
                var e = t.text;
                if (s == a.line)
                    e = e.slice(0, a.ch);
                if (s == i.line)
                    e = e.slice(i.ch);
                n.push(e);
                ++s
            });
            return n
        }
        function rs(t, e, i) {
            var a = [];
            t.iter(e, i, function(t) {
                a.push(t.text)
            });
            return a
        }
        function os(t, e) {
            var i = e - t.height;
            if (i)
                for (var a = t; a; a = a.parent)
                    a.height += i
        }
        function ls(t) {
            if (t.parent == null)
                return null;
            var e = t.parent
                , i = er(e.lines, t);
            for (var a = e.parent; a; e = a,
                a = a.parent) {
                for (var n = 0; ; ++n) {
                    if (a.children[n] == e)
                        break;
                    i += a.children[n].chunkSize()
                }
            }
            return i + e.first
        }
        function cs(t, e) {
            var i = t.first;
            t: do {
                for (var a = 0; a < t.children.length; ++a) {
                    var n = t.children[a]
                        , s = n.height;
                    if (e < s) {
                        t = n;
                        continue t
                    }
                    e -= s;
                    i += n.chunkSize()
                }
                return i
            } while (!t.lines);for (var a = 0; a < t.lines.length; ++a) {
                var r = t.lines[a]
                    , o = r.height;
                if (e < o)
                    break;
                e -= o
            }
            return i + a
        }
        function ds(t) {
            t = _n(t);
            var e = 0
                , i = t.parent;
            for (var a = 0; a < i.lines.length; ++a) {
                var n = i.lines[a];
                if (n == t)
                    break;
                else
                    e += n.height
            }
            for (var s = i.parent; s; i = s,
                s = i.parent) {
                for (var a = 0; a < s.children.length; ++a) {
                    var r = s.children[a];
                    if (r == i)
                        break;
                    else
                        e += r.height
                }
            }
            return e
        }
        function us(t) {
            var e = t.order;
            if (e == null)
                e = t.order = Jr(t.text);
            return e
        }
        function hs(t) {
            this.done = [];
            this.undone = [];
            this.undoDepth = Infinity;
            this.lastModTime = this.lastSelTime = 0;
            this.lastOp = this.lastSelOp = null;
            this.lastOrigin = this.lastSelOrigin = null;
            this.generation = this.maxGeneration = t || 1
        }
        function ps(t, e) {
            var i = {
                from: gt(e.from),
                to: Zi(e),
                text: ss(t, e.from, e.to)
            };
            ys(t, i, e.from.line, e.to.line + 1);
            is(t, function(t) {
                ys(t, i, e.from.line, e.to.line + 1)
            }, true);
            return i
        }
        function fs(t) {
            while (t.length) {
                var e = Zs(t);
                if (e.ranges)
                    t.pop();
                else
                    break
            }
        }
        function ms(t, e) {
            if (e) {
                fs(t.done);
                return Zs(t.done)
            } else if (t.done.length && !Zs(t.done).ranges) {
                return Zs(t.done)
            } else if (t.done.length > 1 && !t.done[t.done.length - 2].ranges) {
                t.done.pop();
                return Zs(t.done)
            }
        }
        function gs(t, e, i, a) {
            var n = t.history;
            n.undone.length = 0;
            var s = +new Date, r;
            if ((n.lastOp == a || n.lastOrigin == e.origin && e.origin && (e.origin.charAt(0) == "+" && t.cm && n.lastModTime > s - t.cm.options.historyEventDelay || e.origin.charAt(0) == "*")) && (r = ms(n, n.lastOp == a))) {
                var o = Zs(r.changes);
                if (mt(e.from, e.to) == 0 && mt(e.from, o.to) == 0) {
                    o.to = Zi(e)
                } else {
                    r.changes.push(ps(t, e))
                }
            } else {
                var l = Zs(n.done);
                if (!l || !l.ranges)
                    Fs(t.sel, n.done);
                r = {
                    changes: [ps(t, e)],
                    generation: n.generation
                };
                n.done.push(r);
                while (n.done.length > n.undoDepth) {
                    n.done.shift();
                    if (!n.done[0].ranges)
                        n.done.shift()
                }
            }
            n.done.push(i);
            n.generation = ++n.maxGeneration;
            n.lastModTime = n.lastSelTime = s;
            n.lastOp = n.lastSelOp = a;
            n.lastOrigin = n.lastSelOrigin = e.origin;
            if (!o)
                Ns(t, "historyAdded")
        }
        function _s(t, e, i, a) {
            var n = e.charAt(0);
            return n == "*" || n == "+" && i.ranges.length == a.ranges.length && i.somethingSelected() == a.somethingSelected() && new Date - t.history.lastSelTime <= (t.cm ? t.cm.options.historyEventDelay : 500)
        }
        function vs(t, e, i, a) {
            var n = t.history
                , s = a && a.origin;
            if (i == n.lastSelOp || s && n.lastSelOrigin == s && (n.lastModTime == n.lastSelTime && n.lastOrigin == s || _s(t, s, Zs(n.done), e)))
                n.done[n.done.length - 1] = e;
            else
                Fs(e, n.done);
            n.lastSelTime = +new Date;
            n.lastSelOrigin = s;
            n.lastSelOp = i;
            if (a && a.clearRedo !== false)
                fs(n.undone)
        }
        function Fs(t, e) {
            var i = Zs(e);
            if (!(i && i.ranges && i.equals(t)))
                e.push(t)
        }
        function ys(e, i, t, a) {
            var n = i["spans_" + e.id]
                , s = 0;
            e.iter(Math.max(e.first, t), Math.min(e.first + e.size, a), function(t) {
                if (t.markedSpans)
                    (n || (n = i["spans_" + e.id] = {}))[s] = t.markedSpans;
                ++s
            })
        }
        function bs(t) {
            if (!t)
                return null;
            for (var e = 0, i; e < t.length; ++e) {
                if (t[e].marker.explicitlyCleared) {
                    if (!i)
                        i = t.slice(0, e)
                } else if (i)
                    i.push(t[e])
            }
            return !i ? t : i.length ? i : null
        }
        function Ts(t, e) {
            var i = e["spans_" + t.id];
            if (!i)
                return null;
            for (var a = 0, n = []; a < e.text.length; ++a)
                n.push(bs(i[a]));
            return n
        }
        function Cs(t, e, i) {
            for (var a = 0, n = []; a < t.length; ++a) {
                var s = t[a];
                if (s.ranges) {
                    n.push(i ? Nt.prototype.deepCopy.call(s) : s);
                    continue
                }
                var r = s.changes
                    , o = [];
                n.push({
                    changes: o
                });
                for (var l = 0; l < r.length; ++l) {
                    var c = r[l], d;
                    o.push({
                        from: c.from,
                        to: c.to,
                        text: c.text
                    });
                    if (e)
                        for (var u in c)
                            if (d = u.match(/^spans_(\d+)$/)) {
                                if (er(e, Number(d[1])) > -1) {
                                    Zs(o)[u] = c[u];
                                    delete c[u]
                                }
                            }
                }
            }
            return n
        }
        function xs(t, e, i, a) {
            if (i < t.line) {
                t.line += a
            } else if (e < t.line) {
                t.line = e;
                t.ch = 0
            }
        }
        function ws(t, e, i, a) {
            for (var n = 0; n < t.length; ++n) {
                var s = t[n]
                    , r = true;
                if (s.ranges) {
                    if (!s.copied) {
                        s = t[n] = s.deepCopy();
                        s.copied = true
                    }
                    for (var o = 0; o < s.ranges.length; o++) {
                        xs(s.ranges[o].anchor, e, i, a);
                        xs(s.ranges[o].head, e, i, a)
                    }
                    continue
                }
                for (var o = 0; o < s.changes.length; ++o) {
                    var l = s.changes[o];
                    if (i < l.from.line) {
                        l.from = ft(l.from.line + a, l.from.ch);
                        l.to = ft(l.to.line + a, l.to.ch)
                    } else if (e <= l.to.line) {
                        r = false;
                        break
                    }
                }
                if (!r) {
                    t.splice(0, n + 1);
                    n = 0
                }
            }
        }
        function Es(t, e) {
            var i = e.from.line
                , a = e.to.line
                , n = e.text.length - (a - i) - 1;
            ws(t.done, i, a, n);
            ws(t.undone, i, a, n)
        }
        Hs(Zn);
        var Xs = F.e_preventDefault = function(t) {
                if (t.preventDefault)
                    t.preventDefault();
                else
                    t.returnValue = false
            }
            , Is = F.e_stopPropagation = function(t) {
                if (t.stopPropagation)
                    t.stopPropagation();
                else
                    t.cancelBubble = true
            }
        ;
        function Ss(t) {
            return t.defaultPrevented != null ? t.defaultPrevented : t.returnValue == false
        }
        var ks = F.e_stop = function(t) {
                Xs(t);
                Is(t)
            }
        ;
        function Us(t) {
            return t.target || t.srcElement
        }
        function Ds(t) {
            var e = t.which;
            if (e == null) {
                if (t.button & 1)
                    e = 1;
                else if (t.button & 2)
                    e = 3;
                else if (t.button & 4)
                    e = 2
            }
            if (g && t.ctrlKey && e == 1)
                e = 3;
            return e
        }
        var As = F.on = function(t, e, i) {
            if (t.addEventListener)
                t.addEventListener(e, i, false);
            else if (t.attachEvent)
                t.attachEvent("on" + e, i);
            else {
                var a = t._handlers || (t._handlers = {});
                var n = a[e] || (a[e] = []);
                n.push(i)
            }
        }
            , Os = F.off = function(t, e, i) {
            if (t.removeEventListener)
                t.removeEventListener(e, i, false);
            else if (t.detachEvent)
                t.detachEvent("on" + e, i);
            else {
                var a = t._handlers && t._handlers[e];
                if (!a)
                    return;
                for (var n = 0; n < a.length; ++n)
                    if (a[n] == i) {
                        a.splice(n, 1);
                        break
                    }
            }
        }
            , Ns = F.signal = function(t, e) {
            var i = t._handlers && t._handlers[e];
            if (!i)
                return;
            var a = Array.prototype.slice.call(arguments, 2);
            for (var n = 0; n < i.length; ++n)
                i[n].apply(null, a)
        }
            , Ls = null;
        function Ms(t, e) {
            var i = t._handlers && t._handlers[e];
            if (!i)
                return;
            var a = Array.prototype.slice.call(arguments, 2), n;
            if (je) {
                n = je.delayedCallbacks
            } else if (Ls) {
                n = Ls
            } else {
                n = Ls = [];
                setTimeout(Ps, 0)
            }
            function s(t) {
                return function() {
                    t.apply(null, a)
                }
            }
            for (var r = 0; r < i.length; ++r)
                n.push(s(i[r]))
        }
        function Ps() {
            var t = Ls;
            Ls = null;
            for (var e = 0; e < t.length; ++e)
                t[e]()
        }
        function Rs(t, e, i) {
            if (typeof e == "string")
                e = {
                    type: e,
                    preventDefault: function() {
                        this.defaultPrevented = true
                    }
                };
            Ns(t, i || e.type, t, e);
            return Ss(e) || e.codemirrorIgnore
        }
        function Vs(t) {
            var e = t._handlers && t._handlers.cursorActivity;
            if (!e)
                return;
            var i = t.curOp.cursorActivityHandlers || (t.curOp.cursorActivityHandlers = []);
            for (var a = 0; a < e.length; ++a)
                if (er(i, e[a]) == -1)
                    i.push(e[a])
        }
        function $s(t, e) {
            var i = t._handlers && t._handlers[e];
            return i && i.length > 0
        }
        function Hs(t) {
            t.prototype.on = function(t, e) {
                As(this, t, e)
            }
            ;
            t.prototype.off = function(t, e) {
                Os(this, t, e)
            }
        }
        var Ws = 30
            , Bs = F.Pass = {
            toString: function() {
                return "CodeMirror.Pass"
            }
        }
            , js = {
            scroll: false
        }
            , Gs = {
            origin: "*mouse"
        }
            , zs = {
            origin: "+move"
        };
        function Ys() {
            this.id = null
        }
        Ys.prototype.set = function(t, e) {
            clearTimeout(this.id);
            this.id = setTimeout(e, t)
        }
        ;
        var Ks = F.countColumn = function(t, e, i, a, n) {
                if (e == null) {
                    e = t.search(/[^\s\u00a0]/);
                    if (e == -1)
                        e = t.length
                }
                for (var s = a || 0, r = n || 0; ; ) {
                    var o = t.indexOf("\t", s);
                    if (o < 0 || o >= e)
                        return r + (e - s);
                    r += o - s;
                    r += i - r % i;
                    s = o + 1
                }
            }
        ;
        function Qs(t, e, i) {
            for (var a = 0, n = 0; ; ) {
                var s = t.indexOf("\t", a);
                if (s == -1)
                    s = t.length;
                var r = s - a;
                if (s == t.length || n + r >= e)
                    return a + Math.min(r, e - n);
                n += s - a;
                n += i - n % i;
                a = s + 1;
                if (n >= e)
                    return a
            }
        }
        var qs = [""];
        function Js(t) {
            while (qs.length <= t)
                qs.push(Zs(qs) + " ");
            return qs[t]
        }
        function Zs(t) {
            return t[t.length - 1]
        }
        var tr = function(t) {
            t.select()
        };
        if (o)
            tr = function(t) {
                t.selectionStart = 0;
                t.selectionEnd = t.value.length
            }
            ;
        else if (y)
            tr = function(t) {
                try {
                    t.select()
                } catch (t) {}
            }
            ;
        function er(t, e) {
            for (var i = 0; i < t.length; ++i)
                if (t[i] == e)
                    return i;
            return -1
        }
        function ir(t, e) {
            var i = [];
            for (var a = 0; a < t.length; a++)
                i[a] = e(t[a], a);
            return i
        }
        function ar() {}
        function nr(t, e) {
            var i;
            if (Object.create) {
                i = Object.create(t)
            } else {
                ar.prototype = t;
                i = new ar
            }
            if (e)
                sr(e, i);
            return i
        }
        function sr(t, e, i) {
            if (!e)
                e = {};
            for (var a in t)
                if (t.hasOwnProperty(a) && (i !== false || !e.hasOwnProperty(a)))
                    e[a] = t[a];
            return e
        }
        function rr(t) {
            var e = Array.prototype.slice.call(arguments, 1);
            return function() {
                return t.apply(null, e)
            }
        }
        var or = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/
            , lr = F.isWordChar = function(t) {
                return /\w/.test(t) || t > "" && (t.toUpperCase() != t.toLowerCase() || or.test(t))
            }
        ;
        function cr(t, e) {
            if (!e)
                return lr(t);
            if (e.source.indexOf("\\w") > -1 && lr(t))
                return true;
            return e.test(t)
        }
        function dr(t) {
            for (var e in t)
                if (t.hasOwnProperty(e) && t[e])
                    return false;
            return true
        }
        var ur = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/, hr;
        function pr(t) {
            return t.charCodeAt(0) >= 768 && ur.test(t)
        }
        function fr(t, e, i, a, n) {
            var s = document.createElement(t);
            if (i)
                s.className = i;
            if (a)
                s.style.cssText = a;
            if (typeof e == "string")
                s.appendChild(document.createTextNode(e));
            else if (e)
                for (var r = 0; r < e.length; ++r)
                    s.appendChild(e[r]);
            if (n) {
                for (var o in n) {
                    s.setAttribute(o, n[o])
                }
            }
            return s
        }
        if (document.createRange)
            hr = function(t, e, i, a) {
                var n = document.createRange();
                n.setEnd(a || t, i);
                n.setStart(t, e);
                return n
            }
            ;
        else
            hr = function(t, e, i) {
                var a = document.body.createTextRange();
                try {
                    a.moveToElementText(t.parentNode)
                } catch (t) {
                    return a
                }
                a.collapse(true);
                a.moveEnd("character", i);
                a.moveStart("character", e);
                return a
            }
            ;
        function mr(t) {
            for (var e = t.childNodes.length; e > 0; --e)
                t.removeChild(t.firstChild);
            return t
        }
        function gr(t, e) {
            return mr(t).appendChild(e)
        }
        var _r = F.contains = function(t, e) {
                if (e.nodeType == 3)
                    e = e.parentNode;
                if (t.contains)
                    return t.contains(e);
                do {
                    if (e.nodeType == 11)
                        e = e.host;
                    if (e == t)
                        return true
                } while (e = e.parentNode)
            }
        ;
        function vr() {
            return document.activeElement
        }
        if (y && b < 11)
            vr = function() {
                try {
                    return document.activeElement
                } catch (t) {
                    return document.body
                }
            }
            ;
        function Fr(t) {
            return new RegExp("(^|\\s)" + t + "(?:$|\\s)\\s*")
        }
        var yr = F.rmClass = function(t, e) {
                var i = t.className;
                var a = Fr(e).exec(i);
                if (a) {
                    var n = i.slice(a.index + a[0].length);
                    t.className = i.slice(0, a.index) + (n ? a[1] + n : "")
                }
            }
            , br = F.addClass = function(t, e) {
                var i = t.className;
                if (!Fr(e).test(i))
                    t.className += (i ? " " : "") + e
            }
        ;
        function Tr(t, e) {
            var i = t.split(" ");
            for (var a = 0; a < i.length; a++)
                if (i[a] && !Fr(i[a]).test(e))
                    e += " " + i[a];
            return e
        }
        function Cr(t) {
            if (!document.body.getElementsByClassName)
                return;
            var e = document.body.getElementsByClassName("CodeMirror");
            for (var i = 0; i < e.length; i++) {
                var a = e[i].CodeMirror;
                if (a)
                    t(a)
            }
        }
        var xr = false;
        function wr() {
            if (xr)
                return;
            Er();
            xr = true
        }
        function Er() {
            var t;
            As(window, "resize", function() {
                if (t == null)
                    t = setTimeout(function() {
                        t = null;
                        Cr(Fi)
                    }, 100)
            });
            As(window, "blur", function() {
                Cr(Qi)
            })
        }
        var Xr = function() {
            if (y && b < 9)
                return false;
            var t = fr("div");
            return "draggable"in t || "dragDrop"in t
        }(), Ir, Sr;
        function kr(t) {
            if (Ir == null) {
                var e = fr("span", "");
                gr(t, fr("span", [e, document.createTextNode("x")]));
                if (t.firstChild.offsetHeight != 0)
                    Ir = e.offsetWidth <= 1 && e.offsetHeight > 2 && !(y && b < 8)
            }
            var i = Ir ? fr("span", "") : fr("span", "", null, "display: inline-block; width: 1px; margin-right: -1px");
            i.setAttribute("cm-text", "");
            return i
        }
        function Ur(t) {
            if (Sr != null)
                return Sr;
            var e = gr(t, document.createTextNode("AA"));
            var i = hr(e, 0, 1).getBoundingClientRect();
            if (!i || i.left == i.right)
                return false;
            var a = hr(e, 1, 2).getBoundingClientRect();
            return Sr = a.right - i.right < 3
        }
        var Dr = F.splitLines = "\n\nb".split(/\n/).length != 3 ? function(t) {
                var e = 0
                    , i = []
                    , a = t.length;
                while (e <= a) {
                    var n = t.indexOf("\n", e);
                    if (n == -1)
                        n = t.length;
                    var s = t.slice(e, t.charAt(n - 1) == "\r" ? n - 1 : n);
                    var r = s.indexOf("\r");
                    if (r != -1) {
                        i.push(s.slice(0, r));
                        e += r + 1
                    } else {
                        i.push(s);
                        e = n + 1
                    }
                }
                return i
            }
            : function(t) {
                return t.split(/\r\n?|\n/)
            }
            , Ar = window.getSelection ? function(t) {
                try {
                    return t.selectionStart != t.selectionEnd
                } catch (t) {
                    return false
                }
            }
            : function(t) {
                try {
                    var e = t.ownerDocument.selection.createRange()
                } catch (t) {}
                if (!e || e.parentElement() != t)
                    return false;
                return e.compareEndPoints("StartToEnd", e) != 0
            }
            , Or = function() {
            var t = fr("div");
            if ("oncopy"in t)
                return true;
            t.setAttribute("oncopy", "return;");
            return typeof t.oncopy == "function"
        }()
            , Nr = null;
        function Lr(t) {
            if (Nr != null)
                return Nr;
            var e = gr(t, fr("span", "x"));
            var i = e.getBoundingClientRect();
            var a = hr(e, 0, 1).getBoundingClientRect();
            return Nr = Math.abs(i.left - a.left) > 1
        }
        var Mr = {
            3: "Enter",
            8: "Backspace",
            9: "Tab",
            13: "Enter",
            16: "Shift",
            17: "Ctrl",
            18: "Alt",
            19: "Pause",
            20: "CapsLock",
            27: "Esc",
            32: "Space",
            33: "PageUp",
            34: "PageDown",
            35: "End",
            36: "Home",
            37: "Left",
            38: "Up",
            39: "Right",
            40: "Down",
            44: "PrintScrn",
            45: "Insert",
            46: "Delete",
            59: ";",
            61: "=",
            91: "Mod",
            92: "Mod",
            93: "Mod",
            107: "=",
            109: "-",
            127: "Delete",
            173: "-",
            186: ";",
            187: "=",
            188: ",",
            189: "-",
            190: ".",
            191: "/",
            192: "`",
            219: "[",
            220: "\\",
            221: "]",
            222: "'",
            63232: "Up",
            63233: "Down",
            63234: "Left",
            63235: "Right",
            63272: "Delete",
            63273: "Home",
            63275: "End",
            63276: "PageUp",
            63277: "PageDown",
            63302: "Insert"
        }, Pr;
        function Rr(t, e, i, a) {
            if (!t)
                return a(e, i, "ltr");
            var n = false;
            for (var s = 0; s < t.length; ++s) {
                var r = t[s];
                if (r.from < i && r.to > e || e == i && r.to == e) {
                    a(Math.max(r.from, e), Math.min(r.to, i), r.level == 1 ? "rtl" : "ltr");
                    n = true
                }
            }
            if (!n)
                a(e, i, "ltr")
        }
        function Vr(t) {
            return t.level % 2 ? t.to : t.from
        }
        function $r(t) {
            return t.level % 2 ? t.from : t.to
        }
        function Hr(t) {
            var e = us(t);
            return e ? Vr(e[0]) : 0
        }
        function Wr(t) {
            var e = us(t);
            if (!e)
                return t.text.length;
            return $r(Zs(e))
        }
        function Br(t, e) {
            var i = ns(t.doc, e);
            var a = _n(i);
            if (a != i)
                e = ls(a);
            var n = us(a);
            var s = !n ? 0 : n[0].level % 2 ? Wr(a) : Hr(a);
            return ft(e, s)
        }
        function jr(t, e) {
            var i, a = ns(t.doc, e);
            while (i = mn(a)) {
                a = i.find(1, true).line;
                e = null
            }
            var n = us(a);
            var s = !n ? a.text.length : n[0].level % 2 ? Hr(a) : Wr(a);
            return ft(e == null ? ls(a) : e, s)
        }
        function Gr(t, e) {
            var i = Br(t, e.line);
            var a = ns(t.doc, i.line);
            var n = us(a);
            if (!n || n[0].level == 0) {
                var s = Math.max(0, a.text.search(/\S/));
                var r = e.line == i.line && e.ch <= s && e.ch;
                return ft(i.line, r ? 0 : s)
            }
            return i
        }
        function zr(t, e, i) {
            var a = t[0].level;
            if (e == a)
                return true;
            if (i == a)
                return false;
            return e < i
        }
        function Yr(t, e) {
            Pr = null;
            for (var i = 0, a; i < t.length; ++i) {
                var n = t[i];
                if (n.from < e && n.to > e)
                    return i;
                if (n.from == e || n.to == e) {
                    if (a == null) {
                        a = i
                    } else if (zr(t, n.level, t[a].level)) {
                        if (n.from != n.to)
                            Pr = a;
                        return i
                    } else {
                        if (n.from != n.to)
                            Pr = i;
                        return a
                    }
                }
            }
            return a
        }
        function Kr(t, e, i, a) {
            if (!a)
                return e + i;
            do {
                e += i
            } while (e > 0 && pr(t.text.charAt(e)));return e
        }
        function Qr(t, e, i, a) {
            var n = us(t);
            if (!n)
                return qr(t, e, i, a);
            var s = Yr(n, e)
                , r = n[s];
            var o = Kr(t, e, r.level % 2 ? -i : i, a);
            for (; ; ) {
                if (o > r.from && o < r.to)
                    return o;
                if (o == r.from || o == r.to) {
                    if (Yr(n, o) == s)
                        return o;
                    r = n[s += i];
                    return i > 0 == r.level % 2 ? r.to : r.from
                } else {
                    r = n[s += i];
                    if (!r)
                        return null;
                    if (i > 0 == r.level % 2)
                        o = Kr(t, r.to, -1, a);
                    else
                        o = Kr(t, r.from, 1, a)
                }
            }
        }
        function qr(t, e, i, a) {
            var n = e + i;
            if (a)
                while (n > 0 && pr(t.text.charAt(n)))
                    n += i;
            return n < 0 || n > t.text.length ? null : n
        }
        F.keyNames = Mr,
            function() {
                for (var t = 0; t < 10; t++)
                    Mr[t + 48] = Mr[t + 96] = String(t);
                for (var t = 65; t <= 90; t++)
                    Mr[t] = String.fromCharCode(t);
                for (var t = 1; t <= 12; t++)
                    Mr[t + 111] = Mr[t + 63235] = "F" + t
            }();
        var Jr = function() {
            var e = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
            var i = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
            function v(t) {
                if (t <= 247)
                    return e.charAt(t);
                else if (1424 <= t && t <= 1524)
                    return "R";
                else if (1536 <= t && t <= 1773)
                    return i.charAt(t - 1536);
                else if (1774 <= t && t <= 2220)
                    return "r";
                else if (8192 <= t && t <= 8203)
                    return "w";
                else if (t == 8204)
                    return "b";
                else
                    return "L"
            }
            var F = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
            var y = /[stwN]/
                , b = /[LRr]/
                , T = /[Lb1n]/
                , C = /[1n]/;
            var x = "L";
            function w(t, e, i) {
                this.level = t;
                this.from = e;
                this.to = i
            }
            return function(t) {
                if (!F.test(t))
                    return false;
                var e = t.length
                    , i = [];
                for (var a = 0, n; a < e; ++a)
                    i.push(n = v(t.charCodeAt(a)));
                for (var a = 0, s = x; a < e; ++a) {
                    var n = i[a];
                    if (n == "m")
                        i[a] = s;
                    else
                        s = n
                }
                for (var a = 0, r = x; a < e; ++a) {
                    var n = i[a];
                    if (n == "1" && r == "r")
                        i[a] = "n";
                    else if (b.test(n)) {
                        r = n;
                        if (n == "r")
                            i[a] = "R"
                    }
                }
                for (var a = 1, s = i[0]; a < e - 1; ++a) {
                    var n = i[a];
                    if (n == "+" && s == "1" && i[a + 1] == "1")
                        i[a] = "1";
                    else if (n == "," && s == i[a + 1] && (s == "1" || s == "n"))
                        i[a] = s;
                    s = n
                }
                for (var a = 0; a < e; ++a) {
                    var n = i[a];
                    if (n == ",")
                        i[a] = "N";
                    else if (n == "%") {
                        for (var o = a + 1; o < e && i[o] == "%"; ++o) {}
                        var l = a && i[a - 1] == "!" || o < e && i[o] == "1" ? "1" : "N";
                        for (var c = a; c < o; ++c)
                            i[c] = l;
                        a = o - 1
                    }
                }
                for (var a = 0, r = x; a < e; ++a) {
                    var n = i[a];
                    if (r == "L" && n == "1")
                        i[a] = "L";
                    else if (b.test(n))
                        r = n
                }
                for (var a = 0; a < e; ++a) {
                    if (y.test(i[a])) {
                        for (var o = a + 1; o < e && y.test(i[o]); ++o) {}
                        var d = (a ? i[a - 1] : x) == "L";
                        var u = (o < e ? i[o] : x) == "L";
                        var l = d || u ? "L" : "R";
                        for (var c = a; c < o; ++c)
                            i[c] = l;
                        a = o - 1
                    }
                }
                var h = [], p;
                for (var a = 0; a < e; ) {
                    if (T.test(i[a])) {
                        var f = a;
                        for (++a; a < e && T.test(i[a]); ++a) {}
                        h.push(new w(0,f,a))
                    } else {
                        var m = a
                            , g = h.length;
                        for (++a; a < e && i[a] != "L"; ++a) {}
                        for (var c = m; c < a; ) {
                            if (C.test(i[c])) {
                                if (m < c)
                                    h.splice(g, 0, new w(1,m,c));
                                var _ = c;
                                for (++c; c < a && C.test(i[c]); ++c) {}
                                h.splice(g, 0, new w(2,_,c));
                                m = c
                            } else
                                ++c
                        }
                        if (m < a)
                            h.splice(g, 0, new w(1,m,a))
                    }
                }
                if (h[0].level == 1 && (p = t.match(/^\s+/))) {
                    h[0].from = p[0].length;
                    h.unshift(new w(0,0,p[0].length))
                }
                if (Zs(h).level == 1 && (p = t.match(/\s+$/))) {
                    Zs(h).to -= p[0].length;
                    h.push(new w(0,e - p[0].length,e))
                }
                if (h[0].level == 2)
                    h.unshift(new w(1,h[0].to,h[0].to));
                if (h[0].level != Zs(h).level)
                    h.push(new w(h[0].level,e,e));
                return h
            }
        }();
        return F.version = "5.4.1",
            F
    }()
}(),
function(o) {
    FX.FormulaEditor = FX.extend(FX.Widget, {
        CONST: {
            NAME_FILED_CLS: "cm-field-name",
            VALUE_FIELD_CLS: "cm-field-value",
            INVALID_FIELD_CLS: "cm-field-invalid",
            DEPRECATE_FIELD_CLS: "cm-deprecate",
            NEGATIVE_FIELD_CLS: "cm-negative",
            FIELD_REG: /^\$(_widget_|_formula_|ext|createTime|updateTime|creator)/
        },
        _defaultConfig: function() {
            return o.extend(FX.FormulaEditor.superclass._defaultConfig.apply(), {
                baseCls: "x-formula-editor",
                keywords: [],
                text: i18next.t("formula"),
                hasFunction: !0,
                textField: "text",
                labelMap: null
            })
        },
        _init: function() {
            FX.FormulaEditor.superclass._init.apply(this, arguments);
            var t = this.options
                , e = this;
            this.element.append(o('<div class="formula-head"/>').append(o('<span class="formula-name"/>').text(t.text)).append(o('<span class="formula-equal"/>').text("="))),
                this.editor = CodeMirror(this.element[0], {
                    keywords: t.keywords,
                    textWrapping: !0,
                    lineWrapping: !0,
                    lineNumbers: !1,
                    matchBrackets: {
                        maxScanLines: 2e3,
                        maxHighlightLineLength: 2e3
                    },
                    specialChars: /[\u0000-\u001f\u007f\u00ad\u200c-\u200f\u2028\u2029\ufeff]/,
                    mode: "formula"
                }),
                this.editor.on("change", function(t, e) {
                    CodeMirror.showHint(t, CodeMirror.formulaHint, {
                        completeSingle: !1
                    })
                }),
                this.editor.on("blur", function() {
                    FX.Utils.applyFunc(e, t.onStopEdit, [], !1)
                }),
                this.editor.setOption("viewportMargin", 1 / 0)
        },
        _markField: function(t) {
            var e = this.options
                , i = ""
                , a = {
                "data-field": t.field
            };
            t.invalid ? i = this.CONST.INVALID_FIELD_CLS : t.entry ? (i = this.CONST.NAME_FILED_CLS,
                a["data-entry"] = t.entry) : i = this.CONST.VALUE_FIELD_CLS;
            var n = o('<span class="cm-field ' + i + '"/>').append(t.label)[0];
            t.entry && e.onBindToolTip && (n = e.onBindToolTip(t, n)),
                o(this.editor.markText(t.from, t.to, {
                    handleMouseEvents: !0,
                    atomic: !0,
                    replacedWith: n
                }).widgetNode).attr(a).addClass(i)
        },
        insertFormula: function(i) {
            i = i && i.toUpperCase();
            var t, a = !1;
            FX.Utils.forEach(this.options.keywords, function(t, e) {
                if (i === e)
                    return !(a = !0)
            }),
            a && (this.editor.focus(),
                t = this.editor.getCursor(),
                this.editor.replaceSelection(i + "()"),
                this.editor.setCursor({
                    line: t.line,
                    ch: t.ch + i.length + 1
                }))
        },
        fakeLabel: function(t) {
            return t ? t.replace(/[\[\]()'"]/g, " ") : ""
        },
        insertField: function(t, e) {
            var i = t[this.options.textField]
                , a = this.editor.getCursor();
            this.editor.replaceSelection(this.fakeLabel(i));
            var n = {
                from: a,
                to: this.editor.getCursor(),
                field: t.name,
                entry: e ? t.id : null,
                label: i
            };
            this._markField(n),
                this.editor.focus()
        },
        checkValidate: function() {
            var t = o(this.editor.display.lineDiv);
            return 0 < t.find("span." + this.CONST.DEPRECATE_FIELD_CLS).length ? (this.setInvalidateType(FX.CONST.FORMULA_INVALID_TYPE.DEPRECATED_FIELD),
                !1) : 0 < t.find("span." + this.CONST.INVALID_FIELD_CLS).length ? (this.setInvalidateType(FX.CONST.FORMULA_INVALID_TYPE.INVALID_FIELD),
                !1) : (this.setInvalidateType(null),
                !0)
        },
        getValue: function() {
            var a = []
                , s = this.CONST
                , r = []
                , t = o(this.editor.display.lineDiv).find(".CodeMirror-line-content");
            return FX.Utils.forEach(t, function(t, e) {
                var n = [];
                FX.Utils.forEach(o(e).children("span"), function(t, e) {
                    var i = o(e).attr("data-field")
                        , a = o(e).attr("data-entry");
                    if (o(e).hasClass(s.NAME_FILED_CLS))
                        n.push("$" + i + "#" + a);
                    else if (o(e).hasClass(s.VALUE_FIELD_CLS))
                        n.push("$" + i + "#"),
                        -1 === r.indexOf(i) && r.push(i);
                    else {
                        if (o(e).hasClass(s.DEPRECATE_FIELD_CLS) || o(e).hasClass(s.INVALID_FIELD_CLS) || o(e).hasClass(s.NEGATIVE_FIELD_CLS))
                            return;
                        n.push(o(e).text())
                    }
                });
                var i = n.join("").replace(/\u200b/g, "").replace(/\u00a0/g, " ");
                a.push(i)
            }),
                {
                    formula: a.join("\n"),
                    relyWidgets: r
                }
        },
        setValue: function(t) {
            var e, h = this, p = this.options, i = [], f = [];
            t && (e = t.split("\n"),
                FX.Utils.forEach(e, function(d, t) {
                    var u = ""
                        , e = t.split(FX.CONST.COMMON_REG.FORM_FORMULA);
                    FX.Utils.forEach(e, function(t, e) {
                        var i, a, n, s, r, o, l, c;
                        h.CONST.FIELD_REG.test(e) ? (a = !1,
                            FX.Utils.startWith(e, "$ext") ? i = i18next.t("field.ext") : p.labelMap && (i = p.labelMap[e]) && (i = h.fakeLabel(i),
                                a = !0),
                            n = !1,
                        FX.Utils.isNull(i) && (i = i18next.t("field.deleted"),
                            n = !0),
                            r = (s = e.replace("$", "").split("#"))[0],
                            o = s[1],
                            l = CodeMirror.Pos(d, u.length),
                            u += i,
                            c = CodeMirror.Pos(d, u.length),
                            f.push({
                                from: l,
                                to: c,
                                field: r,
                                entry: o,
                                invalid: n,
                                label: a ? p.labelMap[e] : i
                            })) : u += e
                    }),
                        i.push(u)
                })),
                this.editor.setValue(i.join("\n")),
                FX.Utils.forEach(f, function(t, e) {
                    h._markField(e)
                })
        }
    }),
        o.shortcut("formulaeditor", FX.FormulaEditor)
}(jQuery),
function(x) {
    "use strict";
    var w = "CodeMirror-hint"
        , E = "CodeMirror-hint-active";
    function i(t, e) {
        this.cm = t;
        this.options = this.buildOptions(e);
        this.widget = null;
        this.debounce = 0;
        this.tick = 0;
        this.startPos = this.cm.getCursor();
        this.startLen = this.cm.getLine(this.startPos.line).length;
        var i = this;
        t.on("cursorActivity", this.activityFunc = function() {
                i.cursorActivity()
            }
        )
    }
    x.showHint = function(t, e, i) {
        if (!e)
            return t.showHint(i);
        if (i && i.async)
            e.async = true;
        var a = {
            hint: e
        };
        if (i)
            for (var n in i)
                a[n] = i[n];
        return t.showHint(a)
    }
        ,
        x.defineExtension("showHint", function(t) {
            if (this.listSelections().length > 1 || this.somethingSelected())
                return;
            if (this.state.completionActive)
                this.state.completionActive.close();
            var e = this.state.completionActive = new i(this,t);
            if (!e.options.hint)
                return;
            x.signal(this, "startCompletion", this);
            e.update(true)
        });
    var a = window.requestAnimationFrame || function(t) {
        return setTimeout(t, 1e3 / 60)
    }
        , n = window.cancelAnimationFrame || clearTimeout;
    function X(t) {
        if (typeof t == "string")
            return t;
        else
            return t.text
    }
    function I(t, a) {
        var n = {
            Up: function() {
                a.moveFocus(-1)
            },
            Down: function() {
                a.moveFocus(1)
            },
            PageUp: function() {
                a.moveFocus(-a.menuSize() + 1, true)
            },
            PageDown: function() {
                a.moveFocus(a.menuSize() - 1, true)
            },
            Home: function() {
                a.setFocus(0)
            },
            End: function() {
                a.setFocus(a.length - 1)
            },
            Enter: a.pick,
            Tab: a.pick,
            Esc: a.close
        };
        var e = t.options.customKeys;
        var s = e ? {} : n;
        function i(t, e) {
            var i;
            if (typeof e != "string")
                i = function(t) {
                    return e(t, a)
                }
                ;
            else if (n.hasOwnProperty(e))
                i = n[e];
            else
                i = e;
            s[t] = i
        }
        if (e)
            for (var r in e)
                if (e.hasOwnProperty(r))
                    i(r, e[r]);
        var o = t.options.extraKeys;
        if (o)
            for (var r in o)
                if (o.hasOwnProperty(r))
                    i(r, o[r]);
        return s
    }
    function S(t, e) {
        while (e && e != t) {
            if (e.nodeName.toUpperCase() === "LI" && e.parentNode == t)
                return e;
            e = e.parentNode
        }
    }
    function s(n, t) {
        this.completion = n;
        this.data = t;
        this.picked = false;
        var i = this
            , s = n.cm;
        var r = this.hints = document.createElement("ul");
        r.className = "CodeMirror-hints";
        this.selectedHint = t.selectedHint || 0;
        var e = t.list;
        for (var a = 0; a < e.length; ++a) {
            var o = r.appendChild(document.createElement("li"))
                , l = e[a];
            var c = w + (a != this.selectedHint ? "" : " " + E);
            if (l.className != null)
                c = l.className + " " + c;
            o.className = c;
            if (l.render)
                l.render(o, t, l);
            else
                o.appendChild(document.createTextNode(l.displayText || X(l)));
            o.hintId = a
        }
        var d = s.cursorCoords(n.options.alignWithWord ? t.from : null);
        var u = d.left
            , h = d.bottom
            , p = true;
        r.style.left = u + "px";
        r.style.top = h + "px";
        var f = window.innerWidth || Math.max(document.body.offsetWidth, document.documentElement.offsetWidth);
        var m = window.innerHeight || Math.max(document.body.offsetHeight, document.documentElement.offsetHeight);
        (n.options.container || document.body).appendChild(r);
        var g = r.getBoundingClientRect()
            , _ = g.bottom - m;
        if (_ > 0) {
            var v = g.bottom - g.top
                , F = d.top - (d.bottom - g.top);
            if (F - v > 0) {
                r.style.top = (h = d.top - v) + "px";
                p = false
            } else if (v > m) {
                r.style.height = m - 5 + "px";
                r.style.top = (h = d.bottom - g.top) + "px";
                var y = s.getCursor();
                if (t.from.ch != y.ch) {
                    d = s.cursorCoords(y);
                    r.style.left = (u = d.left) + "px";
                    g = r.getBoundingClientRect()
                }
            }
        }
        var b = g.right - f;
        if (b > 0) {
            if (g.right - g.left > f) {
                r.style.width = f - 5 + "px";
                b -= g.right - g.left - f
            }
            r.style.left = (u = d.left - b) + "px"
        }
        s.addKeyMap(this.keyMap = I(n, {
            moveFocus: function(t, e) {
                i.changeActive(i.selectedHint + t, e)
            },
            setFocus: function(t) {
                i.changeActive(t)
            },
            menuSize: function() {
                return i.screenAmount()
            },
            length: e.length,
            close: function() {
                n.close()
            },
            pick: function() {
                i.pick()
            },
            data: t
        }));
        if (n.options.closeOnUnfocus) {
            var T;
            s.on("blur", this.onBlur = function() {
                    T = setTimeout(function() {
                        n.close()
                    }, 100)
                }
            );
            s.on("focus", this.onFocus = function() {
                    clearTimeout(T)
                }
            )
        }
        var C = s.getScrollInfo();
        s.on("scroll", this.onScroll = function() {
                var t = s.getScrollInfo()
                    , e = s.getWrapperElement().getBoundingClientRect();
                var i = h + C.top - t.top;
                var a = i - (window.pageYOffset || (document.documentElement || document.body).scrollTop);
                if (!p)
                    a += r.offsetHeight;
                if (a <= e.top || a >= e.bottom)
                    return n.close();
                r.style.top = i + "px";
                r.style.left = u + C.left - t.left + "px"
            }
        );
        x.on(r, "dblclick", function(t) {
            var e = S(r, t.target || t.srcElement);
            if (e && e.hintId != null) {
                i.changeActive(e.hintId);
                i.pick()
            }
        });
        x.on(r, "click", function(t) {
            var e = S(r, t.target || t.srcElement);
            if (e && e.hintId != null) {
                i.changeActive(e.hintId);
                if (n.options.completeOnSingleClick)
                    i.pick()
            }
        });
        x.on(r, "mousedown", function() {
            setTimeout(function() {
                s.focus()
            }, 20)
        });
        x.signal(t, "select", e[0], r.firstChild);
        return true
    }
    i.prototype = {
        close: function() {
            if (!this.active())
                return;
            this.cm.state.completionActive = null;
            this.tick = null;
            this.cm.off("cursorActivity", this.activityFunc);
            if (this.widget && this.data)
                x.signal(this.data, "close");
            if (this.widget)
                this.widget.close();
            x.signal(this.cm, "endCompletion", this.cm)
        },
        active: function() {
            return this.cm.state.completionActive == this
        },
        pick: function(t, e) {
            var i = t.list[e];
            if (i.hint)
                i.hint(this.cm, t, i);
            else
                this.cm.replaceRange(X(i + "()"), i.from || t.from, i.to || t.to, "complete");
            var a = this.cm.getCursor();
            a.ch = a.ch - 1;
            this.cm.setCursor(a);
            x.signal(t, "pick", i);
            this.close()
        },
        cursorActivity: function() {
            if (this.debounce) {
                n(this.debounce);
                this.debounce = 0
            }
            var t = this.cm.getCursor()
                , e = this.cm.getLine(t.line);
            if (t.line != this.startPos.line || e.length - t.ch != this.startLen - this.startPos.ch || t.ch < this.startPos.ch || this.cm.somethingSelected() || t.ch && this.options.closeCharacters.test(e.charAt(t.ch - 1))) {
                this.close()
            } else {
                var i = this;
                this.debounce = a(function() {
                    i.update()
                });
                if (this.widget)
                    this.widget.disable()
            }
        },
        update: function(e) {
            if (this.tick == null)
                return;
            if (this.data)
                x.signal(this.data, "update");
            if (!this.options.hint.async) {
                this.finishUpdate(this.options.hint(this.cm, this.options), e)
            } else {
                var i = ++this.tick
                    , a = this;
                this.options.hint(this.cm, function(t) {
                    if (a.tick == i)
                        a.finishUpdate(t, e)
                }, this.options)
            }
        },
        finishUpdate: function(t, e) {
            this.data = t;
            var i = this.widget && this.widget.picked || e && this.options.completeSingle;
            if (this.widget)
                this.widget.close();
            if (t && t.list.length) {
                if (i && t.list.length == 1) {
                    this.pick(t, 0)
                } else {
                    this.widget = new s(this,t);
                    x.signal(t, "shown")
                }
            }
        },
        buildOptions: function(t) {
            var e = this.cm.options.hintOptions;
            var i = {};
            for (var a in r)
                i[a] = r[a];
            if (e)
                for (var a in e)
                    if (e[a] !== undefined)
                        i[a] = e[a];
            if (t)
                for (var a in t)
                    if (t[a] !== undefined)
                        i[a] = t[a];
            return i
        }
    },
        s.prototype = {
            close: function() {
                if (this.completion.widget != this)
                    return;
                this.completion.widget = null;
                this.hints.parentNode.removeChild(this.hints);
                this.completion.cm.removeKeyMap(this.keyMap);
                var t = this.completion.cm;
                if (this.completion.options.closeOnUnfocus) {
                    t.off("blur", this.onBlur);
                    t.off("focus", this.onFocus)
                }
                t.off("scroll", this.onScroll)
            },
            disable: function() {
                this.completion.cm.removeKeyMap(this.keyMap);
                var t = this;
                this.keyMap = {
                    Enter: function() {
                        t.picked = true
                    }
                };
                this.completion.cm.addKeyMap(this.keyMap)
            },
            pick: function() {
                this.completion.pick(this.data, this.selectedHint)
            },
            changeActive: function(t, e) {
                if (t >= this.data.list.length)
                    t = e ? this.data.list.length - 1 : 0;
                else if (t < 0)
                    t = e ? 0 : this.data.list.length - 1;
                if (this.selectedHint == t)
                    return;
                var i = this.hints.childNodes[this.selectedHint];
                i.className = i.className.replace(" " + E, "");
                i = this.hints.childNodes[this.selectedHint = t];
                i.className += " " + E;
                if (i.offsetTop < this.hints.scrollTop)
                    this.hints.scrollTop = i.offsetTop - 3;
                else if (i.offsetTop + i.offsetHeight > this.hints.scrollTop + this.hints.clientHeight)
                    this.hints.scrollTop = i.offsetTop + i.offsetHeight - this.hints.clientHeight + 3;
                x.signal(this.data, "select", this.data.list[this.selectedHint], i)
            },
            screenAmount: function() {
                return Math.floor(this.hints.clientHeight / this.hints.firstChild.offsetHeight) || 1
            }
        },
        x.registerHelper("hint", "auto", function(t, e) {
            var i = t.getHelpers(t.getCursor(), "hint"), a;
            if (i.length) {
                for (var n = 0; n < i.length; n++) {
                    var s = i[n](t, e);
                    if (s && s.list.length)
                        return s
                }
            } else if (a = t.getHelper(t.getCursor(), "hintWords")) {
                if (a)
                    return x.hint.fromList(t, {
                        words: a
                    })
            } else if (x.hint.anyword) {
                return x.hint.anyword(t, e)
            }
        }),
        x.registerHelper("hint", "fromList", function(t, e) {
            var i = t.getCursor()
                , a = t.getTokenAt(i);
            var n = [];
            for (var s = 0; s < e.words.length; s++) {
                var r = e.words[s];
                if (r.slice(0, a.string.length) == a.string)
                    n.push(r)
            }
            if (n.length)
                return {
                    list: n,
                    from: x.Pos(i.line, a.start),
                    to: x.Pos(i.line, a.end)
                }
        }),
        x.commands.autocomplete = x.showHint;
    var r = {
        hint: x.hint.auto,
        completeSingle: true,
        alignWithWord: true,
        closeCharacters: /[\s()\[\]{};:>,]/,
        closeOnUnfocus: true,
        completeOnSingleClick: false,
        container: null,
        customKeys: null,
        extraKeys: null
    };
    x.defineOption("hintOptions", null)
}(CodeMirror),
function() {
    var o, l;
    o = CodeMirror,
        l = o.Pos,
        o.registerHelper("hint", "formula", function(t, e) {
            return function(t, e, i) {
                var a = t.getCursor()
                    , n = i(t, a);
                if (/\b(?:string)\b/.test(n.type))
                    return;
                n.state = o.innerMode(t.getMode(), n.state).state,
                    /^[\w$_]*$/.test(n.string) ? n.end > a.ch && (n.end = a.ch,
                        n.string = n.string.slice(0, a.ch - n.start)) : n = {
                        start: a.ch,
                        end: a.ch,
                        string: "",
                        state: n.state,
                        type: "." == n.string ? "property" : null
                    };
                var s = n;
                for (; "property" == s.type; ) {
                    if ("." != (s = i(t, l(a.line, s.start))).string)
                        return;
                    var r;
                    s = i(t, l(a.line, s.start)),
                        (r = r || []).push(s)
                }
                return {
                    list: function(t, e, i) {
                        var a = []
                            , n = t.string.toUpperCase();
                        if (!n)
                            return a;
                        e && e.length ? e.pop() : function(t, e) {
                            for (var i = 0, a = t.length; i < a; ++i)
                                e(t[i])
                        }(i, function(t) {
                            0 != t.lastIndexOf(n, 0) || function(t, e) {
                                if (Array.prototype.indexOf)
                                    return -1 != t.indexOf(e);
                                var i = t.length;
                                for (; i--; )
                                    if (t[i] === e)
                                        return !0;
                                return !1
                            }(a, t) || a.push(t)
                        });
                        return a
                    }(n, r, e),
                    from: l(a.line, n.start),
                    to: l(a.line, n.end)
                }
            }(t, o.keywords, function(t, e) {
                return t.getTokenAt(e)
            })
        })
}(),
function(e) {
    "use strict";
    e.defineMode("formula", function() {
        function t(t) {
            var e = {};
            for (var i = 0, a = t.length; i < a; ++i)
                e[t[i]] = true;
            return e
        }
        var n = t(["false", "true"]);
        var s = t(e.keywords);
        var r = t(["MAP"]);
        function i(t, e) {
            if (t.eatSpace()) {
                return null
            }
            var i = t.next();
            if (i === '"' || i === "'") {
                o(t, i);
                return "string"
            }
            if (/[\[\],\(\)]/.test(i)) {
                return "bracket"
            }
            if (/[+\-*\/=<>!&|]/.test(i)) {
                return "operator"
            }
            if (/\d/.test(i)) {
                t.eatWhile(/[\d\.]/);
                return "number"
            }
            t.eatWhile(/[\w]/);
            var a = t.current();
            if (n.hasOwnProperty(a)) {
                return "atom"
            }
            if (s.hasOwnProperty(a)) {
                return "keyword"
            }
            if (r.hasOwnProperty(a)) {
                return "deprecate"
            }
            return "negative"
        }
        function o(t, e) {
            var i = false, a;
            while ((a = t.next()) != null) {
                if (a === e && !i) {
                    return false
                }
                i = !i && a === "\\"
            }
            return i
        }
        function a(t, e) {
            return (e.tokens[0] || i)(t, e)
        }
        return {
            startState: function() {
                return {
                    tokens: []
                }
            },
            token: function(t, e) {
                return a(t, e)
            },
            fold: "brace"
        }
    }),
        e.defineMIME("text/fx-formula", "formula")
}(CodeMirror),
function(t) {
    "use strict";
    t.defineMode("label", function() {
        function i(t, e) {
            if (t.eatSpace()) {
                return null
            }
            var i = t.next();
            return null
        }
        function t(t, e) {
            var i = false, a;
            while (t.next() != null) {
                if (a === e && !i) {
                    return false
                }
                !i && a === "\\"
            }
            return i
        }
        function a(t, e) {
            return (e.tokens[0] || i)(t, e)
        }
        return {
            startState: function() {
                return {
                    tokens: []
                }
            },
            token: function(t, e) {
                return a(t, e)
            },
            fold: "brace"
        }
    }),
        t.defineMIME("text/fx-label", "label")
}(CodeMirror),
function() {
    function d(t, e, i) {
        var a = t.getLineHandle(e.line)
            , n = e.ch - 1
            , s = i && i.afterCursor;
        null == s && (s = /(^| )cm-fat-cursor($| )/.test(t.getWrapperElement().className));
        var r = !s && 0 <= n && g[a.text.charAt(n)] || g[a.text.charAt(++n)];
        if (!r)
            return null;
        var o = ">" == r.charAt(1) ? 1 : -1;
        if (i && i.strict && 0 < o != (n == e.ch))
            return null;
        var l = t.getTokenTypeAt(m(e.line, n + 1))
            , c = u(t, m(e.line, n + (0 < o ? 1 : 0)), o, l || null, i);
        return null == c ? null : {
            from: m(e.line, n),
            to: c && c.pos,
            match: c && c.ch == r.charAt(0),
            forward: 0 < o
        }
    }
    function u(t, e, i, a, n) {
        for (var s = n && n.maxScanLineLength || 1e4, r = n && n.maxScanLines || 1e3, o = [], l = n && n.bracketRegex ? n.bracketRegex : /[(){}[\]]/, c = 0 < i ? Math.min(e.line + r, t.lastLine() + 1) : Math.max(t.firstLine() - 1, e.line - r), d = e.line; d != c; d += i) {
            var u = t.getLine(d);
            if (u) {
                var h = 0 < i ? 0 : u.length - 1
                    , p = 0 < i ? u.length : -1;
                if (!(u.length > s))
                    for (d == e.line && (h = e.ch - (i < 0 ? 1 : 0)); h != p; h += i) {
                        var f = u.charAt(h);
                        if (l.test(f) && (void 0 === a || t.getTokenTypeAt(m(d, h + 1)) == a))
                            if (">" == g[f].charAt(1) == 0 < i)
                                o.push(f);
                            else {
                                if (!o.length)
                                    return {
                                        pos: m(d, h),
                                        ch: f
                                    };
                                o.pop()
                            }
                    }
            }
        }
        return d - i != (0 < i ? t.lastLine() : t.firstLine()) && null
    }
    function e(t, e, i) {
        for (var a = t.state.matchBrackets.maxHighlightLineLength || 1e3, n = [], s = t.listSelections(), r = 0; r < s.length; r++) {
            var o, l = s[r].empty() && d(t, s[r].head, i);
            l && t.getLine(l.from.line).length <= a && (o = l.match ? "CodeMirror-matchingbracket" : "CodeMirror-nonmatchingbracket",
                n.push(t.markText(l.from, m(l.from.line, l.from.ch + 1), {
                    className: o
                })),
            l.to && t.getLine(l.to.line).length <= a && n.push(t.markText(l.to, m(l.to.line, l.to.ch + 1), {
                className: o
            })))
        }
        if (n.length) {
            h && t.state.focused && t.focus();
            function c() {
                t.operation(function() {
                    for (var t = 0; t < n.length; t++)
                        n[t].clear()
                })
            }
            if (!e)
                return c;
            setTimeout(c, 800)
        }
    }
    function a(t) {
        t.operation(function() {
            s && (s(),
                s = null),
                s = e(t, !1, t.state.matchBrackets)
        })
    }
    var n, h, m, g, s;
    n = CodeMirror,
        h = /MSIE \d/.test(navigator.userAgent) && (null == document.documentMode || document.documentMode < 8),
        m = n.Pos,
        g = {
            "(": ")>",
            ")": "(<",
            "[": "]>",
            "]": "[<",
            "{": "}>",
            "}": "{<"
        },
        s = null,
        n.defineOption("matchBrackets", !1, function(t, e, i) {
            i && i != n.Init && (t.off("cursorActivity", a),
            s && (s(),
                s = null)),
            e && (t.state.matchBrackets = "object" == typeof e ? e : {},
                t.on("cursorActivity", a))
        }),
        n.defineExtension("matchBrackets", function() {
            e(this, !0)
        }),
        n.defineExtension("findMatchingBracket", function(t, e, i) {
            return !i && "boolean" != typeof e || (e = i ? (i.strict = e,
                i) : e ? {
                strict: !0
            } : null),
                d(this, t, e)
        }),
        n.defineExtension("scanForBracket", function(t, e, i, a) {
            return u(this, t, e, i, a)
        })
}(),
function(c) {
    FX.FieldFormulaPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return c.extend(FX.FieldFormulaPane.superclass._defaultConfig.apply(this, arguments), {
                formula: {},
                text: i18next.t("formula"),
                hasRemind: !0,
                hasFunction: !0,
                supportMultiForm: !0,
                showFieldHeader: !0,
                emptyFieldTip: "",
                dialogTitle: i18next.t("formula.edit"),
                verifySuccessTip: i18next.t("formula.set.success"),
                availableFieldValue: FX.LimitFields.formulaValue,
                availableFieldName: FX.LimitFields.formulaName,
                formulaKeywords: Object.keys(FX.Formula).remove("MAP"),
                currentForm: null,
                currentWidget: null,
                currentSubform: null,
                entryList: null,
                onAfterFormulaEdit: null,
                labelMap: null
            })
        },
        _init: function() {
            FX.FieldFormulaPane.superclass._init.apply(this, arguments),
                this.nameMap = {},
                this._createFieldSelect(),
                this._createEditDialog(),
                this.dialog.show();
            var t = this.options;
            t.hasRemind && !t.formula.remind && this.dialog.getWidgetByName("remindInfo").select()
        },
        _createFieldSelect: function() {
            var e = this
                , i = this.options;
            this.$fieldSelect = c('<div class="fx_formula_field_tab"/>'),
                c('<div class="field-label">' + i18next.t("variable.available") + "</div>").appendTo(this.$fieldSelect);
            var t = c('<div class="head"/>').appendTo(this.$fieldSelect)
                , a = c('<div class="tab active"/>').text(i18next.t("field.rely.currentForm")).click(function() {
                r && r.removeClass("active"),
                a && a.addClass("active"),
                l && l.setVisible(!0),
                o && o.setVisible(!1)
            }).appendTo(t);
            i.showFieldHeader || this.$fieldSelect.addClass("hide-field-header");
            var n = [];
            FX.Utils.forEach(i.entryList, function(t, e) {
                if (!e.appId)
                    return i.currentForm === e.entryId ? !(n = [e]) : void 0
            });
            var s = [];
            i.currentWidget && s.push([i.currentWidget, i.currentForm].join(FX.CONST.FIELD.ENTRY_DELIMITER));
            var r, o, l = new FX.EntryFieldSelectPane({
                renderEl: c("<div/>").appendTo(this.$fieldSelect),
                mode: "dialog",
                isHideSingleEntry: !0,
                fields: [],
                excludeFields: s,
                availableFields: i.availableFieldValue,
                allowMultiTable: !0,
                allowSameField: !0,
                allowMultiSubform: !0,
                entryList: n,
                hasFieldType: i.hasFunction,
                isSubform: !!i.currentSubform,
                emptyTip: i.emptyFieldTip,
                onFieldSelect: function(t) {
                    e.dialog.getWidgetByName("formulaEditor").insertField(t, !1)
                },
                onFieldFilter: function(t) {
                    return !(!i.currentSubform || !t.subform) && t.subform !== i.currentSubform
                }
            });
            i.supportMultiForm && (i.showFieldHeader && (r = c('<div class="tab"/>').text(i18next.t("form.allFields")).click(function() {
                a && a.removeClass("active"),
                r && r.addClass("active"),
                l && l.setVisible(!1),
                o && o.setVisible(!0)
            }).appendTo(t)),
                o = new FX.EntryFieldSelectPane({
                    renderEl: c("<div/>").appendTo(this.$fieldSelect),
                    mode: "dialog",
                    visible: !1,
                    fields: [],
                    availableFields: i.availableFieldName,
                    allowMultiTable: !0,
                    allowSameField: !0,
                    allowMultiSubform: !0,
                    hasFieldType: i.hasFunction,
                    entryList: i.entryList,
                    onFieldSelect: function(t) {
                        t.appId && (t.id = [t.id, t.appId].join(FX.CONST.FIELD.DELIMITER)),
                            e.dialog.getWidgetByName("formulaEditor").insertField(t, !0)
                    }
                }))
        },
        _bindToolTip: function(t, e) {
            var i = this.options
                , a = t.entry && t.entry.indexOf("@") < 0 ? [t.entry, FX.STATIC.APPID].join(FX.CONST.FIELD.DELIMITER) : t.entry
                , n = [FX.STATIC.ENTRYID, FX.STATIC.APPID].join(FX.CONST.FIELD.DELIMITER)
                , s = this.nameMap
                , r = "";
            return a && n !== a && (s[a] ? r = s[a] : FX.Utils.forEach(i.entryList, function(t, e) {
                if ([e.entryId, e.appId || FX.STATIC.APPID].join(FX.CONST.FIELD.DELIMITER) === a)
                    return r = 20 < (r = e.name).length ? r.substr(0, 20) + "..." : r,
                        s[a] = r,
                        !1
            }),
                new FX.Tooltip({
                    renderEl: e,
                    content: c("<div>" + i18next.t("formula.source") + r + "</div>"),
                    style: "info",
                    anchor: c(e),
                    hasIcon: !1
                })),
                e
        },
        _createEditDialog: function() {
            var s = this
                , r = this.options
                , t = [190, 250]
                , e = 800
                , i = [220, 530]
                , a = 760
                , n = 600
                , o = r.text
                , l = [this.$fieldSelect, {
                type: "formulainfopane",
                widgetName: "formulaInfoPane",
                limits: r.formulaKeywords,
                onAfterFormulaSelect: function(t) {
                    s.dialog.getWidgetByName("formulaEditor").insertFormula(t)
                }
            }];
            r.hasFunction || (e = 570,
                i = [530, 0],
                a = 530,
                n = 370,
                l.pop()),
            r.currentSubform && FX.Utils.forEach(r.entryList, function(t, e) {
                if (e.entryId === r.currentForm)
                    return FX.Utils.forEach(e.fields, function(t, e) {
                        if (e.name === r.currentSubform)
                            return o = e.text + "." + o,
                                !1
                    }),
                        !1
            });
            var c = [[{
                type: "formulaeditor",
                widgetName: "formulaEditor",
                value: r.formula.formula,
                keywords: r.formulaKeywords,
                text: o,
                hasFunction: r.hasFunction,
                labelMap: r.labelMap,
                width: a,
                onBindToolTip: function(t, e) {
                    return s._bindToolTip(t, e)
                },
                onStopEdit: function() {
                    FX.Utils.applyFunc(s, r.onFormulaStopEdit, [], !1)
                }
            }], l];
            r.hasRemind && (t = [30, 160, 250],
                c.unshift([{
                    type: "label",
                    text: i18next.t("formula.valid.fail.tip"),
                    width: 150
                }, {
                    type: "text",
                    widgetName: "remindInfo",
                    value: r.formula.remind,
                    waterMark: i18next.t("formula.input.placeholder"),
                    width: n,
                    allowBlank: !1,
                    onStopEdit: function() {
                        FX.Utils.applyFunc(s, r.onRemindInfoStopEdit, [], !1)
                    }
                }])),
                this.dialog = new FX.ConfirmDialog({
                    title: r.dialogTitle,
                    subTitle: i18next.t("dash.table.addCustomField.tip"),
                    width: e,
                    customCls: "formula-dialog",
                    contentWidget: {
                        rowSize: t,
                        colSize: i,
                        vgap: 10,
                        hgap: 10,
                        items: c
                    },
                    onOk: function() {
                        var t = s.dialog.getWidgetByName("remindInfo")
                            , e = null;
                        if (!t || (e = t.getValue())) {
                            var i = s.dialog.getWidgetByName("formulaEditor");
                            if (i.checkValidate()) {
                                var a = s.dialog.getWidgetByName("formulaEditor").getValue();
                                a.formula ? (FX.Utils.applyFunc(s.dialog, r.onAfterFormulaEdit, [a, e], !1),
                                    s.dialog.close(),
                                    FX.Msg.toast({
                                        type: "success",
                                        msg: r.verifySuccessTip
                                    })) : FX.Msg.toast({
                                    type: "warning",
                                    msg: i18next.t("dash.metric.inputExpr.tip")
                                })
                            } else {
                                var n = "";
                                switch (i.getInvalidateType()) {
                                    case FX.CONST.FORMULA_INVALID_TYPE.INVALID_FIELD:
                                        n = i18next.t("formula.valid.field.tip");
                                        break;
                                    case FX.CONST.FORMULA_INVALID_TYPE.DEPRECATED_FIELD:
                                        n = i18next.t("formula.valid.map.tip");
                                        break;
                                    default:
                                        n = i18next.t("formula.valid.fail")
                                }
                                FX.Msg.toast({
                                    type: "warning",
                                    msg: n
                                })
                            }
                        } else
                            FX.Msg.toast({
                                type: "warning",
                                msg: i18next.t("formula.input.placeholder")
                            })
                    }
                })
        }
    })
}(jQuery),
function(d) {
    FX.FormulaInfoPane = FX.extend(FX.Widget, {
        FORMULA: [{
            category: i18next.t("formula.common"),
            value: "common",
            contains: [{
                name: "CONCATENATE",
                intro: i18next.t("formula.concatenate.intro"),
                usage: i18next.t("formula.concatenate.usage"),
                example: i18next.t("formula.concatenate.example"),
                docUrl: "https://hc.jiandaoyun.com/doc/9034"
            }, {
                name: "DATE",
                intro: i18next.t("formula.date.intro"),
                usage: i18next.t("formula.date.usage"),
                example: i18next.t("formula.omit"),
                docUrl: "https://hc.jiandaoyun.com/doc/9036"
            }, {
                name: "DATEDIF",
                intro: i18next.t("formula.datedif.intro"),
                usage: i18next.t("formula.datedif.usage"),
                example: i18next.t("formula.datedif.example"),
                docUrl: "https://hc.jiandaoyun.com/doc/9036"
            }, {
                name: "IF",
                intro: i18next.t("formula.if.intro"),
                usage: i18next.t("formula.if.usage"),
                example: i18next.t("formula.if.example"),
                docUrl: "https://hc.jiandaoyun.com/doc/9033"
            }, {
                name: "MAPX",
                intro: i18next.t("formula.mapx.intro"),
                usage: i18next.t("formula.mapx.usage"),
                example: i18next.t("formula.omit"),
                docUrl: "https://hc.jiandaoyun.com/doc/9037"
            }, {
                name: "SUM",
                intro: i18next.t("formula.sum.intro"),
                usage: i18next.t("formula.sum.usage"),
                example: i18next.t("formula.sum.example"),
                docUrl: "https://hc.jiandaoyun.com/doc/9035"
            }]
        }, {
            category: i18next.t("formula.math"),
            docUrl: "https://hc.jiandaoyun.com/doc/9035",
            contains: [{
                name: "ABS",
                intro: i18next.t("formula.abs.intro"),
                usage: i18next.t("formula.abs.usage"),
                example: i18next.t("formula.abs.example")
            }, {
                name: "AVERAGE",
                intro: i18next.t("formula.average.intro"),
                usage: i18next.t("formula.average.usage"),
                example: i18next.t("formula.average.example")
            }, {
                name: "CEILING",
                intro: i18next.t("formula.ceiling.intro"),
                usage: i18next.t("formula.ceiling.usage"),
                example: i18next.t("formula.ceiling.example")
            }, {
                name: "COUNT",
                intro: i18next.t("formula.count.intro"),
                usage: i18next.t("formula.count.usage"),
                example: i18next.t("formula.count.example")
            }, {
                name: "COUNTIF",
                intro: i18next.t("formula.countif.intro"),
                usage: i18next.t("formula.countif.usage"),
                example: i18next.t("formula.countif.example")
            }, {
                name: "FIXED",
                intro: i18next.t("formula.fixed.intro"),
                usage: i18next.t("formula.fixed.usage"),
                example: i18next.t("formula.fixed.example")
            }, {
                name: "FLOOR",
                intro: i18next.t("formula.floor.intro"),
                usage: i18next.t("formula.floor.usage"),
                example: i18next.t("formula.floor.example")
            }, {
                name: "INT",
                intro: i18next.t("formula.int.intro"),
                usage: i18next.t("formula.int.usage"),
                example: i18next.t("formula.int.example")
            }, {
                name: "LARGE",
                intro: i18next.t("formula.large.intro"),
                usage: i18next.t("formula.large.usage"),
                example: i18next.t("formula.large.example")
            }, {
                name: "LOG",
                intro: i18next.t("formula.log.intro"),
                usage: i18next.t("formula.log.usage"),
                example: i18next.t("formula.log.example")
            }, {
                name: "MAX",
                intro: i18next.t("formula.max.intro"),
                usage: i18next.t("formula.max.usage"),
                example: i18next.t("formula.max.example")
            }, {
                name: "MIN",
                intro: i18next.t("formula.min.intro"),
                usage: i18next.t("formula.min.usage"),
                example: i18next.t("formula.min.example")
            }, {
                name: "MOD",
                intro: i18next.t("formula.mod.intro"),
                usage: i18next.t("formula.mod.usage"),
                example: i18next.t("formula.mod.example")
            }, {
                name: "POWER",
                intro: i18next.t("formula.power.intro"),
                usage: i18next.t("formula.power.usage"),
                example: i18next.t("formula.power.example")
            }, {
                name: "PRODUCT",
                intro: i18next.t("formula.product.intro"),
                usage: i18next.t("formula.product.usage"),
                example: i18next.t("formula.product.example")
            }, {
                name: "RAND",
                intro: i18next.t("formula.rand.intro"),
                usage: i18next.t("formula.rand.usage"),
                example: i18next.t("formula.rand.example")
            }, {
                name: "ROUND",
                intro: i18next.t("formula.round.intro"),
                usage: i18next.t("formula.round.usage"),
                example: i18next.t("formula.round.example")
            }, {
                name: "SMALL",
                intro: i18next.t("formula.small.intro"),
                usage: i18next.t("formula.small.usage"),
                example: i18next.t("formula.small.example")
            }, {
                name: "SQRT",
                intro: i18next.t("formula.sqrt.intro"),
                usage: i18next.t("formula.sqrt.usage"),
                example: i18next.t("formula.sqrt.example")
            }, {
                name: "SUM",
                intro: i18next.t("formula.sum.intro"),
                usage: i18next.t("formula.sum.usage"),
                example: i18next.t("formula.sum.example")
            }, {
                name: "SUMPRODUCT",
                intro: i18next.t("formula.sumproduct.intro"),
                usage: i18next.t("formula.sumproduct.usage"),
                example: i18next.t("formula.sumproduct.example")
            }]
        }, {
            category: i18next.t("formula.text"),
            docUrl: "https://hc.jiandaoyun.com/doc/9034",
            contains: [{
                name: "CONCATENATE",
                intro: i18next.t("formula.concatenate.intro"),
                usage: i18next.t("formula.concatenate.usage"),
                example: i18next.t("formula.concatenate.example")
            }, {
                name: "CHAR",
                intro: i18next.t("formula.char.intro"),
                usage: i18next.t("formula.char.usage"),
                example: i18next.t("formula.char.example")
            }, {
                name: "EXACT",
                intro: i18next.t("formula.exact.intro"),
                usage: i18next.t("formula.exact.usage"),
                example: i18next.t("formula.exact.example")
            }, {
                name: "IP",
                intro: i18next.t("formula.ip.intro"),
                usage: i18next.t("formula.ip.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "ISEMPTY",
                intro: i18next.t("formula.isempty.intro"),
                usage: i18next.t("formula.isempty.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "LEFT",
                intro: i18next.t("formula.left.intro"),
                usage: i18next.t("formula.left.usage"),
                example: i18next.t("formula.left.example")
            }, {
                name: "LEN",
                intro: i18next.t("formula.len.intro"),
                usage: i18next.t("formula.len.usage"),
                example: i18next.t("formula.len.example")
            }, {
                name: "LOWER",
                intro: i18next.t("formula.lower.intro"),
                usage: i18next.t("formula.lower.usage"),
                example: i18next.t("formula.lower.example")
            }, {
                name: "MID",
                intro: i18next.t("formula.mid.intro"),
                usage: i18next.t("formula.mid.usage"),
                example: i18next.t("formula.mid.example")
            }, {
                name: "REPLACE",
                intro: i18next.t("formula.replace.intro"),
                usage: i18next.t("formula.replace.usage"),
                example: i18next.t("formula.replace.example")
            }, {
                name: "REPT",
                intro: i18next.t("formula.rept.intro"),
                usage: i18next.t("formula.rept.usage"),
                example: i18next.t("formula.rept.example")
            }, {
                name: "RIGHT",
                intro: i18next.t("formula.right.intro"),
                usage: i18next.t("formula.right.usage"),
                example: i18next.t("formula.right.example")
            }, {
                name: "SEARCH",
                intro: i18next.t("formula.search.intro"),
                usage: i18next.t("formula.search.usage"),
                example: i18next.t("formula.search.example")
            }, {
                name: "SPLIT",
                intro: i18next.t("formula.split.intro"),
                usage: i18next.t("formula.split.usage"),
                example: i18next.t("formula.split.example")
            }, {
                name: "TEXT",
                intro: i18next.t("formula.text.intro"),
                usage: i18next.t("formula.text.usage"),
                example: i18next.t("formula.text.example")
            }, {
                name: "TRIM",
                intro: i18next.t("formula.trim.intro"),
                usage: i18next.t("formula.trim.usage"),
                example: i18next.t("formula.trim.example")
            }, {
                name: "UNION",
                intro: i18next.t("formula.union.intro"),
                usage: i18next.t("formula.union.usage"),
                example: i18next.t("formula.union.example")
            }, {
                name: "UPPER",
                intro: i18next.t("formula.upper.intro"),
                usage: i18next.t("formula.upper.usage"),
                example: i18next.t("formula.upper.example")
            }, {
                name: "VALUE",
                intro: i18next.t("formula.value.intro"),
                usage: i18next.t("formula.value.usage"),
                example: i18next.t("formula.value.example")
            }]
        }, {
            category: i18next.t("formula.date"),
            docUrl: "https://hc.jiandaoyun.com/doc/9036",
            contains: [{
                name: "DATE",
                intro: i18next.t("formula.date.intro"),
                usage: i18next.t("formula.date.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "DATEDELTA",
                intro: i18next.t("formula.datedelta.intro"),
                usage: i18next.t("formula.datedelta.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "DATEDIF",
                intro: i18next.t("formula.datedif.intro"),
                usage: i18next.t("formula.datedif.usage"),
                example: i18next.t("formula.datedif.example")
            }, {
                name: "DAY",
                intro: i18next.t("formula.day.intro"),
                usage: i18next.t("formula.day.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "DAYS",
                intro: i18next.t("formula.days.intro"),
                usage: i18next.t("formula.days.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "DAYS360",
                intro: i18next.t("formula.days360.intro"),
                usage: i18next.t("formula.days360.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "HOUR",
                intro: i18next.t("formula.hour.intro"),
                usage: i18next.t("formula.hour.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "ISOWEEKNUM",
                intro: i18next.t("formula.isoweeknum.intro"),
                usage: i18next.t("formula.isoweeknum.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "MINUTE",
                intro: i18next.t("formula.minute.intro"),
                usage: i18next.t("formula.minute.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "MONTH",
                intro: i18next.t("formula.month.intro"),
                usage: i18next.t("formula.month.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "NETWORKDAYS",
                intro: i18next.t("formula.networkdays.intro"),
                usage: i18next.t("formula.networkdays.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "NOW",
                intro: i18next.t("formula.now.intro"),
                usage: i18next.t("formula.now.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "SECOND",
                intro: i18next.t("formula.second.intro"),
                usage: i18next.t("formula.second.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "SYSTIME",
                intro: i18next.t("formula.systime.intro"),
                usage: i18next.t("formula.systime.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "TIME",
                intro: i18next.t("formula.time.intro"),
                usage: i18next.t("formula.time.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "TIMESTAMP",
                intro: i18next.t("formula.timestamp.intro"),
                usage: i18next.t("formula.timestamp.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "TODAY",
                intro: i18next.t("formula.today.intro"),
                usage: i18next.t("formula.today.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "WEEKNUM",
                intro: i18next.t("formula.weeknum.intro"),
                usage: i18next.t("formula.weeknum.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "WORKDAY",
                intro: i18next.t("formula.workday.intro"),
                usage: i18next.t("formula.workday.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "YEAR",
                intro: i18next.t("formula.year.intro"),
                usage: i18next.t("formula.year.usage"),
                example: i18next.t("formula.omit")
            }]
        }, {
            category: i18next.t("formula.logic"),
            docUrl: "https://hc.jiandaoyun.com/doc/9033",
            contains: [{
                name: "AND",
                intro: i18next.t("formula.and.intro"),
                usage: i18next.t("formula.and.usage"),
                example: i18next.t("formula.and.example")
            }, {
                name: "FALSE",
                intro: i18next.t("formula.false.intro"),
                usage: i18next.t("formula.false.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "IF",
                intro: i18next.t("formula.if.intro"),
                usage: i18next.t("formula.if.usage"),
                example: i18next.t("formula.if.example")
            }, {
                name: "IFS",
                intro: i18next.t("formula.ifs.intro"),
                usage: i18next.t("formula.ifs.usage"),
                example: i18next.t("formula.ifs.example")
            }, {
                name: "NOT",
                intro: i18next.t("formula.not.intro"),
                usage: i18next.t("formula.not.usage"),
                example: i18next.t("formula.not.example")
            }, {
                name: "OR",
                intro: i18next.t("formula.or.intro"),
                usage: i18next.t("formula.or.usage"),
                example: i18next.t("formula.or.example")
            }, {
                name: "TRUE",
                intro: i18next.t("formula.true.intro"),
                usage: i18next.t("formula.true.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "XOR",
                intro: i18next.t("formula.xor.intro"),
                usage: i18next.t("formula.xor.usage"),
                example: i18next.t("formula.xor.example")
            }]
        }, {
            category: i18next.t("formula.advance"),
            docUrl: "https://hc.jiandaoyun.com/doc/9037",
            contains: [{
                name: "GETUSERNAME",
                intro: i18next.t("formula.getusername.intro"),
                usage: i18next.t("formula.getusername.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "MAPX",
                intro: i18next.t("formula.mapx.intro"),
                usage: i18next.t("formula.mapx.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "RECNO",
                intro: i18next.t("formula.recno.intro"),
                usage: i18next.t("formula.recno.usage"),
                example: i18next.t("formula.omit")
            }, {
                name: "TEXTUSER",
                intro: i18next.t("formula.textuser.intro"),
                usage: i18next.t("formula.textuser.usage"),
                example: i18next.t("formula.textuser.example")
            }, {
                name: "UUID",
                intro: i18next.t("formula.uuid.intro"),
                usage: i18next.t("formula.uuid.usage"),
                example: i18next.t("formula.omit")
            }]
        }],
        _defaultConfig: function() {
            return d.extend(FX.FormulaInfoPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_formula_info",
                height: 228,
                limits: null,
                customFormula: null,
                hasCommonCategory: !0,
                onAfterFormulaSelect: null,
                defaultExpandKeys: [i18next.t("formula.common")]
            })
        },
        _init: function() {
            FX.FormulaInfoPane.superclass._init.apply(this, arguments);
            var t = this.options;
            this.FORMULA = t.customFormula || this.FORMULA,
                this._initFormulaData();
            var e = d.extend(!0, [], this.FORMULA);
            this.formula = this._filterFormulaData(e),
                d('<div class="formula-info-label">' + i18next.t("formula.func") + "</div>").appendTo(this.element),
                this.$main = d('<div class="formula-info-main"/>').appendTo(this.element),
                this._createFormulaMenu(),
                this._createIntroPane()
        },
        _initFormulaData: function() {
            FX.Utils.forEach(this.FORMULA, function(t, i) {
                FX.Utils.forEach(i.contains, function(t, e) {
                    d.extend(e, {
                        link: (e.docUrl || i.docUrl) + "/#" + e.name.toLowerCase()
                    })
                })
            })
        },
        _filterFormulaData: function(t) {
            var a = this.options
                , n = [];
            return FX.Utils.isArray(a.limits) && a.limits.length ? FX.Utils.forEach(t, function(t, e) {
                var i;
                !a.hasCommonCategory && "common" === e.value || (i = [],
                    FX.Utils.forEach(e.contains, function(t, e) {
                        -1 < a.limits.indexOf(e.name) && i.push(e)
                    }),
                    d.extend(e, {
                        contains: i
                    }),
                e.contains.length && n.push(e))
            }) : n = t,
                n
        },
        _createFormulaMenu: function() {
            this.$formulaMenu = d('<div class="formula-menu"/>').appendTo(this.$main),
                this._createSearchPane(),
                this._createFormulaList(),
                this._bindEvents()
        },
        _createSearchPane: function() {
            var i = this;
            this.$formulaSearch = d('<div class="formula-search"><i class="icon-search"/></div>').appendTo(this.$formulaMenu),
                d('<input class="search-input" placeholder="' + i18next.t("formula.search") + '"/>').on("input", function(t) {
                    var e = t.target.value;
                    e.trim() ? i._createSearchResultList(e) : (i._createFormulaList(),
                        i._createIntroPane())
                }).prependTo(this.$formulaSearch)
        },
        _createFormulaList: function() {
            var n = this
                , s = this.options;
            this.$formulaList ? this.$formulaList.removeClass("search-list").empty() : this.$formulaList = d('<ul class="formula-list"/>').appendTo(this.$formulaMenu),
                FX.Utils.forEach(this.formula, function(t, e) {
                    var i = d('<li class="formula-category"><div class="title"><i class="angle-icon icon-angleright"/>' + e.category + "</div></li>").appendTo(n.$formulaList);
                    -1 < s.defaultExpandKeys.indexOf(e.category) && i.addClass("expand");
                    var a = d('<ul class="children"/>').appendTo(i);
                    FX.Utils.forEach(e.contains, function(t, e) {
                        d('<li class="formula-item"/>').text(e.name).data("formula", e).on("mouseenter", function(t) {
                            n._onHoverFormulaItem(t)
                        }).appendTo(a)
                    })
                })
        },
        _createSearchResultList: function(t) {
            this.$formulaList.addClass("search-list").empty();
            var e = this._getSearchResult(t);
            if (FX.Utils.isObjectEmpty(e))
                return this._createIntroPane(),
                    void d('<div class="search-empty">' + i18next.t("formula.empty") + "</div>").appendTo(this.$formulaList);
            var i = this;
            FX.Utils.forEach(e, function(t, e) {
                d('<li class="formula-item"><span class="key">' + e.prefix + '</span><span class="other">' + e.other + "</span></li>").data("formula", e.formula).on("mouseenter", function(t) {
                    i._onHoverFormulaItem(t)
                }).appendTo(i.$formulaList)
            });
            var a = d(".formula-item", this.$formulaList).eq(0);
            a.addClass("select"),
                this._createIntroPane(a)
        },
        _onHoverFormulaItem: function(t) {
            d(".select", this.$formulaList).removeClass("select"),
                d(t.currentTarget).addClass("select"),
                this._createIntroPane(d(t.currentTarget))
        },
        _getSearchResult: function(i) {
            var a = {};
            return i = i.toUpperCase(),
                FX.Utils.forEach(this.formula, function(t, e) {
                    FX.Utils.forEach(e.contains, function(t, e) {
                        0 === e.name.indexOf(i) && (a[e.name] = {
                            formula: e,
                            prefix: i,
                            other: e.name.slice(i.length)
                        })
                    })
                }),
                a
        },
        _bindEvents: function() {
            var s = this
                , r = this.options;
            this.$formulaList.on("click", function(t) {
                var e, i = d(t.target).closest(".title");
                0 < i.length && (i.parent().siblings().removeClass("expand"),
                    i.parent().toggleClass("expand"),
                    d(".children", s.$formulaList).css({
                        height: 0
                    }),
                i.parent().hasClass("expand") && ((e = i.next(".children")).css({
                    height: 24 * e.children().length
                }),
                    s.$formulaList.animate({
                        scrollTop: 24 * i.parent().index()
                    }, 218)));
                var a, n = d(t.target).closest(".formula-item");
                0 < n.length && (a = n.data("formula"),
                    FX.Utils.applyFunc(s, r.onAfterFormulaSelect, [a.name], !1))
            })
        },
        _createIntroPane: function(t) {
            var e, i, a, n, s, r, o, l, c;
            this.$introPane ? this.$introPane.empty() : this.$introPane = d('<div class="formula-intro"/>').appendTo(this.$main),
                t ? (e = t.data("formula")) && (i = new RegExp("(" + e.name + ")","g"),
                    a = new RegExp("\\{(.+?)\\}","g"),
                    n = e.intro.replace(i, '<span class="formula-name">$1</span>'),
                    s = e.usage.replace(i, '<span class="formula-name">$1</span>'),
                    r = e.example.replace(i, '<span class="formula-name">$1</span>').replace(a, '<span class="formula-field">$1</span>'),
                    o = '<div class="formula-title">' + e.name + "</div>",
                    l = '<ul class="intro-wrapper"><li class="intro">' + n + '</li><li class="usage">' + i18next.t("formula.usage") + s + '</li><li class="example">' + i18next.t("formula.example") + r + "</li></ul>",
                    c = '<a class="formula-link" target="_blank" href="' + e.link + '">' + i18next.t("formula.learnMore") + "</a>",
                    d(o + l + c).appendTo(this.$introPane)) : d('<ul class="intro-wrapper default"><li>' + i18next.t("formula.input.tip") + "</li><li>" + i18next.t("formula.edit.example") + '<span class="formula-name">AVERAGE</span>(<span class="formula-field">' + i18next.t("formula.example.language.grade") + '</span>,<span class="formula-field">' + i18next.t("formula.example.math.grade") + '</span>)</li></ul><div class="default-links"><a href="https://hc.jiandaoyun.com/video/10530" target="_blank" class="formula-link">' + i18next.t("formula.example.baseVideo") + '</a><a href="https://hc.jiandaoyun.com/blog/10471" target="_blank" class="formula-link">' + i18next.t("formula.example.advanceVideo") + '</a><a href="https://hc.jiandaoyun.com/doc/9031" target="_blank" class="formula-link">' + i18next.t("formula.example.doc") + "</a></div>").appendTo(this.$introPane)
        }
    }),
        d.shortcut("formulainfopane", FX.FormulaInfoPane)
}(jQuery),
function(o) {
    FX.ValidatorPane = FX.extend(FX.Widget, {
        _defaultConfig: function() {
            return o.extend(FX.ValidatorPane.superclass._defaultConfig.apply(this, arguments), {
                baseCls: "fx_validator_pane",
                validator: [],
                entryList: [],
                entryId: "",
                onBeforeEdit: null,
                onAfterEdit: null
            })
        },
        _init: function() {
            FX.ValidatorPane.superclass._init.apply(this, arguments),
                this.labelMap = this._getLabelMap(),
                this._createValidatorList(),
                this._createValidatorBtn()
        },
        _createValidatorBtn: function() {
            var t = this;
            new FX.Button({
                renderEl: o("<div/>").appendTo(this.element),
                type: "button",
                text: i18next.t("form.validator.add"),
                style: "white",
                height: 30,
                onClick: function() {
                    t._setValidator()
                }
            })
        },
        _setValidator: function(t, i) {
            var a = this
                , n = this.options;
            FX.Utils.applyFunc(a, n.onBeforeEdit, [], !1),
                new FX.FieldFormulaPane({
                    formula: t,
                    supportMultiForm: !1,
                    showFieldHeader: !1,
                    emptyFieldTip: i18next.t("formula.field.empty.tip"),
                    dialogTitle: i18next.t("submit.verify"),
                    verifySuccessTip: i18next.t("formula.valid.set.success"),
                    formulaKeywords: Object.keys(FX.Formula).remove("MAP").remove("MAPX"),
                    entryList: n.entryList,
                    currentForm: n.entryId,
                    labelMap: a._getLabelMap(),
                    onAfterFormulaEdit: function(t, e) {
                        i ? FX.Utils.isEmpty(t.formula) ? i.remove() : (i.data("formula", t.formula).data("remind", e),
                            i.children("span").text(a._getTextFormFormula(t.formula)),
                            i.removeClass("error")) : FX.Utils.isEmpty(t.formula) || a._createValidatorItem(t.formula, e),
                            FX.Utils.applyFunc(a, n.onAfterEdit, [], !1)
                    }
                })
        },
        _createValidatorList: function() {
            var i = this
                , t = this.options;
            this.$list = o('<ul class="validator-list">').appendTo(this.element),
                FX.Utils.forEach(t.validator, function(t, e) {
                    i._createValidatorItem(e.formula, e.remind)
                })
        },
        _getTextFormFormula: function(t) {
            var a = []
                , e = t.split(/(\$[0-9a-zA-Z\._]+#[0-9A-Fa-f]*)/g)
                , n = this._getLabelMap();
            return FX.Utils.forEach(e, function(t, e) {
                var i;
                FX.Utils.startWith(e, "$_widget_") ? (i = n[e],
                    a.push(i)) : a.push(e)
            }),
                a.join("")
        },
        _getLabelMap: function() {
            var i = this.options
                , a = this
                , n = {};
            return FX.Utils.forEach(i.entryList, function(t, e) {
                if (e.entryId === i.entryId)
                    return FX.Utils.forEach(e.fields, function(t, e) {
                        o.extend(n, a._getFieldLabelMap(e))
                    }),
                        !1
            }),
                n
        },
        _getFieldLabelMap: function(a) {
            var t, n = {};
            return "subform" === a.type ? FX.Utils.forEach(a.items, function(t, e) {
                var i = ["$", a.name, ".", e.name, "#"].join("");
                n[i] = [a.text, e.text].join(".")
            }) : (t = ["$", a.name, "#"].join(""),
                n[t] = a.text),
                n
        },
        _createValidatorItem: function(t, e) {
            var i = this
                , a = this.options
                , n = this._checkFormulaValid(t)
                , s = n ? this._getTextFormFormula(t) : i18next.t("form.validator.add.error")
                , r = o("<li/>").data("formula", t).data("remind", e).appendTo(this.$list);
            n || r.addClass("error"),
                o("<span/>").text(s).appendTo(r),
                o('<i class="item-icon x-c-key icon-edit"/>').appendTo(r).click(function() {
                    i._setValidator({
                        formula: r.data("formula"),
                        remind: r.data("remind")
                    }, r)
                }),
                o('<i class="item-icon icon-trasho"/>').appendTo(r).click(function() {
                    r.remove(),
                        FX.Utils.applyFunc(i, a.onAfterEdit, [], !1)
                })
        },
        _checkFormulaValid: function(t) {
            if (!FX.Utils.isString(t))
                return !1;
            var i = this
                , a = !0
                , e = t.split(FX.CONST.COMMON_REG.VALIDATOR_FORMULA);
            return FX.Utils.forEach(e, function(t, e) {
                if (FX.Utils.startWith(e, "$_widget_") && !(e in i._getLabelMap()))
                    return a = !1
            }),
                a
        },
        getValue: function() {
            var a = [];
            return FX.Utils.forEach(this.$list.children("li"), function(t, e) {
                var i = o(e).data("formula");
                FX.Utils.isEmpty(i) || a.push({
                    formula: i,
                    remind: o(e).data("remind")
                })
            }),
                a
        }
    }),
        o.shortcut("validatorpane", FX.ValidatorPane)
}(jQuery);
